const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-1765887266800-FoodScanner.js","assets/chunk-1765887267004-aiVisionService.js","assets/chunk-1765887267003-index.js","assets/asset-1765887267434-FoodScanner.css","assets/asset-1765887267435-PaywallModal.css","assets/chunk-1765887266800-ProfileSetup.js","assets/chunk-1765887266801-healthAvatarService.js","assets/asset-1765887267401-ProfileSetup.css","assets/chunk-1765887266800-HealthAvatar.js","assets/asset-1765887267437-HealthAvatar.css","assets/chunk-1765887266800-ARScanner.js","assets/chunk-1765887266800-PaywallModal.js","assets/asset-1765887267402-ARScanner.css","assets/chunk-1765887266800-EmergencyPanel.js","assets/chunk-1765887266801-emergencyService.js","assets/asset-1765887267431-EmergencyPanel.css","assets/chunk-1765887266800-InsuranceRewards.js","assets/asset-1765887267432-InsuranceRewards.css","assets/chunk-1765887266800-DNAUpload.js","assets/asset-1765887267435-DNAUpload.css","assets/chunk-1765887266800-SocialBattles.js","assets/chunk-1765887266801-socialBattlesService.js","assets/asset-1765887267434-SocialBattles.css","assets/chunk-1765887266800-MealAutomation.js","assets/asset-1765887267432-MealAutomation.css","assets/chunk-1765887266800-LegalModal.js","assets/asset-1765887267432-LegalModal.css","assets/chunk-1765887266800-StripePayment.js","assets/asset-1765887267432-StripePayment.css","assets/chunk-1765887266800-AppleHealthSync.js","assets/asset-1765887267432-AppleHealthSync.css","assets/chunk-1765887266800-WearableSync.js","assets/asset-1765887267432-WearableSync.css","assets/chunk-1765887266800-Onboarding.js","assets/asset-1765887267432-Onboarding.css","assets/chunk-1765887266800-DevUnlock.js","assets/asset-1765887267432-DevUnlock.css","assets/chunk-1765887266800-DataRecovery.js","assets/asset-1765887267433-DataRecovery.css","assets/chunk-1765887266801-BarcodeScanner.js","assets/chunk-1765887267018-barcodeScannerService.js","assets/asset-1765887267433-BarcodeScanner.css","assets/chunk-1765887266801-RepCounter.js","assets/asset-1765887267434-RepCounter.css","assets/chunk-1765887266801-GlobalFallAlert.js","assets/chunk-1765887266801-BrainInsightsDashboard.js","assets/asset-1765887267434-BrainInsightsDashboard.css","assets/chunk-1765887266801-TodayOverview.js","assets/asset-1765887267434-TodayOverview.css","assets/chunk-1765887266801-HomeActionButton.js","assets/asset-1765887267434-HomeActionButton.css","assets/chunk-1765887266801-StatsModal.js","assets/asset-1765887267434-StatsModal.css","assets/chunk-1765887266801-PremiumModal.js","assets/asset-1765887267434-PremiumModal.css","assets/chunk-1765887266801-BattlesModal.js","assets/asset-1765887267434-BattlesModal.css","assets/chunk-1765887266801-FoodModal.js","assets/asset-1765887267434-FoodModal.css","assets/chunk-1765887266801-DNAModal.js","assets/asset-1765887267434-DNAModal.css","assets/chunk-1765887266801-WorkoutsModalNew.js","assets/asset-1765887267436-WorkoutsModalNew.css","assets/chunk-1765887266801-HealthModal.js","assets/asset-1765887267437-HealthModal.css","assets/chunk-1765887266801-GoalsModal.js","assets/asset-1765887267438-GoalsModal.css","assets/chunk-1765887266801-ProgressModal.js","assets/asset-1765887267439-ProgressModal.css","assets/chunk-1765887266801-CommunityRecipes.js","assets/asset-1765887267440-CommunityRecipes.css","assets/chunk-1765887266801-StreakCounter.js","assets/asset-1765887267440-StreakCounter.css","assets/chunk-1765887266801-LevelProgressBar.js","assets/asset-1765887267440-LevelProgressBar.css","assets/chunk-1765887266801-DailyChallenges.js","assets/asset-1765887267441-DailyChallenges.css","assets/chunk-1765887266801-AchievementUnlock.js","assets/asset-1765887267456-AchievementUnlock.css","assets/chunk-1765887266801-VoiceTabRedesign.js","assets/chunk-1765887267161-PointsPopup.js","assets/asset-1765887267458-PointsPopup.css","assets/asset-1765887267458-VoiceTabRedesign.css","assets/chunk-1765887266801-ZenTabRedesign.js","assets/asset-1765887267459-ZenTabRedesign.css","assets/chunk-1765887266801-ScanTabRedesign.js","assets/asset-1765887267459-ScanTabRedesign.css","assets/chunk-1765887266801-ProfileTabRedesign.js","assets/asset-1765887267459-ProfileTabRedesign.css","assets/chunk-1765887266801-AIAssistantModal.js","assets/asset-1765887267460-AIAssistantModal.css","assets/chunk-1765887266801-HealthToolsModal.js","assets/asset-1765887267461-HealthToolsModal.css","assets/chunk-1765887266801-DataManagementModal.js","assets/asset-1765887267461-DataManagementModal.css","assets/chunk-1765887266801-SocialFeaturesModal.js","assets/asset-1765887267462-SocialFeaturesModal.css","assets/chunk-1765887266801-SettingsHubModal.js","assets/asset-1765887267462-SettingsHubModal.css","assets/chunk-1765887266801-QuickLogModal.js","assets/asset-1765887267463-QuickLogModal.css"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var Ld=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tC(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function EY(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function n(){var r=!1;try{r=this instanceof n}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}),t}var M_={exports:{}},mg={};var AT;function TP(){if(AT)return mg;AT=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,s){var l=null;if(s!==void 0&&(l=""+s),r.key!==void 0&&(l=""+r.key),"key"in r){s={};for(var u in r)u!=="key"&&(s[u]=r[u])}else s=r;return r=s.ref,{$$typeof:i,type:n,key:l,ref:r!==void 0?r:null,props:s}}return mg.Fragment=e,mg.jsx=t,mg.jsxs=t,mg}var ET;function AP(){return ET||(ET=1,M_.exports=TP()),M_.exports}var b=AP(),F_={exports:{}},pi={};var IT;function EP(){if(IT)return pi;IT=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),w=Symbol.iterator;function A(Ne){return Ne===null||typeof Ne!="object"?null:(Ne=w&&Ne[w]||Ne["@@iterator"],typeof Ne=="function"?Ne:null)}var B={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$=Object.assign,W={};function q(Ne,se,Ee){this.props=Ne,this.context=se,this.refs=W,this.updater=Ee||B}q.prototype.isReactComponent={},q.prototype.setState=function(Ne,se){if(typeof Ne!="object"&&typeof Ne!="function"&&Ne!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ne,se,"setState")},q.prototype.forceUpdate=function(Ne){this.updater.enqueueForceUpdate(this,Ne,"forceUpdate")};function ge(){}ge.prototype=q.prototype;function he(Ne,se,Ee){this.props=Ne,this.context=se,this.refs=W,this.updater=Ee||B}var me=he.prototype=new ge;me.constructor=he,$(me,q.prototype),me.isPureReactComponent=!0;var Ce=Array.isArray;function Ve(){}var pe={H:null,A:null,T:null,S:null},ee=Object.prototype.hasOwnProperty;function J(Ne,se,Ee){var Le=Ee.ref;return{$$typeof:i,type:Ne,key:se,ref:Le!==void 0?Le:null,props:Ee}}function ye(Ne,se){return J(Ne.type,se,Ne.props)}function X(Ne){return typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===i}function ae(Ne){var se={"=":"=0",":":"=2"};return"$"+Ne.replace(/[=:]/g,function(Ee){return se[Ee]})}var le=/\/+/g;function ze(Ne,se){return typeof Ne=="object"&&Ne!==null&&Ne.key!=null?ae(""+Ne.key):se.toString(36)}function nt(Ne){switch(Ne.status){case"fulfilled":return Ne.value;case"rejected":throw Ne.reason;default:switch(typeof Ne.status=="string"?Ne.then(Ve,Ve):(Ne.status="pending",Ne.then(function(se){Ne.status==="pending"&&(Ne.status="fulfilled",Ne.value=se)},function(se){Ne.status==="pending"&&(Ne.status="rejected",Ne.reason=se)})),Ne.status){case"fulfilled":return Ne.value;case"rejected":throw Ne.reason}}throw Ne}function je(Ne,se,Ee,Le,Be){var He=typeof Ne;(He==="undefined"||He==="boolean")&&(Ne=null);var Ye=!1;if(Ne===null)Ye=!0;else switch(He){case"bigint":case"string":case"number":Ye=!0;break;case"object":switch(Ne.$$typeof){case i:case e:Ye=!0;break;case x:return Ye=Ne._init,je(Ye(Ne._payload),se,Ee,Le,Be)}}if(Ye)return Be=Be(Ne),Ye=Le===""?"."+ze(Ne,0):Le,Ce(Be)?(Ee="",Ye!=null&&(Ee=Ye.replace(le,"$&/")+"/"),je(Be,se,Ee,"",function(Et){return Et})):Be!=null&&(X(Be)&&(Be=ye(Be,Ee+(Be.key==null||Ne&&Ne.key===Be.key?"":(""+Be.key).replace(le,"$&/")+"/")+Ye)),se.push(Be)),1;Ye=0;var it=Le===""?".":Le+":";if(Ce(Ne))for(var ct=0;ct<Ne.length;ct++)Le=Ne[ct],He=it+ze(Le,ct),Ye+=je(Le,se,Ee,He,Be);else if(ct=A(Ne),typeof ct=="function")for(Ne=ct.call(Ne),ct=0;!(Le=Ne.next()).done;)Le=Le.value,He=it+ze(Le,ct++),Ye+=je(Le,se,Ee,He,Be);else if(He==="object"){if(typeof Ne.then=="function")return je(nt(Ne),se,Ee,Le,Be);throw se=String(Ne),Error("Objects are not valid as a React child (found: "+(se==="[object Object]"?"object with keys {"+Object.keys(Ne).join(", ")+"}":se)+"). If you meant to render a collection of children, use an array instead.")}return Ye}function Je(Ne,se,Ee){if(Ne==null)return Ne;var Le=[],Be=0;return je(Ne,Le,"","",function(He){return se.call(Ee,He,Be++)}),Le}function qe(Ne){if(Ne._status===-1){var se=Ne._result;se=se(),se.then(function(Ee){(Ne._status===0||Ne._status===-1)&&(Ne._status=1,Ne._result=Ee)},function(Ee){(Ne._status===0||Ne._status===-1)&&(Ne._status=2,Ne._result=Ee)}),Ne._status===-1&&(Ne._status=0,Ne._result=se)}if(Ne._status===1)return Ne._result.default;throw Ne._result}var lt=typeof reportError=="function"?reportError:function(Ne){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var se=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ne=="object"&&Ne!==null&&typeof Ne.message=="string"?String(Ne.message):String(Ne),error:Ne});if(!window.dispatchEvent(se))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ne);return}console.error(Ne)},Tt={map:Je,forEach:function(Ne,se,Ee){Je(Ne,function(){se.apply(this,arguments)},Ee)},count:function(Ne){var se=0;return Je(Ne,function(){se++}),se},toArray:function(Ne){return Je(Ne,function(se){return se})||[]},only:function(Ne){if(!X(Ne))throw Error("React.Children.only expected to receive a single React element child.");return Ne}};return pi.Activity=p,pi.Children=Tt,pi.Component=q,pi.Fragment=t,pi.Profiler=r,pi.PureComponent=he,pi.StrictMode=n,pi.Suspense=h,pi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=pe,pi.__COMPILER_RUNTIME={__proto__:null,c:function(Ne){return pe.H.useMemoCache(Ne)}},pi.cache=function(Ne){return function(){return Ne.apply(null,arguments)}},pi.cacheSignal=function(){return null},pi.cloneElement=function(Ne,se,Ee){if(Ne==null)throw Error("The argument must be a React element, but you passed "+Ne+".");var Le=$({},Ne.props),Be=Ne.key;if(se!=null)for(He in se.key!==void 0&&(Be=""+se.key),se)!ee.call(se,He)||He==="key"||He==="__self"||He==="__source"||He==="ref"&&se.ref===void 0||(Le[He]=se[He]);var He=arguments.length-2;if(He===1)Le.children=Ee;else if(1<He){for(var Ye=Array(He),it=0;it<He;it++)Ye[it]=arguments[it+2];Le.children=Ye}return J(Ne.type,Be,Le)},pi.createContext=function(Ne){return Ne={$$typeof:l,_currentValue:Ne,_currentValue2:Ne,_threadCount:0,Provider:null,Consumer:null},Ne.Provider=Ne,Ne.Consumer={$$typeof:s,_context:Ne},Ne},pi.createElement=function(Ne,se,Ee){var Le,Be={},He=null;if(se!=null)for(Le in se.key!==void 0&&(He=""+se.key),se)ee.call(se,Le)&&Le!=="key"&&Le!=="__self"&&Le!=="__source"&&(Be[Le]=se[Le]);var Ye=arguments.length-2;if(Ye===1)Be.children=Ee;else if(1<Ye){for(var it=Array(Ye),ct=0;ct<Ye;ct++)it[ct]=arguments[ct+2];Be.children=it}if(Ne&&Ne.defaultProps)for(Le in Ye=Ne.defaultProps,Ye)Be[Le]===void 0&&(Be[Le]=Ye[Le]);return J(Ne,He,Be)},pi.createRef=function(){return{current:null}},pi.forwardRef=function(Ne){return{$$typeof:u,render:Ne}},pi.isValidElement=X,pi.lazy=function(Ne){return{$$typeof:x,_payload:{_status:-1,_result:Ne},_init:qe}},pi.memo=function(Ne,se){return{$$typeof:f,type:Ne,compare:se===void 0?null:se}},pi.startTransition=function(Ne){var se=pe.T,Ee={};pe.T=Ee;try{var Le=Ne(),Be=pe.S;Be!==null&&Be(Ee,Le),typeof Le=="object"&&Le!==null&&typeof Le.then=="function"&&Le.then(Ve,lt)}catch(He){lt(He)}finally{se!==null&&Ee.types!==null&&(se.types=Ee.types),pe.T=se}},pi.unstable_useCacheRefresh=function(){return pe.H.useCacheRefresh()},pi.use=function(Ne){return pe.H.use(Ne)},pi.useActionState=function(Ne,se,Ee){return pe.H.useActionState(Ne,se,Ee)},pi.useCallback=function(Ne,se){return pe.H.useCallback(Ne,se)},pi.useContext=function(Ne){return pe.H.useContext(Ne)},pi.useDebugValue=function(){},pi.useDeferredValue=function(Ne,se){return pe.H.useDeferredValue(Ne,se)},pi.useEffect=function(Ne,se){return pe.H.useEffect(Ne,se)},pi.useEffectEvent=function(Ne){return pe.H.useEffectEvent(Ne)},pi.useId=function(){return pe.H.useId()},pi.useImperativeHandle=function(Ne,se,Ee){return pe.H.useImperativeHandle(Ne,se,Ee)},pi.useInsertionEffect=function(Ne,se){return pe.H.useInsertionEffect(Ne,se)},pi.useLayoutEffect=function(Ne,se){return pe.H.useLayoutEffect(Ne,se)},pi.useMemo=function(Ne,se){return pe.H.useMemo(Ne,se)},pi.useOptimistic=function(Ne,se){return pe.H.useOptimistic(Ne,se)},pi.useReducer=function(Ne,se,Ee){return pe.H.useReducer(Ne,se,Ee)},pi.useRef=function(Ne){return pe.H.useRef(Ne)},pi.useState=function(Ne){return pe.H.useState(Ne)},pi.useSyncExternalStore=function(Ne,se,Ee){return pe.H.useSyncExternalStore(Ne,se,Ee)},pi.useTransition=function(){return pe.H.useTransition()},pi.version="19.2.0",pi}var kT;function a2(){return kT||(kT=1,F_.exports=EP()),F_.exports}var we=a2();const IP=tC(we);var j_={exports:{}},yg={},V_={exports:{}},z_={};var CT;function kP(){return CT||(CT=1,(function(i){function e(je,Je){var qe=je.length;je.push(Je);e:for(;0<qe;){var lt=qe-1>>>1,Tt=je[lt];if(0<r(Tt,Je))je[lt]=Je,je[qe]=Tt,qe=lt;else break e}}function t(je){return je.length===0?null:je[0]}function n(je){if(je.length===0)return null;var Je=je[0],qe=je.pop();if(qe!==Je){je[0]=qe;e:for(var lt=0,Tt=je.length,Ne=Tt>>>1;lt<Ne;){var se=2*(lt+1)-1,Ee=je[se],Le=se+1,Be=je[Le];if(0>r(Ee,qe))Le<Tt&&0>r(Be,Ee)?(je[lt]=Be,je[Le]=qe,lt=Le):(je[lt]=Ee,je[se]=qe,lt=se);else if(Le<Tt&&0>r(Be,qe))je[lt]=Be,je[Le]=qe,lt=Le;else break e}}return Je}function r(je,Je){var qe=je.sortIndex-Je.sortIndex;return qe!==0?qe:je.id-Je.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var h=[],f=[],x=1,p=null,w=3,A=!1,B=!1,$=!1,W=!1,q=typeof setTimeout=="function"?setTimeout:null,ge=typeof clearTimeout=="function"?clearTimeout:null,he=typeof setImmediate<"u"?setImmediate:null;function me(je){for(var Je=t(f);Je!==null;){if(Je.callback===null)n(f);else if(Je.startTime<=je)n(f),Je.sortIndex=Je.expirationTime,e(h,Je);else break;Je=t(f)}}function Ce(je){if($=!1,me(je),!B)if(t(h)!==null)B=!0,Ve||(Ve=!0,ae());else{var Je=t(f);Je!==null&&nt(Ce,Je.startTime-je)}}var Ve=!1,pe=-1,ee=5,J=-1;function ye(){return W?!0:!(i.unstable_now()-J<ee)}function X(){if(W=!1,Ve){var je=i.unstable_now();J=je;var Je=!0;try{e:{B=!1,$&&($=!1,ge(pe),pe=-1),A=!0;var qe=w;try{t:{for(me(je),p=t(h);p!==null&&!(p.expirationTime>je&&ye());){var lt=p.callback;if(typeof lt=="function"){p.callback=null,w=p.priorityLevel;var Tt=lt(p.expirationTime<=je);if(je=i.unstable_now(),typeof Tt=="function"){p.callback=Tt,me(je),Je=!0;break t}p===t(h)&&n(h),me(je)}else n(h);p=t(h)}if(p!==null)Je=!0;else{var Ne=t(f);Ne!==null&&nt(Ce,Ne.startTime-je),Je=!1}}break e}finally{p=null,w=qe,A=!1}Je=void 0}}finally{Je?ae():Ve=!1}}}var ae;if(typeof he=="function")ae=function(){he(X)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,ze=le.port2;le.port1.onmessage=X,ae=function(){ze.postMessage(null)}}else ae=function(){q(X,0)};function nt(je,Je){pe=q(function(){je(i.unstable_now())},Je)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(je){je.callback=null},i.unstable_forceFrameRate=function(je){0>je||125<je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<je?Math.floor(1e3/je):5},i.unstable_getCurrentPriorityLevel=function(){return w},i.unstable_next=function(je){switch(w){case 1:case 2:case 3:var Je=3;break;default:Je=w}var qe=w;w=Je;try{return je()}finally{w=qe}},i.unstable_requestPaint=function(){W=!0},i.unstable_runWithPriority=function(je,Je){switch(je){case 1:case 2:case 3:case 4:case 5:break;default:je=3}var qe=w;w=je;try{return Je()}finally{w=qe}},i.unstable_scheduleCallback=function(je,Je,qe){var lt=i.unstable_now();switch(typeof qe=="object"&&qe!==null?(qe=qe.delay,qe=typeof qe=="number"&&0<qe?lt+qe:lt):qe=lt,je){case 1:var Tt=-1;break;case 2:Tt=250;break;case 5:Tt=1073741823;break;case 4:Tt=1e4;break;default:Tt=5e3}return Tt=qe+Tt,je={id:x++,callback:Je,priorityLevel:je,startTime:qe,expirationTime:Tt,sortIndex:-1},qe>lt?(je.sortIndex=qe,e(f,je),t(h)===null&&je===t(f)&&($?(ge(pe),pe=-1):$=!0,nt(Ce,qe-lt))):(je.sortIndex=Tt,e(h,je),B||A||(B=!0,Ve||(Ve=!0,ae()))),je},i.unstable_shouldYield=ye,i.unstable_wrapCallback=function(je){var Je=w;return function(){var qe=w;w=Je;try{return je.apply(this,arguments)}finally{w=qe}}}})(z_)),z_}var RT;function CP(){return RT||(RT=1,V_.exports=kP()),V_.exports}var U_={exports:{}},Co={};var DT;function RP(){if(DT)return Co;DT=1;var i=a2();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)f+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(h,f,x){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:h,containerInfo:f,implementation:x}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Co.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Co.createPortal=function(h,f){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return s(h,f,null,x)},Co.flushSync=function(h){var f=l.T,x=n.p;try{if(l.T=null,n.p=2,h)return h()}finally{l.T=f,n.p=x,n.d.f()}},Co.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(h,f))},Co.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},Co.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var x=f.as,p=u(x,f.crossOrigin),w=typeof f.integrity=="string"?f.integrity:void 0,A=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;x==="style"?n.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:p,integrity:w,fetchPriority:A}):x==="script"&&n.d.X(h,{crossOrigin:p,integrity:w,fetchPriority:A,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Co.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var x=u(f.as,f.crossOrigin);n.d.M(h,{crossOrigin:x,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(h)},Co.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var x=f.as,p=u(x,f.crossOrigin);n.d.L(h,x,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Co.preloadModule=function(h,f){if(typeof h=="string")if(f){var x=u(f.as,f.crossOrigin);n.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:x,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(h)},Co.requestFormReset=function(h){n.d.r(h)},Co.unstable_batchedUpdates=function(h,f){return h(f)},Co.useFormState=function(h,f,x){return l.H.useFormState(h,f,x)},Co.useFormStatus=function(){return l.H.useHostTransitionStatus()},Co.version="19.2.0",Co}var LT;function DP(){if(LT)return U_.exports;LT=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),U_.exports=RP(),U_.exports}var NT;function LP(){if(NT)return yg;NT=1;var i=CP(),e=a2(),t=DP();function n(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var o=a,c=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(c=o.return),a=o.return;while(a)}return o.tag===3?c:null}function l(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function u(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function h(a){if(s(a)!==a)throw Error(n(188))}function f(a){var o=a.alternate;if(!o){if(o=s(a),o===null)throw Error(n(188));return o!==a?null:a}for(var c=a,m=o;;){var C=c.return;if(C===null)break;var L=C.alternate;if(L===null){if(m=C.return,m!==null){c=m;continue}break}if(C.child===L.child){for(L=C.child;L;){if(L===c)return h(C),a;if(L===m)return h(C),o;L=L.sibling}throw Error(n(188))}if(c.return!==m.return)c=C,m=L;else{for(var Z=!1,Se=C.child;Se;){if(Se===c){Z=!0,c=C,m=L;break}if(Se===m){Z=!0,m=C,c=L;break}Se=Se.sibling}if(!Z){for(Se=L.child;Se;){if(Se===c){Z=!0,c=L,m=C;break}if(Se===m){Z=!0,m=L,c=C;break}Se=Se.sibling}if(!Z)throw Error(n(189))}}if(c.alternate!==m)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?a:o}function x(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=x(a),o!==null)return o;a=a.sibling}return null}var p=Object.assign,w=Symbol.for("react.element"),A=Symbol.for("react.transitional.element"),B=Symbol.for("react.portal"),$=Symbol.for("react.fragment"),W=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),ge=Symbol.for("react.consumer"),he=Symbol.for("react.context"),me=Symbol.for("react.forward_ref"),Ce=Symbol.for("react.suspense"),Ve=Symbol.for("react.suspense_list"),pe=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),J=Symbol.for("react.activity"),ye=Symbol.for("react.memo_cache_sentinel"),X=Symbol.iterator;function ae(a){return a===null||typeof a!="object"?null:(a=X&&a[X]||a["@@iterator"],typeof a=="function"?a:null)}var le=Symbol.for("react.client.reference");function ze(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===le?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case $:return"Fragment";case q:return"Profiler";case W:return"StrictMode";case Ce:return"Suspense";case Ve:return"SuspenseList";case J:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case B:return"Portal";case he:return a.displayName||"Context";case ge:return(a._context.displayName||"Context")+".Consumer";case me:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case pe:return o=a.displayName||null,o!==null?o:ze(a.type)||"Memo";case ee:o=a._payload,a=a._init;try{return ze(a(o))}catch{}}return null}var nt=Array.isArray,je=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Je=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,qe={pending:!1,data:null,method:null,action:null},lt=[],Tt=-1;function Ne(a){return{current:a}}function se(a){0>Tt||(a.current=lt[Tt],lt[Tt]=null,Tt--)}function Ee(a,o){Tt++,lt[Tt]=a.current,a.current=o}var Le=Ne(null),Be=Ne(null),He=Ne(null),Ye=Ne(null);function it(a,o){switch(Ee(He,o),Ee(Be,a),Ee(Le,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?q5(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=q5(o),a=Y5(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}se(Le),Ee(Le,a)}function ct(){se(Le),se(Be),se(He)}function Et(a){a.memoizedState!==null&&Ee(Ye,a);var o=Le.current,c=Y5(o,a.type);o!==c&&(Ee(Be,a),Ee(Le,c))}function Ft(a){Be.current===a&&(se(Le),se(Be)),Ye.current===a&&(se(Ye),dg._currentValue=qe)}var Wt,qt;function kt(a){if(Wt===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);Wt=o&&o[1]||"",qt=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Wt+a+qt}var Pe=!1;function $t(a,o){if(!a||Pe)return"";Pe=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var Ot=function(){throw Error()};if(Object.defineProperty(Ot.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ot,[])}catch(xt){var yt=xt}Reflect.construct(a,[],Ot)}else{try{Ot.call()}catch(xt){yt=xt}a.call(Ot.prototype)}}else{try{throw Error()}catch(xt){yt=xt}(Ot=a())&&typeof Ot.catch=="function"&&Ot.catch(function(){})}}catch(xt){if(xt&&yt&&typeof xt.stack=="string")return[xt.stack,yt.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var C=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");C&&C.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=m.DetermineComponentFrameRoot(),Z=L[0],Se=L[1];if(Z&&Se){var Ke=Z.split(`
`),pt=Se.split(`
`);for(C=m=0;m<Ke.length&&!Ke[m].includes("DetermineComponentFrameRoot");)m++;for(;C<pt.length&&!pt[C].includes("DetermineComponentFrameRoot");)C++;if(m===Ke.length||C===pt.length)for(m=Ke.length-1,C=pt.length-1;1<=m&&0<=C&&Ke[m]!==pt[C];)C--;for(;1<=m&&0<=C;m--,C--)if(Ke[m]!==pt[C]){if(m!==1||C!==1)do if(m--,C--,0>C||Ke[m]!==pt[C]){var Ct=`
`+Ke[m].replace(" at new "," at ");return a.displayName&&Ct.includes("<anonymous>")&&(Ct=Ct.replace("<anonymous>",a.displayName)),Ct}while(1<=m&&0<=C);break}}}finally{Pe=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?kt(c):""}function Pt(a,o){switch(a.tag){case 26:case 27:case 5:return kt(a.type);case 16:return kt("Lazy");case 13:return a.child!==o&&o!==null?kt("Suspense Fallback"):kt("Suspense");case 19:return kt("SuspenseList");case 0:case 15:return $t(a.type,!1);case 11:return $t(a.type.render,!1);case 1:return $t(a.type,!0);case 31:return kt("Activity");default:return""}}function Tn(a){try{var o="",c=null;do o+=Pt(a,c),c=a,a=a.return;while(a);return o}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var _t=Object.prototype.hasOwnProperty,rn=i.unstable_scheduleCallback,Jt=i.unstable_cancelCallback,En=i.unstable_shouldYield,wn=i.unstable_requestPaint,Un=i.unstable_now,ii=i.unstable_getCurrentPriorityLevel,Bn=i.unstable_ImmediatePriority,li=i.unstable_UserBlockingPriority,Xn=i.unstable_NormalPriority,cn=i.unstable_LowPriority,$n=i.unstable_IdlePriority,hn=i.log,nr=i.unstable_setDisableYieldValue,Jn=null,vn=null;function On(a){if(typeof hn=="function"&&nr(a),vn&&typeof vn.setStrictMode=="function")try{vn.setStrictMode(Jn,a)}catch{}}var qn=Math.clz32?Math.clz32:Mn,un=Math.log,Pi=Math.LN2;function Mn(a){return a>>>=0,a===0?32:31-(un(a)/Pi|0)|0}var Sn=256,Qn=262144,tn=4194304;function Gt(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Kn(a,o,c){var m=a.pendingLanes;if(m===0)return 0;var C=0,L=a.suspendedLanes,Z=a.pingedLanes;a=a.warmLanes;var Se=m&134217727;return Se!==0?(m=Se&~L,m!==0?C=Gt(m):(Z&=Se,Z!==0?C=Gt(Z):c||(c=Se&~a,c!==0&&(C=Gt(c))))):(Se=m&~L,Se!==0?C=Gt(Se):Z!==0?C=Gt(Z):c||(c=m&~a,c!==0&&(C=Gt(c)))),C===0?0:o!==0&&o!==C&&(o&L)===0&&(L=C&-C,c=o&-o,L>=c||L===32&&(c&4194048)!==0)?o:C}function Nr(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function vr(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pr(){var a=tn;return tn<<=1,(tn&62914560)===0&&(tn=4194304),a}function Ri(a){for(var o=[],c=0;31>c;c++)o.push(a);return o}function pn(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ra(a,o,c,m,C,L){var Z=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var Se=a.entanglements,Ke=a.expirationTimes,pt=a.hiddenUpdates;for(c=Z&~c;0<c;){var Ct=31-qn(c),Ot=1<<Ct;Se[Ct]=0,Ke[Ct]=-1;var yt=pt[Ct];if(yt!==null)for(pt[Ct]=null,Ct=0;Ct<yt.length;Ct++){var xt=yt[Ct];xt!==null&&(xt.lane&=-536870913)}c&=~Ot}m!==0&&sa(a,m,0),L!==0&&C===0&&a.tag!==0&&(a.suspendedLanes|=L&~(Z&~o))}function sa(a,o,c){a.pendingLanes|=o,a.suspendedLanes&=~o;var m=31-qn(o);a.entangledLanes|=o,a.entanglements[m]=a.entanglements[m]|1073741824|c&261930}function Or(a,o){var c=a.entangledLanes|=o;for(a=a.entanglements;c;){var m=31-qn(c),C=1<<m;C&o|a[m]&o&&(a[m]|=o),c&=~C}}function bs(a,o){var c=o&-o;return c=(c&42)!==0?1:Oi(c),(c&(a.suspendedLanes|o))!==0?0:c}function Oi(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function ir(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function cr(){var a=Je.p;return a!==0?a:(a=window.event,a===void 0?32:vT(a.type))}function cs(a,o){var c=Je.p;try{return Je.p=a,o()}finally{Je.p=c}}var ns=Math.random().toString(36).slice(2),qi="__reactFiber$"+ns,Yi="__reactProps$"+ns,Xr="__reactContainer$"+ns,hs="__reactEvents$"+ns,ya="__reactListeners$"+ns,Ba="__reactHandles$"+ns,ds="__reactResources$"+ns,Jr="__reactMarker$"+ns;function ro(a){delete a[qi],delete a[Yi],delete a[hs],delete a[ya],delete a[Ba]}function Ms(a){var o=a[qi];if(o)return o;for(var c=a.parentNode;c;){if(o=c[Xr]||c[qi]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(a=nT(a);a!==null;){if(c=a[qi])return c;a=nT(a)}return o}a=c,c=a.parentNode}return null}function Fs(a){if(a=a[qi]||a[Xr]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function aa(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(n(33))}function js(a){var o=a[ds];return o||(o=a[ds]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function hr(a){a[Jr]=!0}var vl=new Set,Vs={};function va(a,o){Is(a,o),Is(a+"Capture",o)}function Is(a,o){for(Vs[a]=o,a=0;a<o.length;a++)vl.add(o[a])}var jo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),nl={},il={};function Vo(a){return _t.call(il,a)?!0:_t.call(nl,a)?!1:jo.test(a)?il[a]=!0:(nl[a]=!0,!1)}function oi(a,o,c){if(Vo(o))if(c===null)a.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+c)}}function Hr(a,o,c){if(c===null)a.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+c)}}function _r(a,o,c,m){if(m===null)a.removeAttribute(c);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(o,c,""+m)}}function dn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Da(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function zs(a,o,c){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var C=m.get,L=m.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return C.call(this)},set:function(Z){c=""+Z,L.call(this,Z)}}),Object.defineProperty(a,o,{enumerable:m.enumerable}),{getValue:function(){return c},setValue:function(Z){c=""+Z},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function yi(a){if(!a._valueTracker){var o=Da(a)?"checked":"value";a._valueTracker=zs(a,o,""+a[o])}}function $a(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var c=o.getValue(),m="";return a&&(m=Da(a)?a.checked?"true":"false":a.value),a=m,a!==c?(o.setValue(a),!0):!1}function ri(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var dr=/[\n"\\]/g;function Mr(a){return a.replace(dr,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function zo(a,o,c,m,C,L,Z,Se){a.name="",Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?a.type=Z:a.removeAttribute("type"),o!=null?Z==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+dn(o)):a.value!==""+dn(o)&&(a.value=""+dn(o)):Z!=="submit"&&Z!=="reset"||a.removeAttribute("value"),o!=null?Uo(a,Z,dn(o)):c!=null?Uo(a,Z,dn(c)):m!=null&&a.removeAttribute("value"),C==null&&L!=null&&(a.defaultChecked=!!L),C!=null&&(a.checked=C&&typeof C!="function"&&typeof C!="symbol"),Se!=null&&typeof Se!="function"&&typeof Se!="symbol"&&typeof Se!="boolean"?a.name=""+dn(Se):a.removeAttribute("name")}function $l(a,o,c,m,C,L,Z,Se){if(L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(a.type=L),o!=null||c!=null){if(!(L!=="submit"&&L!=="reset"||o!=null)){yi(a);return}c=c!=null?""+dn(c):"",o=o!=null?""+dn(o):c,Se||o===a.value||(a.value=o),a.defaultValue=o}m=m??C,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=Se?a.checked:!!m,a.defaultChecked=!!m,Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"&&(a.name=Z),yi(a)}function Uo(a,o,c){o==="number"&&ri(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function br(a,o,c,m){if(a=a.options,o){o={};for(var C=0;C<c.length;C++)o["$"+c[C]]=!0;for(c=0;c<a.length;c++)C=o.hasOwnProperty("$"+a[c].value),a[c].selected!==C&&(a[c].selected=C),C&&m&&(a[c].defaultSelected=!0)}else{for(c=""+dn(c),o=null,C=0;C<a.length;C++){if(a[C].value===c){a[C].selected=!0,m&&(a[C].defaultSelected=!0);return}o!==null||a[C].disabled||(o=a[C])}o!==null&&(o.selected=!0)}}function _l(a,o,c){if(o!=null&&(o=""+dn(o),o!==a.value&&(a.value=o),c==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=c!=null?""+dn(c):""}function oa(a,o,c,m){if(o==null){if(m!=null){if(c!=null)throw Error(n(92));if(nt(m)){if(1<m.length)throw Error(n(93));m=m[0]}c=m}c==null&&(c=""),o=c}c=dn(o),a.defaultValue=c,m=a.textContent,m===c&&m!==""&&m!==null&&(a.value=m),yi(a)}function Mi(a,o){if(o){var c=a.firstChild;if(c&&c===a.lastChild&&c.nodeType===3){c.nodeValue=o;return}}a.textContent=o}var so=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bl(a,o,c){var m=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?m?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":m?a.setProperty(o,c):typeof c!="number"||c===0||so.has(o)?o==="float"?a.cssFloat=c:a[o]=(""+c).trim():a[o]=c+"px"}function xl(a,o,c){if(o!=null&&typeof o!="object")throw Error(n(62));if(a=a.style,c!=null){for(var m in c)!c.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var C in o)m=o[C],o.hasOwnProperty(C)&&c[C]!==m&&bl(a,C,m)}else for(var L in o)o.hasOwnProperty(L)&&bl(a,L,o[L])}function Bo(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ha=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),At=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function St(a){return At.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function fn(){}var ui=null;function Xi(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var vi=null,Qt=null;function xs(a){var o=Fs(a);if(o&&(a=o.stateNode)){var c=a[Yi]||null;e:switch(a=o.stateNode,o.type){case"input":if(zo(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Mr(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var m=c[o];if(m!==a&&m.form===a.form){var C=m[Yi]||null;if(!C)throw Error(n(90));zo(m,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name)}}for(o=0;o<c.length;o++)m=c[o],m.form===a.form&&$a(m)}break e;case"textarea":_l(a,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&br(a,!!c.multiple,o,!1)}}}var _a=!1;function Us(a,o,c){if(_a)return a(o,c);_a=!0;try{var m=a(o);return m}finally{if(_a=!1,(vi!==null||Qt!==null)&&(by(),vi&&(o=vi,a=Qt,Qt=vi=null,xs(o),a)))for(o=0;o<a.length;o++)xs(a[o])}}function Er(a,o){var c=a.stateNode;if(c===null)return null;var m=c[Yi]||null;if(m===null)return null;c=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(c&&typeof c!="function")throw Error(n(231,o,typeof c));return c}var Ai=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ba=!1;if(Ai)try{var Ci={};Object.defineProperty(Ci,"passive",{get:function(){ba=!0}}),window.addEventListener("test",Ci,Ci),window.removeEventListener("test",Ci,Ci)}catch{ba=!1}var Bs=null,Ga=null,$s=null;function gn(){if($s)return $s;var a,o=Ga,c=o.length,m,C="value"in Bs?Bs.value:Bs.textContent,L=C.length;for(a=0;a<c&&o[a]===C[a];a++);var Z=c-a;for(m=1;m<=Z&&o[c-m]===C[L-m];m++);return $s=C.slice(a,1<m?1-m:void 0)}function ks(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function La(){return!0}function Ir(){return!1}function kr(a){function o(c,m,C,L,Z){this._reactName=c,this._targetInst=C,this.type=m,this.nativeEvent=L,this.target=Z,this.currentTarget=null;for(var Se in a)a.hasOwnProperty(Se)&&(c=a[Se],this[Se]=c?c(L):L[Se]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?La:Ir,this.isPropagationStopped=Ir,this}return p(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=La)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=La)},persist:function(){},isPersistent:La}),o}var Hs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xr=kr(Hs),Gs=p({},Hs,{view:0,detail:0}),Ka=kr(Gs),Gr,Wa,fs,ao=p({},Gs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vn,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==fs&&(fs&&a.type==="mousemove"?(Gr=a.screenX-fs.screenX,Wa=a.screenY-fs.screenY):Wa=Gr=0,fs=a),Gr)},movementY:function(a){return"movementY"in a?a.movementY:Wa}}),To=kr(ao),Ks=p({},ao,{dataTransfer:0}),on=kr(Ks),Di=p({},Gs,{relatedTarget:0}),Cr=kr(Di),la=p({},Hs,{animationName:0,elapsedTime:0,pseudoElement:0}),j=kr(la),fe=p({},Hs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Oe=kr(fe),We=p({},Hs,{data:0}),tt=kr(We),It={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ln={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mn(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=ln[a])?!!o[a]:!1}function Vn(){return mn}var Rn=p({},Gs,{key:function(a){if(a.key){var o=It[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=ks(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Mt[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vn,charCode:function(a){return a.type==="keypress"?ks(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ks(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Ei=kr(Rn),Rr=p({},ao,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fr=kr(Rr),E=p({},Gs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vn}),K=kr(E),ne=p({},Hs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ie=kr(ne),at=p({},ao,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ft=kr(at),Vt=p({},Hs,{newState:0,oldState:0}),Zn=kr(Vt),lr=[9,13,27,32],ci=Ai&&"CompositionEvent"in window,rr=null;Ai&&"documentMode"in document&&(rr=document.documentMode);var Ws=Ai&&"TextEvent"in window&&!rr,ua=Ai&&(!ci||rr&&8<rr&&11>=rr),wr=" ",ca=!1;function qa(a,o){switch(a){case"keyup":return lr.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $o(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var rl=!1;function xa(a,o){switch(a){case"compositionend":return $o(o);case"keypress":return o.which!==32?null:(ca=!0,wr);case"textInput":return a=o.data,a===wr&&ca?null:a;default:return null}}function wl(a,o){if(rl)return a==="compositionend"||!ci&&qa(a,o)?(a=gn(),$s=Ga=Bs=null,rl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return ua&&o.locale!=="ko"?null:o.data;default:return null}}var Mu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hc(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!Mu[a.type]:o==="textarea"}function oo(a,o,c,m){vi?Qt?Qt.push(m):Qt=[m]:vi=m,o=Iy(o,"onChange"),0<o.length&&(c=new xr("onChange","change",null,c,m),a.push({event:c,listeners:o}))}var Ho=null,Sl=null;function dc(a){B5(a,0)}function Go(a){var o=aa(a);if($a(o))return a}function Hl(a,o){if(a==="change")return o}var Ya=!1;if(Ai){var Na;if(Ai){var Ko="oninput"in document;if(!Ko){var sl=document.createElement("div");sl.setAttribute("oninput","return;"),Ko=typeof sl.oninput=="function"}Na=Ko}else Na=!1;Ya=Na&&(!document.documentMode||9<document.documentMode)}function al(){Ho&&(Ho.detachEvent("onpropertychange",Fu),Sl=Ho=null)}function Fu(a){if(a.propertyName==="value"&&Go(Sl)){var o=[];oo(o,Sl,a,Xi(a)),Us(dc,o)}}function fu(a,o,c){a==="focusin"?(al(),Ho=o,Sl=c,Ho.attachEvent("onpropertychange",Fu)):a==="focusout"&&al()}function ps(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Go(Sl)}function fc(a,o){if(a==="click")return Go(o)}function ol(a,o){if(a==="input"||a==="change")return Go(o)}function Cs(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Rs=typeof Object.is=="function"?Object.is:Cs;function Tl(a,o){if(Rs(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var c=Object.keys(a),m=Object.keys(o);if(c.length!==m.length)return!1;for(m=0;m<c.length;m++){var C=c[m];if(!_t.call(o,C)||!Rs(a[C],o[C]))return!1}return!0}function lo(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ju(a,o){var c=lo(a);a=0;for(var m;c;){if(c.nodeType===3){if(m=a+c.textContent.length,a<=o&&m>=o)return{node:c,offset:o-a};a=m}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=lo(c)}}function Wo(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?Wo(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function uo(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=ri(a.document);o instanceof a.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)a=o.contentWindow;else break;o=ri(a.document)}return o}function ll(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var Gl=Ai&&"documentMode"in document&&11>=document.documentMode,Xa=null,Wn=null,Ii=null,is=!1;function Li(a,o,c){var m=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;is||Xa==null||Xa!==ri(m)||(m=Xa,"selectionStart"in m&&ll(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Ii&&Tl(Ii,m)||(Ii=m,m=Iy(Wn,"onSelect"),0<m.length&&(o=new xr("onSelect","select",null,o,c),a.push({event:o,listeners:m}),o.target=Xa)))}function zi(a,o){var c={};return c[a.toLowerCase()]=o.toLowerCase(),c["Webkit"+a]="webkit"+o,c["Moz"+a]="moz"+o,c}var Dr={animationend:zi("Animation","AnimationEnd"),animationiteration:zi("Animation","AnimationIteration"),animationstart:zi("Animation","AnimationStart"),transitionrun:zi("Transition","TransitionRun"),transitionstart:zi("Transition","TransitionStart"),transitioncancel:zi("Transition","TransitionCancel"),transitionend:zi("Transition","TransitionEnd")},gs={},ul={};Ai&&(ul=document.createElement("div").style,"AnimationEvent"in window||(delete Dr.animationend.animation,delete Dr.animationiteration.animation,delete Dr.animationstart.animation),"TransitionEvent"in window||delete Dr.transitionend.transition);function qo(a){if(gs[a])return gs[a];if(!Dr[a])return a;var o=Dr[a],c;for(c in o)if(o.hasOwnProperty(c)&&c in ul)return gs[a]=o[c];return a}var pu=qo("animationend"),pc=qo("animationiteration"),gd=qo("animationstart"),vf=qo("transitionrun"),_f=qo("transitionstart"),bf=qo("transitioncancel"),md=qo("transitionend"),yd=new Map,gu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gu.push("scrollEnd");function Ao(a,o){yd.set(a,o),va(o,[a])}var Kl=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},co=[],mu=0,gc=0;function yu(){for(var a=mu,o=gc=mu=0;o<a;){var c=co[o];co[o++]=null;var m=co[o];co[o++]=null;var C=co[o];co[o++]=null;var L=co[o];if(co[o++]=null,m!==null&&C!==null){var Z=m.pending;Z===null?C.next=C:(C.next=Z.next,Z.next=C),m.pending=C}L!==0&&El(c,C,L)}}function vu(a,o,c,m){co[mu++]=a,co[mu++]=o,co[mu++]=c,co[mu++]=m,gc|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function Al(a,o,c,m){return vu(a,o,c,m),qs(a)}function ho(a,o){return vu(a,null,null,o),qs(a)}function El(a,o,c){a.lanes|=c;var m=a.alternate;m!==null&&(m.lanes|=c);for(var C=!1,L=a.return;L!==null;)L.childLanes|=c,m=L.alternate,m!==null&&(m.childLanes|=c),L.tag===22&&(a=L.stateNode,a===null||a._visibility&1||(C=!0)),a=L,L=L.return;return a.tag===3?(L=a.stateNode,C&&o!==null&&(C=31-qn(c),a=L.hiddenUpdates,m=a[C],m===null?a[C]=[o]:m.push(o),o.lane=c|536870912),L):null}function qs(a){if(50<sg)throw sg=0,a_=null,Error(n(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Ys={};function mc(a,o,c,m){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(a,o,c,m){return new mc(a,o,c,m)}function yc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function fo(a,o){var c=a.alternate;return c===null?(c=ha(a.tag,o,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=o,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=a.flags&65011712,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,o=a.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function Wl(a,o){a.flags&=65011714;var c=a.alternate;return c===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,o=c.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Vu(a,o,c,m,C,L){var Z=0;if(m=a,typeof a=="function")yc(a)&&(Z=1);else if(typeof a=="string")Z=dP(a,c,Le.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case J:return a=ha(31,c,o,C),a.elementType=J,a.lanes=L,a;case $:return Il(c.children,C,L,o);case W:Z=8,C|=24;break;case q:return a=ha(12,c,o,C|2),a.elementType=q,a.lanes=L,a;case Ce:return a=ha(13,c,o,C),a.elementType=Ce,a.lanes=L,a;case Ve:return a=ha(19,c,o,C),a.elementType=Ve,a.lanes=L,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case he:Z=10;break e;case ge:Z=9;break e;case me:Z=11;break e;case pe:Z=14;break e;case ee:Z=16,m=null;break e}Z=29,c=Error(n(130,a===null?"null":typeof a,"")),m=null}return o=ha(Z,c,o,C),o.elementType=a,o.type=m,o.lanes=L,o}function Il(a,o,c,m){return a=ha(7,a,m,o),a.lanes=c,a}function zu(a,o,c){return a=ha(6,a,null,o),a.lanes=c,a}function vc(a){var o=ha(18,null,null,0);return o.stateNode=a,o}function _u(a,o,c){return o=ha(4,a.children!==null?a.children:[],a.key,o),o.lanes=c,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var _c=new WeakMap;function Eo(a,o){if(typeof a=="object"&&a!==null){var c=_c.get(a);return c!==void 0?c:(o={value:a,source:o,stack:Tn(o)},_c.set(a,o),o)}return{value:a,source:o,stack:Tn(o)}}var Uu=[],bu=0,sh=null,bc=0,Io=[],Ja=0,ql=null,po=1,ko="";function go(a,o){Uu[bu++]=bc,Uu[bu++]=sh,sh=a,bc=o}function xc(a,o,c){Io[Ja++]=po,Io[Ja++]=ko,Io[Ja++]=ql,ql=a;var m=po;a=ko;var C=32-qn(m)-1;m&=~(1<<C),c+=1;var L=32-qn(o)+C;if(30<L){var Z=C-C%5;L=(m&(1<<Z)-1).toString(32),m>>=Z,C-=Z,po=1<<32-qn(o)+C|c<<C|m,ko=L+a}else po=1<<L|c<<C|m,ko=a}function vd(a){a.return!==null&&(go(a,1),xc(a,1,0))}function ah(a){for(;a===sh;)sh=Uu[--bu],Uu[bu]=null,bc=Uu[--bu],Uu[bu]=null;for(;a===ql;)ql=Io[--Ja],Io[Ja]=null,ko=Io[--Ja],Io[Ja]=null,po=Io[--Ja],Io[Ja]=null}function _d(a,o){Io[Ja++]=po,Io[Ja++]=ko,Io[Ja++]=ql,po=o.id,ko=o.overflow,ql=a}var da=null,Fr=null,bi=!1,Pa=null,rs=!1,O=Error(n(519));function d(a){var o=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw z(Eo(o,a)),O}function g(a){var o=a.stateNode,c=a.type,m=a.memoizedProps;switch(o[qi]=a,o[Yi]=m,c){case"dialog":Gi("cancel",o),Gi("close",o);break;case"iframe":case"object":case"embed":Gi("load",o);break;case"video":case"audio":for(c=0;c<og.length;c++)Gi(og[c],o);break;case"source":Gi("error",o);break;case"img":case"image":case"link":Gi("error",o),Gi("load",o);break;case"details":Gi("toggle",o);break;case"input":Gi("invalid",o),$l(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":Gi("invalid",o);break;case"textarea":Gi("invalid",o),oa(o,m.value,m.defaultValue,m.children)}c=m.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||m.suppressHydrationWarning===!0||K5(o.textContent,c)?(m.popover!=null&&(Gi("beforetoggle",o),Gi("toggle",o)),m.onScroll!=null&&Gi("scroll",o),m.onScrollEnd!=null&&Gi("scrollend",o),m.onClick!=null&&(o.onclick=fn),o=!0):o=!1,o||d(a,!0)}function y(a){for(da=a.return;da;)switch(da.tag){case 5:case 31:case 13:rs=!1;return;case 27:case 3:rs=!0;return;default:da=da.return}}function N(a){if(a!==da)return!1;if(!bi)return y(a),bi=!0,!1;var o=a.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=a.type,c=!(c!=="form"&&c!=="button")||x_(a.type,a.memoizedProps)),c=!c),c&&Fr&&d(a),y(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));Fr=tT(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(317));Fr=tT(a)}else o===27?(o=Fr,bh(a.type)?(a=E_,E_=null,Fr=a):Fr=o):Fr=da?eu(a.stateNode.nextSibling):null;return!0}function D(){Fr=da=null,bi=!1}function F(){var a=Pa;return a!==null&&(fl===null?fl=a:fl.push.apply(fl,a),Pa=null),a}function z(a){Pa===null?Pa=[a]:Pa.push(a)}var P=Ne(null),k=null,R=null;function S(a,o,c){Ee(P,o._currentValue),o._currentValue=c}function T(a){a._currentValue=P.current,se(P)}function G(a,o,c){for(;a!==null;){var m=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),a===c)break;a=a.return}}function te(a,o,c,m){var C=a.child;for(C!==null&&(C.return=a);C!==null;){var L=C.dependencies;if(L!==null){var Z=C.child;L=L.firstContext;e:for(;L!==null;){var Se=L;L=C;for(var Ke=0;Ke<o.length;Ke++)if(Se.context===o[Ke]){L.lanes|=c,Se=L.alternate,Se!==null&&(Se.lanes|=c),G(L.return,c,a),m||(Z=null);break e}L=Se.next}}else if(C.tag===18){if(Z=C.return,Z===null)throw Error(n(341));Z.lanes|=c,L=Z.alternate,L!==null&&(L.lanes|=c),G(Z,c,a),Z=null}else Z=C.child;if(Z!==null)Z.return=C;else for(Z=C;Z!==null;){if(Z===a){Z=null;break}if(C=Z.sibling,C!==null){C.return=Z.return,Z=C;break}Z=Z.return}C=Z}}function Te(a,o,c,m){a=null;for(var C=o,L=!1;C!==null;){if(!L){if((C.flags&524288)!==0)L=!0;else if((C.flags&262144)!==0)break}if(C.tag===10){var Z=C.alternate;if(Z===null)throw Error(n(387));if(Z=Z.memoizedProps,Z!==null){var Se=C.type;Rs(C.pendingProps.value,Z.value)||(a!==null?a.push(Se):a=[Se])}}else if(C===Ye.current){if(Z=C.alternate,Z===null)throw Error(n(387));Z.memoizedState.memoizedState!==C.memoizedState.memoizedState&&(a!==null?a.push(dg):a=[dg])}C=C.return}a!==null&&te(o,a,c,m),o.flags|=262144}function ie(a){for(a=a.firstContext;a!==null;){if(!Rs(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function _e(a){k=a,R=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Y(a){return be(k,a)}function re(a,o){return k===null&&_e(a),be(a,o)}function be(a,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},R===null){if(a===null)throw Error(n(308));R=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else R=R.next=o;return c}var ke=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(c,m){a.push(m)}};this.abort=function(){o.aborted=!0,a.forEach(function(c){return c()})}},rt=i.unstable_scheduleCallback,vt=i.unstable_NormalPriority,Q={$$typeof:he,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function U(){return{controller:new ke,data:new Map,refCount:0}}function Me(a){a.refCount--,a.refCount===0&&rt(vt,function(){a.controller.abort()})}var Fe=null,bt=0,v=0,I=null;function M(a,o){if(Fe===null){var c=Fe=[];bt=0,v=d_(),I={status:"pending",value:void 0,then:function(m){c.push(m)}}}return bt++,o.then(H,H),o}function H(){if(--bt===0&&Fe!==null){I!==null&&(I.status="fulfilled");var a=Fe;Fe=null,v=0,I=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function oe(a,o){var c=[],m={status:"pending",value:null,reason:null,then:function(C){c.push(C)}};return a.then(function(){m.status="fulfilled",m.value=o;for(var C=0;C<c.length;C++)(0,c[C])(o)},function(C){for(m.status="rejected",m.reason=C,C=0;C<c.length;C++)(0,c[C])(void 0)}),m}var de=je.S;je.S=function(a,o){m5=Un(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&M(a,o),de!==null&&de(a,o)};var ue=Ne(null);function ve(){var a=ue.current;return a!==null?a:es.pooledCache}function xe(a,o){o===null?Ee(ue,ue.current):Ee(ue,o.pool)}function Re(){var a=ve();return a===null?null:{parent:Q._currentValue,pool:a}}var Ue=Error(n(460)),Xe=Error(n(474)),Ae=Error(n(542)),Ge={then:function(){}};function et(a){return a=a.status,a==="fulfilled"||a==="rejected"}function ot(a,o,c){switch(c=a[c],c===void 0?a.push(o):c!==o&&(o.then(fn,fn),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Nt(a),a;default:if(typeof o.status=="string")o.then(fn,fn);else{if(a=es,a!==null&&100<a.shellSuspendCounter)throw Error(n(482));a=o,a.status="pending",a.then(function(m){if(o.status==="pending"){var C=o;C.status="fulfilled",C.value=m}},function(m){if(o.status==="pending"){var C=o;C.status="rejected",C.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Nt(a),a}throw gt=o,Ue}}function Ze(a){try{var o=a._init;return o(a._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(gt=c,Ue):c}}var gt=null;function wt(){if(gt===null)throw Error(n(459));var a=gt;return gt=null,a}function Nt(a){if(a===Ue||a===Ae)throw Error(n(483))}var ht=null,Ut=0;function Bt(a){var o=Ut;return Ut+=1,ht===null&&(ht=[]),ot(ht,a,o)}function In(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function nn(a,o){throw o.$$typeof===w?Error(n(525)):(a=Object.prototype.toString.call(o),Error(n(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function xi(a){function o(st,Qe){if(a){var dt=st.deletions;dt===null?(st.deletions=[Qe],st.flags|=16):dt.push(Qe)}}function c(st,Qe){if(!a)return null;for(;Qe!==null;)o(st,Qe),Qe=Qe.sibling;return null}function m(st){for(var Qe=new Map;st!==null;)st.key!==null?Qe.set(st.key,st):Qe.set(st.index,st),st=st.sibling;return Qe}function C(st,Qe){return st=fo(st,Qe),st.index=0,st.sibling=null,st}function L(st,Qe,dt){return st.index=dt,a?(dt=st.alternate,dt!==null?(dt=dt.index,dt<Qe?(st.flags|=67108866,Qe):dt):(st.flags|=67108866,Qe)):(st.flags|=1048576,Qe)}function Z(st){return a&&st.alternate===null&&(st.flags|=67108866),st}function Se(st,Qe,dt,Lt){return Qe===null||Qe.tag!==6?(Qe=zu(dt,st.mode,Lt),Qe.return=st,Qe):(Qe=C(Qe,dt),Qe.return=st,Qe)}function Ke(st,Qe,dt,Lt){var Hn=dt.type;return Hn===$?Ct(st,Qe,dt.props.children,Lt,dt.key):Qe!==null&&(Qe.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===ee&&Ze(Hn)===Qe.type)?(Qe=C(Qe,dt.props),In(Qe,dt),Qe.return=st,Qe):(Qe=Vu(dt.type,dt.key,dt.props,null,st.mode,Lt),In(Qe,dt),Qe.return=st,Qe)}function pt(st,Qe,dt,Lt){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==dt.containerInfo||Qe.stateNode.implementation!==dt.implementation?(Qe=_u(dt,st.mode,Lt),Qe.return=st,Qe):(Qe=C(Qe,dt.children||[]),Qe.return=st,Qe)}function Ct(st,Qe,dt,Lt,Hn){return Qe===null||Qe.tag!==7?(Qe=Il(dt,st.mode,Lt,Hn),Qe.return=st,Qe):(Qe=C(Qe,dt),Qe.return=st,Qe)}function Ot(st,Qe,dt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Qe=zu(""+Qe,st.mode,dt),Qe.return=st,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case A:return dt=Vu(Qe.type,Qe.key,Qe.props,null,st.mode,dt),In(dt,Qe),dt.return=st,dt;case B:return Qe=_u(Qe,st.mode,dt),Qe.return=st,Qe;case ee:return Qe=Ze(Qe),Ot(st,Qe,dt)}if(nt(Qe)||ae(Qe))return Qe=Il(Qe,st.mode,dt,null),Qe.return=st,Qe;if(typeof Qe.then=="function")return Ot(st,Bt(Qe),dt);if(Qe.$$typeof===he)return Ot(st,re(st,Qe),dt);nn(st,Qe)}return null}function yt(st,Qe,dt,Lt){var Hn=Qe!==null?Qe.key:null;if(typeof dt=="string"&&dt!==""||typeof dt=="number"||typeof dt=="bigint")return Hn!==null?null:Se(st,Qe,""+dt,Lt);if(typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case A:return dt.key===Hn?Ke(st,Qe,dt,Lt):null;case B:return dt.key===Hn?pt(st,Qe,dt,Lt):null;case ee:return dt=Ze(dt),yt(st,Qe,dt,Lt)}if(nt(dt)||ae(dt))return Hn!==null?null:Ct(st,Qe,dt,Lt,null);if(typeof dt.then=="function")return yt(st,Qe,Bt(dt),Lt);if(dt.$$typeof===he)return yt(st,Qe,re(st,dt),Lt);nn(st,dt)}return null}function xt(st,Qe,dt,Lt,Hn){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number"||typeof Lt=="bigint")return st=st.get(dt)||null,Se(Qe,st,""+Lt,Hn);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case A:return st=st.get(Lt.key===null?dt:Lt.key)||null,Ke(Qe,st,Lt,Hn);case B:return st=st.get(Lt.key===null?dt:Lt.key)||null,pt(Qe,st,Lt,Hn);case ee:return Lt=Ze(Lt),xt(st,Qe,dt,Lt,Hn)}if(nt(Lt)||ae(Lt))return st=st.get(dt)||null,Ct(Qe,st,Lt,Hn,null);if(typeof Lt.then=="function")return xt(st,Qe,dt,Bt(Lt),Hn);if(Lt.$$typeof===he)return xt(st,Qe,dt,re(Qe,Lt),Hn);nn(Qe,Lt)}return null}function _n(st,Qe,dt,Lt){for(var Hn=null,gr=null,kn=Qe,ki=Qe=0,er=null;kn!==null&&ki<dt.length;ki++){kn.index>ki?(er=kn,kn=null):er=kn.sibling;var mr=yt(st,kn,dt[ki],Lt);if(mr===null){kn===null&&(kn=er);break}a&&kn&&mr.alternate===null&&o(st,kn),Qe=L(mr,Qe,ki),gr===null?Hn=mr:gr.sibling=mr,gr=mr,kn=er}if(ki===dt.length)return c(st,kn),bi&&go(st,ki),Hn;if(kn===null){for(;ki<dt.length;ki++)kn=Ot(st,dt[ki],Lt),kn!==null&&(Qe=L(kn,Qe,ki),gr===null?Hn=kn:gr.sibling=kn,gr=kn);return bi&&go(st,ki),Hn}for(kn=m(kn);ki<dt.length;ki++)er=xt(kn,st,ki,dt[ki],Lt),er!==null&&(a&&er.alternate!==null&&kn.delete(er.key===null?ki:er.key),Qe=L(er,Qe,ki),gr===null?Hn=er:gr.sibling=er,gr=er);return a&&kn.forEach(function(Ah){return o(st,Ah)}),bi&&go(st,ki),Hn}function Yn(st,Qe,dt,Lt){if(dt==null)throw Error(n(151));for(var Hn=null,gr=null,kn=Qe,ki=Qe=0,er=null,mr=dt.next();kn!==null&&!mr.done;ki++,mr=dt.next()){kn.index>ki?(er=kn,kn=null):er=kn.sibling;var Ah=yt(st,kn,mr.value,Lt);if(Ah===null){kn===null&&(kn=er);break}a&&kn&&Ah.alternate===null&&o(st,kn),Qe=L(Ah,Qe,ki),gr===null?Hn=Ah:gr.sibling=Ah,gr=Ah,kn=er}if(mr.done)return c(st,kn),bi&&go(st,ki),Hn;if(kn===null){for(;!mr.done;ki++,mr=dt.next())mr=Ot(st,mr.value,Lt),mr!==null&&(Qe=L(mr,Qe,ki),gr===null?Hn=mr:gr.sibling=mr,gr=mr);return bi&&go(st,ki),Hn}for(kn=m(kn);!mr.done;ki++,mr=dt.next())mr=xt(kn,st,ki,mr.value,Lt),mr!==null&&(a&&mr.alternate!==null&&kn.delete(mr.key===null?ki:mr.key),Qe=L(mr,Qe,ki),gr===null?Hn=mr:gr.sibling=mr,gr=mr);return a&&kn.forEach(function(SP){return o(st,SP)}),bi&&go(st,ki),Hn}function qr(st,Qe,dt,Lt){if(typeof dt=="object"&&dt!==null&&dt.type===$&&dt.key===null&&(dt=dt.props.children),typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case A:e:{for(var Hn=dt.key;Qe!==null;){if(Qe.key===Hn){if(Hn=dt.type,Hn===$){if(Qe.tag===7){c(st,Qe.sibling),Lt=C(Qe,dt.props.children),Lt.return=st,st=Lt;break e}}else if(Qe.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===ee&&Ze(Hn)===Qe.type){c(st,Qe.sibling),Lt=C(Qe,dt.props),In(Lt,dt),Lt.return=st,st=Lt;break e}c(st,Qe);break}else o(st,Qe);Qe=Qe.sibling}dt.type===$?(Lt=Il(dt.props.children,st.mode,Lt,dt.key),Lt.return=st,st=Lt):(Lt=Vu(dt.type,dt.key,dt.props,null,st.mode,Lt),In(Lt,dt),Lt.return=st,st=Lt)}return Z(st);case B:e:{for(Hn=dt.key;Qe!==null;){if(Qe.key===Hn)if(Qe.tag===4&&Qe.stateNode.containerInfo===dt.containerInfo&&Qe.stateNode.implementation===dt.implementation){c(st,Qe.sibling),Lt=C(Qe,dt.children||[]),Lt.return=st,st=Lt;break e}else{c(st,Qe);break}else o(st,Qe);Qe=Qe.sibling}Lt=_u(dt,st.mode,Lt),Lt.return=st,st=Lt}return Z(st);case ee:return dt=Ze(dt),qr(st,Qe,dt,Lt)}if(nt(dt))return _n(st,Qe,dt,Lt);if(ae(dt)){if(Hn=ae(dt),typeof Hn!="function")throw Error(n(150));return dt=Hn.call(dt),Yn(st,Qe,dt,Lt)}if(typeof dt.then=="function")return qr(st,Qe,Bt(dt),Lt);if(dt.$$typeof===he)return qr(st,Qe,re(st,dt),Lt);nn(st,dt)}return typeof dt=="string"&&dt!==""||typeof dt=="number"||typeof dt=="bigint"?(dt=""+dt,Qe!==null&&Qe.tag===6?(c(st,Qe.sibling),Lt=C(Qe,dt),Lt.return=st,st=Lt):(c(st,Qe),Lt=zu(dt,st.mode,Lt),Lt.return=st,st=Lt),Z(st)):c(st,Qe)}return function(st,Qe,dt,Lt){try{Ut=0;var Hn=qr(st,Qe,dt,Lt);return ht=null,Hn}catch(kn){if(kn===Ue||kn===Ae)throw kn;var gr=ha(29,kn,null,st.mode);return gr.lanes=Lt,gr.return=st,gr}finally{}}}var Ui=xi(!0),si=xi(!1),sn=!1;function Ht(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ei(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Dn(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Nn(a,o,c){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(Sr&2)!==0){var C=m.pending;return C===null?o.next=o:(o.next=C.next,C.next=o),m.pending=o,o=qs(a),El(a,null,c),o}return vu(a,m,o,c),qs(a)}function ur(a,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var m=o.lanes;m&=a.pendingLanes,c|=m,o.lanes=c,Or(a,c)}}function ss(a,o){var c=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,c===m)){var C=null,L=null;if(c=c.firstBaseUpdate,c!==null){do{var Z={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};L===null?C=L=Z:L=L.next=Z,c=c.next}while(c!==null);L===null?C=L=o:L=L.next=o}else C=L=o;c={baseState:m.baseState,firstBaseUpdate:C,lastBaseUpdate:L,shared:m.shared,callbacks:m.callbacks},a.updateQueue=c;return}a=c.lastBaseUpdate,a===null?c.firstBaseUpdate=o:a.next=o,c.lastBaseUpdate=o}var An=!1;function pr(){if(An){var a=I;if(a!==null)throw a}}function ws(a,o,c,m){An=!1;var C=a.updateQueue;sn=!1;var L=C.firstBaseUpdate,Z=C.lastBaseUpdate,Se=C.shared.pending;if(Se!==null){C.shared.pending=null;var Ke=Se,pt=Ke.next;Ke.next=null,Z===null?L=pt:Z.next=pt,Z=Ke;var Ct=a.alternate;Ct!==null&&(Ct=Ct.updateQueue,Se=Ct.lastBaseUpdate,Se!==Z&&(Se===null?Ct.firstBaseUpdate=pt:Se.next=pt,Ct.lastBaseUpdate=Ke))}if(L!==null){var Ot=C.baseState;Z=0,Ct=pt=Ke=null,Se=L;do{var yt=Se.lane&-536870913,xt=yt!==Se.lane;if(xt?(Zi&yt)===yt:(m&yt)===yt){yt!==0&&yt===v&&(An=!0),Ct!==null&&(Ct=Ct.next={lane:0,tag:Se.tag,payload:Se.payload,callback:null,next:null});e:{var _n=a,Yn=Se;yt=o;var qr=c;switch(Yn.tag){case 1:if(_n=Yn.payload,typeof _n=="function"){Ot=_n.call(qr,Ot,yt);break e}Ot=_n;break e;case 3:_n.flags=_n.flags&-65537|128;case 0:if(_n=Yn.payload,yt=typeof _n=="function"?_n.call(qr,Ot,yt):_n,yt==null)break e;Ot=p({},Ot,yt);break e;case 2:sn=!0}}yt=Se.callback,yt!==null&&(a.flags|=64,xt&&(a.flags|=8192),xt=C.callbacks,xt===null?C.callbacks=[yt]:xt.push(yt))}else xt={lane:yt,tag:Se.tag,payload:Se.payload,callback:Se.callback,next:null},Ct===null?(pt=Ct=xt,Ke=Ot):Ct=Ct.next=xt,Z|=yt;if(Se=Se.next,Se===null){if(Se=C.shared.pending,Se===null)break;xt=Se,Se=xt.next,xt.next=null,C.lastBaseUpdate=xt,C.shared.pending=null}}while(!0);Ct===null&&(Ke=Ot),C.baseState=Ke,C.firstBaseUpdate=pt,C.lastBaseUpdate=Ct,L===null&&(C.shared.lanes=0),gh|=Z,a.lanes=Z,a.memoizedState=Ot}}function wa(a,o){if(typeof a!="function")throw Error(n(191,a));a.call(o)}function Kr(a,o){var c=a.callbacks;if(c!==null)for(a.callbacks=null,a=0;a<c.length;a++)wa(c[a],o)}var fi=Ne(null),Bi=Ne(0);function sr(a,o){a=Dc,Ee(Bi,a),Ee(fi,o),Dc=a|o.baseLanes}function an(){Ee(Bi,Dc),Ee(fi,fi.current)}function Ds(){Dc=Bi.current,se(fi),se(Bi)}var Lr=Ne(null),_i=null;function ms(a){var o=a.alternate;Ee(Fn,Fn.current&1),Ee(Lr,a),_i===null&&(o===null||fi.current!==null||o.memoizedState!==null)&&(_i=a)}function Ji(a){Ee(Fn,Fn.current),Ee(Lr,a),_i===null&&(_i=a)}function Qr(a){a.tag===22?(Ee(Fn,Fn.current),Ee(Lr,a),_i===null&&(_i=a)):ys()}function ys(){Ee(Fn,Fn.current),Ee(Lr,Lr.current)}function wi(a){se(Lr),_i===a&&(_i=null),se(Fn)}var Fn=Ne(0);function Ls(a){for(var o=a;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||T_(c)||A_(c)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Zr=0,Pn=null,zn=null,Qi=null,Oa=!1,mo=!1,Sa=!1,Ss=0,Yl=0,kl=null,Bu=0;function Yt(){throw Error(n(321))}function Yo(a,o){if(o===null)return!1;for(var c=0;c<o.length&&c<a.length;c++)if(!Rs(a[c],o[c]))return!1;return!0}function $u(a,o,c,m,C,L){return Zr=L,Pn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,je.H=a===null||a.memoizedState===null?IS:Ov,Sa=!1,L=c(m,C),Sa=!1,mo&&(L=Cl(o,c,m,C)),wc(a),L}function wc(a){je.H=Xp;var o=zn!==null&&zn.next!==null;if(Zr=0,Qi=zn=Pn=null,Oa=!1,Yl=0,kl=null,o)throw Error(n(300));a===null||Ta||(a=a.dependencies,a!==null&&ie(a)&&(Ta=!0))}function Cl(a,o,c,m){Pn=a;var C=0;do{if(mo&&(kl=null),Yl=0,mo=!1,25<=C)throw Error(n(301));if(C+=1,Qi=zn=null,a.updateQueue!=null){var L=a.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}je.H=kS,L=o(c,m)}while(mo);return L}function qp(){var a=je.H,o=a.useState()[0];return o=typeof o.then=="function"?Rl(o):o,a=a.useState()[0],(zn!==null?zn.memoizedState:null)!==a&&(Pn.flags|=1024),o}function oh(){var a=Ss!==0;return Ss=0,a}function bd(a,o,c){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~c}function lh(a){if(Oa){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Oa=!1}Zr=0,Qi=zn=Pn=null,mo=!1,Yl=Ss=0,kl=null}function Ns(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qi===null?Pn.memoizedState=Qi=a:Qi=Qi.next=a,Qi}function as(){if(zn===null){var a=Pn.alternate;a=a!==null?a.memoizedState:null}else a=zn.next;var o=Qi===null?Pn.memoizedState:Qi.next;if(o!==null)Qi=o,zn=a;else{if(a===null)throw Pn.alternate===null?Error(n(467)):Error(n(310));zn=a,a={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},Qi===null?Pn.memoizedState=Qi=a:Qi=Qi.next=a}return Qi}function Xl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rl(a){var o=Yl;return Yl+=1,kl===null&&(kl=[]),a=ot(kl,a,o),o=Pn,(Qi===null?o.memoizedState:Qi.next)===null&&(o=o.alternate,je.H=o===null||o.memoizedState===null?IS:Ov),a}function xu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Rl(a);if(a.$$typeof===he)return Y(a)}throw Error(n(438,String(a)))}function Jl(a){var o=null,c=Pn.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var m=Pn.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(C){return C.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=Xl(),Pn.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(a),m=0;m<a;m++)c[m]=ye;return o.index++,c}function yo(a,o){return typeof o=="function"?o(a):o}function Si(a){var o=as();return Ql(o,zn,a)}function Ql(a,o,c){var m=a.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=c;var C=a.baseQueue,L=m.pending;if(L!==null){if(C!==null){var Z=C.next;C.next=L.next,L.next=Z}o.baseQueue=C=L,m.pending=null}if(L=a.baseState,C===null)a.memoizedState=L;else{o=C.next;var Se=Z=null,Ke=null,pt=o,Ct=!1;do{var Ot=pt.lane&-536870913;if(Ot!==pt.lane?(Zi&Ot)===Ot:(Zr&Ot)===Ot){var yt=pt.revertLane;if(yt===0)Ke!==null&&(Ke=Ke.next={lane:0,revertLane:0,gesture:null,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null}),Ot===v&&(Ct=!0);else if((Zr&yt)===yt){pt=pt.next,yt===v&&(Ct=!0);continue}else Ot={lane:0,revertLane:pt.revertLane,gesture:null,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null},Ke===null?(Se=Ke=Ot,Z=L):Ke=Ke.next=Ot,Pn.lanes|=yt,gh|=yt;Ot=pt.action,Sa&&c(L,Ot),L=pt.hasEagerState?pt.eagerState:c(L,Ot)}else yt={lane:Ot,revertLane:pt.revertLane,gesture:pt.gesture,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null},Ke===null?(Se=Ke=yt,Z=L):Ke=Ke.next=yt,Pn.lanes|=Ot,gh|=Ot;pt=pt.next}while(pt!==null&&pt!==o);if(Ke===null?Z=L:Ke.next=Se,!Rs(L,a.memoizedState)&&(Ta=!0,Ct&&(c=I,c!==null)))throw c;a.memoizedState=L,a.baseState=Z,a.baseQueue=Ke,m.lastRenderedState=L}return C===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Sc(a){var o=as(),c=o.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=a;var m=c.dispatch,C=c.pending,L=o.memoizedState;if(C!==null){c.pending=null;var Z=C=C.next;do L=a(L,Z.action),Z=Z.next;while(Z!==C);Rs(L,o.memoizedState)||(Ta=!0),o.memoizedState=L,o.baseQueue===null&&(o.baseState=L),c.lastRenderedState=L}return[L,m]}function Tc(a,o,c){var m=Pn,C=as(),L=bi;if(L){if(c===void 0)throw Error(n(407));c=c()}else c=o();var Z=!Rs((zn||C).memoizedState,c);if(Z&&(C.memoizedState=c,Ta=!0),C=C.queue,Cv(wd.bind(null,m,C,a),[a]),C.getSnapshot!==o||Z||Qi!==null&&Qi.memoizedState.tag&1){if(m.flags|=2048,Zl(9,{destroy:void 0},xd.bind(null,m,C,c,o),null),es===null)throw Error(n(349));L||(Zr&127)!==0||Dl(m,o,c)}return c}function Dl(a,o,c){a.flags|=16384,a={getSnapshot:o,value:c},o=Pn.updateQueue,o===null?(o=Xl(),Pn.updateQueue=o,o.stores=[a]):(c=o.stores,c===null?o.stores=[a]:c.push(a))}function xd(a,o,c,m){o.value=c,o.getSnapshot=m,_(o)&&V(a)}function wd(a,o,c){return c(function(){_(o)&&V(a)})}function _(a){var o=a.getSnapshot;a=a.value;try{var c=o();return!Rs(a,c)}catch{return!0}}function V(a){var o=ho(a,2);o!==null&&pl(o,a,2)}function ce(a){var o=Ns();if(typeof a=="function"){var c=a;if(a=c(),Sa){On(!0);try{c()}finally{On(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:a},o}function De(a,o,c,m){return a.baseState=c,Ql(a,zn,typeof m=="function"?m:yo)}function $e(a,o,c,m,C){if(ly(a))throw Error(n(485));if(a=o.action,a!==null){var L={payload:C,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Z){L.listeners.push(Z)}};je.T!==null?c(!0):L.isTransition=!1,m(L),c=o.pending,c===null?(L.next=o.pending=L,mt(o,L)):(L.next=c.next,o.pending=c.next=L)}}function mt(a,o){var c=o.action,m=o.payload,C=a.state;if(o.isTransition){var L=je.T,Z={};je.T=Z;try{var Se=c(C,m),Ke=je.S;Ke!==null&&Ke(Z,Se),Dt(a,o,Se)}catch(pt){Ln(a,o,pt)}finally{L!==null&&Z.types!==null&&(L.types=Z.types),je.T=L}}else try{L=c(C,m),Dt(a,o,L)}catch(pt){Ln(a,o,pt)}}function Dt(a,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(m){Zt(a,o,m)},function(m){return Ln(a,o,m)}):Zt(a,o,c)}function Zt(a,o,c){o.status="fulfilled",o.value=c,$i(o),a.state=c,o=a.pending,o!==null&&(c=o.next,c===o?a.pending=null:(c=c.next,o.next=c,mt(a,c)))}function Ln(a,o,c){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=c,$i(o),o=o.next;while(o!==m)}a.action=null}function $i(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function Xs(a,o){return o}function Js(a,o){if(bi){var c=es.formState;if(c!==null){e:{var m=Pn;if(bi){if(Fr){t:{for(var C=Fr,L=rs;C.nodeType!==8;){if(!L){C=null;break t}if(C=eu(C.nextSibling),C===null){C=null;break t}}L=C.data,C=L==="F!"||L==="F"?C:null}if(C){Fr=eu(C.nextSibling),m=C.data==="F!";break e}}d(m)}m=!1}m&&(o=c[0])}}return c=Ns(),c.memoizedState=c.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xs,lastRenderedState:o},c.queue=m,c=TS.bind(null,Pn,m),m.dispatch=c,m=ce(!1),L=Pv.bind(null,Pn,!1,m.queue),m=Ns(),C={state:o,dispatch:null,action:a,pending:null},m.queue=C,c=$e.bind(null,Pn,C,L,c),C.dispatch=c,m.memoizedState=a,[o,c,!1]}function Qa(a){var o=as();return Ma(o,zn,a)}function Ma(a,o,c){if(o=Ql(a,o,Xs)[0],a=Si(yo)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=Rl(o)}catch(Z){throw Z===Ue?Ae:Z}else m=o;o=as();var C=o.queue,L=C.dispatch;return c!==o.memoizedState&&(Pn.flags|=2048,Zl(9,{destroy:void 0},uh.bind(null,C,c),null)),[m,L,a]}function uh(a,o){a.action=o}function ch(a){var o=as(),c=zn;if(c!==null)return Ma(o,c,a);as(),o=o.memoizedState,c=as();var m=c.queue.dispatch;return c.memoizedState=a,[o,m,!1]}function Zl(a,o,c,m){return a={tag:a,create:c,deps:m,inst:o,next:null},o=Pn.updateQueue,o===null&&(o=Xl(),Pn.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=a.next=a:(m=c.next,c.next=a,a.next=m,o.lastEffect=a),a}function oy(){return as().memoizedState}function hh(a,o,c,m){var C=Ns();Pn.flags|=a,C.memoizedState=Zl(1|o,{destroy:void 0},c,m===void 0?null:m)}function dh(a,o,c,m){var C=as();m=m===void 0?null:m;var L=C.memoizedState.inst;zn!==null&&m!==null&&Yo(m,zn.memoizedState.deps)?C.memoizedState=Zl(o,L,c,m):(Pn.flags|=a,C.memoizedState=Zl(1|o,L,c,m))}function cS(a,o){hh(8390656,8,a,o)}function Cv(a,o){dh(2048,8,a,o)}function yN(a){Pn.flags|=4;var o=Pn.updateQueue;if(o===null)o=Xl(),Pn.updateQueue=o,o.events=[a];else{var c=o.events;c===null?o.events=[a]:c.push(a)}}function hS(a){var o=as().memoizedState;return yN({ref:o,nextImpl:a}),function(){if((Sr&2)!==0)throw Error(n(440));return o.impl.apply(void 0,arguments)}}function dS(a,o){return dh(4,2,a,o)}function fS(a,o){return dh(4,4,a,o)}function pS(a,o){if(typeof o=="function"){a=a();var c=o(a);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function gS(a,o,c){c=c!=null?c.concat([a]):null,dh(4,4,pS.bind(null,o,a),c)}function Rv(){}function mS(a,o){var c=as();o=o===void 0?null:o;var m=c.memoizedState;return o!==null&&Yo(o,m[1])?m[0]:(c.memoizedState=[a,o],a)}function yS(a,o){var c=as();o=o===void 0?null:o;var m=c.memoizedState;if(o!==null&&Yo(o,m[1]))return m[0];if(m=a(),Sa){On(!0);try{a()}finally{On(!1)}}return c.memoizedState=[m,o],m}function Dv(a,o,c){return c===void 0||(Zr&1073741824)!==0&&(Zi&261930)===0?a.memoizedState=o:(a.memoizedState=c,a=v5(),Pn.lanes|=a,gh|=a,c)}function vS(a,o,c,m){return Rs(c,o)?c:fi.current!==null?(a=Dv(a,c,m),Rs(a,o)||(Ta=!0),a):(Zr&42)===0||(Zr&1073741824)!==0&&(Zi&261930)===0?(Ta=!0,a.memoizedState=c):(a=v5(),Pn.lanes|=a,gh|=a,o)}function _S(a,o,c,m,C){var L=Je.p;Je.p=L!==0&&8>L?L:8;var Z=je.T,Se={};je.T=Se,Pv(a,!1,o,c);try{var Ke=C(),pt=je.S;if(pt!==null&&pt(Se,Ke),Ke!==null&&typeof Ke=="object"&&typeof Ke.then=="function"){var Ct=oe(Ke,m);Yp(a,o,Ct,Pl(a))}else Yp(a,o,m,Pl(a))}catch(Ot){Yp(a,o,{then:function(){},status:"rejected",reason:Ot},Pl())}finally{Je.p=L,Z!==null&&Se.types!==null&&(Z.types=Se.types),je.T=Z}}function vN(){}function Lv(a,o,c,m){if(a.tag!==5)throw Error(n(476));var C=bS(a).queue;_S(a,C,o,qe,c===null?vN:function(){return xS(a),c(m)})}function bS(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:qe,baseState:qe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:qe},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:c},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function xS(a){var o=bS(a);o.next===null&&(o=a.alternate.memoizedState),Yp(a,o.next.queue,{},Pl())}function Nv(){return Y(dg)}function wS(){return as().memoizedState}function SS(){return as().memoizedState}function _N(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var c=Pl();a=Dn(c);var m=Nn(o,a,c);m!==null&&(pl(m,o,c),ur(m,o,c)),o={cache:U()},a.payload=o;return}o=o.return}}function bN(a,o,c){var m=Pl();c={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},ly(a)?AS(o,c):(c=Al(a,o,c,m),c!==null&&(pl(c,a,m),ES(c,o,m)))}function TS(a,o,c){var m=Pl();Yp(a,o,c,m)}function Yp(a,o,c,m){var C={lane:m,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(ly(a))AS(o,C);else{var L=a.alternate;if(a.lanes===0&&(L===null||L.lanes===0)&&(L=o.lastRenderedReducer,L!==null))try{var Z=o.lastRenderedState,Se=L(Z,c);if(C.hasEagerState=!0,C.eagerState=Se,Rs(Se,Z))return vu(a,o,C,0),es===null&&yu(),!1}catch{}finally{}if(c=Al(a,o,C,m),c!==null)return pl(c,a,m),ES(c,o,m),!0}return!1}function Pv(a,o,c,m){if(m={lane:2,revertLane:d_(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},ly(a)){if(o)throw Error(n(479))}else o=Al(a,c,m,2),o!==null&&pl(o,a,2)}function ly(a){var o=a.alternate;return a===Pn||o!==null&&o===Pn}function AS(a,o){mo=Oa=!0;var c=a.pending;c===null?o.next=o:(o.next=c.next,c.next=o),a.pending=o}function ES(a,o,c){if((c&4194048)!==0){var m=o.lanes;m&=a.pendingLanes,c|=m,o.lanes=c,Or(a,c)}}var Xp={readContext:Y,use:xu,useCallback:Yt,useContext:Yt,useEffect:Yt,useImperativeHandle:Yt,useLayoutEffect:Yt,useInsertionEffect:Yt,useMemo:Yt,useReducer:Yt,useRef:Yt,useState:Yt,useDebugValue:Yt,useDeferredValue:Yt,useTransition:Yt,useSyncExternalStore:Yt,useId:Yt,useHostTransitionStatus:Yt,useFormState:Yt,useActionState:Yt,useOptimistic:Yt,useMemoCache:Yt,useCacheRefresh:Yt};Xp.useEffectEvent=Yt;var IS={readContext:Y,use:xu,useCallback:function(a,o){return Ns().memoizedState=[a,o===void 0?null:o],a},useContext:Y,useEffect:cS,useImperativeHandle:function(a,o,c){c=c!=null?c.concat([a]):null,hh(4194308,4,pS.bind(null,o,a),c)},useLayoutEffect:function(a,o){return hh(4194308,4,a,o)},useInsertionEffect:function(a,o){hh(4,2,a,o)},useMemo:function(a,o){var c=Ns();o=o===void 0?null:o;var m=a();if(Sa){On(!0);try{a()}finally{On(!1)}}return c.memoizedState=[m,o],m},useReducer:function(a,o,c){var m=Ns();if(c!==void 0){var C=c(o);if(Sa){On(!0);try{c(o)}finally{On(!1)}}}else C=o;return m.memoizedState=m.baseState=C,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:C},m.queue=a,a=a.dispatch=bN.bind(null,Pn,a),[m.memoizedState,a]},useRef:function(a){var o=Ns();return a={current:a},o.memoizedState=a},useState:function(a){a=ce(a);var o=a.queue,c=TS.bind(null,Pn,o);return o.dispatch=c,[a.memoizedState,c]},useDebugValue:Rv,useDeferredValue:function(a,o){var c=Ns();return Dv(c,a,o)},useTransition:function(){var a=ce(!1);return a=_S.bind(null,Pn,a.queue,!0,!1),Ns().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,c){var m=Pn,C=Ns();if(bi){if(c===void 0)throw Error(n(407));c=c()}else{if(c=o(),es===null)throw Error(n(349));(Zi&127)!==0||Dl(m,o,c)}C.memoizedState=c;var L={value:c,getSnapshot:o};return C.queue=L,cS(wd.bind(null,m,L,a),[a]),m.flags|=2048,Zl(9,{destroy:void 0},xd.bind(null,m,L,c,o),null),c},useId:function(){var a=Ns(),o=es.identifierPrefix;if(bi){var c=ko,m=po;c=(m&~(1<<32-qn(m)-1)).toString(32)+c,o="_"+o+"R_"+c,c=Ss++,0<c&&(o+="H"+c.toString(32)),o+="_"}else c=Bu++,o="_"+o+"r_"+c.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Nv,useFormState:Js,useActionState:Js,useOptimistic:function(a){var o=Ns();o.memoizedState=o.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=Pv.bind(null,Pn,!0,c),c.dispatch=o,[a,o]},useMemoCache:Jl,useCacheRefresh:function(){return Ns().memoizedState=_N.bind(null,Pn)},useEffectEvent:function(a){var o=Ns(),c={impl:a};return o.memoizedState=c,function(){if((Sr&2)!==0)throw Error(n(440));return c.impl.apply(void 0,arguments)}}},Ov={readContext:Y,use:xu,useCallback:mS,useContext:Y,useEffect:Cv,useImperativeHandle:gS,useInsertionEffect:dS,useLayoutEffect:fS,useMemo:yS,useReducer:Si,useRef:oy,useState:function(){return Si(yo)},useDebugValue:Rv,useDeferredValue:function(a,o){var c=as();return vS(c,zn.memoizedState,a,o)},useTransition:function(){var a=Si(yo)[0],o=as().memoizedState;return[typeof a=="boolean"?a:Rl(a),o]},useSyncExternalStore:Tc,useId:wS,useHostTransitionStatus:Nv,useFormState:Qa,useActionState:Qa,useOptimistic:function(a,o){var c=as();return De(c,zn,a,o)},useMemoCache:Jl,useCacheRefresh:SS};Ov.useEffectEvent=hS;var kS={readContext:Y,use:xu,useCallback:mS,useContext:Y,useEffect:Cv,useImperativeHandle:gS,useInsertionEffect:dS,useLayoutEffect:fS,useMemo:yS,useReducer:Sc,useRef:oy,useState:function(){return Sc(yo)},useDebugValue:Rv,useDeferredValue:function(a,o){var c=as();return zn===null?Dv(c,a,o):vS(c,zn.memoizedState,a,o)},useTransition:function(){var a=Sc(yo)[0],o=as().memoizedState;return[typeof a=="boolean"?a:Rl(a),o]},useSyncExternalStore:Tc,useId:wS,useHostTransitionStatus:Nv,useFormState:ch,useActionState:ch,useOptimistic:function(a,o){var c=as();return zn!==null?De(c,zn,a,o):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:Jl,useCacheRefresh:SS};kS.useEffectEvent=hS;function Mv(a,o,c,m){o=a.memoizedState,c=c(m,o),c=c==null?o:p({},o,c),a.memoizedState=c,a.lanes===0&&(a.updateQueue.baseState=c)}var Fv={enqueueSetState:function(a,o,c){a=a._reactInternals;var m=Pl(),C=Dn(m);C.payload=o,c!=null&&(C.callback=c),o=Nn(a,C,m),o!==null&&(pl(o,a,m),ur(o,a,m))},enqueueReplaceState:function(a,o,c){a=a._reactInternals;var m=Pl(),C=Dn(m);C.tag=1,C.payload=o,c!=null&&(C.callback=c),o=Nn(a,C,m),o!==null&&(pl(o,a,m),ur(o,a,m))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var c=Pl(),m=Dn(c);m.tag=2,o!=null&&(m.callback=o),o=Nn(a,m,c),o!==null&&(pl(o,a,c),ur(o,a,c))}};function CS(a,o,c,m,C,L,Z){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,L,Z):o.prototype&&o.prototype.isPureReactComponent?!Tl(c,m)||!Tl(C,L):!0}function RS(a,o,c,m){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,m),o.state!==a&&Fv.enqueueReplaceState(o,o.state,null)}function Sd(a,o){var c=o;if("ref"in o){c={};for(var m in o)m!=="ref"&&(c[m]=o[m])}if(a=a.defaultProps){c===o&&(c=p({},c));for(var C in a)c[C]===void 0&&(c[C]=a[C])}return c}function DS(a){Kl(a)}function LS(a){console.error(a)}function NS(a){Kl(a)}function uy(a,o){try{var c=a.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function PS(a,o,c){try{var m=a.onCaughtError;m(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(C){setTimeout(function(){throw C})}}function jv(a,o,c){return c=Dn(c),c.tag=3,c.payload={element:null},c.callback=function(){uy(a,o)},c}function OS(a){return a=Dn(a),a.tag=3,a}function MS(a,o,c,m){var C=c.type.getDerivedStateFromError;if(typeof C=="function"){var L=m.value;a.payload=function(){return C(L)},a.callback=function(){PS(o,c,m)}}var Z=c.stateNode;Z!==null&&typeof Z.componentDidCatch=="function"&&(a.callback=function(){PS(o,c,m),typeof C!="function"&&(mh===null?mh=new Set([this]):mh.add(this));var Se=m.stack;this.componentDidCatch(m.value,{componentStack:Se!==null?Se:""})})}function xN(a,o,c,m,C){if(c.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=c.alternate,o!==null&&Te(o,c,C,!0),c=Lr.current,c!==null){switch(c.tag){case 31:case 13:return _i===null?xy():c.alternate===null&&Qs===0&&(Qs=3),c.flags&=-257,c.flags|=65536,c.lanes=C,m===Ge?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([m]):o.add(m),u_(a,m,C)),!1;case 22:return c.flags|=65536,m===Ge?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([m]):c.add(m)),u_(a,m,C)),!1}throw Error(n(435,c.tag))}return u_(a,m,C),xy(),!1}if(bi)return o=Lr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=C,m!==O&&(a=Error(n(422),{cause:m}),z(Eo(a,c)))):(m!==O&&(o=Error(n(423),{cause:m}),z(Eo(o,c))),a=a.current.alternate,a.flags|=65536,C&=-C,a.lanes|=C,m=Eo(m,c),C=jv(a.stateNode,m,C),ss(a,C),Qs!==4&&(Qs=2)),!1;var L=Error(n(520),{cause:m});if(L=Eo(L,c),rg===null?rg=[L]:rg.push(L),Qs!==4&&(Qs=2),o===null)return!0;m=Eo(m,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,a=C&-C,c.lanes|=a,a=jv(c.stateNode,m,a),ss(c,a),!1;case 1:if(o=c.type,L=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(mh===null||!mh.has(L))))return c.flags|=65536,C&=-C,c.lanes|=C,C=OS(C),MS(C,a,c,m),ss(c,C),!1}c=c.return}while(c!==null);return!1}var Vv=Error(n(461)),Ta=!1;function vo(a,o,c,m){o.child=a===null?si(o,null,c,m):Ui(o,a.child,c,m)}function FS(a,o,c,m,C){c=c.render;var L=o.ref;if("ref"in m){var Z={};for(var Se in m)Se!=="ref"&&(Z[Se]=m[Se])}else Z=m;return _e(o),m=$u(a,o,c,Z,L,C),Se=oh(),a!==null&&!Ta?(bd(a,o,C),Ac(a,o,C)):(bi&&Se&&vd(o),o.flags|=1,vo(a,o,m,C),o.child)}function jS(a,o,c,m,C){if(a===null){var L=c.type;return typeof L=="function"&&!yc(L)&&L.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=L,VS(a,o,L,m,C)):(a=Vu(c.type,null,m,o,o.mode,C),a.ref=o.ref,a.return=o,o.child=a)}if(L=a.child,!Wv(a,C)){var Z=L.memoizedProps;if(c=c.compare,c=c!==null?c:Tl,c(Z,m)&&a.ref===o.ref)return Ac(a,o,C)}return o.flags|=1,a=fo(L,m),a.ref=o.ref,a.return=o,o.child=a}function VS(a,o,c,m,C){if(a!==null){var L=a.memoizedProps;if(Tl(L,m)&&a.ref===o.ref)if(Ta=!1,o.pendingProps=m=L,Wv(a,C))(a.flags&131072)!==0&&(Ta=!0);else return o.lanes=a.lanes,Ac(a,o,C)}return zv(a,o,c,m,C)}function zS(a,o,c,m){var C=m.children,L=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((o.flags&128)!==0){if(L=L!==null?L.baseLanes|c:c,a!==null){for(m=o.child=a.child,C=0;m!==null;)C=C|m.lanes|m.childLanes,m=m.sibling;m=C&~L}else m=0,o.child=null;return US(a,o,L,c,m)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&xe(o,L!==null?L.cachePool:null),L!==null?sr(o,L):an(),Qr(o);else return m=o.lanes=536870912,US(a,o,L!==null?L.baseLanes|c:c,c,m)}else L!==null?(xe(o,L.cachePool),sr(o,L),ys(),o.memoizedState=null):(a!==null&&xe(o,null),an(),ys());return vo(a,o,C,c),o.child}function Jp(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function US(a,o,c,m,C){var L=ve();return L=L===null?null:{parent:Q._currentValue,pool:L},o.memoizedState={baseLanes:c,cachePool:L},a!==null&&xe(o,null),an(),Qr(o),a!==null&&Te(a,o,m,!0),o.childLanes=C,null}function cy(a,o){return o=dy({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function BS(a,o,c){return Ui(o,a.child,null,c),a=cy(o,o.pendingProps),a.flags|=2,wi(o),o.memoizedState=null,a}function wN(a,o,c){var m=o.pendingProps,C=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(bi){if(m.mode==="hidden")return a=cy(o,m),o.lanes=536870912,Jp(null,a);if(Ji(o),(a=Fr)?(a=eT(a,rs),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:ql!==null?{id:po,overflow:ko}:null,retryLane:536870912,hydrationErrors:null},c=vc(a),c.return=o,o.child=c,da=o,Fr=null)):a=null,a===null)throw d(o);return o.lanes=536870912,null}return cy(o,m)}var L=a.memoizedState;if(L!==null){var Z=L.dehydrated;if(Ji(o),C)if(o.flags&256)o.flags&=-257,o=BS(a,o,c);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(n(558));else if(Ta||Te(a,o,c,!1),C=(c&a.childLanes)!==0,Ta||C){if(m=es,m!==null&&(Z=bs(m,c),Z!==0&&Z!==L.retryLane))throw L.retryLane=Z,ho(a,Z),pl(m,a,Z),Vv;xy(),o=BS(a,o,c)}else a=L.treeContext,Fr=eu(Z.nextSibling),da=o,bi=!0,Pa=null,rs=!1,a!==null&&_d(o,a),o=cy(o,m),o.flags|=4096;return o}return a=fo(a.child,{mode:m.mode,children:m.children}),a.ref=o.ref,o.child=a,a.return=o,a}function hy(a,o){var c=o.ref;if(c===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(n(284));(a===null||a.ref!==c)&&(o.flags|=4194816)}}function zv(a,o,c,m,C){return _e(o),c=$u(a,o,c,m,void 0,C),m=oh(),a!==null&&!Ta?(bd(a,o,C),Ac(a,o,C)):(bi&&m&&vd(o),o.flags|=1,vo(a,o,c,C),o.child)}function $S(a,o,c,m,C,L){return _e(o),o.updateQueue=null,c=Cl(o,m,c,C),wc(a),m=oh(),a!==null&&!Ta?(bd(a,o,L),Ac(a,o,L)):(bi&&m&&vd(o),o.flags|=1,vo(a,o,c,L),o.child)}function HS(a,o,c,m,C){if(_e(o),o.stateNode===null){var L=Ys,Z=c.contextType;typeof Z=="object"&&Z!==null&&(L=Y(Z)),L=new c(m,L),o.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=Fv,o.stateNode=L,L._reactInternals=o,L=o.stateNode,L.props=m,L.state=o.memoizedState,L.refs={},Ht(o),Z=c.contextType,L.context=typeof Z=="object"&&Z!==null?Y(Z):Ys,L.state=o.memoizedState,Z=c.getDerivedStateFromProps,typeof Z=="function"&&(Mv(o,c,Z,m),L.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(Z=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),Z!==L.state&&Fv.enqueueReplaceState(L,L.state,null),ws(o,m,L,C),pr(),L.state=o.memoizedState),typeof L.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(a===null){L=o.stateNode;var Se=o.memoizedProps,Ke=Sd(c,Se);L.props=Ke;var pt=L.context,Ct=c.contextType;Z=Ys,typeof Ct=="object"&&Ct!==null&&(Z=Y(Ct));var Ot=c.getDerivedStateFromProps;Ct=typeof Ot=="function"||typeof L.getSnapshotBeforeUpdate=="function",Se=o.pendingProps!==Se,Ct||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(Se||pt!==Z)&&RS(o,L,m,Z),sn=!1;var yt=o.memoizedState;L.state=yt,ws(o,m,L,C),pr(),pt=o.memoizedState,Se||yt!==pt||sn?(typeof Ot=="function"&&(Mv(o,c,Ot,m),pt=o.memoizedState),(Ke=sn||CS(o,c,Ke,m,yt,pt,Z))?(Ct||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(o.flags|=4194308)):(typeof L.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=pt),L.props=m,L.state=pt,L.context=Z,m=Ke):(typeof L.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{L=o.stateNode,ei(a,o),Z=o.memoizedProps,Ct=Sd(c,Z),L.props=Ct,Ot=o.pendingProps,yt=L.context,pt=c.contextType,Ke=Ys,typeof pt=="object"&&pt!==null&&(Ke=Y(pt)),Se=c.getDerivedStateFromProps,(pt=typeof Se=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(Z!==Ot||yt!==Ke)&&RS(o,L,m,Ke),sn=!1,yt=o.memoizedState,L.state=yt,ws(o,m,L,C),pr();var xt=o.memoizedState;Z!==Ot||yt!==xt||sn||a!==null&&a.dependencies!==null&&ie(a.dependencies)?(typeof Se=="function"&&(Mv(o,c,Se,m),xt=o.memoizedState),(Ct=sn||CS(o,c,Ct,m,yt,xt,Ke)||a!==null&&a.dependencies!==null&&ie(a.dependencies))?(pt||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(m,xt,Ke),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(m,xt,Ke)),typeof L.componentDidUpdate=="function"&&(o.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof L.componentDidUpdate!="function"||Z===a.memoizedProps&&yt===a.memoizedState||(o.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||Z===a.memoizedProps&&yt===a.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=xt),L.props=m,L.state=xt,L.context=Ke,m=Ct):(typeof L.componentDidUpdate!="function"||Z===a.memoizedProps&&yt===a.memoizedState||(o.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||Z===a.memoizedProps&&yt===a.memoizedState||(o.flags|=1024),m=!1)}return L=m,hy(a,o),m=(o.flags&128)!==0,L||m?(L=o.stateNode,c=m&&typeof c.getDerivedStateFromError!="function"?null:L.render(),o.flags|=1,a!==null&&m?(o.child=Ui(o,a.child,null,C),o.child=Ui(o,null,c,C)):vo(a,o,c,C),o.memoizedState=L.state,a=o.child):a=Ac(a,o,C),a}function GS(a,o,c,m){return D(),o.flags|=256,vo(a,o,c,m),o.child}var Uv={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bv(a){return{baseLanes:a,cachePool:Re()}}function $v(a,o,c){return a=a!==null?a.childLanes&~c:0,o&&(a|=Nl),a}function KS(a,o,c){var m=o.pendingProps,C=!1,L=(o.flags&128)!==0,Z;if((Z=L)||(Z=a!==null&&a.memoizedState===null?!1:(Fn.current&2)!==0),Z&&(C=!0,o.flags&=-129),Z=(o.flags&32)!==0,o.flags&=-33,a===null){if(bi){if(C?ms(o):ys(),(a=Fr)?(a=eT(a,rs),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:ql!==null?{id:po,overflow:ko}:null,retryLane:536870912,hydrationErrors:null},c=vc(a),c.return=o,o.child=c,da=o,Fr=null)):a=null,a===null)throw d(o);return A_(a)?o.lanes=32:o.lanes=536870912,null}var Se=m.children;return m=m.fallback,C?(ys(),C=o.mode,Se=dy({mode:"hidden",children:Se},C),m=Il(m,C,c,null),Se.return=o,m.return=o,Se.sibling=m,o.child=Se,m=o.child,m.memoizedState=Bv(c),m.childLanes=$v(a,Z,c),o.memoizedState=Uv,Jp(null,m)):(ms(o),Hv(o,Se))}var Ke=a.memoizedState;if(Ke!==null&&(Se=Ke.dehydrated,Se!==null)){if(L)o.flags&256?(ms(o),o.flags&=-257,o=Gv(a,o,c)):o.memoizedState!==null?(ys(),o.child=a.child,o.flags|=128,o=null):(ys(),Se=m.fallback,C=o.mode,m=dy({mode:"visible",children:m.children},C),Se=Il(Se,C,c,null),Se.flags|=2,m.return=o,Se.return=o,m.sibling=Se,o.child=m,Ui(o,a.child,null,c),m=o.child,m.memoizedState=Bv(c),m.childLanes=$v(a,Z,c),o.memoizedState=Uv,o=Jp(null,m));else if(ms(o),A_(Se)){if(Z=Se.nextSibling&&Se.nextSibling.dataset,Z)var pt=Z.dgst;Z=pt,m=Error(n(419)),m.stack="",m.digest=Z,z({value:m,source:null,stack:null}),o=Gv(a,o,c)}else if(Ta||Te(a,o,c,!1),Z=(c&a.childLanes)!==0,Ta||Z){if(Z=es,Z!==null&&(m=bs(Z,c),m!==0&&m!==Ke.retryLane))throw Ke.retryLane=m,ho(a,m),pl(Z,a,m),Vv;T_(Se)||xy(),o=Gv(a,o,c)}else T_(Se)?(o.flags|=192,o.child=a.child,o=null):(a=Ke.treeContext,Fr=eu(Se.nextSibling),da=o,bi=!0,Pa=null,rs=!1,a!==null&&_d(o,a),o=Hv(o,m.children),o.flags|=4096);return o}return C?(ys(),Se=m.fallback,C=o.mode,Ke=a.child,pt=Ke.sibling,m=fo(Ke,{mode:"hidden",children:m.children}),m.subtreeFlags=Ke.subtreeFlags&65011712,pt!==null?Se=fo(pt,Se):(Se=Il(Se,C,c,null),Se.flags|=2),Se.return=o,m.return=o,m.sibling=Se,o.child=m,Jp(null,m),m=o.child,Se=a.child.memoizedState,Se===null?Se=Bv(c):(C=Se.cachePool,C!==null?(Ke=Q._currentValue,C=C.parent!==Ke?{parent:Ke,pool:Ke}:C):C=Re(),Se={baseLanes:Se.baseLanes|c,cachePool:C}),m.memoizedState=Se,m.childLanes=$v(a,Z,c),o.memoizedState=Uv,Jp(a.child,m)):(ms(o),c=a.child,a=c.sibling,c=fo(c,{mode:"visible",children:m.children}),c.return=o,c.sibling=null,a!==null&&(Z=o.deletions,Z===null?(o.deletions=[a],o.flags|=16):Z.push(a)),o.child=c,o.memoizedState=null,c)}function Hv(a,o){return o=dy({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function dy(a,o){return a=ha(22,a,null,o),a.lanes=0,a}function Gv(a,o,c){return Ui(o,a.child,null,c),a=Hv(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function WS(a,o,c){a.lanes|=o;var m=a.alternate;m!==null&&(m.lanes|=o),G(a.return,o,c)}function Kv(a,o,c,m,C,L){var Z=a.memoizedState;Z===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:c,tailMode:C,treeForkCount:L}:(Z.isBackwards=o,Z.rendering=null,Z.renderingStartTime=0,Z.last=m,Z.tail=c,Z.tailMode=C,Z.treeForkCount=L)}function qS(a,o,c){var m=o.pendingProps,C=m.revealOrder,L=m.tail;m=m.children;var Z=Fn.current,Se=(Z&2)!==0;if(Se?(Z=Z&1|2,o.flags|=128):Z&=1,Ee(Fn,Z),vo(a,o,m,c),m=bi?bc:0,!Se&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&WS(a,c,o);else if(a.tag===19)WS(a,c,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(C){case"forwards":for(c=o.child,C=null;c!==null;)a=c.alternate,a!==null&&Ls(a)===null&&(C=c),c=c.sibling;c=C,c===null?(C=o.child,o.child=null):(C=c.sibling,c.sibling=null),Kv(o,!1,C,c,L,m);break;case"backwards":case"unstable_legacy-backwards":for(c=null,C=o.child,o.child=null;C!==null;){if(a=C.alternate,a!==null&&Ls(a)===null){o.child=C;break}a=C.sibling,C.sibling=c,c=C,C=a}Kv(o,!0,c,null,L,m);break;case"together":Kv(o,!1,null,null,void 0,m);break;default:o.memoizedState=null}return o.child}function Ac(a,o,c){if(a!==null&&(o.dependencies=a.dependencies),gh|=o.lanes,(c&o.childLanes)===0)if(a!==null){if(Te(a,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(n(153));if(o.child!==null){for(a=o.child,c=fo(a,a.pendingProps),o.child=c,c.return=o;a.sibling!==null;)a=a.sibling,c=c.sibling=fo(a,a.pendingProps),c.return=o;c.sibling=null}return o.child}function Wv(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&ie(a)))}function SN(a,o,c){switch(o.tag){case 3:it(o,o.stateNode.containerInfo),S(o,Q,a.memoizedState.cache),D();break;case 27:case 5:Et(o);break;case 4:it(o,o.stateNode.containerInfo);break;case 10:S(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Ji(o),null;break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(ms(o),o.flags|=128,null):(c&o.child.childLanes)!==0?KS(a,o,c):(ms(o),a=Ac(a,o,c),a!==null?a.sibling:null);ms(o);break;case 19:var C=(a.flags&128)!==0;if(m=(c&o.childLanes)!==0,m||(Te(a,o,c,!1),m=(c&o.childLanes)!==0),C){if(m)return qS(a,o,c);o.flags|=128}if(C=o.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),Ee(Fn,Fn.current),m)break;return null;case 22:return o.lanes=0,zS(a,o,c,o.pendingProps);case 24:S(o,Q,a.memoizedState.cache)}return Ac(a,o,c)}function YS(a,o,c){if(a!==null)if(a.memoizedProps!==o.pendingProps)Ta=!0;else{if(!Wv(a,c)&&(o.flags&128)===0)return Ta=!1,SN(a,o,c);Ta=(a.flags&131072)!==0}else Ta=!1,bi&&(o.flags&1048576)!==0&&xc(o,bc,o.index);switch(o.lanes=0,o.tag){case 16:e:{var m=o.pendingProps;if(a=Ze(o.elementType),o.type=a,typeof a=="function")yc(a)?(m=Sd(a,m),o.tag=1,o=HS(null,o,a,m,c)):(o.tag=0,o=zv(null,o,a,m,c));else{if(a!=null){var C=a.$$typeof;if(C===me){o.tag=11,o=FS(null,o,a,m,c);break e}else if(C===pe){o.tag=14,o=jS(null,o,a,m,c);break e}}throw o=ze(a)||a,Error(n(306,o,""))}}return o;case 0:return zv(a,o,o.type,o.pendingProps,c);case 1:return m=o.type,C=Sd(m,o.pendingProps),HS(a,o,m,C,c);case 3:e:{if(it(o,o.stateNode.containerInfo),a===null)throw Error(n(387));m=o.pendingProps;var L=o.memoizedState;C=L.element,ei(a,o),ws(o,m,null,c);var Z=o.memoizedState;if(m=Z.cache,S(o,Q,m),m!==L.cache&&te(o,[Q],c,!0),pr(),m=Z.element,L.isDehydrated)if(L={element:m,isDehydrated:!1,cache:Z.cache},o.updateQueue.baseState=L,o.memoizedState=L,o.flags&256){o=GS(a,o,m,c);break e}else if(m!==C){C=Eo(Error(n(424)),o),z(C),o=GS(a,o,m,c);break e}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Fr=eu(a.firstChild),da=o,bi=!0,Pa=null,rs=!0,c=si(o,null,m,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(D(),m===C){o=Ac(a,o,c);break e}vo(a,o,m,c)}o=o.child}return o;case 26:return hy(a,o),a===null?(c=aT(o.type,null,o.pendingProps,null))?o.memoizedState=c:bi||(c=o.type,a=o.pendingProps,m=ky(He.current).createElement(c),m[qi]=o,m[Yi]=a,_o(m,c,a),hr(m),o.stateNode=m):o.memoizedState=aT(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Et(o),a===null&&bi&&(m=o.stateNode=iT(o.type,o.pendingProps,He.current),da=o,rs=!0,C=Fr,bh(o.type)?(E_=C,Fr=eu(m.firstChild)):Fr=C),vo(a,o,o.pendingProps.children,c),hy(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&bi&&((C=m=Fr)&&(m=ZN(m,o.type,o.pendingProps,rs),m!==null?(o.stateNode=m,da=o,Fr=eu(m.firstChild),rs=!1,C=!0):C=!1),C||d(o)),Et(o),C=o.type,L=o.pendingProps,Z=a!==null?a.memoizedProps:null,m=L.children,x_(C,L)?m=null:Z!==null&&x_(C,Z)&&(o.flags|=32),o.memoizedState!==null&&(C=$u(a,o,qp,null,null,c),dg._currentValue=C),hy(a,o),vo(a,o,m,c),o.child;case 6:return a===null&&bi&&((a=c=Fr)&&(c=eP(c,o.pendingProps,rs),c!==null?(o.stateNode=c,da=o,Fr=null,a=!0):a=!1),a||d(o)),null;case 13:return KS(a,o,c);case 4:return it(o,o.stateNode.containerInfo),m=o.pendingProps,a===null?o.child=Ui(o,null,m,c):vo(a,o,m,c),o.child;case 11:return FS(a,o,o.type,o.pendingProps,c);case 7:return vo(a,o,o.pendingProps,c),o.child;case 8:return vo(a,o,o.pendingProps.children,c),o.child;case 12:return vo(a,o,o.pendingProps.children,c),o.child;case 10:return m=o.pendingProps,S(o,o.type,m.value),vo(a,o,m.children,c),o.child;case 9:return C=o.type._context,m=o.pendingProps.children,_e(o),C=Y(C),m=m(C),o.flags|=1,vo(a,o,m,c),o.child;case 14:return jS(a,o,o.type,o.pendingProps,c);case 15:return VS(a,o,o.type,o.pendingProps,c);case 19:return qS(a,o,c);case 31:return wN(a,o,c);case 22:return zS(a,o,c,o.pendingProps);case 24:return _e(o),m=Y(Q),a===null?(C=ve(),C===null&&(C=es,L=U(),C.pooledCache=L,L.refCount++,L!==null&&(C.pooledCacheLanes|=c),C=L),o.memoizedState={parent:m,cache:C},Ht(o),S(o,Q,C)):((a.lanes&c)!==0&&(ei(a,o),ws(o,null,null,c),pr()),C=a.memoizedState,L=o.memoizedState,C.parent!==m?(C={parent:m,cache:m},o.memoizedState=C,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=C),S(o,Q,m)):(m=L.cache,S(o,Q,m),m!==C.cache&&te(o,[Q],c,!0))),vo(a,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(n(156,o.tag))}function Ec(a){a.flags|=4}function qv(a,o,c,m,C){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(C&335544128)===C)if(a.stateNode.complete)a.flags|=8192;else if(w5())a.flags|=8192;else throw gt=Ge,Xe}else a.flags&=-16777217}function XS(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!hT(o))if(w5())a.flags|=8192;else throw gt=Ge,Xe}function fy(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Pr():536870912,a.lanes|=o,Tf|=o)}function Qp(a,o){if(!bi)switch(a.tailMode){case"hidden":o=a.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var m=null;c!==null;)c.alternate!==null&&(m=c),c=c.sibling;m===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function vs(a){var o=a.alternate!==null&&a.alternate.child===a.child,c=0,m=0;if(o)for(var C=a.child;C!==null;)c|=C.lanes|C.childLanes,m|=C.subtreeFlags&65011712,m|=C.flags&65011712,C.return=a,C=C.sibling;else for(C=a.child;C!==null;)c|=C.lanes|C.childLanes,m|=C.subtreeFlags,m|=C.flags,C.return=a,C=C.sibling;return a.subtreeFlags|=m,a.childLanes=c,o}function TN(a,o,c){var m=o.pendingProps;switch(ah(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vs(o),null;case 1:return vs(o),null;case 3:return c=o.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),T(Q),ct(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(a===null||a.child===null)&&(N(o)?Ec(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,F())),vs(o),null;case 26:var C=o.type,L=o.memoizedState;return a===null?(Ec(o),L!==null?(vs(o),XS(o,L)):(vs(o),qv(o,C,null,m,c))):L?L!==a.memoizedState?(Ec(o),vs(o),XS(o,L)):(vs(o),o.flags&=-16777217):(a=a.memoizedProps,a!==m&&Ec(o),vs(o),qv(o,C,a,m,c)),null;case 27:if(Ft(o),c=He.current,C=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&Ec(o);else{if(!m){if(o.stateNode===null)throw Error(n(166));return vs(o),null}a=Le.current,N(o)?g(o):(a=iT(C,m,c),o.stateNode=a,Ec(o))}return vs(o),null;case 5:if(Ft(o),C=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&Ec(o);else{if(!m){if(o.stateNode===null)throw Error(n(166));return vs(o),null}if(L=Le.current,N(o))g(o);else{var Z=ky(He.current);switch(L){case 1:L=Z.createElementNS("http://www.w3.org/2000/svg",C);break;case 2:L=Z.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;default:switch(C){case"svg":L=Z.createElementNS("http://www.w3.org/2000/svg",C);break;case"math":L=Z.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;case"script":L=Z.createElement("div"),L.innerHTML="<script><\/script>",L=L.removeChild(L.firstChild);break;case"select":L=typeof m.is=="string"?Z.createElement("select",{is:m.is}):Z.createElement("select"),m.multiple?L.multiple=!0:m.size&&(L.size=m.size);break;default:L=typeof m.is=="string"?Z.createElement(C,{is:m.is}):Z.createElement(C)}}L[qi]=o,L[Yi]=m;e:for(Z=o.child;Z!==null;){if(Z.tag===5||Z.tag===6)L.appendChild(Z.stateNode);else if(Z.tag!==4&&Z.tag!==27&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===o)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===o)break e;Z=Z.return}Z.sibling.return=Z.return,Z=Z.sibling}o.stateNode=L;e:switch(_o(L,C,m),C){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Ec(o)}}return vs(o),qv(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,c),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==m&&Ec(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(n(166));if(a=He.current,N(o)){if(a=o.stateNode,c=o.memoizedProps,m=null,C=da,C!==null)switch(C.tag){case 27:case 5:m=C.memoizedProps}a[qi]=o,a=!!(a.nodeValue===c||m!==null&&m.suppressHydrationWarning===!0||K5(a.nodeValue,c)),a||d(o,!0)}else a=ky(a).createTextNode(m),a[qi]=o,o.stateNode=a}return vs(o),null;case 31:if(c=o.memoizedState,a===null||a.memoizedState!==null){if(m=N(o),c!==null){if(a===null){if(!m)throw Error(n(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(n(557));a[qi]=o}else D(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;vs(o),a=!1}else c=F(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a)return o.flags&256?(wi(o),o):(wi(o),null);if((o.flags&128)!==0)throw Error(n(558))}return vs(o),null;case 13:if(m=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(C=N(o),m!==null&&m.dehydrated!==null){if(a===null){if(!C)throw Error(n(318));if(C=o.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(n(317));C[qi]=o}else D(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;vs(o),C=!1}else C=F(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=C),C=!0;if(!C)return o.flags&256?(wi(o),o):(wi(o),null)}return wi(o),(o.flags&128)!==0?(o.lanes=c,o):(c=m!==null,a=a!==null&&a.memoizedState!==null,c&&(m=o.child,C=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(C=m.alternate.memoizedState.cachePool.pool),L=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(L=m.memoizedState.cachePool.pool),L!==C&&(m.flags|=2048)),c!==a&&c&&(o.child.flags|=8192),fy(o,o.updateQueue),vs(o),null);case 4:return ct(),a===null&&m_(o.stateNode.containerInfo),vs(o),null;case 10:return T(o.type),vs(o),null;case 19:if(se(Fn),m=o.memoizedState,m===null)return vs(o),null;if(C=(o.flags&128)!==0,L=m.rendering,L===null)if(C)Qp(m,!1);else{if(Qs!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(L=Ls(a),L!==null){for(o.flags|=128,Qp(m,!1),a=L.updateQueue,o.updateQueue=a,fy(o,a),o.subtreeFlags=0,a=c,c=o.child;c!==null;)Wl(c,a),c=c.sibling;return Ee(Fn,Fn.current&1|2),bi&&go(o,m.treeForkCount),o.child}a=a.sibling}m.tail!==null&&Un()>vy&&(o.flags|=128,C=!0,Qp(m,!1),o.lanes=4194304)}else{if(!C)if(a=Ls(L),a!==null){if(o.flags|=128,C=!0,a=a.updateQueue,o.updateQueue=a,fy(o,a),Qp(m,!0),m.tail===null&&m.tailMode==="hidden"&&!L.alternate&&!bi)return vs(o),null}else 2*Un()-m.renderingStartTime>vy&&c!==536870912&&(o.flags|=128,C=!0,Qp(m,!1),o.lanes=4194304);m.isBackwards?(L.sibling=o.child,o.child=L):(a=m.last,a!==null?a.sibling=L:o.child=L,m.last=L)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=Un(),a.sibling=null,c=Fn.current,Ee(Fn,C?c&1|2:c&1),bi&&go(o,m.treeForkCount),a):(vs(o),null);case 22:case 23:return wi(o),Ds(),m=o.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(c&536870912)!==0&&(o.flags&128)===0&&(vs(o),o.subtreeFlags&6&&(o.flags|=8192)):vs(o),c=o.updateQueue,c!==null&&fy(o,c.retryQueue),c=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==c&&(o.flags|=2048),a!==null&&se(ue),null;case 24:return c=null,a!==null&&(c=a.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),T(Q),vs(o),null;case 25:return null;case 30:return null}throw Error(n(156,o.tag))}function AN(a,o){switch(ah(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return T(Q),ct(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Ft(o),null;case 31:if(o.memoizedState!==null){if(wi(o),o.alternate===null)throw Error(n(340));D()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(wi(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(n(340));D()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return se(Fn),null;case 4:return ct(),null;case 10:return T(o.type),null;case 22:case 23:return wi(o),Ds(),a!==null&&se(ue),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return T(Q),null;case 25:return null;default:return null}}function JS(a,o){switch(ah(o),o.tag){case 3:T(Q),ct();break;case 26:case 27:case 5:Ft(o);break;case 4:ct();break;case 31:o.memoizedState!==null&&wi(o);break;case 13:wi(o);break;case 19:se(Fn);break;case 10:T(o.type);break;case 22:case 23:wi(o),Ds(),a!==null&&se(ue);break;case 24:T(Q)}}function Zp(a,o){try{var c=o.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var C=m.next;c=C;do{if((c.tag&a)===a){m=void 0;var L=c.create,Z=c.inst;m=L(),Z.destroy=m}c=c.next}while(c!==C)}}catch(Se){Vr(o,o.return,Se)}}function fh(a,o,c){try{var m=o.updateQueue,C=m!==null?m.lastEffect:null;if(C!==null){var L=C.next;m=L;do{if((m.tag&a)===a){var Z=m.inst,Se=Z.destroy;if(Se!==void 0){Z.destroy=void 0,C=o;var Ke=c,pt=Se;try{pt()}catch(Ct){Vr(C,Ke,Ct)}}}m=m.next}while(m!==L)}}catch(Ct){Vr(o,o.return,Ct)}}function QS(a){var o=a.updateQueue;if(o!==null){var c=a.stateNode;try{Kr(o,c)}catch(m){Vr(a,a.return,m)}}}function ZS(a,o,c){c.props=Sd(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(m){Vr(a,o,m)}}function eg(a,o){try{var c=a.ref;if(c!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof c=="function"?a.refCleanup=c(m):c.current=m}}catch(C){Vr(a,o,C)}}function Hu(a,o){var c=a.ref,m=a.refCleanup;if(c!==null)if(typeof m=="function")try{m()}catch(C){Vr(a,o,C)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(C){Vr(a,o,C)}else c.current=null}function e5(a){var o=a.type,c=a.memoizedProps,m=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&m.focus();break e;case"img":c.src?m.src=c.src:c.srcSet&&(m.srcset=c.srcSet)}}catch(C){Vr(a,a.return,C)}}function Yv(a,o,c){try{var m=a.stateNode;WN(m,a.type,c,o),m[Yi]=o}catch(C){Vr(a,a.return,C)}}function t5(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&bh(a.type)||a.tag===4}function Xv(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||t5(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&bh(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Jv(a,o,c){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(a,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(a),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=fn));else if(m!==4&&(m===27&&bh(a.type)&&(c=a.stateNode,o=null),a=a.child,a!==null))for(Jv(a,o,c),a=a.sibling;a!==null;)Jv(a,o,c),a=a.sibling}function py(a,o,c){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?c.insertBefore(a,o):c.appendChild(a);else if(m!==4&&(m===27&&bh(a.type)&&(c=a.stateNode),a=a.child,a!==null))for(py(a,o,c),a=a.sibling;a!==null;)py(a,o,c),a=a.sibling}function n5(a){var o=a.stateNode,c=a.memoizedProps;try{for(var m=a.type,C=o.attributes;C.length;)o.removeAttributeNode(C[0]);_o(o,m,c),o[qi]=a,o[Yi]=c}catch(L){Vr(a,a.return,L)}}var Ic=!1,Aa=!1,Qv=!1,i5=typeof WeakSet=="function"?WeakSet:Set,Za=null;function EN(a,o){if(a=a.containerInfo,__=Oy,a=uo(a),ll(a)){if("selectionStart"in a)var c={start:a.selectionStart,end:a.selectionEnd};else e:{c=(c=a.ownerDocument)&&c.defaultView||window;var m=c.getSelection&&c.getSelection();if(m&&m.rangeCount!==0){c=m.anchorNode;var C=m.anchorOffset,L=m.focusNode;m=m.focusOffset;try{c.nodeType,L.nodeType}catch{c=null;break e}var Z=0,Se=-1,Ke=-1,pt=0,Ct=0,Ot=a,yt=null;t:for(;;){for(var xt;Ot!==c||C!==0&&Ot.nodeType!==3||(Se=Z+C),Ot!==L||m!==0&&Ot.nodeType!==3||(Ke=Z+m),Ot.nodeType===3&&(Z+=Ot.nodeValue.length),(xt=Ot.firstChild)!==null;)yt=Ot,Ot=xt;for(;;){if(Ot===a)break t;if(yt===c&&++pt===C&&(Se=Z),yt===L&&++Ct===m&&(Ke=Z),(xt=Ot.nextSibling)!==null)break;Ot=yt,yt=Ot.parentNode}Ot=xt}c=Se===-1||Ke===-1?null:{start:Se,end:Ke}}else c=null}c=c||{start:0,end:0}}else c=null;for(b_={focusedElem:a,selectionRange:c},Oy=!1,Za=o;Za!==null;)if(o=Za,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,Za=a;else for(;Za!==null;){switch(o=Za,L=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(c=0;c<a.length;c++)C=a[c],C.ref.impl=C.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&L!==null){a=void 0,c=o,C=L.memoizedProps,L=L.memoizedState,m=c.stateNode;try{var _n=Sd(c.type,C);a=m.getSnapshotBeforeUpdate(_n,L),m.__reactInternalSnapshotBeforeUpdate=a}catch(Yn){Vr(c,c.return,Yn)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,c=a.nodeType,c===9)S_(a);else if(c===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":S_(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(n(163))}if(a=o.sibling,a!==null){a.return=o.return,Za=a;break}Za=o.return}}function r5(a,o,c){var m=c.flags;switch(c.tag){case 0:case 11:case 15:Cc(a,c),m&4&&Zp(5,c);break;case 1:if(Cc(a,c),m&4)if(a=c.stateNode,o===null)try{a.componentDidMount()}catch(Z){Vr(c,c.return,Z)}else{var C=Sd(c.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(C,o,a.__reactInternalSnapshotBeforeUpdate)}catch(Z){Vr(c,c.return,Z)}}m&64&&QS(c),m&512&&eg(c,c.return);break;case 3:if(Cc(a,c),m&64&&(a=c.updateQueue,a!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Kr(a,o)}catch(Z){Vr(c,c.return,Z)}}break;case 27:o===null&&m&4&&n5(c);case 26:case 5:Cc(a,c),o===null&&m&4&&e5(c),m&512&&eg(c,c.return);break;case 12:Cc(a,c);break;case 31:Cc(a,c),m&4&&o5(a,c);break;case 13:Cc(a,c),m&4&&l5(a,c),m&64&&(a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(c=ON.bind(null,c),tP(a,c))));break;case 22:if(m=c.memoizedState!==null||Ic,!m){o=o!==null&&o.memoizedState!==null||Aa,C=Ic;var L=Aa;Ic=m,(Aa=o)&&!L?Rc(a,c,(c.subtreeFlags&8772)!==0):Cc(a,c),Ic=C,Aa=L}break;case 30:break;default:Cc(a,c)}}function s5(a){var o=a.alternate;o!==null&&(a.alternate=null,s5(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&ro(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Ts=null,cl=!1;function kc(a,o,c){for(c=c.child;c!==null;)a5(a,o,c),c=c.sibling}function a5(a,o,c){if(vn&&typeof vn.onCommitFiberUnmount=="function")try{vn.onCommitFiberUnmount(Jn,c)}catch{}switch(c.tag){case 26:Aa||Hu(c,o),kc(a,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Aa||Hu(c,o);var m=Ts,C=cl;bh(c.type)&&(Ts=c.stateNode,cl=!1),kc(a,o,c),ug(c.stateNode),Ts=m,cl=C;break;case 5:Aa||Hu(c,o);case 6:if(m=Ts,C=cl,Ts=null,kc(a,o,c),Ts=m,cl=C,Ts!==null)if(cl)try{(Ts.nodeType===9?Ts.body:Ts.nodeName==="HTML"?Ts.ownerDocument.body:Ts).removeChild(c.stateNode)}catch(L){Vr(c,o,L)}else try{Ts.removeChild(c.stateNode)}catch(L){Vr(c,o,L)}break;case 18:Ts!==null&&(cl?(a=Ts,Q5(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,c.stateNode),Lf(a)):Q5(Ts,c.stateNode));break;case 4:m=Ts,C=cl,Ts=c.stateNode.containerInfo,cl=!0,kc(a,o,c),Ts=m,cl=C;break;case 0:case 11:case 14:case 15:fh(2,c,o),Aa||fh(4,c,o),kc(a,o,c);break;case 1:Aa||(Hu(c,o),m=c.stateNode,typeof m.componentWillUnmount=="function"&&ZS(c,o,m)),kc(a,o,c);break;case 21:kc(a,o,c);break;case 22:Aa=(m=Aa)||c.memoizedState!==null,kc(a,o,c),Aa=m;break;default:kc(a,o,c)}}function o5(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Lf(a)}catch(c){Vr(o,o.return,c)}}}function l5(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Lf(a)}catch(c){Vr(o,o.return,c)}}function IN(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new i5),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new i5),o;default:throw Error(n(435,a.tag))}}function gy(a,o){var c=IN(a);o.forEach(function(m){if(!c.has(m)){c.add(m);var C=MN.bind(null,a,m);m.then(C,C)}})}function hl(a,o){var c=o.deletions;if(c!==null)for(var m=0;m<c.length;m++){var C=c[m],L=a,Z=o,Se=Z;e:for(;Se!==null;){switch(Se.tag){case 27:if(bh(Se.type)){Ts=Se.stateNode,cl=!1;break e}break;case 5:Ts=Se.stateNode,cl=!1;break e;case 3:case 4:Ts=Se.stateNode.containerInfo,cl=!0;break e}Se=Se.return}if(Ts===null)throw Error(n(160));a5(L,Z,C),Ts=null,cl=!1,L=C.alternate,L!==null&&(L.return=null),C.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)u5(o,a),o=o.sibling}var wu=null;function u5(a,o){var c=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:hl(o,a),dl(a),m&4&&(fh(3,a,a.return),Zp(3,a),fh(5,a,a.return));break;case 1:hl(o,a),dl(a),m&512&&(Aa||c===null||Hu(c,c.return)),m&64&&Ic&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(c=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=c===null?m:c.concat(m))));break;case 26:var C=wu;if(hl(o,a),dl(a),m&512&&(Aa||c===null||Hu(c,c.return)),m&4){var L=c!==null?c.memoizedState:null;if(m=a.memoizedState,c===null)if(m===null)if(a.stateNode===null){e:{m=a.type,c=a.memoizedProps,C=C.ownerDocument||C;t:switch(m){case"title":L=C.getElementsByTagName("title")[0],(!L||L[Jr]||L[qi]||L.namespaceURI==="http://www.w3.org/2000/svg"||L.hasAttribute("itemprop"))&&(L=C.createElement(m),C.head.insertBefore(L,C.querySelector("head > title"))),_o(L,m,c),L[qi]=a,hr(L),m=L;break e;case"link":var Z=uT("link","href",C).get(m+(c.href||""));if(Z){for(var Se=0;Se<Z.length;Se++)if(L=Z[Se],L.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&L.getAttribute("rel")===(c.rel==null?null:c.rel)&&L.getAttribute("title")===(c.title==null?null:c.title)&&L.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){Z.splice(Se,1);break t}}L=C.createElement(m),_o(L,m,c),C.head.appendChild(L);break;case"meta":if(Z=uT("meta","content",C).get(m+(c.content||""))){for(Se=0;Se<Z.length;Se++)if(L=Z[Se],L.getAttribute("content")===(c.content==null?null:""+c.content)&&L.getAttribute("name")===(c.name==null?null:c.name)&&L.getAttribute("property")===(c.property==null?null:c.property)&&L.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&L.getAttribute("charset")===(c.charSet==null?null:c.charSet)){Z.splice(Se,1);break t}}L=C.createElement(m),_o(L,m,c),C.head.appendChild(L);break;default:throw Error(n(468,m))}L[qi]=a,hr(L),m=L}a.stateNode=m}else cT(C,a.type,a.stateNode);else a.stateNode=lT(C,m,a.memoizedProps);else L!==m?(L===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):L.count--,m===null?cT(C,a.type,a.stateNode):lT(C,m,a.memoizedProps)):m===null&&a.stateNode!==null&&Yv(a,a.memoizedProps,c.memoizedProps)}break;case 27:hl(o,a),dl(a),m&512&&(Aa||c===null||Hu(c,c.return)),c!==null&&m&4&&Yv(a,a.memoizedProps,c.memoizedProps);break;case 5:if(hl(o,a),dl(a),m&512&&(Aa||c===null||Hu(c,c.return)),a.flags&32){C=a.stateNode;try{Mi(C,"")}catch(_n){Vr(a,a.return,_n)}}m&4&&a.stateNode!=null&&(C=a.memoizedProps,Yv(a,C,c!==null?c.memoizedProps:C)),m&1024&&(Qv=!0);break;case 6:if(hl(o,a),dl(a),m&4){if(a.stateNode===null)throw Error(n(162));m=a.memoizedProps,c=a.stateNode;try{c.nodeValue=m}catch(_n){Vr(a,a.return,_n)}}break;case 3:if(Dy=null,C=wu,wu=Cy(o.containerInfo),hl(o,a),wu=C,dl(a),m&4&&c!==null&&c.memoizedState.isDehydrated)try{Lf(o.containerInfo)}catch(_n){Vr(a,a.return,_n)}Qv&&(Qv=!1,c5(a));break;case 4:m=wu,wu=Cy(a.stateNode.containerInfo),hl(o,a),dl(a),wu=m;break;case 12:hl(o,a),dl(a);break;case 31:hl(o,a),dl(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,gy(a,m)));break;case 13:hl(o,a),dl(a),a.child.flags&8192&&a.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(yy=Un()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,gy(a,m)));break;case 22:C=a.memoizedState!==null;var Ke=c!==null&&c.memoizedState!==null,pt=Ic,Ct=Aa;if(Ic=pt||C,Aa=Ct||Ke,hl(o,a),Aa=Ct,Ic=pt,dl(a),m&8192)e:for(o=a.stateNode,o._visibility=C?o._visibility&-2:o._visibility|1,C&&(c===null||Ke||Ic||Aa||Td(a)),c=null,o=a;;){if(o.tag===5||o.tag===26){if(c===null){Ke=c=o;try{if(L=Ke.stateNode,C)Z=L.style,typeof Z.setProperty=="function"?Z.setProperty("display","none","important"):Z.display="none";else{Se=Ke.stateNode;var Ot=Ke.memoizedProps.style,yt=Ot!=null&&Ot.hasOwnProperty("display")?Ot.display:null;Se.style.display=yt==null||typeof yt=="boolean"?"":(""+yt).trim()}}catch(_n){Vr(Ke,Ke.return,_n)}}}else if(o.tag===6){if(c===null){Ke=o;try{Ke.stateNode.nodeValue=C?"":Ke.memoizedProps}catch(_n){Vr(Ke,Ke.return,_n)}}}else if(o.tag===18){if(c===null){Ke=o;try{var xt=Ke.stateNode;C?Z5(xt,!0):Z5(Ke.stateNode,!1)}catch(_n){Vr(Ke,Ke.return,_n)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=a.updateQueue,m!==null&&(c=m.retryQueue,c!==null&&(m.retryQueue=null,gy(a,c))));break;case 19:hl(o,a),dl(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,gy(a,m)));break;case 30:break;case 21:break;default:hl(o,a),dl(a)}}function dl(a){var o=a.flags;if(o&2){try{for(var c,m=a.return;m!==null;){if(t5(m)){c=m;break}m=m.return}if(c==null)throw Error(n(160));switch(c.tag){case 27:var C=c.stateNode,L=Xv(a);py(a,L,C);break;case 5:var Z=c.stateNode;c.flags&32&&(Mi(Z,""),c.flags&=-33);var Se=Xv(a);py(a,Se,Z);break;case 3:case 4:var Ke=c.stateNode.containerInfo,pt=Xv(a);Jv(a,pt,Ke);break;default:throw Error(n(161))}}catch(Ct){Vr(a,a.return,Ct)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function c5(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;c5(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function Cc(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)r5(a,o.alternate,o),o=o.sibling}function Td(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:fh(4,o,o.return),Td(o);break;case 1:Hu(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&ZS(o,o.return,c),Td(o);break;case 27:ug(o.stateNode);case 26:case 5:Hu(o,o.return),Td(o);break;case 22:o.memoizedState===null&&Td(o);break;case 30:Td(o);break;default:Td(o)}a=a.sibling}}function Rc(a,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,C=a,L=o,Z=L.flags;switch(L.tag){case 0:case 11:case 15:Rc(C,L,c),Zp(4,L);break;case 1:if(Rc(C,L,c),m=L,C=m.stateNode,typeof C.componentDidMount=="function")try{C.componentDidMount()}catch(pt){Vr(m,m.return,pt)}if(m=L,C=m.updateQueue,C!==null){var Se=m.stateNode;try{var Ke=C.shared.hiddenCallbacks;if(Ke!==null)for(C.shared.hiddenCallbacks=null,C=0;C<Ke.length;C++)wa(Ke[C],Se)}catch(pt){Vr(m,m.return,pt)}}c&&Z&64&&QS(L),eg(L,L.return);break;case 27:n5(L);case 26:case 5:Rc(C,L,c),c&&m===null&&Z&4&&e5(L),eg(L,L.return);break;case 12:Rc(C,L,c);break;case 31:Rc(C,L,c),c&&Z&4&&o5(C,L);break;case 13:Rc(C,L,c),c&&Z&4&&l5(C,L);break;case 22:L.memoizedState===null&&Rc(C,L,c),eg(L,L.return);break;case 30:break;default:Rc(C,L,c)}o=o.sibling}}function Zv(a,o){var c=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==c&&(a!=null&&a.refCount++,c!=null&&Me(c))}function e_(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Me(a))}function Su(a,o,c,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)h5(a,o,c,m),o=o.sibling}function h5(a,o,c,m){var C=o.flags;switch(o.tag){case 0:case 11:case 15:Su(a,o,c,m),C&2048&&Zp(9,o);break;case 1:Su(a,o,c,m);break;case 3:Su(a,o,c,m),C&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Me(a)));break;case 12:if(C&2048){Su(a,o,c,m),a=o.stateNode;try{var L=o.memoizedProps,Z=L.id,Se=L.onPostCommit;typeof Se=="function"&&Se(Z,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(Ke){Vr(o,o.return,Ke)}}else Su(a,o,c,m);break;case 31:Su(a,o,c,m);break;case 13:Su(a,o,c,m);break;case 23:break;case 22:L=o.stateNode,Z=o.alternate,o.memoizedState!==null?L._visibility&2?Su(a,o,c,m):tg(a,o):L._visibility&2?Su(a,o,c,m):(L._visibility|=2,xf(a,o,c,m,(o.subtreeFlags&10256)!==0||!1)),C&2048&&Zv(Z,o);break;case 24:Su(a,o,c,m),C&2048&&e_(o.alternate,o);break;default:Su(a,o,c,m)}}function xf(a,o,c,m,C){for(C=C&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var L=a,Z=o,Se=c,Ke=m,pt=Z.flags;switch(Z.tag){case 0:case 11:case 15:xf(L,Z,Se,Ke,C),Zp(8,Z);break;case 23:break;case 22:var Ct=Z.stateNode;Z.memoizedState!==null?Ct._visibility&2?xf(L,Z,Se,Ke,C):tg(L,Z):(Ct._visibility|=2,xf(L,Z,Se,Ke,C)),C&&pt&2048&&Zv(Z.alternate,Z);break;case 24:xf(L,Z,Se,Ke,C),C&&pt&2048&&e_(Z.alternate,Z);break;default:xf(L,Z,Se,Ke,C)}o=o.sibling}}function tg(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=a,m=o,C=m.flags;switch(m.tag){case 22:tg(c,m),C&2048&&Zv(m.alternate,m);break;case 24:tg(c,m),C&2048&&e_(m.alternate,m);break;default:tg(c,m)}o=o.sibling}}var ng=8192;function wf(a,o,c){if(a.subtreeFlags&ng)for(a=a.child;a!==null;)d5(a,o,c),a=a.sibling}function d5(a,o,c){switch(a.tag){case 26:wf(a,o,c),a.flags&ng&&a.memoizedState!==null&&fP(c,wu,a.memoizedState,a.memoizedProps);break;case 5:wf(a,o,c);break;case 3:case 4:var m=wu;wu=Cy(a.stateNode.containerInfo),wf(a,o,c),wu=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=ng,ng=16777216,wf(a,o,c),ng=m):wf(a,o,c));break;default:wf(a,o,c)}}function f5(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function ig(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var m=o[c];Za=m,g5(m,a)}f5(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)p5(a),a=a.sibling}function p5(a){switch(a.tag){case 0:case 11:case 15:ig(a),a.flags&2048&&fh(9,a,a.return);break;case 3:ig(a);break;case 12:ig(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,my(a)):ig(a);break;default:ig(a)}}function my(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var m=o[c];Za=m,g5(m,a)}f5(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:fh(8,o,o.return),my(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,my(o));break;default:my(o)}a=a.sibling}}function g5(a,o){for(;Za!==null;){var c=Za;switch(c.tag){case 0:case 11:case 15:fh(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var m=c.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Me(c.memoizedState.cache)}if(m=c.child,m!==null)m.return=c,Za=m;else e:for(c=a;Za!==null;){m=Za;var C=m.sibling,L=m.return;if(s5(m),m===c){Za=null;break e}if(C!==null){C.return=L,Za=C;break e}Za=L}}}var kN={getCacheForType:function(a){var o=Y(Q),c=o.data.get(a);return c===void 0&&(c=a(),o.data.set(a,c)),c},cacheSignal:function(){return Y(Q).controller.signal}},CN=typeof WeakMap=="function"?WeakMap:Map,Sr=0,es=null,Hi=null,Zi=0,jr=0,Ll=null,ph=!1,Sf=!1,t_=!1,Dc=0,Qs=0,gh=0,Ad=0,n_=0,Nl=0,Tf=0,rg=null,fl=null,i_=!1,yy=0,m5=0,vy=1/0,_y=null,mh=null,Fa=0,yh=null,Af=null,Lc=0,r_=0,s_=null,y5=null,sg=0,a_=null;function Pl(){return(Sr&2)!==0&&Zi!==0?Zi&-Zi:je.T!==null?d_():cr()}function v5(){if(Nl===0)if((Zi&536870912)===0||bi){var a=Qn;Qn<<=1,(Qn&3932160)===0&&(Qn=262144),Nl=a}else Nl=536870912;return a=Lr.current,a!==null&&(a.flags|=32),Nl}function pl(a,o,c){(a===es&&(jr===2||jr===9)||a.cancelPendingCommit!==null)&&(Ef(a,0),vh(a,Zi,Nl,!1)),pn(a,c),((Sr&2)===0||a!==es)&&(a===es&&((Sr&2)===0&&(Ad|=c),Qs===4&&vh(a,Zi,Nl,!1)),Gu(a))}function _5(a,o,c){if((Sr&6)!==0)throw Error(n(327));var m=!c&&(o&127)===0&&(o&a.expiredLanes)===0||Nr(a,o),C=m?LN(a,o):l_(a,o,!0),L=m;do{if(C===0){Sf&&!m&&vh(a,o,0,!1);break}else{if(c=a.current.alternate,L&&!RN(c)){C=l_(a,o,!1),L=!1;continue}if(C===2){if(L=o,a.errorRecoveryDisabledLanes&L)var Z=0;else Z=a.pendingLanes&-536870913,Z=Z!==0?Z:Z&536870912?536870912:0;if(Z!==0){o=Z;e:{var Se=a;C=rg;var Ke=Se.current.memoizedState.isDehydrated;if(Ke&&(Ef(Se,Z).flags|=256),Z=l_(Se,Z,!1),Z!==2){if(t_&&!Ke){Se.errorRecoveryDisabledLanes|=L,Ad|=L,C=4;break e}L=fl,fl=C,L!==null&&(fl===null?fl=L:fl.push.apply(fl,L))}C=Z}if(L=!1,C!==2)continue}}if(C===1){Ef(a,0),vh(a,o,0,!0);break}e:{switch(m=a,L=C,L){case 0:case 1:throw Error(n(345));case 4:if((o&4194048)!==o)break;case 6:vh(m,o,Nl,!ph);break e;case 2:fl=null;break;case 3:case 5:break;default:throw Error(n(329))}if((o&62914560)===o&&(C=yy+300-Un(),10<C)){if(vh(m,o,Nl,!ph),Kn(m,0,!0)!==0)break e;Lc=o,m.timeoutHandle=X5(b5.bind(null,m,c,fl,_y,i_,o,Nl,Ad,Tf,ph,L,"Throttled",-0,0),C);break e}b5(m,c,fl,_y,i_,o,Nl,Ad,Tf,ph,L,null,-0,0)}}break}while(!0);Gu(a)}function b5(a,o,c,m,C,L,Z,Se,Ke,pt,Ct,Ot,yt,xt){if(a.timeoutHandle=-1,Ot=o.subtreeFlags,Ot&8192||(Ot&16785408)===16785408){Ot={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:fn},d5(o,L,Ot);var _n=(L&62914560)===L?yy-Un():(L&4194048)===L?m5-Un():0;if(_n=pP(Ot,_n),_n!==null){Lc=L,a.cancelPendingCommit=_n(k5.bind(null,a,o,L,c,m,C,Z,Se,Ke,Ct,Ot,null,yt,xt)),vh(a,L,Z,!pt);return}}k5(a,o,L,c,m,C,Z,Se,Ke)}function RN(a){for(var o=a;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var m=0;m<c.length;m++){var C=c[m],L=C.getSnapshot;C=C.value;try{if(!Rs(L(),C))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function vh(a,o,c,m){o&=~n_,o&=~Ad,a.suspendedLanes|=o,a.pingedLanes&=~o,m&&(a.warmLanes|=o),m=a.expirationTimes;for(var C=o;0<C;){var L=31-qn(C),Z=1<<L;m[L]=-1,C&=~Z}c!==0&&sa(a,c,o)}function by(){return(Sr&6)===0?(ag(0),!1):!0}function o_(){if(Hi!==null){if(jr===0)var a=Hi.return;else a=Hi,R=k=null,lh(a),ht=null,Ut=0,a=Hi;for(;a!==null;)JS(a.alternate,a),a=a.return;Hi=null}}function Ef(a,o){var c=a.timeoutHandle;c!==-1&&(a.timeoutHandle=-1,XN(c)),c=a.cancelPendingCommit,c!==null&&(a.cancelPendingCommit=null,c()),Lc=0,o_(),es=a,Hi=c=fo(a.current,null),Zi=o,jr=0,Ll=null,ph=!1,Sf=Nr(a,o),t_=!1,Tf=Nl=n_=Ad=gh=Qs=0,fl=rg=null,i_=!1,(o&8)!==0&&(o|=o&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=o;0<m;){var C=31-qn(m),L=1<<C;o|=a[C],m&=~L}return Dc=o,yu(),c}function x5(a,o){Pn=null,je.H=Xp,o===Ue||o===Ae?(o=wt(),jr=3):o===Xe?(o=wt(),jr=4):jr=o===Vv?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Ll=o,Hi===null&&(Qs=1,uy(a,Eo(o,a.current)))}function w5(){var a=Lr.current;return a===null?!0:(Zi&4194048)===Zi?_i===null:(Zi&62914560)===Zi||(Zi&536870912)!==0?a===_i:!1}function S5(){var a=je.H;return je.H=Xp,a===null?Xp:a}function T5(){var a=je.A;return je.A=kN,a}function xy(){Qs=4,ph||(Zi&4194048)!==Zi&&Lr.current!==null||(Sf=!0),(gh&134217727)===0&&(Ad&134217727)===0||es===null||vh(es,Zi,Nl,!1)}function l_(a,o,c){var m=Sr;Sr|=2;var C=S5(),L=T5();(es!==a||Zi!==o)&&(_y=null,Ef(a,o)),o=!1;var Z=Qs;e:do try{if(jr!==0&&Hi!==null){var Se=Hi,Ke=Ll;switch(jr){case 8:o_(),Z=6;break e;case 3:case 2:case 9:case 6:Lr.current===null&&(o=!0);var pt=jr;if(jr=0,Ll=null,If(a,Se,Ke,pt),c&&Sf){Z=0;break e}break;default:pt=jr,jr=0,Ll=null,If(a,Se,Ke,pt)}}DN(),Z=Qs;break}catch(Ct){x5(a,Ct)}while(!0);return o&&a.shellSuspendCounter++,R=k=null,Sr=m,je.H=C,je.A=L,Hi===null&&(es=null,Zi=0,yu()),Z}function DN(){for(;Hi!==null;)A5(Hi)}function LN(a,o){var c=Sr;Sr|=2;var m=S5(),C=T5();es!==a||Zi!==o?(_y=null,vy=Un()+500,Ef(a,o)):Sf=Nr(a,o);e:do try{if(jr!==0&&Hi!==null){o=Hi;var L=Ll;t:switch(jr){case 1:jr=0,Ll=null,If(a,o,L,1);break;case 2:case 9:if(et(L)){jr=0,Ll=null,E5(o);break}o=function(){jr!==2&&jr!==9||es!==a||(jr=7),Gu(a)},L.then(o,o);break e;case 3:jr=7;break e;case 4:jr=5;break e;case 7:et(L)?(jr=0,Ll=null,E5(o)):(jr=0,Ll=null,If(a,o,L,7));break;case 5:var Z=null;switch(Hi.tag){case 26:Z=Hi.memoizedState;case 5:case 27:var Se=Hi;if(Z?hT(Z):Se.stateNode.complete){jr=0,Ll=null;var Ke=Se.sibling;if(Ke!==null)Hi=Ke;else{var pt=Se.return;pt!==null?(Hi=pt,wy(pt)):Hi=null}break t}}jr=0,Ll=null,If(a,o,L,5);break;case 6:jr=0,Ll=null,If(a,o,L,6);break;case 8:o_(),Qs=6;break e;default:throw Error(n(462))}}NN();break}catch(Ct){x5(a,Ct)}while(!0);return R=k=null,je.H=m,je.A=C,Sr=c,Hi!==null?0:(es=null,Zi=0,yu(),Qs)}function NN(){for(;Hi!==null&&!En();)A5(Hi)}function A5(a){var o=YS(a.alternate,a,Dc);a.memoizedProps=a.pendingProps,o===null?wy(a):Hi=o}function E5(a){var o=a,c=o.alternate;switch(o.tag){case 15:case 0:o=$S(c,o,o.pendingProps,o.type,void 0,Zi);break;case 11:o=$S(c,o,o.pendingProps,o.type.render,o.ref,Zi);break;case 5:lh(o);default:JS(c,o),o=Hi=Wl(o,Dc),o=YS(c,o,Dc)}a.memoizedProps=a.pendingProps,o===null?wy(a):Hi=o}function If(a,o,c,m){R=k=null,lh(o),ht=null,Ut=0;var C=o.return;try{if(xN(a,C,o,c,Zi)){Qs=1,uy(a,Eo(c,a.current)),Hi=null;return}}catch(L){if(C!==null)throw Hi=C,L;Qs=1,uy(a,Eo(c,a.current)),Hi=null;return}o.flags&32768?(bi||m===1?a=!0:Sf||(Zi&536870912)!==0?a=!1:(ph=a=!0,(m===2||m===9||m===3||m===6)&&(m=Lr.current,m!==null&&m.tag===13&&(m.flags|=16384))),I5(o,a)):wy(o)}function wy(a){var o=a;do{if((o.flags&32768)!==0){I5(o,ph);return}a=o.return;var c=TN(o.alternate,o,Dc);if(c!==null){Hi=c;return}if(o=o.sibling,o!==null){Hi=o;return}Hi=o=a}while(o!==null);Qs===0&&(Qs=5)}function I5(a,o){do{var c=AN(a.alternate,a);if(c!==null){c.flags&=32767,Hi=c;return}if(c=a.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(a=a.sibling,a!==null)){Hi=a;return}Hi=a=c}while(a!==null);Qs=6,Hi=null}function k5(a,o,c,m,C,L,Z,Se,Ke){a.cancelPendingCommit=null;do Sy();while(Fa!==0);if((Sr&6)!==0)throw Error(n(327));if(o!==null){if(o===a.current)throw Error(n(177));if(L=o.lanes|o.childLanes,L|=gc,Ra(a,c,L,Z,Se,Ke),a===es&&(Hi=es=null,Zi=0),Af=o,yh=a,Lc=c,r_=L,s_=C,y5=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,FN(Xn,function(){return N5(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=je.T,je.T=null,C=Je.p,Je.p=2,Z=Sr,Sr|=4;try{EN(a,o,c)}finally{Sr=Z,Je.p=C,je.T=m}}Fa=1,C5(),R5(),D5()}}function C5(){if(Fa===1){Fa=0;var a=yh,o=Af,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=je.T,je.T=null;var m=Je.p;Je.p=2;var C=Sr;Sr|=4;try{u5(o,a);var L=b_,Z=uo(a.containerInfo),Se=L.focusedElem,Ke=L.selectionRange;if(Z!==Se&&Se&&Se.ownerDocument&&Wo(Se.ownerDocument.documentElement,Se)){if(Ke!==null&&ll(Se)){var pt=Ke.start,Ct=Ke.end;if(Ct===void 0&&(Ct=pt),"selectionStart"in Se)Se.selectionStart=pt,Se.selectionEnd=Math.min(Ct,Se.value.length);else{var Ot=Se.ownerDocument||document,yt=Ot&&Ot.defaultView||window;if(yt.getSelection){var xt=yt.getSelection(),_n=Se.textContent.length,Yn=Math.min(Ke.start,_n),qr=Ke.end===void 0?Yn:Math.min(Ke.end,_n);!xt.extend&&Yn>qr&&(Z=qr,qr=Yn,Yn=Z);var st=ju(Se,Yn),Qe=ju(Se,qr);if(st&&Qe&&(xt.rangeCount!==1||xt.anchorNode!==st.node||xt.anchorOffset!==st.offset||xt.focusNode!==Qe.node||xt.focusOffset!==Qe.offset)){var dt=Ot.createRange();dt.setStart(st.node,st.offset),xt.removeAllRanges(),Yn>qr?(xt.addRange(dt),xt.extend(Qe.node,Qe.offset)):(dt.setEnd(Qe.node,Qe.offset),xt.addRange(dt))}}}}for(Ot=[],xt=Se;xt=xt.parentNode;)xt.nodeType===1&&Ot.push({element:xt,left:xt.scrollLeft,top:xt.scrollTop});for(typeof Se.focus=="function"&&Se.focus(),Se=0;Se<Ot.length;Se++){var Lt=Ot[Se];Lt.element.scrollLeft=Lt.left,Lt.element.scrollTop=Lt.top}}Oy=!!__,b_=__=null}finally{Sr=C,Je.p=m,je.T=c}}a.current=o,Fa=2}}function R5(){if(Fa===2){Fa=0;var a=yh,o=Af,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=je.T,je.T=null;var m=Je.p;Je.p=2;var C=Sr;Sr|=4;try{r5(a,o.alternate,o)}finally{Sr=C,Je.p=m,je.T=c}}Fa=3}}function D5(){if(Fa===4||Fa===3){Fa=0,wn();var a=yh,o=Af,c=Lc,m=y5;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Fa=5:(Fa=0,Af=yh=null,L5(a,a.pendingLanes));var C=a.pendingLanes;if(C===0&&(mh=null),ir(c),o=o.stateNode,vn&&typeof vn.onCommitFiberRoot=="function")try{vn.onCommitFiberRoot(Jn,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=je.T,C=Je.p,Je.p=2,je.T=null;try{for(var L=a.onRecoverableError,Z=0;Z<m.length;Z++){var Se=m[Z];L(Se.value,{componentStack:Se.stack})}}finally{je.T=o,Je.p=C}}(Lc&3)!==0&&Sy(),Gu(a),C=a.pendingLanes,(c&261930)!==0&&(C&42)!==0?a===a_?sg++:(sg=0,a_=a):sg=0,ag(0)}}function L5(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Me(o)))}function Sy(){return C5(),R5(),D5(),N5()}function N5(){if(Fa!==5)return!1;var a=yh,o=r_;r_=0;var c=ir(Lc),m=je.T,C=Je.p;try{Je.p=32>c?32:c,je.T=null,c=s_,s_=null;var L=yh,Z=Lc;if(Fa=0,Af=yh=null,Lc=0,(Sr&6)!==0)throw Error(n(331));var Se=Sr;if(Sr|=4,p5(L.current),h5(L,L.current,Z,c),Sr=Se,ag(0,!1),vn&&typeof vn.onPostCommitFiberRoot=="function")try{vn.onPostCommitFiberRoot(Jn,L)}catch{}return!0}finally{Je.p=C,je.T=m,L5(a,o)}}function P5(a,o,c){o=Eo(c,o),o=jv(a.stateNode,o,2),a=Nn(a,o,2),a!==null&&(pn(a,2),Gu(a))}function Vr(a,o,c){if(a.tag===3)P5(a,a,c);else for(;o!==null;){if(o.tag===3){P5(o,a,c);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(mh===null||!mh.has(m))){a=Eo(c,a),c=OS(2),m=Nn(o,c,2),m!==null&&(MS(c,m,o,a),pn(m,2),Gu(m));break}}o=o.return}}function u_(a,o,c){var m=a.pingCache;if(m===null){m=a.pingCache=new CN;var C=new Set;m.set(o,C)}else C=m.get(o),C===void 0&&(C=new Set,m.set(o,C));C.has(c)||(t_=!0,C.add(c),a=PN.bind(null,a,o,c),o.then(a,a))}function PN(a,o,c){var m=a.pingCache;m!==null&&m.delete(o),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,es===a&&(Zi&c)===c&&(Qs===4||Qs===3&&(Zi&62914560)===Zi&&300>Un()-yy?(Sr&2)===0&&Ef(a,0):n_|=c,Tf===Zi&&(Tf=0)),Gu(a)}function O5(a,o){o===0&&(o=Pr()),a=ho(a,o),a!==null&&(pn(a,o),Gu(a))}function ON(a){var o=a.memoizedState,c=0;o!==null&&(c=o.retryLane),O5(a,c)}function MN(a,o){var c=0;switch(a.tag){case 31:case 13:var m=a.stateNode,C=a.memoizedState;C!==null&&(c=C.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(o),O5(a,c)}function FN(a,o){return rn(a,o)}var Ty=null,kf=null,c_=!1,Ay=!1,h_=!1,_h=0;function Gu(a){a!==kf&&a.next===null&&(kf===null?Ty=kf=a:kf=kf.next=a),Ay=!0,c_||(c_=!0,VN())}function ag(a,o){if(!h_&&Ay){h_=!0;do for(var c=!1,m=Ty;m!==null;){if(a!==0){var C=m.pendingLanes;if(C===0)var L=0;else{var Z=m.suspendedLanes,Se=m.pingedLanes;L=(1<<31-qn(42|a)+1)-1,L&=C&~(Z&~Se),L=L&201326741?L&201326741|1:L?L|2:0}L!==0&&(c=!0,V5(m,L))}else L=Zi,L=Kn(m,m===es?L:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(L&3)===0||Nr(m,L)||(c=!0,V5(m,L));m=m.next}while(c);h_=!1}}function jN(){M5()}function M5(){Ay=c_=!1;var a=0;_h!==0&&YN()&&(a=_h);for(var o=Un(),c=null,m=Ty;m!==null;){var C=m.next,L=F5(m,o);L===0?(m.next=null,c===null?Ty=C:c.next=C,C===null&&(kf=c)):(c=m,(a!==0||(L&3)!==0)&&(Ay=!0)),m=C}Fa!==0&&Fa!==5||ag(a),_h!==0&&(_h=0)}function F5(a,o){for(var c=a.suspendedLanes,m=a.pingedLanes,C=a.expirationTimes,L=a.pendingLanes&-62914561;0<L;){var Z=31-qn(L),Se=1<<Z,Ke=C[Z];Ke===-1?((Se&c)===0||(Se&m)!==0)&&(C[Z]=vr(Se,o)):Ke<=o&&(a.expiredLanes|=Se),L&=~Se}if(o=es,c=Zi,c=Kn(a,a===o?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,c===0||a===o&&(jr===2||jr===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Jt(m),a.callbackNode=null,a.callbackPriority=0;if((c&3)===0||Nr(a,c)){if(o=c&-c,o===a.callbackPriority)return o;switch(m!==null&&Jt(m),ir(c)){case 2:case 8:c=li;break;case 32:c=Xn;break;case 268435456:c=$n;break;default:c=Xn}return m=j5.bind(null,a),c=rn(c,m),a.callbackPriority=o,a.callbackNode=c,o}return m!==null&&m!==null&&Jt(m),a.callbackPriority=2,a.callbackNode=null,2}function j5(a,o){if(Fa!==0&&Fa!==5)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(Sy()&&a.callbackNode!==c)return null;var m=Zi;return m=Kn(a,a===es?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(_5(a,m,o),F5(a,Un()),a.callbackNode!=null&&a.callbackNode===c?j5.bind(null,a):null)}function V5(a,o){if(Sy())return null;_5(a,o,!0)}function VN(){JN(function(){(Sr&6)!==0?rn(Bn,jN):M5()})}function d_(){if(_h===0){var a=v;a===0&&(a=Sn,Sn<<=1,(Sn&261888)===0&&(Sn=256)),_h=a}return _h}function z5(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:St(""+a)}function U5(a,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,a.id&&c.setAttribute("form",a.id),o.parentNode.insertBefore(c,o),a=new FormData(a),c.parentNode.removeChild(c),a}function zN(a,o,c,m,C){if(o==="submit"&&c&&c.stateNode===C){var L=z5((C[Yi]||null).action),Z=m.submitter;Z&&(o=(o=Z[Yi]||null)?z5(o.formAction):Z.getAttribute("formAction"),o!==null&&(L=o,Z=null));var Se=new xr("action","action",null,m,C);a.push({event:Se,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(_h!==0){var Ke=Z?U5(C,Z):new FormData(C);Lv(c,{pending:!0,data:Ke,method:C.method,action:L},null,Ke)}}else typeof L=="function"&&(Se.preventDefault(),Ke=Z?U5(C,Z):new FormData(C),Lv(c,{pending:!0,data:Ke,method:C.method,action:L},L,Ke))},currentTarget:C}]})}}for(var f_=0;f_<gu.length;f_++){var p_=gu[f_],UN=p_.toLowerCase(),BN=p_[0].toUpperCase()+p_.slice(1);Ao(UN,"on"+BN)}Ao(pu,"onAnimationEnd"),Ao(pc,"onAnimationIteration"),Ao(gd,"onAnimationStart"),Ao("dblclick","onDoubleClick"),Ao("focusin","onFocus"),Ao("focusout","onBlur"),Ao(vf,"onTransitionRun"),Ao(_f,"onTransitionStart"),Ao(bf,"onTransitionCancel"),Ao(md,"onTransitionEnd"),Is("onMouseEnter",["mouseout","mouseover"]),Is("onMouseLeave",["mouseout","mouseover"]),Is("onPointerEnter",["pointerout","pointerover"]),Is("onPointerLeave",["pointerout","pointerover"]),va("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),va("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),va("onBeforeInput",["compositionend","keypress","textInput","paste"]),va("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),va("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),va("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var og="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$N=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(og));function B5(a,o){o=(o&4)!==0;for(var c=0;c<a.length;c++){var m=a[c],C=m.event;m=m.listeners;e:{var L=void 0;if(o)for(var Z=m.length-1;0<=Z;Z--){var Se=m[Z],Ke=Se.instance,pt=Se.currentTarget;if(Se=Se.listener,Ke!==L&&C.isPropagationStopped())break e;L=Se,C.currentTarget=pt;try{L(C)}catch(Ct){Kl(Ct)}C.currentTarget=null,L=Ke}else for(Z=0;Z<m.length;Z++){if(Se=m[Z],Ke=Se.instance,pt=Se.currentTarget,Se=Se.listener,Ke!==L&&C.isPropagationStopped())break e;L=Se,C.currentTarget=pt;try{L(C)}catch(Ct){Kl(Ct)}C.currentTarget=null,L=Ke}}}}function Gi(a,o){var c=o[hs];c===void 0&&(c=o[hs]=new Set);var m=a+"__bubble";c.has(m)||($5(o,a,2,!1),c.add(m))}function g_(a,o,c){var m=0;o&&(m|=4),$5(c,a,m,o)}var Ey="_reactListening"+Math.random().toString(36).slice(2);function m_(a){if(!a[Ey]){a[Ey]=!0,vl.forEach(function(c){c!=="selectionchange"&&($N.has(c)||g_(c,!1,a),g_(c,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Ey]||(o[Ey]=!0,g_("selectionchange",!1,o))}}function $5(a,o,c,m){switch(vT(o)){case 2:var C=yP;break;case 8:C=vP;break;default:C=D_}c=C.bind(null,o,c,a),C=void 0,!ba||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(C=!0),m?C!==void 0?a.addEventListener(o,c,{capture:!0,passive:C}):a.addEventListener(o,c,!0):C!==void 0?a.addEventListener(o,c,{passive:C}):a.addEventListener(o,c,!1)}function y_(a,o,c,m,C){var L=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var Z=m.tag;if(Z===3||Z===4){var Se=m.stateNode.containerInfo;if(Se===C)break;if(Z===4)for(Z=m.return;Z!==null;){var Ke=Z.tag;if((Ke===3||Ke===4)&&Z.stateNode.containerInfo===C)return;Z=Z.return}for(;Se!==null;){if(Z=Ms(Se),Z===null)return;if(Ke=Z.tag,Ke===5||Ke===6||Ke===26||Ke===27){m=L=Z;continue e}Se=Se.parentNode}}m=m.return}Us(function(){var pt=L,Ct=Xi(c),Ot=[];e:{var yt=yd.get(a);if(yt!==void 0){var xt=xr,_n=a;switch(a){case"keypress":if(ks(c)===0)break e;case"keydown":case"keyup":xt=Ei;break;case"focusin":_n="focus",xt=Cr;break;case"focusout":_n="blur",xt=Cr;break;case"beforeblur":case"afterblur":xt=Cr;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xt=To;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xt=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xt=K;break;case pu:case pc:case gd:xt=j;break;case md:xt=Ie;break;case"scroll":case"scrollend":xt=Ka;break;case"wheel":xt=ft;break;case"copy":case"cut":case"paste":xt=Oe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xt=fr;break;case"toggle":case"beforetoggle":xt=Zn}var Yn=(o&4)!==0,qr=!Yn&&(a==="scroll"||a==="scrollend"),st=Yn?yt!==null?yt+"Capture":null:yt;Yn=[];for(var Qe=pt,dt;Qe!==null;){var Lt=Qe;if(dt=Lt.stateNode,Lt=Lt.tag,Lt!==5&&Lt!==26&&Lt!==27||dt===null||st===null||(Lt=Er(Qe,st),Lt!=null&&Yn.push(lg(Qe,Lt,dt))),qr)break;Qe=Qe.return}0<Yn.length&&(yt=new xt(yt,_n,null,c,Ct),Ot.push({event:yt,listeners:Yn}))}}if((o&7)===0){e:{if(yt=a==="mouseover"||a==="pointerover",xt=a==="mouseout"||a==="pointerout",yt&&c!==ui&&(_n=c.relatedTarget||c.fromElement)&&(Ms(_n)||_n[Xr]))break e;if((xt||yt)&&(yt=Ct.window===Ct?Ct:(yt=Ct.ownerDocument)?yt.defaultView||yt.parentWindow:window,xt?(_n=c.relatedTarget||c.toElement,xt=pt,_n=_n?Ms(_n):null,_n!==null&&(qr=s(_n),Yn=_n.tag,_n!==qr||Yn!==5&&Yn!==27&&Yn!==6)&&(_n=null)):(xt=null,_n=pt),xt!==_n)){if(Yn=To,Lt="onMouseLeave",st="onMouseEnter",Qe="mouse",(a==="pointerout"||a==="pointerover")&&(Yn=fr,Lt="onPointerLeave",st="onPointerEnter",Qe="pointer"),qr=xt==null?yt:aa(xt),dt=_n==null?yt:aa(_n),yt=new Yn(Lt,Qe+"leave",xt,c,Ct),yt.target=qr,yt.relatedTarget=dt,Lt=null,Ms(Ct)===pt&&(Yn=new Yn(st,Qe+"enter",_n,c,Ct),Yn.target=dt,Yn.relatedTarget=qr,Lt=Yn),qr=Lt,xt&&_n)t:{for(Yn=HN,st=xt,Qe=_n,dt=0,Lt=st;Lt;Lt=Yn(Lt))dt++;Lt=0;for(var Hn=Qe;Hn;Hn=Yn(Hn))Lt++;for(;0<dt-Lt;)st=Yn(st),dt--;for(;0<Lt-dt;)Qe=Yn(Qe),Lt--;for(;dt--;){if(st===Qe||Qe!==null&&st===Qe.alternate){Yn=st;break t}st=Yn(st),Qe=Yn(Qe)}Yn=null}else Yn=null;xt!==null&&H5(Ot,yt,xt,Yn,!1),_n!==null&&qr!==null&&H5(Ot,qr,_n,Yn,!0)}}e:{if(yt=pt?aa(pt):window,xt=yt.nodeName&&yt.nodeName.toLowerCase(),xt==="select"||xt==="input"&&yt.type==="file")var gr=Hl;else if(hc(yt))if(Ya)gr=ol;else{gr=ps;var kn=fu}else xt=yt.nodeName,!xt||xt.toLowerCase()!=="input"||yt.type!=="checkbox"&&yt.type!=="radio"?pt&&Bo(pt.elementType)&&(gr=Hl):gr=fc;if(gr&&(gr=gr(a,pt))){oo(Ot,gr,c,Ct);break e}kn&&kn(a,yt,pt),a==="focusout"&&pt&&yt.type==="number"&&pt.memoizedProps.value!=null&&Uo(yt,"number",yt.value)}switch(kn=pt?aa(pt):window,a){case"focusin":(hc(kn)||kn.contentEditable==="true")&&(Xa=kn,Wn=pt,Ii=null);break;case"focusout":Ii=Wn=Xa=null;break;case"mousedown":is=!0;break;case"contextmenu":case"mouseup":case"dragend":is=!1,Li(Ot,c,Ct);break;case"selectionchange":if(Gl)break;case"keydown":case"keyup":Li(Ot,c,Ct)}var ki;if(ci)e:{switch(a){case"compositionstart":var er="onCompositionStart";break e;case"compositionend":er="onCompositionEnd";break e;case"compositionupdate":er="onCompositionUpdate";break e}er=void 0}else rl?qa(a,c)&&(er="onCompositionEnd"):a==="keydown"&&c.keyCode===229&&(er="onCompositionStart");er&&(ua&&c.locale!=="ko"&&(rl||er!=="onCompositionStart"?er==="onCompositionEnd"&&rl&&(ki=gn()):(Bs=Ct,Ga="value"in Bs?Bs.value:Bs.textContent,rl=!0)),kn=Iy(pt,er),0<kn.length&&(er=new tt(er,a,null,c,Ct),Ot.push({event:er,listeners:kn}),ki?er.data=ki:(ki=$o(c),ki!==null&&(er.data=ki)))),(ki=Ws?xa(a,c):wl(a,c))&&(er=Iy(pt,"onBeforeInput"),0<er.length&&(kn=new tt("onBeforeInput","beforeinput",null,c,Ct),Ot.push({event:kn,listeners:er}),kn.data=ki)),zN(Ot,a,pt,c,Ct)}B5(Ot,o)})}function lg(a,o,c){return{instance:a,listener:o,currentTarget:c}}function Iy(a,o){for(var c=o+"Capture",m=[];a!==null;){var C=a,L=C.stateNode;if(C=C.tag,C!==5&&C!==26&&C!==27||L===null||(C=Er(a,c),C!=null&&m.unshift(lg(a,C,L)),C=Er(a,o),C!=null&&m.push(lg(a,C,L))),a.tag===3)return m;a=a.return}return[]}function HN(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function H5(a,o,c,m,C){for(var L=o._reactName,Z=[];c!==null&&c!==m;){var Se=c,Ke=Se.alternate,pt=Se.stateNode;if(Se=Se.tag,Ke!==null&&Ke===m)break;Se!==5&&Se!==26&&Se!==27||pt===null||(Ke=pt,C?(pt=Er(c,L),pt!=null&&Z.unshift(lg(c,pt,Ke))):C||(pt=Er(c,L),pt!=null&&Z.push(lg(c,pt,Ke)))),c=c.return}Z.length!==0&&a.push({event:o,listeners:Z})}var GN=/\r\n?/g,KN=/\u0000|\uFFFD/g;function G5(a){return(typeof a=="string"?a:""+a).replace(GN,`
`).replace(KN,"")}function K5(a,o){return o=G5(o),G5(a)===o}function Wr(a,o,c,m,C,L){switch(c){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||Mi(a,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&Mi(a,""+m);break;case"className":Hr(a,"class",m);break;case"tabIndex":Hr(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Hr(a,c,m);break;case"style":xl(a,m,L);break;case"data":if(o!=="object"){Hr(a,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||c!=="href")){a.removeAttribute(c);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(c);break}m=St(""+m),a.setAttribute(c,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof L=="function"&&(c==="formAction"?(o!=="input"&&Wr(a,o,"name",C.name,C,null),Wr(a,o,"formEncType",C.formEncType,C,null),Wr(a,o,"formMethod",C.formMethod,C,null),Wr(a,o,"formTarget",C.formTarget,C,null)):(Wr(a,o,"encType",C.encType,C,null),Wr(a,o,"method",C.method,C,null),Wr(a,o,"target",C.target,C,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(c);break}m=St(""+m),a.setAttribute(c,m);break;case"onClick":m!=null&&(a.onclick=fn);break;case"onScroll":m!=null&&Gi("scroll",a);break;case"onScrollEnd":m!=null&&Gi("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(c=m.__html,c!=null){if(C.children!=null)throw Error(n(60));a.innerHTML=c}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}c=St(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(c,""+m):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":m===!0?a.setAttribute(c,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(c,m):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(c,m):a.removeAttribute(c);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(c):a.setAttribute(c,m);break;case"popover":Gi("beforetoggle",a),Gi("toggle",a),oi(a,"popover",m);break;case"xlinkActuate":_r(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":_r(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":_r(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":_r(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":_r(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":_r(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":_r(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":_r(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":_r(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":oi(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Ha.get(c)||c,oi(a,c,m))}}function v_(a,o,c,m,C,L){switch(c){case"style":xl(a,m,L);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(c=m.__html,c!=null){if(C.children!=null)throw Error(n(60));a.innerHTML=c}}break;case"children":typeof m=="string"?Mi(a,m):(typeof m=="number"||typeof m=="bigint")&&Mi(a,""+m);break;case"onScroll":m!=null&&Gi("scroll",a);break;case"onScrollEnd":m!=null&&Gi("scrollend",a);break;case"onClick":m!=null&&(a.onclick=fn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Vs.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(C=c.endsWith("Capture"),o=c.slice(2,C?c.length-7:void 0),L=a[Yi]||null,L=L!=null?L[c]:null,typeof L=="function"&&a.removeEventListener(o,L,C),typeof m=="function")){typeof L!="function"&&L!==null&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(o,m,C);break e}c in a?a[c]=m:m===!0?a.setAttribute(c,""):oi(a,c,m)}}}function _o(a,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Gi("error",a),Gi("load",a);var m=!1,C=!1,L;for(L in c)if(c.hasOwnProperty(L)){var Z=c[L];if(Z!=null)switch(L){case"src":m=!0;break;case"srcSet":C=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:Wr(a,o,L,Z,c,null)}}C&&Wr(a,o,"srcSet",c.srcSet,c,null),m&&Wr(a,o,"src",c.src,c,null);return;case"input":Gi("invalid",a);var Se=L=Z=C=null,Ke=null,pt=null;for(m in c)if(c.hasOwnProperty(m)){var Ct=c[m];if(Ct!=null)switch(m){case"name":C=Ct;break;case"type":Z=Ct;break;case"checked":Ke=Ct;break;case"defaultChecked":pt=Ct;break;case"value":L=Ct;break;case"defaultValue":Se=Ct;break;case"children":case"dangerouslySetInnerHTML":if(Ct!=null)throw Error(n(137,o));break;default:Wr(a,o,m,Ct,c,null)}}$l(a,L,Se,Ke,pt,Z,C,!1);return;case"select":Gi("invalid",a),m=Z=L=null;for(C in c)if(c.hasOwnProperty(C)&&(Se=c[C],Se!=null))switch(C){case"value":L=Se;break;case"defaultValue":Z=Se;break;case"multiple":m=Se;default:Wr(a,o,C,Se,c,null)}o=L,c=Z,a.multiple=!!m,o!=null?br(a,!!m,o,!1):c!=null&&br(a,!!m,c,!0);return;case"textarea":Gi("invalid",a),L=C=m=null;for(Z in c)if(c.hasOwnProperty(Z)&&(Se=c[Z],Se!=null))switch(Z){case"value":m=Se;break;case"defaultValue":C=Se;break;case"children":L=Se;break;case"dangerouslySetInnerHTML":if(Se!=null)throw Error(n(91));break;default:Wr(a,o,Z,Se,c,null)}oa(a,m,C,L);return;case"option":for(Ke in c)if(c.hasOwnProperty(Ke)&&(m=c[Ke],m!=null))switch(Ke){case"selected":a.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:Wr(a,o,Ke,m,c,null)}return;case"dialog":Gi("beforetoggle",a),Gi("toggle",a),Gi("cancel",a),Gi("close",a);break;case"iframe":case"object":Gi("load",a);break;case"video":case"audio":for(m=0;m<og.length;m++)Gi(og[m],a);break;case"image":Gi("error",a),Gi("load",a);break;case"details":Gi("toggle",a);break;case"embed":case"source":case"link":Gi("error",a),Gi("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(pt in c)if(c.hasOwnProperty(pt)&&(m=c[pt],m!=null))switch(pt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,o));default:Wr(a,o,pt,m,c,null)}return;default:if(Bo(o)){for(Ct in c)c.hasOwnProperty(Ct)&&(m=c[Ct],m!==void 0&&v_(a,o,Ct,m,c,void 0));return}}for(Se in c)c.hasOwnProperty(Se)&&(m=c[Se],m!=null&&Wr(a,o,Se,m,c,null))}function WN(a,o,c,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var C=null,L=null,Z=null,Se=null,Ke=null,pt=null,Ct=null;for(xt in c){var Ot=c[xt];if(c.hasOwnProperty(xt)&&Ot!=null)switch(xt){case"checked":break;case"value":break;case"defaultValue":Ke=Ot;default:m.hasOwnProperty(xt)||Wr(a,o,xt,null,m,Ot)}}for(var yt in m){var xt=m[yt];if(Ot=c[yt],m.hasOwnProperty(yt)&&(xt!=null||Ot!=null))switch(yt){case"type":L=xt;break;case"name":C=xt;break;case"checked":pt=xt;break;case"defaultChecked":Ct=xt;break;case"value":Z=xt;break;case"defaultValue":Se=xt;break;case"children":case"dangerouslySetInnerHTML":if(xt!=null)throw Error(n(137,o));break;default:xt!==Ot&&Wr(a,o,yt,xt,m,Ot)}}zo(a,Z,Se,Ke,pt,Ct,L,C);return;case"select":xt=Z=Se=yt=null;for(L in c)if(Ke=c[L],c.hasOwnProperty(L)&&Ke!=null)switch(L){case"value":break;case"multiple":xt=Ke;default:m.hasOwnProperty(L)||Wr(a,o,L,null,m,Ke)}for(C in m)if(L=m[C],Ke=c[C],m.hasOwnProperty(C)&&(L!=null||Ke!=null))switch(C){case"value":yt=L;break;case"defaultValue":Se=L;break;case"multiple":Z=L;default:L!==Ke&&Wr(a,o,C,L,m,Ke)}o=Se,c=Z,m=xt,yt!=null?br(a,!!c,yt,!1):!!m!=!!c&&(o!=null?br(a,!!c,o,!0):br(a,!!c,c?[]:"",!1));return;case"textarea":xt=yt=null;for(Se in c)if(C=c[Se],c.hasOwnProperty(Se)&&C!=null&&!m.hasOwnProperty(Se))switch(Se){case"value":break;case"children":break;default:Wr(a,o,Se,null,m,C)}for(Z in m)if(C=m[Z],L=c[Z],m.hasOwnProperty(Z)&&(C!=null||L!=null))switch(Z){case"value":yt=C;break;case"defaultValue":xt=C;break;case"children":break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(n(91));break;default:C!==L&&Wr(a,o,Z,C,m,L)}_l(a,yt,xt);return;case"option":for(var _n in c)if(yt=c[_n],c.hasOwnProperty(_n)&&yt!=null&&!m.hasOwnProperty(_n))switch(_n){case"selected":a.selected=!1;break;default:Wr(a,o,_n,null,m,yt)}for(Ke in m)if(yt=m[Ke],xt=c[Ke],m.hasOwnProperty(Ke)&&yt!==xt&&(yt!=null||xt!=null))switch(Ke){case"selected":a.selected=yt&&typeof yt!="function"&&typeof yt!="symbol";break;default:Wr(a,o,Ke,yt,m,xt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Yn in c)yt=c[Yn],c.hasOwnProperty(Yn)&&yt!=null&&!m.hasOwnProperty(Yn)&&Wr(a,o,Yn,null,m,yt);for(pt in m)if(yt=m[pt],xt=c[pt],m.hasOwnProperty(pt)&&yt!==xt&&(yt!=null||xt!=null))switch(pt){case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(n(137,o));break;default:Wr(a,o,pt,yt,m,xt)}return;default:if(Bo(o)){for(var qr in c)yt=c[qr],c.hasOwnProperty(qr)&&yt!==void 0&&!m.hasOwnProperty(qr)&&v_(a,o,qr,void 0,m,yt);for(Ct in m)yt=m[Ct],xt=c[Ct],!m.hasOwnProperty(Ct)||yt===xt||yt===void 0&&xt===void 0||v_(a,o,Ct,yt,m,xt);return}}for(var st in c)yt=c[st],c.hasOwnProperty(st)&&yt!=null&&!m.hasOwnProperty(st)&&Wr(a,o,st,null,m,yt);for(Ot in m)yt=m[Ot],xt=c[Ot],!m.hasOwnProperty(Ot)||yt===xt||yt==null&&xt==null||Wr(a,o,Ot,yt,m,xt)}function W5(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function qN(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,c=performance.getEntriesByType("resource"),m=0;m<c.length;m++){var C=c[m],L=C.transferSize,Z=C.initiatorType,Se=C.duration;if(L&&Se&&W5(Z)){for(Z=0,Se=C.responseEnd,m+=1;m<c.length;m++){var Ke=c[m],pt=Ke.startTime;if(pt>Se)break;var Ct=Ke.transferSize,Ot=Ke.initiatorType;Ct&&W5(Ot)&&(Ke=Ke.responseEnd,Z+=Ct*(Ke<Se?1:(Se-pt)/(Ke-pt)))}if(--m,o+=8*(L+Z)/(C.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var __=null,b_=null;function ky(a){return a.nodeType===9?a:a.ownerDocument}function q5(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Y5(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function x_(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var w_=null;function YN(){var a=window.event;return a&&a.type==="popstate"?a===w_?!1:(w_=a,!0):(w_=null,!1)}var X5=typeof setTimeout=="function"?setTimeout:void 0,XN=typeof clearTimeout=="function"?clearTimeout:void 0,J5=typeof Promise=="function"?Promise:void 0,JN=typeof queueMicrotask=="function"?queueMicrotask:typeof J5<"u"?function(a){return J5.resolve(null).then(a).catch(QN)}:X5;function QN(a){setTimeout(function(){throw a})}function bh(a){return a==="head"}function Q5(a,o){var c=o,m=0;do{var C=c.nextSibling;if(a.removeChild(c),C&&C.nodeType===8)if(c=C.data,c==="/$"||c==="/&"){if(m===0){a.removeChild(C),Lf(o);return}m--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")m++;else if(c==="html")ug(a.ownerDocument.documentElement);else if(c==="head"){c=a.ownerDocument.head,ug(c);for(var L=c.firstChild;L;){var Z=L.nextSibling,Se=L.nodeName;L[Jr]||Se==="SCRIPT"||Se==="STYLE"||Se==="LINK"&&L.rel.toLowerCase()==="stylesheet"||c.removeChild(L),L=Z}}else c==="body"&&ug(a.ownerDocument.body);c=C}while(c);Lf(o)}function Z5(a,o){var c=a;a=0;do{var m=c.nextSibling;if(c.nodeType===1?o?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(o?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(a===0)break;a--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||a++;c=m}while(c)}function S_(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":S_(c),ro(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}a.removeChild(c)}}function ZN(a,o,c,m){for(;a.nodeType===1;){var C=c;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[Jr])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(L=a.getAttribute("rel"),L==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(L!==C.rel||a.getAttribute("href")!==(C.href==null||C.href===""?null:C.href)||a.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin)||a.getAttribute("title")!==(C.title==null?null:C.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(L=a.getAttribute("src"),(L!==(C.src==null?null:C.src)||a.getAttribute("type")!==(C.type==null?null:C.type)||a.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin))&&L&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var L=C.name==null?null:""+C.name;if(C.type==="hidden"&&a.getAttribute("name")===L)return a}else return a;if(a=eu(a.nextSibling),a===null)break}return null}function eP(a,o,c){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=eu(a.nextSibling),a===null))return null;return a}function eT(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=eu(a.nextSibling),a===null))return null;return a}function T_(a){return a.data==="$?"||a.data==="$~"}function A_(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function tP(a,o){var c=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||c.readyState!=="loading")o();else{var m=function(){o(),c.removeEventListener("DOMContentLoaded",m)};c.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function eu(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var E_=null;function tT(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var c=a.data;if(c==="/$"||c==="/&"){if(o===0)return eu(a.nextSibling);o--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||o++}a=a.nextSibling}return null}function nT(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var c=a.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(o===0)return a;o--}else c!=="/$"&&c!=="/&"||o++}a=a.previousSibling}return null}function iT(a,o,c){switch(o=ky(c),a){case"html":if(a=o.documentElement,!a)throw Error(n(452));return a;case"head":if(a=o.head,!a)throw Error(n(453));return a;case"body":if(a=o.body,!a)throw Error(n(454));return a;default:throw Error(n(451))}}function ug(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);ro(a)}var tu=new Map,rT=new Set;function Cy(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Nc=Je.d;Je.d={f:nP,r:iP,D:rP,C:sP,L:aP,m:oP,X:uP,S:lP,M:cP};function nP(){var a=Nc.f(),o=by();return a||o}function iP(a){var o=Fs(a);o!==null&&o.tag===5&&o.type==="form"?xS(o):Nc.r(a)}var Cf=typeof document>"u"?null:document;function sT(a,o,c){var m=Cf;if(m&&typeof o=="string"&&o){var C=Mr(o);C='link[rel="'+a+'"][href="'+C+'"]',typeof c=="string"&&(C+='[crossorigin="'+c+'"]'),rT.has(C)||(rT.add(C),a={rel:a,crossOrigin:c,href:o},m.querySelector(C)===null&&(o=m.createElement("link"),_o(o,"link",a),hr(o),m.head.appendChild(o)))}}function rP(a){Nc.D(a),sT("dns-prefetch",a,null)}function sP(a,o){Nc.C(a,o),sT("preconnect",a,o)}function aP(a,o,c){Nc.L(a,o,c);var m=Cf;if(m&&a&&o){var C='link[rel="preload"][as="'+Mr(o)+'"]';o==="image"&&c&&c.imageSrcSet?(C+='[imagesrcset="'+Mr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(C+='[imagesizes="'+Mr(c.imageSizes)+'"]')):C+='[href="'+Mr(a)+'"]';var L=C;switch(o){case"style":L=Rf(a);break;case"script":L=Df(a)}tu.has(L)||(a=p({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:a,as:o},c),tu.set(L,a),m.querySelector(C)!==null||o==="style"&&m.querySelector(cg(L))||o==="script"&&m.querySelector(hg(L))||(o=m.createElement("link"),_o(o,"link",a),hr(o),m.head.appendChild(o)))}}function oP(a,o){Nc.m(a,o);var c=Cf;if(c&&a){var m=o&&typeof o.as=="string"?o.as:"script",C='link[rel="modulepreload"][as="'+Mr(m)+'"][href="'+Mr(a)+'"]',L=C;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":L=Df(a)}if(!tu.has(L)&&(a=p({rel:"modulepreload",href:a},o),tu.set(L,a),c.querySelector(C)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(hg(L)))return}m=c.createElement("link"),_o(m,"link",a),hr(m),c.head.appendChild(m)}}}function lP(a,o,c){Nc.S(a,o,c);var m=Cf;if(m&&a){var C=js(m).hoistableStyles,L=Rf(a);o=o||"default";var Z=C.get(L);if(!Z){var Se={loading:0,preload:null};if(Z=m.querySelector(cg(L)))Se.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":o},c),(c=tu.get(L))&&I_(a,c);var Ke=Z=m.createElement("link");hr(Ke),_o(Ke,"link",a),Ke._p=new Promise(function(pt,Ct){Ke.onload=pt,Ke.onerror=Ct}),Ke.addEventListener("load",function(){Se.loading|=1}),Ke.addEventListener("error",function(){Se.loading|=2}),Se.loading|=4,Ry(Z,o,m)}Z={type:"stylesheet",instance:Z,count:1,state:Se},C.set(L,Z)}}}function uP(a,o){Nc.X(a,o);var c=Cf;if(c&&a){var m=js(c).hoistableScripts,C=Df(a),L=m.get(C);L||(L=c.querySelector(hg(C)),L||(a=p({src:a,async:!0},o),(o=tu.get(C))&&k_(a,o),L=c.createElement("script"),hr(L),_o(L,"link",a),c.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},m.set(C,L))}}function cP(a,o){Nc.M(a,o);var c=Cf;if(c&&a){var m=js(c).hoistableScripts,C=Df(a),L=m.get(C);L||(L=c.querySelector(hg(C)),L||(a=p({src:a,async:!0,type:"module"},o),(o=tu.get(C))&&k_(a,o),L=c.createElement("script"),hr(L),_o(L,"link",a),c.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},m.set(C,L))}}function aT(a,o,c,m){var C=(C=He.current)?Cy(C):null;if(!C)throw Error(n(446));switch(a){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=Rf(c.href),c=js(C).hoistableStyles,m=c.get(o),m||(m={type:"style",instance:null,count:0,state:null},c.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){a=Rf(c.href);var L=js(C).hoistableStyles,Z=L.get(a);if(Z||(C=C.ownerDocument||C,Z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},L.set(a,Z),(L=C.querySelector(cg(a)))&&!L._p&&(Z.instance=L,Z.state.loading=5),tu.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},tu.set(a,c),L||hP(C,a,c,Z.state))),o&&m===null)throw Error(n(528,""));return Z}if(o&&m!==null)throw Error(n(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Df(c),c=js(C).hoistableScripts,m=c.get(o),m||(m={type:"script",instance:null,count:0,state:null},c.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,a))}}function Rf(a){return'href="'+Mr(a)+'"'}function cg(a){return'link[rel="stylesheet"]['+a+"]"}function oT(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function hP(a,o,c,m){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=a.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),_o(o,"link",c),hr(o),a.head.appendChild(o))}function Df(a){return'[src="'+Mr(a)+'"]'}function hg(a){return"script[async]"+a}function lT(a,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var m=a.querySelector('style[data-href~="'+Mr(c.href)+'"]');if(m)return o.instance=m,hr(m),m;var C=p({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),hr(m),_o(m,"style",C),Ry(m,c.precedence,a),o.instance=m;case"stylesheet":C=Rf(c.href);var L=a.querySelector(cg(C));if(L)return o.state.loading|=4,o.instance=L,hr(L),L;m=oT(c),(C=tu.get(C))&&I_(m,C),L=(a.ownerDocument||a).createElement("link"),hr(L);var Z=L;return Z._p=new Promise(function(Se,Ke){Z.onload=Se,Z.onerror=Ke}),_o(L,"link",m),o.state.loading|=4,Ry(L,c.precedence,a),o.instance=L;case"script":return L=Df(c.src),(C=a.querySelector(hg(L)))?(o.instance=C,hr(C),C):(m=c,(C=tu.get(L))&&(m=p({},c),k_(m,C)),a=a.ownerDocument||a,C=a.createElement("script"),hr(C),_o(C,"link",m),a.head.appendChild(C),o.instance=C);case"void":return null;default:throw Error(n(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,Ry(m,c.precedence,a));return o.instance}function Ry(a,o,c){for(var m=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),C=m.length?m[m.length-1]:null,L=C,Z=0;Z<m.length;Z++){var Se=m[Z];if(Se.dataset.precedence===o)L=Se;else if(L!==C)break}L?L.parentNode.insertBefore(a,L.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(a,o.firstChild))}function I_(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function k_(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Dy=null;function uT(a,o,c){if(Dy===null){var m=new Map,C=Dy=new Map;C.set(c,m)}else C=Dy,m=C.get(c),m||(m=new Map,C.set(c,m));if(m.has(a))return m;for(m.set(a,null),c=c.getElementsByTagName(a),C=0;C<c.length;C++){var L=c[C];if(!(L[Jr]||L[qi]||a==="link"&&L.getAttribute("rel")==="stylesheet")&&L.namespaceURI!=="http://www.w3.org/2000/svg"){var Z=L.getAttribute(o)||"";Z=a+Z;var Se=m.get(Z);Se?Se.push(L):m.set(Z,[L])}}return m}function cT(a,o,c){a=a.ownerDocument||a,a.head.insertBefore(c,o==="title"?a.querySelector("head > title"):null)}function dP(a,o,c){if(c===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function hT(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function fP(a,o,c,m){if(c.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var C=Rf(m.href),L=o.querySelector(cg(C));if(L){o=L._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=Ly.bind(a),o.then(a,a)),c.state.loading|=4,c.instance=L,hr(L);return}L=o.ownerDocument||o,m=oT(m),(C=tu.get(C))&&I_(m,C),L=L.createElement("link"),hr(L);var Z=L;Z._p=new Promise(function(Se,Ke){Z.onload=Se,Z.onerror=Ke}),_o(L,"link",m),c.instance=L}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(c,o),(o=c.state.preload)&&(c.state.loading&3)===0&&(a.count++,c=Ly.bind(a),o.addEventListener("load",c),o.addEventListener("error",c))}}var C_=0;function pP(a,o){return a.stylesheets&&a.count===0&&Py(a,a.stylesheets),0<a.count||0<a.imgCount?function(c){var m=setTimeout(function(){if(a.stylesheets&&Py(a,a.stylesheets),a.unsuspend){var L=a.unsuspend;a.unsuspend=null,L()}},6e4+o);0<a.imgBytes&&C_===0&&(C_=62500*qN());var C=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Py(a,a.stylesheets),a.unsuspend)){var L=a.unsuspend;a.unsuspend=null,L()}},(a.imgBytes>C_?50:800)+o);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(C)}}:null}function Ly(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Py(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Ny=null;function Py(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Ny=new Map,o.forEach(gP,a),Ny=null,Ly.call(a))}function gP(a,o){if(!(o.state.loading&4)){var c=Ny.get(a);if(c)var m=c.get(null);else{c=new Map,Ny.set(a,c);for(var C=a.querySelectorAll("link[data-precedence],style[data-precedence]"),L=0;L<C.length;L++){var Z=C[L];(Z.nodeName==="LINK"||Z.getAttribute("media")!=="not all")&&(c.set(Z.dataset.precedence,Z),m=Z)}m&&c.set(null,m)}C=o.instance,Z=C.getAttribute("data-precedence"),L=c.get(Z)||m,L===m&&c.set(null,C),c.set(Z,C),this.count++,m=Ly.bind(this),C.addEventListener("load",m),C.addEventListener("error",m),L?L.parentNode.insertBefore(C,L.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(C,a.firstChild)),o.state.loading|=4}}var dg={$$typeof:he,Provider:null,Consumer:null,_currentValue:qe,_currentValue2:qe,_threadCount:0};function mP(a,o,c,m,C,L,Z,Se,Ke){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ri(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ri(0),this.hiddenUpdates=Ri(null),this.identifierPrefix=m,this.onUncaughtError=C,this.onCaughtError=L,this.onRecoverableError=Z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ke,this.incompleteTransitions=new Map}function dT(a,o,c,m,C,L,Z,Se,Ke,pt,Ct,Ot){return a=new mP(a,o,c,Z,Ke,pt,Ct,Ot,Se),o=1,L===!0&&(o|=24),L=ha(3,null,null,o),a.current=L,L.stateNode=a,o=U(),o.refCount++,a.pooledCache=o,o.refCount++,L.memoizedState={element:m,isDehydrated:c,cache:o},Ht(L),a}function fT(a){return a?(a=Ys,a):Ys}function pT(a,o,c,m,C,L){C=fT(C),m.context===null?m.context=C:m.pendingContext=C,m=Dn(o),m.payload={element:c},L=L===void 0?null:L,L!==null&&(m.callback=L),c=Nn(a,m,o),c!==null&&(pl(c,a,o),ur(c,a,o))}function gT(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var c=a.retryLane;a.retryLane=c!==0&&c<o?c:o}}function R_(a,o){gT(a,o),(a=a.alternate)&&gT(a,o)}function mT(a){if(a.tag===13||a.tag===31){var o=ho(a,67108864);o!==null&&pl(o,a,67108864),R_(a,67108864)}}function yT(a){if(a.tag===13||a.tag===31){var o=Pl();o=Oi(o);var c=ho(a,o);c!==null&&pl(c,a,o),R_(a,o)}}var Oy=!0;function yP(a,o,c,m){var C=je.T;je.T=null;var L=Je.p;try{Je.p=2,D_(a,o,c,m)}finally{Je.p=L,je.T=C}}function vP(a,o,c,m){var C=je.T;je.T=null;var L=Je.p;try{Je.p=8,D_(a,o,c,m)}finally{Je.p=L,je.T=C}}function D_(a,o,c,m){if(Oy){var C=L_(m);if(C===null)y_(a,o,m,My,c),_T(a,m);else if(bP(C,a,o,c,m))m.stopPropagation();else if(_T(a,m),o&4&&-1<_P.indexOf(a)){for(;C!==null;){var L=Fs(C);if(L!==null)switch(L.tag){case 3:if(L=L.stateNode,L.current.memoizedState.isDehydrated){var Z=Gt(L.pendingLanes);if(Z!==0){var Se=L;for(Se.pendingLanes|=2,Se.entangledLanes|=2;Z;){var Ke=1<<31-qn(Z);Se.entanglements[1]|=Ke,Z&=~Ke}Gu(L),(Sr&6)===0&&(vy=Un()+500,ag(0))}}break;case 31:case 13:Se=ho(L,2),Se!==null&&pl(Se,L,2),by(),R_(L,2)}if(L=L_(m),L===null&&y_(a,o,m,My,c),L===C)break;C=L}C!==null&&m.stopPropagation()}else y_(a,o,m,null,c)}}function L_(a){return a=Xi(a),N_(a)}var My=null;function N_(a){if(My=null,a=Ms(a),a!==null){var o=s(a);if(o===null)a=null;else{var c=o.tag;if(c===13){if(a=l(o),a!==null)return a;a=null}else if(c===31){if(a=u(o),a!==null)return a;a=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return My=a,null}function vT(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ii()){case Bn:return 2;case li:return 8;case Xn:case cn:return 32;case $n:return 268435456;default:return 32}default:return 32}}var P_=!1,xh=null,wh=null,Sh=null,fg=new Map,pg=new Map,Th=[],_P="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _T(a,o){switch(a){case"focusin":case"focusout":xh=null;break;case"dragenter":case"dragleave":wh=null;break;case"mouseover":case"mouseout":Sh=null;break;case"pointerover":case"pointerout":fg.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":pg.delete(o.pointerId)}}function gg(a,o,c,m,C,L){return a===null||a.nativeEvent!==L?(a={blockedOn:o,domEventName:c,eventSystemFlags:m,nativeEvent:L,targetContainers:[C]},o!==null&&(o=Fs(o),o!==null&&mT(o)),a):(a.eventSystemFlags|=m,o=a.targetContainers,C!==null&&o.indexOf(C)===-1&&o.push(C),a)}function bP(a,o,c,m,C){switch(o){case"focusin":return xh=gg(xh,a,o,c,m,C),!0;case"dragenter":return wh=gg(wh,a,o,c,m,C),!0;case"mouseover":return Sh=gg(Sh,a,o,c,m,C),!0;case"pointerover":var L=C.pointerId;return fg.set(L,gg(fg.get(L)||null,a,o,c,m,C)),!0;case"gotpointercapture":return L=C.pointerId,pg.set(L,gg(pg.get(L)||null,a,o,c,m,C)),!0}return!1}function bT(a){var o=Ms(a.target);if(o!==null){var c=s(o);if(c!==null){if(o=c.tag,o===13){if(o=l(c),o!==null){a.blockedOn=o,cs(a.priority,function(){yT(c)});return}}else if(o===31){if(o=u(c),o!==null){a.blockedOn=o,cs(a.priority,function(){yT(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Fy(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var c=L_(a.nativeEvent);if(c===null){c=a.nativeEvent;var m=new c.constructor(c.type,c);ui=m,c.target.dispatchEvent(m),ui=null}else return o=Fs(c),o!==null&&mT(o),a.blockedOn=c,!1;o.shift()}return!0}function xT(a,o,c){Fy(a)&&c.delete(o)}function xP(){P_=!1,xh!==null&&Fy(xh)&&(xh=null),wh!==null&&Fy(wh)&&(wh=null),Sh!==null&&Fy(Sh)&&(Sh=null),fg.forEach(xT),pg.forEach(xT)}function jy(a,o){a.blockedOn===o&&(a.blockedOn=null,P_||(P_=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,xP)))}var Vy=null;function wT(a){Vy!==a&&(Vy=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Vy===a&&(Vy=null);for(var o=0;o<a.length;o+=3){var c=a[o],m=a[o+1],C=a[o+2];if(typeof m!="function"){if(N_(m||c)===null)continue;break}var L=Fs(c);L!==null&&(a.splice(o,3),o-=3,Lv(L,{pending:!0,data:C,method:c.method,action:m},m,C))}}))}function Lf(a){function o(Ke){return jy(Ke,a)}xh!==null&&jy(xh,a),wh!==null&&jy(wh,a),Sh!==null&&jy(Sh,a),fg.forEach(o),pg.forEach(o);for(var c=0;c<Th.length;c++){var m=Th[c];m.blockedOn===a&&(m.blockedOn=null)}for(;0<Th.length&&(c=Th[0],c.blockedOn===null);)bT(c),c.blockedOn===null&&Th.shift();if(c=(a.ownerDocument||a).$$reactFormReplay,c!=null)for(m=0;m<c.length;m+=3){var C=c[m],L=c[m+1],Z=C[Yi]||null;if(typeof L=="function")Z||wT(c);else if(Z){var Se=null;if(L&&L.hasAttribute("formAction")){if(C=L,Z=L[Yi]||null)Se=Z.formAction;else if(N_(C)!==null)continue}else Se=Z.action;typeof Se=="function"?c[m+1]=Se:(c.splice(m,3),m-=3),wT(c)}}}function ST(){function a(L){L.canIntercept&&L.info==="react-transition"&&L.intercept({handler:function(){return new Promise(function(Z){return C=Z})},focusReset:"manual",scroll:"manual"})}function o(){C!==null&&(C(),C=null),m||setTimeout(c,20)}function c(){if(!m&&!navigation.transition){var L=navigation.currentEntry;L&&L.url!=null&&navigation.navigate(L.url,{state:L.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,C=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(c,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),C!==null&&(C(),C=null)}}}function O_(a){this._internalRoot=a}zy.prototype.render=O_.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(n(409));var c=o.current,m=Pl();pT(c,m,a,o,null,null)},zy.prototype.unmount=O_.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;pT(a.current,2,null,a,null,null),by(),o[Xr]=null}};function zy(a){this._internalRoot=a}zy.prototype.unstable_scheduleHydration=function(a){if(a){var o=cr();a={blockedOn:null,target:a,priority:o};for(var c=0;c<Th.length&&o!==0&&o<Th[c].priority;c++);Th.splice(c,0,a),c===0&&bT(a)}};var TT=e.version;if(TT!=="19.2.0")throw Error(n(527,TT,"19.2.0"));Je.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(n(188)):(a=Object.keys(a).join(","),Error(n(268,a)));return a=f(o),a=a!==null?x(a):null,a=a===null?null:a.stateNode,a};var wP={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:je,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uy.isDisabled&&Uy.supportsFiber)try{Jn=Uy.inject(wP),vn=Uy}catch{}}return yg.createRoot=function(a,o){if(!r(a))throw Error(n(299));var c=!1,m="",C=DS,L=LS,Z=NS;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(C=o.onUncaughtError),o.onCaughtError!==void 0&&(L=o.onCaughtError),o.onRecoverableError!==void 0&&(Z=o.onRecoverableError)),o=dT(a,1,!1,null,null,c,m,null,C,L,Z,ST),a[Xr]=o.current,m_(a),new O_(o)},yg.hydrateRoot=function(a,o,c){if(!r(a))throw Error(n(299));var m=!1,C="",L=DS,Z=LS,Se=NS,Ke=null;return c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(C=c.identifierPrefix),c.onUncaughtError!==void 0&&(L=c.onUncaughtError),c.onCaughtError!==void 0&&(Z=c.onCaughtError),c.onRecoverableError!==void 0&&(Se=c.onRecoverableError),c.formState!==void 0&&(Ke=c.formState)),o=dT(a,1,!0,o,c??null,m,C,Ke,L,Z,Se,ST),o.context=fT(null),c=o.current,m=Pl(),m=Oi(m),C=Dn(m),C.callback=null,Nn(c,C,m),c=m,o.current.lanes=c,pn(o,c),Gu(o),a[Xr]=o.current,m_(a),new zy(o)},yg.version="19.2.0",yg}var PT;function NP(){if(PT)return j_.exports;PT=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),j_.exports=LP(),j_.exports}var PP=NP();var OT="popstate";function OP(i={}){function e(n,r){let{pathname:s,search:l,hash:u}=n.location;return Ub("",{pathname:s,search:l,hash:u},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:am(r)}return FP(e,t,null,i)}function Os(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function uu(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function MP(){return Math.random().toString(36).substring(2,10)}function MT(i,e){return{usr:i.state,key:i.key,idx:e}}function Ub(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Pp(e):e,state:t,key:e&&e.key||n||MP()}}function am({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Pp(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function FP(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,l=r.history,u="POP",h=null,f=x();f==null&&(f=0,l.replaceState({...l.state,idx:f},""));function x(){return(l.state||{idx:null}).idx}function p(){u="POP";let W=x(),q=W==null?null:W-f;f=W,h&&h({action:u,location:$.location,delta:q})}function w(W,q){u="PUSH";let ge=Ub($.location,W,q);f=x()+1;let he=MT(ge,f),me=$.createHref(ge);try{l.pushState(he,"",me)}catch(Ce){if(Ce instanceof DOMException&&Ce.name==="DataCloneError")throw Ce;r.location.assign(me)}s&&h&&h({action:u,location:$.location,delta:1})}function A(W,q){u="REPLACE";let ge=Ub($.location,W,q);f=x();let he=MT(ge,f),me=$.createHref(ge);l.replaceState(he,"",me),s&&h&&h({action:u,location:$.location,delta:0})}function B(W){return jP(W)}let $={get action(){return u},get location(){return i(r,l)},listen(W){if(h)throw new Error("A history only accepts one active listener");return r.addEventListener(OT,p),h=W,()=>{r.removeEventListener(OT,p),h=null}},createHref(W){return e(r,W)},createURL:B,encodeLocation(W){let q=B(W);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:w,replace:A,go(W){return l.go(W)}};return $}function jP(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Os(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:am(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function nC(i,e,t="/"){return VP(i,e,t,!1)}function VP(i,e,t,n){let r=typeof e=="string"?Pp(e):e,s=Wc(r.pathname||"/",t);if(s==null)return null;let l=iC(i);zP(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let f=JP(s);u=YP(l[h],f,n)}return u}function iC(i,e=[],t=[],n="",r=!1){let s=(l,u,h=r,f)=>{let x={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(x.relativePath.startsWith("/")){if(!x.relativePath.startsWith(n)&&h)return;Os(x.relativePath.startsWith(n),`Absolute route path "${x.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),x.relativePath=x.relativePath.slice(n.length)}let p=Gc([n,x.relativePath]),w=t.concat(x);l.children&&l.children.length>0&&(Os(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),iC(l.children,e,w,p,h)),!(l.path==null&&!l.index)&&e.push({path:p,score:WP(p,l.index),routesMeta:w})};return i.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))s(l,u);else for(let h of rC(l.path))s(l,u,!0,h)}),e}function rC(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let l=rC(n.join("/")),u=[];return u.push(...l.map(h=>h===""?s:[s,h].join("/"))),r&&u.push(...l),u.map(h=>i.startsWith("/")&&h===""?"/":h)}function zP(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:qP(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var UP=/^:[\w-]+$/,BP=3,$P=2,HP=1,GP=10,KP=-2,FT=i=>i==="*";function WP(i,e){let t=i.split("/"),n=t.length;return t.some(FT)&&(n+=KP),e&&(n+=$P),t.filter(r=>!FT(r)).reduce((r,s)=>r+(UP.test(s)?BP:s===""?HP:GP),n)}function qP(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function YP(i,e,t=!1){let{routesMeta:n}=i,r={},s="/",l=[];for(let u=0;u<n.length;++u){let h=n[u],f=u===n.length-1,x=s==="/"?e:e.slice(s.length)||"/",p=$0({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},x),w=h.route;if(!p&&f&&t&&!n[n.length-1].route.index&&(p=$0({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},x)),!p)return null;Object.assign(r,p.params),l.push({params:r,pathname:Gc([s,p.pathname]),pathnameBase:nO(Gc([s,p.pathnameBase])),route:w}),p.pathnameBase!=="/"&&(s=Gc([s,p.pathnameBase]))}return l}function $0(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=XP(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],l=s.replace(/(.)\/+$/,"$1"),u=r.slice(1);return{params:n.reduce((f,{paramName:x,isOptional:p},w)=>{if(x==="*"){let B=u[w]||"";l=s.slice(0,s.length-B.length).replace(/(.)\/+$/,"$1")}const A=u[w];return p&&!A?f[x]=void 0:f[x]=(A||"").replace(/%2F/g,"/"),f},{}),pathname:s,pathnameBase:l,pattern:i}}function XP(i,e=!1,t=!0){uu(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(n.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function JP(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return uu(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Wc(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}var QP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ZP=i=>QP.test(i);function eO(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?Pp(i):i,s;if(t)if(ZP(t))s=t;else{if(t.includes("//")){let l=t;t=t.replace(/\/\/+/g,"/"),uu(!1,`Pathnames cannot have embedded double slashes - normalizing ${l} -> ${t}`)}t.startsWith("/")?s=jT(t.substring(1),"/"):s=jT(t,e)}else s=e;return{pathname:s,search:iO(n),hash:rO(r)}}function jT(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function B_(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function tO(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function sC(i){let e=tO(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function aC(i,e,t,n=!1){let r;typeof i=="string"?r=Pp(i):(r={...i},Os(!r.pathname||!r.pathname.includes("?"),B_("?","pathname","search",r)),Os(!r.pathname||!r.pathname.includes("#"),B_("#","pathname","hash",r)),Os(!r.search||!r.search.includes("#"),B_("#","search","hash",r)));let s=i===""||r.pathname==="",l=s?"/":r.pathname,u;if(l==null)u=t;else{let p=e.length-1;if(!n&&l.startsWith("..")){let w=l.split("/");for(;w[0]==="..";)w.shift(),p-=1;r.pathname=w.join("/")}u=p>=0?e[p]:"/"}let h=eO(r,u),f=l&&l!=="/"&&l.endsWith("/"),x=(s||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(f||x)&&(h.pathname+="/"),h}var Gc=i=>i.join("/").replace(/\/\/+/g,"/"),nO=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),iO=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,rO=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function sO(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var oC=["POST","PUT","PATCH","DELETE"];new Set(oC);var aO=["GET",...oC];new Set(aO);var Op=we.createContext(null);Op.displayName="DataRouter";var F1=we.createContext(null);F1.displayName="DataRouterState";we.createContext(!1);var lC=we.createContext({isTransitioning:!1});lC.displayName="ViewTransition";var oO=we.createContext(new Map);oO.displayName="Fetchers";var lO=we.createContext(null);lO.displayName="Await";var ac=we.createContext(null);ac.displayName="Navigation";var Pm=we.createContext(null);Pm.displayName="Location";var th=we.createContext({outlet:null,matches:[],isDataRoute:!1});th.displayName="Route";var o2=we.createContext(null);o2.displayName="RouteError";function uO(i,{relative:e}={}){Os(Om(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=we.useContext(ac),{hash:r,pathname:s,search:l}=Mm(i,{relative:e}),u=s;return t!=="/"&&(u=s==="/"?t:Gc([t,s])),n.createHref({pathname:u,search:l,hash:r})}function Om(){return we.useContext(Pm)!=null}function ud(){return Os(Om(),"useLocation() may be used only in the context of a <Router> component."),we.useContext(Pm).location}var uC="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function cC(i){we.useContext(ac).static||we.useLayoutEffect(i)}function Mp(){let{isDataRoute:i}=we.useContext(th);return i?wO():cO()}function cO(){Os(Om(),"useNavigate() may be used only in the context of a <Router> component.");let i=we.useContext(Op),{basename:e,navigator:t}=we.useContext(ac),{matches:n}=we.useContext(th),{pathname:r}=ud(),s=JSON.stringify(sC(n)),l=we.useRef(!1);return cC(()=>{l.current=!0}),we.useCallback((h,f={})=>{if(uu(l.current,uC),!l.current)return;if(typeof h=="number"){t.go(h);return}let x=aC(h,JSON.parse(s),r,f.relative==="path");i==null&&e!=="/"&&(x.pathname=x.pathname==="/"?e:Gc([e,x.pathname])),(f.replace?t.replace:t.push)(x,f.state,f)},[e,t,s,r,i])}we.createContext(null);function Mm(i,{relative:e}={}){let{matches:t}=we.useContext(th),{pathname:n}=ud(),r=JSON.stringify(sC(t));return we.useMemo(()=>aC(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function hO(i,e){return hC(i,e)}function hC(i,e,t,n,r){Os(Om(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=we.useContext(ac),{matches:l}=we.useContext(th),u=l[l.length-1],h=u?u.params:{},f=u?u.pathname:"/",x=u?u.pathnameBase:"/",p=u&&u.route;{let ge=p&&p.path||"";dC(f,!p||ge.endsWith("*")||ge.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${ge}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ge}"> to <Route path="${ge==="/"?"*":`${ge}/*`}">.`)}let w=ud(),A;if(e){let ge=typeof e=="string"?Pp(e):e;Os(x==="/"||ge.pathname?.startsWith(x),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${x}" but pathname "${ge.pathname}" was given in the \`location\` prop.`),A=ge}else A=w;let B=A.pathname||"/",$=B;if(x!=="/"){let ge=x.replace(/^\//,"").split("/");$="/"+B.replace(/^\//,"").split("/").slice(ge.length).join("/")}let W=nC(i,{pathname:$});uu(p||W!=null,`No routes matched location "${A.pathname}${A.search}${A.hash}" `),uu(W==null||W[W.length-1].route.element!==void 0||W[W.length-1].route.Component!==void 0||W[W.length-1].route.lazy!==void 0,`Matched leaf route at location "${A.pathname}${A.search}${A.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let q=mO(W&&W.map(ge=>Object.assign({},ge,{params:Object.assign({},h,ge.params),pathname:Gc([x,s.encodeLocation?s.encodeLocation(ge.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ge.pathname]),pathnameBase:ge.pathnameBase==="/"?x:Gc([x,s.encodeLocation?s.encodeLocation(ge.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ge.pathnameBase])})),l,t,n,r);return e&&q?we.createElement(Pm.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...A},navigationType:"POP"}},q):q}function dO(){let i=xO(),e=sO(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},l=null;return console.error("Error handled by React Router default ErrorBoundary:",i),l=we.createElement(we.Fragment,null,we.createElement("p",null," Hey developer "),we.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",we.createElement("code",{style:s},"ErrorBoundary")," or"," ",we.createElement("code",{style:s},"errorElement")," prop on your route.")),we.createElement(we.Fragment,null,we.createElement("h2",null,"Unexpected Application Error!"),we.createElement("h3",{style:{fontStyle:"italic"}},e),t?we.createElement("pre",{style:r},t):null,l)}var fO=we.createElement(dO,null),pO=class extends we.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?we.createElement(th.Provider,{value:this.props.routeContext},we.createElement(o2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function gO({routeContext:i,match:e,children:t}){let n=we.useContext(Op);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),we.createElement(th.Provider,{value:i},t)}function mO(i,e=[],t=null,n=null,r=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let s=i,l=t?.errors;if(l!=null){let x=s.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);Os(x>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),s=s.slice(0,Math.min(s.length,x+1))}let u=!1,h=-1;if(t)for(let x=0;x<s.length;x++){let p=s[x];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=x),p.route.id){let{loaderData:w,errors:A}=t,B=p.route.loader&&!w.hasOwnProperty(p.route.id)&&(!A||A[p.route.id]===void 0);if(p.route.lazy||B){u=!0,h>=0?s=s.slice(0,h+1):s=[s[0]];break}}}let f=t&&n?(x,p)=>{n(x,{location:t.location,params:t.matches?.[0]?.params??{},errorInfo:p})}:void 0;return s.reduceRight((x,p,w)=>{let A,B=!1,$=null,W=null;t&&(A=l&&p.route.id?l[p.route.id]:void 0,$=p.route.errorElement||fO,u&&(h<0&&w===0?(dC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),B=!0,W=null):h===w&&(B=!0,W=p.route.hydrateFallbackElement||null)));let q=e.concat(s.slice(0,w+1)),ge=()=>{let he;return A?he=$:B?he=W:p.route.Component?he=we.createElement(p.route.Component,null):p.route.element?he=p.route.element:he=x,we.createElement(gO,{match:p,routeContext:{outlet:x,matches:q,isDataRoute:t!=null},children:he})};return t&&(p.route.ErrorBoundary||p.route.errorElement||w===0)?we.createElement(pO,{location:t.location,revalidation:t.revalidation,component:$,error:A,children:ge(),routeContext:{outlet:null,matches:q,isDataRoute:!0},onError:f}):ge()},null)}function l2(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yO(i){let e=we.useContext(Op);return Os(e,l2(i)),e}function vO(i){let e=we.useContext(F1);return Os(e,l2(i)),e}function _O(i){let e=we.useContext(th);return Os(e,l2(i)),e}function u2(i){let e=_O(i),t=e.matches[e.matches.length-1];return Os(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function bO(){return u2("useRouteId")}function xO(){let i=we.useContext(o2),e=vO("useRouteError"),t=u2("useRouteError");return i!==void 0?i:e.errors?.[t]}function wO(){let{router:i}=yO("useNavigate"),e=u2("useNavigate"),t=we.useRef(!1);return cC(()=>{t.current=!0}),we.useCallback(async(r,s={})=>{uu(t.current,uC),t.current&&(typeof r=="number"?i.navigate(r):await i.navigate(r,{fromRouteId:e,...s}))},[i,e])}var VT={};function dC(i,e,t){!e&&!VT[i]&&(VT[i]=!0,uu(!1,t))}we.memo(SO);function SO({routes:i,future:e,state:t,unstable_onError:n}){return hC(i,void 0,t,n,e)}function Ng(i){Os(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function TO({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:s=!1}){Os(!Om(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=i.replace(/^\/*/,"/"),u=we.useMemo(()=>({basename:l,navigator:r,static:s,future:{}}),[l,r,s]);typeof t=="string"&&(t=Pp(t));let{pathname:h="/",search:f="",hash:x="",state:p=null,key:w="default"}=t,A=we.useMemo(()=>{let B=Wc(h,l);return B==null?null:{location:{pathname:B,search:f,hash:x,state:p,key:w},navigationType:n}},[l,h,f,x,p,w,n]);return uu(A!=null,`<Router basename="${l}"> is not able to match the URL "${h}${f}${x}" because it does not start with the basename, so the <Router> won't render anything.`),A==null?null:we.createElement(ac.Provider,{value:u},we.createElement(Pm.Provider,{children:e,value:A}))}function AO({children:i,location:e}){return hO(Bb(i),e)}function Bb(i,e=[]){let t=[];return we.Children.forEach(i,(n,r)=>{if(!we.isValidElement(n))return;let s=[...e,r];if(n.type===we.Fragment){t.push.apply(t,Bb(n.props.children,s));return}Os(n.type===Ng,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Os(!n.props.index||!n.props.children,"An index route cannot have child routes.");let l={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=Bb(n.props.children,s)),t.push(l)}),t}var p0="get",g0="application/x-www-form-urlencoded";function j1(i){return i!=null&&typeof i.tagName=="string"}function EO(i){return j1(i)&&i.tagName.toLowerCase()==="button"}function IO(i){return j1(i)&&i.tagName.toLowerCase()==="form"}function kO(i){return j1(i)&&i.tagName.toLowerCase()==="input"}function CO(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function RO(i,e){return i.button===0&&(!e||e==="_self")&&!CO(i)}function $b(i=""){return new URLSearchParams(typeof i=="string"||Array.isArray(i)||i instanceof URLSearchParams?i:Object.keys(i).reduce((e,t)=>{let n=i[t];return e.concat(Array.isArray(n)?n.map(r=>[t,r]):[[t,n]])},[]))}function DO(i,e){let t=$b(i);return e&&e.forEach((n,r)=>{t.has(r)||e.getAll(r).forEach(s=>{t.append(r,s)})}),t}var By=null;function LO(){if(By===null)try{new FormData(document.createElement("form"),0),By=!1}catch{By=!0}return By}var NO=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function $_(i){return i!=null&&!NO.has(i)?(uu(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${g0}"`),null):i}function PO(i,e){let t,n,r,s,l;if(IO(i)){let u=i.getAttribute("action");n=u?Wc(u,e):null,t=i.getAttribute("method")||p0,r=$_(i.getAttribute("enctype"))||g0,s=new FormData(i)}else if(EO(i)||kO(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=i.getAttribute("formaction")||u.getAttribute("action");if(n=h?Wc(h,e):null,t=i.getAttribute("formmethod")||u.getAttribute("method")||p0,r=$_(i.getAttribute("formenctype"))||$_(u.getAttribute("enctype"))||g0,s=new FormData(u,i),!LO()){let{name:f,type:x,value:p}=i;if(x==="image"){let w=f?`${f}.`:"";s.append(`${w}x`,"0"),s.append(`${w}y`,"0")}else f&&s.append(f,p)}}else{if(j1(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=p0,n=null,r=g0,l=i}return s&&r==="text/plain"&&(l=s,s=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:s,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function c2(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function OO(i,e,t){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&Wc(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function MO(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function FO(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function jO(i,e,t){let n=await Promise.all(i.map(async r=>{let s=e.routes[r.route.id];if(s){let l=await MO(s,t);return l.links?l.links():[]}return[]}));return BO(n.flat(1).filter(FO).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function zT(i,e,t,n,r,s){let l=(h,f)=>t[f]?h.route.id!==t[f].route.id:!0,u=(h,f)=>t[f].pathname!==h.pathname||t[f].route.path?.endsWith("*")&&t[f].params["*"]!==h.params["*"];return s==="assets"?e.filter((h,f)=>l(h,f)||u(h,f)):s==="data"?e.filter((h,f)=>{let x=n.routes[h.route.id];if(!x||!x.hasLoader)return!1;if(l(h,f)||u(h,f))return!0;if(h.route.shouldRevalidate){let p=h.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function VO(i,e,{includeHydrateFallback:t}={}){return zO(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function zO(i){return[...new Set(i)]}function UO(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function BO(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let s=JSON.stringify(UO(r));return t.has(s)||(t.add(s),n.push({key:s,link:r})),n},[])}function fC(){let i=we.useContext(Op);return c2(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function $O(){let i=we.useContext(F1);return c2(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var h2=we.createContext(void 0);h2.displayName="FrameworkContext";function pC(){let i=we.useContext(h2);return c2(i,"You must render this element inside a <HydratedRouter> element"),i}function HO(i,e){let t=we.useContext(h2),[n,r]=we.useState(!1),[s,l]=we.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:f,onMouseLeave:x,onTouchStart:p}=e,w=we.useRef(null);we.useEffect(()=>{if(i==="render"&&l(!0),i==="viewport"){let $=q=>{q.forEach(ge=>{l(ge.isIntersecting)})},W=new IntersectionObserver($,{threshold:.5});return w.current&&W.observe(w.current),()=>{W.disconnect()}}},[i]),we.useEffect(()=>{if(n){let $=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout($)}}},[n]);let A=()=>{r(!0)},B=()=>{r(!1),l(!1)};return t?i!=="intent"?[s,w,{}]:[s,w,{onFocus:vg(u,A),onBlur:vg(h,B),onMouseEnter:vg(f,A),onMouseLeave:vg(x,B),onTouchStart:vg(p,A)}]:[!1,w,{}]}function vg(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function GO({page:i,...e}){let{router:t}=fC(),n=we.useMemo(()=>nC(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?we.createElement(WO,{page:i,matches:n,...e}):null}function KO(i){let{manifest:e,routeModules:t}=pC(),[n,r]=we.useState([]);return we.useEffect(()=>{let s=!1;return jO(i,e,t).then(l=>{s||r(l)}),()=>{s=!0}},[i,e,t]),n}function WO({page:i,matches:e,...t}){let n=ud(),{manifest:r,routeModules:s}=pC(),{basename:l}=fC(),{loaderData:u,matches:h}=$O(),f=we.useMemo(()=>zT(i,e,h,r,n,"data"),[i,e,h,r,n]),x=we.useMemo(()=>zT(i,e,h,r,n,"assets"),[i,e,h,r,n]),p=we.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let B=new Set,$=!1;if(e.forEach(q=>{let ge=r.routes[q.route.id];!ge||!ge.hasLoader||(!f.some(he=>he.route.id===q.route.id)&&q.route.id in u&&s[q.route.id]?.shouldRevalidate||ge.hasClientLoader?$=!0:B.add(q.route.id))}),B.size===0)return[];let W=OO(i,l,"data");return $&&B.size>0&&W.searchParams.set("_routes",e.filter(q=>B.has(q.route.id)).map(q=>q.route.id).join(",")),[W.pathname+W.search]},[l,u,n,r,f,e,i,s]),w=we.useMemo(()=>VO(x,r),[x,r]),A=KO(x);return we.createElement(we.Fragment,null,p.map(B=>we.createElement("link",{key:B,rel:"prefetch",as:"fetch",href:B,...t})),w.map(B=>we.createElement("link",{key:B,rel:"modulepreload",href:B,...t})),A.map(({key:B,link:$})=>we.createElement("link",{key:B,nonce:t.nonce,...$})))}function qO(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var gC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{gC&&(window.__reactRouterVersion="7.9.6")}catch{}function YO({basename:i,children:e,window:t}){let n=we.useRef();n.current==null&&(n.current=OP({window:t,v5Compat:!0}));let r=n.current,[s,l]=we.useState({action:r.action,location:r.location}),u=we.useCallback(h=>{we.startTransition(()=>l(h))},[l]);return we.useLayoutEffect(()=>r.listen(u),[r,u]),we.createElement(TO,{basename:i,children:e,location:s.location,navigationType:s.action,navigator:r})}var mC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,yC=we.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:s,replace:l,state:u,target:h,to:f,preventScrollReset:x,viewTransition:p,...w},A){let{basename:B}=we.useContext(ac),$=typeof f=="string"&&mC.test(f),W,q=!1;if(typeof f=="string"&&$&&(W=f,gC))try{let J=new URL(window.location.href),ye=f.startsWith("//")?new URL(J.protocol+f):new URL(f),X=Wc(ye.pathname,B);ye.origin===J.origin&&X!=null?f=X+ye.search+ye.hash:q=!0}catch{uu(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ge=uO(f,{relative:r}),[he,me,Ce]=HO(n,w),Ve=ZO(f,{replace:l,state:u,target:h,preventScrollReset:x,relative:r,viewTransition:p});function pe(J){e&&e(J),J.defaultPrevented||Ve(J)}let ee=we.createElement("a",{...w,...Ce,href:W||ge,onClick:q||s?e:pe,ref:qO(A,me),target:h,"data-discover":!$&&t==="render"?"true":void 0});return he&&!$?we.createElement(we.Fragment,null,ee,we.createElement(GO,{page:ge})):ee});yC.displayName="Link";var XO=we.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:s,to:l,viewTransition:u,children:h,...f},x){let p=Mm(l,{relative:f.relative}),w=ud(),A=we.useContext(F1),{navigator:B,basename:$}=we.useContext(ac),W=A!=null&&r6(p)&&u===!0,q=B.encodeLocation?B.encodeLocation(p).pathname:p.pathname,ge=w.pathname,he=A&&A.navigation&&A.navigation.location?A.navigation.location.pathname:null;t||(ge=ge.toLowerCase(),he=he?he.toLowerCase():null,q=q.toLowerCase()),he&&$&&(he=Wc(he,$)||he);const me=q!=="/"&&q.endsWith("/")?q.length-1:q.length;let Ce=ge===q||!r&&ge.startsWith(q)&&ge.charAt(me)==="/",Ve=he!=null&&(he===q||!r&&he.startsWith(q)&&he.charAt(q.length)==="/"),pe={isActive:Ce,isPending:Ve,isTransitioning:W},ee=Ce?e:void 0,J;typeof n=="function"?J=n(pe):J=[n,Ce?"active":null,Ve?"pending":null,W?"transitioning":null].filter(Boolean).join(" ");let ye=typeof s=="function"?s(pe):s;return we.createElement(yC,{...f,"aria-current":ee,className:J,ref:x,style:ye,to:l,viewTransition:u},typeof h=="function"?h(pe):h)});XO.displayName="NavLink";var JO=we.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:s,method:l=p0,action:u,onSubmit:h,relative:f,preventScrollReset:x,viewTransition:p,...w},A)=>{let B=n6(),$=i6(u,{relative:f}),W=l.toLowerCase()==="get"?"get":"post",q=typeof u=="string"&&mC.test(u),ge=he=>{if(h&&h(he),he.defaultPrevented)return;he.preventDefault();let me=he.nativeEvent.submitter,Ce=me?.getAttribute("formmethod")||l;B(me||he.currentTarget,{fetcherKey:e,method:Ce,navigate:t,replace:r,state:s,relative:f,preventScrollReset:x,viewTransition:p})};return we.createElement("form",{ref:A,method:W,action:$,onSubmit:n?h:ge,...w,"data-discover":!q&&i==="render"?"true":void 0})});JO.displayName="Form";function QO(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function vC(i){let e=we.useContext(Op);return Os(e,QO(i)),e}function ZO(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:s,viewTransition:l}={}){let u=Mp(),h=ud(),f=Mm(i,{relative:s});return we.useCallback(x=>{if(RO(x,e)){x.preventDefault();let p=t!==void 0?t:am(h)===am(f);u(i,{replace:p,state:n,preventScrollReset:r,relative:s,viewTransition:l})}},[h,u,f,t,n,e,i,r,s,l])}function _C(i){uu(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=we.useRef($b(i)),t=we.useRef(!1),n=ud(),r=we.useMemo(()=>DO(n.search,t.current?null:e.current),[n.search]),s=Mp(),l=we.useCallback((u,h)=>{const f=$b(typeof u=="function"?u(new URLSearchParams(r)):u);t.current=!0,s("?"+f,h)},[s,r]);return[r,l]}var e6=0,t6=()=>`__${String(++e6)}__`;function n6(){let{router:i}=vC("useSubmit"),{basename:e}=we.useContext(ac),t=bO();return we.useCallback(async(n,r={})=>{let{action:s,method:l,encType:u,formData:h,body:f}=PO(n,e);if(r.navigate===!1){let x=r.fetcherKey||t6();await i.fetch(x,t,r.action||s,{preventScrollReset:r.preventScrollReset,formData:h,body:f,formMethod:r.method||l,formEncType:r.encType||u,flushSync:r.flushSync})}else await i.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:h,body:f,formMethod:r.method||l,formEncType:r.encType||u,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[i,e,t])}function i6(i,{relative:e}={}){let{basename:t}=we.useContext(ac),n=we.useContext(th);Os(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),s={...Mm(i||".",{relative:e})},l=ud();if(i==null){s.search=l.search;let u=new URLSearchParams(s.search),h=u.getAll("index");if(h.some(x=>x==="")){u.delete("index"),h.filter(p=>p).forEach(p=>u.append("index",p));let x=u.toString();s.search=x?`?${x}`:""}}return(!i||i===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:Gc([t,s.pathname])),am(s)}function r6(i,{relative:e}={}){let t=we.useContext(lC);Os(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=vC("useViewTransitionState"),r=Mm(i,{relative:e});if(!t.isTransitioning)return!1;let s=Wc(t.currentLocation.pathname,n)||t.currentLocation.pathname,l=Wc(t.nextLocation.pathname,n)||t.nextLocation.pathname;return $0(r.pathname,l)!=null||$0(r.pathname,s)!=null}const s6=()=>{};var UT={};const bC={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const Kt=function(i,e){if(!i)throw Fp(e)},Fp=function(i){return new Error("Firebase Database ("+bC.SDK_VERSION+") INTERNAL ASSERT FAILED: "+i)};const xC=function(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(i.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},a6=function(i){const e=[];let t=0,n=0;for(;t<i.length;){const r=i[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const s=i[t++];e[n++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=i[t++],l=i[t++],u=i[t++],h=((r&7)<<18|(s&63)<<12|(l&63)<<6|u&63)-65536;e[n++]=String.fromCharCode(55296+(h>>10)),e[n++]=String.fromCharCode(56320+(h&1023))}else{const s=i[t++],l=i[t++];e[n++]=String.fromCharCode((r&15)<<12|(s&63)<<6|l&63)}}return e.join("")},d2={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<i.length;r+=3){const s=i[r],l=r+1<i.length,u=l?i[r+1]:0,h=r+2<i.length,f=h?i[r+2]:0,x=s>>2,p=(s&3)<<4|u>>4;let w=(u&15)<<2|f>>6,A=f&63;h||(A=64,l||(w=64)),n.push(t[x],t[p],t[w],t[A])}return n.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(xC(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):a6(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<i.length;){const s=t[i.charAt(r++)],u=r<i.length?t[i.charAt(r)]:0;++r;const f=r<i.length?t[i.charAt(r)]:64;++r;const p=r<i.length?t[i.charAt(r)]:64;if(++r,s==null||u==null||f==null||p==null)throw new o6;const w=s<<2|u>>4;if(n.push(w),f!==64){const A=u<<4&240|f>>2;if(n.push(A),p!==64){const B=f<<6&192|p;n.push(B)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class o6 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wC=function(i){const e=xC(i);return d2.encodeByteArray(e,!0)},H0=function(i){return wC(i).replace(/\./g,"")},G0=function(i){try{return d2.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function l6(i){return SC(void 0,i)}function SC(i,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:i===void 0&&(i={});break;case Array:i=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!u6(t)||(i[t]=SC(i[t],e[t]));return i}function u6(i){return i!=="__proto__"}function TC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const c6=()=>TC().__FIREBASE_DEFAULTS__,h6=()=>{if(typeof process>"u"||typeof UT>"u")return;const i=UT.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},d6=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&G0(i[1]);return e&&JSON.parse(e)},V1=()=>{try{return s6()||c6()||h6()||d6()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},AC=i=>V1()?.emulatorHosts?.[i],f2=i=>{const e=AC(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},EC=()=>V1()?.config,IC=i=>V1()?.[`_${i}`];class Fm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}function oc(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function z1(i){return(await fetch(i,{credentials:"include"})).ok}function p2(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=i.iat||0,s=i.sub||i.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...i};return[H0(JSON.stringify(t)),H0(JSON.stringify(l)),""].join(".")}const Bg={};function f6(){const i={prod:[],emulator:[]};for(const e of Object.keys(Bg))Bg[e]?i.emulator.push(e):i.prod.push(e);return i}function p6(i){let e=document.getElementById(i),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",i),t=!0),{created:t,element:e}}let BT=!1;function U1(i,e){if(typeof window>"u"||typeof document>"u"||!oc(window.location.host)||Bg[i]===e||Bg[i]||BT)return;Bg[i]=e;function t(w){return`__firebase__banner__${w}`}const n="__firebase__banner",s=f6().prod.length>0;function l(){const w=document.getElementById(n);w&&w.remove()}function u(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function h(w,A){w.setAttribute("width","24"),w.setAttribute("id",A),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function f(){const w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{BT=!0,l()},w}function x(w,A){w.setAttribute("id",A),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function p(){const w=p6(n),A=t("text"),B=document.getElementById(A)||document.createElement("span"),$=t("learnmore"),W=document.getElementById($)||document.createElement("a"),q=t("preprendIcon"),ge=document.getElementById(q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){const he=w.element;u(he),x(W,$);const me=f();h(ge,q),he.append(ge,B,W,me),document.body.appendChild(he)}s?(B.innerText="Preview backend disconnected.",ge.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ge.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,B.innerText="Preview backend running in this workspace."),B.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function za(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function g2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(za())}function kC(){const i=V1()?.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function g6(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function m6(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function CC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function y6(){const i=za();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function v6(){return bC.NODE_ADMIN===!0}function RC(){return!kC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function DC(){return!kC()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function LC(){try{return typeof indexedDB=="object"}catch{return!1}}function _6(){return new Promise((i,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),i(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const b6="FirebaseError";class lc extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=b6,Object.setPrototypeOf(this,lc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jm.prototype.create)}}class jm{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],l=s?x6(s,n):"Error",u=`${this.serviceName}: ${l} (${r}).`;return new lc(r,u,n)}}function x6(i,e){return i.replace(w6,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const w6=/\{\$([^}]+)}/g;function om(i){return JSON.parse(i)}function Va(i){return JSON.stringify(i)}const NC=function(i){let e={},t={},n={},r="";try{const s=i.split(".");e=om(G0(s[0])||""),t=om(G0(s[1])||""),r=s[2],n=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:n,signature:r}},S6=function(i){const e=NC(i),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},T6=function(i){const e=NC(i).claims;return typeof e=="object"&&e.admin===!0};function uc(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function pp(i,e){if(Object.prototype.hasOwnProperty.call(i,e))return i[e]}function Hb(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function K0(i,e,t){const n={};for(const r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=e.call(t,i[r],r,i));return n}function Qh(i,e){if(i===e)return!0;const t=Object.keys(i),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const s=i[r],l=e[r];if($T(s)&&$T(l)){if(!Qh(s,l))return!1}else if(s!==l)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function $T(i){return i!==null&&typeof i=="object"}function jp(i){const e=[];for(const[t,n]of Object.entries(i))Array.isArray(n)?n.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Pg(i){const e={};return i.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[r,s]=n.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function Og(i){const e=i.indexOf("?");if(!e)return"";const t=i.indexOf("#",e);return i.substring(e,t>0?t:void 0)}class A6{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)n[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)n[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const w=n[p-3]^n[p-8]^n[p-14]^n[p-16];n[p]=(w<<1|w>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],l=this.chain_[2],u=this.chain_[3],h=this.chain_[4],f,x;for(let p=0;p<80;p++){p<40?p<20?(f=u^s&(l^u),x=1518500249):(f=s^l^u,x=1859775393):p<60?(f=s&l|u&(s|l),x=2400959708):(f=s^l^u,x=3395469782);const w=(r<<5|r>>>27)+f+h+x+n[p]&4294967295;h=u,u=l,l=(s<<30|s>>>2)&4294967295,s=r,r=w}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const n=t-this.blockSize;let r=0;const s=this.buf_;let l=this.inbuf_;for(;r<t;){if(l===0)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(s[l]=e.charCodeAt(r),++l,++r,l===this.blockSize){this.compress_(s),l=0;break}}else for(;r<t;)if(s[l]=e[r],++l,++r,l===this.blockSize){this.compress_(s),l=0;break}}this.inbuf_=l,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[n]=this.chain_[r]>>s&255,++n;return e}}function E6(i,e){const t=new I6(i,e);return t.subscribe.bind(t)}class I6{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");k6(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:n},r.next===void 0&&(r.next=H_),r.error===void 0&&(r.error=H_),r.complete===void 0&&(r.complete=H_);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function k6(i,e){if(typeof i!="object"||i===null)return!1;for(const t of e)if(t in i&&typeof i[t]=="function")return!0;return!1}function H_(){}function B1(i,e){return`${i} failed: ${e} argument `}const C6=function(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);if(r>=55296&&r<=56319){const s=r-55296;n++,Kt(n<i.length,"Surrogate pair missing trail surrogate.");const l=i.charCodeAt(n)-56320;r=65536+(s<<10)+l}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},$1=function(i){let e=0;for(let t=0;t<i.length;t++){const n=i.charCodeAt(t);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,t++):e+=3}return e};function us(i){return i&&i._delegate?i._delegate:i}class qc{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Id="[DEFAULT]";class R6{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Fm;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(n)return null;throw r}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(L6(e))try{this.getOrInitializeService({instanceIdentifier:Id})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});n.resolve(s)}catch{}}}}clearInstance(e=Id){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Id){return this.instances.has(e)}getOptions(e=Id){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(s);n===u&&l.resolve(r)}return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const s=this.instances.get(n);return s&&e(s,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:D6(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Id){return this.component?this.component.multipleInstances?e:Id:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function D6(i){return i===Id?void 0:i}function L6(i){return i.instantiationMode==="EAGER"}class N6{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new R6(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Ki;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Ki||(Ki={}));const P6={debug:Ki.DEBUG,verbose:Ki.VERBOSE,info:Ki.INFO,warn:Ki.WARN,error:Ki.ERROR,silent:Ki.SILENT},O6=Ki.INFO,M6={[Ki.DEBUG]:"log",[Ki.VERBOSE]:"log",[Ki.INFO]:"info",[Ki.WARN]:"warn",[Ki.ERROR]:"error"},F6=(i,e,...t)=>{if(e<i.logLevel)return;const n=new Date().toISOString(),r=M6[e];if(r)console[r](`[${n}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class H1{constructor(e){this.name=e,this._logLevel=O6,this._logHandler=F6,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ki))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?P6[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ki.DEBUG,...e),this._logHandler(this,Ki.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ki.VERBOSE,...e),this._logHandler(this,Ki.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ki.INFO,...e),this._logHandler(this,Ki.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ki.WARN,...e),this._logHandler(this,Ki.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ki.ERROR,...e),this._logHandler(this,Ki.ERROR,...e)}}const j6=(i,e)=>e.some(t=>i instanceof t);let HT,GT;function V6(){return HT||(HT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function z6(){return GT||(GT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const PC=new WeakMap,Gb=new WeakMap,OC=new WeakMap,G_=new WeakMap,m2=new WeakMap;function U6(i){const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("success",s),i.removeEventListener("error",l)},s=()=>{t($h(i.result)),r()},l=()=>{n(i.error),r()};i.addEventListener("success",s),i.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&PC.set(t,i)}).catch(()=>{}),m2.set(e,i),e}function B6(i){if(Gb.has(i))return;const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("complete",s),i.removeEventListener("error",l),i.removeEventListener("abort",l)},s=()=>{t(),r()},l=()=>{n(i.error||new DOMException("AbortError","AbortError")),r()};i.addEventListener("complete",s),i.addEventListener("error",l),i.addEventListener("abort",l)});Gb.set(i,e)}let Kb={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return Gb.get(i);if(e==="objectStoreNames")return i.objectStoreNames||OC.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return $h(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function $6(i){Kb=i(Kb)}function H6(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=i.call(K_(this),e,...t);return OC.set(n,e.sort?e.sort():[e]),$h(n)}:z6().includes(i)?function(...e){return i.apply(K_(this),e),$h(PC.get(this))}:function(...e){return $h(i.apply(K_(this),e))}}function G6(i){return typeof i=="function"?H6(i):(i instanceof IDBTransaction&&B6(i),j6(i,V6())?new Proxy(i,Kb):i)}function $h(i){if(i instanceof IDBRequest)return U6(i);if(G_.has(i))return G_.get(i);const e=G6(i);return e!==i&&(G_.set(i,e),m2.set(e,i)),e}const K_=i=>m2.get(i);function K6(i,e,{blocked:t,upgrade:n,blocking:r,terminated:s}={}){const l=indexedDB.open(i,e),u=$h(l);return n&&l.addEventListener("upgradeneeded",h=>{n($h(l.result),h.oldVersion,h.newVersion,$h(l.transaction),h)}),t&&l.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{s&&h.addEventListener("close",()=>s()),r&&h.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const W6=["get","getKey","getAll","getAllKeys","count"],q6=["put","add","delete","clear"],W_=new Map;function KT(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(W_.get(e))return W_.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=q6.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||W6.includes(t)))return;const s=async function(l,...u){const h=this.transaction(l,r?"readwrite":"readonly");let f=h.store;return n&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),r&&h.done]))[0]};return W_.set(e,s),s}$6(i=>({...i,get:(e,t,n)=>KT(e,t)||i.get(e,t,n),has:(e,t)=>!!KT(e,t)||i.has(e,t)}));class Y6{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(X6(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function X6(i){return i.getComponent()?.type==="VERSION"}const Wb="@firebase/app",WT="0.14.6";const Yc=new H1("@firebase/app"),J6="@firebase/app-compat",Q6="@firebase/analytics-compat",Z6="@firebase/analytics",eM="@firebase/app-check-compat",tM="@firebase/app-check",nM="@firebase/auth",iM="@firebase/auth-compat",rM="@firebase/database",sM="@firebase/data-connect",aM="@firebase/database-compat",oM="@firebase/functions",lM="@firebase/functions-compat",uM="@firebase/installations",cM="@firebase/installations-compat",hM="@firebase/messaging",dM="@firebase/messaging-compat",fM="@firebase/performance",pM="@firebase/performance-compat",gM="@firebase/remote-config",mM="@firebase/remote-config-compat",yM="@firebase/storage",vM="@firebase/storage-compat",_M="@firebase/firestore",bM="@firebase/ai",xM="@firebase/firestore-compat",wM="firebase",SM="12.6.0";const qb="[DEFAULT]",TM={[Wb]:"fire-core",[J6]:"fire-core-compat",[Z6]:"fire-analytics",[Q6]:"fire-analytics-compat",[tM]:"fire-app-check",[eM]:"fire-app-check-compat",[nM]:"fire-auth",[iM]:"fire-auth-compat",[rM]:"fire-rtdb",[sM]:"fire-data-connect",[aM]:"fire-rtdb-compat",[oM]:"fire-fn",[lM]:"fire-fn-compat",[uM]:"fire-iid",[cM]:"fire-iid-compat",[hM]:"fire-fcm",[dM]:"fire-fcm-compat",[fM]:"fire-perf",[pM]:"fire-perf-compat",[gM]:"fire-rc",[mM]:"fire-rc-compat",[yM]:"fire-gcs",[vM]:"fire-gcs-compat",[_M]:"fire-fst",[xM]:"fire-fst-compat",[bM]:"fire-vertex","fire-js":"fire-js",[wM]:"fire-js-all"};const W0=new Map,AM=new Map,Yb=new Map;function qT(i,e){try{i.container.addComponent(e)}catch(t){Yc.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function Zh(i){const e=i.name;if(Yb.has(e))return Yc.debug(`There were multiple attempts to register component ${e}.`),!1;Yb.set(e,i);for(const t of W0.values())qT(t,i);for(const t of AM.values())qT(t,i);return!0}function Vm(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}function Mo(i){return i==null?!1:i.settings!==void 0}const EM={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Hh=new jm("app","Firebase",EM);class IM{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new qc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Hh.create("app-deleted",{appName:this._name})}}const cd=SM;function G1(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const n={name:qb,automaticDataCollectionEnabled:!0,...e},r=n.name;if(typeof r!="string"||!r)throw Hh.create("bad-app-name",{appName:String(r)});if(t||(t=EC()),!t)throw Hh.create("no-options");const s=W0.get(r);if(s){if(Qh(t,s.options)&&Qh(n,s.config))return s;throw Hh.create("duplicate-app",{appName:r})}const l=new N6(r);for(const h of Yb.values())l.addComponent(h);const u=new IM(t,n,l);return W0.set(r,u),u}function K1(i=qb){const e=W0.get(i);if(!e&&i===qb&&EC())return G1();if(!e)throw Hh.create("no-app",{appName:i});return e}function ou(i,e,t){let n=TM[i]??i;t&&(n+=`-${t}`);const r=n.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const l=[`Unable to register library "${n}" with version "${e}":`];r&&l.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&s&&l.push("and"),s&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Yc.warn(l.join(" "));return}Zh(new qc(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}const kM="firebase-heartbeat-database",CM=1,lm="firebase-heartbeat-store";let q_=null;function MC(){return q_||(q_=K6(kM,CM,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(lm)}catch(t){console.warn(t)}}}}).catch(i=>{throw Hh.create("idb-open",{originalErrorMessage:i.message})})),q_}async function RM(i){try{const t=(await MC()).transaction(lm),n=await t.objectStore(lm).get(FC(i));return await t.done,n}catch(e){if(e instanceof lc)Yc.warn(e.message);else{const t=Hh.create("idb-get",{originalErrorMessage:e?.message});Yc.warn(t.message)}}}async function YT(i,e){try{const n=(await MC()).transaction(lm,"readwrite");await n.objectStore(lm).put(e,FC(i)),await n.done}catch(t){if(t instanceof lc)Yc.warn(t.message);else{const n=Hh.create("idb-set",{originalErrorMessage:t?.message});Yc.warn(n.message)}}}function FC(i){return`${i.name}!${i.options.appId}`}const DM=1024,LM=30;class NM{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new OM(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=XT();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(r=>r.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>LM){const r=MM(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Yc.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=XT(),{heartbeatsToSend:t,unsentEntries:n}=PM(this._heartbeatsCache.heartbeats),r=H0(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Yc.warn(e),""}}}function XT(){return new Date().toISOString().substring(0,10)}function PM(i,e=DM){const t=[];let n=i.slice();for(const r of i){const s=t.find(l=>l.agent===r.agent);if(s){if(s.dates.push(r.date),JT(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),JT(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class OM{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return LC()?_6().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await RM(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return YT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return YT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function JT(i){return H0(JSON.stringify({version:2,heartbeats:i})).length}function MM(i){if(i.length===0)return-1;let e=0,t=i[0].date;for(let n=1;n<i.length;n++)i[n].date<t&&(t=i[n].date,e=n);return e}function FM(i){Zh(new qc("platform-logger",e=>new Y6(e),"PRIVATE")),Zh(new qc("heartbeat",e=>new NM(e),"PRIVATE")),ou(Wb,WT,i),ou(Wb,WT,"esm2020"),ou("fire-js","")}FM("");var jM="firebase",VM="12.6.0";ou(jM,VM,"app");function jC(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const zM=jC,VC=new jm("auth","Firebase",jC());const q0=new H1("@firebase/auth");function UM(i,...e){q0.logLevel<=Ki.WARN&&q0.warn(`Auth (${cd}): ${i}`,...e)}function m0(i,...e){q0.logLevel<=Ki.ERROR&&q0.error(`Auth (${cd}): ${i}`,...e)}function cu(i,...e){throw v2(i,...e)}function Du(i,...e){return v2(i,...e)}function y2(i,e,t){const n={...zM(),[e]:t};return new jm("auth","Firebase",n).create(e,{appName:i.name})}function ec(i){return y2(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function BM(i,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&cu(i,"argument-error"),y2(i,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function v2(i,...e){if(typeof i!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=i.name),i._errorFactory.create(t,...n)}return VC.create(i,...e)}function ti(i,e,...t){if(!i)throw v2(e,...t)}function zc(i){const e="INTERNAL ASSERTION FAILED: "+i;throw m0(e),new Error(e)}function Xc(i,e){i||zc(e)}function Xb(){return typeof self<"u"&&self.location?.href||""}function $M(){return QT()==="http:"||QT()==="https:"}function QT(){return typeof self<"u"&&self.location?.protocol||null}function HM(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($M()||m6()||"connection"in navigator)?navigator.onLine:!0}function GM(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class zm{constructor(e,t){this.shortDelay=e,this.longDelay=t,Xc(t>e,"Short delay should be less than long delay!"),this.isMobile=g2()||CC()}get(){return HM()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function _2(i,e){Xc(i.emulator,"Emulator should always be set here");const{url:t}=i.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class zC{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const KM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const WM=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],qM=new zm(3e4,6e4);function hd(i,e){return i.tenantId&&!e.tenantId?{...e,tenantId:i.tenantId}:e}async function dd(i,e,t,n,r={}){return UC(i,r,async()=>{let s={},l={};n&&(e==="GET"?l=n:s={body:JSON.stringify(n)});const u=jp({key:i.config.apiKey,...l}).slice(1),h=await i._getAdditionalHeaders();h["Content-Type"]="application/json",i.languageCode&&(h["X-Firebase-Locale"]=i.languageCode);const f={method:e,headers:h,...s};return g6()||(f.referrerPolicy="no-referrer"),i.emulatorConfig&&oc(i.emulatorConfig.host)&&(f.credentials="include"),zC.fetch()(await BC(i,i.config.apiHost,t,u),f)})}async function UC(i,e,t){i._canInitEmulator=!1;const n={...KM,...e};try{const r=new XM(i),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const l=await s.json();if("needConfirmation"in l)throw $y(i,"account-exists-with-different-credential",l);if(s.ok&&!("errorMessage"in l))return l;{const u=s.ok?l.errorMessage:l.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw $y(i,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw $y(i,"email-already-in-use",l);if(h==="USER_DISABLED")throw $y(i,"user-disabled",l);const x=n[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw y2(i,x,f);cu(i,x)}}catch(r){if(r instanceof lc)throw r;cu(i,"network-request-failed",{message:String(r)})}}async function Um(i,e,t,n,r={}){const s=await dd(i,e,t,n,r);return"mfaPendingCredential"in s&&cu(i,"multi-factor-auth-required",{_serverResponse:s}),s}async function BC(i,e,t,n){const r=`${e}${t}?${n}`,s=i,l=s.config.emulator?_2(i.config,r):`${i.config.apiScheme}://${r}`;return WM.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(l).toString():l}function YM(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class XM{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Du(this.auth,"network-request-failed")),qM.get())})}}function $y(i,e,t){const n={appName:i.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=Du(i,e,n);return r.customData._tokenResponse=t,r}function ZT(i){return i!==void 0&&i.enterprise!==void 0}class JM{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return YM(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function QM(i,e){return dd(i,"GET","/v2/recaptchaConfig",hd(i,e))}async function ZM(i,e){return dd(i,"POST","/v1/accounts:delete",e)}async function Y0(i,e){return dd(i,"POST","/v1/accounts:lookup",e)}function $g(i){if(i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function e8(i,e=!1){const t=us(i),n=await t.getIdToken(e),r=b2(n);ti(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,l=s?.sign_in_provider;return{claims:r,token:n,authTime:$g(Y_(r.auth_time)),issuedAtTime:$g(Y_(r.iat)),expirationTime:$g(Y_(r.exp)),signInProvider:l||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Y_(i){return Number(i)*1e3}function b2(i){const[e,t,n]=i.split(".");if(e===void 0||t===void 0||n===void 0)return m0("JWT malformed, contained fewer than 3 sections"),null;try{const r=G0(t);return r?JSON.parse(r):(m0("Failed to decode base64 JWT payload"),null)}catch(r){return m0("Caught error parsing JWT payload as JSON",r?.toString()),null}}function eA(i){const e=b2(i);return ti(e,"internal-error"),ti(typeof e.exp<"u","internal-error"),ti(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function um(i,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof lc&&t8(n)&&i.auth.currentUser===i&&await i.auth.signOut(),n}}function t8({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class n8{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Jb{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$g(this.lastLoginAt),this.creationTime=$g(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function X0(i){const e=i.auth,t=await i.getIdToken(),n=await um(i,Y0(e,{idToken:t}));ti(n?.users.length,e,"internal-error");const r=n.users[0];i._notifyReloadListener(r);const s=r.providerUserInfo?.length?$C(r.providerUserInfo):[],l=r8(i.providerData,s),u=i.isAnonymous,h=!(i.email&&r.passwordHash)&&!l?.length,f=u?h:!1,x={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:l,metadata:new Jb(r.createdAt,r.lastLoginAt),isAnonymous:f};Object.assign(i,x)}async function i8(i){const e=us(i);await X0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function r8(i,e){return[...i.filter(n=>!e.some(r=>r.providerId===n.providerId)),...e]}function $C(i){return i.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function s8(i,e){const t=await UC(i,{},async()=>{const n=jp({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=i.config,l=await BC(i,r,"/v1/token",`key=${s}`),u=await i._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:n};return i.emulatorConfig&&oc(i.emulatorConfig.host)&&(h.credentials="include"),zC.fetch()(l,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function a8(i,e){return dd(i,"POST","/v2/accounts:revokeToken",hd(i,e))}class np{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ti(e.idToken,"internal-error"),ti(typeof e.idToken<"u","internal-error"),ti(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):eA(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ti(e.length!==0,"internal-error");const t=eA(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ti(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await s8(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,l=new np;return n&&(ti(typeof n=="string","internal-error",{appName:e}),l.refreshToken=n),r&&(ti(typeof r=="string","internal-error",{appName:e}),l.accessToken=r),s&&(ti(typeof s=="number","internal-error",{appName:e}),l.expirationTime=s),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new np,this.toJSON())}_performRefresh(){return zc("not implemented")}}function Eh(i,e){ti(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class Cu{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new n8(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Jb(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await um(this,this.stsTokenManager.getToken(this.auth,e));return ti(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return e8(this,e)}reload(){return i8(this)}_assign(e){this!==e&&(ti(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Cu({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ti(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await X0(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Mo(this.auth.app))return Promise.reject(ec(this.auth));const e=await this.getIdToken();return await um(this,ZM(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,l=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,f=t.createdAt??void 0,x=t.lastLoginAt??void 0,{uid:p,emailVerified:w,isAnonymous:A,providerData:B,stsTokenManager:$}=t;ti(p&&$,e,"internal-error");const W=np.fromJSON(this.name,$);ti(typeof p=="string",e,"internal-error"),Eh(n,e.name),Eh(r,e.name),ti(typeof w=="boolean",e,"internal-error"),ti(typeof A=="boolean",e,"internal-error"),Eh(s,e.name),Eh(l,e.name),Eh(u,e.name),Eh(h,e.name),Eh(f,e.name),Eh(x,e.name);const q=new Cu({uid:p,auth:e,email:r,emailVerified:w,displayName:n,isAnonymous:A,photoURL:l,phoneNumber:s,tenantId:u,stsTokenManager:W,createdAt:f,lastLoginAt:x});return B&&Array.isArray(B)&&(q.providerData=B.map(ge=>({...ge}))),h&&(q._redirectEventId=h),q}static async _fromIdTokenResponse(e,t,n=!1){const r=new np;r.updateFromServerResponse(t);const s=new Cu({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await X0(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];ti(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?$C(r.providerUserInfo):[],l=!(r.email&&r.passwordHash)&&!s?.length,u=new np;u.updateFromIdToken(n);const h=new Cu({uid:r.localId,auth:e,stsTokenManager:u,isAnonymous:l}),f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Jb(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(h,f),h}}const tA=new Map;function Uc(i){Xc(i instanceof Function,"Expected a class definition");let e=tA.get(i);return e?(Xc(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,tA.set(i,e),e)}class HC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}HC.type="NONE";const nA=HC;function y0(i,e,t){return`firebase:${i}:${e}:${t}`}class ip{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=y0(this.userKey,r.apiKey,s),this.fullPersistenceKey=y0("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Y0(this.auth,{idToken:e}).catch(()=>{});return t?Cu._fromGetAccountInfoResponse(this.auth,t,e):null}return Cu._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ip(Uc(nA),e,n);const r=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let s=r[0]||Uc(nA);const l=y0(n,e.config.apiKey,e.name);let u=null;for(const f of t)try{const x=await f._get(l);if(x){let p;if(typeof x=="string"){const w=await Y0(e,{idToken:x}).catch(()=>{});if(!w)break;p=await Cu._fromGetAccountInfoResponse(e,w,x)}else p=Cu._fromJSON(e,x);f!==s&&(u=p),s=f;break}}catch{}const h=r.filter(f=>f._shouldAllowMigration);return!s._shouldAllowMigration||!h.length?new ip(s,e,n):(s=h[0],u&&await s._set(l,u.toJSON()),await Promise.all(t.map(async f=>{if(f!==s)try{await f._remove(l)}catch{}})),new ip(s,e,n))}}function iA(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(GC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(XC(e))return"Blackberry";if(JC(e))return"Webos";if(KC(e))return"Safari";if((e.includes("chrome/")||WC(e))&&!e.includes("edge/"))return"Chrome";if(YC(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=i.match(t);if(n?.length===2)return n[1]}return"Other"}function GC(i=za()){return/firefox\//i.test(i)}function KC(i=za()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function WC(i=za()){return/crios\//i.test(i)}function qC(i=za()){return/iemobile/i.test(i)}function YC(i=za()){return/android/i.test(i)}function XC(i=za()){return/blackberry/i.test(i)}function JC(i=za()){return/webos/i.test(i)}function x2(i=za()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function o8(i=za()){return x2(i)&&!!window.navigator?.standalone}function l8(){return y6()&&document.documentMode===10}function QC(i=za()){return x2(i)||YC(i)||JC(i)||XC(i)||/windows phone/i.test(i)||qC(i)}function ZC(i,e=[]){let t;switch(i){case"Browser":t=iA(za());break;case"Worker":t=`${iA(za())}-${i}`;break;default:t=i}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${cd}/${n}`}class u8{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=s=>new Promise((l,u)=>{try{const h=e(s);l(h)}catch(h){u(h)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}async function c8(i,e={}){return dd(i,"GET","/v2/passwordPolicy",hd(i,e))}const h8=6;class d8{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??h8,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class f8{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rA(this),this.idTokenSubscription=new rA(this),this.beforeStateQueue=new u8(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=VC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Uc(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ip.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Y0(this,{idToken:e}),n=await Cu._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Mo(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(l,l))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,l=n?._redirectEventId,u=await this.tryRedirectSignIn(e);(!s||s===l)&&u?.user&&(n=u.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return ti(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await X0(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GM()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Mo(this.app))return Promise.reject(ec(this));const t=e?us(e):null;return t&&ti(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ti(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Mo(this.app)?Promise.reject(ec(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Mo(this.app)?Promise.reject(ec(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Uc(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await c8(this),t=new d8(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new jm("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await a8(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Uc(e)||this._popupRedirectResolver;ti(t,this,"argument-error"),this.redirectPersistenceManager=await ip.create(this,[Uc(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let l=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(ti(u,this,"internal-error"),u.then(()=>{l||s(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,n,r);return()=>{l=!0,h()}}else{const h=e.addObserver(t);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ti(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ZC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Mo(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&UM(`Error while retrieving App Check token: ${e.error}`),e?.token}}function nh(i){return us(i)}class rA{constructor(e){this.auth=e,this.observer=null,this.addObserver=E6(t=>this.observer=t)}get next(){return ti(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let W1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function p8(i){W1=i}function e3(i){return W1.loadJS(i)}function g8(){return W1.recaptchaEnterpriseScript}function m8(){return W1.gapiScript}function y8(i){return`__${i}${Math.floor(Math.random()*1e6)}`}class v8{constructor(){this.enterprise=new _8}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class _8{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const b8="recaptcha-enterprise",t3="NO_RECAPTCHA";class x8{constructor(e){this.type=b8,this.auth=nh(e)}async verify(e="verify",t=!1){async function n(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(l,u)=>{QM(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const f=new JM(h);return s.tenantId==null?s._agentRecaptchaConfig=f:s._tenantRecaptchaConfigs[s.tenantId]=f,l(f.siteKey)}}).catch(h=>{u(h)})})}function r(s,l,u){const h=window.grecaptcha;ZT(h)?h.enterprise.ready(()=>{h.enterprise.execute(s,{action:e}).then(f=>{l(f)}).catch(()=>{l(t3)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new v8().execute("siteKey",{action:"verify"}):new Promise((s,l)=>{n(this.auth).then(u=>{if(!t&&ZT(window.grecaptcha))r(u,s,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=g8();h.length!==0&&(h+=u),e3(h).then(()=>{r(u,s,l)}).catch(f=>{l(f)})}}).catch(u=>{l(u)})})}}async function sA(i,e,t,n=!1,r=!1){const s=new x8(i);let l;if(r)l=t3;else try{l=await s.verify(t)}catch{l=await s.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,f=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return n?Object.assign(u,{captchaResp:l}):Object.assign(u,{captchaResponse:l}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function Qb(i,e,t,n,r){if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await sA(i,e,t,t==="getOobCode");return n(i,s)}else return n(i,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await sA(i,e,t,t==="getOobCode");return n(i,l)}else return Promise.reject(s)})}function w8(i,e){const t=Vm(i,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(Qh(s,e??{}))return r;cu(r,"already-initialized")}return t.initialize({options:e})}function S8(i,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(Uc);e?.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(n,e?.popupRedirectResolver)}function T8(i,e,t){const n=nh(i);ti(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!1,s=n3(e),{host:l,port:u}=A8(e),h=u===null?"":`:${u}`,f={url:`${s}//${l}${h}/`},x=Object.freeze({host:l,port:u,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!n._canInitEmulator){ti(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),ti(Qh(f,n.config.emulator)&&Qh(x,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=f,n.emulatorConfig=x,n.settings.appVerificationDisabledForTesting=!0,oc(l)?(z1(`${s}//${l}${h}`),U1("Auth",!0)):E8()}function n3(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function A8(i){const e=n3(i),t=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const s=r[1];return{host:s,port:aA(n.substr(s.length+1))}}else{const[s,l]=n.split(":");return{host:s,port:aA(l)}}}function aA(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function E8(){function i(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class w2{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return zc("not implemented")}_getIdTokenResponse(e){return zc("not implemented")}_linkToIdToken(e,t){return zc("not implemented")}_getReauthenticationResolver(e){return zc("not implemented")}}async function I8(i,e){return dd(i,"POST","/v1/accounts:signUp",e)}async function k8(i,e){return Um(i,"POST","/v1/accounts:signInWithPassword",hd(i,e))}async function C8(i,e){return Um(i,"POST","/v1/accounts:signInWithEmailLink",hd(i,e))}async function R8(i,e){return Um(i,"POST","/v1/accounts:signInWithEmailLink",hd(i,e))}class cm extends w2{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new cm(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new cm(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qb(e,t,"signInWithPassword",k8);case"emailLink":return C8(e,{email:this._email,oobCode:this._password});default:cu(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qb(e,n,"signUpPassword",I8);case"emailLink":return R8(e,{idToken:t,email:this._email,oobCode:this._password});default:cu(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function rp(i,e){return Um(i,"POST","/v1/accounts:signInWithIdp",hd(i,e))}const D8="http://localhost";class qd extends w2{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new qd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):cu("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:r,...s}=t;if(!n||!r)return null;const l=new qd(n,r);return l.idToken=s.idToken||void 0,l.accessToken=s.accessToken||void 0,l.secret=s.secret,l.nonce=s.nonce,l.pendingToken=s.pendingToken||null,l}_getIdTokenResponse(e){const t=this.buildRequest();return rp(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,rp(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,rp(e,t)}buildRequest(){const e={requestUri:D8,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=jp(t)}return e}}function L8(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function N8(i){const e=Pg(Og(i)).link,t=e?Pg(Og(e)).deep_link_id:null,n=Pg(Og(i)).deep_link_id;return(n?Pg(Og(n)).link:null)||n||t||e||i}class S2{constructor(e){const t=Pg(Og(e)),n=t.apiKey??null,r=t.oobCode??null,s=L8(t.mode??null);ti(n&&r&&s,"argument-error"),this.apiKey=n,this.operation=s,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=N8(e);try{return new S2(t)}catch{return null}}}class Vp{constructor(){this.providerId=Vp.PROVIDER_ID}static credential(e,t){return cm._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=S2.parseLink(t);return ti(n,"argument-error"),cm._fromEmailAndCode(e,n.code,n.tenantId)}}Vp.PROVIDER_ID="password";Vp.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Vp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class T2{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Bm extends T2{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ph extends Bm{constructor(){super("facebook.com")}static credential(e){return qd._fromParams({providerId:Ph.PROVIDER_ID,signInMethod:Ph.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ph.credentialFromTaggedObject(e)}static credentialFromError(e){return Ph.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ph.credential(e.oauthAccessToken)}catch{return null}}}Ph.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ph.PROVIDER_ID="facebook.com";class Vc extends Bm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return qd._fromParams({providerId:Vc.PROVIDER_ID,signInMethod:Vc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Vc.credentialFromTaggedObject(e)}static credentialFromError(e){return Vc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Vc.credential(t,n)}catch{return null}}}Vc.GOOGLE_SIGN_IN_METHOD="google.com";Vc.PROVIDER_ID="google.com";class Oh extends Bm{constructor(){super("github.com")}static credential(e){return qd._fromParams({providerId:Oh.PROVIDER_ID,signInMethod:Oh.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Oh.credentialFromTaggedObject(e)}static credentialFromError(e){return Oh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Oh.credential(e.oauthAccessToken)}catch{return null}}}Oh.GITHUB_SIGN_IN_METHOD="github.com";Oh.PROVIDER_ID="github.com";class Mh extends Bm{constructor(){super("twitter.com")}static credential(e,t){return qd._fromParams({providerId:Mh.PROVIDER_ID,signInMethod:Mh.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Mh.credentialFromTaggedObject(e)}static credentialFromError(e){return Mh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Mh.credential(t,n)}catch{return null}}}Mh.TWITTER_SIGN_IN_METHOD="twitter.com";Mh.PROVIDER_ID="twitter.com";async function i3(i,e){return Um(i,"POST","/v1/accounts:signUp",hd(i,e))}class Jc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await Cu._fromIdTokenResponse(e,n,r),l=oA(n);return new Jc({user:s,providerId:l,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=oA(n);return new Jc({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function oA(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}async function P8(i){if(Mo(i.app))return Promise.reject(ec(i));const e=nh(i);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new Jc({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await i3(e,{returnSecureToken:!0}),n=await Jc._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(n.user),n}class J0 extends lc{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,J0.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new J0(e,t,n,r)}}function r3(i,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(i):t._getIdTokenResponse(i)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?J0._fromErrorAndOperation(i,s,e,n):s})}async function O8(i,e,t=!1){const n=await um(i,e._linkToIdToken(i.auth,await i.getIdToken()),t);return Jc._forOperation(i,"link",n)}async function M8(i,e,t=!1){const{auth:n}=i;if(Mo(n.app))return Promise.reject(ec(n));const r="reauthenticate";try{const s=await um(i,r3(n,r,e,i),t);ti(s.idToken,n,"internal-error");const l=b2(s.idToken);ti(l,n,"internal-error");const{sub:u}=l;return ti(i.uid===u,n,"user-mismatch"),Jc._forOperation(i,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&cu(n,"user-mismatch"),s}}async function s3(i,e,t=!1){if(Mo(i.app))return Promise.reject(ec(i));const n="signIn",r=await r3(i,n,e),s=await Jc._fromIdTokenResponse(i,n,r);return t||await i._updateCurrentUser(s.user),s}async function F8(i,e){return s3(nh(i),e)}async function a3(i){const e=nh(i);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function j8(i,e,t){if(Mo(i.app))return Promise.reject(ec(i));const n=nh(i),l=await Qb(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",i3).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&a3(i),h}),u=await Jc._fromIdTokenResponse(n,"signIn",l);return await n._updateCurrentUser(u.user),u}function V8(i,e,t){return Mo(i.app)?Promise.reject(ec(i)):F8(us(i),Vp.credential(e,t)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&a3(i),n})}function z8(i,e,t,n){return us(i).onIdTokenChanged(e,t,n)}function U8(i,e,t){return us(i).beforeAuthStateChanged(e,t)}function B8(i,e,t,n){return us(i).onAuthStateChanged(e,t,n)}function $8(i){return us(i).signOut()}const Q0="__sak";class o3{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Q0,"1"),this.storage.removeItem(Q0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const H8=1e3,G8=10;class l3 extends o3{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=QC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((l,u,h)=>{this.notifyListeners(l,h)});return}const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const l=this.storage.getItem(n);!t&&this.localCache[n]===l||this.notifyListeners(n,l)},s=this.storage.getItem(n);l8()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,G8):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},H8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}l3.type="LOCAL";const K8=l3;class u3 extends o3{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}u3.type="SESSION";const c3=u3;function W8(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class q1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const n=new q1(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,l=this.handlersMap[r];if(!l?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const u=Array.from(l).map(async f=>f(t.origin,s)),h=await W8(u);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}q1.receivers=[];function A2(i="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return i+t}class q8{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,l;return new Promise((u,h)=>{const f=A2("",20);r.port1.start();const x=setTimeout(()=>{h(new Error("unsupported_event"))},n);l={messageChannel:r,onMessage(p){const w=p;if(w.data.eventId===f)switch(w.data.status){case"ack":clearTimeout(x),s=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),u(w.data.response);break;default:clearTimeout(x),clearTimeout(s),h(new Error("invalid_response"));break}}},this.handlers.add(l),r.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[r.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function tc(){return window}function Y8(i){tc().location.href=i}function h3(){return typeof tc().WorkerGlobalScope<"u"&&typeof tc().importScripts=="function"}async function X8(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function J8(){return navigator?.serviceWorker?.controller||null}function Q8(){return h3()?self:null}const d3="firebaseLocalStorageDb",Z8=1,Z0="firebaseLocalStorage",f3="fbase_key";class $m{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Y1(i,e){return i.transaction([Z0],e?"readwrite":"readonly").objectStore(Z0)}function eF(){const i=indexedDB.deleteDatabase(d3);return new $m(i).toPromise()}function Zb(){const i=indexedDB.open(d3,Z8);return new Promise((e,t)=>{i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("upgradeneeded",()=>{const n=i.result;try{n.createObjectStore(Z0,{keyPath:f3})}catch(r){t(r)}}),i.addEventListener("success",async()=>{const n=i.result;n.objectStoreNames.contains(Z0)?e(n):(n.close(),await eF(),e(await Zb()))})})}async function lA(i,e,t){const n=Y1(i,!0).put({[f3]:e,value:t});return new $m(n).toPromise()}async function tF(i,e){const t=Y1(i,!1).get(e),n=await new $m(t).toPromise();return n===void 0?null:n.value}function uA(i,e){const t=Y1(i,!0).delete(e);return new $m(t).toPromise()}const nF=800,iF=3;class p3{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Zb(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>iF)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return h3()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=q1._getInstance(Q8()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await X8(),!this.activeServiceWorker)return;this.sender=new q8(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||J8()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Zb();return await lA(e,Q0,"1"),await uA(e,Q0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>lA(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>tF(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>uA(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=Y1(r,!1).getAll();return new $m(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),nF)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}p3.type="LOCAL";const rF=p3;new zm(3e4,6e4);function g3(i,e){return e?Uc(e):(ti(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class E2 extends w2{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rp(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rp(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rp(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function sF(i){return s3(i.auth,new E2(i),i.bypassAuthState)}function aF(i){const{auth:e,user:t}=i;return ti(t,e,"internal-error"),M8(t,new E2(i),i.bypassAuthState)}async function oF(i){const{auth:e,user:t}=i;return ti(t,e,"internal-error"),O8(t,new E2(i),i.bypassAuthState)}class m3{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:l,type:u}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sF;case"linkViaPopup":case"linkViaRedirect":return oF;case"reauthViaPopup":case"reauthViaRedirect":return aF;default:cu(this.auth,"internal-error")}}resolve(e){Xc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Xc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const lF=new zm(2e3,1e4);async function uF(i,e,t){if(Mo(i.app))return Promise.reject(Du(i,"operation-not-supported-in-this-environment"));const n=nh(i);BM(i,e,T2);const r=g3(n,t);return new Vd(n,"signInViaPopup",e,r).executeNotNull()}class Vd extends m3{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,Vd.currentPopupAction&&Vd.currentPopupAction.cancel(),Vd.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ti(e,this.auth,"internal-error"),e}async onExecution(){Xc(this.filter.length===1,"Popup operations only handle one event");const e=A2();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Du(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Du(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vd.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Du(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,lF.get())};e()}}Vd.currentPopupAction=null;const cF="pendingRedirect",v0=new Map;class hF extends m3{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=v0.get(this.auth._key());if(!e){try{const n=await dF(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}v0.set(this.auth._key(),e)}return this.bypassAuthState||v0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function dF(i,e){const t=gF(e),n=pF(i);if(!await n._isAvailable())return!1;const r=await n._get(t)==="true";return await n._remove(t),r}function fF(i,e){v0.set(i._key(),e)}function pF(i){return Uc(i._redirectPersistence)}function gF(i){return y0(cF,i.config.apiKey,i.name)}async function mF(i,e,t=!1){if(Mo(i.app))return Promise.reject(ec(i));const n=nh(i),r=g3(n,e),l=await new hF(n,r,t).execute();return l&&!t&&(delete l.user._redirectEventId,await n._persistUserIfCurrent(l.user),await n._setRedirectUser(null,e)),l}const yF=600*1e3;class vF{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_F(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!y3(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Du(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=yF&&this.cachedEventUids.clear(),this.cachedEventUids.has(cA(e))}saveEventToCache(e){this.cachedEventUids.add(cA(e)),this.lastProcessedEventTime=Date.now()}}function cA(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function y3({type:i,error:e}){return i==="unknown"&&e?.code==="auth/no-auth-event"}function _F(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return y3(i);default:return!1}}async function bF(i,e={}){return dd(i,"GET","/v1/projects",e)}const xF=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wF=/^https?/;async function SF(i){if(i.config.emulator)return;const{authorizedDomains:e}=await bF(i);for(const t of e)try{if(TF(t))return}catch{}cu(i,"unauthorized-domain")}function TF(i){const e=Xb(),{protocol:t,hostname:n}=new URL(e);if(i.startsWith("chrome-extension://")){const l=new URL(i);return l.hostname===""&&n===""?t==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&l.hostname===n}if(!wF.test(t))return!1;if(xF.test(i))return n===i;const r=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}const AF=new zm(3e4,6e4);function hA(){const i=tc().___jsl;if(i?.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let t=0;t<i.CP.length;t++)i.CP[t]=null}}function EF(i){return new Promise((e,t)=>{function n(){hA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{hA(),t(Du(i,"network-request-failed"))},timeout:AF.get()})}if(tc().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(tc().gapi?.load)n();else{const r=y8("iframefcb");return tc()[r]=()=>{gapi.load?n():t(Du(i,"network-request-failed"))},e3(`${m8()}?onload=${r}`).catch(s=>t(s))}}).catch(e=>{throw _0=null,e})}let _0=null;function IF(i){return _0=_0||EF(i),_0}const kF=new zm(5e3,15e3),CF="__/auth/iframe",RF="emulator/auth/iframe",DF={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LF=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function NF(i){const e=i.config;ti(e.authDomain,i,"auth-domain-config-required");const t=e.emulator?_2(e,RF):`https://${i.config.authDomain}/${CF}`,n={apiKey:e.apiKey,appName:i.name,v:cd},r=LF.get(i.config.apiHost);r&&(n.eid=r);const s=i._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${jp(n).slice(1)}`}async function PF(i){const e=await IF(i),t=tc().gapi;return ti(t,i,"internal-error"),e.open({where:document.body,url:NF(i),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DF,dontclear:!0},n=>new Promise(async(r,s)=>{await n.restyle({setHideOnLeave:!1});const l=Du(i,"network-request-failed"),u=tc().setTimeout(()=>{s(l)},kF.get());function h(){tc().clearTimeout(u),r(n)}n.ping(h).then(h,()=>{s(l)})}))}const OF={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},MF=500,FF=600,jF="_blank",VF="http://localhost";class dA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function zF(i,e,t,n=MF,r=FF){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),l=Math.max((window.screen.availWidth-n)/2,0).toString();let u="";const h={...OF,width:n.toString(),height:r.toString(),top:s,left:l},f=za().toLowerCase();t&&(u=WC(f)?jF:t),GC(f)&&(e=e||VF,h.scrollbars="yes");const x=Object.entries(h).reduce((w,[A,B])=>`${w}${A}=${B},`,"");if(o8(f)&&u!=="_self")return UF(e||"",u),new dA(null);const p=window.open(e||"",u,x);ti(p,i,"popup-blocked");try{p.focus()}catch{}return new dA(p)}function UF(i,e){const t=document.createElement("a");t.href=i,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}const BF="__/auth/handler",$F="emulator/auth/handler",HF=encodeURIComponent("fac");async function fA(i,e,t,n,r,s){ti(i.config.authDomain,i,"auth-domain-config-required"),ti(i.config.apiKey,i,"invalid-api-key");const l={apiKey:i.config.apiKey,appName:i.name,authType:t,redirectUrl:n,v:cd,eventId:r};if(e instanceof T2){e.setDefaultLanguage(i.languageCode),l.providerId=e.providerId||"",Hb(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,p]of Object.entries({}))l[x]=p}if(e instanceof Bm){const x=e.getScopes().filter(p=>p!=="");x.length>0&&(l.scopes=x.join(","))}i.tenantId&&(l.tid=i.tenantId);const u=l;for(const x of Object.keys(u))u[x]===void 0&&delete u[x];const h=await i._getAppCheckToken(),f=h?`#${HF}=${encodeURIComponent(h)}`:"";return`${GF(i)}?${jp(u).slice(1)}${f}`}function GF({config:i}){return i.emulator?_2(i,$F):`https://${i.authDomain}/${BF}`}const X_="webStorageSupport";class KF{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=c3,this._completeRedirectFn=mF,this._overrideRedirectResult=fF}async _openPopup(e,t,n,r){Xc(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await fA(e,t,n,Xb(),r);return zF(e,s,A2())}async _openRedirect(e,t,n,r){await this._originValidation(e);const s=await fA(e,t,n,Xb(),r);return Y8(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Xc(s,"If manager is not set, promise should be"),s)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await PF(e),n=new vF(e);return t.register("authEvent",r=>(ti(r?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(X_,{type:X_},r=>{const s=r?.[0]?.[X_];s!==void 0&&t(!!s),cu(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=SF(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return QC()||KC()||x2()}}const WF=KF;var pA="@firebase/auth",gA="1.11.1";class qF{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ti(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function YF(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function XF(i){Zh(new qc("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=n.options;ti(l&&!l.includes(":"),"invalid-api-key",{appName:n.name});const h={apiKey:l,authDomain:u,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ZC(i)},f=new f8(n,r,s,h);return S8(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Zh(new qc("auth-internal",e=>{const t=nh(e.getProvider("auth").getImmediate());return(n=>new qF(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ou(pA,gA,YF(i)),ou(pA,gA,"esm2020")}const JF=300,QF=IC("authIdTokenMaxAge")||JF;let mA=null;const ZF=i=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>QF)return;const r=t?.token;mA!==r&&(mA=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function I2(i=K1()){const e=Vm(i,"auth");if(e.isInitialized())return e.getImmediate();const t=w8(i,{popupRedirectResolver:WF,persistence:[rF,K8,c3]}),n=IC("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(n,location.origin);if(location.origin===s.origin){const l=ZF(s.toString());U8(t,l,()=>l(t.currentUser)),z8(t,u=>l(u))}}const r=AC("auth");return r&&T8(t,`http://${r}`),t}function ej(){return document.getElementsByTagName("head")?.[0]??document}p8({loadJS(i){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",i),n.onload=e,n.onerror=r=>{const s=Du("internal-error");s.customData=r,t(s)},n.type="text/javascript",n.charset="UTF-8",ej().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});XF("Browser");var yA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Gh,v3;(function(){var i;function e(pe,ee){function J(){}J.prototype=ee.prototype,pe.F=ee.prototype,pe.prototype=new J,pe.prototype.constructor=pe,pe.D=function(ye,X,ae){for(var le=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)le[ze-2]=arguments[ze];return ee.prototype[X].apply(ye,le)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(pe,ee,J){J||(J=0);const ye=Array(16);if(typeof ee=="string")for(var X=0;X<16;++X)ye[X]=ee.charCodeAt(J++)|ee.charCodeAt(J++)<<8|ee.charCodeAt(J++)<<16|ee.charCodeAt(J++)<<24;else for(X=0;X<16;++X)ye[X]=ee[J++]|ee[J++]<<8|ee[J++]<<16|ee[J++]<<24;ee=pe.g[0],J=pe.g[1],X=pe.g[2];let ae=pe.g[3],le;le=ee+(ae^J&(X^ae))+ye[0]+3614090360&4294967295,ee=J+(le<<7&4294967295|le>>>25),le=ae+(X^ee&(J^X))+ye[1]+3905402710&4294967295,ae=ee+(le<<12&4294967295|le>>>20),le=X+(J^ae&(ee^J))+ye[2]+606105819&4294967295,X=ae+(le<<17&4294967295|le>>>15),le=J+(ee^X&(ae^ee))+ye[3]+3250441966&4294967295,J=X+(le<<22&4294967295|le>>>10),le=ee+(ae^J&(X^ae))+ye[4]+4118548399&4294967295,ee=J+(le<<7&4294967295|le>>>25),le=ae+(X^ee&(J^X))+ye[5]+1200080426&4294967295,ae=ee+(le<<12&4294967295|le>>>20),le=X+(J^ae&(ee^J))+ye[6]+2821735955&4294967295,X=ae+(le<<17&4294967295|le>>>15),le=J+(ee^X&(ae^ee))+ye[7]+4249261313&4294967295,J=X+(le<<22&4294967295|le>>>10),le=ee+(ae^J&(X^ae))+ye[8]+1770035416&4294967295,ee=J+(le<<7&4294967295|le>>>25),le=ae+(X^ee&(J^X))+ye[9]+2336552879&4294967295,ae=ee+(le<<12&4294967295|le>>>20),le=X+(J^ae&(ee^J))+ye[10]+4294925233&4294967295,X=ae+(le<<17&4294967295|le>>>15),le=J+(ee^X&(ae^ee))+ye[11]+2304563134&4294967295,J=X+(le<<22&4294967295|le>>>10),le=ee+(ae^J&(X^ae))+ye[12]+1804603682&4294967295,ee=J+(le<<7&4294967295|le>>>25),le=ae+(X^ee&(J^X))+ye[13]+4254626195&4294967295,ae=ee+(le<<12&4294967295|le>>>20),le=X+(J^ae&(ee^J))+ye[14]+2792965006&4294967295,X=ae+(le<<17&4294967295|le>>>15),le=J+(ee^X&(ae^ee))+ye[15]+1236535329&4294967295,J=X+(le<<22&4294967295|le>>>10),le=ee+(X^ae&(J^X))+ye[1]+4129170786&4294967295,ee=J+(le<<5&4294967295|le>>>27),le=ae+(J^X&(ee^J))+ye[6]+3225465664&4294967295,ae=ee+(le<<9&4294967295|le>>>23),le=X+(ee^J&(ae^ee))+ye[11]+643717713&4294967295,X=ae+(le<<14&4294967295|le>>>18),le=J+(ae^ee&(X^ae))+ye[0]+3921069994&4294967295,J=X+(le<<20&4294967295|le>>>12),le=ee+(X^ae&(J^X))+ye[5]+3593408605&4294967295,ee=J+(le<<5&4294967295|le>>>27),le=ae+(J^X&(ee^J))+ye[10]+38016083&4294967295,ae=ee+(le<<9&4294967295|le>>>23),le=X+(ee^J&(ae^ee))+ye[15]+3634488961&4294967295,X=ae+(le<<14&4294967295|le>>>18),le=J+(ae^ee&(X^ae))+ye[4]+3889429448&4294967295,J=X+(le<<20&4294967295|le>>>12),le=ee+(X^ae&(J^X))+ye[9]+568446438&4294967295,ee=J+(le<<5&4294967295|le>>>27),le=ae+(J^X&(ee^J))+ye[14]+3275163606&4294967295,ae=ee+(le<<9&4294967295|le>>>23),le=X+(ee^J&(ae^ee))+ye[3]+4107603335&4294967295,X=ae+(le<<14&4294967295|le>>>18),le=J+(ae^ee&(X^ae))+ye[8]+1163531501&4294967295,J=X+(le<<20&4294967295|le>>>12),le=ee+(X^ae&(J^X))+ye[13]+2850285829&4294967295,ee=J+(le<<5&4294967295|le>>>27),le=ae+(J^X&(ee^J))+ye[2]+4243563512&4294967295,ae=ee+(le<<9&4294967295|le>>>23),le=X+(ee^J&(ae^ee))+ye[7]+1735328473&4294967295,X=ae+(le<<14&4294967295|le>>>18),le=J+(ae^ee&(X^ae))+ye[12]+2368359562&4294967295,J=X+(le<<20&4294967295|le>>>12),le=ee+(J^X^ae)+ye[5]+4294588738&4294967295,ee=J+(le<<4&4294967295|le>>>28),le=ae+(ee^J^X)+ye[8]+2272392833&4294967295,ae=ee+(le<<11&4294967295|le>>>21),le=X+(ae^ee^J)+ye[11]+1839030562&4294967295,X=ae+(le<<16&4294967295|le>>>16),le=J+(X^ae^ee)+ye[14]+4259657740&4294967295,J=X+(le<<23&4294967295|le>>>9),le=ee+(J^X^ae)+ye[1]+2763975236&4294967295,ee=J+(le<<4&4294967295|le>>>28),le=ae+(ee^J^X)+ye[4]+1272893353&4294967295,ae=ee+(le<<11&4294967295|le>>>21),le=X+(ae^ee^J)+ye[7]+4139469664&4294967295,X=ae+(le<<16&4294967295|le>>>16),le=J+(X^ae^ee)+ye[10]+3200236656&4294967295,J=X+(le<<23&4294967295|le>>>9),le=ee+(J^X^ae)+ye[13]+681279174&4294967295,ee=J+(le<<4&4294967295|le>>>28),le=ae+(ee^J^X)+ye[0]+3936430074&4294967295,ae=ee+(le<<11&4294967295|le>>>21),le=X+(ae^ee^J)+ye[3]+3572445317&4294967295,X=ae+(le<<16&4294967295|le>>>16),le=J+(X^ae^ee)+ye[6]+76029189&4294967295,J=X+(le<<23&4294967295|le>>>9),le=ee+(J^X^ae)+ye[9]+3654602809&4294967295,ee=J+(le<<4&4294967295|le>>>28),le=ae+(ee^J^X)+ye[12]+3873151461&4294967295,ae=ee+(le<<11&4294967295|le>>>21),le=X+(ae^ee^J)+ye[15]+530742520&4294967295,X=ae+(le<<16&4294967295|le>>>16),le=J+(X^ae^ee)+ye[2]+3299628645&4294967295,J=X+(le<<23&4294967295|le>>>9),le=ee+(X^(J|~ae))+ye[0]+4096336452&4294967295,ee=J+(le<<6&4294967295|le>>>26),le=ae+(J^(ee|~X))+ye[7]+1126891415&4294967295,ae=ee+(le<<10&4294967295|le>>>22),le=X+(ee^(ae|~J))+ye[14]+2878612391&4294967295,X=ae+(le<<15&4294967295|le>>>17),le=J+(ae^(X|~ee))+ye[5]+4237533241&4294967295,J=X+(le<<21&4294967295|le>>>11),le=ee+(X^(J|~ae))+ye[12]+1700485571&4294967295,ee=J+(le<<6&4294967295|le>>>26),le=ae+(J^(ee|~X))+ye[3]+2399980690&4294967295,ae=ee+(le<<10&4294967295|le>>>22),le=X+(ee^(ae|~J))+ye[10]+4293915773&4294967295,X=ae+(le<<15&4294967295|le>>>17),le=J+(ae^(X|~ee))+ye[1]+2240044497&4294967295,J=X+(le<<21&4294967295|le>>>11),le=ee+(X^(J|~ae))+ye[8]+1873313359&4294967295,ee=J+(le<<6&4294967295|le>>>26),le=ae+(J^(ee|~X))+ye[15]+4264355552&4294967295,ae=ee+(le<<10&4294967295|le>>>22),le=X+(ee^(ae|~J))+ye[6]+2734768916&4294967295,X=ae+(le<<15&4294967295|le>>>17),le=J+(ae^(X|~ee))+ye[13]+1309151649&4294967295,J=X+(le<<21&4294967295|le>>>11),le=ee+(X^(J|~ae))+ye[4]+4149444226&4294967295,ee=J+(le<<6&4294967295|le>>>26),le=ae+(J^(ee|~X))+ye[11]+3174756917&4294967295,ae=ee+(le<<10&4294967295|le>>>22),le=X+(ee^(ae|~J))+ye[2]+718787259&4294967295,X=ae+(le<<15&4294967295|le>>>17),le=J+(ae^(X|~ee))+ye[9]+3951481745&4294967295,pe.g[0]=pe.g[0]+ee&4294967295,pe.g[1]=pe.g[1]+(X+(le<<21&4294967295|le>>>11))&4294967295,pe.g[2]=pe.g[2]+X&4294967295,pe.g[3]=pe.g[3]+ae&4294967295}n.prototype.v=function(pe,ee){ee===void 0&&(ee=pe.length);const J=ee-this.blockSize,ye=this.C;let X=this.h,ae=0;for(;ae<ee;){if(X==0)for(;ae<=J;)r(this,pe,ae),ae+=this.blockSize;if(typeof pe=="string"){for(;ae<ee;)if(ye[X++]=pe.charCodeAt(ae++),X==this.blockSize){r(this,ye),X=0;break}}else for(;ae<ee;)if(ye[X++]=pe[ae++],X==this.blockSize){r(this,ye),X=0;break}}this.h=X,this.o+=ee},n.prototype.A=function(){var pe=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);pe[0]=128;for(var ee=1;ee<pe.length-8;++ee)pe[ee]=0;ee=this.o*8;for(var J=pe.length-8;J<pe.length;++J)pe[J]=ee&255,ee/=256;for(this.v(pe),pe=Array(16),ee=0,J=0;J<4;++J)for(let ye=0;ye<32;ye+=8)pe[ee++]=this.g[J]>>>ye&255;return pe};function s(pe,ee){var J=u;return Object.prototype.hasOwnProperty.call(J,pe)?J[pe]:J[pe]=ee(pe)}function l(pe,ee){this.h=ee;const J=[];let ye=!0;for(let X=pe.length-1;X>=0;X--){const ae=pe[X]|0;ye&&ae==ee||(J[X]=ae,ye=!1)}this.g=J}var u={};function h(pe){return-128<=pe&&pe<128?s(pe,function(ee){return new l([ee|0],ee<0?-1:0)}):new l([pe|0],pe<0?-1:0)}function f(pe){if(isNaN(pe)||!isFinite(pe))return p;if(pe<0)return W(f(-pe));const ee=[];let J=1;for(let ye=0;pe>=J;ye++)ee[ye]=pe/J|0,J*=4294967296;return new l(ee,0)}function x(pe,ee){if(pe.length==0)throw Error("number format error: empty string");if(ee=ee||10,ee<2||36<ee)throw Error("radix out of range: "+ee);if(pe.charAt(0)=="-")return W(x(pe.substring(1),ee));if(pe.indexOf("-")>=0)throw Error('number format error: interior "-" character');const J=f(Math.pow(ee,8));let ye=p;for(let ae=0;ae<pe.length;ae+=8){var X=Math.min(8,pe.length-ae);const le=parseInt(pe.substring(ae,ae+X),ee);X<8?(X=f(Math.pow(ee,X)),ye=ye.j(X).add(f(le))):(ye=ye.j(J),ye=ye.add(f(le)))}return ye}var p=h(0),w=h(1),A=h(16777216);i=l.prototype,i.m=function(){if($(this))return-W(this).m();let pe=0,ee=1;for(let J=0;J<this.g.length;J++){const ye=this.i(J);pe+=(ye>=0?ye:4294967296+ye)*ee,ee*=4294967296}return pe},i.toString=function(pe){if(pe=pe||10,pe<2||36<pe)throw Error("radix out of range: "+pe);if(B(this))return"0";if($(this))return"-"+W(this).toString(pe);const ee=f(Math.pow(pe,6));var J=this;let ye="";for(;;){const X=me(J,ee).g;J=q(J,X.j(ee));let ae=((J.g.length>0?J.g[0]:J.h)>>>0).toString(pe);if(J=X,B(J))return ae+ye;for(;ae.length<6;)ae="0"+ae;ye=ae+ye}},i.i=function(pe){return pe<0?0:pe<this.g.length?this.g[pe]:this.h};function B(pe){if(pe.h!=0)return!1;for(let ee=0;ee<pe.g.length;ee++)if(pe.g[ee]!=0)return!1;return!0}function $(pe){return pe.h==-1}i.l=function(pe){return pe=q(this,pe),$(pe)?-1:B(pe)?0:1};function W(pe){const ee=pe.g.length,J=[];for(let ye=0;ye<ee;ye++)J[ye]=~pe.g[ye];return new l(J,~pe.h).add(w)}i.abs=function(){return $(this)?W(this):this},i.add=function(pe){const ee=Math.max(this.g.length,pe.g.length),J=[];let ye=0;for(let X=0;X<=ee;X++){let ae=ye+(this.i(X)&65535)+(pe.i(X)&65535),le=(ae>>>16)+(this.i(X)>>>16)+(pe.i(X)>>>16);ye=le>>>16,ae&=65535,le&=65535,J[X]=le<<16|ae}return new l(J,J[J.length-1]&-2147483648?-1:0)};function q(pe,ee){return pe.add(W(ee))}i.j=function(pe){if(B(this)||B(pe))return p;if($(this))return $(pe)?W(this).j(W(pe)):W(W(this).j(pe));if($(pe))return W(this.j(W(pe)));if(this.l(A)<0&&pe.l(A)<0)return f(this.m()*pe.m());const ee=this.g.length+pe.g.length,J=[];for(var ye=0;ye<2*ee;ye++)J[ye]=0;for(ye=0;ye<this.g.length;ye++)for(let X=0;X<pe.g.length;X++){const ae=this.i(ye)>>>16,le=this.i(ye)&65535,ze=pe.i(X)>>>16,nt=pe.i(X)&65535;J[2*ye+2*X]+=le*nt,ge(J,2*ye+2*X),J[2*ye+2*X+1]+=ae*nt,ge(J,2*ye+2*X+1),J[2*ye+2*X+1]+=le*ze,ge(J,2*ye+2*X+1),J[2*ye+2*X+2]+=ae*ze,ge(J,2*ye+2*X+2)}for(pe=0;pe<ee;pe++)J[pe]=J[2*pe+1]<<16|J[2*pe];for(pe=ee;pe<2*ee;pe++)J[pe]=0;return new l(J,0)};function ge(pe,ee){for(;(pe[ee]&65535)!=pe[ee];)pe[ee+1]+=pe[ee]>>>16,pe[ee]&=65535,ee++}function he(pe,ee){this.g=pe,this.h=ee}function me(pe,ee){if(B(ee))throw Error("division by zero");if(B(pe))return new he(p,p);if($(pe))return ee=me(W(pe),ee),new he(W(ee.g),W(ee.h));if($(ee))return ee=me(pe,W(ee)),new he(W(ee.g),ee.h);if(pe.g.length>30){if($(pe)||$(ee))throw Error("slowDivide_ only works with positive integers.");for(var J=w,ye=ee;ye.l(pe)<=0;)J=Ce(J),ye=Ce(ye);var X=Ve(J,1),ae=Ve(ye,1);for(ye=Ve(ye,2),J=Ve(J,2);!B(ye);){var le=ae.add(ye);le.l(pe)<=0&&(X=X.add(J),ae=le),ye=Ve(ye,1),J=Ve(J,1)}return ee=q(pe,X.j(ee)),new he(X,ee)}for(X=p;pe.l(ee)>=0;){for(J=Math.max(1,Math.floor(pe.m()/ee.m())),ye=Math.ceil(Math.log(J)/Math.LN2),ye=ye<=48?1:Math.pow(2,ye-48),ae=f(J),le=ae.j(ee);$(le)||le.l(pe)>0;)J-=ye,ae=f(J),le=ae.j(ee);B(ae)&&(ae=w),X=X.add(ae),pe=q(pe,le)}return new he(X,pe)}i.B=function(pe){return me(this,pe).h},i.and=function(pe){const ee=Math.max(this.g.length,pe.g.length),J=[];for(let ye=0;ye<ee;ye++)J[ye]=this.i(ye)&pe.i(ye);return new l(J,this.h&pe.h)},i.or=function(pe){const ee=Math.max(this.g.length,pe.g.length),J=[];for(let ye=0;ye<ee;ye++)J[ye]=this.i(ye)|pe.i(ye);return new l(J,this.h|pe.h)},i.xor=function(pe){const ee=Math.max(this.g.length,pe.g.length),J=[];for(let ye=0;ye<ee;ye++)J[ye]=this.i(ye)^pe.i(ye);return new l(J,this.h^pe.h)};function Ce(pe){const ee=pe.g.length+1,J=[];for(let ye=0;ye<ee;ye++)J[ye]=pe.i(ye)<<1|pe.i(ye-1)>>>31;return new l(J,pe.h)}function Ve(pe,ee){const J=ee>>5;ee%=32;const ye=pe.g.length-J,X=[];for(let ae=0;ae<ye;ae++)X[ae]=ee>0?pe.i(ae+J)>>>ee|pe.i(ae+J+1)<<32-ee:pe.i(ae+J);return new l(X,pe.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,v3=n,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=x,Gh=l}).apply(typeof yA<"u"?yA:typeof self<"u"?self:typeof window<"u"?window:{});var Hy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var _3,Mg,b3,b0,ex,x3,w3,S3;(function(){var i,e=Object.defineProperty;function t(E){E=[typeof globalThis=="object"&&globalThis,E,typeof window=="object"&&window,typeof self=="object"&&self,typeof Hy=="object"&&Hy];for(var K=0;K<E.length;++K){var ne=E[K];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}var n=t(this);function r(E,K){if(K)e:{var ne=n;E=E.split(".");for(var Ie=0;Ie<E.length-1;Ie++){var at=E[Ie];if(!(at in ne))break e;ne=ne[at]}E=E[E.length-1],Ie=ne[E],K=K(Ie),K!=Ie&&K!=null&&e(ne,E,{configurable:!0,writable:!0,value:K})}}r("Symbol.dispose",function(E){return E||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(E){return E||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(E){return E||function(K){var ne=[],Ie;for(Ie in K)Object.prototype.hasOwnProperty.call(K,Ie)&&ne.push([Ie,K[Ie]]);return ne}});var s=s||{},l=this||self;function u(E){var K=typeof E;return K=="object"&&E!=null||K=="function"}function h(E,K,ne){return E.call.apply(E.bind,arguments)}function f(E,K,ne){return f=h,f.apply(null,arguments)}function x(E,K){var ne=Array.prototype.slice.call(arguments,1);return function(){var Ie=ne.slice();return Ie.push.apply(Ie,arguments),E.apply(this,Ie)}}function p(E,K){function ne(){}ne.prototype=K.prototype,E.Z=K.prototype,E.prototype=new ne,E.prototype.constructor=E,E.Ob=function(Ie,at,ft){for(var Vt=Array(arguments.length-2),Zn=2;Zn<arguments.length;Zn++)Vt[Zn-2]=arguments[Zn];return K.prototype[at].apply(Ie,Vt)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?E=>E&&AsyncContext.Snapshot.wrap(E):E=>E;function A(E){const K=E.length;if(K>0){const ne=Array(K);for(let Ie=0;Ie<K;Ie++)ne[Ie]=E[Ie];return ne}return[]}function B(E,K){for(let Ie=1;Ie<arguments.length;Ie++){const at=arguments[Ie];var ne=typeof at;if(ne=ne!="object"?ne:at?Array.isArray(at)?"array":ne:"null",ne=="array"||ne=="object"&&typeof at.length=="number"){ne=E.length||0;const ft=at.length||0;E.length=ne+ft;for(let Vt=0;Vt<ft;Vt++)E[ne+Vt]=at[Vt]}else E.push(at)}}class ${constructor(K,ne){this.i=K,this.j=ne,this.h=0,this.g=null}get(){let K;return this.h>0?(this.h--,K=this.g,this.g=K.next,K.next=null):K=this.i(),K}}function W(E){l.setTimeout(()=>{throw E},0)}function q(){var E=pe;let K=null;return E.g&&(K=E.g,E.g=E.g.next,E.g||(E.h=null),K.next=null),K}class ge{constructor(){this.h=this.g=null}add(K,ne){const Ie=he.get();Ie.set(K,ne),this.h?this.h.next=Ie:this.g=Ie,this.h=Ie}}var he=new $(()=>new me,E=>E.reset());class me{constructor(){this.next=this.g=this.h=null}set(K,ne){this.h=K,this.g=ne,this.next=null}reset(){this.next=this.g=this.h=null}}let Ce,Ve=!1,pe=new ge,ee=()=>{const E=Promise.resolve(void 0);Ce=()=>{E.then(J)}};function J(){for(var E;E=q();){try{E.h.call(E.g)}catch(ne){W(ne)}var K=he;K.j(E),K.h<100&&(K.h++,E.next=K.g,K.g=E)}Ve=!1}function ye(){this.u=this.u,this.C=this.C}ye.prototype.u=!1,ye.prototype.dispose=function(){this.u||(this.u=!0,this.N())},ye.prototype[Symbol.dispose]=function(){this.dispose()},ye.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function X(E,K){this.type=E,this.g=this.target=K,this.defaultPrevented=!1}X.prototype.h=function(){this.defaultPrevented=!0};var ae=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var E=!1,K=Object.defineProperty({},"passive",{get:function(){E=!0}});try{const ne=()=>{};l.addEventListener("test",ne,K),l.removeEventListener("test",ne,K)}catch{}return E})();function le(E){return/^[\s\xa0]*$/.test(E)}function ze(E,K){X.call(this,E?E.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,E&&this.init(E,K)}p(ze,X),ze.prototype.init=function(E,K){const ne=this.type=E.type,Ie=E.changedTouches&&E.changedTouches.length?E.changedTouches[0]:null;this.target=E.target||E.srcElement,this.g=K,K=E.relatedTarget,K||(ne=="mouseover"?K=E.fromElement:ne=="mouseout"&&(K=E.toElement)),this.relatedTarget=K,Ie?(this.clientX=Ie.clientX!==void 0?Ie.clientX:Ie.pageX,this.clientY=Ie.clientY!==void 0?Ie.clientY:Ie.pageY,this.screenX=Ie.screenX||0,this.screenY=Ie.screenY||0):(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0),this.button=E.button,this.key=E.key||"",this.ctrlKey=E.ctrlKey,this.altKey=E.altKey,this.shiftKey=E.shiftKey,this.metaKey=E.metaKey,this.pointerId=E.pointerId||0,this.pointerType=E.pointerType,this.state=E.state,this.i=E,E.defaultPrevented&&ze.Z.h.call(this)},ze.prototype.h=function(){ze.Z.h.call(this);const E=this.i;E.preventDefault?E.preventDefault():E.returnValue=!1};var nt="closure_listenable_"+(Math.random()*1e6|0),je=0;function Je(E,K,ne,Ie,at){this.listener=E,this.proxy=null,this.src=K,this.type=ne,this.capture=!!Ie,this.ha=at,this.key=++je,this.da=this.fa=!1}function qe(E){E.da=!0,E.listener=null,E.proxy=null,E.src=null,E.ha=null}function lt(E,K,ne){for(const Ie in E)K.call(ne,E[Ie],Ie,E)}function Tt(E,K){for(const ne in E)K.call(void 0,E[ne],ne,E)}function Ne(E){const K={};for(const ne in E)K[ne]=E[ne];return K}const se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ee(E,K){let ne,Ie;for(let at=1;at<arguments.length;at++){Ie=arguments[at];for(ne in Ie)E[ne]=Ie[ne];for(let ft=0;ft<se.length;ft++)ne=se[ft],Object.prototype.hasOwnProperty.call(Ie,ne)&&(E[ne]=Ie[ne])}}function Le(E){this.src=E,this.g={},this.h=0}Le.prototype.add=function(E,K,ne,Ie,at){const ft=E.toString();E=this.g[ft],E||(E=this.g[ft]=[],this.h++);const Vt=He(E,K,Ie,at);return Vt>-1?(K=E[Vt],ne||(K.fa=!1)):(K=new Je(K,this.src,ft,!!Ie,at),K.fa=ne,E.push(K)),K};function Be(E,K){const ne=K.type;if(ne in E.g){var Ie=E.g[ne],at=Array.prototype.indexOf.call(Ie,K,void 0),ft;(ft=at>=0)&&Array.prototype.splice.call(Ie,at,1),ft&&(qe(K),E.g[ne].length==0&&(delete E.g[ne],E.h--))}}function He(E,K,ne,Ie){for(let at=0;at<E.length;++at){const ft=E[at];if(!ft.da&&ft.listener==K&&ft.capture==!!ne&&ft.ha==Ie)return at}return-1}var Ye="closure_lm_"+(Math.random()*1e6|0),it={};function ct(E,K,ne,Ie,at){if(Array.isArray(K)){for(let ft=0;ft<K.length;ft++)ct(E,K[ft],ne,Ie,at);return null}return ne=Tn(ne),E&&E[nt]?E.J(K,ne,u(Ie)?!!Ie.capture:!1,at):Et(E,K,ne,!1,Ie,at)}function Et(E,K,ne,Ie,at,ft){if(!K)throw Error("Invalid event type");const Vt=u(at)?!!at.capture:!!at;let Zn=$t(E);if(Zn||(E[Ye]=Zn=new Le(E)),ne=Zn.add(K,ne,Ie,Vt,ft),ne.proxy)return ne;if(Ie=Ft(),ne.proxy=Ie,Ie.src=E,Ie.listener=ne,E.addEventListener)ae||(at=Vt),at===void 0&&(at=!1),E.addEventListener(K.toString(),Ie,at);else if(E.attachEvent)E.attachEvent(kt(K.toString()),Ie);else if(E.addListener&&E.removeListener)E.addListener(Ie);else throw Error("addEventListener and attachEvent are unavailable.");return ne}function Ft(){function E(ne){return K.call(E.src,E.listener,ne)}const K=Pe;return E}function Wt(E,K,ne,Ie,at){if(Array.isArray(K))for(var ft=0;ft<K.length;ft++)Wt(E,K[ft],ne,Ie,at);else Ie=u(Ie)?!!Ie.capture:!!Ie,ne=Tn(ne),E&&E[nt]?(E=E.i,ft=String(K).toString(),ft in E.g&&(K=E.g[ft],ne=He(K,ne,Ie,at),ne>-1&&(qe(K[ne]),Array.prototype.splice.call(K,ne,1),K.length==0&&(delete E.g[ft],E.h--)))):E&&(E=$t(E))&&(K=E.g[K.toString()],E=-1,K&&(E=He(K,ne,Ie,at)),(ne=E>-1?K[E]:null)&&qt(ne))}function qt(E){if(typeof E!="number"&&E&&!E.da){var K=E.src;if(K&&K[nt])Be(K.i,E);else{var ne=E.type,Ie=E.proxy;K.removeEventListener?K.removeEventListener(ne,Ie,E.capture):K.detachEvent?K.detachEvent(kt(ne),Ie):K.addListener&&K.removeListener&&K.removeListener(Ie),(ne=$t(K))?(Be(ne,E),ne.h==0&&(ne.src=null,K[Ye]=null)):qe(E)}}}function kt(E){return E in it?it[E]:it[E]="on"+E}function Pe(E,K){if(E.da)E=!0;else{K=new ze(K,this);const ne=E.listener,Ie=E.ha||E.src;E.fa&&qt(E),E=ne.call(Ie,K)}return E}function $t(E){return E=E[Ye],E instanceof Le?E:null}var Pt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Tn(E){return typeof E=="function"?E:(E[Pt]||(E[Pt]=function(K){return E.handleEvent(K)}),E[Pt])}function _t(){ye.call(this),this.i=new Le(this),this.M=this,this.G=null}p(_t,ye),_t.prototype[nt]=!0,_t.prototype.removeEventListener=function(E,K,ne,Ie){Wt(this,E,K,ne,Ie)};function rn(E,K){var ne,Ie=E.G;if(Ie)for(ne=[];Ie;Ie=Ie.G)ne.push(Ie);if(E=E.M,Ie=K.type||K,typeof K=="string")K=new X(K,E);else if(K instanceof X)K.target=K.target||E;else{var at=K;K=new X(Ie,E),Ee(K,at)}at=!0;let ft,Vt;if(ne)for(Vt=ne.length-1;Vt>=0;Vt--)ft=K.g=ne[Vt],at=Jt(ft,Ie,!0,K)&&at;if(ft=K.g=E,at=Jt(ft,Ie,!0,K)&&at,at=Jt(ft,Ie,!1,K)&&at,ne)for(Vt=0;Vt<ne.length;Vt++)ft=K.g=ne[Vt],at=Jt(ft,Ie,!1,K)&&at}_t.prototype.N=function(){if(_t.Z.N.call(this),this.i){var E=this.i;for(const K in E.g){const ne=E.g[K];for(let Ie=0;Ie<ne.length;Ie++)qe(ne[Ie]);delete E.g[K],E.h--}}this.G=null},_t.prototype.J=function(E,K,ne,Ie){return this.i.add(String(E),K,!1,ne,Ie)},_t.prototype.K=function(E,K,ne,Ie){return this.i.add(String(E),K,!0,ne,Ie)};function Jt(E,K,ne,Ie){if(K=E.i.g[String(K)],!K)return!0;K=K.concat();let at=!0;for(let ft=0;ft<K.length;++ft){const Vt=K[ft];if(Vt&&!Vt.da&&Vt.capture==ne){const Zn=Vt.listener,lr=Vt.ha||Vt.src;Vt.fa&&Be(E.i,Vt),at=Zn.call(lr,Ie)!==!1&&at}}return at&&!Ie.defaultPrevented}function En(E,K){if(typeof E!="function")if(E&&typeof E.handleEvent=="function")E=f(E.handleEvent,E);else throw Error("Invalid listener argument");return Number(K)>2147483647?-1:l.setTimeout(E,K||0)}function wn(E){E.g=En(()=>{E.g=null,E.i&&(E.i=!1,wn(E))},E.l);const K=E.h;E.h=null,E.m.apply(null,K)}class Un extends ye{constructor(K,ne){super(),this.m=K,this.l=ne,this.h=null,this.i=!1,this.g=null}j(K){this.h=arguments,this.g?this.i=!0:wn(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ii(E){ye.call(this),this.h=E,this.g={}}p(ii,ye);var Bn=[];function li(E){lt(E.g,function(K,ne){this.g.hasOwnProperty(ne)&&qt(K)},E),E.g={}}ii.prototype.N=function(){ii.Z.N.call(this),li(this)},ii.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xn=l.JSON.stringify,cn=l.JSON.parse,$n=class{stringify(E){return l.JSON.stringify(E,void 0)}parse(E){return l.JSON.parse(E,void 0)}};function hn(){}function nr(){}var Jn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function vn(){X.call(this,"d")}p(vn,X);function On(){X.call(this,"c")}p(On,X);var qn={},un=null;function Pi(){return un=un||new _t}qn.Ia="serverreachability";function Mn(E){X.call(this,qn.Ia,E)}p(Mn,X);function Sn(E){const K=Pi();rn(K,new Mn(K))}qn.STAT_EVENT="statevent";function Qn(E,K){X.call(this,qn.STAT_EVENT,E),this.stat=K}p(Qn,X);function tn(E){const K=Pi();rn(K,new Qn(K,E))}qn.Ja="timingevent";function Gt(E,K){X.call(this,qn.Ja,E),this.size=K}p(Gt,X);function Kn(E,K){if(typeof E!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){E()},K)}function Nr(){this.g=!0}Nr.prototype.ua=function(){this.g=!1};function vr(E,K,ne,Ie,at,ft){E.info(function(){if(E.g)if(ft){var Vt="",Zn=ft.split("&");for(let ci=0;ci<Zn.length;ci++){var lr=Zn[ci].split("=");if(lr.length>1){const rr=lr[0];lr=lr[1];const Ws=rr.split("_");Vt=Ws.length>=2&&Ws[1]=="type"?Vt+(rr+"="+lr+"&"):Vt+(rr+"=redacted&")}}}else Vt=null;else Vt=ft;return"XMLHTTP REQ ("+Ie+") [attempt "+at+"]: "+K+`
`+ne+`
`+Vt})}function Pr(E,K,ne,Ie,at,ft,Vt){E.info(function(){return"XMLHTTP RESP ("+Ie+") [ attempt "+at+"]: "+K+`
`+ne+`
`+ft+" "+Vt})}function Ri(E,K,ne,Ie){E.info(function(){return"XMLHTTP TEXT ("+K+"): "+Ra(E,ne)+(Ie?" "+Ie:"")})}function pn(E,K){E.info(function(){return"TIMEOUT: "+K})}Nr.prototype.info=function(){};function Ra(E,K){if(!E.g)return K;if(!K)return null;try{const ft=JSON.parse(K);if(ft){for(E=0;E<ft.length;E++)if(Array.isArray(ft[E])){var ne=ft[E];if(!(ne.length<2)){var Ie=ne[1];if(Array.isArray(Ie)&&!(Ie.length<1)){var at=Ie[0];if(at!="noop"&&at!="stop"&&at!="close")for(let Vt=1;Vt<Ie.length;Vt++)Ie[Vt]=""}}}}return Xn(ft)}catch{return K}}var sa={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Or={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},bs;function Oi(){}p(Oi,hn),Oi.prototype.g=function(){return new XMLHttpRequest},bs=new Oi;function ir(E){return encodeURIComponent(String(E))}function cr(E){var K=1;E=E.split(":");const ne=[];for(;K>0&&E.length;)ne.push(E.shift()),K--;return E.length&&ne.push(E.join(":")),ne}function cs(E,K,ne,Ie){this.j=E,this.i=K,this.l=ne,this.S=Ie||1,this.V=new ii(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ns}function ns(){this.i=null,this.g="",this.h=!1}var qi={},Yi={};function Xr(E,K,ne){E.M=1,E.A=$a(_r(K)),E.u=ne,E.R=!0,hs(E,null)}function hs(E,K){E.F=Date.now(),Jr(E),E.B=_r(E.A);var ne=E.B,Ie=E.S;Array.isArray(Ie)||(Ie=[String(Ie)]),Bo(ne.i,"t",Ie),E.C=0,ne=E.j.L,E.h=new ns,E.g=ln(E.j,ne?K:null,!E.u),E.P>0&&(E.O=new Un(f(E.Y,E,E.g),E.P)),K=E.V,ne=E.g,Ie=E.ba;var at="readystatechange";Array.isArray(at)||(at&&(Bn[0]=at.toString()),at=Bn);for(let ft=0;ft<at.length;ft++){const Vt=ct(ne,at[ft],Ie||K.handleEvent,!1,K.h||K);if(!Vt)break;K.g[Vt.key]=Vt}K=E.J?Ne(E.J):{},E.u?(E.v||(E.v="POST"),K["Content-Type"]="application/x-www-form-urlencoded",E.g.ea(E.B,E.v,E.u,K)):(E.v="GET",E.g.ea(E.B,E.v,null,K)),Sn(),vr(E.i,E.v,E.B,E.l,E.S,E.u)}cs.prototype.ba=function(E){E=E.target;const K=this.O;K&&Ir(E)==3?K.j():this.Y(E)},cs.prototype.Y=function(E){try{if(E==this.g)e:{const Zn=Ir(this.g),lr=this.g.ya(),ci=this.g.ca();if(!(Zn<3)&&(Zn!=3||this.g&&(this.h.h||this.g.la()||kr(this.g)))){this.K||Zn!=4||lr==7||(lr==8||ci<=0?Sn(3):Sn(2)),Ms(this);var K=this.g.ca();this.X=K;var ne=ya(this);if(this.o=K==200,Pr(this.i,this.v,this.B,this.l,this.S,Zn,K),this.o){if(this.U&&!this.L){t:{if(this.g){var Ie,at=this.g;if((Ie=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!le(Ie)){var ft=Ie;break t}}ft=null}if(E=ft)Ri(this.i,this.l,E,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,js(this,E);else{this.o=!1,this.m=3,tn(12),aa(this),Fs(this);break e}}if(this.R){E=!0;let rr;for(;!this.K&&this.C<ne.length;)if(rr=ds(this,ne),rr==Yi){Zn==4&&(this.m=4,tn(14),E=!1),Ri(this.i,this.l,null,"[Incomplete Response]");break}else if(rr==qi){this.m=4,tn(15),Ri(this.i,this.l,ne,"[Invalid Chunk]"),E=!1;break}else Ri(this.i,this.l,rr,null),js(this,rr);if(Ba(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Zn!=4||ne.length!=0||this.h.h||(this.m=1,tn(16),E=!1),this.o=this.o&&E,!E)Ri(this.i,this.l,ne,"[Invalid Chunked Response]"),aa(this),Fs(this);else if(ne.length>0&&!this.W){this.W=!0;var Vt=this.j;Vt.g==this&&Vt.aa&&!Vt.P&&(Vt.j.info("Great, no buffering proxy detected. Bytes received: "+ne.length),la(Vt),Vt.P=!0,tn(11))}}else Ri(this.i,this.l,ne,null),js(this,ne);Zn==4&&aa(this),this.o&&!this.K&&(Zn==4?Oe(this.j,this):(this.o=!1,Jr(this)))}else Hs(this.g),K==400&&ne.indexOf("Unknown SID")>0?(this.m=3,tn(12)):(this.m=0,tn(13)),aa(this),Fs(this)}}}catch{}finally{}};function ya(E){if(!Ba(E))return E.g.la();const K=kr(E.g);if(K==="")return"";let ne="";const Ie=K.length,at=Ir(E.g)==4;if(!E.h.i){if(typeof TextDecoder>"u")return aa(E),Fs(E),"";E.h.i=new l.TextDecoder}for(let ft=0;ft<Ie;ft++)E.h.h=!0,ne+=E.h.i.decode(K[ft],{stream:!(at&&ft==Ie-1)});return K.length=0,E.h.g+=ne,E.C=0,E.h.g}function Ba(E){return E.g?E.v=="GET"&&E.M!=2&&E.j.Aa:!1}function ds(E,K){var ne=E.C,Ie=K.indexOf(`
`,ne);return Ie==-1?Yi:(ne=Number(K.substring(ne,Ie)),isNaN(ne)?qi:(Ie+=1,Ie+ne>K.length?Yi:(K=K.slice(Ie,Ie+ne),E.C=Ie+ne,K)))}cs.prototype.cancel=function(){this.K=!0,aa(this)};function Jr(E){E.T=Date.now()+E.H,ro(E,E.H)}function ro(E,K){if(E.D!=null)throw Error("WatchDog timer not null");E.D=Kn(f(E.aa,E),K)}function Ms(E){E.D&&(l.clearTimeout(E.D),E.D=null)}cs.prototype.aa=function(){this.D=null;const E=Date.now();E-this.T>=0?(pn(this.i,this.B),this.M!=2&&(Sn(),tn(17)),aa(this),this.m=2,Fs(this)):ro(this,this.T-E)};function Fs(E){E.j.I==0||E.K||Oe(E.j,E)}function aa(E){Ms(E);var K=E.O;K&&typeof K.dispose=="function"&&K.dispose(),E.O=null,li(E.V),E.g&&(K=E.g,E.g=null,K.abort(),K.dispose())}function js(E,K){try{var ne=E.j;if(ne.I!=0&&(ne.g==E||Is(ne.h,E))){if(!E.L&&Is(ne.h,E)&&ne.I==3){try{var Ie=ne.Ba.g.parse(K)}catch{Ie=null}if(Array.isArray(Ie)&&Ie.length==3){var at=Ie;if(at[0]==0){e:if(!ne.v){if(ne.g)if(ne.g.F+3e3<E.F)fe(ne),Gr(ne);else break e;Cr(ne),tn(18)}}else ne.xa=at[1],0<ne.xa-ne.K&&at[2]<37500&&ne.F&&ne.A==0&&!ne.C&&(ne.C=Kn(f(ne.Va,ne),6e3));va(ne.h)<=1&&ne.ta&&(ne.ta=void 0)}else tt(ne,11)}else if((E.L||ne.g==E)&&fe(ne),!le(K))for(at=ne.Ba.g.parse(K),K=0;K<at.length;K++){let ci=at[K];const rr=ci[0];if(!(rr<=ne.K))if(ne.K=rr,ci=ci[1],ne.I==2)if(ci[0]=="c"){ne.M=ci[1],ne.ba=ci[2];const Ws=ci[3];Ws!=null&&(ne.ka=Ws,ne.j.info("VER="+ne.ka));const ua=ci[4];ua!=null&&(ne.za=ua,ne.j.info("SVER="+ne.za));const wr=ci[5];wr!=null&&typeof wr=="number"&&wr>0&&(Ie=1.5*wr,ne.O=Ie,ne.j.info("backChannelRequestTimeoutMs_="+Ie)),Ie=ne;const ca=E.g;if(ca){const qa=ca.g?ca.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qa){var ft=Ie.h;ft.g||qa.indexOf("spdy")==-1&&qa.indexOf("quic")==-1&&qa.indexOf("h2")==-1||(ft.j=ft.l,ft.g=new Set,ft.h&&(jo(ft,ft.h),ft.h=null))}if(Ie.G){const $o=ca.g?ca.g.getResponseHeader("X-HTTP-Session-Id"):null;$o&&(Ie.wa=$o,yi(Ie.J,Ie.G,$o))}}ne.I=3,ne.l&&ne.l.ra(),ne.aa&&(ne.T=Date.now()-E.F,ne.j.info("Handshake RTT: "+ne.T+"ms")),Ie=ne;var Vt=E;if(Ie.na=Mt(Ie,Ie.L?Ie.ba:null,Ie.W),Vt.L){nl(Ie.h,Vt);var Zn=Vt,lr=Ie.O;lr&&(Zn.H=lr),Zn.D&&(Ms(Zn),Jr(Zn)),Ie.g=Vt}else Di(Ie);ne.i.length>0&&fs(ne)}else ci[0]!="stop"&&ci[0]!="close"||tt(ne,7);else ne.I==3&&(ci[0]=="stop"||ci[0]=="close"?ci[0]=="stop"?tt(ne,7):Ka(ne):ci[0]!="noop"&&ne.l&&ne.l.qa(ci),ne.A=0)}}Sn(4)}catch{}}var hr=class{constructor(E,K){this.g=E,this.map=K}};function vl(E){this.l=E||10,l.PerformanceNavigationTiming?(E=l.performance.getEntriesByType("navigation"),E=E.length>0&&(E[0].nextHopProtocol=="hq"||E[0].nextHopProtocol=="h2")):E=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=E?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Vs(E){return E.h?!0:E.g?E.g.size>=E.j:!1}function va(E){return E.h?1:E.g?E.g.size:0}function Is(E,K){return E.h?E.h==K:E.g?E.g.has(K):!1}function jo(E,K){E.g?E.g.add(K):E.h=K}function nl(E,K){E.h&&E.h==K?E.h=null:E.g&&E.g.has(K)&&E.g.delete(K)}vl.prototype.cancel=function(){if(this.i=il(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const E of this.g.values())E.cancel();this.g.clear()}};function il(E){if(E.h!=null)return E.i.concat(E.h.G);if(E.g!=null&&E.g.size!==0){let K=E.i;for(const ne of E.g.values())K=K.concat(ne.G);return K}return A(E.i)}var Vo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function oi(E,K){if(E){E=E.split("&");for(let ne=0;ne<E.length;ne++){const Ie=E[ne].indexOf("=");let at,ft=null;Ie>=0?(at=E[ne].substring(0,Ie),ft=E[ne].substring(Ie+1)):at=E[ne],K(at,ft?decodeURIComponent(ft.replace(/\+/g," ")):"")}}}function Hr(E){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let K;E instanceof Hr?(this.l=E.l,dn(this,E.j),this.o=E.o,this.g=E.g,Da(this,E.u),this.h=E.h,zs(this,Ha(E.i)),this.m=E.m):E&&(K=String(E).match(Vo))?(this.l=!1,dn(this,K[1]||"",!0),this.o=ri(K[2]||""),this.g=ri(K[3]||"",!0),Da(this,K[4]),this.h=ri(K[5]||"",!0),zs(this,K[6]||"",!0),this.m=ri(K[7]||"")):(this.l=!1,this.i=new oa(null,this.l))}Hr.prototype.toString=function(){const E=[];var K=this.j;K&&E.push(dr(K,zo,!0),":");var ne=this.g;return(ne||K=="file")&&(E.push("//"),(K=this.o)&&E.push(dr(K,zo,!0),"@"),E.push(ir(ne).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ne=this.u,ne!=null&&E.push(":",String(ne))),(ne=this.h)&&(this.g&&ne.charAt(0)!="/"&&E.push("/"),E.push(dr(ne,ne.charAt(0)=="/"?Uo:$l,!0))),(ne=this.i.toString())&&E.push("?",ne),(ne=this.m)&&E.push("#",dr(ne,_l)),E.join("")},Hr.prototype.resolve=function(E){const K=_r(this);let ne=!!E.j;ne?dn(K,E.j):ne=!!E.o,ne?K.o=E.o:ne=!!E.g,ne?K.g=E.g:ne=E.u!=null;var Ie=E.h;if(ne)Da(K,E.u);else if(ne=!!E.h){if(Ie.charAt(0)!="/")if(this.g&&!this.h)Ie="/"+Ie;else{var at=K.h.lastIndexOf("/");at!=-1&&(Ie=K.h.slice(0,at+1)+Ie)}if(at=Ie,at==".."||at==".")Ie="";else if(at.indexOf("./")!=-1||at.indexOf("/.")!=-1){Ie=at.lastIndexOf("/",0)==0,at=at.split("/");const ft=[];for(let Vt=0;Vt<at.length;){const Zn=at[Vt++];Zn=="."?Ie&&Vt==at.length&&ft.push(""):Zn==".."?((ft.length>1||ft.length==1&&ft[0]!="")&&ft.pop(),Ie&&Vt==at.length&&ft.push("")):(ft.push(Zn),Ie=!0)}Ie=ft.join("/")}else Ie=at}return ne?K.h=Ie:ne=E.i.toString()!=="",ne?zs(K,Ha(E.i)):ne=!!E.m,ne&&(K.m=E.m),K};function _r(E){return new Hr(E)}function dn(E,K,ne){E.j=ne?ri(K,!0):K,E.j&&(E.j=E.j.replace(/:$/,""))}function Da(E,K){if(K){if(K=Number(K),isNaN(K)||K<0)throw Error("Bad port number "+K);E.u=K}else E.u=null}function zs(E,K,ne){K instanceof oa?(E.i=K,St(E.i,E.l)):(ne||(K=dr(K,br)),E.i=new oa(K,E.l))}function yi(E,K,ne){E.i.set(K,ne)}function $a(E){return yi(E,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),E}function ri(E,K){return E?K?decodeURI(E.replace(/%25/g,"%2525")):decodeURIComponent(E):""}function dr(E,K,ne){return typeof E=="string"?(E=encodeURI(E).replace(K,Mr),ne&&(E=E.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),E):null}function Mr(E){return E=E.charCodeAt(0),"%"+(E>>4&15).toString(16)+(E&15).toString(16)}var zo=/[#\/\?@]/g,$l=/[#\?:]/g,Uo=/[#\?]/g,br=/[#\?@]/g,_l=/#/g;function oa(E,K){this.h=this.g=null,this.i=E||null,this.j=!!K}function Mi(E){E.g||(E.g=new Map,E.h=0,E.i&&oi(E.i,function(K,ne){E.add(decodeURIComponent(K.replace(/\+/g," ")),ne)}))}i=oa.prototype,i.add=function(E,K){Mi(this),this.i=null,E=At(this,E);let ne=this.g.get(E);return ne||this.g.set(E,ne=[]),ne.push(K),this.h+=1,this};function so(E,K){Mi(E),K=At(E,K),E.g.has(K)&&(E.i=null,E.h-=E.g.get(K).length,E.g.delete(K))}function bl(E,K){return Mi(E),K=At(E,K),E.g.has(K)}i.forEach=function(E,K){Mi(this),this.g.forEach(function(ne,Ie){ne.forEach(function(at){E.call(K,at,Ie,this)},this)},this)};function xl(E,K){Mi(E);let ne=[];if(typeof K=="string")bl(E,K)&&(ne=ne.concat(E.g.get(At(E,K))));else for(E=Array.from(E.g.values()),K=0;K<E.length;K++)ne=ne.concat(E[K]);return ne}i.set=function(E,K){return Mi(this),this.i=null,E=At(this,E),bl(this,E)&&(this.h-=this.g.get(E).length),this.g.set(E,[K]),this.h+=1,this},i.get=function(E,K){return E?(E=xl(this,E),E.length>0?String(E[0]):K):K};function Bo(E,K,ne){so(E,K),ne.length>0&&(E.i=null,E.g.set(At(E,K),A(ne)),E.h+=ne.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const E=[],K=Array.from(this.g.keys());for(let Ie=0;Ie<K.length;Ie++){var ne=K[Ie];const at=ir(ne);ne=xl(this,ne);for(let ft=0;ft<ne.length;ft++){let Vt=at;ne[ft]!==""&&(Vt+="="+ir(ne[ft])),E.push(Vt)}}return this.i=E.join("&")};function Ha(E){const K=new oa;return K.i=E.i,E.g&&(K.g=new Map(E.g),K.h=E.h),K}function At(E,K){return K=String(K),E.j&&(K=K.toLowerCase()),K}function St(E,K){K&&!E.j&&(Mi(E),E.i=null,E.g.forEach(function(ne,Ie){const at=Ie.toLowerCase();Ie!=at&&(so(this,Ie),Bo(this,at,ne))},E)),E.j=K}function fn(E,K){const ne=new Nr;if(l.Image){const Ie=new Image;Ie.onload=x(Xi,ne,"TestLoadImage: loaded",!0,K,Ie),Ie.onerror=x(Xi,ne,"TestLoadImage: error",!1,K,Ie),Ie.onabort=x(Xi,ne,"TestLoadImage: abort",!1,K,Ie),Ie.ontimeout=x(Xi,ne,"TestLoadImage: timeout",!1,K,Ie),l.setTimeout(function(){Ie.ontimeout&&Ie.ontimeout()},1e4),Ie.src=E}else K(!1)}function ui(E,K){const ne=new Nr,Ie=new AbortController,at=setTimeout(()=>{Ie.abort(),Xi(ne,"TestPingServer: timeout",!1,K)},1e4);fetch(E,{signal:Ie.signal}).then(ft=>{clearTimeout(at),ft.ok?Xi(ne,"TestPingServer: ok",!0,K):Xi(ne,"TestPingServer: server error",!1,K)}).catch(()=>{clearTimeout(at),Xi(ne,"TestPingServer: error",!1,K)})}function Xi(E,K,ne,Ie,at){try{at&&(at.onload=null,at.onerror=null,at.onabort=null,at.ontimeout=null),Ie(ne)}catch{}}function vi(){this.g=new $n}function Qt(E){this.i=E.Sb||null,this.h=E.ab||!1}p(Qt,hn),Qt.prototype.g=function(){return new xs(this.i,this.h)};function xs(E,K){_t.call(this),this.H=E,this.o=K,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(xs,_t),i=xs.prototype,i.open=function(E,K){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=E,this.D=K,this.readyState=1,Er(this)},i.send=function(E){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const K={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};E&&(K.body=E),(this.H||l).fetch(new Request(this.D,K)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Us(this)),this.readyState=0},i.Pa=function(E){if(this.g&&(this.l=E,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=E.headers,this.readyState=2,Er(this)),this.g&&(this.readyState=3,Er(this),this.g)))if(this.responseType==="arraybuffer")E.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in E){if(this.j=E.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;_a(this)}else E.text().then(this.Oa.bind(this),this.ga.bind(this))};function _a(E){E.j.read().then(E.Ma.bind(E)).catch(E.ga.bind(E))}i.Ma=function(E){if(this.g){if(this.o&&E.value)this.response.push(E.value);else if(!this.o){var K=E.value?E.value:new Uint8Array(0);(K=this.B.decode(K,{stream:!E.done}))&&(this.response=this.responseText+=K)}E.done?Us(this):Er(this),this.readyState==3&&_a(this)}},i.Oa=function(E){this.g&&(this.response=this.responseText=E,Us(this))},i.Na=function(E){this.g&&(this.response=E,Us(this))},i.ga=function(){this.g&&Us(this)};function Us(E){E.readyState=4,E.l=null,E.j=null,E.B=null,Er(E)}i.setRequestHeader=function(E,K){this.A.append(E,K)},i.getResponseHeader=function(E){return this.h&&this.h.get(E.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const E=[],K=this.h.entries();for(var ne=K.next();!ne.done;)ne=ne.value,E.push(ne[0]+": "+ne[1]),ne=K.next();return E.join(`\r
`)};function Er(E){E.onreadystatechange&&E.onreadystatechange.call(E)}Object.defineProperty(xs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(E){this.m=E?"include":"same-origin"}});function Ai(E){let K="";return lt(E,function(ne,Ie){K+=Ie,K+=":",K+=ne,K+=`\r
`}),K}function ba(E,K,ne){e:{for(Ie in ne){var Ie=!1;break e}Ie=!0}Ie||(ne=Ai(ne),typeof E=="string"?ne!=null&&ir(ne):yi(E,K,ne))}function Ci(E){_t.call(this),this.headers=new Map,this.L=E||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(Ci,_t);var Bs=/^https?$/i,Ga=["POST","PUT"];i=Ci.prototype,i.Fa=function(E){this.H=E},i.ea=function(E,K,ne,Ie){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+E);K=K?K.toUpperCase():"GET",this.D=E,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():bs.g(),this.g.onreadystatechange=w(f(this.Ca,this));try{this.B=!0,this.g.open(K,String(E),!0),this.B=!1}catch(ft){$s(this,ft);return}if(E=ne||"",ne=new Map(this.headers),Ie)if(Object.getPrototypeOf(Ie)===Object.prototype)for(var at in Ie)ne.set(at,Ie[at]);else if(typeof Ie.keys=="function"&&typeof Ie.get=="function")for(const ft of Ie.keys())ne.set(ft,Ie.get(ft));else throw Error("Unknown input type for opt_headers: "+String(Ie));Ie=Array.from(ne.keys()).find(ft=>ft.toLowerCase()=="content-type"),at=l.FormData&&E instanceof l.FormData,!(Array.prototype.indexOf.call(Ga,K,void 0)>=0)||Ie||at||ne.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ft,Vt]of ne)this.g.setRequestHeader(ft,Vt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(E),this.v=!1}catch(ft){$s(this,ft)}};function $s(E,K){E.h=!1,E.g&&(E.j=!0,E.g.abort(),E.j=!1),E.l=K,E.o=5,gn(E),La(E)}function gn(E){E.A||(E.A=!0,rn(E,"complete"),rn(E,"error"))}i.abort=function(E){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=E||7,rn(this,"complete"),rn(this,"abort"),La(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),La(this,!0)),Ci.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?ks(this):this.Xa())},i.Xa=function(){ks(this)};function ks(E){if(E.h&&typeof s<"u"){if(E.v&&Ir(E)==4)setTimeout(E.Ca.bind(E),0);else if(rn(E,"readystatechange"),Ir(E)==4){E.h=!1;try{const ft=E.ca();e:switch(ft){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var K=!0;break e;default:K=!1}var ne;if(!(ne=K)){var Ie;if(Ie=ft===0){let Vt=String(E.D).match(Vo)[1]||null;!Vt&&l.self&&l.self.location&&(Vt=l.self.location.protocol.slice(0,-1)),Ie=!Bs.test(Vt?Vt.toLowerCase():"")}ne=Ie}if(ne)rn(E,"complete"),rn(E,"success");else{E.o=6;try{var at=Ir(E)>2?E.g.statusText:""}catch{at=""}E.l=at+" ["+E.ca()+"]",gn(E)}}finally{La(E)}}}}function La(E,K){if(E.g){E.m&&(clearTimeout(E.m),E.m=null);const ne=E.g;E.g=null,K||rn(E,"ready");try{ne.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function Ir(E){return E.g?E.g.readyState:0}i.ca=function(){try{return Ir(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(E){if(this.g){var K=this.g.responseText;return E&&K.indexOf(E)==0&&(K=K.substring(E.length)),cn(K)}};function kr(E){try{if(!E.g)return null;if("response"in E.g)return E.g.response;switch(E.F){case"":case"text":return E.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in E.g)return E.g.mozResponseArrayBuffer}return null}catch{return null}}function Hs(E){const K={};E=(E.g&&Ir(E)>=2&&E.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ie=0;Ie<E.length;Ie++){if(le(E[Ie]))continue;var ne=cr(E[Ie]);const at=ne[0];if(ne=ne[1],typeof ne!="string")continue;ne=ne.trim();const ft=K[at]||[];K[at]=ft,ft.push(ne)}Tt(K,function(Ie){return Ie.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function xr(E,K,ne){return ne&&ne.internalChannelParams&&ne.internalChannelParams[E]||K}function Gs(E){this.za=0,this.i=[],this.j=new Nr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=xr("failFast",!1,E),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=xr("baseRetryDelayMs",5e3,E),this.Za=xr("retryDelaySeedMs",1e4,E),this.Ta=xr("forwardChannelMaxRetries",2,E),this.va=xr("forwardChannelRequestTimeoutMs",2e4,E),this.ma=E&&E.xmlHttpFactory||void 0,this.Ua=E&&E.Rb||void 0,this.Aa=E&&E.useFetchStreams||!1,this.O=void 0,this.L=E&&E.supportsCrossDomainXhr||!1,this.M="",this.h=new vl(E&&E.concurrentRequestLimit),this.Ba=new vi,this.S=E&&E.fastHandshake||!1,this.R=E&&E.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=E&&E.Pb||!1,E&&E.ua&&this.j.ua(),E&&E.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&E&&E.detectBufferingProxy||!1,this.ia=void 0,E&&E.longPollingTimeout&&E.longPollingTimeout>0&&(this.ia=E.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=Gs.prototype,i.ka=8,i.I=1,i.connect=function(E,K,ne,Ie){tn(0),this.W=E,this.H=K||{},ne&&Ie!==void 0&&(this.H.OSID=ne,this.H.OAID=Ie),this.F=this.X,this.J=Mt(this,null,this.W),fs(this)};function Ka(E){if(Wa(E),E.I==3){var K=E.V++,ne=_r(E.J);if(yi(ne,"SID",E.M),yi(ne,"RID",K),yi(ne,"TYPE","terminate"),Ks(E,ne),K=new cs(E,E.j,K),K.M=2,K.A=$a(_r(ne)),ne=!1,l.navigator&&l.navigator.sendBeacon)try{ne=l.navigator.sendBeacon(K.A.toString(),"")}catch{}!ne&&l.Image&&(new Image().src=K.A,ne=!0),ne||(K.g=ln(K.j,null),K.g.ea(K.A)),K.F=Date.now(),Jr(K)}It(E)}function Gr(E){E.g&&(la(E),E.g.cancel(),E.g=null)}function Wa(E){Gr(E),E.v&&(l.clearTimeout(E.v),E.v=null),fe(E),E.h.cancel(),E.m&&(typeof E.m=="number"&&l.clearTimeout(E.m),E.m=null)}function fs(E){if(!Vs(E.h)&&!E.m){E.m=!0;var K=E.Ea;Ce||ee(),Ve||(Ce(),Ve=!0),pe.add(K,E),E.D=0}}function ao(E,K){return va(E.h)>=E.h.j-(E.m?1:0)?!1:E.m?(E.i=K.G.concat(E.i),!0):E.I==1||E.I==2||E.D>=(E.Sa?0:E.Ta)?!1:(E.m=Kn(f(E.Ea,E,K),We(E,E.D)),E.D++,!0)}i.Ea=function(E){if(this.m)if(this.m=null,this.I==1){if(!E){this.V=Math.floor(Math.random()*1e5),E=this.V++;const at=new cs(this,this.j,E);let ft=this.o;if(this.U&&(ft?(ft=Ne(ft),Ee(ft,this.U)):ft=this.U),this.u!==null||this.R||(at.J=ft,ft=null),this.S)e:{for(var K=0,ne=0;ne<this.i.length;ne++){t:{var Ie=this.i[ne];if("__data__"in Ie.map&&(Ie=Ie.map.__data__,typeof Ie=="string")){Ie=Ie.length;break t}Ie=void 0}if(Ie===void 0)break;if(K+=Ie,K>4096){K=ne;break e}if(K===4096||ne===this.i.length-1){K=ne+1;break e}}K=1e3}else K=1e3;K=on(this,at,K),ne=_r(this.J),yi(ne,"RID",E),yi(ne,"CVER",22),this.G&&yi(ne,"X-HTTP-Session-Id",this.G),Ks(this,ne),ft&&(this.R?K="headers="+ir(Ai(ft))+"&"+K:this.u&&ba(ne,this.u,ft)),jo(this.h,at),this.Ra&&yi(ne,"TYPE","init"),this.S?(yi(ne,"$req",K),yi(ne,"SID","null"),at.U=!0,Xr(at,ne,null)):Xr(at,ne,K),this.I=2}}else this.I==3&&(E?To(this,E):this.i.length==0||Vs(this.h)||To(this))};function To(E,K){var ne;K?ne=K.l:ne=E.V++;const Ie=_r(E.J);yi(Ie,"SID",E.M),yi(Ie,"RID",ne),yi(Ie,"AID",E.K),Ks(E,Ie),E.u&&E.o&&ba(Ie,E.u,E.o),ne=new cs(E,E.j,ne,E.D+1),E.u===null&&(ne.J=E.o),K&&(E.i=K.G.concat(E.i)),K=on(E,ne,1e3),ne.H=Math.round(E.va*.5)+Math.round(E.va*.5*Math.random()),jo(E.h,ne),Xr(ne,Ie,K)}function Ks(E,K){E.H&&lt(E.H,function(ne,Ie){yi(K,Ie,ne)}),E.l&&lt({},function(ne,Ie){yi(K,Ie,ne)})}function on(E,K,ne){ne=Math.min(E.i.length,ne);const Ie=E.l?f(E.l.Ka,E.l,E):null;e:{var at=E.i;let Zn=-1;for(;;){const lr=["count="+ne];Zn==-1?ne>0?(Zn=at[0].g,lr.push("ofs="+Zn)):Zn=0:lr.push("ofs="+Zn);let ci=!0;for(let rr=0;rr<ne;rr++){var ft=at[rr].g;const Ws=at[rr].map;if(ft-=Zn,ft<0)Zn=Math.max(0,at[rr].g-100),ci=!1;else try{ft="req"+ft+"_"||"";try{var Vt=Ws instanceof Map?Ws:Object.entries(Ws);for(const[ua,wr]of Vt){let ca=wr;u(wr)&&(ca=Xn(wr)),lr.push(ft+ua+"="+encodeURIComponent(ca))}}catch(ua){throw lr.push(ft+"type="+encodeURIComponent("_badmap")),ua}}catch{Ie&&Ie(Ws)}}if(ci){Vt=lr.join("&");break e}}Vt=void 0}return E=E.i.splice(0,ne),K.G=E,Vt}function Di(E){if(!E.g&&!E.v){E.Y=1;var K=E.Da;Ce||ee(),Ve||(Ce(),Ve=!0),pe.add(K,E),E.A=0}}function Cr(E){return E.g||E.v||E.A>=3?!1:(E.Y++,E.v=Kn(f(E.Da,E),We(E,E.A)),E.A++,!0)}i.Da=function(){if(this.v=null,j(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var E=4*this.T;this.j.info("BP detection timer enabled: "+E),this.B=Kn(f(this.Wa,this),E)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,tn(10),Gr(this),j(this))};function la(E){E.B!=null&&(l.clearTimeout(E.B),E.B=null)}function j(E){E.g=new cs(E,E.j,"rpc",E.Y),E.u===null&&(E.g.J=E.o),E.g.P=0;var K=_r(E.na);yi(K,"RID","rpc"),yi(K,"SID",E.M),yi(K,"AID",E.K),yi(K,"CI",E.F?"0":"1"),!E.F&&E.ia&&yi(K,"TO",E.ia),yi(K,"TYPE","xmlhttp"),Ks(E,K),E.u&&E.o&&ba(K,E.u,E.o),E.O&&(E.g.H=E.O);var ne=E.g;E=E.ba,ne.M=1,ne.A=$a(_r(K)),ne.u=null,ne.R=!0,hs(ne,E)}i.Va=function(){this.C!=null&&(this.C=null,Gr(this),Cr(this),tn(19))};function fe(E){E.C!=null&&(l.clearTimeout(E.C),E.C=null)}function Oe(E,K){var ne=null;if(E.g==K){fe(E),la(E),E.g=null;var Ie=2}else if(Is(E.h,K))ne=K.G,nl(E.h,K),Ie=1;else return;if(E.I!=0){if(K.o)if(Ie==1){ne=K.u?K.u.length:0,K=Date.now()-K.F;var at=E.D;Ie=Pi(),rn(Ie,new Gt(Ie,ne)),fs(E)}else Di(E);else if(at=K.m,at==3||at==0&&K.X>0||!(Ie==1&&ao(E,K)||Ie==2&&Cr(E)))switch(ne&&ne.length>0&&(K=E.h,K.i=K.i.concat(ne)),at){case 1:tt(E,5);break;case 4:tt(E,10);break;case 3:tt(E,6);break;default:tt(E,2)}}}function We(E,K){let ne=E.Qa+Math.floor(Math.random()*E.Za);return E.isActive()||(ne*=2),ne*K}function tt(E,K){if(E.j.info("Error code "+K),K==2){var ne=f(E.bb,E),Ie=E.Ua;const at=!Ie;Ie=new Hr(Ie||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||dn(Ie,"https"),$a(Ie),at?fn(Ie.toString(),ne):ui(Ie.toString(),ne)}else tn(2);E.I=0,E.l&&E.l.pa(K),It(E),Wa(E)}i.bb=function(E){E?(this.j.info("Successfully pinged google.com"),tn(2)):(this.j.info("Failed to ping google.com"),tn(1))};function It(E){if(E.I=0,E.ja=[],E.l){const K=il(E.h);(K.length!=0||E.i.length!=0)&&(B(E.ja,K),B(E.ja,E.i),E.h.i.length=0,A(E.i),E.i.length=0),E.l.oa()}}function Mt(E,K,ne){var Ie=ne instanceof Hr?_r(ne):new Hr(ne);if(Ie.g!="")K&&(Ie.g=K+"."+Ie.g),Da(Ie,Ie.u);else{var at=l.location;Ie=at.protocol,K=K?K+"."+at.hostname:at.hostname,at=+at.port;const ft=new Hr(null);Ie&&dn(ft,Ie),K&&(ft.g=K),at&&Da(ft,at),ne&&(ft.h=ne),Ie=ft}return ne=E.G,K=E.wa,ne&&K&&yi(Ie,ne,K),yi(Ie,"VER",E.ka),Ks(E,Ie),Ie}function ln(E,K,ne){if(K&&!E.L)throw Error("Can't create secondary domain capable XhrIo object.");return K=E.Aa&&!E.ma?new Ci(new Qt({ab:ne})):new Ci(E.ma),K.Fa(E.L),K}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function mn(){}i=mn.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function Vn(){}Vn.prototype.g=function(E,K){return new Rn(E,K)};function Rn(E,K){_t.call(this),this.g=new Gs(K),this.l=E,this.h=K&&K.messageUrlParams||null,E=K&&K.messageHeaders||null,K&&K.clientProtocolHeaderRequired&&(E?E["X-Client-Protocol"]="webchannel":E={"X-Client-Protocol":"webchannel"}),this.g.o=E,E=K&&K.initMessageHeaders||null,K&&K.messageContentType&&(E?E["X-WebChannel-Content-Type"]=K.messageContentType:E={"X-WebChannel-Content-Type":K.messageContentType}),K&&K.sa&&(E?E["X-WebChannel-Client-Profile"]=K.sa:E={"X-WebChannel-Client-Profile":K.sa}),this.g.U=E,(E=K&&K.Qb)&&!le(E)&&(this.g.u=E),this.A=K&&K.supportsCrossDomainXhr||!1,this.v=K&&K.sendRawJson||!1,(K=K&&K.httpSessionIdParam)&&!le(K)&&(this.g.G=K,E=this.h,E!==null&&K in E&&(E=this.h,K in E&&delete E[K])),this.j=new fr(this)}p(Rn,_t),Rn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Rn.prototype.close=function(){Ka(this.g)},Rn.prototype.o=function(E){var K=this.g;if(typeof E=="string"){var ne={};ne.__data__=E,E=ne}else this.v&&(ne={},ne.__data__=Xn(E),E=ne);K.i.push(new hr(K.Ya++,E)),K.I==3&&fs(K)},Rn.prototype.N=function(){this.g.l=null,delete this.j,Ka(this.g),delete this.g,Rn.Z.N.call(this)};function Ei(E){vn.call(this),E.__headers__&&(this.headers=E.__headers__,this.statusCode=E.__status__,delete E.__headers__,delete E.__status__);var K=E.__sm__;if(K){e:{for(const ne in K){E=ne;break e}E=void 0}(this.i=E)&&(E=this.i,K=K!==null&&E in K?K[E]:void 0),this.data=K}else this.data=E}p(Ei,vn);function Rr(){On.call(this),this.status=1}p(Rr,On);function fr(E){this.g=E}p(fr,mn),fr.prototype.ra=function(){rn(this.g,"a")},fr.prototype.qa=function(E){rn(this.g,new Ei(E))},fr.prototype.pa=function(E){rn(this.g,new Rr)},fr.prototype.oa=function(){rn(this.g,"b")},Vn.prototype.createWebChannel=Vn.prototype.g,Rn.prototype.send=Rn.prototype.o,Rn.prototype.open=Rn.prototype.m,Rn.prototype.close=Rn.prototype.close,S3=function(){return new Vn},w3=function(){return Pi()},x3=qn,ex={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},sa.NO_ERROR=0,sa.TIMEOUT=8,sa.HTTP_ERROR=6,b0=sa,Or.COMPLETE="complete",b3=Or,nr.EventType=Jn,Jn.OPEN="a",Jn.CLOSE="b",Jn.ERROR="c",Jn.MESSAGE="d",_t.prototype.listen=_t.prototype.J,Mg=nr,Ci.prototype.listenOnce=Ci.prototype.K,Ci.prototype.getLastError=Ci.prototype.Ha,Ci.prototype.getLastErrorCode=Ci.prototype.ya,Ci.prototype.getStatus=Ci.prototype.ca,Ci.prototype.getResponseJson=Ci.prototype.La,Ci.prototype.getResponseText=Ci.prototype.la,Ci.prototype.send=Ci.prototype.ea,Ci.prototype.setWithCredentials=Ci.prototype.Fa,_3=Ci}).apply(typeof Hy<"u"?Hy:typeof self<"u"?self:typeof window<"u"?window:{});const vA="@firebase/firestore",_A="4.9.2";class bo{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bo.UNAUTHENTICATED=new bo(null),bo.GOOGLE_CREDENTIALS=new bo("google-credentials-uid"),bo.FIRST_PARTY=new bo("first-party-uid"),bo.MOCK_USER=new bo("mock-user");let zp="12.3.0";const Yd=new H1("@firebase/firestore");function $f(){return Yd.logLevel}function zt(i,...e){if(Yd.logLevel<=Ki.DEBUG){const t=e.map(k2);Yd.debug(`Firestore (${zp}): ${i}`,...t)}}function Qo(i,...e){if(Yd.logLevel<=Ki.ERROR){const t=e.map(k2);Yd.error(`Firestore (${zp}): ${i}`,...t)}}function Xd(i,...e){if(Yd.logLevel<=Ki.WARN){const t=e.map(k2);Yd.warn(`Firestore (${zp}): ${i}`,...t)}}function k2(i){if(typeof i=="string")return i;try{return(function(t){return JSON.stringify(t)})(i)}catch{return i}}function xn(i,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,T3(i,n,t)}function T3(i,e,t){let n=`FIRESTORE (${zp}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw Qo(n),new Error(n)}function jn(i,e,t,n){let r="Unexpected state";typeof t=="string"?r=t:n=t,i||T3(e,r,n)}function di(i,e){return i}const Rt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xt extends lc{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nc{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class A3{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tj{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(bo.UNAUTHENTICATED)))}shutdown(){}}class nj{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ij{constructor(e){this.t=e,this.currentUser=bo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){jn(this.o===void 0,42304);let n=this.i;const r=h=>this.i!==n?(n=this.i,t(h)):Promise.resolve();let s=new nc;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new nc,e.enqueueRetryable((()=>r(this.currentUser)))};const l=()=>{const h=s;e.enqueueRetryable((async()=>{await h.promise,await r(this.currentUser)}))},u=h=>{zt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(zt("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new nc)}}),0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(zt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(jn(typeof n.accessToken=="string",31837,{l:n}),new A3(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return jn(e===null||typeof e=="string",2055,{h:e}),new bo(e)}}class rj{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=bo.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class sj{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new rj(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(bo.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class bA{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aj{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Mo(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){jn(this.o===void 0,3512);const n=s=>{s.error!=null&&zt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const l=s.token!==this.m;return this.m=s.token,zt("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>n(s)))};const r=s=>{zt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>r(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):zt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new bA(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(jn(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new bA(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function oj(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}class C2{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const r=oj(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%62))}return n}}function hi(i,e){return i<e?-1:i>e?1:0}function tx(i,e){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++){const r=i.charAt(n),s=e.charAt(n);if(r!==s)return J_(r)===J_(s)?hi(r,s):J_(r)?1:-1}return hi(i.length,e.length)}const lj=55296,uj=57343;function J_(i){const e=i.charCodeAt(0);return e>=lj&&e<=uj}function gp(i,e,t){return i.length===e.length&&i.every(((n,r)=>t(n,e[r])))}function E3(i){return i+"\0"}const xA="__name__";class Yu{constructor(e,t,n){t===void 0?t=0:t>e.length&&xn(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&xn(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Yu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Yu?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const s=Yu.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return hi(e.length,t.length)}static compareSegments(e,t){const n=Yu.isNumericId(e),r=Yu.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?Yu.extractNumericId(e).compare(Yu.extractNumericId(t)):tx(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Gh.fromString(e.substring(4,e.length-2))}}class Ar extends Yu{construct(e,t,n){return new Ar(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Xt(Rt.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((r=>r.length>0)))}return new Ar(t)}static emptyPath(){return new Ar([])}}const cj=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ps extends Yu{construct(e,t,n){return new Ps(e,t,n)}static isValidIdentifier(e){return cj.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ps.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xA}static keyField(){return new Ps([xA])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(n.length===0)throw new Xt(Rt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let l=!1;for(;r<e.length;){const u=e[r];if(u==="\\"){if(r+1===e.length)throw new Xt(Rt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[r+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Xt(Rt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=h,r+=2}else u==="`"?(l=!l,r++):u!=="."||l?(n+=u,r++):(s(),r++)}if(s(),l)throw new Xt(Rt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ps(t)}static emptyPath(){return new Ps([])}}class en{constructor(e){this.path=e}static fromPath(e){return new en(Ar.fromString(e))}static fromName(e){return new en(Ar.fromString(e).popFirst(5))}static empty(){return new en(Ar.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ar.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ar.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new en(new Ar(e.slice()))}}function I3(i,e,t){if(!t)throw new Xt(Rt.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function hj(i,e,t,n){if(e===!0&&n===!0)throw new Xt(Rt.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function wA(i){if(!en.isDocumentKey(i))throw new Xt(Rt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function SA(i){if(en.isDocumentKey(i))throw new Xt(Rt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function k3(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function X1(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":xn(12329,{type:typeof i})}function ed(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new Xt(Rt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=X1(i);throw new Xt(Rt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function Ia(i,e){const t={typeString:i};return e&&(t.value=e),t}function Hm(i,e){if(!k3(i))throw new Xt(Rt.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const r=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in i)){t=`JSON missing required field: '${n}'`;break}const l=i[n];if(r&&typeof l!==r){t=`JSON field '${n}' must be a ${r}.`;break}if(s!==void 0&&l!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new Xt(Rt.INVALID_ARGUMENT,t);return!0}const TA=-62135596800,AA=1e6;class Ur{static now(){return Ur.fromMillis(Date.now())}static fromDate(e){return Ur.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*AA);return new Ur(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Xt(Rt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Xt(Rt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<TA)throw new Xt(Rt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xt(Rt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/AA}_compareTo(e){return this.seconds===e.seconds?hi(this.nanoseconds,e.nanoseconds):hi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ur._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Hm(e,Ur._jsonSchema))return new Ur(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-TA;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ur._jsonSchemaVersion="firestore/timestamp/1.0",Ur._jsonSchema={type:Ia("string",Ur._jsonSchemaVersion),seconds:Ia("number"),nanoseconds:Ia("number")};class Gn{static fromTimestamp(e){return new Gn(e)}static min(){return new Gn(new Ur(0,0))}static max(){return new Gn(new Ur(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const hm=-1;class e1{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function nx(i){return i.fields.find((e=>e.kind===2))}function kd(i){return i.fields.filter((e=>e.kind!==2))}e1.UNKNOWN_ID=-1;class x0{constructor(e,t){this.fieldPath=e,this.kind=t}}class dm{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new dm(0,Ul.min())}}function dj(i,e){const t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,r=Gn.fromTimestamp(n===1e9?new Ur(t+1,0):new Ur(t,n));return new Ul(r,en.empty(),e)}function C3(i){return new Ul(i.readTime,i.key,hm)}class Ul{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ul(Gn.min(),en.empty(),hm)}static max(){return new Ul(Gn.max(),en.empty(),hm)}}function R2(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=en.comparator(i.documentKey,e.documentKey),t!==0?t:hi(i.largestBatchId,e.largestBatchId))}const R3="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class D3{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function hf(i){if(i.code!==Rt.FAILED_PRECONDITION||i.message!==R3)throw i;zt("LocalStore","Unexpectedly lost primary lease")}class ut{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ut(((n,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof ut?t:ut.resolve(t)}catch(t){return ut.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):ut.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):ut.reject(t)}static resolve(e){return new ut(((t,n)=>{t(e)}))}static reject(e){return new ut(((t,n)=>{n(e)}))}static waitFor(e){return new ut(((t,n)=>{let r=0,s=0,l=!1;e.forEach((u=>{++r,u.next((()=>{++s,l&&s===r&&t()}),(h=>n(h)))})),l=!0,s===r&&t()}))}static or(e){let t=ut.resolve(!1);for(const n of e)t=t.next((r=>r?ut.resolve(r):n()));return t}static forEach(e,t){const n=[];return e.forEach(((r,s)=>{n.push(t.call(this,r,s))})),this.waitFor(n)}static mapArray(e,t){return new ut(((n,r)=>{const s=e.length,l=new Array(s);let u=0;for(let h=0;h<s;h++){const f=h;t(e[f]).next((x=>{l[f]=x,++u,u===s&&n(l)}),(x=>r(x)))}}))}static doWhile(e,t){return new ut(((n,r)=>{const s=()=>{e()===!0?t().next((()=>{s()}),r):n()};s()}))}}const Ml="SimpleDb";class J1{static open(e,t,n,r){try{return new J1(t,e.transaction(r,n))}catch(s){throw new Hg(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new nc,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Hg(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{const r=D2(n.target.error);this.S.reject(new Hg(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(zt(Ml,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new pj(t)}}class Kh{static delete(e){return zt(Ml,"Removing database:",e),Nd(TC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!LC())return!1;if(Kh.F())return!0;const e=za(),t=Kh.M(e),n=0<t&&t<10,r=L3(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,Kh.M(za())===12.2&&Qo("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(zt(Ml,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{const l=s.target.result;t(l)},r.onblocked=()=>{n(new Hg(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{const l=s.target.error;l.name==="VersionError"?n(new Xt(Rt.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):l.name==="InvalidStateError"?n(new Xt(Rt.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+l)):n(new Hg(e,l))},r.onupgradeneeded=s=>{zt(Ml,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const l=s.target.result;this.N.k(l,r.transaction,s.oldVersion,this.version).next((()=>{zt(Ml,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const s=t==="readonly";let l=0;for(;;){++l;try{this.db=await this.L(e);const u=J1.open(this.db,e,s?"readonly":"readwrite",n),h=r(u).next((f=>(u.C(),f))).catch((f=>(u.abort(f),ut.reject(f)))).toPromise();return h.catch((()=>{})),await u.D,h}catch(u){const h=u,f=h.name!=="FirebaseError"&&l<3;if(zt(Ml,"Transaction failed with error:",h.message,"Retrying:",f),this.close(),!f)return Promise.reject(h)}}}close(){this.db&&this.db.close(),this.db=void 0}}function L3(i){const e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class fj{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Nd(this.U.delete())}}class Hg extends Xt{constructor(e,t){super(Rt.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function fd(i){return i.name==="IndexedDbTransactionError"}class pj{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(zt(Ml,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(zt(Ml,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Nd(n)}add(e){return zt(Ml,"ADD",this.store.name,e,e),Nd(this.store.add(e))}get(e){return Nd(this.store.get(e)).next((t=>(t===void 0&&(t=null),zt(Ml,"GET",this.store.name,e,t),t)))}delete(e){return zt(Ml,"DELETE",this.store.name,e),Nd(this.store.delete(e))}count(){return zt(Ml,"COUNT",this.store.name),Nd(this.store.count())}J(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if(typeof r.getAll=="function"){const s=r.getAll(n.range);return new ut(((l,u)=>{s.onerror=h=>{u(h.target.error)},s.onsuccess=h=>{l(h.target.result)}}))}{const s=this.cursor(n),l=[];return this.H(s,((u,h)=>{l.push(h)})).next((()=>l))}}Y(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new ut(((r,s)=>{n.onerror=l=>{s(l.target.error)},n.onsuccess=l=>{r(l.target.result)}}))}Z(e,t){zt(Ml,"DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const r=this.cursor(n);return this.H(r,((s,l,u)=>u.delete()))}ee(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.H(r,t)}te(e){const t=this.cursor({});return new ut(((n,r)=>{t.onerror=s=>{const l=D2(s.target.error);r(l)},t.onsuccess=s=>{const l=s.target.result;l?e(l.primaryKey,l.value).next((u=>{u?l.continue():n()})):n()}}))}H(e,t){const n=[];return new ut(((r,s)=>{e.onerror=l=>{s(l.target.error)},e.onsuccess=l=>{const u=l.target.result;if(!u)return void r();const h=new fj(u),f=t(u.primaryKey,u.value,h);if(f instanceof ut){const x=f.catch((p=>(h.done(),ut.reject(p))));n.push(x)}h.isDone?r():h.G===null?u.continue():u.continue(h.G)}})).next((()=>ut.waitFor(n)))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Nd(i){return new ut(((e,t)=>{i.onsuccess=n=>{const r=n.target.result;e(r)},i.onerror=n=>{const r=D2(n.target.error);t(r)}}))}let EA=!1;function D2(i){const e=Kh.M(za());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){const n=new Xt("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return EA||(EA=!0,setTimeout((()=>{throw n}),0)),n}}return i}const Gg="IndexBackfiller";class gj{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){zt(Gg,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const t=await this.ne.ie();zt(Gg,`Documents written: ${t}`)}catch(t){fd(t)?zt(Gg,"Ignoring IndexedDB error during index backfill: ",t):await hf(t)}await this.re(6e4)}))}}class mj{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){const n=new Set;let r=t,s=!0;return ut.doWhile((()=>s===!0&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((l=>{if(l!==null&&!n.has(l))return zt(Gg,`Processing collection: ${l}`),this.oe(e,l,r).next((u=>{r-=u,n.add(l)}));s=!1})))).next((()=>t-r))}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((s=>{const l=s.changes;return this.localStore.indexManager.updateIndexEntries(e,l).next((()=>this._e(r,s))).next((u=>(zt(Gg,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u)))).next((()=>l.size))}))))}_e(e,t){let n=e;return t.changes.forEach(((r,s)=>{const l=C3(s);R2(l,n)>0&&(n=l)})),new Ul(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ru{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ru.ce=-1;const Bd=-1;function Q1(i){return i==null}function fm(i){return i===0&&1/i==-1/0}function yj(i){return typeof i=="number"&&Number.isInteger(i)&&!fm(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}const t1="";function Fo(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=IA(e)),e=vj(i.get(t),e);return IA(e)}function vj(i,e){let t=e;const n=i.length;for(let r=0;r<n;r++){const s=i.charAt(r);switch(s){case"\0":t+="";break;case t1:t+="";break;default:t+=s}}return t}function IA(i){return i+t1+""}function Xu(i){const e=i.length;if(jn(e>=2,64408,{path:i}),e===2)return jn(i.charAt(0)===t1&&i.charAt(1)==="",56145,{path:i}),Ar.emptyPath();const t=e-2,n=[];let r="";for(let s=0;s<e;){const l=i.indexOf(t1,s);switch((l<0||l>t)&&xn(50515,{path:i}),i.charAt(l+1)){case"":const u=i.substring(s,l);let h;r.length===0?h=u:(r+=u,h=r,r=""),n.push(h);break;case"":r+=i.substring(s,l),r+="\0";break;case"":r+=i.substring(s,l+1);break;default:xn(61167,{path:i})}s=l+2}return new Ar(n)}const Cd="remoteDocuments",Gm="owner",Nf="owner",pm="mutationQueues",_j="userId",Iu="mutations",kA="batchId",zd="userMutationsIndex",CA=["userId","batchId"];function w0(i,e){return[i,Fo(e)]}function N3(i,e,t){return[i,Fo(e),t]}const bj={},mp="documentMutations",n1="remoteDocumentsV14",xj=["prefixPath","collectionGroup","readTime","documentId"],S0="documentKeyIndex",wj=["prefixPath","collectionGroup","documentId"],P3="collectionGroupIndex",Sj=["collectionGroup","readTime","prefixPath","documentId"],gm="remoteDocumentGlobal",ix="remoteDocumentGlobalKey",yp="targets",O3="queryTargetsIndex",Tj=["canonicalId","targetId"],vp="targetDocuments",Aj=["targetId","path"],L2="documentTargetsIndex",Ej=["path","targetId"],i1="targetGlobalKey",$d="targetGlobal",mm="collectionParents",Ij=["collectionId","parent"],_p="clientMetadata",kj="clientId",Z1="bundles",Cj="bundleId",ev="namedQueries",Rj="name",N2="indexConfiguration",Dj="indexId",rx="collectionGroupIndex",Lj="collectionGroup",Kg="indexState",Nj=["indexId","uid"],M3="sequenceNumberIndex",Pj=["uid","sequenceNumber"],Wg="indexEntries",Oj=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],F3="documentKeyIndex",Mj=["indexId","uid","orderedDocumentKey"],tv="documentOverlays",Fj=["userId","collectionPath","documentId"],sx="collectionPathOverlayIndex",jj=["userId","collectionPath","largestBatchId"],j3="collectionGroupOverlayIndex",Vj=["userId","collectionGroup","largestBatchId"],P2="globals",zj="name",V3=[pm,Iu,mp,Cd,yp,Gm,$d,vp,_p,gm,mm,Z1,ev],Uj=[...V3,tv],z3=[pm,Iu,mp,n1,yp,Gm,$d,vp,_p,gm,mm,Z1,ev,tv],U3=z3,O2=[...U3,N2,Kg,Wg],Bj=O2,B3=[...O2,P2],$j=B3;class ax extends D3{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Ua(i,e){const t=di(i);return Kh.O(t.le,e)}function RA(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function df(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function $3(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}let ma=class ox{constructor(e,t){this.comparator=e,this.root=t||Wh.EMPTY}insert(e,t){return new ox(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wh.BLACK,null,null))}remove(e){return new ox(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gy(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gy(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gy(this.root,e,this.comparator,!0)}},Gy=class{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Wh=class Fc{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??Fc.RED,this.left=r??Fc.EMPTY,this.right=s??Fc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Fc(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Fc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Fc.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw xn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw xn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw xn(27949);return e+(this.isRed()?0:1)}};Wh.EMPTY=null,Wh.RED=!0,Wh.BLACK=!1;Wh.EMPTY=new class{constructor(){this.size=0}get key(){throw xn(57766)}get value(){throw xn(16141)}get color(){throw xn(16727)}get left(){throw xn(29726)}get right(){throw xn(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new Wh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class $r{constructor(e){this.comparator=e,this.data=new ma(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new DA(this.data.getIterator())}getIteratorFrom(e){return new DA(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof $r)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new $r(this.comparator);return t.data=e,t}}class DA{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Pf(i){return i.hasNext()?i.getNext():void 0}class su{constructor(e){this.fields=e,e.sort(Ps.comparator)}static empty(){return new su([])}unionWith(e){let t=new $r(Ps.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new su(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gp(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}class H3 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ca{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new H3("Invalid base64 string: "+s):s}})(e);return new Ca(t)}static fromUint8Array(e){const t=(function(r){let s="";for(let l=0;l<r.length;++l)s+=String.fromCharCode(r[l]);return s})(e);return new Ca(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return hi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ca.EMPTY_BYTE_STRING=new Ca("");const Hj=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qc(i){if(jn(!!i,39018),typeof i=="string"){let e=0;const t=Hj.exec(i);if(jn(!!t,46558,{timestamp:i}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Es(i.seconds),nanos:Es(i.nanos)}}function Es(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Zc(i){return typeof i=="string"?Ca.fromBase64String(i):Ca.fromUint8Array(i)}const G3="server_timestamp",K3="__type__",W3="__previous_value__",q3="__local_write_time__";function M2(i){return(i?.mapValue?.fields||{})[K3]?.stringValue===G3}function nv(i){const e=i.mapValue.fields[W3];return M2(e)?nv(e):e}function ym(i){const e=Qc(i.mapValue.fields[q3].timestampValue);return new Ur(e.seconds,e.nanos)}class Gj{constructor(e,t,n,r,s,l,u,h,f,x){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=x}}const r1="(default)";class Jd{constructor(e,t){this.projectId=e,this.database=t||r1}static empty(){return new Jd("","")}get isDefaultDatabase(){return this.database===r1}isEqual(e){return e instanceof Jd&&e.projectId===this.projectId&&e.database===this.database}}const F2="__type__",Y3="__max__",Vh={mapValue:{fields:{__type__:{stringValue:Y3}}}},j2="__vector__",bp="value",T0={nullValue:"NULL_VALUE"};function td(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?M2(i)?4:X3(i)?9007199254740991:iv(i)?10:11:xn(28295,{value:i})}function sc(i,e){if(i===e)return!0;const t=td(i);if(t!==td(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return ym(i).isEqual(ym(e));case 3:return(function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const l=Qc(r.timestampValue),u=Qc(s.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos})(i,e);case 5:return i.stringValue===e.stringValue;case 6:return(function(r,s){return Zc(r.bytesValue).isEqual(Zc(s.bytesValue))})(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return(function(r,s){return Es(r.geoPointValue.latitude)===Es(s.geoPointValue.latitude)&&Es(r.geoPointValue.longitude)===Es(s.geoPointValue.longitude)})(i,e);case 2:return(function(r,s){if("integerValue"in r&&"integerValue"in s)return Es(r.integerValue)===Es(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const l=Es(r.doubleValue),u=Es(s.doubleValue);return l===u?fm(l)===fm(u):isNaN(l)&&isNaN(u)}return!1})(i,e);case 9:return gp(i.arrayValue.values||[],e.arrayValue.values||[],sc);case 10:case 11:return(function(r,s){const l=r.mapValue.fields||{},u=s.mapValue.fields||{};if(RA(l)!==RA(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!sc(l[h],u[h])))return!1;return!0})(i,e);default:return xn(52216,{left:i})}}function vm(i,e){return(i.values||[]).find((t=>sc(t,e)))!==void 0}function nd(i,e){if(i===e)return 0;const t=td(i),n=td(e);if(t!==n)return hi(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return hi(i.booleanValue,e.booleanValue);case 2:return(function(s,l){const u=Es(s.integerValue||s.doubleValue),h=Es(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(i,e);case 3:return LA(i.timestampValue,e.timestampValue);case 4:return LA(ym(i),ym(e));case 5:return tx(i.stringValue,e.stringValue);case 6:return(function(s,l){const u=Zc(s),h=Zc(l);return u.compareTo(h)})(i.bytesValue,e.bytesValue);case 7:return(function(s,l){const u=s.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const x=hi(u[f],h[f]);if(x!==0)return x}return hi(u.length,h.length)})(i.referenceValue,e.referenceValue);case 8:return(function(s,l){const u=hi(Es(s.latitude),Es(l.latitude));return u!==0?u:hi(Es(s.longitude),Es(l.longitude))})(i.geoPointValue,e.geoPointValue);case 9:return NA(i.arrayValue,e.arrayValue);case 10:return(function(s,l){const u=s.fields||{},h=l.fields||{},f=u[bp]?.arrayValue,x=h[bp]?.arrayValue,p=hi(f?.values?.length||0,x?.values?.length||0);return p!==0?p:NA(f,x)})(i.mapValue,e.mapValue);case 11:return(function(s,l){if(s===Vh.mapValue&&l===Vh.mapValue)return 0;if(s===Vh.mapValue)return 1;if(l===Vh.mapValue)return-1;const u=s.fields||{},h=Object.keys(u),f=l.fields||{},x=Object.keys(f);h.sort(),x.sort();for(let p=0;p<h.length&&p<x.length;++p){const w=tx(h[p],x[p]);if(w!==0)return w;const A=nd(u[h[p]],f[x[p]]);if(A!==0)return A}return hi(h.length,x.length)})(i.mapValue,e.mapValue);default:throw xn(23264,{he:t})}}function LA(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return hi(i,e);const t=Qc(i),n=Qc(e),r=hi(t.seconds,n.seconds);return r!==0?r:hi(t.nanos,n.nanos)}function NA(i,e){const t=i.values||[],n=e.values||[];for(let r=0;r<t.length&&r<n.length;++r){const s=nd(t[r],n[r]);if(s)return s}return hi(t.length,n.length)}function xp(i){return lx(i)}function lx(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(t){const n=Qc(t);return`time(${n.seconds},${n.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(t){return Zc(t).toBase64()})(i.bytesValue):"referenceValue"in i?(function(t){return en.fromName(t).toString()})(i.referenceValue):"geoPointValue"in i?(function(t){return`geo(${t.latitude},${t.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(t){let n="[",r=!0;for(const s of t.values||[])r?r=!1:n+=",",n+=lx(s);return n+"]"})(i.arrayValue):"mapValue"in i?(function(t){const n=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const l of n)s?s=!1:r+=",",r+=`${l}:${lx(t.fields[l])}`;return r+"}"})(i.mapValue):xn(61005,{value:i})}function A0(i){switch(td(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=nv(i);return e?16+A0(e):16;case 5:return 2*i.stringValue.length;case 6:return Zc(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((r,s)=>r+A0(s)),0)})(i.arrayValue);case 10:case 11:return(function(n){let r=0;return df(n.fields,((s,l)=>{r+=s.length+A0(l)})),r})(i.mapValue);default:throw xn(13486,{value:i})}}function _m(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function ux(i){return!!i&&"integerValue"in i}function bm(i){return!!i&&"arrayValue"in i}function PA(i){return!!i&&"nullValue"in i}function OA(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function E0(i){return!!i&&"mapValue"in i}function iv(i){return(i?.mapValue?.fields||{})[F2]?.stringValue===j2}function qg(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const e={mapValue:{fields:{}}};return df(i.mapValue.fields,((t,n)=>e.mapValue.fields[t]=qg(n))),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qg(i.arrayValue.values[t]);return e}return{...i}}function X3(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===Y3}const J3={mapValue:{fields:{[F2]:{stringValue:j2},[bp]:{arrayValue:{}}}}};function Kj(i){return"nullValue"in i?T0:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?_m(Jd.empty(),en.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?iv(i)?J3:{mapValue:{}}:xn(35942,{value:i})}function Wj(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?_m(Jd.empty(),en.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?J3:"mapValue"in i?iv(i)?{mapValue:{}}:Vh:xn(61959,{value:i})}function MA(i,e){const t=nd(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function FA(i,e){const t=nd(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}class gl{constructor(e){this.value=e}static empty(){return new gl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!E0(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qg(t)}setAll(e){let t=Ps.emptyPath(),n={},r=[];e.forEach(((l,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,n,r),n={},r=[],t=u.popLast()}l?n[u.lastSegment()]=qg(l):r.push(u.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());E0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];E0(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){df(t,((r,s)=>e[r]=s));for(const r of n)delete e[r]}clone(){return new gl(qg(this.value))}}function Q3(i){const e=[];return df(i.fields,((t,n)=>{const r=new Ps([t]);if(E0(n)){const s=Q3(n.mapValue).fields;if(s.length===0)e.push(r);else for(const l of s)e.push(r.child(l))}else e.push(r)})),new su(e)}class ea{constructor(e,t,n,r,s,l,u){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=l,this.documentState=u}static newInvalidDocument(e){return new ea(e,0,Gn.min(),Gn.min(),Gn.min(),gl.empty(),0)}static newFoundDocument(e,t,n,r){return new ea(e,1,t,Gn.min(),n,r,0)}static newNoDocument(e,t){return new ea(e,2,t,Gn.min(),Gn.min(),gl.empty(),0)}static newUnknownDocument(e,t){return new ea(e,3,t,Gn.min(),Gn.min(),gl.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ea&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ea(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class wp{constructor(e,t){this.position=e,this.inclusive=t}}function jA(i,e,t){let n=0;for(let r=0;r<i.position.length;r++){const s=e[r],l=i.position[r];if(s.field.isKeyField()?n=en.comparator(en.fromName(l.referenceValue),t.key):n=nd(l,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function VA(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!sc(i.position[t],e.position[t]))return!1;return!0}class s1{constructor(e,t="asc"){this.field=e,this.dir=t}}function qj(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}class Z3{}class tr extends Z3{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Yj(e,t,n):t==="array-contains"?new Qj(e,n):t==="in"?new sR(e,n):t==="not-in"?new Zj(e,n):t==="array-contains-any"?new e7(e,n):new tr(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Xj(e,n):new Jj(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(nd(t,this.value)):t!==null&&td(this.value)===td(t)&&this.matchesComparison(nd(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Br extends Z3{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Br(e,t)}matches(e){return Sp(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Sp(i){return i.op==="and"}function cx(i){return i.op==="or"}function V2(i){return eR(i)&&Sp(i)}function eR(i){for(const e of i.filters)if(e instanceof Br)return!1;return!0}function hx(i){if(i instanceof tr)return i.field.canonicalString()+i.op.toString()+xp(i.value);if(V2(i))return i.filters.map((e=>hx(e))).join(",");{const e=i.filters.map((t=>hx(t))).join(",");return`${i.op}(${e})`}}function tR(i,e){return i instanceof tr?(function(n,r){return r instanceof tr&&n.op===r.op&&n.field.isEqual(r.field)&&sc(n.value,r.value)})(i,e):i instanceof Br?(function(n,r){return r instanceof Br&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce(((s,l,u)=>s&&tR(l,r.filters[u])),!0):!1})(i,e):void xn(19439)}function nR(i,e){const t=i.filters.concat(e);return Br.create(t,i.op)}function iR(i){return i instanceof tr?(function(t){return`${t.field.canonicalString()} ${t.op} ${xp(t.value)}`})(i):i instanceof Br?(function(t){return t.op.toString()+" {"+t.getFilters().map(iR).join(" ,")+"}"})(i):"Filter"}class Yj extends tr{constructor(e,t,n){super(e,t,n),this.key=en.fromName(n.referenceValue)}matches(e){const t=en.comparator(e.key,this.key);return this.matchesComparison(t)}}class Xj extends tr{constructor(e,t){super(e,"in",t),this.keys=rR("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Jj extends tr{constructor(e,t){super(e,"not-in",t),this.keys=rR("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function rR(i,e){return(e.arrayValue?.values||[]).map((t=>en.fromName(t.referenceValue)))}class Qj extends tr{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bm(t)&&vm(t.arrayValue,this.value)}}class sR extends tr{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&vm(this.value.arrayValue,t)}}class Zj extends tr{constructor(e,t){super(e,"not-in",t)}matches(e){if(vm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!vm(this.value.arrayValue,t)}}class e7 extends tr{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bm(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>vm(this.value.arrayValue,n)))}}class t7{constructor(e,t=null,n=[],r=[],s=null,l=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=l,this.endAt=u,this.Te=null}}function dx(i,e=null,t=[],n=[],r=null,s=null,l=null){return new t7(i,e,t,n,r,s,l)}function Qd(i){const e=di(i);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>hx(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(s){return s.field.canonicalString()+s.dir})(n))).join(","),Q1(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>xp(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>xp(n))).join(",")),e.Te=t}return e.Te}function Km(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!qj(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!tR(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!VA(i.startAt,e.startAt)&&VA(i.endAt,e.endAt)}function a1(i){return en.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function o1(i,e){return i.filters.filter((t=>t instanceof tr&&t.field.isEqual(e)))}function zA(i,e,t){let n=T0,r=!0;for(const s of o1(i,e)){let l=T0,u=!0;switch(s.op){case"<":case"<=":l=Kj(s.value);break;case"==":case"in":case">=":l=s.value;break;case">":l=s.value,u=!1;break;case"!=":case"not-in":l=T0}MA({value:n,inclusive:r},{value:l,inclusive:u})<0&&(n=l,r=u)}if(t!==null){for(let s=0;s<i.orderBy.length;++s)if(i.orderBy[s].field.isEqual(e)){const l=t.position[s];MA({value:n,inclusive:r},{value:l,inclusive:t.inclusive})<0&&(n=l,r=t.inclusive);break}}return{value:n,inclusive:r}}function UA(i,e,t){let n=Vh,r=!0;for(const s of o1(i,e)){let l=Vh,u=!0;switch(s.op){case">=":case">":l=Wj(s.value),u=!1;break;case"==":case"in":case"<=":l=s.value;break;case"<":l=s.value,u=!1;break;case"!=":case"not-in":l=Vh}FA({value:n,inclusive:r},{value:l,inclusive:u})>0&&(n=l,r=u)}if(t!==null){for(let s=0;s<i.orderBy.length;++s)if(i.orderBy[s].field.isEqual(e)){const l=t.position[s];FA({value:n,inclusive:r},{value:l,inclusive:t.inclusive})>0&&(n=l,r=t.inclusive);break}}return{value:n,inclusive:r}}class Wm{constructor(e,t=null,n=[],r=[],s=null,l="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function n7(i,e,t,n,r,s,l,u){return new Wm(i,e,t,n,r,s,l,u)}function rv(i){return new Wm(i)}function BA(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function aR(i){return i.collectionGroup!==null}function Yg(i){const e=di(i);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new $r(Ps.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new s1(s,n))})),t.has(Ps.keyField().canonicalString())||e.Ie.push(new s1(Ps.keyField(),n))}return e.Ie}function lu(i){const e=di(i);return e.Ee||(e.Ee=i7(e,Yg(i))),e.Ee}function i7(i,e){if(i.limitType==="F")return dx(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map((r=>{const s=r.dir==="desc"?"asc":"desc";return new s1(r.field,s)}));const t=i.endAt?new wp(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new wp(i.startAt.position,i.startAt.inclusive):null;return dx(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function fx(i,e){const t=i.filters.concat([e]);return new Wm(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function px(i,e,t){return new Wm(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function sv(i,e){return Km(lu(i),lu(e))&&i.limitType===e.limitType}function oR(i){return`${Qd(lu(i))}|lt:${i.limitType}`}function Hf(i){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((r=>iR(r))).join(", ")}]`),Q1(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((r=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(r))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((r=>xp(r))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((r=>xp(r))).join(",")),`Target(${n})`})(lu(i))}; limitType=${i.limitType})`}function qm(i,e){return e.isFoundDocument()&&(function(n,r){const s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):en.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)})(i,e)&&(function(n,r){for(const s of Yg(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0})(i,e)&&(function(n,r){for(const s of n.filters)if(!s.matches(r))return!1;return!0})(i,e)&&(function(n,r){return!(n.startAt&&!(function(l,u,h){const f=jA(l,u,h);return l.inclusive?f<=0:f<0})(n.startAt,Yg(n),r)||n.endAt&&!(function(l,u,h){const f=jA(l,u,h);return l.inclusive?f>=0:f>0})(n.endAt,Yg(n),r))})(i,e)}function r7(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function lR(i){return(e,t)=>{let n=!1;for(const r of Yg(i)){const s=s7(r,e,t);if(s!==0)return s;n=n||r.field.isKeyField()}return 0}}function s7(i,e,t){const n=i.field.isKeyField()?en.comparator(e.key,t.key):(function(s,l,u){const h=l.data.field(s),f=u.data.field(s);return h!==null&&f!==null?nd(h,f):xn(42886)})(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return xn(19790,{direction:i.dir})}}class ih{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[r,s]of n)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){df(this.inner,((t,n)=>{for(const[r,s]of n)e(r,s)}))}isEmpty(){return $3(this.inner)}size(){return this.innerSize}}const a7=new ma(en.comparator);function Fl(){return a7}const uR=new ma(en.comparator);function Fg(...i){let e=uR;for(const t of i)e=e.insert(t.key,t);return e}function cR(i){let e=uR;return i.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Ju(){return Xg()}function hR(){return Xg()}function Xg(){return new ih((i=>i.toString()),((i,e)=>i.isEqual(e)))}const o7=new ma(en.comparator),l7=new $r(en.comparator);function Ni(...i){let e=l7;for(const t of i)e=e.add(t);return e}const u7=new $r(hi);function c7(){return u7}function z2(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fm(e)?"-0":e}}function dR(i){return{integerValue:""+i}}function h7(i,e){return yj(e)?dR(e):z2(i,e)}class av{constructor(){this._=void 0}}function d7(i,e,t){return i instanceof xm?(function(r,s){const l={fields:{[K3]:{stringValue:G3},[q3]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&M2(s)&&(s=nv(s)),s&&(l.fields[W3]=s),{mapValue:l}})(t,e):i instanceof Tp?pR(i,e):i instanceof Ap?gR(i,e):(function(r,s){const l=fR(r,s),u=$A(l)+$A(r.Ae);return ux(l)&&ux(r.Ae)?dR(u):z2(r.serializer,u)})(i,e)}function f7(i,e,t){return i instanceof Tp?pR(i,e):i instanceof Ap?gR(i,e):t}function fR(i,e){return i instanceof wm?(function(n){return ux(n)||(function(s){return!!s&&"doubleValue"in s})(n)})(e)?e:{integerValue:0}:null}class xm extends av{}class Tp extends av{constructor(e){super(),this.elements=e}}function pR(i,e){const t=mR(e);for(const n of i.elements)t.some((r=>sc(r,n)))||t.push(n);return{arrayValue:{values:t}}}class Ap extends av{constructor(e){super(),this.elements=e}}function gR(i,e){let t=mR(e);for(const n of i.elements)t=t.filter((r=>!sc(r,n)));return{arrayValue:{values:t}}}class wm extends av{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function $A(i){return Es(i.integerValue||i.doubleValue)}function mR(i){return bm(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}class p7{constructor(e,t){this.field=e,this.transform=t}}function g7(i,e){return i.field.isEqual(e.field)&&(function(n,r){return n instanceof Tp&&r instanceof Tp||n instanceof Ap&&r instanceof Ap?gp(n.elements,r.elements,sc):n instanceof wm&&r instanceof wm?sc(n.Ae,r.Ae):n instanceof xm&&r instanceof xm})(i.transform,e.transform)}class m7{constructor(e,t){this.version=e,this.transformResults=t}}class jl{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new jl}static exists(e){return new jl(void 0,e)}static updateTime(e){return new jl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function I0(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class ov{}function yR(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new U2(i.key,jl.none()):new Up(i.key,i.data,jl.none());{const t=i.data,n=gl.empty();let r=new $r(Ps.comparator);for(let s of e.fields)if(!r.has(s)){let l=t.field(s);l===null&&s.length>1&&(s=s.popLast(),l=t.field(s)),l===null?n.delete(s):n.set(s,l),r=r.add(s)}return new pd(i.key,n,new su(r.toArray()),jl.none())}}function y7(i,e,t){i instanceof Up?(function(r,s,l){const u=r.value.clone(),h=GA(r.fieldTransforms,s,l.transformResults);u.setAll(h),s.convertToFoundDocument(l.version,u).setHasCommittedMutations()})(i,e,t):i instanceof pd?(function(r,s,l){if(!I0(r.precondition,s))return void s.convertToUnknownDocument(l.version);const u=GA(r.fieldTransforms,s,l.transformResults),h=s.data;h.setAll(vR(r)),h.setAll(u),s.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(i,e,t):(function(r,s,l){s.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,t)}function Jg(i,e,t,n){return i instanceof Up?(function(s,l,u,h){if(!I0(s.precondition,l))return u;const f=s.value.clone(),x=KA(s.fieldTransforms,h,l);return f.setAll(x),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(i,e,t,n):i instanceof pd?(function(s,l,u,h){if(!I0(s.precondition,l))return u;const f=KA(s.fieldTransforms,h,l),x=l.data;return x.setAll(vR(s)),x.setAll(f),l.convertToFoundDocument(l.version,x).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((p=>p.field)))})(i,e,t,n):(function(s,l,u){return I0(s.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u})(i,e,t)}function v7(i,e){let t=null;for(const n of i.fieldTransforms){const r=e.data.field(n.field),s=fR(n.transform,r||null);s!=null&&(t===null&&(t=gl.empty()),t.set(n.field,s))}return t||null}function HA(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!(function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&gp(n,r,((s,l)=>g7(s,l)))})(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class Up extends ov{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class pd extends ov{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function vR(i){const e=new Map;return i.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=i.data.field(t);e.set(t,n)}})),e}function GA(i,e,t){const n=new Map;jn(i.length===t.length,32656,{Re:t.length,Ve:i.length});for(let r=0;r<t.length;r++){const s=i[r],l=s.transform,u=e.data.field(s.field);n.set(s.field,f7(l,u,t[r]))}return n}function KA(i,e,t){const n=new Map;for(const r of i){const s=r.transform,l=t.data.field(r.field);n.set(r.field,d7(s,l,e))}return n}class U2 extends ov{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _R extends ov{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class B2{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&y7(s,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Jg(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Jg(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=hR();return this.mutations.forEach((r=>{const s=e.get(r.key),l=s.overlayedDocument;let u=this.applyToLocalView(l,s.mutatedFields);u=t.has(r.key)?null:u;const h=yR(l,u);h!==null&&n.set(r.key,h),l.isValidDocument()||l.convertToNoDocument(Gn.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ni())}isEqual(e){return this.batchId===e.batchId&&gp(this.mutations,e.mutations,((t,n)=>HA(t,n)))&&gp(this.baseMutations,e.baseMutations,((t,n)=>HA(t,n)))}}class $2{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){jn(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=(function(){return o7})();const s=e.mutations;for(let l=0;l<s.length;l++)r=r.insert(s[l].key,n[l].version);return new $2(e,t,n,r)}}class H2{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class _7{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ea,ar;function b7(i){switch(i){case Rt.OK:return xn(64938);case Rt.CANCELLED:case Rt.UNKNOWN:case Rt.DEADLINE_EXCEEDED:case Rt.RESOURCE_EXHAUSTED:case Rt.INTERNAL:case Rt.UNAVAILABLE:case Rt.UNAUTHENTICATED:return!1;case Rt.INVALID_ARGUMENT:case Rt.NOT_FOUND:case Rt.ALREADY_EXISTS:case Rt.PERMISSION_DENIED:case Rt.FAILED_PRECONDITION:case Rt.ABORTED:case Rt.OUT_OF_RANGE:case Rt.UNIMPLEMENTED:case Rt.DATA_LOSS:return!0;default:return xn(15467,{code:i})}}function bR(i){if(i===void 0)return Qo("GRPC error has no .code"),Rt.UNKNOWN;switch(i){case Ea.OK:return Rt.OK;case Ea.CANCELLED:return Rt.CANCELLED;case Ea.UNKNOWN:return Rt.UNKNOWN;case Ea.DEADLINE_EXCEEDED:return Rt.DEADLINE_EXCEEDED;case Ea.RESOURCE_EXHAUSTED:return Rt.RESOURCE_EXHAUSTED;case Ea.INTERNAL:return Rt.INTERNAL;case Ea.UNAVAILABLE:return Rt.UNAVAILABLE;case Ea.UNAUTHENTICATED:return Rt.UNAUTHENTICATED;case Ea.INVALID_ARGUMENT:return Rt.INVALID_ARGUMENT;case Ea.NOT_FOUND:return Rt.NOT_FOUND;case Ea.ALREADY_EXISTS:return Rt.ALREADY_EXISTS;case Ea.PERMISSION_DENIED:return Rt.PERMISSION_DENIED;case Ea.FAILED_PRECONDITION:return Rt.FAILED_PRECONDITION;case Ea.ABORTED:return Rt.ABORTED;case Ea.OUT_OF_RANGE:return Rt.OUT_OF_RANGE;case Ea.UNIMPLEMENTED:return Rt.UNIMPLEMENTED;case Ea.DATA_LOSS:return Rt.DATA_LOSS;default:return xn(39323,{code:i})}}(ar=Ea||(Ea={}))[ar.OK=0]="OK",ar[ar.CANCELLED=1]="CANCELLED",ar[ar.UNKNOWN=2]="UNKNOWN",ar[ar.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ar[ar.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ar[ar.NOT_FOUND=5]="NOT_FOUND",ar[ar.ALREADY_EXISTS=6]="ALREADY_EXISTS",ar[ar.PERMISSION_DENIED=7]="PERMISSION_DENIED",ar[ar.UNAUTHENTICATED=16]="UNAUTHENTICATED",ar[ar.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ar[ar.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ar[ar.ABORTED=10]="ABORTED",ar[ar.OUT_OF_RANGE=11]="OUT_OF_RANGE",ar[ar.UNIMPLEMENTED=12]="UNIMPLEMENTED",ar[ar.INTERNAL=13]="INTERNAL",ar[ar.UNAVAILABLE=14]="UNAVAILABLE",ar[ar.DATA_LOSS=15]="DATA_LOSS";function x7(){return new TextEncoder}const w7=new Gh([4294967295,4294967295],0);function WA(i){const e=x7().encode(i),t=new v3;return t.update(e),new Uint8Array(t.digest())}function qA(i){const e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Gh([t,n],0),new Gh([r,s],0)]}class G2{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new jg(`Invalid padding: ${t}`);if(n<0)throw new jg(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new jg(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new jg(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Gh.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Gh.fromNumber(n)));return r.compare(w7)===1&&(r=new Gh([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=WA(e),[n,r]=qA(t);for(let s=0;s<this.hashCount;s++){const l=this.ye(n,r,s);if(!this.we(l))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),l=new G2(s,r,t);return n.forEach((u=>l.insert(u))),l}insert(e){if(this.ge===0)return;const t=WA(e),[n,r]=qA(t);for(let s=0;s<this.hashCount;s++){const l=this.ye(n,r,s);this.Se(l)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class jg extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lv{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Ym.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new lv(Gn.min(),r,new ma(hi),Fl(),Ni())}}class Ym{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ym(n,t,Ni(),Ni(),Ni())}}class k0{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class xR{constructor(e,t){this.targetId=e,this.Ce=t}}class wR{constructor(e,t,n=Ca.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class YA{constructor(){this.ve=0,this.Fe=XA(),this.Me=Ca.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ni(),t=Ni(),n=Ni();return this.Fe.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:xn(38017,{changeType:s})}})),new Ym(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=XA()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,jn(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class S7{constructor(e){this.Ge=e,this.ze=new Map,this.je=Fl(),this.Je=Ky(),this.He=Ky(),this.Ye=new ma(hi)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:xn(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(a1(s))if(n===0){const l=new en(s.path);this.et(t,l,ea.newNoDocument(l,Gn.min()))}else jn(n===1,20013,{expectedCount:n});else{const l=this._t(t);if(l!==n){const u=this.ut(e),h=u?this.ct(u,e,l):1;if(h!==0){this.it(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let l,u;try{l=Zc(n).toUint8Array()}catch(h){if(h instanceof H3)return Xd("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new G2(l,r,s)}catch(h){return Xd(h instanceof jg?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach((s=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.et(t,s,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((s,l)=>{const u=this.ot(l);if(u){if(s.current&&a1(u.target)){const h=new en(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,ea.newNoDocument(h,e))}s.Be&&(t.set(l,s.ke()),s.qe())}}));let n=Ni();this.He.forEach(((s,l)=>{let u=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(n=n.add(s))})),this.je.forEach(((s,l)=>l.setReadTime(e)));const r=new lv(e,t,this.Ye,this.je,n);return this.je=Fl(),this.Je=Ky(),this.He=Ky(),this.Ye=new ma(hi),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new YA,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new $r(hi),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new $r(hi),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||zt("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new YA),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ky(){return new ma(en.comparator)}function XA(){return new ma(en.comparator)}const T7={asc:"ASCENDING",desc:"DESCENDING"},A7={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},E7={and:"AND",or:"OR"};class I7{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function gx(i,e){return i.useProto3Json||Q1(e)?e:{value:e}}function Ep(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SR(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function k7(i,e){return Ep(i,e.toTimestamp())}function el(i){return jn(!!i,49232),Gn.fromTimestamp((function(t){const n=Qc(t);return new Ur(n.seconds,n.nanos)})(i))}function K2(i,e){return mx(i,e).canonicalString()}function mx(i,e){const t=(function(r){return new Ar(["projects",r.projectId,"databases",r.database])})(i).child("documents");return e===void 0?t:t.child(e)}function TR(i){const e=Ar.fromString(i);return jn(NR(e),10190,{key:e.toString()}),e}function l1(i,e){return K2(i.databaseId,e.path)}function Hd(i,e){const t=TR(e);if(t.get(1)!==i.databaseId.projectId)throw new Xt(Rt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new Xt(Rt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new en(IR(t))}function AR(i,e){return K2(i.databaseId,e)}function ER(i){const e=TR(i);return e.length===4?Ar.emptyPath():IR(e)}function yx(i){return new Ar(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function IR(i){return jn(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function JA(i,e,t){return{name:l1(i,e),fields:t.value.mapValue.fields}}function C7(i,e,t){const n=Hd(i,e.name),r=el(e.updateTime),s=e.createTime?el(e.createTime):Gn.min(),l=new gl({mapValue:{fields:e.fields}}),u=ea.newFoundDocument(n,r,s,l);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function R7(i,e){let t;if("targetChange"in e){e.targetChange;const n=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:xn(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=(function(f,x){return f.useProto3Json?(jn(x===void 0||typeof x=="string",58123),Ca.fromBase64String(x||"")):(jn(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),Ca.fromUint8Array(x||new Uint8Array))})(i,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&(function(f){const x=f.code===void 0?Rt.UNKNOWN:bR(f.code);return new Xt(x,f.message||"")})(l);t=new wR(n,r,s,u||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=Hd(i,n.document.name),s=el(n.document.updateTime),l=n.document.createTime?el(n.document.createTime):Gn.min(),u=new gl({mapValue:{fields:n.document.fields}}),h=ea.newFoundDocument(r,s,l,u),f=n.targetIds||[],x=n.removedTargetIds||[];t=new k0(f,x,h.key,h)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=Hd(i,n.document),s=n.readTime?el(n.readTime):Gn.min(),l=ea.newNoDocument(r,s),u=n.removedTargetIds||[];t=new k0([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=Hd(i,n.document),s=n.removedTargetIds||[];t=new k0([],s,r,null)}else{if(!("filter"in e))return xn(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:s}=n,l=new _7(r,s),u=n.targetId;t=new xR(u,l)}}return t}function u1(i,e){let t;if(e instanceof Up)t={update:JA(i,e.key,e.value)};else if(e instanceof U2)t={delete:l1(i,e.key)};else if(e instanceof pd)t={update:JA(i,e.key,e.data),updateMask:M7(e.fieldMask)};else{if(!(e instanceof _R))return xn(16599,{Vt:e.type});t={verify:l1(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(s,l){const u=l.transform;if(u instanceof xm)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Tp)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ap)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof wm)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw xn(20930,{transform:l.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(r,s){return s.updateTime!==void 0?{updateTime:k7(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:xn(27497)})(i,e.precondition)),t}function vx(i,e){const t=e.currentDocument?(function(s){return s.updateTime!==void 0?jl.updateTime(el(s.updateTime)):s.exists!==void 0?jl.exists(s.exists):jl.none()})(e.currentDocument):jl.none(),n=e.updateTransforms?e.updateTransforms.map((r=>(function(l,u){let h=null;if("setToServerValue"in u)jn(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),h=new xm;else if("appendMissingElements"in u){const x=u.appendMissingElements.values||[];h=new Tp(x)}else if("removeAllFromArray"in u){const x=u.removeAllFromArray.values||[];h=new Ap(x)}else"increment"in u?h=new wm(l,u.increment):xn(16584,{proto:u});const f=Ps.fromServerFormat(u.fieldPath);return new p7(f,h)})(i,r))):[];if(e.update){e.update.name;const r=Hd(i,e.update.name),s=new gl({mapValue:{fields:e.update.fields}});if(e.updateMask){const l=(function(h){const f=h.fieldPaths||[];return new su(f.map((x=>Ps.fromServerFormat(x))))})(e.updateMask);return new pd(r,s,l,t,n)}return new Up(r,s,t,n)}if(e.delete){const r=Hd(i,e.delete);return new U2(r,t)}if(e.verify){const r=Hd(i,e.verify);return new _R(r,t)}return xn(1463,{proto:e})}function D7(i,e){return i&&i.length>0?(jn(e!==void 0,14353),i.map((t=>(function(r,s){let l=r.updateTime?el(r.updateTime):el(s);return l.isEqual(Gn.min())&&(l=el(s)),new m7(l,r.transformResults||[])})(t,e)))):[]}function kR(i,e){return{documents:[AR(i,e.path)]}}function CR(i,e){const t={structuredQuery:{}},n=e.path;let r;e.collectionGroup!==null?(r=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=AR(i,r);const s=(function(f){if(f.length!==0)return LR(Br.create(f,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const l=(function(f){if(f.length!==0)return f.map((x=>(function(w){return{field:Gf(w.field),direction:N7(w.dir)}})(x)))})(e.orderBy);l&&(t.structuredQuery.orderBy=l);const u=gx(i,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:t,parent:r}}function RR(i){let e=ER(i.parent);const t=i.structuredQuery,n=t.from?t.from.length:0;let r=null;if(n>0){jn(n===1,65062);const x=t.from[0];x.allDescendants?r=x.collectionId:e=e.child(x.collectionId)}let s=[];t.where&&(s=(function(p){const w=DR(p);return w instanceof Br&&V2(w)?w.getFilters():[w]})(t.where));let l=[];t.orderBy&&(l=(function(p){return p.map((w=>(function(B){return new s1(Kf(B.field),(function(W){switch(W){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(B.direction))})(w)))})(t.orderBy));let u=null;t.limit&&(u=(function(p){let w;return w=typeof p=="object"?p.value:p,Q1(w)?null:w})(t.limit));let h=null;t.startAt&&(h=(function(p){const w=!!p.before,A=p.values||[];return new wp(A,w)})(t.startAt));let f=null;return t.endAt&&(f=(function(p){const w=!p.before,A=p.values||[];return new wp(A,w)})(t.endAt)),n7(e,r,l,s,u,"F",h,f)}function L7(i,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xn(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function DR(i){return i.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Kf(t.unaryFilter.field);return tr.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=Kf(t.unaryFilter.field);return tr.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Kf(t.unaryFilter.field);return tr.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=Kf(t.unaryFilter.field);return tr.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return xn(61313);default:return xn(60726)}})(i):i.fieldFilter!==void 0?(function(t){return tr.create(Kf(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return xn(58110);default:return xn(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(t){return Br.create(t.compositeFilter.filters.map((n=>DR(n))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return xn(1026)}})(t.compositeFilter.op))})(i):xn(30097,{filter:i})}function N7(i){return T7[i]}function P7(i){return A7[i]}function O7(i){return E7[i]}function Gf(i){return{fieldPath:i.canonicalString()}}function Kf(i){return Ps.fromServerFormat(i.fieldPath)}function LR(i){return i instanceof tr?(function(t){if(t.op==="=="){if(OA(t.value))return{unaryFilter:{field:Gf(t.field),op:"IS_NAN"}};if(PA(t.value))return{unaryFilter:{field:Gf(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(OA(t.value))return{unaryFilter:{field:Gf(t.field),op:"IS_NOT_NAN"}};if(PA(t.value))return{unaryFilter:{field:Gf(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gf(t.field),op:P7(t.op),value:t.value}}})(i):i instanceof Br?(function(t){const n=t.getFilters().map((r=>LR(r)));return n.length===1?n[0]:{compositeFilter:{op:O7(t.op),filters:n}}})(i):xn(54877,{filter:i})}function M7(i){const e=[];return i.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function NR(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}class Bc{constructor(e,t,n,r,s=Gn.min(),l=Gn.min(),u=Ca.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new Bc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class PR{constructor(e){this.yt=e}}function F7(i,e){let t;if(e.document)t=C7(i.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=en.fromSegments(e.noDocument.path),r=ef(e.noDocument.readTime);t=ea.newNoDocument(n,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return xn(56709);{const n=en.fromSegments(e.unknownDocument.path),r=ef(e.unknownDocument.version);t=ea.newUnknownDocument(n,r)}}return e.readTime&&t.setReadTime((function(r){const s=new Ur(r[0],r[1]);return Gn.fromTimestamp(s)})(e.readTime)),t}function QA(i,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:c1(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(s,l){return{name:l1(s,l.key),fields:l.data.value.mapValue.fields,updateTime:Ep(s,l.version.toTimestamp()),createTime:Ep(s,l.createTime.toTimestamp())}})(i.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Zd(e.version)};else{if(!e.isUnknownDocument())return xn(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:Zd(e.version)}}return n}function c1(i){const e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function Zd(i){const e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ef(i){const e=new Ur(i.seconds,i.nanoseconds);return Gn.fromTimestamp(e)}function Pd(i,e){const t=(e.baseMutations||[]).map((s=>vx(i.yt,s)));for(let s=0;s<e.mutations.length-1;++s){const l=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const u=e.mutations[s+1];l.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const n=e.mutations.map((s=>vx(i.yt,s))),r=Ur.fromMillis(e.localWriteTimeMs);return new B2(e.batchId,r,t,n)}function Vg(i){const e=ef(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?ef(i.lastLimboFreeSnapshotVersion):Gn.min();let n;return n=(function(s){return s.documents!==void 0})(i.query)?(function(s){const l=s.documents.length;return jn(l===1,1966,{count:l}),lu(rv(ER(s.documents[0])))})(i.query):(function(s){return lu(RR(s))})(i.query),new Bc(n,i.targetId,"TargetPurposeListen",i.lastListenSequenceNumber,e,t,Ca.fromBase64String(i.resumeToken))}function OR(i,e){const t=Zd(e.snapshotVersion),n=Zd(e.lastLimboFreeSnapshotVersion);let r;r=a1(e.target)?kR(i.yt,e.target):CR(i.yt,e.target).ft;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Qd(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:r}}function MR(i){const e=RR({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?px(e,e.limit,"L"):e}function Q_(i,e){return new H2(e.largestBatchId,vx(i.yt,e.overlayMutation))}function ZA(i,e){const t=e.path.lastSegment();return[i,Fo(e.path.popLast()),t]}function eE(i,e,t,n){return{indexId:i,uid:e,sequenceNumber:t,readTime:Zd(n.readTime),documentKey:Fo(n.documentKey.path),largestBatchId:n.largestBatchId}}class j7{getBundleMetadata(e,t){return tE(e).get(t).next((n=>{if(n)return(function(s){return{id:s.bundleId,createTime:ef(s.createTime),version:s.version}})(n)}))}saveBundleMetadata(e,t){return tE(e).put((function(r){return{bundleId:r.id,createTime:Zd(el(r.createTime)),version:r.version}})(t))}getNamedQuery(e,t){return nE(e).get(t).next((n=>{if(n)return(function(s){return{name:s.name,query:MR(s.bundledQuery),readTime:ef(s.readTime)}})(n)}))}saveNamedQuery(e,t){return nE(e).put((function(r){return{name:r.name,readTime:Zd(el(r.readTime)),bundledQuery:r.bundledQuery}})(t))}}function tE(i){return Ua(i,Z1)}function nE(i){return Ua(i,ev)}class uv{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const n=t.uid||"";return new uv(e,n)}getOverlay(e,t){return _g(e).get(ZA(this.userId,t)).next((n=>n?Q_(this.serializer,n):null))}getOverlays(e,t){const n=Ju();return ut.forEach(t,(r=>this.getOverlay(e,r).next((s=>{s!==null&&n.set(r,s)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((s,l)=>{const u=new H2(t,l);r.push(this.St(e,u))})),ut.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((l=>r.add(Fo(l.getCollectionPath()))));const s=[];return r.forEach((l=>{const u=IDBKeyRange.bound([this.userId,l,n],[this.userId,l,n+1],!1,!0);s.push(_g(e).Z(sx,u))})),ut.waitFor(s)}getOverlaysForCollection(e,t,n){const r=Ju(),s=Fo(t),l=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return _g(e).J(sx,l).next((u=>{for(const h of u){const f=Q_(this.serializer,h);r.set(f.getKey(),f)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const s=Ju();let l;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return _g(e).ee({index:j3,range:u},((h,f,x)=>{const p=Q_(this.serializer,f);s.size()<r||p.largestBatchId===l?(s.set(p.getKey(),p),l=p.largestBatchId):x.done()})).next((()=>s))}St(e,t){return _g(e).put((function(r,s,l){const[u,h,f]=ZA(s,l.mutation.key);return{userId:s,collectionPath:h,documentId:f,collectionGroup:l.mutation.key.getCollectionGroup(),largestBatchId:l.largestBatchId,overlayMutation:u1(r.yt,l.mutation)}})(this.serializer,this.userId,t))}}function _g(i){return Ua(i,tv)}class V7{bt(e){return Ua(e,P2)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{const n=t?.value;return n?Ca.fromUint8Array(n):Ca.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Od{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Es(e.integerValue));else if("doubleValue"in e){const n=Es(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),fm(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=Qc(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Zc(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?X3(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):iv(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):xn(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const r=bp,s=n[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Es(s)),this.Ot(r,t),this.Ct(n[r],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),en.fromName(e).path.forEach((n=>{this.Ft(t,60),this.Ut(n,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Od.Kt=new Od;const Of=255;function z7(i){if(i===0)return 8;let e=0;return i>>4||(e+=4,i<<=4),i>>6||(e+=2,i<<=2),i>>7||(e+=1),e}function iE(i){const e=64-(function(n){let r=0;for(let s=0;s<8;++s){const l=z7(255&n[s]);if(r+=l,l!==8)break}return r})(i);return Math.ceil(e/8)}class U7{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const r=t.codePointAt(0);this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)}}this.zt()}Zt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const r=t.codePointAt(0);this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)}}this.Ht()}Xt(e){const t=this.en(e),n=iE(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),n=iE(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(Of),this.sn(255)}_n(){this.an(Of),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=(function(s){const l=new DataView(new ArrayBuffer(8));return l.setFloat64(0,s,!1),new Uint8Array(l.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Of?(this.sn(Of),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Of?(this.an(Of),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class B7{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class $7{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class bg{constructor(){this.cn=new U7,this.ln=new B7(this.cn),this.hn=new $7(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class Md{constructor(e,t,n,r){this.Tn=e,this.In=t,this.En=n,this.dn=r}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new Md(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:C0(this.En),directionalValue:C0(this.dn),orderedDocumentKey:C0(t),documentKey:n.path.toArray()}}Vn(e,t,n){const r=this.Rn(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function Ih(i,e){let t=i.Tn-e.Tn;return t!==0?t:(t=rE(i.En,e.En),t!==0?t:(t=rE(i.dn,e.dn),t!==0?t:en.comparator(i.In,e.In)))}function rE(i,e){for(let t=0;t<i.length&&t<e.length;++t){const n=i[t]-e[t];if(n!==0)return n}return i.length-e.length}function C0(i){return DC()?(function(t){let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n})(i):i}function sE(i){return typeof i!="string"?i:(function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(i)}class aE{constructor(e){this.mn=new $r(((t,n)=>Ps.comparator(t.field,n.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(jn(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=nx(e);if(t!==void 0&&!this.wn(t))return!1;const n=kd(e);let r=new Set,s=0,l=0;for(;s<n.length&&this.wn(n[s]);++s)r=r.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.mn.size>0){const u=this.mn.getIterator().getNext();if(!r.has(u.field.canonicalString())){const h=n[s];if(!this.Sn(u,h)||!this.bn(this.fn[l++],h))return!1}++s}for(;s<n.length;++s){const u=n[s];if(l>=this.fn.length||!this.bn(this.fn[l++],u))return!1}return!0}Dn(){if(this.pn)return null;let e=new $r(Ps.comparator);const t=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new x0(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new x0(n.field,0))}for(const n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new x0(n.field,n.dir==="asc"?0:1)));return new e1(e1.UNKNOWN_ID,this.collectionId,t,dm.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function FR(i){if(jn(i instanceof tr||i instanceof Br,20012),i instanceof tr){if(i instanceof sR){const t=i.value.arrayValue?.values?.map((n=>tr.create(i.field,"==",n)))||[];return Br.create(t,"or")}return i}const e=i.filters.map((t=>FR(t)));return Br.create(e,i.op)}function H7(i){if(i.getFilters().length===0)return[];const e=xx(FR(i));return jn(jR(e),7391),_x(e)||bx(e)?[e]:e.getFilters()}function _x(i){return i instanceof tr}function bx(i){return i instanceof Br&&V2(i)}function jR(i){return _x(i)||bx(i)||(function(t){if(t instanceof Br&&cx(t)){for(const n of t.getFilters())if(!_x(n)&&!bx(n))return!1;return!0}return!1})(i)}function xx(i){if(jn(i instanceof tr||i instanceof Br,34018),i instanceof tr)return i;if(i.filters.length===1)return xx(i.filters[0]);const e=i.filters.map((n=>xx(n)));let t=Br.create(e,i.op);return t=h1(t),jR(t)?t:(jn(t instanceof Br,64498),jn(Sp(t),40251),jn(t.filters.length>1,57927),t.filters.reduce(((n,r)=>W2(n,r))))}function W2(i,e){let t;return jn(i instanceof tr||i instanceof Br,38388),jn(e instanceof tr||e instanceof Br,25473),t=i instanceof tr?e instanceof tr?(function(r,s){return Br.create([r,s],"and")})(i,e):oE(i,e):e instanceof tr?oE(e,i):(function(r,s){if(jn(r.filters.length>0&&s.filters.length>0,48005),Sp(r)&&Sp(s))return nR(r,s.getFilters());const l=cx(r)?r:s,u=cx(r)?s:r,h=l.filters.map((f=>W2(f,u)));return Br.create(h,"or")})(i,e),h1(t)}function oE(i,e){if(Sp(e))return nR(e,i.getFilters());{const t=e.filters.map((n=>W2(i,n)));return Br.create(t,"or")}}function h1(i){if(jn(i instanceof tr||i instanceof Br,11850),i instanceof tr)return i;const e=i.getFilters();if(e.length===1)return h1(e[0]);if(eR(i))return i;const t=e.map((r=>h1(r))),n=[];return t.forEach((r=>{r instanceof tr?n.push(r):r instanceof Br&&(r.op===i.op?n.push(...r.filters):n.push(r))})),n.length===1?n[0]:Br.create(n,i.op)}class G7{constructor(){this.Cn=new q2}addToCollectionParentIndex(e,t){return this.Cn.add(t),ut.resolve()}getCollectionParents(e,t){return ut.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ut.resolve()}deleteFieldIndex(e,t){return ut.resolve()}deleteAllFieldIndexes(e){return ut.resolve()}createTargetIndexes(e,t){return ut.resolve()}getDocumentsMatchingTarget(e,t){return ut.resolve(null)}getIndexType(e,t){return ut.resolve(0)}getFieldIndexes(e,t){return ut.resolve([])}getNextCollectionGroupToUpdate(e){return ut.resolve(null)}getMinOffset(e,t){return ut.resolve(Ul.min())}getMinOffsetFromCollectionGroup(e,t){return ut.resolve(Ul.min())}updateCollectionGroup(e,t,n){return ut.resolve()}updateIndexEntries(e,t){return ut.resolve()}}class q2{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new $r(Ar.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new $r(Ar.comparator)).toArray()}}const lE="IndexedDbIndexManager",Wy=new Uint8Array(0);class K7{constructor(e,t){this.databaseId=t,this.vn=new q2,this.Fn=new ih((n=>Qd(n)),((n,r)=>Km(n,r))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));const s={collectionId:n,parent:Fo(r)};return uE(e).put(s)}return ut.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[E3(t),""],!1,!0);return uE(e).J(r).next((s=>{for(const l of s){if(l.collectionId!==t)break;n.push(Xu(l.parent))}return n}))}addFieldIndex(e,t){const n=xg(e),r=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((h=>[h.fieldPath.canonicalString(),h.kind]))}})(t);delete r.indexId;const s=n.add(r);if(t.indexState){const l=Ff(e);return s.next((u=>{l.put(eE(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return s.next()}deleteFieldIndex(e,t){const n=xg(e),r=Ff(e),s=Mf(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=xg(e),n=Mf(e),r=Ff(e);return t.Z().next((()=>n.Z())).next((()=>r.Z()))}createTargetIndexes(e,t){return ut.forEach(this.Mn(t),(n=>this.getIndexType(e,n).next((r=>{if(r===0||r===1){const s=new aE(n).Dn();if(s!=null)return this.addFieldIndex(e,s)}}))))}getDocumentsMatchingTarget(e,t){const n=Mf(e);let r=!0;const s=new Map;return ut.forEach(this.Mn(t),(l=>this.xn(e,l).next((u=>{r&&(r=!!u),s.set(l,u)})))).next((()=>{if(r){let l=Ni();const u=[];return ut.forEach(s,((h,f)=>{zt(lE,`Using index ${(function(he){return`id=${he.indexId}|cg=${he.collectionGroup}|f=${he.fields.map((me=>`${me.fieldPath}:${me.kind}`)).join(",")}`})(h)} to execute ${Qd(t)}`);const x=(function(he,me){const Ce=nx(me);if(Ce===void 0)return null;for(const Ve of o1(he,Ce.fieldPath))switch(Ve.op){case"array-contains-any":return Ve.value.arrayValue.values||[];case"array-contains":return[Ve.value]}return null})(f,h),p=(function(he,me){const Ce=new Map;for(const Ve of kd(me))for(const pe of o1(he,Ve.fieldPath))switch(pe.op){case"==":case"in":Ce.set(Ve.fieldPath.canonicalString(),pe.value);break;case"not-in":case"!=":return Ce.set(Ve.fieldPath.canonicalString(),pe.value),Array.from(Ce.values())}return null})(f,h),w=(function(he,me){const Ce=[];let Ve=!0;for(const pe of kd(me)){const ee=pe.kind===0?zA(he,pe.fieldPath,he.startAt):UA(he,pe.fieldPath,he.startAt);Ce.push(ee.value),Ve&&(Ve=ee.inclusive)}return new wp(Ce,Ve)})(f,h),A=(function(he,me){const Ce=[];let Ve=!0;for(const pe of kd(me)){const ee=pe.kind===0?UA(he,pe.fieldPath,he.endAt):zA(he,pe.fieldPath,he.endAt);Ce.push(ee.value),Ve&&(Ve=ee.inclusive)}return new wp(Ce,Ve)})(f,h),B=this.On(h,f,w),$=this.On(h,f,A),W=this.Nn(h,f,p),q=this.Bn(h.indexId,x,B,w.inclusive,$,A.inclusive,W);return ut.forEach(q,(ge=>n.Y(ge,t.limit).next((he=>{he.forEach((me=>{const Ce=en.fromSegments(me.documentKey);l.has(Ce)||(l=l.add(Ce),u.push(Ce))}))}))))})).next((()=>u))}return ut.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=H7(Br.create(e.filters,"and")).map((n=>dx(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,n,r,s,l,u){const h=(t!=null?t.length:1)*Math.max(n.length,s.length),f=h/(t!=null?t.length:1),x=[];for(let p=0;p<h;++p){const w=t?this.Ln(t[p/f]):Wy,A=this.kn(e,w,n[p%f],r),B=this.qn(e,w,s[p%f],l),$=u.map((W=>this.kn(e,w,W,!0)));x.push(...this.createRange(A,B,$))}return x}kn(e,t,n,r){const s=new Md(e,en.empty(),t,n);return r?s:s.An()}qn(e,t,n,r){const s=new Md(e,en.empty(),t,n);return r?s.An():s}xn(e,t){const n=new aE(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((s=>{let l=null;for(const u of s)n.yn(u)&&(!l||u.fields.length>l.fields.length)&&(l=u);return l}))}getIndexType(e,t){let n=2;const r=this.Mn(t);return ut.forEach(r,(s=>this.xn(e,s).next((l=>{l?n!==0&&l.fields.length<(function(h){let f=new $r(Ps.comparator),x=!1;for(const p of h.filters)for(const w of p.getFlattenedFilters())w.field.isKeyField()||(w.op==="array-contains"||w.op==="array-contains-any"?x=!0:f=f.add(w.field));for(const p of h.orderBy)p.field.isKeyField()||(f=f.add(p.field));return f.size+(x?1:0)})(s)&&(n=1):n=0})))).next((()=>(function(l){return l.limit!==null})(t)&&r.length>1&&n===2?1:n))}Qn(e,t){const n=new bg;for(const r of kd(e)){const s=t.data.field(r.fieldPath);if(s==null)return null;const l=n.Pn(r.kind);Od.Kt.Dt(s,l)}return n.un()}Ln(e){const t=new bg;return Od.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const n=new bg;return Od.Kt.Dt(_m(this.databaseId,t),n.Pn((function(s){const l=kd(s);return l.length===0?0:l[l.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let r=[];r.push(new bg);let s=0;for(const l of kd(e)){const u=n[s++];for(const h of r)if(this.Un(t,l.fieldPath)&&bm(u))r=this.Kn(r,l,u);else{const f=h.Pn(l.kind);Od.Kt.Dt(u,f)}}return this.Wn(r)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){const r=[...e],s=[];for(const l of n.arrayValue.values||[])for(const u of r){const h=new bg;h.seed(u.un()),Od.Kt.Dt(l,h.Pn(t.kind)),s.push(h)}return s}Un(e,t){return!!e.filters.find((n=>n instanceof tr&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(e,t){const n=xg(e),r=Ff(e);return(t?n.J(rx,IDBKeyRange.bound(t,t)):n.J()).next((s=>{const l=[];return ut.forEach(s,(u=>r.get([u.indexId,this.uid]).next((h=>{l.push((function(x,p){const w=p?new dm(p.sequenceNumber,new Ul(ef(p.readTime),new en(Xu(p.documentKey)),p.largestBatchId)):dm.empty(),A=x.fields.map((([B,$])=>new x0(Ps.fromServerFormat(B),$)));return new e1(x.indexId,x.collectionGroup,A,w)})(u,h))})))).next((()=>l))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((n,r)=>{const s=n.indexState.sequenceNumber-r.indexState.sequenceNumber;return s!==0?s:hi(n.collectionGroup,r.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=xg(e),s=Ff(e);return this.Gn(e).next((l=>r.J(rx,IDBKeyRange.bound(t,t)).next((u=>ut.forEach(u,(h=>s.put(eE(h.indexId,this.uid,l,n))))))))}updateIndexEntries(e,t){const n=new Map;return ut.forEach(t,((r,s)=>{const l=n.get(r.collectionGroup);return(l?ut.resolve(l):this.getFieldIndexes(e,r.collectionGroup)).next((u=>(n.set(r.collectionGroup,u),ut.forEach(u,(h=>this.zn(e,r,h).next((f=>{const x=this.jn(s,h);return f.isEqual(x)?ut.resolve():this.Jn(e,s,h,f,x)})))))))}))}Hn(e,t,n,r){return Mf(e).put(r.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,r){return Mf(e).delete(r.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){const r=Mf(e);let s=new $r(Ih);return r.ee({index:F3,range:IDBKeyRange.only([n.indexId,this.uid,C0(this.$n(n,t))])},((l,u)=>{s=s.add(new Md(n.indexId,t,sE(u.arrayValue),sE(u.directionalValue)))})).next((()=>s))}jn(e,t){let n=new $r(Ih);const r=this.Qn(t,e);if(r==null)return n;const s=nx(t);if(s!=null){const l=e.data.field(s.fieldPath);if(bm(l))for(const u of l.arrayValue.values||[])n=n.add(new Md(t.indexId,e.key,this.Ln(u),r))}else n=n.add(new Md(t.indexId,e.key,Wy,r));return n}Jn(e,t,n,r,s){zt(lE,"Updating index entries for document '%s'",t.key);const l=[];return(function(h,f,x,p,w){const A=h.getIterator(),B=f.getIterator();let $=Pf(A),W=Pf(B);for(;$||W;){let q=!1,ge=!1;if($&&W){const he=x($,W);he<0?ge=!0:he>0&&(q=!0)}else $!=null?ge=!0:q=!0;q?(p(W),W=Pf(B)):ge?(w($),$=Pf(A)):($=Pf(A),W=Pf(B))}})(r,s,Ih,(u=>{l.push(this.Hn(e,t,n,u))}),(u=>{l.push(this.Yn(e,t,n,u))})),ut.waitFor(l)}Gn(e){let t=1;return Ff(e).ee({index:M3,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,r,s)=>{s.done(),t=r.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((l,u)=>Ih(l,u))).filter(((l,u,h)=>!u||Ih(l,h[u-1])!==0));const r=[];r.push(e);for(const l of n){const u=Ih(l,e),h=Ih(l,t);if(u===0)r[0]=e.An();else if(u>0&&h<0)r.push(l),r.push(l.An());else if(h>0)break}r.push(t);const s=[];for(let l=0;l<r.length;l+=2){if(this.Zn(r[l],r[l+1]))return[];const u=r[l].Vn(this.uid,Wy,en.empty()),h=r[l+1].Vn(this.uid,Wy,en.empty());s.push(IDBKeyRange.bound(u,h))}return s}Zn(e,t){return Ih(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(cE)}getMinOffset(e,t){return ut.mapArray(this.Mn(t),(n=>this.xn(e,n).next((r=>r||xn(44426))))).next(cE)}}function uE(i){return Ua(i,mm)}function Mf(i){return Ua(i,Wg)}function xg(i){return Ua(i,N2)}function Ff(i){return Ua(i,Kg)}function cE(i){jn(i.length!==0,28825);let e=i[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<i.length;n++){const r=i[n].indexState.offset;R2(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new Ul(e.readTime,e.documentKey,t)}const hE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},VR=41943040;class Oo{static withCacheSize(e){return new Oo(e,Oo.DEFAULT_COLLECTION_PERCENTILE,Oo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function zR(i,e,t){const n=i.store(Iu),r=i.store(mp),s=[],l=IDBKeyRange.only(t.batchId);let u=0;const h=n.ee({range:l},((x,p,w)=>(u++,w.delete())));s.push(h.next((()=>{jn(u===1,47070,{batchId:t.batchId})})));const f=[];for(const x of t.mutations){const p=N3(e,x.key.path,t.batchId);s.push(r.delete(p)),f.push(x.key)}return ut.waitFor(s).next((()=>f))}function d1(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw xn(14731);e=i.noDocument}return JSON.stringify(e).length}Oo.DEFAULT_COLLECTION_PERCENTILE=10,Oo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oo.DEFAULT=new Oo(VR,Oo.DEFAULT_COLLECTION_PERCENTILE,Oo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oo.DISABLED=new Oo(-1,0,0);class cv{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Xn={}}static wt(e,t,n,r){jn(e.uid!=="",64387);const s=e.isAuthenticated()?e.uid:"";return new cv(s,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return kh(e).ee({index:zd,range:n},((r,s,l)=>{t=!1,l.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const s=Wf(e),l=kh(e);return l.add({}).next((u=>{jn(typeof u=="number",49019);const h=new B2(u,t,n,r),f=(function(A,B,$){const W=$.baseMutations.map((ge=>u1(A.yt,ge))),q=$.mutations.map((ge=>u1(A.yt,ge)));return{userId:B,batchId:$.batchId,localWriteTimeMs:$.localWriteTime.toMillis(),baseMutations:W,mutations:q}})(this.serializer,this.userId,h),x=[];let p=new $r(((w,A)=>hi(w.canonicalString(),A.canonicalString())));for(const w of r){const A=N3(this.userId,w.key.path,u);p=p.add(w.key.path.popLast()),x.push(l.put(f)),x.push(s.put(A,bj))}return p.forEach((w=>{x.push(this.indexManager.addToCollectionParentIndex(e,w))})),e.addOnCommittedListener((()=>{this.Xn[u]=h.keys()})),ut.waitFor(x).next((()=>h))}))}lookupMutationBatch(e,t){return kh(e).get(t).next((n=>n?(jn(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),Pd(this.serializer,n)):null))}er(e,t){return this.Xn[t]?ut.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((n=>{if(n){const r=n.keys();return this.Xn[t]=r,r}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return kh(e).ee({index:zd,range:r},((l,u,h)=>{u.userId===this.userId&&(jn(u.batchId>=n,47524,{tr:n}),s=Pd(this.serializer,u)),h.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Bd;return kh(e).ee({index:zd,range:t,reverse:!0},((r,s,l)=>{n=s.batchId,l.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Bd],[this.userId,Number.POSITIVE_INFINITY]);return kh(e).J(zd,t).next((n=>n.map((r=>Pd(this.serializer,r)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=w0(this.userId,t.path),r=IDBKeyRange.lowerBound(n),s=[];return Wf(e).ee({range:r},((l,u,h)=>{const[f,x,p]=l,w=Xu(x);if(f===this.userId&&t.path.isEqual(w))return kh(e).get(p).next((A=>{if(!A)throw xn(61480,{nr:l,batchId:p});jn(A.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:A.userId,batchId:p}),s.push(Pd(this.serializer,A))}));h.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new $r(hi);const r=[];return t.forEach((s=>{const l=w0(this.userId,s.path),u=IDBKeyRange.lowerBound(l),h=Wf(e).ee({range:u},((f,x,p)=>{const[w,A,B]=f,$=Xu(A);w===this.userId&&s.path.isEqual($)?n=n.add(B):p.done()}));r.push(h)})),ut.waitFor(r).next((()=>this.rr(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,s=w0(this.userId,n),l=IDBKeyRange.lowerBound(s);let u=new $r(hi);return Wf(e).ee({range:l},((h,f,x)=>{const[p,w,A]=h,B=Xu(w);p===this.userId&&n.isPrefixOf(B)?B.length===r&&(u=u.add(A)):x.done()})).next((()=>this.rr(e,u)))}rr(e,t){const n=[],r=[];return t.forEach((s=>{r.push(kh(e).get(s).next((l=>{if(l===null)throw xn(35274,{batchId:s});jn(l.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:l.userId,batchId:s}),n.push(Pd(this.serializer,l))})))})),ut.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return zR(e.le,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),ut.forEach(n,(r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return ut.resolve();const n=IDBKeyRange.lowerBound((function(l){return[l]})(this.userId)),r=[];return Wf(e).ee({range:n},((s,l,u)=>{if(s[0]===this.userId){const h=Xu(s[1]);r.push(h)}else u.done()})).next((()=>{jn(r.length===0,56720,{sr:r.map((s=>s.canonicalString()))})}))}))}containsKey(e,t){return UR(e,this.userId,t)}_r(e){return BR(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Bd,lastStreamToken:""}))}}function UR(i,e,t){const n=w0(e,t.path),r=n[1],s=IDBKeyRange.lowerBound(n);let l=!1;return Wf(i).ee({range:s,X:!0},((u,h,f)=>{const[x,p,w]=u;x===e&&p===r&&(l=!0),f.done()})).next((()=>l))}function kh(i){return Ua(i,Iu)}function Wf(i){return Ua(i,mp)}function BR(i){return Ua(i,pm)}class tf{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new tf(0)}static cr(){return new tf(-1)}}class W7{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{const n=new tf(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>Gn.fromTimestamp(new Ur(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.lr(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>jf(e).delete(t.targetId))).next((()=>this.lr(e))).next((n=>(jn(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n))))}removeTargets(e,t,n){let r=0;const s=[];return jf(e).ee(((l,u)=>{const h=Vg(u);h.sequenceNumber<=t&&n.get(h.targetId)===null&&(r++,s.push(this.removeTargetData(e,h)))})).next((()=>ut.waitFor(s))).next((()=>r))}forEachTarget(e,t){return jf(e).ee(((n,r)=>{const s=Vg(r);t(s)}))}lr(e){return dE(e).get(i1).next((t=>(jn(t!==null,2888),t)))}hr(e,t){return dE(e).put(i1,t)}Pr(e,t){return jf(e).put(OR(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){const n=Qd(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return jf(e).ee({range:r,index:O3},((l,u,h)=>{const f=Vg(u);Km(t,f.target)&&(s=f,h.done())})).next((()=>s))}addMatchingKeys(e,t,n){const r=[],s=Fh(e);return t.forEach((l=>{const u=Fo(l.path);r.push(s.put({targetId:n,path:u})),r.push(this.referenceDelegate.addReference(e,n,l))})),ut.waitFor(r)}removeMatchingKeys(e,t,n){const r=Fh(e);return ut.forEach(t,(s=>{const l=Fo(s.path);return ut.waitFor([r.delete([n,l]),this.referenceDelegate.removeReference(e,n,s)])}))}removeMatchingKeysForTargetId(e,t){const n=Fh(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Fh(e);let s=Ni();return r.ee({range:n,X:!0},((l,u,h)=>{const f=Xu(l[1]),x=new en(f);s=s.add(x)})).next((()=>s))}containsKey(e,t){const n=Fo(t.path),r=IDBKeyRange.bound([n],[E3(n)],!1,!0);let s=0;return Fh(e).ee({index:L2,X:!0,range:r},(([l,u],h,f)=>{l!==0&&(s++,f.done())})).next((()=>s>0))}At(e,t){return jf(e).get(t).next((n=>n?Vg(n):null))}}function jf(i){return Ua(i,yp)}function dE(i){return Ua(i,$d)}function Fh(i){return Ua(i,vp)}const fE="LruGarbageCollector",q7=1048576;function pE([i,e],[t,n]){const r=hi(i,t);return r===0?hi(e,n):r}class Y7{constructor(e){this.Ir=e,this.buffer=new $r(pE),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();pE(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class $R{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){zt(fE,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){fd(t)?zt(fE,"Ignoring IndexedDB error during garbage collection: ",t):await hf(t)}await this.Vr(3e5)}))}}class X7{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return ut.resolve(ru.ce);const n=new Y7(t);return this.mr.forEachTarget(e,(r=>n.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>n.Ar(r))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(zt("LruGarbageCollector","Garbage collection skipped; disabled"),ut.resolve(hE)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(zt("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hE):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,s,l,u,h,f;const x=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(zt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,l=Date.now(),this.nthSequenceNumber(e,r)))).next((p=>(n=p,u=Date.now(),this.removeTargets(e,n,t)))).next((p=>(s=p,h=Date.now(),this.removeOrphanedDocuments(e,n)))).next((p=>(f=Date.now(),$f()<=Ki.DEBUG&&zt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-x}ms
	Determined least recently used ${r} in `+(u-l)+`ms
	Removed ${s} targets in `+(h-u)+`ms
	Removed ${p} documents in `+(f-h)+`ms
Total Duration: ${f-x}ms`),ut.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p}))))}}function HR(i,e){return new X7(i,e)}class J7{constructor(e,t){this.db=e,this.garbageCollector=HR(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((n=>t.next((r=>n+r))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((n,r)=>t(r)))}addReference(e,t,n){return qy(e,n)}removeReference(e,t,n){return qy(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return qy(e,t)}br(e,t){return(function(r,s){let l=!1;return BR(r).te((u=>UR(r,u,s).next((h=>(h&&(l=!0),ut.resolve(!h)))))).next((()=>l))})(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Sr(e,((l,u)=>{if(u<=t){const h=this.br(e,l).next((f=>{if(!f)return s++,n.getEntry(e,l).next((()=>(n.removeEntry(l,Gn.min()),Fh(e).delete((function(p){return[0,Fo(p.path)]})(l)))))}));r.push(h)}})).next((()=>ut.waitFor(r))).next((()=>n.apply(e))).next((()=>s))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return qy(e,t)}Sr(e,t){const n=Fh(e);let r,s=ru.ce;return n.ee({index:L2},(([l,u],{path:h,sequenceNumber:f})=>{l===0?(s!==ru.ce&&t(new en(Xu(r)),s),s=f,r=h):s=ru.ce})).next((()=>{s!==ru.ce&&t(new en(Xu(r)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function qy(i,e){return Fh(i).put((function(n,r){return{targetId:0,path:Fo(n.path),sequenceNumber:r}})(e,i.currentSequenceNumber))}class GR{constructor(){this.changes=new ih((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ea.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?ut.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Q7{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Ed(e).put(n)}removeEntry(e,t,n){return Ed(e).delete((function(s,l){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],c1(l),u[u.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Dr(e,n))))}getEntry(e,t){let n=ea.newInvalidDocument(t);return Ed(e).ee({index:S0,range:IDBKeyRange.only(wg(t))},((r,s)=>{n=this.Cr(t,s)})).next((()=>n))}vr(e,t){let n={size:0,document:ea.newInvalidDocument(t)};return Ed(e).ee({index:S0,range:IDBKeyRange.only(wg(t))},((r,s)=>{n={document:this.Cr(t,s),size:d1(s)}})).next((()=>n))}getEntries(e,t){let n=Fl();return this.Fr(e,t,((r,s)=>{const l=this.Cr(r,s);n=n.insert(r,l)})).next((()=>n))}Mr(e,t){let n=Fl(),r=new ma(en.comparator);return this.Fr(e,t,((s,l)=>{const u=this.Cr(s,l);n=n.insert(s,u),r=r.insert(s,d1(l))})).next((()=>({documents:n,Or:r})))}Fr(e,t,n){if(t.isEmpty())return ut.resolve();let r=new $r(yE);t.forEach((h=>r=r.add(h)));const s=IDBKeyRange.bound(wg(r.first()),wg(r.last())),l=r.getIterator();let u=l.getNext();return Ed(e).ee({index:S0,range:s},((h,f,x)=>{const p=en.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;u&&yE(u,p)<0;)n(u,null),u=l.getNext();u&&u.isEqual(p)&&(n(u,f),u=l.hasNext()?l.getNext():null),u?x.j(wg(u)):x.done()})).next((()=>{for(;u;)n(u,null),u=l.hasNext()?l.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,s){const l=t.path,u=[l.popLast().toArray(),l.lastSegment(),c1(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],h=[l.popLast().toArray(),l.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ed(e).J(IDBKeyRange.bound(u,h,!0)).next((f=>{s?.incrementDocumentReadCount(f.length);let x=Fl();for(const p of f){const w=this.Cr(en.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);w.isFoundDocument()&&(qm(t,w)||r.has(w.key))&&(x=x.insert(w.key,w))}return x}))}getAllFromCollectionGroup(e,t,n,r){let s=Fl();const l=mE(t,n),u=mE(t,Ul.max());return Ed(e).ee({index:P3,range:IDBKeyRange.bound(l,u,!0)},((h,f,x)=>{const p=this.Cr(en.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(p.key,p),s.size===r&&x.done()})).next((()=>s))}newChangeBuffer(e){return new Z7(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return gE(e).get(ix).next((t=>(jn(!!t,20021),t)))}Dr(e,t){return gE(e).put(ix,t)}Cr(e,t){if(t){const n=F7(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Gn.min())))return n}return ea.newInvalidDocument(e)}}function KR(i){return new Q7(i)}class Z7 extends GR{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ih((n=>n.toString()),((n,r)=>n.isEqual(r)))}applyChanges(e){const t=[];let n=0,r=new $r(((s,l)=>hi(s.canonicalString(),l.canonicalString())));return this.changes.forEach(((s,l)=>{const u=this.Br.get(s);if(t.push(this.Nr.removeEntry(e,s,u.readTime)),l.isValidDocument()){const h=QA(this.Nr.serializer,l);r=r.add(s.path.popLast());const f=d1(h);n+=f-u.size,t.push(this.Nr.addEntry(e,s,h))}else if(n-=u.size,this.trackRemovals){const h=QA(this.Nr.serializer,l.convertToNoDocument(Gn.min()));t.push(this.Nr.addEntry(e,s,h))}})),r.forEach((s=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,s))})),t.push(this.Nr.updateMetadata(e,n)),ut.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:n,Or:r})=>(r.forEach(((s,l)=>{this.Br.set(s,{size:l,readTime:n.get(s).readTime})})),n)))}}function gE(i){return Ua(i,gm)}function Ed(i){return Ua(i,n1)}function wg(i){const e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function mE(i,e){const t=e.documentKey.path.toArray();return[i,c1(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function yE(i,e){const t=i.path.toArray(),n=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(r=hi(t[s],n[s]),r)return r;return r=hi(t.length,n.length),r||(r=hi(t[t.length-2],n[n.length-2]),r||hi(t[t.length-1],n[n.length-1]))}class eV{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class WR{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(n!==null&&Jg(n.mutation,r,su.empty(),Ur.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,Ni()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=Ni()){const r=Ju();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((s=>{let l=Fg();return s.forEach(((u,h)=>{l=l.insert(u,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,t){const n=Ju();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Ni())))}populateOverlays(e,t,n){const r=[];return n.forEach((s=>{t.has(s)||r.push(s)})),this.documentOverlayCache.getOverlays(e,r).next((s=>{s.forEach(((l,u)=>{t.set(l,u)}))}))}computeViews(e,t,n,r){let s=Fl();const l=Xg(),u=(function(){return Xg()})();return t.forEach(((h,f)=>{const x=n.get(f.key);r.has(f.key)&&(x===void 0||x.mutation instanceof pd)?s=s.insert(f.key,f):x!==void 0?(l.set(f.key,x.mutation.getFieldMask()),Jg(x.mutation,f,x.mutation.getFieldMask(),Ur.now())):l.set(f.key,su.empty())})),this.recalculateAndSaveOverlays(e,s).next((h=>(h.forEach(((f,x)=>l.set(f,x))),t.forEach(((f,x)=>u.set(f,new eV(x,l.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,t){const n=Xg();let r=new ma(((l,u)=>l-u)),s=Ni();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((l=>{for(const u of l)u.keys().forEach((h=>{const f=t.get(h);if(f===null)return;let x=n.get(h)||su.empty();x=u.applyToLocalView(f,x),n.set(h,x);const p=(r.get(u.batchId)||Ni()).add(h);r=r.insert(u.batchId,p)}))})).next((()=>{const l=[],u=r.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,x=h.value,p=hR();x.forEach((w=>{if(!s.has(w)){const A=yR(t.get(w),n.get(w));A!==null&&p.set(w,A),s=s.add(w)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,p))}return ut.waitFor(l)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,r){return(function(l){return en.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((s=>{const l=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):ut.resolve(Ju());let u=hm,h=s;return l.next((f=>ut.forEach(f,((x,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(x)?ut.resolve():this.remoteDocumentCache.getEntry(e,x).next((w=>{h=h.insert(x,w)}))))).next((()=>this.populateOverlays(e,f,s))).next((()=>this.computeViews(e,h,f,Ni()))).next((x=>({batchId:u,changes:cR(x)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new en(t)).next((n=>{let r=Fg();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let l=Fg();return this.indexManager.getCollectionParents(e,s).next((u=>ut.forEach(u,(h=>{const f=(function(p,w){return new Wm(w,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,h.child(s));return this.getDocumentsMatchingCollectionQuery(e,f,n,r).next((x=>{x.forEach(((p,w)=>{l=l.insert(p,w)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((l=>(s=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r)))).next((l=>{s.forEach(((h,f)=>{const x=f.getKey();l.get(x)===null&&(l=l.insert(x,ea.newInvalidDocument(x)))}));let u=Fg();return l.forEach(((h,f)=>{const x=s.get(h);x!==void 0&&Jg(x.mutation,f,su.empty(),Ur.now()),qm(t,f)&&(u=u.insert(h,f))})),u}))}}class tV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ut.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:el(r.createTime)}})(t)),ut.resolve()}getNamedQuery(e,t){return ut.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:MR(r.bundledQuery),readTime:el(r.readTime)}})(t)),ut.resolve()}}class nV{constructor(){this.overlays=new ma(en.comparator),this.qr=new Map}getOverlay(e,t){return ut.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ju();return ut.forEach(t,(r=>this.getOverlay(e,r).next((s=>{s!==null&&n.set(r,s)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((r,s)=>{this.St(e,t,s)})),ut.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return r!==void 0&&(r.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(n)),ut.resolve()}getOverlaysForCollection(e,t,n){const r=Ju(),s=t.length+1,l=new en(t.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&h.largestBatchId>n&&r.set(h.getKey(),h)}return ut.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new ma(((f,x)=>f-x));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>n){let x=s.get(f.largestBatchId);x===null&&(x=Ju(),s=s.insert(f.largestBatchId,x)),x.set(f.getKey(),f)}}const u=Ju(),h=s.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,x)=>u.set(f,x))),!(u.size()>=r)););return ut.resolve(u)}St(e,t,n){const r=this.overlays.get(n.key);if(r!==null){const l=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,l)}this.overlays=this.overlays.insert(n.key,new H2(t,n));let s=this.qr.get(t);s===void 0&&(s=Ni(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class iV{constructor(){this.sessionToken=Ca.EMPTY_BYTE_STRING}getSessionToken(e){return ut.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ut.resolve()}}class Y2{constructor(){this.Qr=new $r(to.$r),this.Ur=new $r(to.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new to(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new to(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new en(new Ar([])),n=new to(t,e),r=new to(t,e+1),s=[];return this.Ur.forEachInRange([n,r],(l=>{this.Gr(l),s.push(l.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new en(new Ar([])),n=new to(t,e),r=new to(t,e+1);let s=Ni();return this.Ur.forEachInRange([n,r],(l=>{s=s.add(l.key)})),s}containsKey(e){const t=new to(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class to{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return en.comparator(e.key,t.key)||hi(e.Yr,t.Yr)}static Kr(e,t){return hi(e.Yr,t.Yr)||en.comparator(e.key,t.key)}}class rV{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new $r(to.$r)}checkEmpty(e){return ut.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new B2(s,t,n,r);this.mutationQueue.push(l);for(const u of r)this.Zr=this.Zr.add(new to(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return ut.resolve(l)}lookupMutationBatch(e,t){return ut.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),s=r<0?0:r;return ut.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ut.resolve(this.mutationQueue.length===0?Bd:this.tr-1)}getAllMutationBatches(e){return ut.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new to(t,0),r=new to(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],(l=>{const u=this.Xr(l.Yr);s.push(u)})),ut.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new $r(hi);return t.forEach((r=>{const s=new to(r,0),l=new to(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,l],(u=>{n=n.add(u.Yr)}))})),ut.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;en.isDocumentKey(s)||(s=s.child(""));const l=new to(new en(s),0);let u=new $r(hi);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!n.isPrefixOf(f)&&(f.length===r&&(u=u.add(h.Yr)),!0)}),l),ut.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((n=>{const r=this.Xr(n);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){jn(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return ut.forEach(t.mutations,(r=>{const s=new to(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new to(t,0),r=this.Zr.firstAfterOrEqual(n);return ut.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ut.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sV{constructor(e){this.ri=e,this.docs=(function(){return new ma(en.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,l=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:l}),this.size+=l-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ut.resolve(n?n.document.mutableCopy():ea.newInvalidDocument(t))}getEntries(e,t){let n=Fl();return t.forEach((r=>{const s=this.docs.get(r);n=n.insert(r,s?s.document.mutableCopy():ea.newInvalidDocument(r))})),ut.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=Fl();const l=t.path,u=new en(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:x}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||R2(C3(x),n)<=0||(r.has(x.key)||qm(t,x))&&(s=s.insert(x.key,x.mutableCopy()))}return ut.resolve(s)}getAllFromCollectionGroup(e,t,n,r){xn(9500)}ii(e,t){return ut.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new aV(this)}getSize(e){return ut.resolve(this.size)}}class aV extends GR{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)})),ut.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class oV{constructor(e){this.persistence=e,this.si=new ih((t=>Qd(t)),Km),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.oi=0,this._i=new Y2,this.targetCount=0,this.ai=tf.ur()}forEachTarget(e,t){return this.si.forEach(((n,r)=>t(r))),ut.resolve()}getLastRemoteSnapshotVersion(e){return ut.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ut.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ut.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ut.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new tf(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ut.resolve()}updateTargetData(e,t){return this.Pr(t),ut.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ut.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.si.forEach(((l,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.si.delete(l),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),r++)})),ut.waitFor(s).next((()=>r))}getTargetCount(e){return ut.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return ut.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ut.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((l=>{s.push(r.markPotentiallyOrphaned(e,l))})),ut.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ut.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return ut.resolve(n)}containsKey(e,t){return ut.resolve(this._i.containsKey(t))}}class X2{constructor(e,t){this.ui={},this.overlays={},this.ci=new ru(0),this.li=!1,this.li=!0,this.hi=new iV,this.referenceDelegate=e(this),this.Pi=new oV(this),this.indexManager=new G7,this.remoteDocumentCache=(function(r){return new sV(r)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new PR(t),this.Ii=new tV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nV,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new rV(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){zt("MemoryPersistence","Starting transaction:",e);const r=new lV(this.ci.next());return this.referenceDelegate.Ei(),n(r).next((s=>this.referenceDelegate.di(r).next((()=>s)))).toPromise().then((s=>(r.raiseOnCommittedEvent(),s)))}Ai(e,t){return ut.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class lV extends D3{constructor(e){super(),this.currentSequenceNumber=e}}class hv{constructor(e){this.persistence=e,this.Ri=new Y2,this.Vi=null}static mi(e){return new hv(e)}get fi(){if(this.Vi)return this.Vi;throw xn(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ut.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ut.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ut.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((s=>this.fi.add(s.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ut.forEach(this.fi,(n=>{const r=en.fromPath(n);return this.gi(e,r).next((s=>{s||t.removeEntry(r,Gn.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return ut.or([()=>ut.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class f1{constructor(e,t){this.persistence=e,this.pi=new ih((n=>Fo(n.path)),((n,r)=>n.isEqual(r))),this.garbageCollector=HR(this,t)}static mi(e,t){return new f1(e,t)}Ei(){}di(e){return ut.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((r=>n+r))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return ut.forEach(this.pi,((n,r)=>this.br(e,n,r).next((s=>s?ut.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(e,(l=>this.br(e,l,t).next((u=>{u||(n++,s.removeEntry(l,Gn.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ut.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ut.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ut.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ut.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=A0(e.data.value)),t}br(e,t,n){return ut.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return ut.resolve(r!==void 0&&r>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class uV{constructor(e){this.serializer=e}k(e,t,n,r){const s=new J1("createOrUpgrade",t);n<1&&r>=1&&((function(h){h.createObjectStore(Gm)})(e),(function(h){h.createObjectStore(pm,{keyPath:_j}),h.createObjectStore(Iu,{keyPath:kA,autoIncrement:!0}).createIndex(zd,CA,{unique:!0}),h.createObjectStore(mp)})(e),vE(e),(function(h){h.createObjectStore(Cd)})(e));let l=ut.resolve();return n<3&&r>=3&&(n!==0&&((function(h){h.deleteObjectStore(vp),h.deleteObjectStore(yp),h.deleteObjectStore($d)})(e),vE(e)),l=l.next((()=>(function(h){const f=h.store($d),x={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Gn.min().toTimestamp(),targetCount:0};return f.put(i1,x)})(s)))),n<4&&r>=4&&(n!==0&&(l=l.next((()=>(function(h,f){return f.store(Iu).J().next((p=>{h.deleteObjectStore(Iu),h.createObjectStore(Iu,{keyPath:kA,autoIncrement:!0}).createIndex(zd,CA,{unique:!0});const w=f.store(Iu),A=p.map((B=>w.put(B)));return ut.waitFor(A)}))})(e,s)))),l=l.next((()=>{(function(h){h.createObjectStore(_p,{keyPath:kj})})(e)}))),n<5&&r>=5&&(l=l.next((()=>this.yi(s)))),n<6&&r>=6&&(l=l.next((()=>((function(h){h.createObjectStore(gm)})(e),this.wi(s))))),n<7&&r>=7&&(l=l.next((()=>this.Si(s)))),n<8&&r>=8&&(l=l.next((()=>this.bi(e,s)))),n<9&&r>=9&&(l=l.next((()=>{(function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")})(e)}))),n<10&&r>=10&&(l=l.next((()=>this.Di(s)))),n<11&&r>=11&&(l=l.next((()=>{(function(h){h.createObjectStore(Z1,{keyPath:Cj})})(e),(function(h){h.createObjectStore(ev,{keyPath:Rj})})(e)}))),n<12&&r>=12&&(l=l.next((()=>{(function(h){const f=h.createObjectStore(tv,{keyPath:Fj});f.createIndex(sx,jj,{unique:!1}),f.createIndex(j3,Vj,{unique:!1})})(e)}))),n<13&&r>=13&&(l=l.next((()=>(function(h){const f=h.createObjectStore(n1,{keyPath:xj});f.createIndex(S0,wj),f.createIndex(P3,Sj)})(e))).next((()=>this.Ci(e,s))).next((()=>e.deleteObjectStore(Cd)))),n<14&&r>=14&&(l=l.next((()=>this.Fi(e,s)))),n<15&&r>=15&&(l=l.next((()=>(function(h){h.createObjectStore(N2,{keyPath:Dj,autoIncrement:!0}).createIndex(rx,Lj,{unique:!1}),h.createObjectStore(Kg,{keyPath:Nj}).createIndex(M3,Pj,{unique:!1}),h.createObjectStore(Wg,{keyPath:Oj}).createIndex(F3,Mj,{unique:!1})})(e)))),n<16&&r>=16&&(l=l.next((()=>{t.objectStore(Kg).clear()})).next((()=>{t.objectStore(Wg).clear()}))),n<17&&r>=17&&(l=l.next((()=>{(function(h){h.createObjectStore(P2,{keyPath:zj})})(e)}))),n<18&&r>=18&&DC()&&(l=l.next((()=>{t.objectStore(Kg).clear()})).next((()=>{t.objectStore(Wg).clear()}))),l}wi(e){let t=0;return e.store(Cd).ee(((n,r)=>{t+=d1(r)})).next((()=>{const n={byteSize:t};return e.store(gm).put(ix,n)}))}yi(e){const t=e.store(pm),n=e.store(Iu);return t.J().next((r=>ut.forEach(r,(s=>{const l=IDBKeyRange.bound([s.userId,Bd],[s.userId,s.lastAcknowledgedBatchId]);return n.J(zd,l).next((u=>ut.forEach(u,(h=>{jn(h.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:h.batchId});const f=Pd(this.serializer,h);return zR(e,s.userId,f).next((()=>{}))}))))}))))}Si(e){const t=e.store(vp),n=e.store(Cd);return e.store($d).get(i1).next((r=>{const s=[];return n.ee(((l,u)=>{const h=new Ar(l),f=(function(p){return[0,Fo(p)]})(h);s.push(t.get(f).next((x=>x?ut.resolve():(p=>t.put({targetId:0,path:Fo(p),sequenceNumber:r.highestListenSequenceNumber}))(h))))})).next((()=>ut.waitFor(s)))}))}bi(e,t){e.createObjectStore(mm,{keyPath:Ij});const n=t.store(mm),r=new q2,s=l=>{if(r.add(l)){const u=l.lastSegment(),h=l.popLast();return n.put({collectionId:u,parent:Fo(h)})}};return t.store(Cd).ee({X:!0},((l,u)=>{const h=new Ar(l);return s(h.popLast())})).next((()=>t.store(mp).ee({X:!0},(([l,u,h],f)=>{const x=Xu(u);return s(x.popLast())}))))}Di(e){const t=e.store(yp);return t.ee(((n,r)=>{const s=Vg(r),l=OR(this.serializer,s);return t.put(l)}))}Ci(e,t){const n=t.store(Cd),r=[];return n.ee(((s,l)=>{const u=t.store(n1),h=(function(p){return p.document?new en(Ar.fromString(p.document.name).popFirst(5)):p.noDocument?en.fromSegments(p.noDocument.path):p.unknownDocument?en.fromSegments(p.unknownDocument.path):xn(36783)})(l).path.toArray(),f={prefixPath:h.slice(0,h.length-2),collectionGroup:h[h.length-2],documentId:h[h.length-1],readTime:l.readTime||[0,0],unknownDocument:l.unknownDocument,noDocument:l.noDocument,document:l.document,hasCommittedMutations:!!l.hasCommittedMutations};r.push(u.put(f))})).next((()=>ut.waitFor(r)))}Fi(e,t){const n=t.store(Iu),r=KR(this.serializer),s=new X2(hv.mi,this.serializer.yt);return n.J().next((l=>{const u=new Map;return l.forEach((h=>{let f=u.get(h.userId)??Ni();Pd(this.serializer,h).keys().forEach((x=>f=f.add(x))),u.set(h.userId,f)})),ut.forEach(u,((h,f)=>{const x=new bo(f),p=uv.wt(this.serializer,x),w=s.getIndexManager(x),A=cv.wt(x,this.serializer,w,s.referenceDelegate);return new WR(r,A,p,w).recalculateAndSaveOverlaysForDocumentKeys(new ax(t,ru.ce),h).next()}))}))}}function vE(i){i.createObjectStore(vp,{keyPath:Aj}).createIndex(L2,Ej,{unique:!0}),i.createObjectStore(yp,{keyPath:"targetId"}).createIndex(O3,Tj,{unique:!0}),i.createObjectStore($d)}const Ch="IndexedDbPersistence",Z_=18e5,eb=5e3,tb="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cV="main";class J2{constructor(e,t,n,r,s,l,u,h,f,x,p=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=s,this.window=l,this.document=u,this.xi=f,this.Oi=x,this.Ni=p,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=w=>Promise.resolve(),!J2.v())throw new Xt(Rt.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new J7(this,r),this.$i=t+cV,this.serializer=new PR(h),this.Ui=new Kh(this.$i,this.Ni,new uV(this.serializer)),this.hi=new V7,this.Pi=new W7(this.referenceDelegate,this.serializer),this.remoteDocumentCache=KR(this.serializer),this.Ii=new j7,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,x===!1&&Qo(Ch,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Xt(Rt.FAILED_PRECONDITION,tb);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new ru(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Yy(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(fd(e))return zt(Ch,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return zt(Ch,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Sg(e).get(Nf).next((t=>ut.resolve(this.es(t))))}ts(e){return Yy(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Z_)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const n=Ua(t,_p);return n.J().next((r=>{const s=this.ss(r,Z_),l=r.filter((u=>s.indexOf(u)===-1));return ut.forEach(l,(u=>n.delete(u.clientId))).next((()=>l))}))})).catch((()=>[]));if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?ut.resolve(!0):Sg(e).get(Nf).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,eb)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new Xt(Rt.FAILED_PRECONDITION,tb);return!1}}return!(!this.networkEnabled||!this.inForeground)||Yy(e).J().next((n=>this.ss(n,eb).find((r=>{if(this.clientId!==r.clientId){const s=!this.networkEnabled&&r.networkEnabled,l=!this.inForeground&&r.inForeground,u=this.networkEnabled===r.networkEnabled;if(s||l&&u)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&zt(Ch,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Gm,_p],(e=>{const t=new ax(e,ru.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>Yy(e).J().next((t=>this.ss(t,Z_).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return cv.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new K7(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return uv.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){zt(Ch,"Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",s=(function(h){return h===18?$j:h===17?B3:h===16?Bj:h===15?O2:h===14?U3:h===13?z3:h===12?Uj:h===11?V3:void xn(60245)})(this.Ni);let l;return this.Ui.runTransaction(e,r,s,(u=>(l=new ax(u,this.ci?this.ci.next():ru.ce),t==="readwrite-primary"?this.Hi(l).next((h=>!!h||this.Yi(l))).next((h=>{if(!h)throw Qo(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new Xt(Rt.FAILED_PRECONDITION,R3);return n(l)})).next((h=>this.Xi(l).next((()=>h)))):this.Is(l).next((()=>n(l)))))).then((u=>(l.raiseOnCommittedEvent(),u)))}Is(e){return Sg(e).get(Nf).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,eb)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Xt(Rt.FAILED_PRECONDITION,tb)}))}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Sg(e).put(Nf,t)}static v(){return Kh.v()}Zi(e){const t=Sg(e);return t.get(Nf).next((n=>this.es(n)?(zt(Ch,"Releasing primary lease."),t.delete(Nf)):ut.resolve()))}rs(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Qo(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;RC()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{const t=this.Ki?.getItem(this._s(e))!==null;return zt(Ch,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Qo(Ch,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Qo("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Sg(i){return Ua(i,Gm)}function Yy(i){return Ua(i,_p)}function hV(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}class Q2{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=Ni(),r=Ni();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Q2(e,t.fromCache,n,r)}}class dV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class qR{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return RC()?8:L3(za())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ys(e,t).next((l=>{s.result=l})).next((()=>{if(!s.result)return this.ws(e,t,r,n).next((l=>{s.result=l}))})).next((()=>{if(s.result)return;const l=new dV;return this.Ss(e,t,l).next((u=>{if(s.result=u,this.Vs)return this.bs(e,t,l,u.size)}))})).next((()=>s.result))}bs(e,t,n,r){return n.documentReadCount<this.fs?($f()<=Ki.DEBUG&&zt("QueryEngine","SDK will not create cache indexes for query:",Hf(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ut.resolve()):($f()<=Ki.DEBUG&&zt("QueryEngine","Query:",Hf(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?($f()<=Ki.DEBUG&&zt("QueryEngine","The SDK decides to create cache indexes for query:",Hf(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lu(t))):ut.resolve())}ys(e,t){if(BA(t))return ut.resolve(null);let n=lu(t);return this.indexManager.getIndexType(e,n).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=px(t,null,"F"),n=lu(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const l=Ni(...s);return this.ps.getDocuments(e,l).next((u=>this.indexManager.getMinOffset(e,n).next((h=>{const f=this.Ds(t,u);return this.Cs(t,f,l,h.readTime)?this.ys(e,px(t,null,"F")):this.vs(e,f,t,h)}))))})))))}ws(e,t,n,r){return BA(t)||r.isEqual(Gn.min())?ut.resolve(null):this.ps.getDocuments(e,n).next((s=>{const l=this.Ds(t,s);return this.Cs(t,l,n,r)?ut.resolve(null):($f()<=Ki.DEBUG&&zt("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Hf(t)),this.vs(e,l,t,dj(r,hm)).next((u=>u)))}))}Ds(e,t){let n=new $r(lR(e));return t.forEach(((r,s)=>{qm(e,s)&&(n=n.add(s))})),n}Cs(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,n){return $f()<=Ki.DEBUG&&zt("QueryEngine","Using full collection scan to execute query:",Hf(t)),this.ps.getDocumentsMatchingQuery(e,t,Ul.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next((s=>(t.forEach((l=>{s=s.insert(l.key,l)})),s)))}}const Z2="LocalStore",fV=3e8;class pV{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new ma(hi),this.xs=new ih((s=>Qd(s)),Km),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new WR(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function YR(i,e,t,n){return new pV(i,e,t,n)}async function XR(i,e){const t=di(i);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next((s=>(r=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((s=>{const l=[],u=[];let h=Ni();for(const f of r){l.push(f.batchId);for(const x of f.mutations)h=h.add(x.key)}for(const f of s){u.push(f.batchId);for(const x of f.mutations)h=h.add(x.key)}return t.localDocuments.getDocuments(n,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:u})))}))}))}function gV(i,e){const t=di(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const r=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,f,x){const p=f.batch,w=p.keys();let A=ut.resolve();return w.forEach((B=>{A=A.next((()=>x.getEntry(h,B))).next(($=>{const W=f.docVersions.get(B);jn(W!==null,48541),$.version.compareTo(W)<0&&(p.applyToRemoteDocument($,f),$.isValidDocument()&&($.setReadTime(f.commitVersion),x.addEntry($)))}))})),A.next((()=>u.mutationQueue.removeMutationBatch(h,p)))})(t,n,e,s).next((()=>s.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let h=Ni();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(n,r)))}))}function JR(i){const e=di(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function mV(i,e){const t=di(i),n=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const l=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const u=[];e.targetChanges.forEach(((x,p)=>{const w=r.get(p);if(!w)return;u.push(t.Pi.removeMatchingKeys(s,x.removedDocuments,p).next((()=>t.Pi.addMatchingKeys(s,x.addedDocuments,p))));let A=w.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?A=A.withResumeToken(Ca.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):x.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(x.resumeToken,n)),r=r.insert(p,A),(function($,W,q){return $.resumeToken.approximateByteSize()===0||W.snapshotVersion.toMicroseconds()-$.snapshotVersion.toMicroseconds()>=fV?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0})(w,A,x)&&u.push(t.Pi.updateTargetData(s,A))}));let h=Fl(),f=Ni();if(e.documentUpdates.forEach((x=>{e.resolvedLimboDocuments.has(x)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,x))})),u.push(yV(s,l,e.documentUpdates).next((x=>{h=x.ks,f=x.qs}))),!n.isEqual(Gn.min())){const x=t.Pi.getLastRemoteSnapshotVersion(s).next((p=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,n)));u.push(x)}return ut.waitFor(u).next((()=>l.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,h,f))).next((()=>h))})).then((s=>(t.Ms=r,s)))}function yV(i,e,t){let n=Ni(),r=Ni();return t.forEach((s=>n=n.add(s))),e.getEntries(i,n).next((s=>{let l=Fl();return t.forEach(((u,h)=>{const f=s.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(r=r.add(u)),h.isNoDocument()&&h.version.isEqual(Gn.min())?(e.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(u,h)):zt(Z2,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:r}}))}function vV(i,e){const t=di(i);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Bd),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function _V(i,e){const t=di(i);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let r;return t.Pi.getTargetData(n,e).next((s=>s?(r=s,ut.resolve(r)):t.Pi.allocateTargetId(n).next((l=>(r=new Bc(e,l,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,r).next((()=>r)))))))})).then((n=>{const r=t.Ms.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function wx(i,e,t){const n=di(i),r=n.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,(l=>n.persistence.referenceDelegate.removeTarget(l,r)))}catch(l){if(!fd(l))throw l;zt(Z2,`Failed to update sequence numbers for target ${e}: ${l}`)}n.Ms=n.Ms.remove(e),n.xs.delete(r.target)}function _E(i,e,t){const n=di(i);let r=Gn.min(),s=Ni();return n.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,x){const p=di(h),w=p.xs.get(x);return w!==void 0?ut.resolve(p.Ms.get(w)):p.Pi.getTargetData(f,x)})(n,l,lu(e)).next((u=>{if(u)return r=u.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(l,u.targetId).next((h=>{s=h}))})).next((()=>n.Fs.getDocumentsMatchingQuery(l,e,t?r:Gn.min(),t?s:Ni()))).next((u=>(bV(n,r7(e),u),{documents:u,Qs:s})))))}function bV(i,e,t){let n=i.Os.get(e)||Gn.min();t.forEach(((r,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)})),i.Os.set(e,n)}class bE{constructor(){this.activeTargetIds=c7()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class QR{constructor(){this.Mo=new bE,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new bE,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class xV{Oo(e){}shutdown(){}}const xE="ConnectivityMonitor";class wE{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){zt(xE,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){zt(xE,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Xy=null;function Sx(){return Xy===null?Xy=(function(){return 268435456+Math.round(2147483648*Math.random())})():Xy++,"0x"+Xy.toString(16)}const nb="RestConnection",wV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class SV{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===r1?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,s){const l=Sx(),u=this.zo(e,t.toUriEncodedString());zt(nb,`Sending RPC '${e}' ${l}:`,u,n);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,r,s);const{host:f}=new URL(u),x=oc(f);return this.Jo(e,u,h,n,x).then((p=>(zt(nb,`Received RPC '${e}' ${l}: `,p),p)),(p=>{throw Xd(nb,`RPC '${e}' ${l} failed with error: `,p,"url: ",u,"request:",n),p}))}Ho(e,t,n,r,s,l){return this.Go(e,t,n,r,s)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+zp})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,s)=>e[s]=r)),n&&n.headers.forEach(((r,s)=>e[s]=r))}zo(e,t){const n=wV[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class TV{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ro="WebChannelConnection";class AV extends SV{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,s){const l=Sx();return new Promise(((u,h)=>{const f=new _3;f.setWithCredentials(!0),f.listenOnce(b3.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case b0.NO_ERROR:const p=f.getResponseJson();zt(Ro,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(p)),u(p);break;case b0.TIMEOUT:zt(Ro,`RPC '${e}' ${l} timed out`),h(new Xt(Rt.DEADLINE_EXCEEDED,"Request time out"));break;case b0.HTTP_ERROR:const w=f.getStatus();if(zt(Ro,`RPC '${e}' ${l} failed with status:`,w,"response text:",f.getResponseText()),w>0){let A=f.getResponseJson();Array.isArray(A)&&(A=A[0]);const B=A?.error;if(B&&B.status&&B.message){const $=(function(q){const ge=q.toLowerCase().replace(/_/g,"-");return Object.values(Rt).indexOf(ge)>=0?ge:Rt.UNKNOWN})(B.status);h(new Xt($,B.message))}else h(new Xt(Rt.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Xt(Rt.UNAVAILABLE,"Connection failed."));break;default:xn(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{zt(Ro,`RPC '${e}' ${l} completed.`)}}));const x=JSON.stringify(r);zt(Ro,`RPC '${e}' ${l} sending request:`,r),f.send(t,"POST",x,n,15)}))}T_(e,t,n){const r=Sx(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=S3(),u=w3(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,n),h.encodeInitMessageHeaders=!0;const x=s.join("");zt(Ro,`Creating RPC '${e}' stream ${r}: ${x}`,h);const p=l.createWebChannel(x,h);this.I_(p);let w=!1,A=!1;const B=new TV({Yo:W=>{A?zt(Ro,`Not sending because RPC '${e}' stream ${r} is closed:`,W):(w||(zt(Ro,`Opening RPC '${e}' stream ${r} transport.`),p.open(),w=!0),zt(Ro,`RPC '${e}' stream ${r} sending:`,W),p.send(W))},Zo:()=>p.close()}),$=(W,q,ge)=>{W.listen(q,(he=>{try{ge(he)}catch(me){setTimeout((()=>{throw me}),0)}}))};return $(p,Mg.EventType.OPEN,(()=>{A||(zt(Ro,`RPC '${e}' stream ${r} transport opened.`),B.o_())})),$(p,Mg.EventType.CLOSE,(()=>{A||(A=!0,zt(Ro,`RPC '${e}' stream ${r} transport closed`),B.a_(),this.E_(p))})),$(p,Mg.EventType.ERROR,(W=>{A||(A=!0,Xd(Ro,`RPC '${e}' stream ${r} transport errored. Name:`,W.name,"Message:",W.message),B.a_(new Xt(Rt.UNAVAILABLE,"The operation could not be completed")))})),$(p,Mg.EventType.MESSAGE,(W=>{if(!A){const q=W.data[0];jn(!!q,16349);const ge=q,he=ge?.error||ge[0]?.error;if(he){zt(Ro,`RPC '${e}' stream ${r} received error:`,he);const me=he.status;let Ce=(function(ee){const J=Ea[ee];if(J!==void 0)return bR(J)})(me),Ve=he.message;Ce===void 0&&(Ce=Rt.INTERNAL,Ve="Unknown error status: "+me+" with message "+he.message),A=!0,B.a_(new Xt(Ce,Ve)),p.close()}else zt(Ro,`RPC '${e}' stream ${r} received:`,q),B.u_(q)}})),$(u,x3.STAT_EVENT,(W=>{W.stat===ex.PROXY?zt(Ro,`RPC '${e}' stream ${r} detected buffering proxy`):W.stat===ex.NOPROXY&&zt(Ro,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{B.__()}),0),B}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function EV(){return typeof window<"u"?window:null}function R0(){return typeof document<"u"?document:null}function dv(i){return new I7(i,!0)}class ZR{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&zt("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const SE="PersistentStream";class eD{constructor(e,t,n,r,s,l,u,h){this.Mi=e,this.S_=n,this.b_=r,this.connection=s,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ZR(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Rt.RESOURCE_EXHAUSTED?(Qo(t.toString()),Qo("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Rt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,r])=>{this.D_===t&&this.G_(n,r)}),(n=>{e((()=>{const r=new Xt(Rt.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(r)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{n((()=>this.z_(r)))})),this.stream.onMessage((r=>{n((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return zt(SE,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(zt(SE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class IV extends eD{constructor(e,t,n,r,s,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,l),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=R7(this.serializer,e),n=(function(s){if(!("targetChange"in s))return Gn.min();const l=s.targetChange;return l.targetIds&&l.targetIds.length?Gn.min():l.readTime?el(l.readTime):Gn.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=yx(this.serializer),t.addTarget=(function(s,l){let u;const h=l.target;if(u=a1(h)?{documents:kR(s,h)}:{query:CR(s,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=SR(s,l.resumeToken);const f=gx(s,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(Gn.min())>0){u.readTime=Ep(s,l.snapshotVersion.toTimestamp());const f=gx(s,l.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const n=L7(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=yx(this.serializer),t.removeTarget=e,this.q_(t)}}class kV extends eD{constructor(e,t,n,r,s,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,l),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return jn(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,jn(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){jn(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=D7(e.writeResults,e.commitTime),n=el(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=yx(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>u1(this.serializer,n)))};this.q_(t)}}class CV{}class RV extends CV{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new Xt(Rt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,l])=>this.connection.Go(e,mx(t,n),r,s,l))).catch((s=>{throw s.name==="FirebaseError"?(s.code===Rt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new Xt(Rt.UNKNOWN,s.toString())}))}Ho(e,t,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,u])=>this.connection.Ho(e,mx(t,n),r,l,u,s))).catch((l=>{throw l.name==="FirebaseError"?(l.code===Rt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Xt(Rt.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class DV{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Qo(t),this.aa=!1):zt("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const nf="RemoteStore";class LV{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((l=>{n.enqueueAndForget((async()=>{ff(this)&&(zt(nf,"Restarting streams for network reachability change."),await(async function(h){const f=di(h);f.Ea.add(4),await Xm(f),f.Ra.set("Unknown"),f.Ea.delete(4),await fv(f)})(this))}))})),this.Ra=new DV(n,r)}}async function fv(i){if(ff(i))for(const e of i.da)await e(!0)}async function Xm(i){for(const e of i.da)await e(!1)}function tD(i,e){const t=di(i);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),iw(t)?nw(t):Bp(t).O_()&&tw(t,e))}function ew(i,e){const t=di(i),n=Bp(t);t.Ia.delete(e),n.O_()&&nD(t,e),t.Ia.size===0&&(n.O_()?n.L_():ff(t)&&t.Ra.set("Unknown"))}function tw(i,e){if(i.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Gn.min())>0){const t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bp(i).Y_(e)}function nD(i,e){i.Va.Ue(e),Bp(i).Z_(e)}function nw(i){i.Va=new S7({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),At:e=>i.Ia.get(e)||null,ht:()=>i.datastore.serializer.databaseId}),Bp(i).start(),i.Ra.ua()}function iw(i){return ff(i)&&!Bp(i).x_()&&i.Ia.size>0}function ff(i){return di(i).Ea.size===0}function iD(i){i.Va=void 0}async function NV(i){i.Ra.set("Online")}async function PV(i){i.Ia.forEach(((e,t)=>{tw(i,e)}))}async function OV(i,e){iD(i),iw(i)?(i.Ra.ha(e),nw(i)):i.Ra.set("Unknown")}async function MV(i,e,t){if(i.Ra.set("Online"),e instanceof wR&&e.state===2&&e.cause)try{await(async function(r,s){const l=s.cause;for(const u of s.targetIds)r.Ia.has(u)&&(await r.remoteSyncer.rejectListen(u,l),r.Ia.delete(u),r.Va.removeTarget(u))})(i,e)}catch(n){zt(nf,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await p1(i,n)}else if(e instanceof k0?i.Va.Ze(e):e instanceof xR?i.Va.st(e):i.Va.tt(e),!t.isEqual(Gn.min()))try{const n=await JR(i.localStore);t.compareTo(n)>=0&&await(function(s,l){const u=s.Va.Tt(l);return u.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const x=s.Ia.get(f);x&&s.Ia.set(f,x.withResumeToken(h.resumeToken,l))}})),u.targetMismatches.forEach(((h,f)=>{const x=s.Ia.get(h);if(!x)return;s.Ia.set(h,x.withResumeToken(Ca.EMPTY_BYTE_STRING,x.snapshotVersion)),nD(s,h);const p=new Bc(x.target,h,f,x.sequenceNumber);tw(s,p)})),s.remoteSyncer.applyRemoteEvent(u)})(i,t)}catch(n){zt(nf,"Failed to raise snapshot:",n),await p1(i,n)}}async function p1(i,e,t){if(!fd(e))throw e;i.Ea.add(1),await Xm(i),i.Ra.set("Offline"),t||(t=()=>JR(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{zt(nf,"Retrying IndexedDB access"),await t(),i.Ea.delete(1),await fv(i)}))}function rD(i,e){return e().catch((t=>p1(i,t,e)))}async function Jm(i){const e=di(i),t=id(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Bd;for(;FV(e);)try{const r=await vV(e.localStore,n);if(r===null){e.Ta.length===0&&t.L_();break}n=r.batchId,jV(e,r)}catch(r){await p1(e,r)}sD(e)&&aD(e)}function FV(i){return ff(i)&&i.Ta.length<10}function jV(i,e){i.Ta.push(e);const t=id(i);t.O_()&&t.X_&&t.ea(e.mutations)}function sD(i){return ff(i)&&!id(i).x_()&&i.Ta.length>0}function aD(i){id(i).start()}async function VV(i){id(i).ra()}async function zV(i){const e=id(i);for(const t of i.Ta)e.ea(t.mutations)}async function UV(i,e,t){const n=i.Ta.shift(),r=$2.from(n,e,t);await rD(i,(()=>i.remoteSyncer.applySuccessfulWrite(r))),await Jm(i)}async function BV(i,e){e&&id(i).X_&&await(async function(n,r){if((function(l){return b7(l)&&l!==Rt.ABORTED})(r.code)){const s=n.Ta.shift();id(n).B_(),await rD(n,(()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r))),await Jm(n)}})(i,e),sD(i)&&aD(i)}async function TE(i,e){const t=di(i);t.asyncQueue.verifyOperationInProgress(),zt(nf,"RemoteStore received new credentials");const n=ff(t);t.Ea.add(3),await Xm(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await fv(t)}async function $V(i,e){const t=di(i);e?(t.Ea.delete(2),await fv(t)):e||(t.Ea.add(2),await Xm(t),t.Ra.set("Unknown"))}function Bp(i){return i.ma||(i.ma=(function(t,n,r){const s=di(t);return s.sa(),new IV(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)})(i.datastore,i.asyncQueue,{Xo:NV.bind(null,i),t_:PV.bind(null,i),r_:OV.bind(null,i),H_:MV.bind(null,i)}),i.da.push((async e=>{e?(i.ma.B_(),iw(i)?nw(i):i.Ra.set("Unknown")):(await i.ma.stop(),iD(i))}))),i.ma}function id(i){return i.fa||(i.fa=(function(t,n,r){const s=di(t);return s.sa(),new kV(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:VV.bind(null,i),r_:BV.bind(null,i),ta:zV.bind(null,i),na:UV.bind(null,i)}),i.da.push((async e=>{e?(i.fa.B_(),await Jm(i)):(await i.fa.stop(),i.Ta.length>0&&(zt(nf,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}class rw{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new nc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const l=Date.now()+n,u=new rw(e,t,l,r,s);return u.start(n),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Xt(Rt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sw(i,e){if(Qo("AsyncQueue",`${e}: ${i}`),fd(i))return new Xt(Rt.UNAVAILABLE,`${e}: ${i}`);throw i}class sp{static emptySet(e){return new sp(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||en.comparator(t.key,n.key):(t,n)=>en.comparator(t.key,n.key),this.keyedMap=Fg(),this.sortedSet=new ma(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sp)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new sp;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class AE{constructor(){this.ga=new ma(en.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):xn(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Ip{constructor(e,t,n,r,s,l,u,h,f){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,n,r,s){const l=[];return t.forEach((u=>{l.push({type:0,doc:u})})),new Ip(e,t,sp.emptySet(t),l,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class HV{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class GV{constructor(){this.queries=EE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const r=di(t),s=r.queries;r.queries=EE(),s.forEach(((l,u)=>{for(const h of u.Sa)h.onError(n)}))})(this,new Xt(Rt.ABORTED,"Firestore shutting down"))}}function EE(){return new ih((i=>oR(i)),sv)}async function oD(i,e){const t=di(i);let n=3;const r=e.query;let s=t.queries.get(r);s?!s.ba()&&e.Da()&&(n=2):(s=new HV,n=e.Da()?0:1);try{switch(n){case 0:s.wa=await t.onListen(r,!0);break;case 1:s.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(l){const u=sw(l,`Initialization of query '${Hf(e.query)}' failed`);return void e.onError(u)}t.queries.set(r,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&aw(t)}async function lD(i,e){const t=di(i),n=e.query;let r=3;const s=t.queries.get(n);if(s){const l=s.Sa.indexOf(e);l>=0&&(s.Sa.splice(l,1),s.Sa.length===0?r=e.Da()?0:1:!s.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function KV(i,e){const t=di(i);let n=!1;for(const r of e){const s=r.query,l=t.queries.get(s);if(l){for(const u of l.Sa)u.Fa(r)&&(n=!0);l.wa=r}}n&&aw(t)}function WV(i,e,t){const n=di(i),r=n.queries.get(e);if(r)for(const s of r.Sa)s.onError(t);n.queries.delete(e)}function aw(i){i.Ca.forEach((e=>{e.next()}))}var Tx,IE;(IE=Tx||(Tx={})).Ma="default",IE.Cache="cache";class uD{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new Ip(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ip.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Tx.Cache}}class cD{constructor(e){this.key=e}}class hD{constructor(e){this.key=e}}class qV{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ni(),this.mutatedKeys=Ni(),this.eu=lR(e),this.tu=new sp(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new AE,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,l=r,u=!1;const h=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,f=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((x,p)=>{const w=r.get(x),A=qm(this.query,p)?p:null,B=!!w&&this.mutatedKeys.has(w.key),$=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let W=!1;w&&A?w.data.isEqual(A.data)?B!==$&&(n.track({type:3,doc:A}),W=!0):this.su(w,A)||(n.track({type:2,doc:A}),W=!0,(h&&this.eu(A,h)>0||f&&this.eu(A,f)<0)&&(u=!0)):!w&&A?(n.track({type:0,doc:A}),W=!0):w&&!A&&(n.track({type:1,doc:w}),W=!0,(h||f)&&(u=!0)),W&&(A?(l=l.add(A),s=$?s.add(x):s.delete(x)):(l=l.delete(x),s=s.delete(x)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const x=this.query.limitType==="F"?l.last():l.first();l=l.delete(x.key),s=s.delete(x.key),n.track({type:1,doc:x})}return{tu:l,iu:n,Cs:u,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((x,p)=>(function(A,B){const $=W=>{switch(W){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xn(20277,{Rt:W})}};return $(A)-$(B)})(x.type,p.type)||this.eu(x.doc,p.doc))),this.ou(n),r=r??!1;const u=t&&!r?this._u():[],h=this.Xa.size===0&&this.current&&!r?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new Ip(this.query,e.tu,s,l,e.mutatedKeys,h===0,f,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new AE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ni(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new hD(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new cD(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=Ni();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ip.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ow="SyncEngine";class YV{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class XV{constructor(e){this.key=e,this.hu=!1}}class JV{constructor(e,t,n,r,s,l){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new ih((u=>oR(u)),sv),this.Iu=new Map,this.Eu=new Set,this.du=new ma(en.comparator),this.Au=new Map,this.Ru=new Y2,this.Vu={},this.mu=new Map,this.fu=tf.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function QV(i,e,t=!0){const n=yD(i);let r;const s=n.Tu.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await dD(n,e,t,!0),r}async function ZV(i,e){const t=yD(i);await dD(t,e,!0,!1)}async function dD(i,e,t,n){const r=await _V(i.localStore,lu(e)),s=r.targetId,l=i.sharedClientState.addLocalQueryTarget(s,t);let u;return n&&(u=await e9(i,e,s,l==="current",r.resumeToken)),i.isPrimaryClient&&t&&tD(i.remoteStore,r),u}async function e9(i,e,t,n,r){i.pu=(p,w,A)=>(async function($,W,q,ge){let he=W.view.ru(q);he.Cs&&(he=await _E($.localStore,W.query,!1).then((({documents:pe})=>W.view.ru(pe,he))));const me=ge&&ge.targetChanges.get(W.targetId),Ce=ge&&ge.targetMismatches.get(W.targetId)!=null,Ve=W.view.applyChanges(he,$.isPrimaryClient,me,Ce);return CE($,W.targetId,Ve.au),Ve.snapshot})(i,p,w,A);const s=await _E(i.localStore,e,!0),l=new qV(e,s.Qs),u=l.ru(s.documents),h=Ym.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",r),f=l.applyChanges(u,i.isPrimaryClient,h);CE(i,t,f.au);const x=new YV(e,t,l);return i.Tu.set(e,x),i.Iu.has(t)?i.Iu.get(t).push(e):i.Iu.set(t,[e]),f.snapshot}async function t9(i,e,t){const n=di(i),r=n.Tu.get(e),s=n.Iu.get(r.targetId);if(s.length>1)return n.Iu.set(r.targetId,s.filter((l=>!sv(l,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await wx(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),t&&ew(n.remoteStore,r.targetId),Ax(n,r.targetId)})).catch(hf)):(Ax(n,r.targetId),await wx(n.localStore,r.targetId,!0))}async function n9(i,e){const t=di(i),n=t.Tu.get(e),r=t.Iu.get(n.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ew(t.remoteStore,n.targetId))}async function i9(i,e,t){const n=vD(i);try{const r=await(function(l,u){const h=di(l),f=Ur.now(),x=u.reduce(((A,B)=>A.add(B.key)),Ni());let p,w;return h.persistence.runTransaction("Locally write mutations","readwrite",(A=>{let B=Fl(),$=Ni();return h.Ns.getEntries(A,x).next((W=>{B=W,B.forEach(((q,ge)=>{ge.isValidDocument()||($=$.add(q))}))})).next((()=>h.localDocuments.getOverlayedDocuments(A,B))).next((W=>{p=W;const q=[];for(const ge of u){const he=v7(ge,p.get(ge.key).overlayedDocument);he!=null&&q.push(new pd(ge.key,he,Q3(he.value.mapValue),jl.exists(!0)))}return h.mutationQueue.addMutationBatch(A,f,q,u)})).next((W=>{w=W;const q=W.applyToLocalDocumentSet(p,$);return h.documentOverlayCache.saveOverlays(A,W.batchId,q)}))})).then((()=>({batchId:w.batchId,changes:cR(p)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),(function(l,u,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new ma(hi)),f=f.insert(u,h),l.Vu[l.currentUser.toKey()]=f})(n,r.batchId,t),await Qm(n,r.changes),await Jm(n.remoteStore)}catch(r){const s=sw(r,"Failed to persist write");t.reject(s)}}async function fD(i,e){const t=di(i);try{const n=await mV(t.localStore,e);e.targetChanges.forEach(((r,s)=>{const l=t.Au.get(s);l&&(jn(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?l.hu=!0:r.modifiedDocuments.size>0?jn(l.hu,14607):r.removedDocuments.size>0&&(jn(l.hu,42227),l.hu=!1))})),await Qm(t,n,e)}catch(n){await hf(n)}}function kE(i,e,t){const n=di(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const r=[];n.Tu.forEach(((s,l)=>{const u=l.view.va(e);u.snapshot&&r.push(u.snapshot)})),(function(l,u){const h=di(l);h.onlineState=u;let f=!1;h.queries.forEach(((x,p)=>{for(const w of p.Sa)w.va(u)&&(f=!0)})),f&&aw(h)})(n.eventManager,e),r.length&&n.Pu.H_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function r9(i,e,t){const n=di(i);n.sharedClientState.updateQueryState(e,"rejected",t);const r=n.Au.get(e),s=r&&r.key;if(s){let l=new ma(en.comparator);l=l.insert(s,ea.newNoDocument(s,Gn.min()));const u=Ni().add(s),h=new lv(Gn.min(),new Map,new ma(hi),l,u);await fD(n,h),n.du=n.du.remove(s),n.Au.delete(e),lw(n)}else await wx(n.localStore,e,!1).then((()=>Ax(n,e,t))).catch(hf)}async function s9(i,e){const t=di(i),n=e.batch.batchId;try{const r=await gV(t.localStore,e);gD(t,n,null),pD(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Qm(t,r)}catch(r){await hf(r)}}async function a9(i,e,t){const n=di(i);try{const r=await(function(l,u){const h=di(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let x;return h.mutationQueue.lookupMutationBatch(f,u).next((p=>(jn(p!==null,37113),x=p.keys(),h.mutationQueue.removeMutationBatch(f,p)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,x,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,x))).next((()=>h.localDocuments.getDocuments(f,x)))}))})(n.localStore,e);gD(n,e,t),pD(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Qm(n,r)}catch(r){await hf(r)}}function pD(i,e){(i.mu.get(e)||[]).forEach((t=>{t.resolve()})),i.mu.delete(e)}function gD(i,e,t){const n=di(i);let r=n.Vu[n.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),n.Vu[n.currentUser.toKey()]=r}}function Ax(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const n of i.Iu.get(e))i.Tu.delete(n),t&&i.Pu.yu(n,t);i.Iu.delete(e),i.isPrimaryClient&&i.Ru.jr(e).forEach((n=>{i.Ru.containsKey(n)||mD(i,n)}))}function mD(i,e){i.Eu.delete(e.path.canonicalString());const t=i.du.get(e);t!==null&&(ew(i.remoteStore,t),i.du=i.du.remove(e),i.Au.delete(t),lw(i))}function CE(i,e,t){for(const n of t)n instanceof cD?(i.Ru.addReference(n.key,e),o9(i,n)):n instanceof hD?(zt(ow,"Document no longer in limbo: "+n.key),i.Ru.removeReference(n.key,e),i.Ru.containsKey(n.key)||mD(i,n.key)):xn(19791,{wu:n})}function o9(i,e){const t=e.key,n=t.path.canonicalString();i.du.get(t)||i.Eu.has(n)||(zt(ow,"New document in limbo: "+t),i.Eu.add(n),lw(i))}function lw(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const e=i.Eu.values().next().value;i.Eu.delete(e);const t=new en(Ar.fromString(e)),n=i.fu.next();i.Au.set(n,new XV(t)),i.du=i.du.insert(t,n),tD(i.remoteStore,new Bc(lu(rv(t.path)),n,"TargetPurposeLimboResolution",ru.ce))}}async function Qm(i,e,t){const n=di(i),r=[],s=[],l=[];n.Tu.isEmpty()||(n.Tu.forEach(((u,h)=>{l.push(n.pu(h,e,t).then((f=>{if((f||t)&&n.isPrimaryClient){const x=f?!f.fromCache:t?.targetChanges.get(h.targetId)?.current;n.sharedClientState.updateQueryState(h.targetId,x?"current":"not-current")}if(f){r.push(f);const x=Q2.As(h.targetId,f);s.push(x)}})))})),await Promise.all(l),n.Pu.H_(r),await(async function(h,f){const x=di(h);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>ut.forEach(f,(w=>ut.forEach(w.Es,(A=>x.persistence.referenceDelegate.addReference(p,w.targetId,A))).next((()=>ut.forEach(w.ds,(A=>x.persistence.referenceDelegate.removeReference(p,w.targetId,A)))))))))}catch(p){if(!fd(p))throw p;zt(Z2,"Failed to update sequence numbers: "+p)}for(const p of f){const w=p.targetId;if(!p.fromCache){const A=x.Ms.get(w),B=A.snapshotVersion,$=A.withLastLimboFreeSnapshotVersion(B);x.Ms=x.Ms.insert(w,$)}}})(n.localStore,s))}async function l9(i,e){const t=di(i);if(!t.currentUser.isEqual(e)){zt(ow,"User change. New user:",e.toKey());const n=await XR(t.localStore,e);t.currentUser=e,(function(s,l){s.mu.forEach((u=>{u.forEach((h=>{h.reject(new Xt(Rt.CANCELLED,l))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Qm(t,n.Ls)}}function u9(i,e){const t=di(i),n=t.Au.get(e);if(n&&n.hu)return Ni().add(n.key);{let r=Ni();const s=t.Iu.get(e);if(!s)return r;for(const l of s){const u=t.Tu.get(l);r=r.unionWith(u.view.nu)}return r}}function yD(i){const e=di(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=fD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=u9.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=r9.bind(null,e),e.Pu.H_=KV.bind(null,e.eventManager),e.Pu.yu=WV.bind(null,e.eventManager),e}function vD(i){const e=di(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=s9.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=a9.bind(null,e),e}class Sm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dv(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return YR(this.persistence,new qR,e.initialUser,this.serializer)}Cu(e){return new X2(hv.mi,this.serializer)}Du(e){return new QR}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Sm.provider={build:()=>new Sm};class c9 extends Sm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){jn(this.persistence.referenceDelegate instanceof f1,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new $R(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Oo.withCacheSize(this.cacheSizeBytes):Oo.DEFAULT;return new X2((n=>f1.mi(n,t)),this.serializer)}}class h9 extends Sm{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await vD(this.xu.syncEngine),await Jm(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return YR(this.persistence,new qR,e.initialUser,this.serializer)}Fu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new $R(n,e.asyncQueue,t)}Mu(e,t){const n=new mj(t,this.persistence);return new gj(e.asyncQueue,n)}Cu(e){const t=hV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Oo.withCacheSize(this.cacheSizeBytes):Oo.DEFAULT;return new J2(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,EV(),R0(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new QR}}class g1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>kE(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=l9.bind(null,this.syncEngine),await $V(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new GV})()}createDatastore(e){const t=dv(e.databaseInfo.databaseId),n=(function(s){return new AV(s)})(e.databaseInfo);return(function(s,l,u,h){return new RV(s,l,u,h)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,r,s,l,u){return new LV(n,r,s,l,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>kE(this.syncEngine,t,0)),(function(){return wE.v()?new wE:new xV})())}createSyncEngine(e,t){return(function(r,s,l,u,h,f,x){const p=new JV(r,s,l,u,h,f);return x&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=di(t);zt(nf,"RemoteStore shutting down."),n.Ea.add(5),await Xm(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}g1.provider={build:()=>new g1};class _D{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Qo("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const rd="FirestoreClient";class d9{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=bo.UNAUTHENTICATED,this.clientId=C2.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async l=>{zt(rd,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(n,(l=>(zt(rd,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new nc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=sw(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function ib(i,e){i.asyncQueue.verifyOperationInProgress(),zt(rd,"Initializing OfflineComponentProvider");const t=i.configuration;await e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener((async r=>{n.isEqual(r)||(await XR(e.localStore,r),n=r)})),e.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=e}async function RE(i,e){i.asyncQueue.verifyOperationInProgress();const t=await f9(i);zt(rd,"Initializing OnlineComponentProvider"),await e.initialize(t,i.configuration),i.setCredentialChangeListener((n=>TE(e.remoteStore,n))),i.setAppCheckTokenChangeListener(((n,r)=>TE(e.remoteStore,r))),i._onlineComponents=e}async function f9(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){zt(rd,"Using user provided OfflineComponentProvider");try{await ib(i,i._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===Rt.FAILED_PRECONDITION||r.code===Rt.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Xd("Error using user provided cache. Falling back to memory cache: "+t),await ib(i,new Sm)}}else zt(rd,"Using default OfflineComponentProvider"),await ib(i,new c9(void 0));return i._offlineComponents}async function bD(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(zt(rd,"Using user provided OnlineComponentProvider"),await RE(i,i._uninitializedComponentsProvider._online)):(zt(rd,"Using default OnlineComponentProvider"),await RE(i,new g1))),i._onlineComponents}function p9(i){return bD(i).then((e=>e.syncEngine))}async function xD(i){const e=await bD(i),t=e.eventManager;return t.onListen=QV.bind(null,e.syncEngine),t.onUnlisten=t9.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=ZV.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=n9.bind(null,e.syncEngine),t}function g9(i,e,t={}){const n=new nc;return i.asyncQueue.enqueueAndForget((async()=>(function(s,l,u,h,f){const x=new _D({next:w=>{x.Nu(),l.enqueueAndForget((()=>lD(s,p)));const A=w.docs.has(u);!A&&w.fromCache?f.reject(new Xt(Rt.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&w.fromCache&&h&&h.source==="server"?f.reject(new Xt(Rt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(w)},error:w=>f.reject(w)}),p=new uD(rv(u.path),x,{includeMetadataChanges:!0,qa:!0});return oD(s,p)})(await xD(i),i.asyncQueue,e,t,n))),n.promise}function m9(i,e,t={}){const n=new nc;return i.asyncQueue.enqueueAndForget((async()=>(function(s,l,u,h,f){const x=new _D({next:w=>{x.Nu(),l.enqueueAndForget((()=>lD(s,p))),w.fromCache&&h.source==="server"?f.reject(new Xt(Rt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(w)},error:w=>f.reject(w)}),p=new uD(u,x,{includeMetadataChanges:!0,qa:!0});return oD(s,p)})(await xD(i),i.asyncQueue,e,t,n))),n.promise}function wD(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}const DE=new Map;const SD="firestore.googleapis.com",LE=!0;class NE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Xt(Rt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=SD,this.ssl=LE}else this.host=e.host,this.ssl=e.ssl??LE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=VR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<q7)throw new Xt(Rt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hj("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wD(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new Xt(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new Xt(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new Xt(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,r){return n.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pv{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new NE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xt(Rt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Xt(Rt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new NE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new tj;switch(n.type){case"firstParty":return new sj(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Xt(Rt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=DE.get(t);n&&(zt("ComponentProvider","Removing Datastore"),DE.delete(t),n.terminate())})(this),Promise.resolve()}}function y9(i,e,t,n={}){i=ed(i,pv);const r=oc(e),s=i._getSettings(),l={...s,emulatorOptions:i._getEmulatorOptions()},u=`${e}:${t}`;r&&(z1(`https://${u}`),U1("Firestore",!0)),s.host!==SD&&s.host!==u&&Xd("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...s,host:u,ssl:r,emulatorOptions:n};if(!Qh(h,l)&&(i._setSettings(h),n.mockUserToken)){let f,x;if(typeof n.mockUserToken=="string")f=n.mockUserToken,x=bo.MOCK_USER;else{f=p2(n.mockUserToken,i._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new Xt(Rt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");x=new bo(p)}i._authCredentials=new nj(new A3(f,x))}}class $p{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new $p(this.firestore,e,this._query)}}class ka{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ka(this.firestore,e,this._key)}toJSON(){return{type:ka._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Hm(t,ka._jsonSchema))return new ka(e,n||null,new en(Ar.fromString(t.referencePath)))}}ka._jsonSchemaVersion="firestore/documentReference/1.0",ka._jsonSchema={type:Ia("string",ka._jsonSchemaVersion),referencePath:Ia("string")};class qh extends $p{constructor(e,t,n){super(e,t,rv(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ka(this.firestore,null,new en(e))}withConverter(e){return new qh(this.firestore,e,this._path)}}function v9(i,e,...t){if(i=us(i),I3("collection","path",e),i instanceof pv){const n=Ar.fromString(e,...t);return SA(n),new qh(i,null,n)}{if(!(i instanceof ka||i instanceof qh))throw new Xt(Rt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(Ar.fromString(e,...t));return SA(n),new qh(i.firestore,null,n)}}function Jy(i,e,...t){if(i=us(i),arguments.length===1&&(e=C2.newId()),I3("doc","path",e),i instanceof pv){const n=Ar.fromString(e,...t);return wA(n),new ka(i,null,new en(n))}{if(!(i instanceof ka||i instanceof qh))throw new Xt(Rt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(Ar.fromString(e,...t));return wA(n),new ka(i.firestore,i instanceof qh?i.converter:null,new en(n))}}const PE="AsyncQueue";class OE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ZR(this,"async_queue_retry"),this._c=()=>{const n=R0();n&&zt(PE,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=R0();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=R0();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new nc;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!fd(e))throw e;zt(PE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,Qo("INTERNAL UNHANDLED ERROR: ",ME(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=rw.createAndSchedule(this,e,t,n,(s=>this.hc(s)));return this.tc.push(r),r}uc(){this.nc&&xn(47125,{Pc:ME(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ME(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}class Zm extends pv{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new OE,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new OE(e),this._firestoreClient=void 0,await e}}}function TD(i,e){const t=typeof i=="object"?i:K1(),n=typeof i=="string"?i:r1,r=Vm(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const s=f2("firestore");s&&y9(r,...s)}return r}function uw(i){if(i._terminated)throw new Xt(Rt.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||AD(i),i._firestoreClient}function AD(i){const e=i._freezeSettings(),t=(function(r,s,l,u){return new Gj(r,s,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,wD(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(i._databaseId,i._app?.options.appId||"",i._persistenceKey,e);i._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(i._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),i._firestoreClient=new d9(i._authCredentials,i._appCheckCredentials,i._queue,t,i._componentsProvider&&(function(r){const s=r?._online.build();return{_offline:r?._offline.build(s),_online:s}})(i._componentsProvider))}function _9(i,e){Xd("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=i._freezeSettings();return b9(i,g1.provider,{build:n=>new h9(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function b9(i,e,t){if((i=ed(i,Zm))._firestoreClient||i._terminated)throw new Xt(Rt.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(i._componentsProvider||i._getSettings().localCache)throw new Xt(Rt.FAILED_PRECONDITION,"SDK cache is already specified.");i._componentsProvider={_online:e,_offline:t},AD(i)}class iu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new iu(Ca.fromBase64String(e))}catch(t){throw new Xt(Rt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new iu(Ca.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:iu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Hm(e,iu._jsonSchema))return iu.fromBase64String(e.bytes)}}iu._jsonSchemaVersion="firestore/bytes/1.0",iu._jsonSchema={type:Ia("string",iu._jsonSchemaVersion),bytes:Ia("string")};class cw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Xt(Rt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ps(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ED{constructor(e){this._methodName=e}}class ic{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Xt(Rt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Xt(Rt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return hi(this._lat,e._lat)||hi(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ic._jsonSchemaVersion}}static fromJSON(e){if(Hm(e,ic._jsonSchema))return new ic(e.latitude,e.longitude)}}ic._jsonSchemaVersion="firestore/geoPoint/1.0",ic._jsonSchema={type:Ia("string",ic._jsonSchemaVersion),latitude:Ia("number"),longitude:Ia("number")};class rc{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,r){if(n.length!==r.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:rc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Hm(e,rc._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new rc(e.vectorValues);throw new Xt(Rt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}rc._jsonSchemaVersion="firestore/vectorValue/1.0",rc._jsonSchema={type:Ia("string",rc._jsonSchemaVersion),vectorValues:Ia("object")};const x9=/^__.*__$/;class w9{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new pd(e,this.data,this.fieldMask,t,this.fieldTransforms):new Up(e,this.data,t,this.fieldTransforms)}}function ID(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xn(40011,{Ac:i})}}class hw{constructor(e,t,n,r,s,l){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new hw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return m1(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(ID(this.Ac)&&x9.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class S9{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||dv(e)}Cc(e,t,n,r=!1){return new hw({Ac:e,methodName:t,Dc:n,path:Ps.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function kD(i){const e=i._freezeSettings(),t=dv(i._databaseId);return new S9(i._databaseId,!!e.ignoreUndefinedProperties,t)}function T9(i,e,t,n,r,s={}){const l=i.Cc(s.merge||s.mergeFields?2:0,e,t,r);DD("Data must be an object, but it was:",l,n);const u=CD(n,l);let h,f;if(s.merge)h=new su(l.fieldMask),f=l.fieldTransforms;else if(s.mergeFields){const x=[];for(const p of s.mergeFields){const w=E9(e,p,t);if(!l.contains(w))throw new Xt(Rt.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);k9(x,w)||x.push(w)}h=new su(x),f=l.fieldTransforms.filter((p=>h.covers(p.field)))}else h=null,f=l.fieldTransforms;return new w9(new gl(u),h,f)}function A9(i,e,t,n=!1){return dw(t,i.Cc(n?4:3,e))}function dw(i,e){if(RD(i=us(i)))return DD("Unsupported field value:",e,i),CD(i,e);if(i instanceof ED)return(function(n,r){if(!ID(r.Ac))throw r.Sc(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)})(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,r){const s=[];let l=0;for(const u of n){let h=dw(u,r.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),s.push(h),l++}return{arrayValue:{values:s}}})(i,e)}return(function(n,r){if((n=us(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return h7(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=Ur.fromDate(n);return{timestampValue:Ep(r.serializer,s)}}if(n instanceof Ur){const s=new Ur(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ep(r.serializer,s)}}if(n instanceof ic)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof iu)return{bytesValue:SR(r.serializer,n._byteString)};if(n instanceof ka){const s=r.databaseId,l=n.firestore._databaseId;if(!l.isEqual(s))throw r.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:K2(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof rc)return(function(l,u){return{mapValue:{fields:{[F2]:{stringValue:j2},[bp]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw u.Sc("VectorValues must only contain numeric values.");return z2(u.serializer,f)}))}}}}}})(n,r);throw r.Sc(`Unsupported field value: ${X1(n)}`)})(i,e)}function CD(i,e){const t={};return $3(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):df(i,((n,r)=>{const s=dw(r,e.mc(n));s!=null&&(t[n]=s)})),{mapValue:{fields:t}}}function RD(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Ur||i instanceof ic||i instanceof iu||i instanceof ka||i instanceof ED||i instanceof rc)}function DD(i,e,t){if(!RD(t)||!k3(t)){const n=X1(t);throw n==="an object"?e.Sc(i+" a custom object"):e.Sc(i+" "+n)}}function E9(i,e,t){if((e=us(e))instanceof cw)return e._internalPath;if(typeof e=="string")return LD(i,e);throw m1("Field path arguments must be of type string or ",i,!1,void 0,t)}const I9=new RegExp("[~\\*/\\[\\]]");function LD(i,e,t){if(e.search(I9)>=0)throw m1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new cw(...e.split("."))._internalPath}catch{throw m1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function m1(i,e,t,n,r){const s=n&&!n.isEmpty(),l=r!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(s||l)&&(h+=" (found",s&&(h+=` in field ${n}`),l&&(h+=` in document ${r}`),h+=")"),new Xt(Rt.INVALID_ARGUMENT,u+i+h)}function k9(i,e){return i.some((t=>t.isEqual(e)))}class ND{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ka(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new C9(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(PD("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class C9 extends ND{data(){return super.data()}}function PD(i,e){return typeof e=="string"?LD(i,e):e instanceof cw?e._internalPath:e._delegate._internalPath}function R9(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new Xt(Rt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fw{}class D9 extends fw{}function L9(i,e,...t){let n=[];e instanceof fw&&n.push(e),n=n.concat(t),(function(s){const l=s.filter((h=>h instanceof gw)).length,u=s.filter((h=>h instanceof pw)).length;if(l>1||l>0&&u>0)throw new Xt(Rt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const r of n)i=r._apply(i);return i}class pw extends D9{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new pw(e,t,n)}_apply(e){const t=this._parse(e);return OD(e._query,t),new $p(e.firestore,e.converter,fx(e._query,t))}_parse(e){const t=kD(e.firestore);return(function(s,l,u,h,f,x,p){let w;if(f.isKeyField()){if(x==="array-contains"||x==="array-contains-any")throw new Xt(Rt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${x}' queries on documentId().`);if(x==="in"||x==="not-in"){jE(p,x);const B=[];for(const $ of p)B.push(FE(h,s,$));w={arrayValue:{values:B}}}else w=FE(h,s,p)}else x!=="in"&&x!=="not-in"&&x!=="array-contains-any"||jE(p,x),w=A9(u,l,p,x==="in"||x==="not-in");return tr.create(f,x,w)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class gw extends fw{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new gw(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:Br.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,s){let l=r;const u=s.getFlattenedFilters();for(const h of u)OD(l,h),l=fx(l,h)})(e._query,t),new $p(e.firestore,e.converter,fx(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function FE(i,e,t){if(typeof(t=us(t))=="string"){if(t==="")throw new Xt(Rt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aR(e)&&t.indexOf("/")!==-1)throw new Xt(Rt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Ar.fromString(t));if(!en.isDocumentKey(n))throw new Xt(Rt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return _m(i,new en(n))}if(t instanceof ka)return _m(i,t._key);throw new Xt(Rt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${X1(t)}.`)}function jE(i,e){if(!Array.isArray(i)||i.length===0)throw new Xt(Rt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function OD(i,e){const t=(function(r,s){for(const l of r)for(const u of l.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null})(i.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new Xt(Rt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Xt(Rt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class N9{convertValue(e,t="none"){switch(td(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Es(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Zc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw xn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return df(e,((r,s)=>{n[r]=this.convertValue(s,t)})),n}convertVectorValue(e){const t=e.fields?.[bp].arrayValue?.values?.map((n=>Es(n.doubleValue)));return new rc(t)}convertGeoPoint(e){return new ic(Es(e.latitude),Es(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=nv(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ym(e));default:return null}}convertTimestamp(e){const t=Qc(e);return new Ur(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ar.fromString(e);jn(NR(n),9688,{name:e});const r=new Jd(n.get(1),n.get(3)),s=new en(n.popFirst(5));return r.isEqual(t)||Qo(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function P9(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}class zg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gd extends ND{constructor(e,t,n,r,s,l){super(e,t,n,r,l),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new D0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(PD("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Xt(Rt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Gd._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Gd._jsonSchemaVersion="firestore/documentSnapshot/1.0",Gd._jsonSchema={type:Ia("string",Gd._jsonSchemaVersion),bundleSource:Ia("string","DocumentSnapshot"),bundleName:Ia("string"),bundle:Ia("string")};class D0 extends Gd{data(e={}){return super.data(e)}}class ap{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new zg(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new D0(this._firestore,this._userDataWriter,n.key,n,new zg(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Xt(Rt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,s){if(r._snapshot.oldDocs.isEmpty()){let l=0;return r._snapshot.docChanges.map((u=>{const h=new D0(r._firestore,r._userDataWriter,u.doc.key,u.doc,new zg(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((u=>s||u.type!==3)).map((u=>{const h=new D0(r._firestore,r._userDataWriter,u.doc.key,u.doc,new zg(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,x=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),x=l.indexOf(u.doc.key)),{type:O9(u.type),doc:h,oldIndex:f,newIndex:x}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Xt(Rt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ap._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=C2.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function O9(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xn(61501,{type:i})}}function VE(i){i=ed(i,ka);const e=ed(i.firestore,Zm);return g9(uw(e),i._key).then((t=>j9(e,i,t)))}ap._jsonSchemaVersion="firestore/querySnapshot/1.0",ap._jsonSchema={type:Ia("string",ap._jsonSchemaVersion),bundleSource:Ia("string","QuerySnapshot"),bundleName:Ia("string"),bundle:Ia("string")};class MD extends N9{constructor(e){super(),this.firestore=e}convertBytes(e){return new iu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ka(this.firestore,null,t)}}function M9(i){i=ed(i,$p);const e=ed(i.firestore,Zm),t=uw(e),n=new MD(e);return R9(i._query),m9(t,i._query).then((r=>new ap(e,n,i,r)))}function zE(i,e,t){i=ed(i,ka);const n=ed(i.firestore,Zm),r=P9(i.converter,e,t);return F9(n,[T9(kD(n),"setDoc",i._key,r,i.converter!==null,t).toMutation(i._key,jl.none())])}function F9(i,e){return(function(n,r){const s=new nc;return n.asyncQueue.enqueueAndForget((async()=>i9(await p9(n),r,s))),s.promise})(uw(i),e)}function j9(i,e,t){const n=t.docs.get(e._key),r=new MD(i);return new Gd(i,r,e._key,n,new zg(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(r){zp=r})(cd),Zh(new qc("firestore",((n,{instanceIdentifier:r,options:s})=>{const l=n.getProvider("app").getImmediate(),u=new Zm(new ij(n.getProvider("auth-internal")),new aj(l,n.getProvider("app-check-internal")),(function(f,x){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Xt(Rt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jd(f.options.projectId,x)})(l,r),l);return s={useFetchStreams:t,...s},u._setSettings(s),u}),"PUBLIC").setMultipleInstances(!0)),ou(vA,_A,e),ou(vA,_A,"esm2020")})();const V9={apiKey:"AIzaSyAUv69QXH4MNNR2wkr_wcVH_cbsYrc3wjo",authDomain:"wellnessai-app-e01be.firebaseapp.com",databaseURL:"https://wellnessai-app-e01be-default-rtdb.europe-west1.firebasedatabase.app",projectId:"wellnessai-app-e01be",storageBucket:"wellnessai-app-e01be.firebasestorage.app",messagingSenderId:"863551474584",appId:"1:863551474584:web:a34f3f77742b7be4e7f9ed",measurementId:"G-CB4C84PTJ3"},FD=G1(V9),mw=I2(FD);TD(FD);const z9="https://helio-wellness-app-production.up.railway.app";async function yw(i,e){try{const t=mw.currentUser;if(!t)throw new Error("User must be logged in to subscribe");const n=await fetch(`${z9}/api/stripe/create-checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.uid,priceId:i,plan:e})});if(!n.ok)throw new Error("Failed to create checkout session");const r=await n.json();window.location.href=r.url}catch(t){console.error("Error creating checkout:",t),alert("Failed to start checkout. Please try again.")}}const U9=()=>{yw("prod_TZhdMJIuUuIxOP","essential")},B9=()=>{yw("prod_TZhulmjk69SvVX","premium")},$9=()=>{yw("prod_TZhmpYUG5KqUaK","vip")};var kp;(function(i){i.Unimplemented="UNIMPLEMENTED",i.Unavailable="UNAVAILABLE"})(kp||(kp={}));class rb extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const H9=i=>{var e,t;return i?.androidBridge?"android":!((t=(e=i?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},G9=i=>{const e=i.CapacitorCustomPlatform||null,t=i.Capacitor||{},n=t.Plugins=t.Plugins||{},r=()=>e!==null?e.name:H9(i),s=()=>r()!=="web",l=p=>{const w=f.get(p);return!!(w?.platforms.has(r())||u(p))},u=p=>{var w;return(w=t.PluginHeaders)===null||w===void 0?void 0:w.find(A=>A.name===p)},h=p=>i.console.error(p),f=new Map,x=(p,w={})=>{const A=f.get(p);if(A)return console.warn(`Capacitor plugin "${p}" already registered. Cannot register plugins twice.`),A.proxy;const B=r(),$=u(p);let W;const q=async()=>(!W&&B in w?W=typeof w[B]=="function"?W=await w[B]():W=w[B]:e!==null&&!W&&"web"in w&&(W=typeof w.web=="function"?W=await w.web():W=w.web),W),ge=(ee,J)=>{var ye,X;if($){const ae=$?.methods.find(le=>J===le.name);if(ae)return ae.rtype==="promise"?le=>t.nativePromise(p,J.toString(),le):(le,ze)=>t.nativeCallback(p,J.toString(),le,ze);if(ee)return(ye=ee[J])===null||ye===void 0?void 0:ye.bind(ee)}else{if(ee)return(X=ee[J])===null||X===void 0?void 0:X.bind(ee);throw new rb(`"${p}" plugin is not implemented on ${B}`,kp.Unimplemented)}},he=ee=>{let J;const ye=(...X)=>{const ae=q().then(le=>{const ze=ge(le,ee);if(ze){const nt=ze(...X);return J=nt?.remove,nt}else throw new rb(`"${p}.${ee}()" is not implemented on ${B}`,kp.Unimplemented)});return ee==="addListener"&&(ae.remove=async()=>J()),ae};return ye.toString=()=>`${ee.toString()}() { [capacitor code] }`,Object.defineProperty(ye,"name",{value:ee,writable:!1,configurable:!1}),ye},me=he("addListener"),Ce=he("removeListener"),Ve=(ee,J)=>{const ye=me({eventName:ee},J),X=async()=>{const le=await ye;Ce({eventName:ee,callbackId:le},J)},ae=new Promise(le=>ye.then(()=>le({remove:X})));return ae.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await X()},ae},pe=new Proxy({},{get(ee,J){switch(J){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return $?Ve:me;case"removeListener":return Ce;default:return he(J)}}});return n[p]=pe,f.set(p,{name:p,proxy:pe,platforms:new Set([...Object.keys(w),...$?[B]:[]])}),pe};return t.convertFileSrc||(t.convertFileSrc=p=>p),t.getPlatform=r,t.handleError=h,t.isNativePlatform=s,t.isPluginAvailable=l,t.registerPlugin=x,t.Exception=rb,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},K9=i=>i.Capacitor=G9(i),wo=K9(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Bl=wo.registerPlugin;class jD{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s),n&&this.sendRetainedArgumentsForEvent(e);const l=async()=>this.removeListener(e,t);return Promise.resolve({remove:l})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,n){const r=this.listeners[e];if(!r){if(n){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}return}r.forEach(s=>s(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:n=>{this.notifyListeners(t,n)}}}unimplemented(e="not implemented"){return new wo.Exception(e,kp.Unimplemented)}unavailable(e="not available"){return new wo.Exception(e,kp.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const r=n.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(n=>{this.notifyListeners(e,n)}))}}const UE=i=>encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),BE=i=>i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class W9 extends jD{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(n=>{if(n.length<=0)return;let[r,s]=n.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=BE(r).trim(),s=BE(s).trim(),t[r]=s}),t}async setCookie(e){try{const t=UE(e.key),n=UE(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),l=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${r}; path=${s}; ${l};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Bl("CapacitorCookies",{web:()=>new W9});const q9=async i=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{const r=n.result;e(r.indexOf(",")>=0?r.split(",")[1]:r)},n.onerror=r=>t(r),n.readAsDataURL(i)}),Y9=(i={})=>{const e=Object.keys(i);return Object.keys(i).map(r=>r.toLocaleLowerCase()).reduce((r,s,l)=>(r[s]=i[e[l]],r),{})},X9=(i,e=!0)=>i?Object.entries(i).reduce((n,r)=>{const[s,l]=r;let u,h;return Array.isArray(l)?(h="",l.forEach(f=>{u=e?encodeURIComponent(f):f,h+=`${s}=${u}&`}),h.slice(0,-1)):(u=e?encodeURIComponent(l):l,h=`${s}=${u}`),`${n}&${h}`},"").substr(1):null,J9=(i,e={})=>{const t=Object.assign({method:i.method||"GET",headers:i.headers},e),r=Y9(i.headers)["content-type"]||"";if(typeof i.data=="string")t.body=i.data;else if(r.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[l,u]of Object.entries(i.data||{}))s.set(l,u);t.body=s.toString()}else if(r.includes("multipart/form-data")||i.data instanceof FormData){const s=new FormData;if(i.data instanceof FormData)i.data.forEach((u,h)=>{s.append(h,u)});else for(const u of Object.keys(i.data))s.append(u,i.data[u]);t.body=s;const l=new Headers(t.headers);l.delete("content-type"),t.headers=l}else(r.includes("application/json")||typeof i.data=="object")&&(t.body=JSON.stringify(i.data));return t};class Q9 extends jD{async request(e){const t=J9(e,e.webFetchExtra),n=X9(e.params,e.shouldEncodeUrlParams),r=n?`${e.url}?${n}`:e.url,s=await fetch(r,t),l=s.headers.get("content-type")||"";let{responseType:u="text"}=s.ok?e:{};l.includes("application/json")&&(u="json");let h,f;switch(u){case"arraybuffer":case"blob":f=await s.blob(),h=await q9(f);break;case"json":h=await s.json();break;case"document":case"text":default:h=await s.text()}const x={};return s.headers.forEach((p,w)=>{x[w]=p}),{data:h,headers:x,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Bl("CapacitorHttp",{web:()=>new Q9});const Z9="modulepreload",ez=function(i){return"/"+i},$E={},jt=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let h=function(f){return Promise.all(f.map(x=>Promise.resolve(x).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");r=h(t.map(f=>{if(f=ez(f),f in $E)return;$E[f]=!0;const x=f.endsWith(".css"),p=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${p}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":Z9,x||(w.as="script"),w.crossOrigin="",w.href=f,u&&w.setAttribute("nonce",u),document.head.appendChild(w),x)return new Promise((A,B)=>{w.addEventListener("load",A),w.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${f}`)))})}))}function s(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return r.then(l=>{for(const u of l||[])u.status==="rejected"&&s(u.reason);return e().catch(s)})},qf=Bl("Device",{web:()=>jt(()=>import("./chunk-1765887266799-web.js"),[]).then(i=>new i.DeviceWeb)}),yn=Bl("Preferences",{web:()=>jt(()=>import("./chunk-1765887266800-web.js"),[]).then(i=>new i.PreferencesWeb)}),Ex=Object.freeze(Object.defineProperty({__proto__:null,Preferences:yn},Symbol.toStringTag,{value:"Module"}));var HE={};const GE="@firebase/database",KE="1.1.0";let VD="";function tz(i){VD=i}class nz{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Va(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:om(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class iz{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return uc(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const zD=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){const e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new nz(e)}}catch{}return new iz},Ud=zD("localStorage"),rz=zD("sessionStorage");const op=new H1("@firebase/database"),sz=(function(){let i=1;return function(){return i++}})(),UD=function(i){const e=C6(i),t=new A6;t.update(e);const n=t.digest();return d2.encodeByteArray(n)},ey=function(...i){let e="";for(let t=0;t<i.length;t++){const n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=ey.apply(null,n):typeof n=="object"?e+=Va(n):e+=n,e+=" "}return e};let Qg=null,WE=!0;const az=function(i,e){Kt(!0,"Can't turn on custom loggers persistently."),op.logLevel=Ki.VERBOSE,Qg=op.log.bind(op)},xo=function(...i){if(WE===!0&&(WE=!1,Qg===null&&rz.get("logging_enabled")===!0&&az()),Qg){const e=ey.apply(null,i);Qg(e)}},ty=function(i){return function(...e){xo(i,...e)}},Ix=function(...i){const e="FIREBASE INTERNAL ERROR: "+ey(...i);op.error(e)},eh=function(...i){const e=`FIREBASE FATAL ERROR: ${ey(...i)}`;throw op.error(e),new Error(e)},tl=function(...i){const e="FIREBASE WARNING: "+ey(...i);op.warn(e)},oz=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&tl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},vw=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},lz=function(i){if(document.readyState==="complete")i();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Cp="[MIN_NAME]",rf="[MAX_NAME]",pf=function(i,e){if(i===e)return 0;if(i===Cp||e===rf)return-1;if(e===Cp||i===rf)return 1;{const t=qE(i),n=qE(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},uz=function(i,e){return i===e?0:i<e?-1:1},Tg=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+Va(e))},_w=function(i){if(typeof i!="object"||i===null)return Va(i);const e=[];for(const n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=Va(e[n]),t+=":",t+=_w(i[e[n]]);return t+="}",t},BD=function(i,e){const t=i.length;if(t<=e)return[i];const n=[];for(let r=0;r<t;r+=e)r+e>t?n.push(i.substring(r,t)):n.push(i.substring(r,r+e));return n};function So(i,e){for(const t in i)i.hasOwnProperty(t)&&e(t,i[t])}const $D=function(i){Kt(!vw(i),"Invalid JSON number");const e=11,t=52,n=(1<<e-1)-1;let r,s,l,u,h;i===0?(s=0,l=0,r=1/i===-1/0?1:0):(r=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(u=Math.min(Math.floor(Math.log(i)/Math.LN2),n),s=u+n,l=Math.round(i*Math.pow(2,t-u)-Math.pow(2,t))):(s=0,l=Math.round(i/Math.pow(2,1-n-t))));const f=[];for(h=t;h;h-=1)f.push(l%2?1:0),l=Math.floor(l/2);for(h=e;h;h-=1)f.push(s%2?1:0),s=Math.floor(s/2);f.push(r?1:0),f.reverse();const x=f.join("");let p="";for(h=0;h<64;h+=8){let w=parseInt(x.substr(h,8),2).toString(16);w.length===1&&(w="0"+w),p=p+w}return p.toLowerCase()},cz=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},hz=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function dz(i,e){let t="Unknown Error";i==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?t="Client doesn't have permission to access the desired data.":i==="unavailable"&&(t="The service is unavailable");const n=new Error(i+" at "+e._path.toString()+": "+t);return n.code=i.toUpperCase(),n}const fz=new RegExp("^-?(0*)\\d{1,10}$"),pz=-2147483648,gz=2147483647,qE=function(i){if(fz.test(i)){const e=Number(i);if(e>=pz&&e<=gz)return e}return null},Hp=function(i){try{i()}catch(e){setTimeout(()=>{const t=e.stack||"";throw tl("Exception was thrown by user callback.",t),e},Math.floor(0))}},mz=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zg=function(i,e){const t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class yz{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Mo(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){tl(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class vz{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(xo("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tl(e)}}class L0{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}L0.OWNER="owner";const bw="5",HD="v",GD="s",KD="r",WD="f",qD=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,YD="ls",XD="p",kx="ac",JD="websocket",QD="long_polling";class ZD{constructor(e,t,n,r,s=!1,l="",u=!1,h=!1,f=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=l,this.includeNamespaceInQueryParams=u,this.isUsingEmulator=h,this.emulatorOptions=f,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ud.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ud.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function _z(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function eL(i,e,t){Kt(typeof e=="string","typeof type must == string"),Kt(typeof t=="object","typeof params must == object");let n;if(e===JD)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===QD)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);_z(i)&&(t.ns=i.namespace);const r=[];return So(t,(s,l)=>{r.push(s+"="+l)}),n+r.join("&")}class bz{constructor(){this.counters_={}}incrementCounter(e,t=1){uc(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return l6(this.counters_)}}const sb={},ab={};function xw(i){const e=i.toString();return sb[e]||(sb[e]=new bz),sb[e]}function xz(i,e){const t=i.toString();return ab[t]||(ab[t]=e()),ab[t]}class wz{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<n.length;++r)n[r]&&Hp(()=>{this.onMessage_(n[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const YE="start",Sz="close",Tz="pLPCommand",Az="pRTLPCB",tL="id",nL="pw",iL="ser",Ez="cb",Iz="seg",kz="ts",Cz="d",Rz="dframe",rL=1870,sL=30,Dz=rL-sL,Lz=25e3,Nz=3e4;class Qf{constructor(e,t,n,r,s,l,u){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=s,this.transportSessionId=l,this.lastSessionId=u,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ty(e),this.stats_=xw(t),this.urlFn=h=>(this.appCheckToken&&(h[kx]=this.appCheckToken),eL(t,QD,h))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new wz(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Nz)),lz(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ww((...s)=>{const[l,u,h,f,x]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,l===YE)this.id=u,this.password=h;else if(l===Sz)u?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(u,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+l)},(...s)=>{const[l,u]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(l,u)},()=>{this.onClosed_()},this.urlFn);const n={};n[YE]="t",n[iL]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[Ez]=this.scriptTagHolder.uniqueCallbackIdentifier),n[HD]=bw,this.transportSessionId&&(n[GD]=this.transportSessionId),this.lastSessionId&&(n[YD]=this.lastSessionId),this.applicationId&&(n[XD]=this.applicationId),this.appCheckToken&&(n[kx]=this.appCheckToken),typeof location<"u"&&location.hostname&&qD.test(location.hostname)&&(n[KD]=WD);const r=this.urlFn(n);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Qf.forceAllow_=!0}static forceDisallow(){Qf.forceDisallow_=!0}static isAvailable(){return Qf.forceAllow_?!0:!Qf.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!cz()&&!hz()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Va(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=wC(t),r=BD(n,Dz);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={};n[Rz]="t",n[tL]=e,n[nL]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Va(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ww{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=sz(),window[Tz+this.uniqueCallbackIdentifier]=e,window[Az+this.uniqueCallbackIdentifier]=t,this.myIFrame=ww.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const l="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(l),this.myIFrame.doc.close()}catch(u){xo("frame writing exception"),u.stack&&xo(u.stack),xo(u)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||xo("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[tL]=this.myID,e[nL]=this.myPW,e[iL]=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+sL+n.length<=rL;){const l=this.pendingSegs.shift();n=n+"&"+Iz+r+"="+l.seg+"&"+kz+r+"="+l.ts+"&"+Cz+r+"="+l.d,r++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(Lz)),s=()=>{clearTimeout(r),n()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const r=n.readyState;(!r||r==="loaded"||r==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{xo("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}const Pz=16384,Oz=45e3;let y1=null;typeof MozWebSocket<"u"?y1=MozWebSocket:typeof WebSocket<"u"&&(y1=WebSocket);class ku{constructor(e,t,n,r,s,l,u){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ty(this.connId),this.stats_=xw(t),this.connURL=ku.connectionURL_(t,l,u,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,s){const l={};return l[HD]=bw,typeof location<"u"&&location.hostname&&qD.test(location.hostname)&&(l[KD]=WD),t&&(l[GD]=t),n&&(l[YD]=n),r&&(l[kx]=r),s&&(l[XD]=s),eL(e,JD,l)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ud.set("previous_websocket_failure",!0);try{let n;v6(),this.mySock=new y1(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){ku.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&y1!==null&&!ku.forceDisallow_}static previouslyFailed(){return Ud.isInMemoryStorage||Ud.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ud.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const n=om(t);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Kt(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const n=this.extractFrameCount_(t);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const t=Va(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=BD(t,Pz);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Oz))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ku.responsesRequiredToBeHealthy=2;ku.healthyTimeout=3e4;class Tm{static get ALL_TRANSPORTS(){return[Qf,ku]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=ku&&ku.isAvailable();let n=t&&!ku.previouslyFailed();if(e.webSocketOnly&&(t||tl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ku];else{const r=this.transports_=[];for(const s of Tm.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);Tm.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Tm.globalTransportInitialized_=!1;const Mz=6e4,Fz=5e3,jz=10*1024,Vz=100*1024,ob="t",XE="d",zz="s",JE="r",Uz="e",QE="o",ZE="a",eI="n",tI="p",Bz="h";class $z{constructor(e,t,n,r,s,l,u,h,f,x){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=l,this.onReady_=u,this.onDisconnect_=h,this.onKill_=f,this.lastSessionId=x,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ty("c:"+this.id+":"),this.transportManager_=new Tm(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Zg(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Vz?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>jz?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ob in e){const t=e[ob];t===ZE?this.upgradeIfSecondaryHealthy_():t===JE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===QE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Tg("t",e),n=Tg("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:tI,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ZE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:eI,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Tg("t",e),n=Tg("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Tg(ob,e);if(XE in e){const n=e[XE];if(t===Bz){const r={...n};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===eI){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===zz?this.onConnectionShutdown_(n):t===JE?this.onReset_(n):t===Uz?Ix("Server Error: "+n):t===QE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ix("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),bw!==n&&tl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Zg(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Mz))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zg(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Fz))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:tI,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ud.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class aL{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class oL{constructor(e){this.allowedEvents_=e,this.listeners_={},Kt(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let r=0;r<n.length;r++)n[r].callback.apply(n[r].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!n||n===r[s].context)){r.splice(s,1);return}}validateEventType_(e){Kt(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class v1 extends oL{static getInstance(){return new v1}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!g2()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Kt(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const nI=32,iI=768;class Yr{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function yr(){return new Yr("")}function ji(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function sd(i){return i.pieces_.length-i.pieceNum_}function ls(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new Yr(i.pieces_,e)}function Sw(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function Hz(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function Am(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function lL(i){if(i.pieceNum_>=i.pieces_.length)return null;const e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new Yr(e,0)}function ta(i,e){const t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof Yr)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{const n=e.split("/");for(let r=0;r<n.length;r++)n[r].length>0&&t.push(n[r])}return new Yr(t,0)}function Wi(i){return i.pieceNum_>=i.pieces_.length}function Zo(i,e){const t=ji(i),n=ji(e);if(t===null)return e;if(t===n)return Zo(ls(i),ls(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function Gz(i,e){const t=Am(i,0),n=Am(e,0);for(let r=0;r<t.length&&r<n.length;r++){const s=pf(t[r],n[r]);if(s!==0)return s}return t.length===n.length?0:t.length<n.length?-1:1}function Tw(i,e){if(sd(i)!==sd(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function au(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(sd(i)>sd(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}class Kz{constructor(e,t){this.errorPrefix_=t,this.parts_=Am(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=$1(this.parts_[n]);uL(this)}}function Wz(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=$1(e),uL(i)}function qz(i){const e=i.parts_.pop();i.byteLength_-=$1(e),i.parts_.length>0&&(i.byteLength_-=1)}function uL(i){if(i.byteLength_>iI)throw new Error(i.errorPrefix_+"has a key path longer than "+iI+" bytes ("+i.byteLength_+").");if(i.parts_.length>nI)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+nI+") or object contains a cycle "+Rd(i))}function Rd(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}class Aw extends oL{static getInstance(){return new Aw}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(e){return Kt(e==="visible","Unknown event type: "+e),[this.visible_]}}const Ag=1e3,Yz=300*1e3,rI=30*1e3,Xz=1.3,Jz=3e4,Qz="server_kill",sI=3;class Kc extends aL{constructor(e,t,n,r,s,l,u,h){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=l,this.appCheckTokenProvider_=u,this.authOverride_=h,this.id=Kc.nextPersistentConnectionId_++,this.log_=ty("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ag,this.maxReconnectDelay_=Yz,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Aw.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&v1.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(Va(s)),Kt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Fm,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:l=>{const u=l.d;l.s==="ok"?t.resolve(u):t.reject(u)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),t.promise}listen(e,t,n,r){this.initConnection_();const s=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+s),this.listens.has(l)||this.listens.set(l,new Map),Kt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Kt(!this.listens.get(l).has(s),"listen() called twice for same path/queryId.");const u={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(l).set(s,u),this.connected_&&this.sendListen_(u)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const s={p:n},l="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(l,s,u=>{const h=u.d,f=u.s;Kc.warnOnListenWarnings_(h,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",u),f!=="ok"&&this.removeListen_(n,r),e.onComplete&&e.onComplete(f,h))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&uc(e,"w")){const n=pp(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();tl(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||T6(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=rI)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=S6(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(t,n,r=>{const s=r.s,l=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Kt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const s={p:e},l="n";r&&(s.q=n,s.t=r),this.sendRequest(l,s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,l=>{r&&setTimeout(()=>{r(l.s,l.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,s){this.initConnection_();const l={p:t,d:n};s!==void 0&&(l.h=s),this.outstandingPuts_.push({action:e,request:l,onComplete:r}),this.outstandingPutCount_++;const u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,n=>{if(n.s!=="ok"){const s=n.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Va(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Ix("Unrecognized action received from server: "+Va(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Kt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ag,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ag,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Jz&&(this.reconnectDelay_=Ag),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Xz)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Kc.nextConnectionId_++,s=this.lastSessionId;let l=!1,u=null;const h=function(){u?u.close():(l=!0,n())},f=function(p){Kt(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:h,sendRequest:f};const x=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,w]=await Promise.all([this.authTokenProvider_.getToken(x),this.appCheckTokenProvider_.getToken(x)]);l?xo("getToken() completed but was canceled"):(xo("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=w&&w.token,u=new $z(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,A=>{tl(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(Qz)},s))}catch(p){this.log_("Failed to get token: "+p),l||(this.repoInfo_.nodeAdmin&&tl(p),h())}}}interrupt(e){xo("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){xo("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Hb(this.interruptReasons_)&&(this.reconnectDelay_=Ag,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;t?n=t.map(s=>_w(s)).join("$"):n="default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new Yr(e).toString();let r;if(this.listens.has(n)){const s=this.listens.get(n);r=s.get(t),s.delete(t),s.size===0&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){xo("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=sI&&(this.reconnectDelay_=rI,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){xo("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=sI&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+VD.replace(/\./g,"-")]=1,g2()?e["framework.cordova"]=1:CC()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=v1.getInstance().currentlyOnline();return Hb(this.interruptReasons_)&&e}}Kc.nextPersistentConnectionId_=0;Kc.nextConnectionId_=0;class Vi{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Vi(e,t)}}class gv{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Vi(Cp,e),r=new Vi(Cp,t);return this.compare(n,r)!==0}minPost(){return Vi.MIN}}let Qy;class cL extends gv{static get __EMPTY_NODE(){return Qy}static set __EMPTY_NODE(e){Qy=e}compare(e,t){return pf(e.name,t.name)}isDefinedOn(e){throw Fp("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Vi.MIN}maxPost(){return new Vi(rf,Qy)}makePost(e,t){return Kt(typeof e=="string","KeyIndex indexValue must always be a string."),new Vi(e,Qy)}toString(){return".key"}}const lp=new cL;class Zy{constructor(e,t,n,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let l=1;for(;!e.isEmpty();)if(e=e,l=t?n(e.key,t):1,r&&(l*=-1),l<0)this.isReverse_?e=e.left:e=e.right;else if(l===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class no{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??no.RED,this.left=r??ml.EMPTY_NODE,this.right=s??ml.EMPTY_NODE}copy(e,t,n,r,s){return new no(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ml.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),t(e,n.key)===0){if(n.right.isEmpty())return ml.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,no.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,no.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}no.RED=!0;no.BLACK=!1;class Zz{copy(e,t,n,r,s){return this}insert(e,t,n){return new no(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ml{constructor(e,t=ml.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ml(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,no.BLACK,null,null))}remove(e){return new ml(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,no.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(r=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Zy(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Zy(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Zy(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Zy(this.root_,null,this.comparator_,!0,e)}}ml.EMPTY_NODE=new Zz;function eU(i,e){return pf(i.name,e.name)}function Ew(i,e){return pf(i,e)}let Cx;function tU(i){Cx=i}const hL=function(i){return typeof i=="number"?"number:"+$D(i):"string:"+i},dL=function(i){if(i.isLeafNode()){const e=i.val();Kt(typeof e=="string"||typeof e=="number"||typeof e=="object"&&uc(e,".sv"),"Priority must be a string or number.")}else Kt(i===Cx||i.isEmpty(),"priority of unexpected type.");Kt(i===Cx||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let aI;class eo{static set __childrenNodeConstructor(e){aI=e}static get __childrenNodeConstructor(){return aI}constructor(e,t=eo.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Kt(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),dL(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new eo(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:eo.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Wi(e)?this:ji(e)===".priority"?this.priorityNode_:eo.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:eo.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=ji(e);return n===null?t:t.isEmpty()&&n!==".priority"?this:(Kt(n!==".priority"||sd(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,eo.__childrenNodeConstructor.EMPTY_NODE.updateChild(ls(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+hL(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=$D(this.value_):e+=this.value_,this.lazyHash_=UD(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===eo.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof eo.__childrenNodeConstructor?-1:(Kt(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=eo.VALUE_TYPE_ORDER.indexOf(t),s=eo.VALUE_TYPE_ORDER.indexOf(n);return Kt(r>=0,"Unknown leaf type: "+t),Kt(s>=0,"Unknown leaf type: "+n),r===s?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}eo.VALUE_TYPE_ORDER=["object","boolean","number","string"];let fL,pL;function nU(i){fL=i}function iU(i){pL=i}class rU extends gv{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),s=n.compareTo(r);return s===0?pf(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Vi.MIN}maxPost(){return new Vi(rf,new eo("[PRIORITY-POST]",pL))}makePost(e,t){const n=fL(e);return new Vi(t,new eo("[PRIORITY-POST]",n))}toString(){return".priority"}}const na=new rU;const sU=Math.log(2);class aU{constructor(e){const t=s=>parseInt(Math.log(s)/sU,10),n=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const _1=function(i,e,t,n){i.sort(e);const r=function(h,f){const x=f-h;let p,w;if(x===0)return null;if(x===1)return p=i[h],w=t?t(p):p,new no(w,p.node,no.BLACK,null,null);{const A=parseInt(x/2,10)+h,B=r(h,A),$=r(A+1,f);return p=i[A],w=t?t(p):p,new no(w,p.node,no.BLACK,B,$)}},s=function(h){let f=null,x=null,p=i.length;const w=function(B,$){const W=p-B,q=p;p-=B;const ge=r(W+1,q),he=i[W],me=t?t(he):he;A(new no(me,he.node,$,null,ge))},A=function(B){f?(f.left=B,f=B):(x=B,f=B)};for(let B=0;B<h.count;++B){const $=h.nextBitIsOne(),W=Math.pow(2,h.count-(B+1));$?w(W,no.BLACK):(w(W,no.BLACK),w(W,no.RED))}return x},l=new aU(i.length),u=s(l);return new ml(n||e,u)};let lb;const Vf={};class $c{static get Default(){return Kt(Vf&&na,"ChildrenNode.ts has not been loaded"),lb=lb||new $c({".priority":Vf},{".priority":na}),lb}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=pp(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ml?t:null}hasIndex(e){return uc(this.indexSet_,e.toString())}addIndex(e,t){Kt(e!==lp,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const s=t.getIterator(Vi.Wrap);let l=s.getNext();for(;l;)r=r||e.isDefinedOn(l.node),n.push(l),l=s.getNext();let u;r?u=_1(n,e.getCompare()):u=Vf;const h=e.toString(),f={...this.indexSet_};f[h]=e;const x={...this.indexes_};return x[h]=u,new $c(x,f)}addToIndexes(e,t){const n=K0(this.indexes_,(r,s)=>{const l=pp(this.indexSet_,s);if(Kt(l,"Missing index implementation for "+s),r===Vf)if(l.isDefinedOn(e.node)){const u=[],h=t.getIterator(Vi.Wrap);let f=h.getNext();for(;f;)f.name!==e.name&&u.push(f),f=h.getNext();return u.push(e),_1(u,l.getCompare())}else return Vf;else{const u=t.get(e.name);let h=r;return u&&(h=h.remove(new Vi(e.name,u))),h.insert(e,e.node)}});return new $c(n,this.indexSet_)}removeFromIndexes(e,t){const n=K0(this.indexes_,r=>{if(r===Vf)return r;{const s=t.get(e.name);return s?r.remove(new Vi(e.name,s)):r}});return new $c(n,this.indexSet_)}}let Eg;class ni{static get EMPTY_NODE(){return Eg||(Eg=new ni(new ml(Ew),null,$c.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&dL(this.priorityNode_),this.children_.isEmpty()&&Kt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Eg}updatePriority(e){return this.children_.isEmpty()?this:new ni(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Eg:t}}getChild(e){const t=ji(e);return t===null?this:this.getImmediateChild(t).getChild(ls(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Kt(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const n=new Vi(e,t);let r,s;t.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const l=r.isEmpty()?Eg:this.priorityNode_;return new ni(r,l,s)}}updateChild(e,t){const n=ji(e);if(n===null)return t;{Kt(ji(e)!==".priority"||sd(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(ls(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,s=!0;if(this.forEachChild(na,(l,u)=>{t[l]=u.val(e),n++,s&&ni.INTEGER_REGEXP_.test(l)?r=Math.max(r,Number(l)):s=!1}),!e&&s&&r<2*n){const l=[];for(const u in t)l[u]=t[u];return l}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+hL(this.getPriority().val())+":"),this.forEachChild(na,(t,n)=>{const r=n.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":UD(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const s=r.getPredecessorKey(new Vi(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Vi(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Vi(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Vi.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Vi.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ny?-1:0}withIndex(e){if(e===lp||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ni(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===lp||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const n=this.getIterator(na),r=t.getIterator(na);let s=n.getNext(),l=r.getNext();for(;s&&l;){if(s.name!==l.name||!s.node.equals(l.node))return!1;s=n.getNext(),l=r.getNext()}return s===null&&l===null}else return!1;else return!1}}resolveIndex_(e){return e===lp?null:this.indexMap_.get(e.toString())}}ni.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class oU extends ni{constructor(){super(new ml(Ew),ni.EMPTY_NODE,$c.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ni.EMPTY_NODE}isEmpty(){return!1}}const ny=new oU;Object.defineProperties(Vi,{MIN:{value:new Vi(Cp,ni.EMPTY_NODE)},MAX:{value:new Vi(rf,ny)}});cL.__EMPTY_NODE=ni.EMPTY_NODE;eo.__childrenNodeConstructor=ni;tU(ny);iU(ny);const lU=!0;function ja(i,e=null){if(i===null)return ni.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),Kt(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){const t=i;return new eo(t,ja(e))}if(!(i instanceof Array)&&lU){const t=[];let n=!1;if(So(i,(l,u)=>{if(l.substring(0,1)!=="."){const h=ja(u);h.isEmpty()||(n=n||!h.getPriority().isEmpty(),t.push(new Vi(l,h)))}}),t.length===0)return ni.EMPTY_NODE;const s=_1(t,eU,l=>l.name,Ew);if(n){const l=_1(t,na.getCompare());return new ni(s,ja(e),new $c({".priority":l},{".priority":na}))}else return new ni(s,ja(e),$c.Default)}else{let t=ni.EMPTY_NODE;return So(i,(n,r)=>{if(uc(i,n)&&n.substring(0,1)!=="."){const s=ja(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(n,s))}}),t.updatePriority(ja(e))}}nU(ja);class uU extends gv{constructor(e){super(),this.indexPath_=e,Kt(!Wi(e)&&ji(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),s=n.compareTo(r);return s===0?pf(e.name,t.name):s}makePost(e,t){const n=ja(e),r=ni.EMPTY_NODE.updateChild(this.indexPath_,n);return new Vi(t,r)}maxPost(){const e=ni.EMPTY_NODE.updateChild(this.indexPath_,ny);return new Vi(rf,e)}toString(){return Am(this.indexPath_,0).join("/")}}class cU extends gv{compare(e,t){const n=e.node.compareTo(t.node);return n===0?pf(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Vi.MIN}maxPost(){return Vi.MAX}makePost(e,t){const n=ja(e);return new Vi(t,n)}toString(){return".value"}}const hU=new cU;function gL(i){return{type:"value",snapshotNode:i}}function Rp(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function Em(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function Im(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function dU(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}class Iw{constructor(e){this.index_=e}updateChild(e,t,n,r,s,l){Kt(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const u=e.getImmediateChild(t);return u.getChild(r).equals(n.getChild(r))&&u.isEmpty()===n.isEmpty()||(l!=null&&(n.isEmpty()?e.hasChild(t)?l.trackChildChange(Em(t,u)):Kt(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):u.isEmpty()?l.trackChildChange(Rp(t,n)):l.trackChildChange(Im(t,n,u))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(na,(r,s)=>{t.hasChild(r)||n.trackChildChange(Em(r,s))}),t.isLeafNode()||t.forEachChild(na,(r,s)=>{if(e.hasChild(r)){const l=e.getImmediateChild(r);l.equals(s)||n.trackChildChange(Im(r,s,l))}else n.trackChildChange(Rp(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ni.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class km{constructor(e){this.indexedFilter_=new Iw(e.getIndex()),this.index_=e.getIndex(),this.startPost_=km.getStartPost_(e),this.endPost_=km.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,s,l){return this.matches(new Vi(t,n))||(n=ni.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,s,l)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ni.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(ni.EMPTY_NODE);const s=this;return t.forEachChild(na,(l,u)=>{s.matches(new Vi(l,u))||(r=r.updateImmediateChild(l,ni.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class fU{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{const n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new km(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,s,l){return this.rangedFilter_.matches(new Vi(t,n))||(n=ni.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,s,l):this.fullLimitUpdateChild_(e,t,n,s,l)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=ni.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=ni.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let l=0;for(;s.hasNext()&&l<this.limit_;){const u=s.getNext();if(this.withinDirectionalStart(u))if(this.withinDirectionalEnd(u))r=r.updateImmediateChild(u.name,u.node),l++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(ni.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let l=0;for(;s.hasNext();){const u=s.getNext();l<this.limit_&&this.withinDirectionalStart(u)&&this.withinDirectionalEnd(u)?l++:r=r.updateImmediateChild(u.name,ni.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,s){let l;if(this.reverse_){const p=this.index_.getCompare();l=(w,A)=>p(A,w)}else l=this.index_.getCompare();const u=e;Kt(u.numChildren()===this.limit_,"");const h=new Vi(t,n),f=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),x=this.rangedFilter_.matches(h);if(u.hasChild(t)){const p=u.getImmediateChild(t);let w=r.getChildAfterChild(this.index_,f,this.reverse_);for(;w!=null&&(w.name===t||u.hasChild(w.name));)w=r.getChildAfterChild(this.index_,w,this.reverse_);const A=w==null?1:l(w,h);if(x&&!n.isEmpty()&&A>=0)return s?.trackChildChange(Im(t,n,p)),u.updateImmediateChild(t,n);{s?.trackChildChange(Em(t,p));const $=u.updateImmediateChild(t,ni.EMPTY_NODE);return w!=null&&this.rangedFilter_.matches(w)?(s?.trackChildChange(Rp(w.name,w.node)),$.updateImmediateChild(w.name,w.node)):$}}else return n.isEmpty()?e:x&&l(f,h)>=0?(s!=null&&(s.trackChildChange(Em(f.name,f.node)),s.trackChildChange(Rp(t,n))),u.updateImmediateChild(t,n).updateImmediateChild(f.name,ni.EMPTY_NODE)):e}}class kw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=na}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Kt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Kt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Cp}hasEnd(){return this.endSet_}getIndexEndValue(){return Kt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Kt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:rf}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Kt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===na}copy(){const e=new kw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function pU(i){return i.loadsAllData()?new Iw(i.getIndex()):i.hasLimit()?new fU(i):new km(i)}function oI(i){const e={};if(i.isDefault())return e;let t;if(i.index_===na?t="$priority":i.index_===hU?t="$value":i.index_===lp?t="$key":(Kt(i.index_ instanceof uU,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=Va(t),i.startSet_){const n=i.startAfterSet_?"startAfter":"startAt";e[n]=Va(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+Va(i.indexStartName_))}if(i.endSet_){const n=i.endBeforeSet_?"endBefore":"endAt";e[n]=Va(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+Va(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function lI(i){const e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==na&&(e.i=i.index_.toString()),e}class b1 extends aL{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Kt(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=ty("p:rest:"),this.listens_={}}listen(e,t,n,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const l=b1.getListenId_(e,n),u={};this.listens_[l]=u;const h=oI(e._queryParams);this.restRequest_(s+".json",h,(f,x)=>{let p=x;if(f===404&&(p=null,f=null),f===null&&this.onDataUpdate_(s,p,!1,n),pp(this.listens_,l)===u){let w;f?f===401?w="permission_denied":w="rest_error:"+f:w="ok",r(w,null)}})}unlisten(e,t){const n=b1.getListenId_(e,t);delete this.listens_[n]}get(e){const t=oI(e._queryParams),n=e._path.toString(),r=new Fm;return this.restRequest_(n+".json",t,(s,l)=>{let u=l;s===404&&(u=null,s=null),s===null?(this.onDataUpdate_(n,u,!1,null),r.resolve(u)):r.reject(new Error(u))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);const l=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+jp(t);this.log_("Sending REST request for "+l);const u=new XMLHttpRequest;u.onreadystatechange=()=>{if(n&&u.readyState===4){this.log_("REST Response for "+l+" received. status:",u.status,"response:",u.responseText);let h=null;if(u.status>=200&&u.status<300){try{h=om(u.responseText)}catch{tl("Failed to parse JSON response for "+l+": "+u.responseText)}n(null,h)}else u.status!==401&&u.status!==404&&tl("Got unsuccessful REST response for "+l+" Status: "+u.status),n(u.status);n=null}},u.open("GET",l,!0),u.send()})}}class gU{constructor(){this.rootNode_=ni.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function x1(){return{value:null,children:new Map}}function mL(i,e,t){if(Wi(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{const n=ji(e);i.children.has(n)||i.children.set(n,x1());const r=i.children.get(n);e=ls(e),mL(r,e,t)}}function Rx(i,e,t){i.value!==null?t(e,i.value):mU(i,(n,r)=>{const s=new Yr(e.toString()+"/"+n);Rx(r,s,t)})}function mU(i,e){i.children.forEach((t,n)=>{e(n,t)})}class yU{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&So(this.last_,(n,r)=>{t[n]=t[n]-r}),this.last_=e,t}}const uI=10*1e3,vU=30*1e3,_U=300*1e3;class bU{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new yU(e);const n=uI+(vU-uI)*Math.random();Zg(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;So(e,(r,s)=>{s>0&&uc(this.statsToReport_,r)&&(t[r]=s,n=!0)}),n&&this.server_.reportStats(t),Zg(this.reportStats_.bind(this),Math.floor(Math.random()*2*_U))}}var Ru;(function(i){i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ru||(Ru={}));function Cw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Rw(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Dw(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}class w1{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ru.ACK_USER_WRITE,this.source=Cw()}operationForChild(e){if(Wi(this.path)){if(this.affectedTree.value!=null)return Kt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Yr(e));return new w1(yr(),t,this.revert)}}else return Kt(ji(this.path)===e,"operationForChild called for unrelated child."),new w1(ls(this.path),this.affectedTree,this.revert)}}class Cm{constructor(e,t){this.source=e,this.path=t,this.type=Ru.LISTEN_COMPLETE}operationForChild(e){return Wi(this.path)?new Cm(this.source,yr()):new Cm(this.source,ls(this.path))}}class sf{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ru.OVERWRITE}operationForChild(e){return Wi(this.path)?new sf(this.source,yr(),this.snap.getImmediateChild(e)):new sf(this.source,ls(this.path),this.snap)}}class Dp{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ru.MERGE}operationForChild(e){if(Wi(this.path)){const t=this.children.subtree(new Yr(e));return t.isEmpty()?null:t.value?new sf(this.source,yr(),t.value):new Dp(this.source,yr(),t)}else return Kt(ji(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Dp(this.source,ls(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ad{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Wi(e))return this.isFullyInitialized()&&!this.filtered_;const t=ji(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class xU{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function wU(i,e,t,n){const r=[],s=[];return e.forEach(l=>{l.type==="child_changed"&&i.index_.indexedValueChanged(l.oldSnap,l.snapshotNode)&&s.push(dU(l.childName,l.snapshotNode))}),Ig(i,r,"child_removed",e,n,t),Ig(i,r,"child_added",e,n,t),Ig(i,r,"child_moved",s,n,t),Ig(i,r,"child_changed",e,n,t),Ig(i,r,"value",e,n,t),r}function Ig(i,e,t,n,r,s){const l=n.filter(u=>u.type===t);l.sort((u,h)=>TU(i,u,h)),l.forEach(u=>{const h=SU(i,u,s);r.forEach(f=>{f.respondsTo(u.type)&&e.push(f.createEvent(h,i.query_))})})}function SU(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function TU(i,e,t){if(e.childName==null||t.childName==null)throw Fp("Should only compare child_ events.");const n=new Vi(e.childName,e.snapshotNode),r=new Vi(t.childName,t.snapshotNode);return i.index_.compare(n,r)}function mv(i,e){return{eventCache:i,serverCache:e}}function em(i,e,t,n){return mv(new ad(e,t,n),i.serverCache)}function yL(i,e,t,n){return mv(i.eventCache,new ad(e,t,n))}function S1(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function af(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}let ub;const AU=()=>(ub||(ub=new ml(uz)),ub);class os{static fromObject(e){let t=new os(null);return So(e,(n,r)=>{t=t.set(new Yr(n),r)}),t}constructor(e,t=AU()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:yr(),value:this.value};if(Wi(e))return null;{const n=ji(e),r=this.children.get(n);if(r!==null){const s=r.findRootMostMatchingPathAndValue(ls(e),t);return s!=null?{path:ta(new Yr(n),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Wi(e))return this;{const t=ji(e),n=this.children.get(t);return n!==null?n.subtree(ls(e)):new os(null)}}set(e,t){if(Wi(e))return new os(t,this.children);{const n=ji(e),s=(this.children.get(n)||new os(null)).set(ls(e),t),l=this.children.insert(n,s);return new os(this.value,l)}}remove(e){if(Wi(e))return this.children.isEmpty()?new os(null):new os(null,this.children);{const t=ji(e),n=this.children.get(t);if(n){const r=n.remove(ls(e));let s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new os(null):new os(this.value,s)}else return this}}get(e){if(Wi(e))return this.value;{const t=ji(e),n=this.children.get(t);return n?n.get(ls(e)):null}}setTree(e,t){if(Wi(e))return t;{const n=ji(e),s=(this.children.get(n)||new os(null)).setTree(ls(e),t);let l;return s.isEmpty()?l=this.children.remove(n):l=this.children.insert(n,s),new os(this.value,l)}}fold(e){return this.fold_(yr(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,s)=>{n[r]=s.fold_(ta(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,yr(),t)}findOnPath_(e,t,n){const r=this.value?n(t,this.value):!1;if(r)return r;if(Wi(e))return null;{const s=ji(e),l=this.children.get(s);return l?l.findOnPath_(ls(e),ta(t,s),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,yr(),t)}foreachOnPath_(e,t,n){if(Wi(e))return this;{this.value&&n(t,this.value);const r=ji(e),s=this.children.get(r);return s?s.foreachOnPath_(ls(e),ta(t,r),n):new os(null)}}foreach(e){this.foreach_(yr(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(ta(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Lu{constructor(e){this.writeTree_=e}static empty(){return new Lu(new os(null))}}function tm(i,e,t){if(Wi(e))return new Lu(new os(t));{const n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){const r=n.path;let s=n.value;const l=Zo(r,e);return s=s.updateChild(l,t),new Lu(i.writeTree_.set(r,s))}else{const r=new os(t),s=i.writeTree_.setTree(e,r);return new Lu(s)}}}function Dx(i,e,t){let n=i;return So(t,(r,s)=>{n=tm(n,ta(e,r),s)}),n}function cI(i,e){if(Wi(e))return Lu.empty();{const t=i.writeTree_.setTree(e,new os(null));return new Lu(t)}}function Lx(i,e){return gf(i,e)!=null}function gf(i,e){const t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild(Zo(t.path,e)):null}function hI(i){const e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(na,(n,r)=>{e.push(new Vi(n,r))}):i.writeTree_.children.inorderTraversal((n,r)=>{r.value!=null&&e.push(new Vi(n,r.value))}),e}function Yh(i,e){if(Wi(e))return i;{const t=gf(i,e);return t!=null?new Lu(new os(t)):new Lu(i.writeTree_.subtree(e))}}function Nx(i){return i.writeTree_.isEmpty()}function Lp(i,e){return vL(yr(),i.writeTree_,e)}function vL(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(Kt(s.value!==null,"Priority writes must always be leaf nodes"),n=s.value):t=vL(ta(i,r),s,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(ta(i,".priority"),n)),t}}function yv(i,e){return wL(e,i)}function EU(i,e,t,n,r){Kt(n>i.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:r}),r&&(i.visibleWrites=tm(i.visibleWrites,e,t)),i.lastWriteId=n}function IU(i,e,t,n){Kt(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:e,children:t,writeId:n,visible:!0}),i.visibleWrites=Dx(i.visibleWrites,e,t),i.lastWriteId=n}function kU(i,e){for(let t=0;t<i.allWrites.length;t++){const n=i.allWrites[t];if(n.writeId===e)return n}return null}function CU(i,e){const t=i.allWrites.findIndex(u=>u.writeId===e);Kt(t>=0,"removeWrite called with nonexistent writeId.");const n=i.allWrites[t];i.allWrites.splice(t,1);let r=n.visible,s=!1,l=i.allWrites.length-1;for(;r&&l>=0;){const u=i.allWrites[l];u.visible&&(l>=t&&RU(u,n.path)?r=!1:au(n.path,u.path)&&(s=!0)),l--}if(r){if(s)return DU(i),!0;if(n.snap)i.visibleWrites=cI(i.visibleWrites,n.path);else{const u=n.children;So(u,h=>{i.visibleWrites=cI(i.visibleWrites,ta(n.path,h))})}return!0}else return!1}function RU(i,e){if(i.snap)return au(i.path,e);for(const t in i.children)if(i.children.hasOwnProperty(t)&&au(ta(i.path,t),e))return!0;return!1}function DU(i){i.visibleWrites=_L(i.allWrites,LU,yr()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function LU(i){return i.visible}function _L(i,e,t){let n=Lu.empty();for(let r=0;r<i.length;++r){const s=i[r];if(e(s)){const l=s.path;let u;if(s.snap)au(t,l)?(u=Zo(t,l),n=tm(n,u,s.snap)):au(l,t)&&(u=Zo(l,t),n=tm(n,yr(),s.snap.getChild(u)));else if(s.children){if(au(t,l))u=Zo(t,l),n=Dx(n,u,s.children);else if(au(l,t))if(u=Zo(l,t),Wi(u))n=Dx(n,yr(),s.children);else{const h=pp(s.children,ji(u));if(h){const f=h.getChild(ls(u));n=tm(n,yr(),f)}}}else throw Fp("WriteRecord should have .snap or .children")}}return n}function bL(i,e,t,n,r){if(!n&&!r){const s=gf(i.visibleWrites,e);if(s!=null)return s;{const l=Yh(i.visibleWrites,e);if(Nx(l))return t;if(t==null&&!Lx(l,yr()))return null;{const u=t||ni.EMPTY_NODE;return Lp(l,u)}}}else{const s=Yh(i.visibleWrites,e);if(!r&&Nx(s))return t;if(!r&&t==null&&!Lx(s,yr()))return null;{const l=function(f){return(f.visible||r)&&(!n||!~n.indexOf(f.writeId))&&(au(f.path,e)||au(e,f.path))},u=_L(i.allWrites,l,e),h=t||ni.EMPTY_NODE;return Lp(u,h)}}}function NU(i,e,t){let n=ni.EMPTY_NODE;const r=gf(i.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(na,(s,l)=>{n=n.updateImmediateChild(s,l)}),n;if(t){const s=Yh(i.visibleWrites,e);return t.forEachChild(na,(l,u)=>{const h=Lp(Yh(s,new Yr(l)),u);n=n.updateImmediateChild(l,h)}),hI(s).forEach(l=>{n=n.updateImmediateChild(l.name,l.node)}),n}else{const s=Yh(i.visibleWrites,e);return hI(s).forEach(l=>{n=n.updateImmediateChild(l.name,l.node)}),n}}function PU(i,e,t,n,r){Kt(n||r,"Either existingEventSnap or existingServerSnap must exist");const s=ta(e,t);if(Lx(i.visibleWrites,s))return null;{const l=Yh(i.visibleWrites,s);return Nx(l)?r.getChild(t):Lp(l,r.getChild(t))}}function OU(i,e,t,n){const r=ta(e,t),s=gf(i.visibleWrites,r);if(s!=null)return s;if(n.isCompleteForChild(t)){const l=Yh(i.visibleWrites,r);return Lp(l,n.getNode().getImmediateChild(t))}else return null}function MU(i,e){return gf(i.visibleWrites,e)}function FU(i,e,t,n,r,s,l){let u;const h=Yh(i.visibleWrites,e),f=gf(h,yr());if(f!=null)u=f;else if(t!=null)u=Lp(h,t);else return[];if(u=u.withIndex(l),!u.isEmpty()&&!u.isLeafNode()){const x=[],p=l.getCompare(),w=s?u.getReverseIteratorFrom(n,l):u.getIteratorFrom(n,l);let A=w.getNext();for(;A&&x.length<r;)p(A,n)!==0&&x.push(A),A=w.getNext();return x}else return[]}function jU(){return{visibleWrites:Lu.empty(),allWrites:[],lastWriteId:-1}}function T1(i,e,t,n){return bL(i.writeTree,i.treePath,e,t,n)}function Lw(i,e){return NU(i.writeTree,i.treePath,e)}function dI(i,e,t,n){return PU(i.writeTree,i.treePath,e,t,n)}function A1(i,e){return MU(i.writeTree,ta(i.treePath,e))}function VU(i,e,t,n,r,s){return FU(i.writeTree,i.treePath,e,t,n,r,s)}function Nw(i,e,t){return OU(i.writeTree,i.treePath,e,t)}function xL(i,e){return wL(ta(i.treePath,e),i.writeTree)}function wL(i,e){return{treePath:i,writeTree:e}}class zU{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Kt(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Kt(n!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(n,Im(n,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(n,Em(n,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(n,Rp(n,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(n,Im(n,e.snapshotNode,r.oldSnap));else throw Fp("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}class UU{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}const SL=new UU;class Pw{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new ad(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Nw(this.writes_,e,n)}}getChildAfterChild(e,t,n){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:af(this.viewCache_),s=VU(this.writes_,r,t,1,n,e);return s.length===0?null:s[0]}}function BU(i){return{filter:i}}function $U(i,e){Kt(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),Kt(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function HU(i,e,t,n,r){const s=new zU;let l,u;if(t.type===Ru.OVERWRITE){const f=t;f.source.fromUser?l=Px(i,e,f.path,f.snap,n,r,s):(Kt(f.source.fromServer,"Unknown source."),u=f.source.tagged||e.serverCache.isFiltered()&&!Wi(f.path),l=E1(i,e,f.path,f.snap,n,r,u,s))}else if(t.type===Ru.MERGE){const f=t;f.source.fromUser?l=KU(i,e,f.path,f.children,n,r,s):(Kt(f.source.fromServer,"Unknown source."),u=f.source.tagged||e.serverCache.isFiltered(),l=Ox(i,e,f.path,f.children,n,r,u,s))}else if(t.type===Ru.ACK_USER_WRITE){const f=t;f.revert?l=YU(i,e,f.path,n,r,s):l=WU(i,e,f.path,f.affectedTree,n,r,s)}else if(t.type===Ru.LISTEN_COMPLETE)l=qU(i,e,t.path,n,s);else throw Fp("Unknown operation type: "+t.type);const h=s.getChanges();return GU(e,l,h),{viewCache:l,changes:h}}function GU(i,e,t){const n=e.eventCache;if(n.isFullyInitialized()){const r=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=S1(i);(t.length>0||!i.eventCache.isFullyInitialized()||r&&!n.getNode().equals(s)||!n.getNode().getPriority().equals(s.getPriority()))&&t.push(gL(S1(e)))}}function TL(i,e,t,n,r,s){const l=e.eventCache;if(A1(n,t)!=null)return e;{let u,h;if(Wi(t))if(Kt(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const f=af(e),x=f instanceof ni?f:ni.EMPTY_NODE,p=Lw(n,x);u=i.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{const f=T1(n,af(e));u=i.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{const f=ji(t);if(f===".priority"){Kt(sd(t)===1,"Can't have a priority with additional path components");const x=l.getNode();h=e.serverCache.getNode();const p=dI(n,t,x,h);p!=null?u=i.filter.updatePriority(x,p):u=l.getNode()}else{const x=ls(t);let p;if(l.isCompleteForChild(f)){h=e.serverCache.getNode();const w=dI(n,t,l.getNode(),h);w!=null?p=l.getNode().getImmediateChild(f).updateChild(x,w):p=l.getNode().getImmediateChild(f)}else p=Nw(n,f,e.serverCache);p!=null?u=i.filter.updateChild(l.getNode(),f,p,x,r,s):u=l.getNode()}}return em(e,u,l.isFullyInitialized()||Wi(t),i.filter.filtersNodes())}}function E1(i,e,t,n,r,s,l,u){const h=e.serverCache;let f;const x=l?i.filter:i.filter.getIndexedFilter();if(Wi(t))f=x.updateFullNode(h.getNode(),n,null);else if(x.filtersNodes()&&!h.isFiltered()){const A=h.getNode().updateChild(t,n);f=x.updateFullNode(h.getNode(),A,null)}else{const A=ji(t);if(!h.isCompleteForPath(t)&&sd(t)>1)return e;const B=ls(t),W=h.getNode().getImmediateChild(A).updateChild(B,n);A===".priority"?f=x.updatePriority(h.getNode(),W):f=x.updateChild(h.getNode(),A,W,B,SL,null)}const p=yL(e,f,h.isFullyInitialized()||Wi(t),x.filtersNodes()),w=new Pw(r,p,s);return TL(i,p,t,r,w,u)}function Px(i,e,t,n,r,s,l){const u=e.eventCache;let h,f;const x=new Pw(r,e,s);if(Wi(t))f=i.filter.updateFullNode(e.eventCache.getNode(),n,l),h=em(e,f,!0,i.filter.filtersNodes());else{const p=ji(t);if(p===".priority")f=i.filter.updatePriority(e.eventCache.getNode(),n),h=em(e,f,u.isFullyInitialized(),u.isFiltered());else{const w=ls(t),A=u.getNode().getImmediateChild(p);let B;if(Wi(w))B=n;else{const $=x.getCompleteChild(p);$!=null?Sw(w)===".priority"&&$.getChild(lL(w)).isEmpty()?B=$:B=$.updateChild(w,n):B=ni.EMPTY_NODE}if(A.equals(B))h=e;else{const $=i.filter.updateChild(u.getNode(),p,B,w,x,l);h=em(e,$,u.isFullyInitialized(),i.filter.filtersNodes())}}}return h}function fI(i,e){return i.eventCache.isCompleteForChild(e)}function KU(i,e,t,n,r,s,l){let u=e;return n.foreach((h,f)=>{const x=ta(t,h);fI(e,ji(x))&&(u=Px(i,u,x,f,r,s,l))}),n.foreach((h,f)=>{const x=ta(t,h);fI(e,ji(x))||(u=Px(i,u,x,f,r,s,l))}),u}function pI(i,e,t){return t.foreach((n,r)=>{e=e.updateChild(n,r)}),e}function Ox(i,e,t,n,r,s,l,u){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h=e,f;Wi(t)?f=n:f=new os(null).setTree(t,n);const x=e.serverCache.getNode();return f.children.inorderTraversal((p,w)=>{if(x.hasChild(p)){const A=e.serverCache.getNode().getImmediateChild(p),B=pI(i,A,w);h=E1(i,h,new Yr(p),B,r,s,l,u)}}),f.children.inorderTraversal((p,w)=>{const A=!e.serverCache.isCompleteForChild(p)&&w.value===null;if(!x.hasChild(p)&&!A){const B=e.serverCache.getNode().getImmediateChild(p),$=pI(i,B,w);h=E1(i,h,new Yr(p),$,r,s,l,u)}}),h}function WU(i,e,t,n,r,s,l){if(A1(r,t)!=null)return e;const u=e.serverCache.isFiltered(),h=e.serverCache;if(n.value!=null){if(Wi(t)&&h.isFullyInitialized()||h.isCompleteForPath(t))return E1(i,e,t,h.getNode().getChild(t),r,s,u,l);if(Wi(t)){let f=new os(null);return h.getNode().forEachChild(lp,(x,p)=>{f=f.set(new Yr(x),p)}),Ox(i,e,t,f,r,s,u,l)}else return e}else{let f=new os(null);return n.foreach((x,p)=>{const w=ta(t,x);h.isCompleteForPath(w)&&(f=f.set(x,h.getNode().getChild(w)))}),Ox(i,e,t,f,r,s,u,l)}}function qU(i,e,t,n,r){const s=e.serverCache,l=yL(e,s.getNode(),s.isFullyInitialized()||Wi(t),s.isFiltered());return TL(i,l,t,n,SL,r)}function YU(i,e,t,n,r,s){let l;if(A1(n,t)!=null)return e;{const u=new Pw(n,e,r),h=e.eventCache.getNode();let f;if(Wi(t)||ji(t)===".priority"){let x;if(e.serverCache.isFullyInitialized())x=T1(n,af(e));else{const p=e.serverCache.getNode();Kt(p instanceof ni,"serverChildren would be complete if leaf node"),x=Lw(n,p)}x=x,f=i.filter.updateFullNode(h,x,s)}else{const x=ji(t);let p=Nw(n,x,e.serverCache);p==null&&e.serverCache.isCompleteForChild(x)&&(p=h.getImmediateChild(x)),p!=null?f=i.filter.updateChild(h,x,p,ls(t),u,s):e.eventCache.getNode().hasChild(x)?f=i.filter.updateChild(h,x,ni.EMPTY_NODE,ls(t),u,s):f=h,f.isEmpty()&&e.serverCache.isFullyInitialized()&&(l=T1(n,af(e)),l.isLeafNode()&&(f=i.filter.updateFullNode(f,l,s)))}return l=e.serverCache.isFullyInitialized()||A1(n,yr())!=null,em(e,f,l,i.filter.filtersNodes())}}class XU{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Iw(n.getIndex()),s=pU(n);this.processor_=BU(s);const l=t.serverCache,u=t.eventCache,h=r.updateFullNode(ni.EMPTY_NODE,l.getNode(),null),f=s.updateFullNode(ni.EMPTY_NODE,u.getNode(),null),x=new ad(h,l.isFullyInitialized(),r.filtersNodes()),p=new ad(f,u.isFullyInitialized(),s.filtersNodes());this.viewCache_=mv(p,x),this.eventGenerator_=new xU(this.query_)}get query(){return this.query_}}function JU(i){return i.viewCache_.serverCache.getNode()}function QU(i){return S1(i.viewCache_)}function ZU(i,e){const t=af(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!Wi(e)&&!t.getImmediateChild(ji(e)).isEmpty())?t.getChild(e):null}function gI(i){return i.eventRegistrations_.length===0}function eB(i,e){i.eventRegistrations_.push(e)}function mI(i,e,t){const n=[];if(t){Kt(e==null,"A cancel should cancel all event registrations.");const r=i.query._path;i.eventRegistrations_.forEach(s=>{const l=s.createCancelEvent(t,r);l&&n.push(l)})}if(e){let r=[];for(let s=0;s<i.eventRegistrations_.length;++s){const l=i.eventRegistrations_[s];if(!l.matches(e))r.push(l);else if(e.hasAnyCallback()){r=r.concat(i.eventRegistrations_.slice(s+1));break}}i.eventRegistrations_=r}else i.eventRegistrations_=[];return n}function yI(i,e,t,n){e.type===Ru.MERGE&&e.source.queryId!==null&&(Kt(af(i.viewCache_),"We should always have a full cache before handling merges"),Kt(S1(i.viewCache_),"Missing event cache, even though we have a server cache"));const r=i.viewCache_,s=HU(i.processor_,r,e,t,n);return $U(i.processor_,s.viewCache),Kt(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=s.viewCache,AL(i,s.changes,s.viewCache.eventCache.getNode(),null)}function tB(i,e){const t=i.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(na,(s,l)=>{n.push(Rp(s,l))}),t.isFullyInitialized()&&n.push(gL(t.getNode())),AL(i,n,t.getNode(),e)}function AL(i,e,t,n){const r=n?[n]:i.eventRegistrations_;return wU(i.eventGenerator_,e,t,r)}let I1;class EL{constructor(){this.views=new Map}}function nB(i){Kt(!I1,"__referenceConstructor has already been defined"),I1=i}function iB(){return Kt(I1,"Reference.ts has not been loaded"),I1}function rB(i){return i.views.size===0}function Ow(i,e,t,n){const r=e.source.queryId;if(r!==null){const s=i.views.get(r);return Kt(s!=null,"SyncTree gave us an op for an invalid query."),yI(s,e,t,n)}else{let s=[];for(const l of i.views.values())s=s.concat(yI(l,e,t,n));return s}}function IL(i,e,t,n,r){const s=e._queryIdentifier,l=i.views.get(s);if(!l){let u=T1(t,r?n:null),h=!1;u?h=!0:n instanceof ni?(u=Lw(t,n),h=!1):(u=ni.EMPTY_NODE,h=!1);const f=mv(new ad(u,h,!1),new ad(n,r,!1));return new XU(e,f)}return l}function sB(i,e,t,n,r,s){const l=IL(i,e,n,r,s);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,l),eB(l,t),tB(l,t)}function aB(i,e,t,n){const r=e._queryIdentifier,s=[];let l=[];const u=od(i);if(r==="default")for(const[h,f]of i.views.entries())l=l.concat(mI(f,t,n)),gI(f)&&(i.views.delete(h),f.query._queryParams.loadsAllData()||s.push(f.query));else{const h=i.views.get(r);h&&(l=l.concat(mI(h,t,n)),gI(h)&&(i.views.delete(r),h.query._queryParams.loadsAllData()||s.push(h.query)))}return u&&!od(i)&&s.push(new(iB())(e._repo,e._path)),{removed:s,events:l}}function kL(i){const e=[];for(const t of i.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Xh(i,e){let t=null;for(const n of i.views.values())t=t||ZU(n,e);return t}function CL(i,e){if(e._queryParams.loadsAllData())return vv(i);{const n=e._queryIdentifier;return i.views.get(n)}}function RL(i,e){return CL(i,e)!=null}function od(i){return vv(i)!=null}function vv(i){for(const e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let k1;function oB(i){Kt(!k1,"__referenceConstructor has already been defined"),k1=i}function lB(){return Kt(k1,"Reference.ts has not been loaded"),k1}let uB=1;class vI{constructor(e){this.listenProvider_=e,this.syncPointTree_=new os(null),this.pendingWriteTree_=jU(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function DL(i,e,t,n,r){return EU(i.pendingWriteTree_,e,t,n,r),r?Gp(i,new sf(Cw(),e,t)):[]}function cB(i,e,t,n){IU(i.pendingWriteTree_,e,t,n);const r=os.fromObject(t);return Gp(i,new Dp(Cw(),e,r))}function zh(i,e,t=!1){const n=kU(i.pendingWriteTree_,e);if(CU(i.pendingWriteTree_,e)){let s=new os(null);return n.snap!=null?s=s.set(yr(),!0):So(n.children,l=>{s=s.set(new Yr(l),!0)}),Gp(i,new w1(n.path,s,t))}else return[]}function iy(i,e,t){return Gp(i,new sf(Rw(),e,t))}function hB(i,e,t){const n=os.fromObject(t);return Gp(i,new Dp(Rw(),e,n))}function dB(i,e){return Gp(i,new Cm(Rw(),e))}function fB(i,e,t){const n=Fw(i,t);if(n){const r=jw(n),s=r.path,l=r.queryId,u=Zo(s,e),h=new Cm(Dw(l),u);return Vw(i,s,h)}else return[]}function C1(i,e,t,n,r=!1){const s=e._path,l=i.syncPointTree_.get(s);let u=[];if(l&&(e._queryIdentifier==="default"||RL(l,e))){const h=aB(l,e,t,n);rB(l)&&(i.syncPointTree_=i.syncPointTree_.remove(s));const f=h.removed;if(u=h.events,!r){const x=f.findIndex(w=>w._queryParams.loadsAllData())!==-1,p=i.syncPointTree_.findOnPath(s,(w,A)=>od(A));if(x&&!p){const w=i.syncPointTree_.subtree(s);if(!w.isEmpty()){const A=mB(w);for(let B=0;B<A.length;++B){const $=A[B],W=$.query,q=OL(i,$);i.listenProvider_.startListening(nm(W),Rm(i,W),q.hashFn,q.onComplete)}}}!p&&f.length>0&&!n&&(x?i.listenProvider_.stopListening(nm(e),null):f.forEach(w=>{const A=i.queryToTagMap.get(_v(w));i.listenProvider_.stopListening(nm(w),A)}))}yB(i,f)}return u}function LL(i,e,t,n){const r=Fw(i,n);if(r!=null){const s=jw(r),l=s.path,u=s.queryId,h=Zo(l,e),f=new sf(Dw(u),h,t);return Vw(i,l,f)}else return[]}function pB(i,e,t,n){const r=Fw(i,n);if(r){const s=jw(r),l=s.path,u=s.queryId,h=Zo(l,e),f=os.fromObject(t),x=new Dp(Dw(u),h,f);return Vw(i,l,x)}else return[]}function Mx(i,e,t,n=!1){const r=e._path;let s=null,l=!1;i.syncPointTree_.foreachOnPath(r,(w,A)=>{const B=Zo(w,r);s=s||Xh(A,B),l=l||od(A)});let u=i.syncPointTree_.get(r);u?(l=l||od(u),s=s||Xh(u,yr())):(u=new EL,i.syncPointTree_=i.syncPointTree_.set(r,u));let h;s!=null?h=!0:(h=!1,s=ni.EMPTY_NODE,i.syncPointTree_.subtree(r).foreachChild((A,B)=>{const $=Xh(B,yr());$&&(s=s.updateImmediateChild(A,$))}));const f=RL(u,e);if(!f&&!e._queryParams.loadsAllData()){const w=_v(e);Kt(!i.queryToTagMap.has(w),"View does not exist, but we have a tag");const A=vB();i.queryToTagMap.set(w,A),i.tagToQueryMap.set(A,w)}const x=yv(i.pendingWriteTree_,r);let p=sB(u,e,t,x,s,h);if(!f&&!l&&!n){const w=CL(u,e);p=p.concat(_B(i,e,w))}return p}function Mw(i,e,t){const r=i.pendingWriteTree_,s=i.syncPointTree_.findOnPath(e,(l,u)=>{const h=Zo(l,e),f=Xh(u,h);if(f)return f});return bL(r,e,s,t,!0)}function gB(i,e){const t=e._path;let n=null;i.syncPointTree_.foreachOnPath(t,(f,x)=>{const p=Zo(f,t);n=n||Xh(x,p)});let r=i.syncPointTree_.get(t);r?n=n||Xh(r,yr()):(r=new EL,i.syncPointTree_=i.syncPointTree_.set(t,r));const s=n!=null,l=s?new ad(n,!0,!1):null,u=yv(i.pendingWriteTree_,e._path),h=IL(r,e,u,s?l.getNode():ni.EMPTY_NODE,s);return QU(h)}function Gp(i,e){return NL(e,i.syncPointTree_,null,yv(i.pendingWriteTree_,yr()))}function NL(i,e,t,n){if(Wi(i.path))return PL(i,e,t,n);{const r=e.get(yr());t==null&&r!=null&&(t=Xh(r,yr()));let s=[];const l=ji(i.path),u=i.operationForChild(l),h=e.children.get(l);if(h&&u){const f=t?t.getImmediateChild(l):null,x=xL(n,l);s=s.concat(NL(u,h,f,x))}return r&&(s=s.concat(Ow(r,i,n,t))),s}}function PL(i,e,t,n){const r=e.get(yr());t==null&&r!=null&&(t=Xh(r,yr()));let s=[];return e.children.inorderTraversal((l,u)=>{const h=t?t.getImmediateChild(l):null,f=xL(n,l),x=i.operationForChild(l);x&&(s=s.concat(PL(x,u,h,f)))}),r&&(s=s.concat(Ow(r,i,n,t))),s}function OL(i,e){const t=e.query,n=Rm(i,t);return{hashFn:()=>(JU(e)||ni.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return n?fB(i,t._path,n):dB(i,t._path);{const s=dz(r,t);return C1(i,t,null,s)}}}}function Rm(i,e){const t=_v(e);return i.queryToTagMap.get(t)}function _v(i){return i._path.toString()+"$"+i._queryIdentifier}function Fw(i,e){return i.tagToQueryMap.get(e)}function jw(i){const e=i.indexOf("$");return Kt(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new Yr(i.substr(0,e))}}function Vw(i,e,t){const n=i.syncPointTree_.get(e);Kt(n,"Missing sync point for query tag that we're tracking");const r=yv(i.pendingWriteTree_,e);return Ow(n,t,r,null)}function mB(i){return i.fold((e,t,n)=>{if(t&&od(t))return[vv(t)];{let r=[];return t&&(r=kL(t)),So(n,(s,l)=>{r=r.concat(l)}),r}})}function nm(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(lB())(i._repo,i._path):i}function yB(i,e){for(let t=0;t<e.length;++t){const n=e[t];if(!n._queryParams.loadsAllData()){const r=_v(n),s=i.queryToTagMap.get(r);i.queryToTagMap.delete(r),i.tagToQueryMap.delete(s)}}}function vB(){return uB++}function _B(i,e,t){const n=e._path,r=Rm(i,e),s=OL(i,t),l=i.listenProvider_.startListening(nm(e),r,s.hashFn,s.onComplete),u=i.syncPointTree_.subtree(n);if(r)Kt(!od(u.value),"If we're adding a query, it shouldn't be shadowed");else{const h=u.fold((f,x,p)=>{if(!Wi(f)&&x&&od(x))return[vv(x).query];{let w=[];return x&&(w=w.concat(kL(x).map(A=>A.query))),So(p,(A,B)=>{w=w.concat(B)}),w}});for(let f=0;f<h.length;++f){const x=h[f];i.listenProvider_.stopListening(nm(x),Rm(i,x))}}return l}class zw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new zw(t)}node(){return this.node_}}class Uw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ta(this.path_,e);return new Uw(this.syncTree_,t)}node(){return Mw(this.syncTree_,this.path_)}}const bB=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},_I=function(i,e,t){if(!i||typeof i!="object")return i;if(Kt(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return xB(i[".sv"],e,t);if(typeof i[".sv"]=="object")return wB(i[".sv"],e);Kt(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},xB=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:Kt(!1,"Unexpected server value: "+i)}},wB=function(i,e,t){i.hasOwnProperty("increment")||Kt(!1,"Unexpected server value: "+JSON.stringify(i,null,2));const n=i.increment;typeof n!="number"&&Kt(!1,"Unexpected increment value: "+n);const r=e.node();if(Kt(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return n;const l=r.getValue();return typeof l!="number"?n:l+n},ML=function(i,e,t,n){return Bw(e,new Uw(t,i),n)},FL=function(i,e,t){return Bw(i,new zw(e),t)};function Bw(i,e,t){const n=i.getPriority().val(),r=_I(n,e.getImmediateChild(".priority"),t);let s;if(i.isLeafNode()){const l=i,u=_I(l.getValue(),e,t);return u!==l.getValue()||r!==l.getPriority().val()?new eo(u,ja(r)):i}else{const l=i;return s=l,r!==l.getPriority().val()&&(s=s.updatePriority(new eo(r))),l.forEachChild(na,(u,h)=>{const f=Bw(h,e.getImmediateChild(u),t);f!==h&&(s=s.updateImmediateChild(u,f))}),s}}class $w{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Hw(i,e){let t=e instanceof Yr?e:new Yr(e),n=i,r=ji(t);for(;r!==null;){const s=pp(n.node.children,r)||{children:{},childCount:0};n=new $w(r,n,s),t=ls(t),r=ji(t)}return n}function Kp(i){return i.node.value}function jL(i,e){i.node.value=e,Fx(i)}function VL(i){return i.node.childCount>0}function SB(i){return Kp(i)===void 0&&!VL(i)}function bv(i,e){So(i.node.children,(t,n)=>{e(new $w(t,i,n))})}function zL(i,e,t,n){t&&e(i),bv(i,r=>{zL(r,e,!0)})}function TB(i,e,t){let n=i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function ry(i){return new Yr(i.parent===null?i.name:ry(i.parent)+"/"+i.name)}function Fx(i){i.parent!==null&&AB(i.parent,i.name,i)}function AB(i,e,t){const n=SB(t),r=uc(i.node.children,e);n&&r?(delete i.node.children[e],i.node.childCount--,Fx(i)):!n&&!r&&(i.node.children[e]=t.node,i.node.childCount++,Fx(i))}const EB=/[\[\].#$\/\u0000-\u001F\u007F]/,IB=/[\[\].#$\u0000-\u001F\u007F]/,cb=10*1024*1024,Gw=function(i){return typeof i=="string"&&i.length!==0&&!EB.test(i)},UL=function(i){return typeof i=="string"&&i.length!==0&&!IB.test(i)},kB=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),UL(i)},CB=function(i){return i===null||typeof i=="string"||typeof i=="number"&&!vw(i)||i&&typeof i=="object"&&uc(i,".sv")},RB=function(i,e,t,n){xv(B1(i,"value"),e,t)},xv=function(i,e,t){const n=t instanceof Yr?new Kz(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+Rd(n));if(typeof e=="function")throw new Error(i+"contains a function "+Rd(n)+" with contents = "+e.toString());if(vw(e))throw new Error(i+"contains "+e.toString()+" "+Rd(n));if(typeof e=="string"&&e.length>cb/3&&$1(e)>cb)throw new Error(i+"contains a string greater than "+cb+" utf8 bytes "+Rd(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(So(e,(l,u)=>{if(l===".value")r=!0;else if(l!==".priority"&&l!==".sv"&&(s=!0,!Gw(l)))throw new Error(i+" contains an invalid key ("+l+") "+Rd(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Wz(n,l),xv(i,u,n),qz(n)}),r&&s)throw new Error(i+' contains ".value" child '+Rd(n)+" in addition to actual children.")}},DB=function(i,e){let t,n;for(t=0;t<e.length;t++){n=e[t];const s=Am(n);for(let l=0;l<s.length;l++)if(!(s[l]===".priority"&&l===s.length-1)){if(!Gw(s[l]))throw new Error(i+"contains an invalid key ("+s[l]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Gz);let r=null;for(t=0;t<e.length;t++){if(n=e[t],r!==null&&au(r,n))throw new Error(i+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}},LB=function(i,e,t,n){const r=B1(i,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const s=[];So(e,(l,u)=>{const h=new Yr(l);if(xv(r,u,ta(t,h)),Sw(h)===".priority"&&!CB(u))throw new Error(r+"contains an invalid value for '"+h.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(h)}),DB(r,s)},BL=function(i,e,t,n){if(!UL(t))throw new Error(B1(i,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},NB=function(i,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),BL(i,e,t)},$L=function(i,e){if(ji(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},PB=function(i,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Gw(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!kB(t))throw new Error(B1(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class OB{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function wv(i,e){let t=null;for(let n=0;n<e.length;n++){const r=e[n],s=r.getPath();t!==null&&!Tw(s,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&i.eventLists_.push(t)}function HL(i,e,t){wv(i,t),GL(i,n=>Tw(n,e))}function hu(i,e,t){wv(i,t),GL(i,n=>au(n,e)||au(e,n))}function GL(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){const r=i.eventLists_[n];if(r){const s=r.path;e(s)?(MB(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function MB(i){for(let e=0;e<i.events.length;e++){const t=i.events[e];if(t!==null){i.events[e]=null;const n=t.getEventRunner();Qg&&xo("event: "+t.toString()),Hp(n)}}}const FB="repo_interrupt",jB=25;class VB{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new OB,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=x1(),this.transactionQueueTree_=new $w,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function zB(i,e,t){if(i.stats_=xw(i.repoInfo_),i.forceRestClient_||mz())i.server_=new b1(i.repoInfo_,(n,r,s,l)=>{bI(i,n,r,s,l)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>xI(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Va(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new Kc(i.repoInfo_,e,(n,r,s,l)=>{bI(i,n,r,s,l)},n=>{xI(i,n)},n=>{BB(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=xz(i.repoInfo_,()=>new bU(i.stats_,i.server_)),i.infoData_=new gU,i.infoSyncTree_=new vI({startListening:(n,r,s,l)=>{let u=[];const h=i.infoData_.getNode(n._path);return h.isEmpty()||(u=iy(i.infoSyncTree_,n._path,h),setTimeout(()=>{l("ok")},0)),u},stopListening:()=>{}}),Kw(i,"connected",!1),i.serverSyncTree_=new vI({startListening:(n,r,s,l)=>(i.server_.listen(n,s,r,(u,h)=>{const f=l(u,h);hu(i.eventQueue_,n._path,f)}),[]),stopListening:(n,r)=>{i.server_.unlisten(n,r)}})}function UB(i){const t=i.infoData_.getNode(new Yr(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Sv(i){return bB({timestamp:UB(i)})}function bI(i,e,t,n,r){i.dataUpdateCount++;const s=new Yr(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let l=[];if(r)if(n){const h=K0(t,f=>ja(f));l=pB(i.serverSyncTree_,s,h,r)}else{const h=ja(t);l=LL(i.serverSyncTree_,s,h,r)}else if(n){const h=K0(t,f=>ja(f));l=hB(i.serverSyncTree_,s,h)}else{const h=ja(t);l=iy(i.serverSyncTree_,s,h)}let u=s;l.length>0&&(u=Np(i,s)),hu(i.eventQueue_,u,l)}function xI(i,e){Kw(i,"connected",e),e===!1&&KB(i)}function BB(i,e){So(e,(t,n)=>{Kw(i,t,n)})}function Kw(i,e,t){const n=new Yr("/.info/"+e),r=ja(t);i.infoData_.updateSnapshot(n,r);const s=iy(i.infoSyncTree_,n,r);hu(i.eventQueue_,n,s)}function Ww(i){return i.nextWriteId_++}function $B(i,e,t){const n=gB(i.serverSyncTree_,e);return n!=null?Promise.resolve(n):i.server_.get(e).then(r=>{const s=ja(r).withIndex(e._queryParams.getIndex());Mx(i.serverSyncTree_,e,t,!0);let l;if(e._queryParams.loadsAllData())l=iy(i.serverSyncTree_,e._path,s);else{const u=Rm(i.serverSyncTree_,e);l=LL(i.serverSyncTree_,e._path,s,u)}return hu(i.eventQueue_,e._path,l),C1(i.serverSyncTree_,e,t,null,!0),s},r=>(sy(i,"get for query "+Va(e)+" failed: "+r),Promise.reject(new Error(r))))}function HB(i,e,t,n,r){sy(i,"set",{path:e.toString(),value:t,priority:n});const s=Sv(i),l=ja(t,n),u=Mw(i.serverSyncTree_,e),h=FL(l,u,s),f=Ww(i),x=DL(i.serverSyncTree_,e,h,f,!0);wv(i.eventQueue_,x),i.server_.put(e.toString(),l.val(!0),(w,A)=>{const B=w==="ok";B||tl("set at "+e+" failed: "+w);const $=zh(i.serverSyncTree_,f,!B);hu(i.eventQueue_,e,$),jx(i,r,w,A)});const p=Yw(i,e);Np(i,p),hu(i.eventQueue_,p,[])}function GB(i,e,t,n){sy(i,"update",{path:e.toString(),value:t});let r=!0;const s=Sv(i),l={};if(So(t,(u,h)=>{r=!1,l[u]=ML(ta(e,u),ja(h),i.serverSyncTree_,s)}),r)xo("update() called with empty data.  Don't do anything."),jx(i,n,"ok",void 0);else{const u=Ww(i),h=cB(i.serverSyncTree_,e,l,u);wv(i.eventQueue_,h),i.server_.merge(e.toString(),t,(f,x)=>{const p=f==="ok";p||tl("update at "+e+" failed: "+f);const w=zh(i.serverSyncTree_,u,!p),A=w.length>0?Np(i,e):e;hu(i.eventQueue_,A,w),jx(i,n,f,x)}),So(t,f=>{const x=Yw(i,ta(e,f));Np(i,x)}),hu(i.eventQueue_,e,[])}}function KB(i){sy(i,"onDisconnectEvents");const e=Sv(i),t=x1();Rx(i.onDisconnect_,yr(),(r,s)=>{const l=ML(r,s,i.serverSyncTree_,e);mL(t,r,l)});let n=[];Rx(t,yr(),(r,s)=>{n=n.concat(iy(i.serverSyncTree_,r,s));const l=Yw(i,r);Np(i,l)}),i.onDisconnect_=x1(),hu(i.eventQueue_,yr(),n)}function WB(i,e,t){let n;ji(e._path)===".info"?n=Mx(i.infoSyncTree_,e,t):n=Mx(i.serverSyncTree_,e,t),HL(i.eventQueue_,e._path,n)}function qB(i,e,t){let n;ji(e._path)===".info"?n=C1(i.infoSyncTree_,e,t):n=C1(i.serverSyncTree_,e,t),HL(i.eventQueue_,e._path,n)}function YB(i){i.persistentConnection_&&i.persistentConnection_.interrupt(FB)}function sy(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),xo(t,...e)}function jx(i,e,t,n){e&&Hp(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let s=r;n&&(s+=": "+n);const l=new Error(s);l.code=r,e(l)}})}function KL(i,e,t){return Mw(i.serverSyncTree_,e,t)||ni.EMPTY_NODE}function qw(i,e=i.transactionQueueTree_){if(e||Tv(i,e),Kp(e)){const t=qL(i,e);Kt(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&XB(i,ry(e),t)}else VL(e)&&bv(e,t=>{qw(i,t)})}function XB(i,e,t){const n=t.map(f=>f.currentWriteId),r=KL(i,e,n);let s=r;const l=r.hash();for(let f=0;f<t.length;f++){const x=t[f];Kt(x.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),x.status=1,x.retryCount++;const p=Zo(e,x.path);s=s.updateChild(p,x.currentOutputSnapshotRaw)}const u=s.val(!0),h=e;i.server_.put(h.toString(),u,f=>{sy(i,"transaction put response",{path:h.toString(),status:f});let x=[];if(f==="ok"){const p=[];for(let w=0;w<t.length;w++)t[w].status=2,x=x.concat(zh(i.serverSyncTree_,t[w].currentWriteId)),t[w].onComplete&&p.push(()=>t[w].onComplete(null,!0,t[w].currentOutputSnapshotResolved)),t[w].unwatcher();Tv(i,Hw(i.transactionQueueTree_,e)),qw(i,i.transactionQueueTree_),hu(i.eventQueue_,e,x);for(let w=0;w<p.length;w++)Hp(p[w])}else{if(f==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{tl("transaction at "+h.toString()+" failed: "+f);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=f}Np(i,e)}},l)}function Np(i,e){const t=WL(i,e),n=ry(t),r=qL(i,t);return JB(i,r,n),n}function JB(i,e,t){if(e.length===0)return;const n=[];let r=[];const l=e.filter(u=>u.status===0).map(u=>u.currentWriteId);for(let u=0;u<e.length;u++){const h=e[u],f=Zo(t,h.path);let x=!1,p;if(Kt(f!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===4)x=!0,p=h.abortReason,r=r.concat(zh(i.serverSyncTree_,h.currentWriteId,!0));else if(h.status===0)if(h.retryCount>=jB)x=!0,p="maxretry",r=r.concat(zh(i.serverSyncTree_,h.currentWriteId,!0));else{const w=KL(i,h.path,l);h.currentInputSnapshot=w;const A=e[u].update(w.val());if(A!==void 0){xv("transaction failed: Data returned ",A,h.path);let B=ja(A);typeof A=="object"&&A!=null&&uc(A,".priority")||(B=B.updatePriority(w.getPriority()));const W=h.currentWriteId,q=Sv(i),ge=FL(B,w,q);h.currentOutputSnapshotRaw=B,h.currentOutputSnapshotResolved=ge,h.currentWriteId=Ww(i),l.splice(l.indexOf(W),1),r=r.concat(DL(i.serverSyncTree_,h.path,ge,h.currentWriteId,h.applyLocally)),r=r.concat(zh(i.serverSyncTree_,W,!0))}else x=!0,p="nodata",r=r.concat(zh(i.serverSyncTree_,h.currentWriteId,!0))}hu(i.eventQueue_,t,r),r=[],x&&(e[u].status=2,(function(w){setTimeout(w,Math.floor(0))})(e[u].unwatcher),e[u].onComplete&&(p==="nodata"?n.push(()=>e[u].onComplete(null,!1,e[u].currentInputSnapshot)):n.push(()=>e[u].onComplete(new Error(p),!1,null))))}Tv(i,i.transactionQueueTree_);for(let u=0;u<n.length;u++)Hp(n[u]);qw(i,i.transactionQueueTree_)}function WL(i,e){let t,n=i.transactionQueueTree_;for(t=ji(e);t!==null&&Kp(n)===void 0;)n=Hw(n,t),e=ls(e),t=ji(e);return n}function qL(i,e){const t=[];return YL(i,e,t),t.sort((n,r)=>n.order-r.order),t}function YL(i,e,t){const n=Kp(e);if(n)for(let r=0;r<n.length;r++)t.push(n[r]);bv(e,r=>{YL(i,r,t)})}function Tv(i,e){const t=Kp(e);if(t){let n=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[n]=t[r],n++);t.length=n,jL(e,t.length>0?t:void 0)}bv(e,n=>{Tv(i,n)})}function Yw(i,e){const t=ry(WL(i,e)),n=Hw(i.transactionQueueTree_,e);return TB(n,r=>{hb(i,r)}),hb(i,n),zL(n,r=>{hb(i,r)}),t}function hb(i,e){const t=Kp(e);if(t){const n=[];let r=[],s=-1;for(let l=0;l<t.length;l++)t[l].status===3||(t[l].status===1?(Kt(s===l-1,"All SENT items should be at beginning of queue."),s=l,t[l].status=3,t[l].abortReason="set"):(Kt(t[l].status===0,"Unexpected transaction status in abort"),t[l].unwatcher(),r=r.concat(zh(i.serverSyncTree_,t[l].currentWriteId,!0)),t[l].onComplete&&n.push(t[l].onComplete.bind(null,new Error("set"),!1,null))));s===-1?jL(e,void 0):t.length=s+1,hu(i.eventQueue_,ry(e),r);for(let l=0;l<n.length;l++)Hp(n[l])}}function QB(i){let e="";const t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let r=t[n];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function ZB(i){const e={};i.charAt(0)==="?"&&(i=i.substring(1));for(const t of i.split("&")){if(t.length===0)continue;const n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):tl(`Invalid query segment '${t}' in query '${i}'`)}return e}const wI=function(i,e){const t=e$(i),n=t.namespace;t.domain==="firebase.com"&&eh(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&eh("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||oz();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new ZD(t.host,t.secure,n,r,e,"",n!==t.subdomain),path:new Yr(t.pathString)}},e$=function(i){let e="",t="",n="",r="",s="",l=!0,u="https",h=443;if(typeof i=="string"){let f=i.indexOf("//");f>=0&&(u=i.substring(0,f-1),i=i.substring(f+2));let x=i.indexOf("/");x===-1&&(x=i.length);let p=i.indexOf("?");p===-1&&(p=i.length),e=i.substring(0,Math.min(x,p)),x<p&&(r=QB(i.substring(x,p)));const w=ZB(i.substring(Math.min(i.length,p)));f=e.indexOf(":"),f>=0?(l=u==="https"||u==="wss",h=parseInt(e.substring(f+1),10)):f=e.length;const A=e.slice(0,f);if(A.toLowerCase()==="localhost")t="localhost";else if(A.split(".").length<=2)t=A;else{const B=e.indexOf(".");n=e.substring(0,B).toLowerCase(),t=e.substring(B+1),s=n}"ns"in w&&(s=w.ns)}return{host:e,port:h,domain:t,subdomain:n,secure:l,scheme:u,pathString:r,namespace:s}};class t${constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Va(this.snapshot.exportVal())}}class n${constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class XL{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Kt(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Xw{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Wi(this._path)?null:Sw(this._path)}get ref(){return new rh(this._repo,this._path)}get _queryIdentifier(){const e=lI(this._queryParams),t=_w(e);return t==="{}"?"default":t}get _queryObject(){return lI(this._queryParams)}isEqual(e){if(e=us(e),!(e instanceof Xw))return!1;const t=this._repo===e._repo,n=Tw(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Hz(this._path)}}class rh extends Xw{constructor(e,t){super(e,t,new kw,!1)}get parent(){const e=lL(this._path);return e===null?null:new rh(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Dm{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Yr(e),n=Vx(this.ref,e);return new Dm(this._node.getChild(t),n,na)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,r)=>e(new Dm(r,Vx(this.ref,n),na)))}hasChild(e){const t=new Yr(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Jo(i,e){return i=us(i),i._checkNotDeleted("ref"),e!==void 0?Vx(i._root,e):i._root}function Vx(i,e){return i=us(i),ji(i._path)===null?NB("child","path",e):BL("child","path",e),new rh(i._repo,ta(i._path,e))}function i$(i){return $L("remove",i._path),Zf(i,null)}function Zf(i,e){i=us(i),$L("set",i._path),RB("set",e,i._path);const t=new Fm;return HB(i._repo,i._path,e,null,t.wrapCallback(()=>{})),t.promise}function r$(i,e){LB("update",e,i._path);const t=new Fm;return GB(i._repo,i._path,e,t.wrapCallback(()=>{})),t.promise}function Nh(i){i=us(i);const e=new XL(()=>{}),t=new Av(e);return $B(i._repo,i,t).then(n=>new Dm(n,new rh(i._repo,i._path),i._queryParams.getIndex()))}class Av{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const n=t._queryParams.getIndex();return new t$("value",this,new Dm(e.snapshotNode,new rh(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new n$(this,e,t):null}matches(e){return e instanceof Av?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function s$(i,e,t,n,r){const s=new XL(t,void 0),l=new Av(s);return WB(i._repo,i,l),()=>qB(i._repo,i,l)}function a$(i,e,t,n){return s$(i,"value",e)}nB(rh);oB(rh);const o$="FIREBASE_DATABASE_EMULATOR_HOST",zx={};let l$=!1;function u$(i,e,t,n){const r=e.lastIndexOf(":"),s=e.substring(0,r),l=oc(s);i.repoInfo_=new ZD(e,l,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0,t),n&&(i.authTokenProvider_=n)}function c$(i,e,t,n,r){let s=n||i.options.databaseURL;s===void 0&&(i.options.projectId||eh("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),xo("Using default host for project ",i.options.projectId),s=`${i.options.projectId}-default-rtdb.firebaseio.com`);let l=wI(s,r),u=l.repoInfo,h;typeof process<"u"&&HE&&(h=HE[o$]),h?(s=`http://${h}?ns=${u.namespace}`,l=wI(s,r),u=l.repoInfo):l.repoInfo.secure;const f=new vz(i.name,i.options,e);PB("Invalid Firebase Database URL",l),Wi(l.path)||eh("Database URL must point to the root of a Firebase Database (not including a child path).");const x=d$(u,i,f,new yz(i,t));return new f$(x,i)}function h$(i,e){const t=zx[e];(!t||t[i.key]!==i)&&eh(`Database ${e}(${i.repoInfo_}) has already been deleted.`),YB(i),delete t[i.key]}function d$(i,e,t,n){let r=zx[e.name];r||(r={},zx[e.name]=r);let s=r[i.toURLString()];return s&&eh("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new VB(i,l$,t,n),r[i.toURLString()]=s,s}class f${constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(zB(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rh(this._repo,yr())),this._rootInternal}_delete(){return this._rootInternal!==null&&(h$(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&eh("Cannot call "+e+" on a deleted database.")}}function JL(i=K1(),e){const t=Vm(i,"database").getImmediate({identifier:e});if(!t._instanceStarted){const n=f2("database");n&&p$(t,...n)}return t}function p$(i,e,t,n={}){i=us(i),i._checkNotDeleted("useEmulator");const r=`${e}:${t}`,s=i._repoInternal;if(i._instanceStarted){if(r===i._repoInternal.repoInfo_.host&&Qh(n,s.repoInfo_.emulatorOptions))return;eh("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let l;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&eh('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new L0(L0.OWNER);else if(n.mockUserToken){const u=typeof n.mockUserToken=="string"?n.mockUserToken:p2(n.mockUserToken,i.app.options.projectId);l=new L0(u)}oc(e)&&(z1(e),U1("Database",!0)),u$(s,r,n,l)}function g$(i){tz(cd),Zh(new qc("database",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return c$(n,r,s,t)},"PUBLIC").setMultipleInstances(!0)),ou(GE,KE,i),ou(GE,KE,"esm2020")}Kc.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};Kc.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};g$();const QL="firebasestorage.googleapis.com",ZL="storageBucket",m$=120*1e3,y$=600*1e3;class ra extends lc{constructor(e,t,n=0){super(db(e),`Firebase Storage: ${t} (${db(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ra.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return db(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ia;(function(i){i.UNKNOWN="unknown",i.OBJECT_NOT_FOUND="object-not-found",i.BUCKET_NOT_FOUND="bucket-not-found",i.PROJECT_NOT_FOUND="project-not-found",i.QUOTA_EXCEEDED="quota-exceeded",i.UNAUTHENTICATED="unauthenticated",i.UNAUTHORIZED="unauthorized",i.UNAUTHORIZED_APP="unauthorized-app",i.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",i.INVALID_CHECKSUM="invalid-checksum",i.CANCELED="canceled",i.INVALID_EVENT_NAME="invalid-event-name",i.INVALID_URL="invalid-url",i.INVALID_DEFAULT_BUCKET="invalid-default-bucket",i.NO_DEFAULT_BUCKET="no-default-bucket",i.CANNOT_SLICE_BLOB="cannot-slice-blob",i.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",i.NO_DOWNLOAD_URL="no-download-url",i.INVALID_ARGUMENT="invalid-argument",i.INVALID_ARGUMENT_COUNT="invalid-argument-count",i.APP_DELETED="app-deleted",i.INVALID_ROOT_OPERATION="invalid-root-operation",i.INVALID_FORMAT="invalid-format",i.INTERNAL_ERROR="internal-error",i.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ia||(ia={}));function db(i){return"storage/"+i}function Jw(){const i="An unknown error occurred, please check the error payload for server response.";return new ra(ia.UNKNOWN,i)}function v$(i){return new ra(ia.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")}function _$(i){return new ra(ia.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function b$(){const i="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ra(ia.UNAUTHENTICATED,i)}function x$(){return new ra(ia.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function w$(i){return new ra(ia.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")}function S$(){return new ra(ia.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function T$(){return new ra(ia.CANCELED,"User canceled the upload/download.")}function A$(i){return new ra(ia.INVALID_URL,"Invalid URL '"+i+"'.")}function E$(i){return new ra(ia.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function I$(){return new ra(ia.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+ZL+"' property when initializing the app?")}function k$(){return new ra(ia.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function C$(){return new ra(ia.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function R$(i){return new ra(ia.UNSUPPORTED_ENVIRONMENT,`${i} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ux(i){return new ra(ia.INVALID_ARGUMENT,i)}function e4(){return new ra(ia.APP_DELETED,"The Firebase app was deleted.")}function D$(i){return new ra(ia.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function im(i,e){return new ra(ia.INVALID_FORMAT,"String does not match format '"+i+"': "+e)}function kg(i){throw new ra(ia.INTERNAL_ERROR,"Internal error: "+i)}class Vl{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Vl.makeFromUrl(e,t)}catch{return new Vl(e,"")}if(n.path==="")return n;throw E$(e)}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";function s(me){me.path.charAt(me.path.length-1)==="/"&&(me.path_=me.path_.slice(0,-1))}const l="(/(.*))?$",u=new RegExp("^gs://"+r+l,"i"),h={bucket:1,path:3};function f(me){me.path_=decodeURIComponent(me.path)}const x="v[A-Za-z0-9_]+",p=t.replace(/[.]/g,"\\."),w="(/([^?#]*).*)?$",A=new RegExp(`^https?://${p}/${x}/b/${r}/o${w}`,"i"),B={bucket:1,path:3},$=t===QL?"(?:storage.googleapis.com|storage.cloud.google.com)":t,W="([^?#]*)",q=new RegExp(`^https?://${$}/${r}/${W}`,"i"),he=[{regex:u,indices:h,postModify:s},{regex:A,indices:B,postModify:f},{regex:q,indices:{bucket:1,path:2},postModify:f}];for(let me=0;me<he.length;me++){const Ce=he[me],Ve=Ce.regex.exec(e);if(Ve){const pe=Ve[Ce.indices.bucket];let ee=Ve[Ce.indices.path];ee||(ee=""),n=new Vl(pe,ee),Ce.postModify(n);break}}if(n==null)throw A$(e);return n}}class L${constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function N$(i,e,t){let n=1,r=null,s=null,l=!1,u=0;function h(){return u===2}let f=!1;function x(...W){f||(f=!0,e.apply(null,W))}function p(W){r=setTimeout(()=>{r=null,i(A,h())},W)}function w(){s&&clearTimeout(s)}function A(W,...q){if(f){w();return}if(W){w(),x.call(null,W,...q);return}if(h()||l){w(),x.call(null,W,...q);return}n<64&&(n*=2);let he;u===1?(u=2,he=0):he=(n+Math.random())*1e3,p(he)}let B=!1;function $(W){B||(B=!0,w(),!f&&(r!==null?(W||(u=2),clearTimeout(r),p(0)):W||(u=1)))}return p(0),s=setTimeout(()=>{l=!0,$(!0)},t),$}function P$(i){i(!1)}function O$(i){return i!==void 0}function M$(i){return typeof i=="object"&&!Array.isArray(i)}function Qw(i){return typeof i=="string"||i instanceof String}function SI(i){return Zw()&&i instanceof Blob}function Zw(){return typeof Blob<"u"}function TI(i,e,t,n){if(n<e)throw Ux(`Invalid value for '${i}'. Expected ${e} or greater.`);if(n>t)throw Ux(`Invalid value for '${i}'. Expected ${t} or less.`)}function Ev(i,e,t){let n=e;return t==null&&(n=`https://${e}`),`${t}://${n}/v0${i}`}function t4(i){const e=encodeURIComponent;let t="?";for(const n in i)if(i.hasOwnProperty(n)){const r=e(n)+"="+e(i[n]);t=t+r+"&"}return t=t.slice(0,-1),t}var Kd;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(Kd||(Kd={}));function F$(i,e){const t=i>=500&&i<600,r=[408,429].indexOf(i)!==-1,s=e.indexOf(i)!==-1;return t||r||s}class j${constructor(e,t,n,r,s,l,u,h,f,x,p,w=!0,A=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=l,this.callback_=u,this.errorCallback_=h,this.timeout_=f,this.progressCallback_=x,this.connectionFactory_=p,this.retry=w,this.isUsingEmulator=A,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((B,$)=>{this.resolve_=B,this.reject_=$,this.start_()})}start_(){const e=(n,r)=>{if(r){n(!1,new e0(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const l=u=>{const h=u.loaded,f=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(h,f)};this.progressCallback_!==null&&s.addUploadProgressListener(l),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(l),this.pendingConnection_=null;const u=s.getErrorCode()===Kd.NO_ERROR,h=s.getStatus();if(!u||F$(h,this.additionalRetryCodes_)&&this.retry){const x=s.getErrorCode()===Kd.ABORT;n(!1,new e0(!1,null,x));return}const f=this.successCodes_.indexOf(h)!==-1;n(!0,new e0(f,s))})},t=(n,r)=>{const s=this.resolve_,l=this.reject_,u=r.connection;if(r.wasSuccessCode)try{const h=this.callback_(u,u.getResponse());O$(h)?s(h):s()}catch(h){l(h)}else if(u!==null){const h=Jw();h.serverResponse=u.getErrorText(),this.errorCallback_?l(this.errorCallback_(u,h)):l(h)}else if(r.canceled){const h=this.appDelete_?e4():T$();l(h)}else{const h=S$();l(h)}};this.canceled_?t(!1,new e0(!1,null,!0)):this.backoffId_=N$(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&P$(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class e0{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function V$(i,e){e!==null&&e.length>0&&(i.Authorization="Firebase "+e)}function z$(i,e){i["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function U$(i,e){e&&(i["X-Firebase-GMPID"]=e)}function B$(i,e){e!==null&&(i["X-Firebase-AppCheck"]=e)}function $$(i,e,t,n,r,s,l=!0,u=!1){const h=t4(i.urlParams),f=i.url+h,x=Object.assign({},i.headers);return U$(x,e),V$(x,t),z$(x,s),B$(x,n),new j$(f,i.method,x,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,r,l,u)}function H$(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function G$(...i){const e=H$();if(e!==void 0){const t=new e;for(let n=0;n<i.length;n++)t.append(i[n]);return t.getBlob()}else{if(Zw())return new Blob(i);throw new ra(ia.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function K$(i,e,t){return i.webkitSlice?i.webkitSlice(e,t):i.mozSlice?i.mozSlice(e,t):i.slice?i.slice(e,t):null}function W$(i){if(typeof atob>"u")throw R$("base-64");return atob(i)}const Qu={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class fb{constructor(e,t){this.data=e,this.contentType=t||null}}function q$(i,e){switch(i){case Qu.RAW:return new fb(n4(e));case Qu.BASE64:case Qu.BASE64URL:return new fb(i4(i,e));case Qu.DATA_URL:return new fb(X$(e),J$(e))}throw Jw()}function n4(i){const e=[];for(let t=0;t<i.length;t++){let n=i.charCodeAt(t);if(n<=127)e.push(n);else if(n<=2047)e.push(192|n>>6,128|n&63);else if((n&64512)===55296)if(!(t<i.length-1&&(i.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const s=n,l=i.charCodeAt(++t);n=65536|(s&1023)<<10|l&1023,e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}else(n&64512)===56320?e.push(239,191,189):e.push(224|n>>12,128|n>>6&63,128|n&63)}return new Uint8Array(e)}function Y$(i){let e;try{e=decodeURIComponent(i)}catch{throw im(Qu.DATA_URL,"Malformed data URL.")}return n4(e)}function i4(i,e){switch(i){case Qu.BASE64:{const r=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(r||s)throw im(i,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Qu.BASE64URL:{const r=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(r||s)throw im(i,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=W$(e)}catch(r){throw r.message.includes("polyfill")?r:im(i,"Invalid character found")}const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}class r4{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw im(Qu.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;n!=null&&(this.base64=Q$(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}function X$(i){const e=new r4(i);return e.base64?i4(Qu.BASE64,e.rest):Y$(e.rest)}function J$(i){return new r4(i).contentType}function Q$(i,e){return i.length>=e.length?i.substring(i.length-e.length)===e:!1}class jh{constructor(e,t){let n=0,r="";SI(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(SI(this.data_)){const n=this.data_,r=K$(n,e,t);return r===null?null:new jh(r)}else{const n=new Uint8Array(this.data_.buffer,e,t-e);return new jh(n,!0)}}static getBlob(...e){if(Zw()){const t=e.map(n=>n instanceof jh?n.data_:n);return new jh(G$.apply(null,t))}else{const t=e.map(l=>Qw(l)?q$(Qu.RAW,l).data:l.data_);let n=0;t.forEach(l=>{n+=l.byteLength});const r=new Uint8Array(n);let s=0;return t.forEach(l=>{for(let u=0;u<l.length;u++)r[s++]=l[u]}),new jh(r,!0)}}uploadData(){return this.data_}}function s4(i){let e;try{e=JSON.parse(i)}catch{return null}return M$(e)?e:null}function Z$(i){if(i.length===0)return null;const e=i.lastIndexOf("/");return e===-1?"":i.slice(0,e)}function eH(i,e){const t=e.split("/").filter(n=>n.length>0).join("/");return i.length===0?t:i+"/"+t}function a4(i){const e=i.lastIndexOf("/",i.length-2);return e===-1?i:i.slice(e+1)}function tH(i,e){return e}class Xo{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||tH}}let t0=null;function nH(i){return!Qw(i)||i.length<2?i:a4(i)}function o4(){if(t0)return t0;const i=[];i.push(new Xo("bucket")),i.push(new Xo("generation")),i.push(new Xo("metageneration")),i.push(new Xo("name","fullPath",!0));function e(s,l){return nH(l)}const t=new Xo("name");t.xform=e,i.push(t);function n(s,l){return l!==void 0?Number(l):l}const r=new Xo("size");return r.xform=n,i.push(r),i.push(new Xo("timeCreated")),i.push(new Xo("updated")),i.push(new Xo("md5Hash",null,!0)),i.push(new Xo("cacheControl",null,!0)),i.push(new Xo("contentDisposition",null,!0)),i.push(new Xo("contentEncoding",null,!0)),i.push(new Xo("contentLanguage",null,!0)),i.push(new Xo("contentType",null,!0)),i.push(new Xo("metadata","customMetadata",!0)),t0=i,t0}function iH(i,e){function t(){const n=i.bucket,r=i.fullPath,s=new Vl(n,r);return e._makeStorageReference(s)}Object.defineProperty(i,"ref",{get:t})}function rH(i,e,t){const n={};n.type="file";const r=t.length;for(let s=0;s<r;s++){const l=t[s];n[l.local]=l.xform(n,e[l.server])}return iH(n,i),n}function l4(i,e,t){const n=s4(e);return n===null?null:rH(i,n,t)}function sH(i,e,t,n){const r=s4(e);if(r===null||!Qw(r.downloadTokens))return null;const s=r.downloadTokens;if(s.length===0)return null;const l=encodeURIComponent;return s.split(",").map(f=>{const x=i.bucket,p=i.fullPath,w="/b/"+l(x)+"/o/"+l(p),A=Ev(w,t,n),B=t4({alt:"media",token:f});return A+B})[0]}function aH(i,e){const t={},n=e.length;for(let r=0;r<n;r++){const s=e[r];s.writable&&(t[s.server]=i[s.local])}return JSON.stringify(t)}class eS{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function u4(i){if(!i)throw Jw()}function oH(i,e){function t(n,r){const s=l4(i,r,e);return u4(s!==null),s}return t}function lH(i,e){function t(n,r){const s=l4(i,r,e);return u4(s!==null),sH(s,r,i.host,i._protocol)}return t}function c4(i){function e(t,n){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=x$():r=b$():t.getStatus()===402?r=_$(i.bucket):t.getStatus()===403?r=w$(i.path):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}return e}function h4(i){const e=c4(i);function t(n,r){let s=e(n,r);return n.getStatus()===404&&(s=v$(i.path)),s.serverResponse=r.serverResponse,s}return t}function uH(i,e,t){const n=e.fullServerUrl(),r=Ev(n,i.host,i._protocol),s="GET",l=i.maxOperationRetryTime,u=new eS(r,s,lH(i,t),l);return u.errorHandler=h4(e),u}function cH(i,e){const t=e.fullServerUrl(),n=Ev(t,i.host,i._protocol),r="DELETE",s=i.maxOperationRetryTime;function l(h,f){}const u=new eS(n,r,l,s);return u.successCodes=[200,204],u.errorHandler=h4(e),u}function hH(i,e){return i&&i.contentType||e&&e.type()||"application/octet-stream"}function dH(i,e,t){const n=Object.assign({},t);return n.fullPath=i.path,n.size=e.size(),n.contentType||(n.contentType=hH(null,e)),n}function fH(i,e,t,n,r){const s=e.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"};function u(){let he="";for(let me=0;me<2;me++)he=he+Math.random().toString().slice(2);return he}const h=u();l["Content-Type"]="multipart/related; boundary="+h;const f=dH(e,n,r),x=aH(f,t),p="--"+h+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+x+`\r
--`+h+`\r
Content-Type: `+f.contentType+`\r
\r
`,w=`\r
--`+h+"--",A=jh.getBlob(p,n,w);if(A===null)throw k$();const B={name:f.fullPath},$=Ev(s,i.host,i._protocol),W="POST",q=i.maxUploadRetryTime,ge=new eS($,W,oH(i,t),q);return ge.urlParams=B,ge.headers=l,ge.body=A.uploadData(),ge.errorHandler=c4(e),ge}class pH{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Kd.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Kd.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Kd.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r,s){if(this.sent_)throw kg("cannot .send() more than once");if(oc(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const l in s)s.hasOwnProperty(l)&&this.xhr_.setRequestHeader(l,s[l].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw kg("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw kg("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw kg("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw kg("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class gH extends pH{initXhr(){this.xhr_.responseType="text"}}function tS(){return new gH}class of{constructor(e,t){this._service=e,t instanceof Vl?this._location=t:this._location=Vl.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new of(e,t)}get root(){const e=new Vl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return a4(this._location.path)}get storage(){return this._service}get parent(){const e=Z$(this._location.path);if(e===null)return null;const t=new Vl(this._location.bucket,e);return new of(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw D$(e)}}function mH(i,e,t){i._throwIfRoot("uploadBytes");const n=fH(i.storage,i._location,o4(),new jh(e,!0),t);return i.storage.makeRequestWithTokens(n,tS).then(r=>({metadata:r,ref:i}))}function yH(i){i._throwIfRoot("getDownloadURL");const e=uH(i.storage,i._location,o4());return i.storage.makeRequestWithTokens(e,tS).then(t=>{if(t===null)throw C$();return t})}function vH(i){i._throwIfRoot("deleteObject");const e=cH(i.storage,i._location);return i.storage.makeRequestWithTokens(e,tS)}function _H(i,e){const t=eH(i._location.path,e),n=new Vl(i._location.bucket,t);return new of(i.storage,n)}function bH(i){return/^[A-Za-z]+:\/\//.test(i)}function xH(i,e){return new of(i,e)}function d4(i,e){if(i instanceof nS){const t=i;if(t._bucket==null)throw I$();const n=new of(t,t._bucket);return e!=null?d4(n,e):n}else return e!==void 0?_H(i,e):i}function wH(i,e){if(e&&bH(e)){if(i instanceof nS)return xH(i,e);throw Ux("To use ref(service, url), the first argument must be a Storage instance.")}else return d4(i,e)}function AI(i,e){const t=e?.[ZL];return t==null?null:Vl.makeFromBucketSpec(t,i)}function SH(i,e,t,n={}){i.host=`${e}:${t}`;const r=oc(e);r&&(z1(`https://${i.host}/b`),U1("Storage",!0)),i._isUsingEmulator=!0,i._protocol=r?"https":"http";const{mockUserToken:s}=n;s&&(i._overrideAuthToken=typeof s=="string"?s:p2(s,i.app.options.projectId))}class nS{constructor(e,t,n,r,s,l=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=l,this._bucket=null,this._host=QL,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=m$,this._maxUploadRetryTime=y$,this._requests=new Set,r!=null?this._bucket=Vl.makeFromBucketSpec(r,this._host):this._bucket=AI(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Vl.makeFromBucketSpec(this._url,e):this._bucket=AI(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){TI("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){TI("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Mo(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new of(this,e)}_makeRequest(e,t,n,r,s=!0){if(this._deleted)return new L$(e4());{const l=$$(e,this._appId,n,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const EI="@firebase/storage",II="0.14.0";const f4="storage";function TH(i,e,t){return i=us(i),mH(i,e,t)}function kI(i){return i=us(i),yH(i)}function AH(i){return i=us(i),vH(i)}function pb(i,e){return i=us(i),wH(i,e)}function EH(i=K1(),e){i=us(i);const n=Vm(i,f4).getImmediate({identifier:e}),r=f2("storage");return r&&IH(n,...r),n}function IH(i,e,t,n={}){SH(i,e,t,n)}function kH(i,{instanceIdentifier:e}){const t=i.getProvider("app").getImmediate(),n=i.getProvider("auth-internal"),r=i.getProvider("app-check-internal");return new nS(t,n,r,e,cd)}function CH(){Zh(new qc(f4,kH,"PUBLIC").setMultipleInstances(!0)),ou(EI,II,""),ou(EI,II,"esm2020")}CH();const gb={apiKey:"AIzaSyAUv69QXH4MNNR2wkr_wcVH_cbsYrc3wjo",authDomain:"wellnessai-app-e01be.firebaseapp.com",databaseURL:"https://wellnessai-app-e01be-default-rtdb.europe-west1.firebasedatabase.app",projectId:"wellnessai-app-e01be",storageBucket:"wellnessai-app-e01be.firebasestorage.app",messagingSenderId:"863551474584",appId:"1:863551474584:web:a34f3f77742b7be4e7f9ed",measurementId:"G-CB4C84PTJ3"};class RH{constructor(){this.app=null,this.auth=null,this.database=null,this.storage=null,this.currentUser=null,this.isInitialized=!1}initialize(){try{return this.isInitialized?!0:!gb.apiKey||gb.apiKey==="YOUR_API_KEY_HERE"?!1:(this.app=G1(gb),this.auth=I2(this.app),this.database=JL(this.app),this.storage=EH(this.app),B8(this.auth,e=>{e?this.currentUser=e:this.currentUser=null}),this.isInitialized=!0,!0)}catch{return!1}}async signUp(e,t,n){try{const s=(await j8(this.auth,e,t)).user;return await this.createUserProfile(s.uid,{email:e,displayName:n,createdAt:new Date().toISOString(),profile:{age:null,gender:null,height:null,weight:null,goalSteps:1e4,notifications:!0}}),{success:!0,user:s}}catch(r){return{success:!1,error:r.message}}}async signIn(e,t){try{return{success:!0,user:(await V8(this.auth,e,t)).user}}catch(n){return{success:!1,error:n.message}}}async signInWithGoogle(){try{const e=new Vc,n=(await uF(this.auth,e)).user;return await this.getUserProfile(n.uid)||await this.createUserProfile(n.uid,{email:n.email,displayName:n.displayName,photoURL:n.photoURL,createdAt:new Date().toISOString(),profile:{goalSteps:1e4,notifications:!0}}),{success:!0,user:n}}catch(e){return{success:!1,error:e.message}}}async signOut(){try{return await $8(this.auth),{success:!0}}catch(e){return{success:!1,error:e.message}}}getCurrentUser(){return this.auth.currentUser}getCurrentUserId(){return this.auth.currentUser?.uid||null}async createUserProfile(e,t){try{const n=Jo(this.database,`users/${e}`);return await Zf(n,t),{success:!0}}catch(n){return{success:!1,error:n.message}}}async getUserProfile(e){try{const t=Jo(this.database,`users/${e}`),n=await Nh(t);return n.exists()?n.val():null}catch{return null}}async updateUserProfile(e,t){try{const n=Jo(this.database,`users/${e}`);return await r$(n,t),{success:!0}}catch(n){return{success:!1,error:n.message}}}async saveHealthData(e,t,n,r){try{const s=Jo(this.database,`users/${e}/healthData/${n}/${t}`);return await Zf(s,r),{success:!0}}catch(s){return{success:!1,error:s.message}}}async getHealthData(e,t,n){try{const r=Jo(this.database,`users/${e}/healthData/${n}/${t}`),s=await Nh(r);return s.exists()?s.val():null}catch{return null}}async addToLog(e,t,n){try{const r=new Date().toISOString().split("T")[0],s=Jo(this.database,`users/${e}/healthData/${t}/${r}`),l=await Nh(s),u=l.exists()?l.val():[],h=Array.isArray(u)?[...u,n]:[n];return await Zf(s,h),{success:!0}}catch(r){return{success:!1,error:r.message}}}async getLogRange(e,t,n,r){try{const s=Jo(this.database,`users/${e}/healthData/${t}`),l=await Nh(s);if(!l.exists())return{};const u=l.val(),h={};return Object.keys(u).forEach(f=>{f>=n&&f<=r&&(h[f]=u[f])}),h}catch{return{}}}listenToHealthData(e,t,n,r){const s=Jo(this.database,`users/${e}/healthData/${n}/${t}`);return a$(s,l=>{const u=l.exists()?l.val():null;r(u)})}async saveSettings(e,t){try{const n=Jo(this.database,`users/${e}/settings`);return await Zf(n,t),{success:!0}}catch(n){return{success:!1,error:n.message}}}async getSettings(e){try{const t=Jo(this.database,`users/${e}/settings`),n=await Nh(t);return n.exists()?n.val():{}}catch{return{}}}async uploadFile(e,t,n){try{const r=pb(this.storage,`users/${e}/${t}`),s=await TH(r,n);return{success:!0,url:await kI(s.ref)}}catch(r){return{success:!1,error:r.message}}}async getFileURL(e,t){try{const n=pb(this.storage,`users/${e}/${t}`);return await kI(n)}catch{return null}}async deleteFile(e,t){try{const n=pb(this.storage,`users/${e}/${t}`);return await AH(n),{success:!0}}catch(n){return{success:!1,error:n.message}}}isAuthenticated(){return this.auth.currentUser!==null}getUserEmail(){return this.auth.currentUser?.email||null}async deleteAccount(e){try{const t=Jo(this.database,`users/${e}`);return await i$(t),await this.auth.currentUser.delete(),{success:!0}}catch(t){return{success:!1,error:t.message}}}async exportUserData(e){try{const t=Jo(this.database,`users/${e}`),n=await Nh(t);return n.exists()?{success:!0,data:n.val()}:{success:!1,error:"No data found"}}catch(t){return{success:!1,error:t.message}}}}const Fi=new RH;class DH{constructor(){this.isSyncing=!1,this.syncQueue=[],this.isOnline=navigator.onLine,this.lastSyncTime=null,this.retryTimer=null,this.authCheckInterval=null,this.maxRetries=10,this.database=null,this.criticalKeys=["stepBaseline","stepBaselineDate","weeklySteps","todaySteps","stepHistory","step_counter_baseline","step_counter_date","water_daily_goal","water_today_intake","water_intake_history","water_reminders","waterLog","foodLog","meal_plans","meal_preferences","saved_recipes","workoutHistory","workoutLog","activityLog","rep_history","exercise_preferences","heart_rate_history","hr_device_name","heartRateData","sleepLog","sleep_history","current_sleep_session","meditationLog","meditation_history","gratitudeLog","journalEntries","gratitude_entries","stressLog","mood_history","user_profile","profile_data","user_preferences","allergens","dietary_restrictions","health_goals","health_avatar_data","avatar_predictions","avatar_history","emergency_data","emergency_contacts","emergencyHistory","medical_info","dnaAnalysis","dnaRawData","dna_last_tip","dna_last_tip_date","genetic_predictions","battles_data","battle_history","battle_stats","meal_automation_settings","automated_meals","meal_schedule","loginHistory","social_login_provider","social_login_data","user_credentials","gamification_data","achievements","level_data","xp_history","streaks","workoutHistory","rep_counter_data","exercise_history","exported_pdfs_metadata","pdf_file_paths","last_export_dates","breathing_history","breathing_voice_preference","locationHistory","knownLocations","detectedHabits","ai_memory_data","user_context","ai_learned_preferences","analytics_events","error_logs","user_feedback","subscription_plan","subscription_status","subscription_period_end","sync_queue","healthMetrics","health_data","health_history","ml_user_patterns","notificationSettings","themeSettings","dark_mode","dark_mode_auto","onboardingCompleted","subscription_plan","paywall_interactions"],window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.startAuthChecker()}startAuthChecker(){this.authCheckInterval||(console.log(" SYNC SERVICE: Auth checker started (checks every 2s)"),this.authCheckInterval=setInterval(async()=>{Fi.isAuthenticated()&&this.syncQueue.length>0&&(console.log(" SYNC SERVICE: Auth ready! Processing",this.syncQueue.length,"queued items"),await this.processSyncQueue())},2e3))}stopAuthChecker(){this.authCheckInterval&&(clearInterval(this.authCheckInterval),this.authCheckInterval=null)}async initialize(){try{if(console.log(" SYNC SERVICE: Initializing..."),!Fi.initialize())return console.warn(" SYNC SERVICE: Firebase not configured, offline-only mode"),!1;console.log(" SYNC SERVICE: Firebase initialized"),this.database=JL();try{const{value:n}=await yn.get({key:"wellnessai_migration_v1"});if(n)console.log(" Migration already completed, skipping");else{console.log(" First app start after update, running data migration...");const r=Fi.getCurrentUser();await this.migrateStepDataToAndroidKeys(r?.uid||null),await yn.set({key:"wellnessai_migration_v1",value:"true"}),console.log(" Migration flag set, will not run again")}}catch(n){console.error(" Migration failed but continuing:",n)}const t=Fi.getCurrentUser();return t?(console.log(" SYNC SERVICE: Initialized for user:",t.email||t.uid),console.log(" SYNC SERVICE: Queue has",this.syncQueue.length,"pending items"),this.isOnline?(console.log(" SYNC SERVICE: Online, starting aggressive sync..."),await this.aggressiveSyncAllData()):console.log(" SYNC SERVICE: Offline, will sync when online"),!0):(console.log(" SYNC SERVICE: No user logged in yet, waiting for auth..."),console.log(" SYNC SERVICE: Auth checker running (checks every 2s)"),!1)}catch(e){return console.error(" SYNC SERVICE: Initialization failed:",e),!1}}async handleOnline(){this.isOnline=!0,await this.aggressiveSyncAllData()}handleOffline(){this.isOnline=!1}async saveData(e,t,n=null){try{const r=this.criticalKeys.includes(e);if(localStorage.setItem(e,JSON.stringify(t)),console.log(` SYNC: Saved to localStorage: ${e}`),r&&(await yn.set({key:`wellnessai_${e}`,value:JSON.stringify(t)}),console.log(` SYNC: Saved to Preferences (permanent): ${e}`)),this.isOnline&&Fi.isAuthenticated()){const s=n||Fi.getCurrentUserId();if(s)try{return await Fi.updateUserProfile(s,{[e]:t}),console.log(`  SYNC: Firebase synced: ${e}`),{success:!0}}catch(l){console.error(`  SYNC: Firebase failed for ${e}:`,l.message),this.addToSyncQueue({key:e,value:t,action:"save",userId:s})}else console.log(` SYNC: No user ID, queuing: ${e}`),this.addToSyncQueue({key:e,value:t,action:"save"})}else console.log(` SYNC: Queued: ${e} (auth: ${Fi.isAuthenticated()}, online: ${this.isOnline})`),this.addToSyncQueue({key:e,value:t,action:"save",userId:n}),this.startAggressiveRetry();return{success:!0}}catch(r){return this.addToSyncQueue({key:e,value:t,action:"save",userId:n}),{success:!1,error:r.message}}}async getData(e,t=null){try{const n=this.criticalKeys.includes(e);if(n){const{value:s}=await yn.get({key:`wellnessai_${e}`});if(s)try{const l=JSON.parse(s);return localStorage.setItem(e,JSON.stringify(l)),l}catch{}}if(this.isOnline&&Fi.isAuthenticated()){const s=t||Fi.getCurrentUserId();if(s){const l=await Fi.getUserProfile(s);if(l&&l[e])return n&&await yn.set({key:`wellnessai_${e}`,value:JSON.stringify(l[e])}),localStorage.setItem(e,JSON.stringify(l[e])),l[e]}}const r=localStorage.getItem(e);if(r)try{const s=JSON.parse(r);return n&&await yn.set({key:`wellnessai_${e}`,value:r}),s}catch{return localStorage.removeItem(e),n&&await yn.remove({key:`wellnessai_${e}`}),e==="weeklySteps"?[{steps:0,date:null},{steps:0,date:null},{steps:0,date:null},{steps:0,date:null},{steps:0,date:null},{steps:0,date:null},{steps:0,date:null}]:null}return null}catch{try{const r=localStorage.getItem(e);if(r)return JSON.parse(r)}catch{localStorage.removeItem(e)}return null}}async saveHealthData(e,t,n){try{const r=`${e}_${t}`;if(localStorage.setItem(r,JSON.stringify(n)),this.isOnline&&Fi.isAuthenticated()){const s=Fi.getCurrentUserId();s&&await Fi.saveHealthData(s,t,e,n)}else this.addToSyncQueue({dataType:e,date:t,data:n,action:"saveHealth"});return{success:!0}}catch(r){return{success:!1,error:r.message}}}async getHealthData(e,t){try{if(this.isOnline&&Fi.isAuthenticated()){const s=Fi.getCurrentUserId();if(s){const l=await Fi.getHealthData(s,t,e);if(l){const u=`${e}_${t}`;return localStorage.setItem(u,JSON.stringify(l)),l}}}const n=`${e}_${t}`,r=localStorage.getItem(n);return r?JSON.parse(r):null}catch{const r=`${e}_${t}`,s=localStorage.getItem(r);return s?JSON.parse(s):null}}addToSyncQueue(e){const t=this.syncQueue.findIndex(n=>n.key===e.key&&n.action===e.action);t>=0?this.syncQueue[t]={...e,timestamp:Date.now(),retryCount:this.syncQueue[t].retryCount||0}:this.syncQueue.push({...e,timestamp:Date.now(),retryCount:0}),this.startAggressiveRetry()}startAggressiveRetry(){if(this.retryTimer)return;console.log(" SYNC: Starting aggressive retry timer");let e=5e3;const t=6e4,n=async()=>{if(this.syncQueue.length===0){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null,console.log(" SYNC: Queue empty, stopping retry timer"));return}Fi.isAuthenticated()&&this.isOnline?(console.log(" SYNC: Retry attempt -",this.syncQueue.length,"items in queue"),await this.processSyncQueue(),e=5e3):(console.log(" SYNC: Waiting... (auth:",Fi.isAuthenticated(),", online:",this.isOnline,")"),e=Math.min(e*1.5,t)),this.retryTimer=setTimeout(n,e)};this.retryTimer=setTimeout(n,e)}async processSyncQueue(){if(this.syncQueue.length===0||!Fi.isAuthenticated()||!this.isOnline)return;const e=Fi.getCurrentUserId();if(!e)return;const t=[],n=[];for(const r of this.syncQueue)try{r.action==="save"?(await Fi.updateUserProfile(r.userId||e,{[r.key]:r.value}),console.log(`  SYNC: Firebase synced queued item: ${r.key}`),t.push(r)):r.action==="saveHealth"&&(await Fi.saveHealthData(e,r.date,r.dataType,r.data),console.log(`  SYNC: Firebase synced health data: ${r.dataType}`),t.push(r))}catch(s){console.error(`  SYNC: Failed to sync ${r.key||r.dataType}:`,s.message);const l=(r.retryCount||0)+1;l<this.maxRetries?(n.push({...r,retryCount:l}),console.log(` SYNC: Will retry ${r.key||r.dataType} (attempt ${l}/${this.maxRetries})`)):(console.error(` SYNC: Max retries reached for ${r.key||r.dataType}, giving up`),console.error("CRITICAL: Failed to sync after max retries:",r.key||r.dataType,r.value||r.data))}this.syncQueue=n,console.log(` SYNC: Processed ${t.length} items, ${n.length} failed`),this.lastSyncTime=new Date().toISOString()}async aggressiveSyncAllData(){if(!this.isSyncing)try{this.isSyncing=!0,console.log(" SYNC: Starting AGGRESSIVE full data sync...");const e=Fi.getCurrentUserId();if(!e){console.log(" SYNC: No user logged in, will retry"),this.isSyncing=!1,this.startAggressiveRetry();return}await this.processSyncQueue(),console.log(" SYNC: Queue processed, now syncing all critical keys...");const t=["stepBaseline","stepBaselineDate","weeklySteps","todaySteps","stepHistory","step_counter_baseline","step_counter_date","waterLog","water_daily_goal","water_today_intake","water_intake_history","water_reminders","foodLog","meal_plans","meal_preferences","saved_recipes","workoutLog","workoutHistory","activityLog","rep_history","exercise_preferences","heart_rate_history","hr_device_name","heartRateData","sleepLog","sleep_history","current_sleep_session","meditationLog","meditation_history","gratitudeLog","journalEntries","gratitude_entries","stressLog","mood_history","user_profile","profile_data","user_preferences","allergens","dietary_restrictions","health_goals","health_avatar_data","avatar_predictions","avatar_history","emergency_data","emergency_contacts","emergencyHistory","medical_info","dnaAnalysis","dnaRawData","dna_last_tip","dna_last_tip_date","genetic_predictions","battles_data","battle_history","battle_stats","meal_automation_settings","automated_meals","meal_schedule","loginHistory","social_login_provider","social_login_data","gamification_data","achievements","level_data","xp_history","streaks","healthMetrics","health_data","health_history","ml_user_patterns","notificationSettings","themeSettings","dark_mode","dark_mode_auto","onboardingCompleted","subscription_plan","paywall_interactions"];let n=0,r=0;for(const s of t)try{let l=null;if(this.criticalKeys.includes(s)){const{value:u}=await yn.get({key:`wellnessai_${s}`});u&&(l=JSON.parse(u))}if(l===null){const u=localStorage.getItem(s);u&&(l=JSON.parse(u))}l!=null&&(await Fi.updateUserProfile(e,{[s]:l}),n++,console.log(`  SYNC: Synced ${s} to Firebase`))}catch(l){r++,console.error(`  SYNC: Failed to sync ${s}:`,l.message),this.criticalKeys.includes(s)&&this.addToSyncQueue({key:s,value:null,action:"save"})}console.log(` SYNC: Aggressive sync complete - ${n} synced, ${r} failed`),console.log(" SYNC: Aggressive full sync complete"),this.lastSyncTime=new Date().toISOString()}catch{this.startAggressiveRetry()}finally{this.isSyncing=!1}}async syncAllData(){return this.aggressiveSyncAllData()}async pullFromFirebase(){try{const e=Fi.getCurrentUserId();if(!e)return;console.log(" RESTORATION: Pulling all data from Firebase cloud...");const t=await Fi.getUserProfile(e);t&&Object.keys(t).forEach(r=>{(typeof t[r]!="object"||Array.isArray(t[r]))&&localStorage.setItem(r,JSON.stringify(t[r]))});let n=0;for(const r of this.criticalKeys)try{const s=Jo(this.database,`users/${e}/${r}`),l=await Nh(s);if(l.exists()){const u=l.val();localStorage.setItem(r,JSON.stringify(u)),console.log(` Pulled from Firebase: ${r}`),n++}}catch{}console.log(` RESTORATION: Pulled ${n} items from Firebase cloud`)}catch(e){console.error(" RESTORATION: Pull from Firebase failed:",e)}}async migrateStepDataToAndroidKeys(e){try{console.log(" MIGRATION: Starting step data migration to Android keys...");let t=[];try{const u=localStorage.getItem("stepHistory");u&&(t=JSON.parse(u),console.log(` Found ${t.length} entries in localStorage`))}catch{console.warn(" Could not read old stepHistory from localStorage")}let n=[];try{const{value:u}=await yn.get({key:"wellnessai_stepHistory"});u&&(n=JSON.parse(u),console.log(` Found ${n.length} entries in Android CapacitorStorage`))}catch{console.warn(" Could not read wellnessai_stepHistory from Preferences")}const r=[...t];let s=0,l=0;for(const u of n){const h=r.findIndex(f=>f.date===u.date);h>=0?(r[h]=u,s++):(r.push(u),l++)}if(console.log(` MERGE: ${r.length} total entries (${s} updated, ${l} added)`),await yn.set({key:"wellnessai_stepHistory",value:JSON.stringify(r)}),console.log(` Saved ${r.length} entries to wellnessai_stepHistory`),localStorage.setItem("stepHistory",JSON.stringify(r)),e&&Fi.isAuthenticated())try{await Fi.updateUserProfile(e,{stepHistory:r}),console.log(" Synced merged data to Firebase")}catch{console.warn(" Firebase sync failed, will retry later")}return console.log(" MIGRATION: Step data migration complete!"),{success:!0,entriesCount:r.length}}catch(t){return console.error(" MIGRATION: Failed:",t),{success:!1,error:t.message}}}async onUserLogin(e){try{console.log(" RESTORATION: User logged in, restoring all data...");let t=0;for(const n of this.criticalKeys)try{const{value:r}=await yn.get({key:`wellnessai_${n}`});if(r){const s=JSON.parse(r);localStorage.setItem(n,JSON.stringify(s)),t++,console.log(` Restored from Preferences: ${n}`)}}catch{}return console.log(` RESTORATION: Restored ${t} items from Preferences`),await this.pullFromFirebase(),console.log(" RESTORATION: Syncing current state to cloud..."),await this.syncAllData(),console.log(" RESTORATION: Complete! All your data has been restored."),{success:!0}}catch(t){return console.error(" RESTORATION: User login sync failed:",t),{success:!1,error:t.message}}}async onUserLogout(){try{return await this.syncAllData(),{success:!0}}catch(e){return{success:!1,error:e.message}}}getSyncStatus(){return{isOnline:this.isOnline,isSyncing:this.isSyncing,queueSize:this.syncQueue.length,lastSyncTime:this.lastSyncTime,isAuthenticated:Fi.isAuthenticated()}}async forceSync(){return await this.syncAllData()}async cleanupOldData(){try{const e=Date.now()-15552e6,t=JSON.parse(localStorage.getItem("stepHistory")||"[]");if(Array.isArray(t)){const l=Date.now()-7776e6,u=t.filter(h=>{try{return new Date(h.date).getTime()>=l}catch{return!1}});u.length<t.length&&localStorage.setItem("stepHistory",JSON.stringify(u))}const n=JSON.parse(localStorage.getItem("foodLog")||"[]");if(Array.isArray(n)){const l=Date.now()-7776e6,u=n.filter(h=>{try{return new Date(h.timestamp||h.date).getTime()>=l}catch{return!1}});u.length<n.length&&localStorage.setItem("foodLog",JSON.stringify(u))}let r=0;for(let l in localStorage)localStorage.hasOwnProperty(l)&&(r+=localStorage[l].length+l.length);const s=(r/1024/1024).toFixed(2);return r>4*1024*1024&&console.warn(" localStorage usage high:",s,"MB - consider additional cleanup"),{totalSize:r,sizeMB:s}}catch{return{totalSize:0,sizeMB:"0"}}}async manualBackupToCloud(){try{console.log(" MANUAL BACKUP: Starting full backup to cloud...");const e=Fi.getCurrentUserId();if(!e)throw new Error("Not logged in");let t=0,n=0;for(const s of this.criticalKeys)try{const l=localStorage.getItem(s);if(l){await yn.set({key:`wellnessai_${s}`,value:l});const u=Jo(this.database,`users/${e}/${s}`);await Zf(u,JSON.parse(l)),t++}}catch(l){console.error(` Backup failed for ${s}:`,l.message),n++}const r=new Date().toISOString();return await yn.set({key:"last_backup_timestamp",value:r}),console.log(` MANUAL BACKUP: Complete! ${t} items backed up, ${n} failed`),{success:!0,backedUpCount:t,failedCount:n,timestamp:r}}catch(e){return console.error(" MANUAL BACKUP: Failed:",e),{success:!1,error:e.message}}}async manualRestoreFromCloud(){try{console.log(" MANUAL RESTORE: Starting restore from cloud...");const e=Fi.getCurrentUserId();if(!e)throw new Error("Not logged in");let t=0,n=0;for(const r of this.criticalKeys)try{const s=Jo(this.database,`users/${e}/${r}`),l=await Nh(s);if(l.exists()){const u=l.val();localStorage.setItem(r,JSON.stringify(u)),await yn.set({key:`wellnessai_${r}`,value:JSON.stringify(u)}),console.log(` Restored from cloud: ${r}`),t++}}catch(s){console.error(` Restore failed for ${r}:`,s.message),n++}return console.log(` MANUAL RESTORE: Complete! ${t} items restored, ${n} failed`),{success:!0,restoredCount:t,failedCount:n}}catch(e){return console.error(" MANUAL RESTORE: Failed:",e),{success:!1,error:e.message}}}async getLastBackupTime(){try{const{value:e}=await yn.get({key:"last_backup_timestamp"});return e||null}catch{return null}}getStorageStats(){try{let e=0;const t={};for(let n in localStorage)if(localStorage.hasOwnProperty(n)){const r=localStorage[n].length+n.length;e+=r,t[n]=(r/1024).toFixed(2)+" KB"}return{totalSize:(e/1024/1024).toFixed(2)+" MB",percentUsed:(e/(5*1024*1024)*100).toFixed(1)+"%",itemSizes:t}}catch{return null}}}const Jh=new DH,n0=Object.freeze(Object.defineProperty({__proto__:null,default:Jh},Symbol.toStringTag,{value:"Module"})),LH={apiKey:"AIzaSyAUv69QXH4MNNR2wkr_wcVH_cbsYrc3wjo",authDomain:"wellnessai-app-e01be.firebaseapp.com",databaseURL:"https://wellnessai-app-e01be-default-rtdb.europe-west1.firebasedatabase.app",projectId:"wellnessai-app-e01be",storageBucket:"wellnessai-app-e01be.firebasestorage.app",messagingSenderId:"863551474584",appId:"1:863551474584:web:a34f3f77742b7be4e7f9ed"},p4=G1(LH,"firestoreApp"),Yf=TD(p4),Cg=I2(p4);try{_9(Yf).catch(i=>{i.code==="failed-precondition"?console.warn(" Firestore persistence: Multiple tabs open"):i.code==="unimplemented"&&console.warn(" Firestore persistence: Browser not supported")}),console.log(" Firestore offline persistence enabled")}catch(i){console.warn(" Firestore persistence setup failed:",i)}class NH{constructor(){this.cache=new Map,this.saveQueue=[],this.isOnline=navigator.onLine,this.authInitialized=!1,window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.initAuth()}async initAuth(){try{Cg.currentUser||(await P8(Cg),console.log(" Firebase Auth initialized (anonymous)")),this.authInitialized=!0}catch(e){console.error(" Firebase Auth init failed:",e),this.authInitialized=!0}}async getDeviceId(){try{const{Preferences:e}=await jt(async()=>{const{Preferences:r}=await Promise.resolve().then(()=>Ex);return{Preferences:r}},void 0),{value:t}=await e.get({key:"device_id"});if(t)return t;const n="device_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return await e.set({key:"device_id",value:n}),console.log(" Generated device ID:",n),n}catch{return"device_"+Date.now()}}async save(e,t,n=null){try{this.authInitialized||await this.initAuth();let r=n||Cg.currentUser?.uid;r||(r=await this.getDeviceId(),console.log(` Using device ID: ${r}`)),this.cache.set(e,t),localStorage.setItem(e,JSON.stringify(t));const s=Jy(Yf,"users",r,"data",e);return await zE(s,{value:t,updatedAt:new Date().toISOString(),key:e},{merge:!0}),this.cache.delete(e),console.log(` Firestore saved [${r.substring(0,20)}...]: ${e}`),{success:!0}}catch(r){console.error(` Firestore save error for ${e}:`,r);try{localStorage.setItem(e,JSON.stringify(t)),console.log(` Fallback to localStorage: ${e}`)}catch(s){console.error(" localStorage fallback failed:",s)}return{success:!1,error:r.message}}}async get(e,t=null){try{if(this.cache.has(e))return this.cache.get(e);const n=localStorage.getItem(e);if(n)try{const s=JSON.parse(n);this.cache.set(e,s)}catch{this.cache.set(e,n)}this.authInitialized||await this.initAuth();let r=t||Cg.currentUser?.uid;if(r||(r=await this.getDeviceId()),r){const s=Jy(Yf,"users",r,"data",e),l=await VE(s);if(l.exists()){const u=l.data().value;return this.cache.set(e,u),localStorage.setItem(e,JSON.stringify(u)),console.log(` Firestore loaded: ${e}`),u}}return this.cache.get(e)||null}catch(n){console.error(` Firestore get error for ${e}:`,n);const r=localStorage.getItem(e);if(r)try{return JSON.parse(r)}catch{return r}return null}}async saveHealthData(e,t,n){const r=`${e}_${t}`;return this.save(r,n)}async getHealthData(e,t){const n=`${e}_${t}`;return this.get(n)}async handleOnline(){for(console.log(" Firestore: Device online, syncing..."),this.isOnline=!0;this.saveQueue.length>0;){const e=this.saveQueue.shift();await this.save(e.key,e.value,e.userId)}}handleOffline(){console.log(" Firestore: Device offline, will sync when online"),this.isOnline=!1}clearCache(){this.cache.clear(),console.log(" Firestore cache cleared")}async saveToCollection(e,t,n){try{this.authInitialized||await this.initAuth();const r=Jy(Yf,e,t);return await zE(r,{...n,updatedAt:new Date().toISOString()},{merge:!0}),console.log(` Saved to ${e}/${t}`),{success:!0}}catch(r){return console.error(` Error saving to ${e}:`,r),{success:!1,error:r.message}}}async getFromCollection(e,t){try{this.authInitialized||await this.initAuth();const n=Jy(Yf,e,t),r=await VE(n);return r.exists()?(console.log(` Loaded from ${e}/${t}`),r.data()):null}catch(n){return console.error(` Error loading from ${e}:`,n),null}}async queryCollection(e,t=[]){try{this.authInitialized||await this.initAuth();const n=v9(Yf,e),r=t.length>0?L9(n,...t):n,s=await M9(r),l=[];return s.forEach(u=>{l.push({id:u.id,...u.data()})}),console.log(` Queried ${e}: ${l.length} results`),l}catch(n){return console.error(` Error querying ${e}:`,n),[]}}getStatus(){return{online:this.isOnline,authenticated:!!Cg.currentUser,cacheSize:this.cache.size,queueSize:this.saveQueue.length}}}const mi=new NH,CY=Object.freeze(Object.defineProperty({__proto__:null,default:mi},Symbol.toStringTag,{value:"Module"}));var Ug={exports:{}},PH=Ug.exports,CI;function OH(){return CI||(CI=1,(function(i,e){(function(t,n){n(e)})(PH,(function(t){function n(O){return Math.max(0,O)}function r(O,d){return O<=0?0:d}var s=Object.freeze({__proto__:null,activate:n,measure:r});function l(O){return 1/(1+Math.exp(-O))}function u(O,d){return O*(1-O)*d}var h=Object.freeze({__proto__:null,activate:l,measure:u});function f(O){return Math.tanh(O)}function x(O,d){return(1-O*O)*d}var p=Object.freeze({__proto__:null,activate:f,measure:x});function w(O){return O>0?O:.01*O}function A(O,d){return O>0?d:.01*d}var B=Object.freeze({__proto__:null,activate:w,measure:A}),$=Object.freeze({__proto__:null,relu:s,sigmoid:h,tanh:p,leakyRelu:B}),W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ld<"u"?Ld:typeof self<"u"?self:{};function q(O,d,g){return g={path:d,exports:{},require:function(y,N){return ge(y,N??g.path)}},O(g,g.exports),g.exports}function ge(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var he=q(function(O,d){(function(g){O.exports=g()})(function(){return(function(){function g(y,N,D){function F(k,R){if(!N[k]){if(!y[k]){var S=typeof ge=="function"&&ge;if(!R&&S)return S(k,!0);if(z)return z(k,!0);var T=new Error("Cannot find module '"+k+"'");throw T.code="MODULE_NOT_FOUND",T}var G=N[k]={exports:{}};y[k][0].call(G.exports,function(te){var Te=y[k][1][te];return F(Te||te)},G,G.exports,g,y,N,D)}return N[k].exports}for(var z=typeof ge=="function"&&ge,P=0;P<D.length;P++)F(D[P]);return F}return g})()({1:[function(g,y,N){(function(D,F){typeof N=="object"&&typeof y<"u"?F(N):(D=D||self,F(D.acorn={}))})(this,function(D){var F={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},z="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",P={5:z,"5module":z+" export import",6:z+" const class extends export import super"},k=/^in(stanceof)?$/,R="---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",S="--------------------------------------------------------------------------------------------------------------------------------------------------",T=new RegExp("["+R+"]"),G=new RegExp("["+R+S+"]");R=S=null;var te=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,155,22,13,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,0,33,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,0,161,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,754,9486,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],Te=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,232,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,792487,239];function ie(_,V){for(var ce=65536,De=0;De<V.length;De+=2){if(ce+=V[De],ce>_)return!1;if(ce+=V[De+1],ce>=_)return!0}}function _e(_,V){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&T.test(String.fromCharCode(_)):V===!1?!1:ie(_,te)}function Y(_,V){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&G.test(String.fromCharCode(_)):V===!1?!1:ie(_,te)||ie(_,Te)}var re=function(V,ce){ce===void 0&&(ce={}),this.label=V,this.keyword=ce.keyword,this.beforeExpr=!!ce.beforeExpr,this.startsExpr=!!ce.startsExpr,this.isLoop=!!ce.isLoop,this.isAssign=!!ce.isAssign,this.prefix=!!ce.prefix,this.postfix=!!ce.postfix,this.binop=ce.binop||null,this.updateContext=null};function be(_,V){return new re(_,{beforeExpr:!0,binop:V})}var ke={beforeExpr:!0},rt={startsExpr:!0},vt={};function Q(_,V){return V===void 0&&(V={}),V.keyword=_,vt[_]=new re(_,V)}var U={num:new re("num",rt),regexp:new re("regexp",rt),string:new re("string",rt),name:new re("name",rt),eof:new re("eof"),bracketL:new re("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new re("]"),braceL:new re("{",{beforeExpr:!0,startsExpr:!0}),braceR:new re("}"),parenL:new re("(",{beforeExpr:!0,startsExpr:!0}),parenR:new re(")"),comma:new re(",",ke),semi:new re(";",ke),colon:new re(":",ke),dot:new re("."),question:new re("?",ke),arrow:new re("=>",ke),template:new re("template"),invalidTemplate:new re("invalidTemplate"),ellipsis:new re("...",ke),backQuote:new re("`",rt),dollarBraceL:new re("${",{beforeExpr:!0,startsExpr:!0}),eq:new re("=",{beforeExpr:!0,isAssign:!0}),assign:new re("_=",{beforeExpr:!0,isAssign:!0}),incDec:new re("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new re("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:be("||",1),logicalAND:be("&&",2),bitwiseOR:be("|",3),bitwiseXOR:be("^",4),bitwiseAND:be("&",5),equality:be("==/!=/===/!==",6),relational:be("</>/<=/>=",7),bitShift:be("<</>>/>>>",8),plusMin:new re("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:be("%",10),star:be("*",10),slash:be("/",10),starstar:new re("**",{beforeExpr:!0}),_break:Q("break"),_case:Q("case",ke),_catch:Q("catch"),_continue:Q("continue"),_debugger:Q("debugger"),_default:Q("default",ke),_do:Q("do",{isLoop:!0,beforeExpr:!0}),_else:Q("else",ke),_finally:Q("finally"),_for:Q("for",{isLoop:!0}),_function:Q("function",rt),_if:Q("if"),_return:Q("return",ke),_switch:Q("switch"),_throw:Q("throw",ke),_try:Q("try"),_var:Q("var"),_const:Q("const"),_while:Q("while",{isLoop:!0}),_with:Q("with"),_new:Q("new",{beforeExpr:!0,startsExpr:!0}),_this:Q("this",rt),_super:Q("super",rt),_class:Q("class",rt),_extends:Q("extends",ke),_export:Q("export"),_import:Q("import",rt),_null:Q("null",rt),_true:Q("true",rt),_false:Q("false",rt),_in:Q("in",{beforeExpr:!0,binop:7}),_instanceof:Q("instanceof",{beforeExpr:!0,binop:7}),_typeof:Q("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Q("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Q("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Me=/\r\n?|\n|\u2028|\u2029/,Fe=new RegExp(Me.source,"g");function bt(_,V){return _===10||_===13||!V&&(_===8232||_===8233)}var v=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,I=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,M=Object.prototype,H=M.hasOwnProperty,oe=M.toString;function de(_,V){return H.call(_,V)}var ue=Array.isArray||(function(_){return oe.call(_)==="[object Array]"});function ve(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var xe=function(V,ce){this.line=V,this.column=ce};xe.prototype.offset=function(V){return new xe(this.line,this.column+V)};var Re=function(V,ce,De){this.start=ce,this.end=De,V.sourceFile!==null&&(this.source=V.sourceFile)};function Ue(_,V){for(var ce=1,De=0;;){Fe.lastIndex=De;var $e=Fe.exec(_);if($e&&$e.index<V)++ce,De=$e.index+$e[0].length;else return new xe(ce,V-De)}}var Xe={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ae(_){var V={};for(var ce in Xe)V[ce]=_&&de(_,ce)?_[ce]:Xe[ce];if(V.ecmaVersion>=2015&&(V.ecmaVersion-=2009),V.allowReserved==null&&(V.allowReserved=V.ecmaVersion<5),ue(V.onToken)){var De=V.onToken;V.onToken=function($e){return De.push($e)}}return ue(V.onComment)&&(V.onComment=Ge(V,V.onComment)),V}function Ge(_,V){return function(ce,De,$e,mt,Dt,Zt){var Ln={type:ce?"Block":"Line",value:De,start:$e,end:mt};_.locations&&(Ln.loc=new Re(this,Dt,Zt)),_.ranges&&(Ln.range=[$e,mt]),V.push(Ln)}}var et=1,ot=2,Ze=et|ot,gt=4,wt=8,Nt=16,ht=32,Ut=64,Bt=128;function In(_,V){return ot|(_?gt:0)|(V?wt:0)}var nn=0,xi=1,Ui=2,si=3,sn=4,Ht=5,ei=function(V,ce,De){this.options=V=Ae(V),this.sourceFile=V.sourceFile,this.keywords=ve(P[V.ecmaVersion>=6?6:V.sourceType==="module"?"5module":5]);var $e="";if(V.allowReserved!==!0){for(var mt=V.ecmaVersion;!($e=F[mt]);mt--);V.sourceType==="module"&&($e+=" await")}this.reservedWords=ve($e);var Dt=($e?$e+" ":"")+F.strict;this.reservedWordsStrict=ve(Dt),this.reservedWordsStrictBind=ve(Dt+" "+F.strictBind),this.input=String(ce),this.containsEsc=!1,De?(this.pos=De,this.lineStart=this.input.lastIndexOf(`
`,De-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Me).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=U.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=V.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&V.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(et),this.regexpState=null},Dn={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};ei.prototype.parse=function(){var V=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(V)},Dn.inFunction.get=function(){return(this.currentVarScope().flags&ot)>0},Dn.inGenerator.get=function(){return(this.currentVarScope().flags&wt)>0},Dn.inAsync.get=function(){return(this.currentVarScope().flags&gt)>0},Dn.allowSuper.get=function(){return(this.currentThisScope().flags&Ut)>0},Dn.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Bt)>0},Dn.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},ei.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&ot)>0},ei.extend=function(){for(var V=[],ce=arguments.length;ce--;)V[ce]=arguments[ce];for(var De=this,$e=0;$e<V.length;$e++)De=V[$e](De);return De},ei.parse=function(V,ce){return new this(ce,V).parse()},ei.parseExpressionAt=function(V,ce,De){var $e=new this(De,V,ce);return $e.nextToken(),$e.parseExpression()},ei.tokenizer=function(V,ce){return new this(ce,V)},Object.defineProperties(ei.prototype,Dn);var Nn=ei.prototype,ur=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)")/;Nn.strictDirective=function(_){for(;;){I.lastIndex=_,_+=I.exec(this.input)[0].length;var V=ur.exec(this.input.slice(_));if(!V)return!1;if((V[1]||V[2])==="use strict")return!0;_+=V[0].length,I.lastIndex=_,_+=I.exec(this.input)[0].length,this.input[_]===";"&&_++}},Nn.eat=function(_){return this.type===_?(this.next(),!0):!1},Nn.isContextual=function(_){return this.type===U.name&&this.value===_&&!this.containsEsc},Nn.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Nn.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Nn.canInsertSemicolon=function(){return this.type===U.eof||this.type===U.braceR||Me.test(this.input.slice(this.lastTokEnd,this.start))},Nn.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Nn.semicolon=function(){!this.eat(U.semi)&&!this.insertSemicolon()&&this.unexpected()},Nn.afterTrailingComma=function(_,V){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),V||this.next(),!0},Nn.expect=function(_){this.eat(_)||this.unexpected()},Nn.unexpected=function(_){this.raise(_??this.start,"Unexpected token")};function ss(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Nn.checkPatternErrors=function(_,V){if(_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var ce=V?_.parenthesizedAssign:_.parenthesizedBind;ce>-1&&this.raiseRecoverable(ce,"Parenthesized pattern")}},Nn.checkExpressionErrors=function(_,V){if(!_)return!1;var ce=_.shorthandAssign,De=_.doubleProto;if(!V)return ce>=0||De>=0;ce>=0&&this.raise(ce,"Shorthand property assignments are valid only in destructuring patterns"),De>=0&&this.raiseRecoverable(De,"Redefinition of __proto__ property")},Nn.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Nn.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var An=ei.prototype;An.parseTopLevel=function(_){var V={};for(_.body||(_.body=[]);this.type!==U.eof;){var ce=this.parseStatement(null,!0,V);_.body.push(ce)}if(this.inModule)for(var De=0,$e=Object.keys(this.undefinedExports);De<$e.length;De+=1){var mt=$e[De];this.raiseRecoverable(this.undefinedExports[mt].start,"Export '"+mt+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var pr={kind:"loop"},ws={kind:"switch"};An.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;I.lastIndex=this.pos;var V=I.exec(this.input),ce=this.pos+V[0].length,De=this.input.charCodeAt(ce);if(De===91)return!0;if(_)return!1;if(De===123)return!0;if(_e(De,!0)){for(var $e=ce+1;Y(this.input.charCodeAt($e),!0);)++$e;var mt=this.input.slice(ce,$e);if(!k.test(mt))return!0}return!1},An.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;I.lastIndex=this.pos;var _=I.exec(this.input),V=this.pos+_[0].length;return!Me.test(this.input.slice(this.pos,V))&&this.input.slice(V,V+8)==="function"&&(V+8===this.input.length||!Y(this.input.charAt(V+8)))},An.parseStatement=function(_,V,ce){var De=this.type,$e=this.startNode(),mt;switch(this.isLet(_)&&(De=U._var,mt="let"),De){case U._break:case U._continue:return this.parseBreakContinueStatement($e,De.keyword);case U._debugger:return this.parseDebuggerStatement($e);case U._do:return this.parseDoStatement($e);case U._for:return this.parseForStatement($e);case U._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement($e,!1,!_);case U._class:return _&&this.unexpected(),this.parseClass($e,!0);case U._if:return this.parseIfStatement($e);case U._return:return this.parseReturnStatement($e);case U._switch:return this.parseSwitchStatement($e);case U._throw:return this.parseThrowStatement($e);case U._try:return this.parseTryStatement($e);case U._const:case U._var:return mt=mt||this.value,_&&mt!=="var"&&this.unexpected(),this.parseVarStatement($e,mt);case U._while:return this.parseWhileStatement($e);case U._with:return this.parseWithStatement($e);case U.braceL:return this.parseBlock(!0,$e);case U.semi:return this.parseEmptyStatement($e);case U._export:case U._import:if(this.options.ecmaVersion>10&&De===U._import){I.lastIndex=this.pos;var Dt=I.exec(this.input),Zt=this.pos+Dt[0].length,Ln=this.input.charCodeAt(Zt);if(Ln===40)return this.parseExpressionStatement($e,this.parseExpression())}return this.options.allowImportExportEverywhere||(V||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),De===U._import?this.parseImport($e):this.parseExport($e,ce);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement($e,!0,!_);var $i=this.value,Xs=this.parseExpression();return De===U.name&&Xs.type==="Identifier"&&this.eat(U.colon)?this.parseLabeledStatement($e,$i,Xs,_):this.parseExpressionStatement($e,Xs)}},An.parseBreakContinueStatement=function(_,V){var ce=V==="break";this.next(),this.eat(U.semi)||this.insertSemicolon()?_.label=null:this.type!==U.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var De=0;De<this.labels.length;++De){var $e=this.labels[De];if((_.label==null||$e.name===_.label.name)&&($e.kind!=null&&(ce||$e.kind==="loop")||_.label&&ce))break}return De===this.labels.length&&this.raise(_.start,"Unsyntactic "+V),this.finishNode(_,ce?"BreakStatement":"ContinueStatement")},An.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},An.parseDoStatement=function(_){return this.next(),this.labels.push(pr),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(U._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(U.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},An.parseForStatement=function(_){this.next();var V=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(pr),this.enterScope(0),this.expect(U.parenL),this.type===U.semi)return V>-1&&this.unexpected(V),this.parseFor(_,null);var ce=this.isLet();if(this.type===U._var||this.type===U._const||ce){var De=this.startNode(),$e=ce?"let":this.value;return this.next(),this.parseVar(De,!0,$e),this.finishNode(De,"VariableDeclaration"),(this.type===U._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&De.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===U._in?V>-1&&this.unexpected(V):_.await=V>-1),this.parseForIn(_,De)):(V>-1&&this.unexpected(V),this.parseFor(_,De))}var mt=new ss,Dt=this.parseExpression(!0,mt);return this.type===U._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===U._in?V>-1&&this.unexpected(V):_.await=V>-1),this.toAssignable(Dt,!1,mt),this.checkLVal(Dt),this.parseForIn(_,Dt)):(this.checkExpressionErrors(mt,!0),V>-1&&this.unexpected(V),this.parseFor(_,Dt))},An.parseFunctionStatement=function(_,V,ce){return this.next(),this.parseFunction(_,Kr|(ce?0:fi),!1,V)},An.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(U._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},An.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(U.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},An.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(U.braceL),this.labels.push(ws),this.enterScope(0);for(var V,ce=!1;this.type!==U.braceR;)if(this.type===U._case||this.type===U._default){var De=this.type===U._case;V&&this.finishNode(V,"SwitchCase"),_.cases.push(V=this.startNode()),V.consequent=[],this.next(),De?V.test=this.parseExpression():(ce&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),ce=!0,V.test=null),this.expect(U.colon)}else V||this.unexpected(),V.consequent.push(this.parseStatement(null));return this.exitScope(),V&&this.finishNode(V,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},An.parseThrowStatement=function(_){return this.next(),Me.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var wa=[];An.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===U._catch){var V=this.startNode();if(this.next(),this.eat(U.parenL)){V.param=this.parseBindingAtom();var ce=V.param.type==="Identifier";this.enterScope(ce?ht:0),this.checkLVal(V.param,ce?sn:Ui),this.expect(U.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),V.param=null,this.enterScope(0);V.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(V,"CatchClause")}return _.finalizer=this.eat(U._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},An.parseVarStatement=function(_,V){return this.next(),this.parseVar(_,!1,V),this.semicolon(),this.finishNode(_,"VariableDeclaration")},An.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(pr),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},An.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},An.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},An.parseLabeledStatement=function(_,V,ce,De){for(var $e=0,mt=this.labels;$e<mt.length;$e+=1){var Dt=mt[$e];Dt.name===V&&this.raise(ce.start,"Label '"+V+"' is already declared")}for(var Zt=this.type.isLoop?"loop":this.type===U._switch?"switch":null,Ln=this.labels.length-1;Ln>=0;Ln--){var $i=this.labels[Ln];if($i.statementStart===_.start)$i.statementStart=this.start,$i.kind=Zt;else break}return this.labels.push({name:V,kind:Zt,statementStart:this.start}),_.body=this.parseStatement(De?De.indexOf("label")===-1?De+"label":De:"label"),this.labels.pop(),_.label=ce,this.finishNode(_,"LabeledStatement")},An.parseExpressionStatement=function(_,V){return _.expression=V,this.semicolon(),this.finishNode(_,"ExpressionStatement")},An.parseBlock=function(_,V){for(_===void 0&&(_=!0),V===void 0&&(V=this.startNode()),V.body=[],this.expect(U.braceL),_&&this.enterScope(0);!this.eat(U.braceR);){var ce=this.parseStatement(null);V.body.push(ce)}return _&&this.exitScope(),this.finishNode(V,"BlockStatement")},An.parseFor=function(_,V){return _.init=V,this.expect(U.semi),_.test=this.type===U.semi?null:this.parseExpression(),this.expect(U.semi),_.update=this.type===U.parenR?null:this.parseExpression(),this.expect(U.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},An.parseForIn=function(_,V){var ce=this.type===U._in;return this.next(),V.type==="VariableDeclaration"&&V.declarations[0].init!=null&&(!ce||this.options.ecmaVersion<8||this.strict||V.kind!=="var"||V.declarations[0].id.type!=="Identifier")?this.raise(V.start,(ce?"for-in":"for-of")+" loop variable declaration may not have an initializer"):V.type==="AssignmentPattern"&&this.raise(V.start,"Invalid left-hand side in for-loop"),_.left=V,_.right=ce?this.parseExpression():this.parseMaybeAssign(),this.expect(U.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,ce?"ForInStatement":"ForOfStatement")},An.parseVar=function(_,V,ce){for(_.declarations=[],_.kind=ce;;){var De=this.startNode();if(this.parseVarId(De,ce),this.eat(U.eq)?De.init=this.parseMaybeAssign(V):ce==="const"&&!(this.type===U._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():De.id.type!=="Identifier"&&!(V&&(this.type===U._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):De.init=null,_.declarations.push(this.finishNode(De,"VariableDeclarator")),!this.eat(U.comma))break}return _},An.parseVarId=function(_,V){_.id=this.parseBindingAtom(),this.checkLVal(_.id,V==="var"?xi:Ui,!1)};var Kr=1,fi=2,Bi=4;An.parseFunction=function(_,V,ce,De){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!De)&&(this.type===U.star&&V&fi&&this.unexpected(),_.generator=this.eat(U.star)),this.options.ecmaVersion>=8&&(_.async=!!De),V&Kr&&(_.id=V&Bi&&this.type!==U.name?null:this.parseIdent(),_.id&&!(V&fi)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?xi:Ui:si));var $e=this.yieldPos,mt=this.awaitPos,Dt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(In(_.async,_.generator)),V&Kr||(_.id=this.type===U.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,ce,!1),this.yieldPos=$e,this.awaitPos=mt,this.awaitIdentPos=Dt,this.finishNode(_,V&Kr?"FunctionDeclaration":"FunctionExpression")},An.parseFunctionParams=function(_){this.expect(U.parenL),_.params=this.parseBindingList(U.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},An.parseClass=function(_,V){this.next();var ce=this.strict;this.strict=!0,this.parseClassId(_,V),this.parseClassSuper(_);var De=this.startNode(),$e=!1;for(De.body=[],this.expect(U.braceL);!this.eat(U.braceR);){var mt=this.parseClassElement(_.superClass!==null);mt&&(De.body.push(mt),mt.type==="MethodDefinition"&&mt.kind==="constructor"&&($e&&this.raise(mt.start,"Duplicate constructor in the same class"),$e=!0))}return _.body=this.finishNode(De,"ClassBody"),this.strict=ce,this.finishNode(_,V?"ClassDeclaration":"ClassExpression")},An.parseClassElement=function(_){var V=this;if(this.eat(U.semi))return null;var ce=this.startNode(),De=function(Ln,$i){$i===void 0&&($i=!1);var Xs=V.start,Js=V.startLoc;return V.eatContextual(Ln)?V.type!==U.parenL&&(!$i||!V.canInsertSemicolon())?!0:(ce.key&&V.unexpected(),ce.computed=!1,ce.key=V.startNodeAt(Xs,Js),ce.key.name=Ln,V.finishNode(ce.key,"Identifier"),!1):!1};ce.kind="method",ce.static=De("static");var $e=this.eat(U.star),mt=!1;$e||(this.options.ecmaVersion>=8&&De("async",!0)?(mt=!0,$e=this.options.ecmaVersion>=9&&this.eat(U.star)):De("get")?ce.kind="get":De("set")&&(ce.kind="set")),ce.key||this.parsePropertyName(ce);var Dt=ce.key,Zt=!1;return!ce.computed&&!ce.static&&(Dt.type==="Identifier"&&Dt.name==="constructor"||Dt.type==="Literal"&&Dt.value==="constructor")?(ce.kind!=="method"&&this.raise(Dt.start,"Constructor can't have get/set modifier"),$e&&this.raise(Dt.start,"Constructor can't be a generator"),mt&&this.raise(Dt.start,"Constructor can't be an async method"),ce.kind="constructor",Zt=_):ce.static&&Dt.type==="Identifier"&&Dt.name==="prototype"&&this.raise(Dt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(ce,$e,mt,Zt),ce.kind==="get"&&ce.value.params.length!==0&&this.raiseRecoverable(ce.value.start,"getter should have no params"),ce.kind==="set"&&ce.value.params.length!==1&&this.raiseRecoverable(ce.value.start,"setter should have exactly one param"),ce.kind==="set"&&ce.value.params[0].type==="RestElement"&&this.raiseRecoverable(ce.value.params[0].start,"Setter cannot use rest params"),ce},An.parseClassMethod=function(_,V,ce,De){return _.value=this.parseMethod(V,ce,De),this.finishNode(_,"MethodDefinition")},An.parseClassId=function(_,V){this.type===U.name?(_.id=this.parseIdent(),V&&this.checkLVal(_.id,Ui,!1)):(V===!0&&this.unexpected(),_.id=null)},An.parseClassSuper=function(_){_.superClass=this.eat(U._extends)?this.parseExprSubscripts():null},An.parseExport=function(_,V){if(this.next(),this.eat(U.star))return this.expectContextual("from"),this.type!==U.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(U._default)){this.checkExport(V,"default",this.lastTokStart);var ce;if(this.type===U._function||(ce=this.isAsyncFunction())){var De=this.startNode();this.next(),ce&&this.next(),_.declaration=this.parseFunction(De,Kr|Bi,!1,ce)}else if(this.type===U._class){var $e=this.startNode();_.declaration=this.parseClass($e,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(V,_.declaration.declarations):this.checkExport(V,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(V),this.eatContextual("from"))this.type!==U.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var mt=0,Dt=_.specifiers;mt<Dt.length;mt+=1){var Zt=Dt[mt];this.checkUnreserved(Zt.local),this.checkLocalExport(Zt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},An.checkExport=function(_,V,ce){_&&(de(_,V)&&this.raiseRecoverable(ce,"Duplicate export '"+V+"'"),_[V]=!0)},An.checkPatternExport=function(_,V){var ce=V.type;if(ce==="Identifier")this.checkExport(_,V.name,V.start);else if(ce==="ObjectPattern")for(var De=0,$e=V.properties;De<$e.length;De+=1){var mt=$e[De];this.checkPatternExport(_,mt)}else if(ce==="ArrayPattern")for(var Dt=0,Zt=V.elements;Dt<Zt.length;Dt+=1){var Ln=Zt[Dt];Ln&&this.checkPatternExport(_,Ln)}else ce==="Property"?this.checkPatternExport(_,V.value):ce==="AssignmentPattern"?this.checkPatternExport(_,V.left):ce==="RestElement"?this.checkPatternExport(_,V.argument):ce==="ParenthesizedExpression"&&this.checkPatternExport(_,V.expression)},An.checkVariableExport=function(_,V){if(_)for(var ce=0,De=V;ce<De.length;ce+=1){var $e=De[ce];this.checkPatternExport(_,$e.id)}},An.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},An.parseExportSpecifiers=function(_){var V=[],ce=!0;for(this.expect(U.braceL);!this.eat(U.braceR);){if(ce)ce=!1;else if(this.expect(U.comma),this.afterTrailingComma(U.braceR))break;var De=this.startNode();De.local=this.parseIdent(!0),De.exported=this.eatContextual("as")?this.parseIdent(!0):De.local,this.checkExport(_,De.exported.name,De.exported.start),V.push(this.finishNode(De,"ExportSpecifier"))}return V},An.parseImport=function(_){return this.next(),this.type===U.string?(_.specifiers=wa,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===U.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},An.parseImportSpecifiers=function(){var _=[],V=!0;if(this.type===U.name){var ce=this.startNode();if(ce.local=this.parseIdent(),this.checkLVal(ce.local,Ui),_.push(this.finishNode(ce,"ImportDefaultSpecifier")),!this.eat(U.comma))return _}if(this.type===U.star){var De=this.startNode();return this.next(),this.expectContextual("as"),De.local=this.parseIdent(),this.checkLVal(De.local,Ui),_.push(this.finishNode(De,"ImportNamespaceSpecifier")),_}for(this.expect(U.braceL);!this.eat(U.braceR);){if(V)V=!1;else if(this.expect(U.comma),this.afterTrailingComma(U.braceR))break;var $e=this.startNode();$e.imported=this.parseIdent(!0),this.eatContextual("as")?$e.local=this.parseIdent():(this.checkUnreserved($e.imported),$e.local=$e.imported),this.checkLVal($e.local,Ui),_.push(this.finishNode($e,"ImportSpecifier"))}return _},An.adaptDirectivePrologue=function(_){for(var V=0;V<_.length&&this.isDirectiveCandidate(_[V]);++V)_[V].directive=_[V].expression.raw.slice(1,-1)},An.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var sr=ei.prototype;sr.toAssignable=function(_,V,ce){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",ce&&this.checkPatternErrors(ce,!0);for(var De=0,$e=_.properties;De<$e.length;De+=1){var mt=$e[De];this.toAssignable(mt,V),mt.type==="RestElement"&&(mt.argument.type==="ArrayPattern"||mt.argument.type==="ObjectPattern")&&this.raise(mt.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,V);break;case"ArrayExpression":_.type="ArrayPattern",ce&&this.checkPatternErrors(ce,!0),this.toAssignableList(_.elements,V);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,V),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,V);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,V,ce);break;case"MemberExpression":if(!V)break;default:this.raise(_.start,"Assigning to rvalue")}else ce&&this.checkPatternErrors(ce,!0);return _},sr.toAssignableList=function(_,V){for(var ce=_.length,De=0;De<ce;De++){var $e=_[De];$e&&this.toAssignable($e,V)}if(ce){var mt=_[ce-1];this.options.ecmaVersion===6&&V&&mt&&mt.type==="RestElement"&&mt.argument.type!=="Identifier"&&this.unexpected(mt.argument.start)}return _},sr.parseSpread=function(_){var V=this.startNode();return this.next(),V.argument=this.parseMaybeAssign(!1,_),this.finishNode(V,"SpreadElement")},sr.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==U.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},sr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case U.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(U.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case U.braceL:return this.parseObj(!0)}return this.parseIdent()},sr.parseBindingList=function(_,V,ce){for(var De=[],$e=!0;!this.eat(_);)if($e?$e=!1:this.expect(U.comma),V&&this.type===U.comma)De.push(null);else{if(ce&&this.afterTrailingComma(_))break;if(this.type===U.ellipsis){var mt=this.parseRestBinding();this.parseBindingListItem(mt),De.push(mt),this.type===U.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var Dt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Dt),De.push(Dt)}}return De},sr.parseBindingListItem=function(_){return _},sr.parseMaybeDefault=function(_,V,ce){if(ce=ce||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(U.eq))return ce;var De=this.startNodeAt(_,V);return De.left=ce,De.right=this.parseMaybeAssign(),this.finishNode(De,"AssignmentPattern")},sr.checkLVal=function(_,V,ce){switch(V===void 0&&(V=nn),_.type){case"Identifier":V===Ui&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(V?"Binding ":"Assigning to ")+_.name+" in strict mode"),ce&&(de(ce,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),ce[_.name]=!0),V!==nn&&V!==Ht&&this.declareName(_.name,V,_.start);break;case"MemberExpression":V&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var De=0,$e=_.properties;De<$e.length;De+=1){var mt=$e[De];this.checkLVal(mt,V,ce)}break;case"Property":this.checkLVal(_.value,V,ce);break;case"ArrayPattern":for(var Dt=0,Zt=_.elements;Dt<Zt.length;Dt+=1){var Ln=Zt[Dt];Ln&&this.checkLVal(Ln,V,ce)}break;case"AssignmentPattern":this.checkLVal(_.left,V,ce);break;case"RestElement":this.checkLVal(_.argument,V,ce);break;case"ParenthesizedExpression":this.checkLVal(_.expression,V,ce);break;default:this.raise(_.start,(V?"Binding":"Assigning to")+" rvalue")}};var an=ei.prototype;an.checkPropClash=function(_,V,ce){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var De=_.key,$e;switch(De.type){case"Identifier":$e=De.name;break;case"Literal":$e=String(De.value);break;default:return}var mt=_.kind;if(this.options.ecmaVersion>=6){$e==="__proto__"&&mt==="init"&&(V.proto&&(ce?ce.doubleProto<0&&(ce.doubleProto=De.start):this.raiseRecoverable(De.start,"Redefinition of __proto__ property")),V.proto=!0);return}$e="$"+$e;var Dt=V[$e];if(Dt){var Zt;mt==="init"?Zt=this.strict&&Dt.init||Dt.get||Dt.set:Zt=Dt.init||Dt[mt],Zt&&this.raiseRecoverable(De.start,"Redefinition of property")}else Dt=V[$e]={init:!1,get:!1,set:!1};Dt[mt]=!0}},an.parseExpression=function(_,V){var ce=this.start,De=this.startLoc,$e=this.parseMaybeAssign(_,V);if(this.type===U.comma){var mt=this.startNodeAt(ce,De);for(mt.expressions=[$e];this.eat(U.comma);)mt.expressions.push(this.parseMaybeAssign(_,V));return this.finishNode(mt,"SequenceExpression")}return $e},an.parseMaybeAssign=function(_,V,ce){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var De=!1,$e=-1,mt=-1;V?($e=V.parenthesizedAssign,mt=V.trailingComma,V.parenthesizedAssign=V.trailingComma=-1):(V=new ss,De=!0);var Dt=this.start,Zt=this.startLoc;(this.type===U.parenL||this.type===U.name)&&(this.potentialArrowAt=this.start);var Ln=this.parseMaybeConditional(_,V);if(ce&&(Ln=ce.call(this,Ln,Dt,Zt)),this.type.isAssign){var $i=this.startNodeAt(Dt,Zt);return $i.operator=this.value,$i.left=this.type===U.eq?this.toAssignable(Ln,!1,V):Ln,De||(V.parenthesizedAssign=V.trailingComma=V.doubleProto=-1),V.shorthandAssign>=$i.left.start&&(V.shorthandAssign=-1),this.checkLVal(Ln),this.next(),$i.right=this.parseMaybeAssign(_),this.finishNode($i,"AssignmentExpression")}else De&&this.checkExpressionErrors(V,!0);return $e>-1&&(V.parenthesizedAssign=$e),mt>-1&&(V.trailingComma=mt),Ln},an.parseMaybeConditional=function(_,V){var ce=this.start,De=this.startLoc,$e=this.parseExprOps(_,V);if(this.checkExpressionErrors(V))return $e;if(this.eat(U.question)){var mt=this.startNodeAt(ce,De);return mt.test=$e,mt.consequent=this.parseMaybeAssign(),this.expect(U.colon),mt.alternate=this.parseMaybeAssign(_),this.finishNode(mt,"ConditionalExpression")}return $e},an.parseExprOps=function(_,V){var ce=this.start,De=this.startLoc,$e=this.parseMaybeUnary(V,!1);return this.checkExpressionErrors(V)||$e.start===ce&&$e.type==="ArrowFunctionExpression"?$e:this.parseExprOp($e,ce,De,-1,_)},an.parseExprOp=function(_,V,ce,De,$e){var mt=this.type.binop;if(mt!=null&&(!$e||this.type!==U._in)&&mt>De){var Dt=this.type===U.logicalOR||this.type===U.logicalAND,Zt=this.value;this.next();var Ln=this.start,$i=this.startLoc,Xs=this.parseExprOp(this.parseMaybeUnary(null,!1),Ln,$i,mt,$e),Js=this.buildBinary(V,ce,_,Xs,Zt,Dt);return this.parseExprOp(Js,V,ce,De,$e)}return _},an.buildBinary=function(_,V,ce,De,$e,mt){var Dt=this.startNodeAt(_,V);return Dt.left=ce,Dt.operator=$e,Dt.right=De,this.finishNode(Dt,mt?"LogicalExpression":"BinaryExpression")},an.parseMaybeUnary=function(_,V){var ce=this.start,De=this.startLoc,$e;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))$e=this.parseAwait(),V=!0;else if(this.type.prefix){var mt=this.startNode(),Dt=this.type===U.incDec;mt.operator=this.value,mt.prefix=!0,this.next(),mt.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),Dt?this.checkLVal(mt.argument):this.strict&&mt.operator==="delete"&&mt.argument.type==="Identifier"?this.raiseRecoverable(mt.start,"Deleting local variable in strict mode"):V=!0,$e=this.finishNode(mt,Dt?"UpdateExpression":"UnaryExpression")}else{if($e=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return $e;for(;this.type.postfix&&!this.canInsertSemicolon();){var Zt=this.startNodeAt(ce,De);Zt.operator=this.value,Zt.prefix=!1,Zt.argument=$e,this.checkLVal($e),this.next(),$e=this.finishNode(Zt,"UpdateExpression")}}return!V&&this.eat(U.starstar)?this.buildBinary(ce,De,$e,this.parseMaybeUnary(null,!1),"**",!1):$e},an.parseExprSubscripts=function(_){var V=this.start,ce=this.startLoc,De=this.parseExprAtom(_);if(De.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return De;var $e=this.parseSubscripts(De,V,ce);return _&&$e.type==="MemberExpression"&&(_.parenthesizedAssign>=$e.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=$e.start&&(_.parenthesizedBind=-1)),$e},an.parseSubscripts=function(_,V,ce,De){for(var $e=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&this.input.slice(_.start,_.end)==="async";;){var mt=this.parseSubscript(_,V,ce,De,$e);if(mt===_||mt.type==="ArrowFunctionExpression")return mt;_=mt}},an.parseSubscript=function(_,V,ce,De,$e){var mt=this.eat(U.bracketL);if(mt||this.eat(U.dot)){var Dt=this.startNodeAt(V,ce);Dt.object=_,Dt.property=mt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Dt.computed=!!mt,mt&&this.expect(U.bracketR),_=this.finishNode(Dt,"MemberExpression")}else if(!De&&this.eat(U.parenL)){var Zt=new ss,Ln=this.yieldPos,$i=this.awaitPos,Xs=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Js=this.parseExprList(U.parenR,this.options.ecmaVersion>=8,!1,Zt);if($e&&!this.canInsertSemicolon()&&this.eat(U.arrow))return this.checkPatternErrors(Zt,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Ln,this.awaitPos=$i,this.awaitIdentPos=Xs,this.parseArrowExpression(this.startNodeAt(V,ce),Js,!0);this.checkExpressionErrors(Zt,!0),this.yieldPos=Ln||this.yieldPos,this.awaitPos=$i||this.awaitPos,this.awaitIdentPos=Xs||this.awaitIdentPos;var Qa=this.startNodeAt(V,ce);Qa.callee=_,Qa.arguments=Js,_=this.finishNode(Qa,"CallExpression")}else if(this.type===U.backQuote){var Ma=this.startNodeAt(V,ce);Ma.tag=_,Ma.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ma,"TaggedTemplateExpression")}return _},an.parseExprAtom=function(_){this.type===U.slash&&this.readRegexp();var V,ce=this.potentialArrowAt===this.start;switch(this.type){case U._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),V=this.startNode(),this.next(),this.type===U.parenL&&!this.allowDirectSuper&&this.raise(V.start,"super() call outside constructor of a subclass"),this.type!==U.dot&&this.type!==U.bracketL&&this.type!==U.parenL&&this.unexpected(),this.finishNode(V,"Super");case U._this:return V=this.startNode(),this.next(),this.finishNode(V,"ThisExpression");case U.name:var De=this.start,$e=this.startLoc,mt=this.containsEsc,Dt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!mt&&Dt.name==="async"&&!this.canInsertSemicolon()&&this.eat(U._function))return this.parseFunction(this.startNodeAt(De,$e),0,!1,!0);if(ce&&!this.canInsertSemicolon()){if(this.eat(U.arrow))return this.parseArrowExpression(this.startNodeAt(De,$e),[Dt],!1);if(this.options.ecmaVersion>=8&&Dt.name==="async"&&this.type===U.name&&!mt)return Dt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(U.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(De,$e),[Dt],!0)}return Dt;case U.regexp:var Zt=this.value;return V=this.parseLiteral(Zt.value),V.regex={pattern:Zt.pattern,flags:Zt.flags},V;case U.num:case U.string:return this.parseLiteral(this.value);case U._null:case U._true:case U._false:return V=this.startNode(),V.value=this.type===U._null?null:this.type===U._true,V.raw=this.type.keyword,this.next(),this.finishNode(V,"Literal");case U.parenL:var Ln=this.start,$i=this.parseParenAndDistinguishExpression(ce);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget($i)&&(_.parenthesizedAssign=Ln),_.parenthesizedBind<0&&(_.parenthesizedBind=Ln)),$i;case U.bracketL:return V=this.startNode(),this.next(),V.elements=this.parseExprList(U.bracketR,!0,!0,_),this.finishNode(V,"ArrayExpression");case U.braceL:return this.parseObj(!1,_);case U._function:return V=this.startNode(),this.next(),this.parseFunction(V,0);case U._class:return this.parseClass(this.startNode(),!1);case U._new:return this.parseNew();case U.backQuote:return this.parseTemplate();case U._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},an.parseExprImport=function(){var _=this.startNode();switch(this.next(),this.type){case U.parenL:return this.parseDynamicImport(_);default:this.unexpected()}},an.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(U.parenR)){var V=this.start;this.eat(U.comma)&&this.eat(U.parenR)?this.raiseRecoverable(V,"Trailing comma is not allowed in import()"):this.unexpected(V)}return this.finishNode(_,"ImportExpression")},an.parseLiteral=function(_){var V=this.startNode();return V.value=_,V.raw=this.input.slice(this.start,this.end),V.raw.charCodeAt(V.raw.length-1)===110&&(V.bigint=V.raw.slice(0,-1)),this.next(),this.finishNode(V,"Literal")},an.parseParenExpression=function(){this.expect(U.parenL);var _=this.parseExpression();return this.expect(U.parenR),_},an.parseParenAndDistinguishExpression=function(_){var V=this.start,ce=this.startLoc,De,$e=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var mt=this.start,Dt=this.startLoc,Zt=[],Ln=!0,$i=!1,Xs=new ss,Js=this.yieldPos,Qa=this.awaitPos,Ma;for(this.yieldPos=0,this.awaitPos=0;this.type!==U.parenR;)if(Ln?Ln=!1:this.expect(U.comma),$e&&this.afterTrailingComma(U.parenR,!0)){$i=!0;break}else if(this.type===U.ellipsis){Ma=this.start,Zt.push(this.parseParenItem(this.parseRestBinding())),this.type===U.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Zt.push(this.parseMaybeAssign(!1,Xs,this.parseParenItem));var uh=this.start,ch=this.startLoc;if(this.expect(U.parenR),_&&!this.canInsertSemicolon()&&this.eat(U.arrow))return this.checkPatternErrors(Xs,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Js,this.awaitPos=Qa,this.parseParenArrowList(V,ce,Zt);(!Zt.length||$i)&&this.unexpected(this.lastTokStart),Ma&&this.unexpected(Ma),this.checkExpressionErrors(Xs,!0),this.yieldPos=Js||this.yieldPos,this.awaitPos=Qa||this.awaitPos,Zt.length>1?(De=this.startNodeAt(mt,Dt),De.expressions=Zt,this.finishNodeAt(De,"SequenceExpression",uh,ch)):De=Zt[0]}else De=this.parseParenExpression();if(this.options.preserveParens){var Zl=this.startNodeAt(V,ce);return Zl.expression=De,this.finishNode(Zl,"ParenthesizedExpression")}else return De},an.parseParenItem=function(_){return _},an.parseParenArrowList=function(_,V,ce){return this.parseArrowExpression(this.startNodeAt(_,V),ce)};var Ds=[];an.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),V=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(U.dot)){_.meta=V;var ce=this.containsEsc;return _.property=this.parseIdent(!0),(_.property.name!=="target"||ce)&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is new.target"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"new.target can only be used in functions"),this.finishNode(_,"MetaProperty")}var De=this.start,$e=this.startLoc,mt=this.type===U._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),De,$e,!0),mt&&_.callee.type==="ImportExpression"&&this.raise(De,"Cannot use new with import()"),this.eat(U.parenL)?_.arguments=this.parseExprList(U.parenR,this.options.ecmaVersion>=8,!1):_.arguments=Ds,this.finishNode(_,"NewExpression")},an.parseTemplateElement=function(_){var V=_.isTagged,ce=this.startNode();return this.type===U.invalidTemplate?(V||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),ce.value={raw:this.value,cooked:null}):ce.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),ce.tail=this.type===U.backQuote,this.finishNode(ce,"TemplateElement")},an.parseTemplate=function(_){_===void 0&&(_={});var V=_.isTagged;V===void 0&&(V=!1);var ce=this.startNode();this.next(),ce.expressions=[];var De=this.parseTemplateElement({isTagged:V});for(ce.quasis=[De];!De.tail;)this.type===U.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(U.dollarBraceL),ce.expressions.push(this.parseExpression()),this.expect(U.braceR),ce.quasis.push(De=this.parseTemplateElement({isTagged:V}));return this.next(),this.finishNode(ce,"TemplateLiteral")},an.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===U.name||this.type===U.num||this.type===U.string||this.type===U.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===U.star)&&!Me.test(this.input.slice(this.lastTokEnd,this.start))},an.parseObj=function(_,V){var ce=this.startNode(),De=!0,$e={};for(ce.properties=[],this.next();!this.eat(U.braceR);){if(De)De=!1;else if(this.expect(U.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(U.braceR))break;var mt=this.parseProperty(_,V);_||this.checkPropClash(mt,$e,V),ce.properties.push(mt)}return this.finishNode(ce,_?"ObjectPattern":"ObjectExpression")},an.parseProperty=function(_,V){var ce=this.startNode(),De,$e,mt,Dt;if(this.options.ecmaVersion>=9&&this.eat(U.ellipsis))return _?(ce.argument=this.parseIdent(!1),this.type===U.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(ce,"RestElement")):(this.type===U.parenL&&V&&(V.parenthesizedAssign<0&&(V.parenthesizedAssign=this.start),V.parenthesizedBind<0&&(V.parenthesizedBind=this.start)),ce.argument=this.parseMaybeAssign(!1,V),this.type===U.comma&&V&&V.trailingComma<0&&(V.trailingComma=this.start),this.finishNode(ce,"SpreadElement"));this.options.ecmaVersion>=6&&(ce.method=!1,ce.shorthand=!1,(_||V)&&(mt=this.start,Dt=this.startLoc),_||(De=this.eat(U.star)));var Zt=this.containsEsc;return this.parsePropertyName(ce),!_&&!Zt&&this.options.ecmaVersion>=8&&!De&&this.isAsyncProp(ce)?($e=!0,De=this.options.ecmaVersion>=9&&this.eat(U.star),this.parsePropertyName(ce,V)):$e=!1,this.parsePropertyValue(ce,_,De,$e,mt,Dt,V,Zt),this.finishNode(ce,"Property")},an.parsePropertyValue=function(_,V,ce,De,$e,mt,Dt,Zt){if((ce||De)&&this.type===U.colon&&this.unexpected(),this.eat(U.colon))_.value=V?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Dt),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===U.parenL)V&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(ce,De);else if(!V&&!Zt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==U.comma&&this.type!==U.braceR){(ce||De)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var Ln=_.kind==="get"?0:1;if(_.value.params.length!==Ln){var $i=_.value.start;_.kind==="get"?this.raiseRecoverable($i,"getter should have no params"):this.raiseRecoverable($i,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((ce||De)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=$e),_.kind="init",V?_.value=this.parseMaybeDefault($e,mt,_.key):this.type===U.eq&&Dt?(Dt.shorthandAssign<0&&(Dt.shorthandAssign=this.start),_.value=this.parseMaybeDefault($e,mt,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},an.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(U.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(U.bracketR),_.key;_.computed=!1}return _.key=this.type===U.num||this.type===U.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},an.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},an.parseMethod=function(_,V,ce){var De=this.startNode(),$e=this.yieldPos,mt=this.awaitPos,Dt=this.awaitIdentPos;return this.initFunction(De),this.options.ecmaVersion>=6&&(De.generator=_),this.options.ecmaVersion>=8&&(De.async=!!V),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(In(V,De.generator)|Ut|(ce?Bt:0)),this.expect(U.parenL),De.params=this.parseBindingList(U.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(De,!1,!0),this.yieldPos=$e,this.awaitPos=mt,this.awaitIdentPos=Dt,this.finishNode(De,"FunctionExpression")},an.parseArrowExpression=function(_,V,ce){var De=this.yieldPos,$e=this.awaitPos,mt=this.awaitIdentPos;return this.enterScope(In(ce,!1)|Nt),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!ce),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(V,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=De,this.awaitPos=$e,this.awaitIdentPos=mt,this.finishNode(_,"ArrowFunctionExpression")},an.parseFunctionBody=function(_,V,ce){var De=V&&this.type!==U.braceL,$e=this.strict,mt=!1;if(De)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var Dt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!$e||Dt)&&(mt=this.strictDirective(this.end),mt&&Dt&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Zt=this.labels;this.labels=[],mt&&(this.strict=!0),this.checkParams(_,!$e&&!mt&&!V&&!ce&&this.isSimpleParamList(_.params)),_.body=this.parseBlock(!1),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=Zt}this.exitScope(),this.strict&&_.id&&this.checkLVal(_.id,Ht),this.strict=$e},an.isSimpleParamList=function(_){for(var V=0,ce=_;V<ce.length;V+=1){var De=ce[V];if(De.type!=="Identifier")return!1}return!0},an.checkParams=function(_,V){for(var ce={},De=0,$e=_.params;De<$e.length;De+=1){var mt=$e[De];this.checkLVal(mt,xi,V?null:ce)}},an.parseExprList=function(_,V,ce,De){for(var $e=[],mt=!0;!this.eat(_);){if(mt)mt=!1;else if(this.expect(U.comma),V&&this.afterTrailingComma(_))break;var Dt=void 0;ce&&this.type===U.comma?Dt=null:this.type===U.ellipsis?(Dt=this.parseSpread(De),De&&this.type===U.comma&&De.trailingComma<0&&(De.trailingComma=this.start)):Dt=this.parseMaybeAssign(!1,De),$e.push(Dt)}return $e},an.checkUnreserved=function(_){var V=_.start,ce=_.end,De=_.name;if(this.inGenerator&&De==="yield"&&this.raiseRecoverable(V,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&De==="await"&&this.raiseRecoverable(V,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(De)&&this.raise(V,"Unexpected keyword '"+De+"'"),!(this.options.ecmaVersion<6&&this.input.slice(V,ce).indexOf("\\")!==-1)){var $e=this.strict?this.reservedWordsStrict:this.reservedWords;$e.test(De)&&(!this.inAsync&&De==="await"&&this.raiseRecoverable(V,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(V,"The keyword '"+De+"' is reserved"))}},an.parseIdent=function(_,V){var ce=this.startNode();return this.type===U.name?ce.name=this.value:this.type.keyword?(ce.name=this.type.keyword,(ce.name==="class"||ce.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(ce,"Identifier"),_||(this.checkUnreserved(ce),ce.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ce.start)),ce},an.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var V=this.startNode();return this.next(),this.type===U.semi||this.canInsertSemicolon()||this.type!==U.star&&!this.type.startsExpr?(V.delegate=!1,V.argument=null):(V.delegate=this.eat(U.star),V.argument=this.parseMaybeAssign(_)),this.finishNode(V,"YieldExpression")},an.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Lr=ei.prototype;Lr.raise=function(_,V){var ce=Ue(this.input,_);V+=" ("+ce.line+":"+ce.column+")";var De=new SyntaxError(V);throw De.pos=_,De.loc=ce,De.raisedAt=this.pos,De},Lr.raiseRecoverable=Lr.raise,Lr.curPosition=function(){if(this.options.locations)return new xe(this.curLine,this.pos-this.lineStart)};var _i=ei.prototype,ms=function(V){this.flags=V,this.var=[],this.lexical=[],this.functions=[]};_i.enterScope=function(_){this.scopeStack.push(new ms(_))},_i.exitScope=function(){this.scopeStack.pop()},_i.treatFunctionsAsVarInScope=function(_){return _.flags&ot||!this.inModule&&_.flags&et},_i.declareName=function(_,V,ce){var De=!1;if(V===Ui){var $e=this.currentScope();De=$e.lexical.indexOf(_)>-1||$e.functions.indexOf(_)>-1||$e.var.indexOf(_)>-1,$e.lexical.push(_),this.inModule&&$e.flags&et&&delete this.undefinedExports[_]}else if(V===sn){var mt=this.currentScope();mt.lexical.push(_)}else if(V===si){var Dt=this.currentScope();this.treatFunctionsAsVar?De=Dt.lexical.indexOf(_)>-1:De=Dt.lexical.indexOf(_)>-1||Dt.var.indexOf(_)>-1,Dt.functions.push(_)}else for(var Zt=this.scopeStack.length-1;Zt>=0;--Zt){var Ln=this.scopeStack[Zt];if(Ln.lexical.indexOf(_)>-1&&!(Ln.flags&ht&&Ln.lexical[0]===_)||!this.treatFunctionsAsVarInScope(Ln)&&Ln.functions.indexOf(_)>-1){De=!0;break}if(Ln.var.push(_),this.inModule&&Ln.flags&et&&delete this.undefinedExports[_],Ln.flags&Ze)break}De&&this.raiseRecoverable(ce,"Identifier '"+_+"' has already been declared")},_i.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},_i.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},_i.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var V=this.scopeStack[_];if(V.flags&Ze)return V}},_i.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var V=this.scopeStack[_];if(V.flags&Ze&&!(V.flags&Nt))return V}};var Ji=function(V,ce,De){this.type="",this.start=ce,this.end=0,V.options.locations&&(this.loc=new Re(V,De)),V.options.directSourceFile&&(this.sourceFile=V.options.directSourceFile),V.options.ranges&&(this.range=[ce,0])},Qr=ei.prototype;Qr.startNode=function(){return new Ji(this,this.start,this.startLoc)},Qr.startNodeAt=function(_,V){return new Ji(this,_,V)};function ys(_,V,ce,De){return _.type=V,_.end=ce,this.options.locations&&(_.loc.end=De),this.options.ranges&&(_.range[1]=ce),_}Qr.finishNode=function(_,V){return ys.call(this,_,V,this.lastTokEnd,this.lastTokEndLoc)},Qr.finishNodeAt=function(_,V,ce,De){return ys.call(this,_,V,ce,De)};var wi=function(V,ce,De,$e,mt){this.token=V,this.isExpr=!!ce,this.preserveSpace=!!De,this.override=$e,this.generator=!!mt},Fn={b_stat:new wi("{",!1),b_expr:new wi("{",!0),b_tmpl:new wi("${",!1),p_stat:new wi("(",!1),p_expr:new wi("(",!0),q_tmpl:new wi("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new wi("function",!1),f_expr:new wi("function",!0),f_expr_gen:new wi("function",!0,!1,null,!0),f_gen:new wi("function",!1,!1,null,!0)},Ls=ei.prototype;Ls.initialContext=function(){return[Fn.b_stat]},Ls.braceIsBlock=function(_){var V=this.curContext();return V===Fn.f_expr||V===Fn.f_stat?!0:_===U.colon&&(V===Fn.b_stat||V===Fn.b_expr)?!V.isExpr:_===U._return||_===U.name&&this.exprAllowed?Me.test(this.input.slice(this.lastTokEnd,this.start)):_===U._else||_===U.semi||_===U.eof||_===U.parenR||_===U.arrow?!0:_===U.braceL?V===Fn.b_stat:_===U._var||_===U._const||_===U.name?!1:!this.exprAllowed},Ls.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var V=this.context[_];if(V.token==="function")return V.generator}return!1},Ls.updateContext=function(_){var V,ce=this.type;ce.keyword&&_===U.dot?this.exprAllowed=!1:(V=ce.updateContext)?V.call(this,_):this.exprAllowed=ce.beforeExpr},U.parenR.updateContext=U.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Fn.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},U.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Fn.b_stat:Fn.b_expr),this.exprAllowed=!0},U.dollarBraceL.updateContext=function(){this.context.push(Fn.b_tmpl),this.exprAllowed=!0},U.parenL.updateContext=function(_){var V=_===U._if||_===U._for||_===U._with||_===U._while;this.context.push(V?Fn.p_stat:Fn.p_expr),this.exprAllowed=!0},U.incDec.updateContext=function(){},U._function.updateContext=U._class.updateContext=function(_){_.beforeExpr&&_!==U.semi&&_!==U._else&&!(_===U._return&&Me.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===U.colon||_===U.braceL)&&this.curContext()===Fn.b_stat)?this.context.push(Fn.f_expr):this.context.push(Fn.f_stat),this.exprAllowed=!1},U.backQuote.updateContext=function(){this.curContext()===Fn.q_tmpl?this.context.pop():this.context.push(Fn.q_tmpl),this.exprAllowed=!1},U.star.updateContext=function(_){if(_===U._function){var V=this.context.length-1;this.context[V]===Fn.f_expr?this.context[V]=Fn.f_expr_gen:this.context[V]=Fn.f_gen}this.exprAllowed=!0},U.name.updateContext=function(_){var V=!1;this.options.ecmaVersion>=6&&_!==U.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(V=!0),this.exprAllowed=V};var Zr="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Pn=Zr+" Extended_Pictographic",zn=Pn,Qi={9:Zr,10:Pn,11:zn},Oa="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",mo="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Sa=mo+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Ss=Sa+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Yl={9:mo,10:Sa,11:Ss},kl={};function Bu(_){var V=kl[_]={binary:ve(Qi[_]+" "+Oa),nonBinary:{General_Category:ve(Oa),Script:ve(Yl[_])}};V.nonBinary.Script_Extensions=V.nonBinary.Script,V.nonBinary.gc=V.nonBinary.General_Category,V.nonBinary.sc=V.nonBinary.Script,V.nonBinary.scx=V.nonBinary.Script_Extensions}Bu(9),Bu(10),Bu(11);var Yt=ei.prototype,Yo=function(V){this.parser=V,this.validFlags="gim"+(V.options.ecmaVersion>=6?"uy":"")+(V.options.ecmaVersion>=9?"s":""),this.unicodeProperties=kl[V.options.ecmaVersion>=11?11:V.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Yo.prototype.reset=function(V,ce,De){var $e=De.indexOf("u")!==-1;this.start=V|0,this.source=ce+"",this.flags=De,this.switchU=$e&&this.parser.options.ecmaVersion>=6,this.switchN=$e&&this.parser.options.ecmaVersion>=9},Yo.prototype.raise=function(V){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+V)},Yo.prototype.at=function(V){var ce=this.source,De=ce.length;if(V>=De)return-1;var $e=ce.charCodeAt(V);if(!this.switchU||$e<=55295||$e>=57344||V+1>=De)return $e;var mt=ce.charCodeAt(V+1);return mt>=56320&&mt<=57343?($e<<10)+mt-56613888:$e},Yo.prototype.nextIndex=function(V){var ce=this.source,De=ce.length;if(V>=De)return De;var $e=ce.charCodeAt(V),mt;return!this.switchU||$e<=55295||$e>=57344||V+1>=De||(mt=ce.charCodeAt(V+1))<56320||mt>57343?V+1:V+2},Yo.prototype.current=function(){return this.at(this.pos)},Yo.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},Yo.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},Yo.prototype.eat=function(V){return this.current()===V?(this.advance(),!0):!1};function $u(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Yt.validateRegExpFlags=function(_){for(var V=_.validFlags,ce=_.flags,De=0;De<ce.length;De++){var $e=ce.charAt(De);V.indexOf($e)===-1&&this.raise(_.start,"Invalid regular expression flag"),ce.indexOf($e,De+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Yt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Yt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var V=0,ce=_.backReferenceNames;V<ce.length;V+=1){var De=ce[V];_.groupNames.indexOf(De)===-1&&_.raise("Invalid named capture referenced")}},Yt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Yt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Yt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Yt.regexp_eatAssertion=function(_){var V=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=V}if(_.eat(40)&&_.eat(63)){var ce=!1;if(this.options.ecmaVersion>=9&&(ce=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!ce,!0}return _.pos=V,!1},Yt.regexp_eatQuantifier=function(_,V){return V===void 0&&(V=!1),this.regexp_eatQuantifierPrefix(_,V)?(_.eat(63),!0):!1},Yt.regexp_eatQuantifierPrefix=function(_,V){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,V)},Yt.regexp_eatBracedQuantifier=function(_,V){var ce=_.pos;if(_.eat(123)){var De=0,$e=-1;if(this.regexp_eatDecimalDigits(_)&&(De=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&($e=_.lastIntValue),_.eat(125)))return $e!==-1&&$e<De&&!V&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!V&&_.raise("Incomplete quantifier"),_.pos=ce}return!1},Yt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Yt.regexp_eatReverseSolidusAtomEscape=function(_){var V=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=V}return!1},Yt.regexp_eatUncapturingGroup=function(_){var V=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=V}return!1},Yt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Yt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Yt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Yt.regexp_eatSyntaxCharacter=function(_){var V=_.current();return wc(V)?(_.lastIntValue=V,_.advance(),!0):!1};function wc(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Yt.regexp_eatPatternCharacters=function(_){for(var V=_.pos,ce=0;(ce=_.current())!==-1&&!wc(ce);)_.advance();return _.pos!==V},Yt.regexp_eatExtendedPatternCharacter=function(_){var V=_.current();return V!==-1&&V!==36&&!(V>=40&&V<=43)&&V!==46&&V!==63&&V!==91&&V!==94&&V!==124?(_.advance(),!0):!1},Yt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Yt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Yt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=$u(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=$u(_.lastIntValue);return!0}return!1},Yt.regexp_eatRegExpIdentifierStart=function(_){var V=_.pos,ce=_.current();return _.advance(),ce===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_)&&(ce=_.lastIntValue),Cl(ce)?(_.lastIntValue=ce,!0):(_.pos=V,!1)};function Cl(_){return _e(_,!0)||_===36||_===95}Yt.regexp_eatRegExpIdentifierPart=function(_){var V=_.pos,ce=_.current();return _.advance(),ce===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_)&&(ce=_.lastIntValue),qp(ce)?(_.lastIntValue=ce,!0):(_.pos=V,!1)};function qp(_){return Y(_,!0)||_===36||_===95||_===8204||_===8205}Yt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Yt.regexp_eatBackReference=function(_){var V=_.pos;if(this.regexp_eatDecimalEscape(_)){var ce=_.lastIntValue;if(_.switchU)return ce>_.maxBackReference&&(_.maxBackReference=ce),!0;if(ce<=_.numCapturingParens)return!0;_.pos=V}return!1},Yt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Yt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Yt.regexp_eatCControlLetter=function(_){var V=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=V}return!1},Yt.regexp_eatZero=function(_){return _.current()===48&&!Xl(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Yt.regexp_eatControlEscape=function(_){var V=_.current();return V===116?(_.lastIntValue=9,_.advance(),!0):V===110?(_.lastIntValue=10,_.advance(),!0):V===118?(_.lastIntValue=11,_.advance(),!0):V===102?(_.lastIntValue=12,_.advance(),!0):V===114?(_.lastIntValue=13,_.advance(),!0):!1},Yt.regexp_eatControlLetter=function(_){var V=_.current();return oh(V)?(_.lastIntValue=V%32,_.advance(),!0):!1};function oh(_){return _>=65&&_<=90||_>=97&&_<=122}Yt.regexp_eatRegExpUnicodeEscapeSequence=function(_){var V=_.pos;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var ce=_.lastIntValue;if(_.switchU&&ce>=55296&&ce<=56319){var De=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var $e=_.lastIntValue;if($e>=56320&&$e<=57343)return _.lastIntValue=(ce-55296)*1024+($e-56320)+65536,!0}_.pos=De,_.lastIntValue=ce}return!0}if(_.switchU&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&bd(_.lastIntValue))return!0;_.switchU&&_.raise("Invalid unicode escape"),_.pos=V}return!1};function bd(_){return _>=0&&_<=1114111}Yt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var V=_.current();return V!==99&&(!_.switchN||V!==107)?(_.lastIntValue=V,_.advance(),!0):!1},Yt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var V=_.current();if(V>=49&&V<=57){do _.lastIntValue=10*_.lastIntValue+(V-48),_.advance();while((V=_.current())>=48&&V<=57);return!0}return!1},Yt.regexp_eatCharacterClassEscape=function(_){var V=_.current();if(lh(V))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(V===80||V===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function lh(_){return _===100||_===68||_===115||_===83||_===119||_===87}Yt.regexp_eatUnicodePropertyValueExpression=function(_){var V=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var ce=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var De=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,ce,De),!0}}if(_.pos=V,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var $e=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,$e),!0}return!1},Yt.regexp_validateUnicodePropertyNameAndValue=function(_,V,ce){de(_.unicodeProperties.nonBinary,V)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[V].test(ce)||_.raise("Invalid property value")},Yt.regexp_validateUnicodePropertyNameOrValue=function(_,V){_.unicodeProperties.binary.test(V)||_.raise("Invalid property name")},Yt.regexp_eatUnicodePropertyName=function(_){var V=0;for(_.lastStringValue="";Ns(V=_.current());)_.lastStringValue+=$u(V),_.advance();return _.lastStringValue!==""};function Ns(_){return oh(_)||_===95}Yt.regexp_eatUnicodePropertyValue=function(_){var V=0;for(_.lastStringValue="";as(V=_.current());)_.lastStringValue+=$u(V),_.advance();return _.lastStringValue!==""};function as(_){return Ns(_)||Xl(_)}Yt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Yt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Yt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var V=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var ce=_.lastIntValue;_.switchU&&(V===-1||ce===-1)&&_.raise("Invalid character class"),V!==-1&&ce!==-1&&V>ce&&_.raise("Range out of order in character class")}}},Yt.regexp_eatClassAtom=function(_){var V=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var ce=_.current();(ce===99||Jl(ce))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=V}var De=_.current();return De!==93?(_.lastIntValue=De,_.advance(),!0):!1},Yt.regexp_eatClassEscape=function(_){var V=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=V}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Yt.regexp_eatClassControlLetter=function(_){var V=_.current();return Xl(V)||V===95?(_.lastIntValue=V%32,_.advance(),!0):!1},Yt.regexp_eatHexEscapeSequence=function(_){var V=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=V}return!1},Yt.regexp_eatDecimalDigits=function(_){var V=_.pos,ce=0;for(_.lastIntValue=0;Xl(ce=_.current());)_.lastIntValue=10*_.lastIntValue+(ce-48),_.advance();return _.pos!==V};function Xl(_){return _>=48&&_<=57}Yt.regexp_eatHexDigits=function(_){var V=_.pos,ce=0;for(_.lastIntValue=0;Rl(ce=_.current());)_.lastIntValue=16*_.lastIntValue+xu(ce),_.advance();return _.pos!==V};function Rl(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function xu(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Yt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var V=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var ce=_.lastIntValue;V<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=V*64+ce*8+_.lastIntValue:_.lastIntValue=V*8+ce}else _.lastIntValue=V;return!0}return!1},Yt.regexp_eatOctalDigit=function(_){var V=_.current();return Jl(V)?(_.lastIntValue=V-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Jl(_){return _>=48&&_<=55}Yt.regexp_eatFixedHexDigits=function(_,V){var ce=_.pos;_.lastIntValue=0;for(var De=0;De<V;++De){var $e=_.current();if(!Rl($e))return _.pos=ce,!1;_.lastIntValue=16*_.lastIntValue+xu($e),_.advance()}return!0};var yo=function(V){this.type=V.type,this.value=V.value,this.start=V.start,this.end=V.end,V.options.locations&&(this.loc=new Re(V,V.startLoc,V.endLoc)),V.options.ranges&&(this.range=[V.start,V.end])},Si=ei.prototype;Si.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new yo(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Si.getToken=function(){return this.next(),new yo(this)},typeof Symbol<"u"&&(Si[Symbol.iterator]=function(){var _=this;return{next:function(){var V=_.getToken();return{done:V.type===U.eof,value:V}}}}),Si.curContext=function(){return this.context[this.context.length-1]},Si.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(U.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},Si.readToken=function(_){return _e(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},Si.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var V=this.input.charCodeAt(this.pos+1);return(_<<10)+V-56613888},Si.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),V=this.pos,ce=this.input.indexOf("*/",this.pos+=2);if(ce===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=ce+2,this.options.locations){Fe.lastIndex=V;for(var De;(De=Fe.exec(this.input))&&De.index<this.pos;)++this.curLine,this.lineStart=De.index+De[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(V+2,ce),V,this.pos,_,this.curPosition())},Si.skipLineComment=function(_){for(var V=this.pos,ce=this.options.onComment&&this.curPosition(),De=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!bt(De);)De=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(V+_,this.pos),V,this.pos,ce,this.curPosition())},Si.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&v.test(String.fromCharCode(_)))++this.pos;else break e}}},Si.finishToken=function(_,V){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var ce=this.type;this.type=_,this.value=V,this.updateContext(ce)},Si.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var V=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&V===46?(this.pos+=3,this.finishToken(U.ellipsis)):(++this.pos,this.finishToken(U.dot))},Si.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(U.assign,2):this.finishOp(U.slash,1)},Si.readToken_mult_modulo_exp=function(_){var V=this.input.charCodeAt(this.pos+1),ce=1,De=_===42?U.star:U.modulo;return this.options.ecmaVersion>=7&&_===42&&V===42&&(++ce,De=U.starstar,V=this.input.charCodeAt(this.pos+2)),V===61?this.finishOp(U.assign,ce+1):this.finishOp(De,ce)},Si.readToken_pipe_amp=function(_){var V=this.input.charCodeAt(this.pos+1);return V===_?this.finishOp(_===124?U.logicalOR:U.logicalAND,2):V===61?this.finishOp(U.assign,2):this.finishOp(_===124?U.bitwiseOR:U.bitwiseAND,1)},Si.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(U.assign,2):this.finishOp(U.bitwiseXOR,1)},Si.readToken_plus_min=function(_){var V=this.input.charCodeAt(this.pos+1);return V===_?V===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Me.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(U.incDec,2):V===61?this.finishOp(U.assign,2):this.finishOp(U.plusMin,1)},Si.readToken_lt_gt=function(_){var V=this.input.charCodeAt(this.pos+1),ce=1;return V===_?(ce=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+ce)===61?this.finishOp(U.assign,ce+1):this.finishOp(U.bitShift,ce)):V===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(V===61&&(ce=2),this.finishOp(U.relational,ce))},Si.readToken_eq_excl=function(_){var V=this.input.charCodeAt(this.pos+1);return V===61?this.finishOp(U.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&V===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(U.arrow)):this.finishOp(_===61?U.eq:U.prefix,1)},Si.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(U.parenL);case 41:return++this.pos,this.finishToken(U.parenR);case 59:return++this.pos,this.finishToken(U.semi);case 44:return++this.pos,this.finishToken(U.comma);case 91:return++this.pos,this.finishToken(U.bracketL);case 93:return++this.pos,this.finishToken(U.bracketR);case 123:return++this.pos,this.finishToken(U.braceL);case 125:return++this.pos,this.finishToken(U.braceR);case 58:return++this.pos,this.finishToken(U.colon);case 63:return++this.pos,this.finishToken(U.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(U.backQuote);case 48:var V=this.input.charCodeAt(this.pos+1);if(V===120||V===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(V===111||V===79)return this.readRadixNumber(8);if(V===98||V===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 126:return this.finishOp(U.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ql(_)+"'")},Si.finishOp=function(_,V){var ce=this.input.slice(this.pos,this.pos+V);return this.pos+=V,this.finishToken(_,ce)},Si.readRegexp=function(){for(var _,V,ce=this.pos;;){this.pos>=this.input.length&&this.raise(ce,"Unterminated regular expression");var De=this.input.charAt(this.pos);if(Me.test(De)&&this.raise(ce,"Unterminated regular expression"),_)_=!1;else{if(De==="[")V=!0;else if(De==="]"&&V)V=!1;else if(De==="/"&&!V)break;_=De==="\\"}++this.pos}var $e=this.input.slice(ce,this.pos);++this.pos;var mt=this.pos,Dt=this.readWord1();this.containsEsc&&this.unexpected(mt);var Zt=this.regexpState||(this.regexpState=new Yo(this));Zt.reset(ce,$e,Dt),this.validateRegExpFlags(Zt),this.validateRegExpPattern(Zt);var Ln=null;try{Ln=new RegExp($e,Dt)}catch{}return this.finishToken(U.regexp,{pattern:$e,flags:Dt,value:Ln})},Si.readInt=function(_,V){for(var ce=this.pos,De=0,$e=0,mt=V??1/0;$e<mt;++$e){var Dt=this.input.charCodeAt(this.pos),Zt=void 0;if(Dt>=97?Zt=Dt-97+10:Dt>=65?Zt=Dt-65+10:Dt>=48&&Dt<=57?Zt=Dt-48:Zt=1/0,Zt>=_)break;++this.pos,De=De*_+Zt}return this.pos===ce||V!=null&&this.pos-ce!==V?null:De},Si.readRadixNumber=function(_){var V=this.pos;this.pos+=2;var ce=this.readInt(_);return ce==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(ce=typeof BigInt<"u"?BigInt(this.input.slice(V,this.pos)):null,++this.pos):_e(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(U.num,ce)},Si.readNumber=function(_){var V=this.pos;!_&&this.readInt(10)===null&&this.raise(V,"Invalid number");var ce=this.pos-V>=2&&this.input.charCodeAt(V)===48;ce&&this.strict&&this.raise(V,"Invalid number");var De=this.input.charCodeAt(this.pos);if(!ce&&!_&&this.options.ecmaVersion>=11&&De===110){var $e=this.input.slice(V,this.pos),mt=typeof BigInt<"u"?BigInt($e):null;return++this.pos,_e(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(U.num,mt)}ce&&/[89]/.test(this.input.slice(V,this.pos))&&(ce=!1),De===46&&!ce&&(++this.pos,this.readInt(10),De=this.input.charCodeAt(this.pos)),(De===69||De===101)&&!ce&&(De=this.input.charCodeAt(++this.pos),(De===43||De===45)&&++this.pos,this.readInt(10)===null&&this.raise(V,"Invalid number")),_e(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Dt=this.input.slice(V,this.pos),Zt=ce?parseInt(Dt,8):parseFloat(Dt);return this.finishToken(U.num,Zt)},Si.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),V;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var ce=++this.pos;V=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,V>1114111&&this.invalidStringToken(ce,"Code point out of bounds")}else V=this.readHexChar(4);return V};function Ql(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Si.readString=function(_){for(var V="",ce=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var De=this.input.charCodeAt(this.pos);if(De===_)break;De===92?(V+=this.input.slice(ce,this.pos),V+=this.readEscapedChar(!1),ce=this.pos):(bt(De,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return V+=this.input.slice(ce,this.pos++),this.finishToken(U.string,V)};var Sc={};Si.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Sc)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},Si.invalidStringToken=function(_,V){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Sc;this.raise(_,V)},Si.readTmplToken=function(){for(var _="",V=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var ce=this.input.charCodeAt(this.pos);if(ce===96||ce===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===U.template||this.type===U.invalidTemplate)?ce===36?(this.pos+=2,this.finishToken(U.dollarBraceL)):(++this.pos,this.finishToken(U.backQuote)):(_+=this.input.slice(V,this.pos),this.finishToken(U.template,_));if(ce===92)_+=this.input.slice(V,this.pos),_+=this.readEscapedChar(!0),V=this.pos;else if(bt(ce)){switch(_+=this.input.slice(V,this.pos),++this.pos,ce){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(ce);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),V=this.pos}else++this.pos}},Si.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(U.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Si.readEscapedChar=function(_){var V=this.input.charCodeAt(++this.pos);switch(++this.pos,V){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ql(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var ce=this.pos-1;return this.invalidStringToken(ce,"Invalid escape sequence in template string"),null}default:if(V>=48&&V<=55){var De=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],$e=parseInt(De,8);return $e>255&&(De=De.slice(0,-1),$e=parseInt(De,8)),this.pos+=De.length-1,V=this.input.charCodeAt(this.pos),(De!=="0"||V===56||V===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-De.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode($e)}return bt(V)?"":String.fromCharCode(V)}},Si.readHexChar=function(_){var V=this.pos,ce=this.readInt(16,_);return ce===null&&this.invalidStringToken(V,"Bad character escape sequence"),ce},Si.readWord1=function(){this.containsEsc=!1;for(var _="",V=!0,ce=this.pos,De=this.options.ecmaVersion>=6;this.pos<this.input.length;){var $e=this.fullCharCodeAtPos();if(Y($e,De))this.pos+=$e<=65535?1:2;else if($e===92){this.containsEsc=!0,_+=this.input.slice(ce,this.pos);var mt=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Dt=this.readCodePoint();(V?_e:Y)(Dt,De)||this.invalidStringToken(mt,"Invalid Unicode escape"),_+=Ql(Dt),ce=this.pos}else break;V=!1}return _+this.input.slice(ce,this.pos)},Si.readWord=function(){var _=this.readWord1(),V=U.name;return this.keywords.test(_)&&(V=vt[_]),this.finishToken(V,_)};var Tc="7.1.0";ei.acorn={Parser:ei,version:Tc,defaultOptions:Xe,Position:xe,SourceLocation:Re,getLineInfo:Ue,Node:Ji,TokenType:re,tokTypes:U,keywordTypes:vt,TokContext:wi,tokContexts:Fn,isIdentifierChar:Y,isIdentifierStart:_e,Token:yo,isNewLine:bt,lineBreak:Me,lineBreakG:Fe,nonASCIIwhitespace:v};function Dl(_,V){return ei.parse(_,V)}function xd(_,V,ce){return ei.parseExpressionAt(_,V,ce)}function wd(_,V){return ei.tokenizer(_,V)}D.Node=Ji,D.Parser=ei,D.Position=xe,D.SourceLocation=Re,D.TokContext=wi,D.Token=yo,D.TokenType=re,D.defaultOptions=Xe,D.getLineInfo=Ue,D.isIdentifierChar=Y,D.isIdentifierStart=_e,D.isNewLine=bt,D.keywordTypes=vt,D.lineBreak=Me,D.lineBreakG=Fe,D.nonASCIIwhitespace=v,D.parse=Dl,D.parseExpressionAt=xd,D.tokContexts=Fn,D.tokTypes=U,D.tokenizer=wd,D.version=Tc,Object.defineProperty(D,"__esModule",{value:!0})})},{}],2:[function(g,y,N){},{}],3:[function(g,y,N){function D(R,S={}){const{contextName:T="gl",throwGetError:G,useTrackablePrimitives:te,readPixelsFile:Te,recording:ie=[],variables:_e={},onReadPixels:Y,onUnrecognizedArgumentLookup:re}=S,be=new Proxy(R,{get:Me}),ke=[],rt={};let vt=0,Q="",U;return be;function Me(Ue,Xe){switch(Xe){case"addComment":return de;case"checkThrowError":return ue;case"getReadPixelsVariableName":return U;case"insertVariable":return v;case"reset":return bt;case"setIndent":return M;case"toString":return Fe;case"getContextVariableName":return Re}return typeof R[Xe]=="function"?function(){switch(Xe){case"getError":return G?ie.push(`${Q}if (${T}.getError() !== ${T}.NONE) throw new Error('error');`):ie.push(`${Q}${T}.getError();`),R.getError();case"getExtension":{const Ze=`${T}Variables${ke.length}`;ie.push(`${Q}const ${Ze} = ${T}.getExtension('${arguments[0]}');`);const gt=R.getExtension(arguments[0]);if(gt&&typeof gt=="object"){const wt=F(gt,{getEntity:I,useTrackablePrimitives:te,recording:ie,contextName:Ze,contextVariables:ke,variables:_e,indent:Q,onUnrecognizedArgumentLookup:re});return ke.push(wt),wt}else ke.push(null);return gt}case"readPixels":const Ge=ke.indexOf(arguments[6]);let et;if(Ge===-1){const Ze=xe(arguments[6]);Ze?(et=Ze,ie.push(`${Q}${Ze}`)):(et=`${T}Variable${ke.length}`,ke.push(arguments[6]),ie.push(`${Q}const ${et} = new ${arguments[6].constructor.name}(${arguments[6].length});`))}else et=`${T}Variable${Ge}`;U=et;const ot=[arguments[0],arguments[1],arguments[2],arguments[3],I(arguments[4]),I(arguments[5]),et];return ie.push(`${Q}${T}.readPixels(${ot.join(", ")});`),Te&&oe(arguments[2],arguments[3]),Y&&Y(et,ot),R.readPixels.apply(R,arguments);case"drawBuffers":return ie.push(`${Q}${T}.drawBuffers([${z(arguments[0],{contextName:T,contextVariables:ke,getEntity:I,addVariable:H,variables:_e,onUnrecognizedArgumentLookup:re})}]);`),R.drawBuffers(arguments[0])}let Ae=R[Xe].apply(R,arguments);switch(typeof Ae){case"undefined":ie.push(`${Q}${ve(Xe,arguments)};`);return;case"number":case"boolean":if(te&&ke.indexOf(k(Ae))===-1){ie.push(`${Q}const ${T}Variable${ke.length} = ${ve(Xe,arguments)};`),ke.push(Ae=k(Ae));break}default:Ae===null?ie.push(`${ve(Xe,arguments)};`):ie.push(`${Q}const ${T}Variable${ke.length} = ${ve(Xe,arguments)};`),ke.push(Ae)}return Ae}:(rt[R[Xe]]=Xe,R[Xe])}function Fe(){return ie.join(`
`)}function bt(){for(;ie.length>0;)ie.pop()}function v(Ue,Xe){_e[Ue]=Xe}function I(Ue){const Xe=rt[Ue];return Xe?T+"."+Xe:Ue}function M(Ue){Q=" ".repeat(Ue)}function H(Ue,Xe){const Ae=`${T}Variable${ke.length}`;return ie.push(`${Q}const ${Ae} = ${Xe};`),ke.push(Ue),Ae}function oe(Ue,Xe){const Ae=`${T}Variable${ke.length}`,Ge=`imageDatum${vt}`;ie.push(`${Q}let ${Ge} = ["P3\\n# ${Te}.ppm\\n", ${Ue}, ' ', ${Xe}, "\\n255\\n"].join("");`),ie.push(`${Q}for (let i = 0; i < ${Ge}.length; i += 4) {`),ie.push(`${Q}  ${Ge} += ${Ae}[i] + ' ' + ${Ae}[i + 1] + ' ' + ${Ae}[i + 2] + ' ';`),ie.push(`${Q}}`),ie.push(`${Q}if (typeof require !== "undefined") {`),ie.push(`${Q}  require('fs').writeFileSync('./${Te}.ppm', ${Ge});`),ie.push(`${Q}}`),vt++}function de(Ue){ie.push(`${Q}// ${Ue}`)}function ue(){ie.push(`${Q}(() => {
${Q}const error = ${T}.getError();
${Q}if (error !== ${T}.NONE) {
${Q}  const names = Object.getOwnPropertyNames(gl);
${Q}  for (let i = 0; i < names.length; i++) {
${Q}    const name = names[i];
${Q}    if (${T}[name] === error) {
${Q}      throw new Error('${T} threw ' + name);
${Q}    }
${Q}  }
${Q}}
${Q}})();`)}function ve(Ue,Xe){return`${T}.${Ue}(${z(Xe,{contextName:T,contextVariables:ke,getEntity:I,addVariable:H,variables:_e,onUnrecognizedArgumentLookup:re})})`}function xe(Ue){if(_e){for(const Xe in _e)if(_e[Xe]===Ue)return Xe}return null}function Re(Ue){const Xe=ke.indexOf(Ue);return Xe!==-1?`${T}Variable${Xe}`:null}}function F(R,S){const T=new Proxy(R,{get:rt}),G={},{contextName:te,contextVariables:Te,getEntity:ie,useTrackablePrimitives:_e,recording:Y,variables:re,indent:be,onUnrecognizedArgumentLookup:ke}=S;return T;function rt(Me,Fe){return typeof Me[Fe]=="function"?function(){switch(Fe){case"drawBuffersWEBGL":return Y.push(`${be}${te}.drawBuffersWEBGL([${z(arguments[0],{contextName:te,contextVariables:Te,getEntity:vt,addVariable:U,variables:re,onUnrecognizedArgumentLookup:ke})}]);`),R.drawBuffersWEBGL(arguments[0])}let bt=R[Fe].apply(R,arguments);switch(typeof bt){case"undefined":Y.push(`${be}${Q(Fe,arguments)};`);return;case"number":case"boolean":_e&&Te.indexOf(k(bt))===-1?(Y.push(`${be}const ${te}Variable${Te.length} = ${Q(Fe,arguments)};`),Te.push(bt=k(bt))):(Y.push(`${be}const ${te}Variable${Te.length} = ${Q(Fe,arguments)};`),Te.push(bt));break;default:bt===null?Y.push(`${Q(Fe,arguments)};`):Y.push(`${be}const ${te}Variable${Te.length} = ${Q(Fe,arguments)};`),Te.push(bt)}return bt}:(G[R[Fe]]=Fe,R[Fe])}function vt(Me){return G.hasOwnProperty(Me)?`${te}.${G[Me]}`:ie(Me)}function Q(Me,Fe){return`${te}.${Me}(${z(Fe,{contextName:te,contextVariables:Te,getEntity:vt,addVariable:U,variables:re,onUnrecognizedArgumentLookup:ke})})`}function U(Me,Fe){const bt=`${te}Variable${Te.length}`;return Te.push(Me),Y.push(`${be}const ${bt} = ${Fe};`),bt}}function z(R,S){const{variables:T,onUnrecognizedArgumentLookup:G}=S;return Array.from(R).map(Te=>{const ie=te(Te);return ie||P(Te,S)}).join(", ");function te(Te){if(T){for(const ie in T)if(T.hasOwnProperty(ie)&&T[ie]===Te)return ie}return G?G(Te):null}}function P(R,S){const{contextName:T,contextVariables:G,getEntity:te,addVariable:Te,onUnrecognizedArgumentLookup:ie}=S;if(typeof R>"u")return"undefined";if(R===null)return"null";const _e=G.indexOf(R);if(_e>-1)return`${T}Variable${_e}`;switch(R.constructor.name){case"String":const Y=/\n/.test(R),re=/'/.test(R),be=/"/.test(R);return Y?"`"+R+"`":re&&!be?'"'+R+'"':"'"+R+"'";case"Number":return te(R);case"Boolean":return te(R);case"Array":return Te(R,`new ${R.constructor.name}([${Array.from(R).join(",")}])`);case"Float32Array":case"Uint8Array":case"Uint16Array":case"Int32Array":return Te(R,`new ${R.constructor.name}(${JSON.stringify(Array.from(R))})`);default:if(ie){const ke=ie(R);if(ke)return ke}throw new Error(`unrecognized argument type ${R.constructor.name}`)}}function k(R){return new R.constructor(R)}typeof y<"u"&&(y.exports={glWiretap:D,glExtensionWiretap:F}),typeof window<"u"&&(D.glExtensionWiretap=F,window.glWiretap=D)},{}],4:[function(g,y,N){function D(Te){const ie=new Array(Te.length);for(let _e=0;_e<Te.length;_e++){const Y=Te[_e];Y.toArray?ie[_e]=Y.toArray():ie[_e]=Y}return ie}function F(){const Te=D(arguments),ie=new Float32Array(this.output.x);for(let _e=0;_e<this.output.x;_e++)this.thread.x=_e,this.thread.y=0,this.thread.z=0,ie[_e]=this._fn.apply(this,Te);return ie}function z(){const Te=D(arguments),ie=new Array(this.output.y);for(let _e=0;_e<this.output.y;_e++){const Y=new Float32Array(this.output.x);for(let re=0;re<this.output.x;re++)this.thread.x=re,this.thread.y=_e,this.thread.z=0,Y[re]=this._fn.apply(this,Te);ie[_e]=Y}return ie}function P(){const Te=D(arguments);for(let ie=0;ie<this.output.y;ie++)for(let _e=0;_e<this.output.x;_e++)this.thread.x=_e,this.thread.y=ie,this.thread.z=0,this._fn.apply(this,Te)}function k(){const Te=D(arguments),ie=new Array(this.output.z);for(let _e=0;_e<this.output.z;_e++){const Y=new Array(this.output.y);for(let re=0;re<this.output.y;re++){const be=new Float32Array(this.output.x);for(let ke=0;ke<this.output.x;ke++)this.thread.x=ke,this.thread.y=re,this.thread.z=_e,be[ke]=this._fn.apply(this,Te);Y[re]=be}ie[_e]=Y}return ie}function R(Te){Te.setOutput=Y=>{Te.output=T(Y),Te.graphical&&S(Te)},Te.toJSON=()=>{throw new Error("Not usable with gpuMock")},Te.setConstants=Y=>(Te.constants=Y,Te),Te.setGraphical=Y=>(Te.graphical=Y,Te),Te.setCanvas=Y=>(Te.canvas=Y,Te),Te.setContext=Y=>(Te.context=Y,Te),Te.destroy=()=>{},Te.validateSettings=()=>{},Te.graphical&&Te.output&&S(Te),Te.exec=function(){return new Promise((Y,re)=>{try{Y(Te.apply(Te,arguments))}catch(be){re(be)}})},Te.getPixels=Y=>{const{x:re,y:be}=Te.output;return Y?te(Te._imageData.data,re,be):Te._imageData.data.slice(0)},Te.color=function(Y,re,be,ke){typeof ke>"u"&&(ke=1),Y=Math.floor(Y*255),re=Math.floor(re*255),be=Math.floor(be*255),ke=Math.floor(ke*255);const rt=Te.output.x,vt=Te.output.y,Q=Te.thread.x,U=vt-Te.thread.y-1,Me=Q+U*rt;Te._colorData[Me*4+0]=Y,Te._colorData[Me*4+1]=re,Te._colorData[Me*4+2]=be,Te._colorData[Me*4+3]=ke};const ie=()=>Te,_e=["setWarnVarUsage","setArgumentTypes","setTactic","setOptimizeFloatMemory","setDebug","setLoopMaxIterations","setConstantTypes","setFunctions","setNativeFunctions","setInjectedNative","setPipeline","setPrecision","setOutputToTexture","setImmutable","setStrictIntegers","setDynamicOutput","setHardcodeConstants","setDynamicArguments","setUseLegacyEncoder","setWarnVarUsage","addSubKernel"];for(let Y=0;Y<_e.length;Y++)Te[_e[Y]]=ie;return Te}function S(Te){const{x:ie,y:_e}=Te.output;if(Te.context&&Te.context.createImageData){const Y=new Uint8ClampedArray(ie*_e*4);Te._imageData=Te.context.createImageData(ie,_e),Te._colorData=Y}else{const Y=new Uint8ClampedArray(ie*_e*4);Te._imageData={data:Y},Te._colorData=Y}}function T(Te){let ie=null;if(Te.length)if(Te.length===3){const[_e,Y,re]=Te;ie={x:_e,y:Y,z:re}}else if(Te.length===2){const[_e,Y]=Te;ie={x:_e,y:Y}}else{const[_e]=Te;ie={x:_e}}else ie=Te;return ie}function G(Te,ie={}){const _e=ie.output?T(ie.output):null;function Y(){return Y.output.z?k.apply(Y,arguments):Y.output.y?Y.graphical?P.apply(Y,arguments):z.apply(Y,arguments):F.apply(Y,arguments)}return Y._fn=Te,Y.constants=ie.constants||null,Y.context=ie.context||null,Y.canvas=ie.canvas||null,Y.graphical=ie.graphical||!1,Y._imageData=null,Y._colorData=null,Y.output=_e,Y.thread={x:0,y:0,z:0},R(Y)}function te(Te,ie,_e){const Y=_e/2|0,re=ie*4,be=new Uint8ClampedArray(ie*4),ke=Te.slice(0);for(let rt=0;rt<Y;++rt){const vt=rt*re,Q=(_e-rt-1)*re;be.set(ke.subarray(vt,vt+re)),ke.copyWithin(vt,Q,Q+re),ke.set(be,Q)}return ke}y.exports={gpuMock:G}},{}],5:[function(g,y,N){const{utils:D}=g("./utils");function F(z,P){const k=P.toString();return new Function(`return function ${z} (${D.getArgumentNamesFromString(k).join(", ")}) {
  ${D.getFunctionBodyFromString(k)}
}`)()}y.exports={alias:F}},{"./utils":114}],6:[function(g,y,N){const{FunctionNode:D}=g("../function-node");class F extends D{astFunction(P,k){if(!this.isRootKernel){k.push("function"),k.push(" "),k.push(this.name),k.push("(");for(let R=0;R<this.argumentNames.length;++R){const S=this.argumentNames[R];R>0&&k.push(", "),k.push("user_"),k.push(S)}k.push(`) {
`)}for(let R=0;R<P.body.body.length;++R)this.astGeneric(P.body.body[R],k),k.push(`
`);return this.isRootKernel||k.push(`}
`),k}astReturnStatement(P,k){const R=this.returnType||this.getType(P.argument);return this.returnType||(this.returnType=R),this.isRootKernel?(k.push(this.leadingReturnStatement),this.astGeneric(P.argument,k),k.push(`;
`),k.push(this.followingReturnStatement),k.push(`continue;
`)):this.isSubKernel?(k.push(`subKernelResult_${this.name} = `),this.astGeneric(P.argument,k),k.push(";"),k.push(`return subKernelResult_${this.name};`)):(k.push("return "),this.astGeneric(P.argument,k),k.push(";")),k}astLiteral(P,k){if(isNaN(P.value))throw this.astErrorOutput("Non-numeric literal not supported : "+P.value,P);return k.push(P.value),k}astBinaryExpression(P,k){return k.push("("),this.astGeneric(P.left,k),k.push(P.operator),this.astGeneric(P.right,k),k.push(")"),k}astIdentifierExpression(P,k){if(P.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",P);switch(P.name){case"Infinity":k.push("Infinity");break;default:this.constants&&this.constants.hasOwnProperty(P.name)?k.push("constants_"+P.name):k.push("user_"+P.name)}return k}astForStatement(P,k){if(P.type!=="ForStatement")throw this.astErrorOutput("Invalid for statement",P);const R=[],S=[],T=[],G=[];let te=null;if(P.init){this.pushState("in-for-loop-init"),this.astGeneric(P.init,R);for(let Te=0;Te<R.length;Te++)R[Te].includes&&R[Te].includes(",")&&(te=!1);this.popState("in-for-loop-init")}else te=!1;if(P.test?this.astGeneric(P.test,S):te=!1,P.update?this.astGeneric(P.update,T):te=!1,P.body&&(this.pushState("loop-body"),this.astGeneric(P.body,G),this.popState("loop-body")),te===null&&(te=this.isSafe(P.init)&&this.isSafe(P.test)),te)k.push(`for (${R.join("")};${S.join("")};${T.join("")}){
`),k.push(G.join("")),k.push(`}
`);else{const Te=this.getInternalVariableName("safeI");R.length>0&&k.push(R.join(""),`;
`),k.push(`for (let ${Te}=0;${Te}<LOOP_MAX;${Te}++){
`),S.length>0&&k.push(`if (!${S.join("")}) break;
`),k.push(G.join("")),k.push(`
${T.join("")};`),k.push(`}
`)}return k}astWhileStatement(P,k){if(P.type!=="WhileStatement")throw this.astErrorOutput("Invalid while statement",P);return k.push("for (let i = 0; i < LOOP_MAX; i++) {"),k.push("if ("),this.astGeneric(P.test,k),k.push(`) {
`),this.astGeneric(P.body,k),k.push(`} else {
`),k.push(`break;
`),k.push(`}
`),k.push(`}
`),k}astDoWhileStatement(P,k){if(P.type!=="DoWhileStatement")throw this.astErrorOutput("Invalid while statement",P);return k.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(P.body,k),k.push("if (!"),this.astGeneric(P.test,k),k.push(`) {
`),k.push(`break;
`),k.push(`}
`),k.push(`}
`),k}astAssignmentExpression(P,k){const R=this.getDeclaration(P.left);if(R&&!R.assignable)throw this.astErrorOutput(`Variable ${P.left.name} is not assignable here`,P);return this.astGeneric(P.left,k),k.push(P.operator),this.astGeneric(P.right,k),k}astBlockStatement(P,k){if(this.isState("loop-body")){this.pushState("block-body");for(let R=0;R<P.body.length;R++)this.astGeneric(P.body[R],k);this.popState("block-body")}else{k.push(`{
`);for(let R=0;R<P.body.length;R++)this.astGeneric(P.body[R],k);k.push(`}
`)}return k}astVariableDeclaration(P,k){k.push(`${P.kind} `);const{declarations:R}=P;for(let S=0;S<R.length;S++){S>0&&k.push(",");const T=R[S],G=this.getDeclaration(T.id);G.valueType||(G.valueType=this.getType(T.init)),this.astGeneric(T,k)}return this.isState("in-for-loop-init")||k.push(";"),k}astIfStatement(P,k){return k.push("if ("),this.astGeneric(P.test,k),k.push(")"),P.consequent.type==="BlockStatement"?this.astGeneric(P.consequent,k):(k.push(` {
`),this.astGeneric(P.consequent,k),k.push(`
}
`)),P.alternate&&(k.push("else "),P.alternate.type==="BlockStatement"||P.alternate.type==="IfStatement"?this.astGeneric(P.alternate,k):(k.push(` {
`),this.astGeneric(P.alternate,k),k.push(`
}
`))),k}astSwitchStatement(P,k){const{discriminant:R,cases:S}=P;k.push("switch ("),this.astGeneric(R,k),k.push(`) {
`);for(let T=0;T<S.length;T++){if(S[T].test===null){k.push(`default:
`),this.astGeneric(S[T].consequent,k),S[T].consequent&&S[T].consequent.length>0&&k.push(`break;
`);continue}k.push("case "),this.astGeneric(S[T].test,k),k.push(`:
`),S[T].consequent&&S[T].consequent.length>0&&(this.astGeneric(S[T].consequent,k),k.push(`break;
`))}k.push(`
}`)}astThisExpression(P,k){return k.push("_this"),k}astMemberExpression(P,k){const{signature:R,type:S,property:T,xProperty:G,yProperty:te,zProperty:Te,name:ie,origin:_e}=this.getMemberExpressionDetails(P);switch(R){case"this.thread.value":return k.push(`_this.thread.${ie}`),k;case"this.output.value":switch(ie){case"x":k.push("outputX");break;case"y":k.push("outputY");break;case"z":k.push("outputZ");break;default:throw this.astErrorOutput("Unexpected expression",P)}return k;case"value":throw this.astErrorOutput("Unexpected expression",P);case"value[]":case"value[][]":case"value[][][]":case"value.value":if(_e==="Math")return k.push(Math[ie]),k;switch(T){case"r":return k.push(`user_${ie}[0]`),k;case"g":return k.push(`user_${ie}[1]`),k;case"b":return k.push(`user_${ie}[2]`),k;case"a":return k.push(`user_${ie}[3]`),k}break;case"this.constants.value":case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":break;case"fn()[]":return this.astGeneric(P.object,k),k.push("["),this.astGeneric(P.property,k),k.push("]"),k;case"fn()[][]":return this.astGeneric(P.object.object,k),k.push("["),this.astGeneric(P.object.property,k),k.push("]"),k.push("["),this.astGeneric(P.property,k),k.push("]"),k;default:throw this.astErrorOutput("Unexpected expression",P)}if(!P.computed)switch(S){case"Number":case"Integer":case"Float":case"Boolean":return k.push(`${_e}_${ie}`),k}const Y=`${_e}_${ie}`;switch(S){case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"HTMLImageArray":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"HTMLImage":default:let re,be;if(_e==="constants"){const ke=this.constants[ie];be=this.constantTypes[ie]==="Input",re=be?ke.size:null}else be=this.isInput(ie),re=be?this.argumentSizes[this.argumentNames.indexOf(ie)]:null;k.push(`${Y}`),Te&&te?be?(k.push("[("),this.astGeneric(Te,k),k.push(`*${this.dynamicArguments?"(outputY * outputX)":re[1]*re[0]})+(`),this.astGeneric(te,k),k.push(`*${this.dynamicArguments?"outputX":re[0]})+`),this.astGeneric(G,k),k.push("]")):(k.push("["),this.astGeneric(Te,k),k.push("]"),k.push("["),this.astGeneric(te,k),k.push("]"),k.push("["),this.astGeneric(G,k),k.push("]")):te?be?(k.push("[("),this.astGeneric(te,k),k.push(`*${this.dynamicArguments?"outputX":re[0]})+`),this.astGeneric(G,k),k.push("]")):(k.push("["),this.astGeneric(te,k),k.push("]"),k.push("["),this.astGeneric(G,k),k.push("]")):typeof G<"u"&&(k.push("["),this.astGeneric(G,k),k.push("]"))}return k}astCallExpression(P,k){if(P.type!=="CallExpression")throw this.astErrorOutput("Unknown CallExpression",P);let R=this.astMemberExpressionUnroll(P.callee);this.calledFunctions.indexOf(R)<0&&this.calledFunctions.push(R),this.isAstMathFunction(P),this.onFunctionCall&&this.onFunctionCall(this.name,R,P.arguments),k.push(R),k.push("(");const S=this.lookupFunctionArgumentTypes(R)||[];for(let T=0;T<P.arguments.length;++T){const G=P.arguments[T];let te=this.getType(G);S[T]||this.triggerImplyArgumentType(R,T,te,this),T>0&&k.push(", "),this.astGeneric(G,k)}return k.push(")"),k}astArrayExpression(P,k){const R=this.getType(P),S=P.elements.length,T=[];for(let G=0;G<S;++G){const te=[];this.astGeneric(P.elements[G],te),T.push(te.join(""))}switch(R){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":k.push(`[${T.join(", ")}]`);break;default:k.push(`new Float32Array([${T.join(", ")}])`)}return k}astDebuggerStatement(P,k){return k.push("debugger;"),k}}y.exports={CPUFunctionNode:F}},{"../function-node":10}],7:[function(g,y,N){const{utils:D}=g("../../utils");function F(P,k){const R=[];for(const S in k){if(!k.hasOwnProperty(S))continue;const T=k[S],G=P[S];switch(T){case"Number":case"Integer":case"Float":case"Boolean":R.push(`${S}:${G}`);break;case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":R.push(`${S}:new ${G.constructor.name}(${JSON.stringify(Array.from(G))})`);break}}return`{ ${R.join()} }`}function z(P,k){const R=[],S=[],T=[],G=!/^function/.test(P.color.toString());if(R.push("  const { context, canvas, constants: incomingConstants } = settings;",`  const output = new Int32Array(${JSON.stringify(Array.from(P.output))});`,`  const _constantTypes = ${JSON.stringify(P.constantTypes)};`,`  const _constants = ${F(P.constants,P.constantTypes)};`),S.push("    constants: _constants,","    context,","    output,","    thread: {x: 0, y: 0, z: 0},"),P.graphical){R.push(`  const _imageData = context.createImageData(${P.output[0]}, ${P.output[1]});`),R.push(`  const _colorData = new Uint8ClampedArray(${P.output[0]} * ${P.output[1]} * 4);`);const ie=D.flattenFunctionToString((G?"function ":"")+P.color.toString(),{thisLookup:Y=>{switch(Y){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(P[Y])},findDependency:(Y,re)=>null}),_e=D.flattenFunctionToString((G?"function ":"")+P.getPixels.toString(),{thisLookup:Y=>{switch(Y){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(P[Y])},findDependency:()=>null});S.push("    _imageData,","    _colorData,",`    color: ${ie},`),T.push(`  kernel.getPixels = ${_e};`)}const te=[],Te=Object.keys(P.constantTypes);for(let ie=0;ie<Te.length;ie++)te.push(P.constantTypes[Te]);if(P.argumentTypes.indexOf("HTMLImageArray")!==-1||te.indexOf("HTMLImageArray")!==-1){const ie=D.flattenFunctionToString((G?"function ":"")+P._imageTo3DArray.toString(),{doNotDefine:["canvas"],findDependency:(_e,Y)=>_e==="this"?(G?"function ":"")+P[Y].toString():null,thisLookup:_e=>{switch(_e){case"canvas":return;case"context":return"context"}}});T.push(ie),S.push("    _mediaTo2DArray,"),S.push("    _imageTo3DArray,")}else if(P.argumentTypes.indexOf("HTMLImage")!==-1||te.indexOf("HTMLImage")!==-1){const ie=D.flattenFunctionToString((G?"function ":"")+P._mediaTo2DArray.toString(),{findDependency:(_e,Y)=>null,thisLookup:_e=>{switch(_e){case"canvas":return"settings.canvas";case"context":return"settings.context"}throw new Error("unhandled thisLookup")}});T.push(ie),S.push("    _mediaTo2DArray,")}return`function(settings) {
${R.join(`
`)}
  for (const p in _constantTypes) {
    if (!_constantTypes.hasOwnProperty(p)) continue;
    const type = _constantTypes[p];
    switch (type) {
      case 'Number':
      case 'Integer':
      case 'Float':
      case 'Boolean':
      case 'Array(2)':
      case 'Array(3)':
      case 'Array(4)':
      case 'Matrix(2)':
      case 'Matrix(3)':
      case 'Matrix(4)':
        if (incomingConstants.hasOwnProperty(p)) {
          console.warn('constant ' + p + ' of type ' + type + ' cannot be resigned');
        }
        continue;
    }
    if (!incomingConstants.hasOwnProperty(p)) {
      throw new Error('constant ' + p + ' not found');
    }
    _constants[p] = incomingConstants[p];
  }
  const kernel = (function() {
${P._kernelString}
  })
    .apply({ ${S.join(`
`)} });
  ${T.join(`
`)}
  return kernel;
}`}y.exports={cpuKernelString:z}},{"../../utils":114}],8:[function(g,y,N){const{Kernel:D}=g("../kernel"),{FunctionBuilder:F}=g("../function-builder"),{CPUFunctionNode:z}=g("./function-node"),{utils:P}=g("../../utils"),{cpuKernelString:k}=g("./kernel-string");class R extends D{static getFeatures(){return this.features}static get features(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}static get isSupported(){return!0}static isContextMatch(T){return!1}static get mode(){return"cpu"}static nativeFunctionArguments(){return null}static nativeFunctionReturnType(){throw new Error(`Looking up native function return type not supported on ${this.name}`)}static combineKernels(T){return T}static getSignature(T,G){return"cpu"+(G.length>0?":"+G.join(","):"")}constructor(T,G){super(T,G),this.mergeSettings(T.settings||G),this._imageData=null,this._colorData=null,this._kernelString=null,this._prependedString=[],this.thread={x:0,y:0,z:0},this.translatedSources=null}initCanvas(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0)}initContext(){return this.canvas?this.canvas.getContext("2d"):null}initPlugins(T){return[]}validateSettings(T){if(!this.output||this.output.length===0){if(T.length!==1)throw new Error("Auto output only supported for kernels with only one input");const G=P.getVariableType(T[0],this.strictIntegers);if(G==="Array")this.output=P.getDimensions(G);else if(G==="NumberTexture"||G==="ArrayTexture(4)")this.output=T[0].output;else throw new Error("Auto output not supported for input type: "+G)}if(this.graphical&&this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.checkOutput()}translateSource(){if(this.leadingReturnStatement=this.output.length>1?"resultX[x] = ":"result[x] = ",this.subKernels){const G=[];for(let te=0;te<this.subKernels.length;te++){const{name:Te}=this.subKernels[te];G.push(this.output.length>1?`resultX_${Te}[x] = subKernelResult_${Te};
`:`result_${Te}[x] = subKernelResult_${Te};
`)}this.followingReturnStatement=G.join("")}const T=F.fromKernel(this,z);this.translatedSources=T.getPrototypes("kernel"),!this.graphical&&!this.returnType&&(this.returnType=T.getKernelResultType())}build(){if(this.built)return;if(this.setupConstants(),this.setupArguments(arguments),this.validateSettings(arguments),this.translateSource(),this.graphical){const{canvas:G,output:te}=this;if(!G)throw new Error("no canvas available for using graphical output");const Te=te[0],ie=te[1]||1;G.width=Te,G.height=ie,this._imageData=this.context.createImageData(Te,ie),this._colorData=new Uint8ClampedArray(Te*ie*4)}const T=this.getKernelString();this.kernelString=T,this.debug&&(console.log("Function output:"),console.log(T));try{this.run=new Function([],T).bind(this)()}catch(G){console.error("An error occurred compiling the javascript: ",G)}this.buildSignature(arguments),this.built=!0}color(T,G,te,Te){typeof Te>"u"&&(Te=1),T=Math.floor(T*255),G=Math.floor(G*255),te=Math.floor(te*255),Te=Math.floor(Te*255);const ie=this.output[0],_e=this.output[1],Y=this.thread.x,re=_e-this.thread.y-1,be=Y+re*ie;this._colorData[be*4+0]=T,this._colorData[be*4+1]=G,this._colorData[be*4+2]=te,this._colorData[be*4+3]=Te}getKernelString(){if(this._kernelString!==null)return this._kernelString;let T=null,{translatedSources:G}=this;return G.length>1?G=G.filter(te=>/^function/.test(te)?te:(T=te,!1)):T=G.shift(),this._kernelString=`  const LOOP_MAX = ${this._getLoopMaxString()};
  ${this.injectedNative||""}
  const _this = this;
  ${this._resultKernelHeader()}
  ${this._processConstants()}
  return (${this.argumentNames.map(te=>"user_"+te).join(", ")}) => {
    ${this._prependedString.join("")}
    ${this._earlyThrows()}
    ${this._processArguments()}
    ${this.graphical?this._graphicalKernelBody(T):this._resultKernelBody(T)}
    ${G.length>0?G.join(`
`):""}
  };`}toString(){return k(this)}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};`:" 1000;"}_processConstants(){if(!this.constants)return"";const T=[];for(let G in this.constants)switch(this.constantTypes[G]){case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":T.push(`    const constants_${G} = this._mediaTo2DArray(this.constants.${G});
`);break;case"HTMLImageArray":T.push(`    const constants_${G} = this._imageTo3DArray(this.constants.${G});
`);break;case"Input":T.push(`    const constants_${G} = this.constants.${G}.value;
`);break;default:T.push(`    const constants_${G} = this.constants.${G};
`)}return T.join("")}_earlyThrows(){if(this.graphical||this.immutable||!this.pipeline)return"";const T=[];for(let te=0;te<this.argumentTypes.length;te++)this.argumentTypes[te]==="Array"&&T.push(this.argumentNames[te]);if(T.length===0)return"";const G=[];for(let te=0;te<T.length;te++){const Te=T[te],ie=this._mapSubKernels(_e=>`user_${Te} === result_${_e.name}`).join(" || ");G.push(`user_${Te} === result${ie?` || ${ie}`:""}`)}return`if (${G.join(" || ")}) throw new Error('Source and destination arrays are the same.  Use immutable = true');`}_processArguments(){const T=[];for(let G=0;G<this.argumentTypes.length;G++){const te=`user_${this.argumentNames[G]}`;switch(this.argumentTypes[G]){case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":T.push(`    ${te} = this._mediaTo2DArray(${te});
`);break;case"HTMLImageArray":T.push(`    ${te} = this._imageTo3DArray(${te});
`);break;case"Input":T.push(`    ${te} = ${te}.value;
`);break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"NumberTexture":case"MemoryOptimizedNumberTexture":T.push(`
    if (${te}.toArray) {
      if (!_this.textureCache) {
        _this.textureCache = [];
        _this.arrayCache = [];
      }
      const textureIndex = _this.textureCache.indexOf(${te});
      if (textureIndex !== -1) {
        ${te} = _this.arrayCache[textureIndex];
      } else {
        _this.textureCache.push(${te});
        ${te} = ${te}.toArray();
        _this.arrayCache.push(${te});
      }
    }`);break}}return T.join("")}_mediaTo2DArray(T){const G=this.canvas,te=T.width>0?T.width:T.videoWidth,Te=T.height>0?T.height:T.videoHeight;G.width<te&&(G.width=te),G.height<Te&&(G.height=Te);const ie=this.context;let _e;T.constructor===ImageData?_e=T.data:(ie.drawImage(T,0,0,te,Te),_e=ie.getImageData(0,0,te,Te).data);const Y=new Array(Te);let re=0;for(let be=Te-1;be>=0;be--){const ke=Y[be]=new Array(te);for(let rt=0;rt<te;rt++){const vt=new Float32Array(4);vt[0]=_e[re++]/255,vt[1]=_e[re++]/255,vt[2]=_e[re++]/255,vt[3]=_e[re++]/255,ke[rt]=vt}}return Y}getPixels(T){const[G,te]=this.output;return T?P.flipPixels(this._imageData.data,G,te):this._imageData.data.slice(0)}_imageTo3DArray(T){const G=new Array(T.length);for(let te=0;te<T.length;te++)G[te]=this._mediaTo2DArray(T[te]);return G}_resultKernelHeader(){if(this.graphical||this.immutable||!this.pipeline)return"";switch(this.output.length){case 1:return this._mutableKernel1DResults();case 2:return this._mutableKernel2DResults();case 3:return this._mutableKernel3DResults()}}_resultKernelBody(T){switch(this.output.length){case 1:return(!this.immutable&&this.pipeline?this._resultMutableKernel1DLoop(T):this._resultImmutableKernel1DLoop(T))+this._kernelOutput();case 2:return(!this.immutable&&this.pipeline?this._resultMutableKernel2DLoop(T):this._resultImmutableKernel2DLoop(T))+this._kernelOutput();case 3:return(!this.immutable&&this.pipeline?this._resultMutableKernel3DLoop(T):this._resultImmutableKernel3DLoop(T))+this._kernelOutput();default:throw new Error("unsupported size kernel")}}_graphicalKernelBody(T){switch(this.output.length){case 2:return this._graphicalKernel2DLoop(T)+this._graphicalOutput();default:throw new Error("unsupported size kernel")}}_graphicalOutput(){return`
    this._imageData.data.set(this._colorData);
    this.context.putImageData(this._imageData, 0, 0);
    return;`}_getKernelResultTypeConstructorString(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return"Float32Array";case"Array(2)":case"Array(3)":case"Array(4)":return"Array";default:if(this.graphical)return"Float32Array";throw new Error(`unhandled returnType ${this.returnType}`)}}_resultImmutableKernel1DLoop(T){const G=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const result = new ${G}(outputX);
    ${this._mapSubKernels(te=>`const result_${te.name} = new ${G}(outputX);
`).join("    ")}
    ${this._mapSubKernels(te=>`let subKernelResult_${te.name};
`).join("    ")}
    for (let x = 0; x < outputX; x++) {
      this.thread.x = x;
      this.thread.y = 0;
      this.thread.z = 0;
      ${T}
    }`}_mutableKernel1DResults(){const T=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const result = new ${T}(outputX);
    ${this._mapSubKernels(G=>`const result_${G.name} = new ${T}(outputX);
`).join("    ")}
    ${this._mapSubKernels(G=>`let subKernelResult_${G.name};
`).join("    ")}`}_resultMutableKernel1DLoop(T){return`  const outputX = _this.output[0];
    for (let x = 0; x < outputX; x++) {
      this.thread.x = x;
      this.thread.y = 0;
      this.thread.z = 0;
      ${T}
    }`}_resultImmutableKernel2DLoop(T){const G=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const result = new Array(outputY);
    ${this._mapSubKernels(te=>`const result_${te.name} = new Array(outputY);
`).join("    ")}
    ${this._mapSubKernels(te=>`let subKernelResult_${te.name};
`).join("    ")}
    for (let y = 0; y < outputY; y++) {
      this.thread.z = 0;
      this.thread.y = y;
      const resultX = result[y] = new ${G}(outputX);
      ${this._mapSubKernels(te=>`const resultX_${te.name} = result_${te.name}[y] = new ${G}(outputX);
`).join("")}
      for (let x = 0; x < outputX; x++) {
        this.thread.x = x;
        ${T}
      }
    }`}_mutableKernel2DResults(){const T=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const result = new Array(outputY);
    ${this._mapSubKernels(G=>`const result_${G.name} = new Array(outputY);
`).join("    ")}
    ${this._mapSubKernels(G=>`let subKernelResult_${G.name};
`).join("    ")}
    for (let y = 0; y < outputY; y++) {
      const resultX = result[y] = new ${T}(outputX);
      ${this._mapSubKernels(G=>`const resultX_${G.name} = result_${G.name}[y] = new ${T}(outputX);
`).join("")}
    }`}_resultMutableKernel2DLoop(T){const G=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    for (let y = 0; y < outputY; y++) {
      this.thread.z = 0;
      this.thread.y = y;
      const resultX = result[y];
      ${this._mapSubKernels(te=>`const resultX_${te.name} = result_${te.name}[y] = new ${G}(outputX);
`).join("")}
      for (let x = 0; x < outputX; x++) {
        this.thread.x = x;
        ${T}
      }
    }`}_graphicalKernel2DLoop(T){return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    for (let y = 0; y < outputY; y++) {
      this.thread.z = 0;
      this.thread.y = y;
      for (let x = 0; x < outputX; x++) {
        this.thread.x = x;
        ${T}
      }
    }`}_resultImmutableKernel3DLoop(T){const G=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const outputZ = _this.output[2];
    const result = new Array(outputZ);
    ${this._mapSubKernels(te=>`const result_${te.name} = new Array(outputZ);
`).join("    ")}
    ${this._mapSubKernels(te=>`let subKernelResult_${te.name};
`).join("    ")}
    for (let z = 0; z < outputZ; z++) {
      this.thread.z = z;
      const resultY = result[z] = new Array(outputY);
      ${this._mapSubKernels(te=>`const resultY_${te.name} = result_${te.name}[z] = new Array(outputY);
`).join("      ")}
      for (let y = 0; y < outputY; y++) {
        this.thread.y = y;
        const resultX = resultY[y] = new ${G}(outputX);
        ${this._mapSubKernels(te=>`const resultX_${te.name} = resultY_${te.name}[y] = new ${G}(outputX);
`).join("        ")}
        for (let x = 0; x < outputX; x++) {
          this.thread.x = x;
          ${T}
        }
      }
    }`}_mutableKernel3DResults(){const T=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const outputZ = _this.output[2];
    const result = new Array(outputZ);
    ${this._mapSubKernels(G=>`const result_${G.name} = new Array(outputZ);
`).join("    ")}
    ${this._mapSubKernels(G=>`let subKernelResult_${G.name};
`).join("    ")}
    for (let z = 0; z < outputZ; z++) {
      const resultY = result[z] = new Array(outputY);
      ${this._mapSubKernels(G=>`const resultY_${G.name} = result_${G.name}[z] = new Array(outputY);
`).join("      ")}
      for (let y = 0; y < outputY; y++) {
        const resultX = resultY[y] = new ${T}(outputX);
        ${this._mapSubKernels(G=>`const resultX_${G.name} = resultY_${G.name}[y] = new ${T}(outputX);
`).join("        ")}
      }
    }`}_resultMutableKernel3DLoop(T){return`  const outputX = _this.output[0];
    const outputY = _this.output[1];
    const outputZ = _this.output[2];
    for (let z = 0; z < outputZ; z++) {
      this.thread.z = z;
      const resultY = result[z];
      for (let y = 0; y < outputY; y++) {
        this.thread.y = y;
        const resultX = resultY[y];
        for (let x = 0; x < outputX; x++) {
          this.thread.x = x;
          ${T}
        }
      }
    }`}_kernelOutput(){return this.subKernels?`
    return {
      result: result,
      ${this.subKernels.map(T=>`${T.property}: result_${T.name}`).join(`,
      `)}
    };`:`
    return result;`}_mapSubKernels(T){return this.subKernels===null?[""]:this.subKernels.map(T)}destroy(T){T&&delete this.canvas}static destroyContext(T){}toJSON(){const T=super.toJSON();return T.functionNodes=F.fromKernel(this,z).toJSON(),T}setOutput(T){super.setOutput(T);const[G,te]=this.output;this.graphical&&(this._imageData=this.context.createImageData(G,te),this._colorData=new Uint8ClampedArray(G*te*4))}prependString(T){if(this._kernelString)throw new Error("Kernel already built");this._prependedString.push(T)}hasPrependString(T){return this._prependedString.indexOf(T)>-1}}y.exports={CPUKernel:R}},{"../../utils":114,"../function-builder":9,"../kernel":36,"./function-node":6,"./kernel-string":7}],9:[function(g,y,N){class D{static fromKernel(z,P,k){const{kernelArguments:R,kernelConstants:S,argumentNames:T,argumentSizes:G,argumentBitRatios:te,constants:Te,constantBitRatios:ie,debug:_e,loopMaxIterations:Y,nativeFunctions:re,output:be,optimizeFloatMemory:ke,precision:rt,plugins:vt,source:Q,subKernels:U,functions:Me,leadingReturnStatement:Fe,followingReturnStatement:bt,dynamicArguments:v,dynamicOutput:I}=z,M=new Array(R.length),H={};for(let ht=0;ht<R.length;ht++)M[ht]=R[ht].type;for(let ht=0;ht<S.length;ht++){const Ut=S[ht];H[Ut.name]=Ut.type}const oe=(ht,Ut)=>Nt.needsArgumentType(ht,Ut),de=(ht,Ut,Bt)=>{Nt.assignArgumentType(ht,Ut,Bt)},ue=(ht,Ut,Bt)=>Nt.lookupReturnType(ht,Ut,Bt),ve=ht=>Nt.lookupFunctionArgumentTypes(ht),xe=(ht,Ut)=>Nt.lookupFunctionArgumentName(ht,Ut),Re=(ht,Ut)=>Nt.lookupFunctionArgumentBitRatio(ht,Ut),Ue=(ht,Ut,Bt,In)=>{Nt.assignArgumentType(ht,Ut,Bt,In)},Xe=(ht,Ut,Bt,In)=>{Nt.assignArgumentBitRatio(ht,Ut,Bt,In)},Ae=(ht,Ut,Bt)=>{Nt.trackFunctionCall(ht,Ut,Bt)},Ge=(ht,Ut)=>{const Bt=[];for(let nn=0;nn<ht.params.length;nn++)Bt.push(ht.params[nn].name);const In=new P(Ut,Object.assign({},et,{returnType:null,ast:ht,name:ht.id.name,argumentNames:Bt,lookupReturnType:ue,lookupFunctionArgumentTypes:ve,lookupFunctionArgumentName:xe,lookupFunctionArgumentBitRatio:Re,needsArgumentType:oe,assignArgumentType:de,triggerImplyArgumentType:Ue,triggerImplyArgumentBitRatio:Xe,onFunctionCall:Ae}));In.traceFunctionAST(ht),Nt.addFunctionNode(In)},et=Object.assign({isRootKernel:!1,onNestedFunction:Ge,lookupReturnType:ue,lookupFunctionArgumentTypes:ve,lookupFunctionArgumentName:xe,lookupFunctionArgumentBitRatio:Re,needsArgumentType:oe,assignArgumentType:de,triggerImplyArgumentType:Ue,triggerImplyArgumentBitRatio:Xe,onFunctionCall:Ae,optimizeFloatMemory:ke,precision:rt,constants:Te,constantTypes:H,constantBitRatios:ie,debug:_e,loopMaxIterations:Y,output:be,plugins:vt,dynamicArguments:v,dynamicOutput:I},k||{}),ot=Object.assign({},et,{isRootKernel:!0,name:"kernel",argumentNames:T,argumentTypes:M,argumentSizes:G,argumentBitRatios:te,leadingReturnStatement:Fe,followingReturnStatement:bt});if(typeof Q=="object"&&Q.functionNodes)return new D().fromJSON(Q.functionNodes,P);const Ze=new P(Q,ot);let gt=null;Me&&(gt=Me.map(ht=>new P(ht.source,{returnType:ht.returnType,argumentTypes:ht.argumentTypes,output:be,plugins:vt,constants:Te,constantTypes:H,constantBitRatios:ie,optimizeFloatMemory:ke,precision:rt,lookupReturnType:ue,lookupFunctionArgumentTypes:ve,lookupFunctionArgumentName:xe,lookupFunctionArgumentBitRatio:Re,needsArgumentType:oe,assignArgumentType:de,triggerImplyArgumentType:Ue,triggerImplyArgumentBitRatio:Xe,onFunctionCall:Ae,onNestedFunction:Ge})));let wt=null;U&&(wt=U.map(ht=>{const{name:Ut,source:Bt}=ht;return new P(Bt,Object.assign({},et,{name:Ut,isSubKernel:!0,isRootKernel:!1}))}));const Nt=new D({kernel:z,rootNode:Ze,functionNodes:gt,nativeFunctions:re,subKernelNodes:wt});return Nt}constructor(z){if(z=z||{},this.kernel=z.kernel,this.rootNode=z.rootNode,this.functionNodes=z.functionNodes||[],this.subKernelNodes=z.subKernelNodes||[],this.nativeFunctions=z.nativeFunctions||[],this.functionMap={},this.nativeFunctionNames=[],this.lookupChain=[],this.functionNodeDependencies={},this.functionCalls={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(let P=0;P<this.functionNodes.length;P++)this.functionMap[this.functionNodes[P].name]=this.functionNodes[P];if(this.subKernelNodes)for(let P=0;P<this.subKernelNodes.length;P++)this.functionMap[this.subKernelNodes[P].name]=this.subKernelNodes[P];if(this.nativeFunctions)for(let P=0;P<this.nativeFunctions.length;P++){const k=this.nativeFunctions[P];this.nativeFunctionNames.push(k.name)}}addFunctionNode(z){if(!z.name)throw new Error("functionNode.name needs set");this.functionMap[z.name]=z,z.isRootKernel&&(this.rootNode=z)}traceFunctionCalls(z,P){if(z=z||"kernel",P=P||[],this.nativeFunctionNames.indexOf(z)>-1){const R=P.indexOf(z);if(R===-1)P.push(z);else{const S=P.splice(R,1)[0];P.push(S)}return P}const k=this.functionMap[z];if(k){const R=P.indexOf(z);if(R===-1){P.push(z),k.toString();for(let S=0;S<k.calledFunctions.length;++S)this.traceFunctionCalls(k.calledFunctions[S],P)}else{const S=P.splice(R,1)[0];P.push(S)}}return P}getPrototypeString(z){return this.getPrototypes(z).join(`
`)}getPrototypes(z){return this.rootNode&&this.rootNode.toString(),z?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(z,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.functionMap))}getStringFromFunctionNames(z){const P=[];for(let k=0;k<z.length;++k)this.functionMap[z[k]]&&P.push(this.functionMap[z[k]].toString());return P.join(`
`)}getPrototypesFromFunctionNames(z){const P=[];for(let k=0;k<z.length;++k){const R=z[k],S=this.nativeFunctionNames.indexOf(R);if(S>-1){P.push(this.nativeFunctions[S].source);continue}const T=this.functionMap[R];T&&P.push(T.toString())}return P}toJSON(){return this.traceFunctionCalls(this.rootNode.name).reverse().map(z=>{const P=this.nativeFunctions.indexOf(z);if(P>-1)return{name:z,source:this.nativeFunctions[P].source};if(this.functionMap[z])return this.functionMap[z].toJSON();throw new Error(`function ${z} not found`)})}fromJSON(z,P){this.functionMap={};for(let k=0;k<z.length;k++){const R=z[k];this.functionMap[R.settings.name]=new P(R.ast,R.settings)}return this}getString(z){return z?this.getStringFromFunctionNames(this.traceFunctionCalls(z).reverse()):this.getStringFromFunctionNames(Object.keys(this.functionMap))}lookupReturnType(z,P,k){if(P.type!=="CallExpression")throw new Error(`expected ast type of "CallExpression", but is ${P.type}`);if(this._isNativeFunction(z))return this._lookupNativeFunctionReturnType(z);if(this._isFunction(z)){const R=this._getFunction(z);if(R.returnType)return R.returnType;{for(let T=0;T<this.lookupChain.length;T++)if(this.lookupChain[T].ast===P){if(R.argumentTypes.length===0&&P.arguments.length>0){const G=P.arguments;for(let te=0;te<G.length;te++)this.lookupChain.push({name:k.name,ast:G[T],requestingNode:k}),R.argumentTypes[te]=k.getType(G[te]),this.lookupChain.pop();return R.returnType=R.getType(R.getJsAST())}throw new Error("circlical logic detected!")}this.lookupChain.push({name:k.name,ast:P,requestingNode:k});const S=R.getType(R.getJsAST());return this.lookupChain.pop(),R.returnType=S}}return null}_getFunction(z){return this._isFunction(z),this.functionMap[z]}_isFunction(z){return!!this.functionMap[z]}_getNativeFunction(z){for(let P=0;P<this.nativeFunctions.length;P++)if(this.nativeFunctions[P].name===z)return this.nativeFunctions[P];return null}_isNativeFunction(z){return!!this._getNativeFunction(z)}_lookupNativeFunctionReturnType(z){let P=this._getNativeFunction(z);if(P)return P.returnType;throw new Error(`Native function ${z} not found`)}lookupFunctionArgumentTypes(z){return this._isNativeFunction(z)?this._getNativeFunction(z).argumentTypes:this._isFunction(z)?this._getFunction(z).argumentTypes:null}lookupFunctionArgumentName(z,P){return this._getFunction(z).argumentNames[P]}lookupFunctionArgumentBitRatio(z,P){if(!this._isFunction(z))throw new Error("function not found");if(this.rootNode.name===z){const T=this.rootNode.argumentNames.indexOf(P);if(T!==-1)return this.rootNode.argumentBitRatios[T]}const k=this._getFunction(z),R=k.argumentNames.indexOf(P);if(R===-1)throw new Error("argument not found");const S=k.argumentBitRatios[R];if(typeof S!="number")throw new Error("argument bit ratio not found");return S}needsArgumentType(z,P){return this._isFunction(z)?!this._getFunction(z).argumentTypes[P]:!1}assignArgumentType(z,P,k,R){if(!this._isFunction(z))return;const S=this._getFunction(z);S.argumentTypes[P]||(S.argumentTypes[P]=k)}assignArgumentBitRatio(z,P,k,R){const S=this._getFunction(z);if(this._isNativeFunction(k))return null;const T=this._getFunction(k),G=S.argumentNames.indexOf(P);if(G===-1)throw new Error(`Argument ${P} not found in arguments from function ${z}`);const te=S.argumentBitRatios[G];if(typeof te!="number")throw new Error(`Bit ratio for argument ${P} not found in function ${z}`);T.argumentBitRatios||(T.argumentBitRatios=new Array(T.argumentNames.length));const Te=T.argumentBitRatios[G];if(typeof Te=="number"){if(Te!==te)throw new Error(`Incompatible bit ratio found at function ${z} at argument ${P}`);return Te}return T.argumentBitRatios[G]=te,te}trackFunctionCall(z,P,k){this.functionNodeDependencies[z]||(this.functionNodeDependencies[z]=new Set,this.functionCalls[z]=[]),this.functionNodeDependencies[z].add(P),this.functionCalls[z].push(k)}getKernelResultType(){return this.rootNode.returnType||this.rootNode.getType(this.rootNode.ast)}getSubKernelResultType(z){const P=this.subKernelNodes[z];let k=!1;for(let R=0;R<this.rootNode.functionCalls.length;R++)this.rootNode.functionCalls[R].ast.callee.name===P.name&&(k=!0);if(!k)throw new Error(`SubKernel ${P.name} never called by kernel`);return P.returnType||P.getType(P.getJsAST())}getReturnTypes(){const z={[this.rootNode.name]:this.rootNode.getType(this.rootNode.ast)},P=this.traceFunctionCalls(this.rootNode.name);for(let k=0;k<P.length;k++){const R=P[k],S=this.functionMap[R];z[R]=S.getType(S.ast)}return z}}y.exports={FunctionBuilder:D}},{}],10:[function(g,y,N){const D=g("acorn"),{utils:F}=g("../utils"),{FunctionTracer:z}=g("./function-tracer");class P{constructor(S,T){if(!S&&!T.ast)throw new Error("source parameter is missing");if(T=T||{},this.source=S,this.ast=null,this.name=typeof S=="string"?T.isRootKernel?"kernel":T.name||F.getFunctionNameFromString(S):null,this.calledFunctions=[],this.constants={},this.constantTypes={},this.constantBitRatios={},this.isRootKernel=!1,this.isSubKernel=!1,this.debug=null,this.functions=null,this.identifiers=null,this.contexts=null,this.functionCalls=null,this.states=[],this.needsArgumentType=null,this.assignArgumentType=null,this.lookupReturnType=null,this.lookupFunctionArgumentTypes=null,this.lookupFunctionArgumentBitRatio=null,this.triggerImplyArgumentType=null,this.triggerImplyArgumentBitRatio=null,this.onNestedFunction=null,this.onFunctionCall=null,this.optimizeFloatMemory=null,this.precision=null,this.loopMaxIterations=null,this.argumentNames=typeof this.source=="string"?F.getArgumentNamesFromString(this.source):null,this.argumentTypes=[],this.argumentSizes=[],this.argumentBitRatios=null,this.returnType=null,this.output=[],this.plugins=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.dynamicOutput=null,this.dynamicArguments=null,this.strictTypingChecking=!1,this.fixIntegerDivisionAccuracy=null,T)for(const G in T)T.hasOwnProperty(G)&&this.hasOwnProperty(G)&&(this[G]=T[G]);this.literalTypes={},this.validate(),this._string=null,this._internalVariableNames={}}validate(){if(typeof this.source!="string"&&!this.ast)throw new Error("this.source not a string");if(!this.ast&&!F.isFunctionString(this.source))throw new Error("this.source not a function string");if(!this.name)throw new Error("this.name could not be set");if(this.argumentTypes.length>0&&this.argumentTypes.length!==this.argumentNames.length)throw new Error(`argumentTypes count of ${this.argumentTypes.length} exceeds ${this.argumentNames.length}`);if(this.output.length<1)throw new Error("this.output is not big enough")}isIdentifierConstant(S){return this.constants?this.constants.hasOwnProperty(S):!1}isInput(S){return this.argumentTypes[this.argumentNames.indexOf(S)]==="Input"}pushState(S){this.states.push(S)}popState(S){if(this.state!==S)throw new Error(`Cannot popState ${S} when in ${this.state}`);this.states.pop()}isState(S){return this.state===S}get state(){return this.states[this.states.length-1]}astMemberExpressionUnroll(S){if(S.type==="Identifier")return S.name;if(S.type==="ThisExpression")return"this";if(S.type==="MemberExpression"&&S.object&&S.property)return S.object.hasOwnProperty("name")&&S.object.name!=="Math"?this.astMemberExpressionUnroll(S.property):this.astMemberExpressionUnroll(S.object)+"."+this.astMemberExpressionUnroll(S.property);if(S.hasOwnProperty("expressions")){const T=S.expressions[0];if(T.type==="Literal"&&T.value===0&&S.expressions.length===2)return this.astMemberExpressionUnroll(S.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",S)}getJsAST(S){if(this.ast)return this.ast;if(typeof this.source=="object")return this.traceFunctionAST(this.source),this.ast=this.source;if(S=S||D,S===null)throw new Error("Missing JS to AST parser");const T=Object.freeze(S.parse(`const parser_${this.name} = ${this.source};`,{locations:!0})),G=T.body[0].declarations[0].init;if(this.traceFunctionAST(G),!T)throw new Error("Failed to parse JS code");return this.ast=G}traceFunctionAST(S){const{contexts:T,declarations:G,functions:te,identifiers:Te,functionCalls:ie}=new z(S);this.contexts=T,this.identifiers=Te,this.functionCalls=ie,this.functions=te;for(let _e=0;_e<G.length;_e++){const Y=G[_e],{ast:re,inForLoopInit:be,inForLoopTest:ke}=Y,{init:rt}=re,vt=this.getDependencies(rt);let Q=null;if(be&&ke)Q="Integer";else if(rt){const U=this.getType(rt);switch(U){case"Integer":case"Float":case"Number":rt.type==="MemberExpression"?Q=U:Q="Number";break;case"LiteralInteger":Q="Number";break;default:Q=U}}Y.valueType=Q,Y.dependencies=vt,Y.isSafe=this.isSafeDependencies(vt)}for(let _e=0;_e<te.length;_e++)this.onNestedFunction(te[_e],this.source)}getDeclaration(S){for(let T=0;T<this.identifiers.length;T++){const G=this.identifiers[T];if(S===G.ast)return G.declaration}return null}getVariableType(S){if(S.type!=="Identifier")throw new Error(`ast of ${S.type} not "Identifier"`);let T=null;const G=this.argumentNames.indexOf(S.name);if(G===-1){const te=this.getDeclaration(S);if(te)return te.valueType}else{const te=this.argumentTypes[G];te&&(T=te)}if(!T&&this.strictTypingChecking)throw new Error(`Declaration of ${name} not found`);return T}getLookupType(S){if(!k.hasOwnProperty(S))throw new Error(`unknown typeLookupMap ${S}`);return k[S]}getConstantType(S){if(this.constantTypes[S]){const T=this.constantTypes[S];return T==="Float"?"Number":T}throw new Error(`Type for constant "${S}" not declared`)}toString(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}toJSON(){const S={source:this.source,name:this.name,constants:this.constants,constantTypes:this.constantTypes,isRootKernel:this.isRootKernel,isSubKernel:this.isSubKernel,debug:this.debug,output:this.output,loopMaxIterations:this.loopMaxIterations,argumentNames:this.argumentNames,argumentTypes:this.argumentTypes,argumentSizes:this.argumentSizes,returnType:this.returnType,leadingReturnStatement:this.leadingReturnStatement,followingReturnStatement:this.followingReturnStatement};return{ast:this.ast,settings:S}}getType(S){if(Array.isArray(S))return this.getType(S[S.length-1]);switch(S.type){case"BlockStatement":return this.getType(S.body);case"ArrayExpression":switch(this.getType(S.elements[0])){case"Array(2)":case"Array(3)":case"Array(4)":return`Matrix(${S.elements.length})`}return`Array(${S.elements.length})`;case"Literal":const G=this.astKey(S);return this.literalTypes[G]?this.literalTypes[G]:Number.isInteger(S.value)?"LiteralInteger":S.value===!0||S.value===!1?"Boolean":"Number";case"AssignmentExpression":return this.getType(S.left);case"CallExpression":if(this.isAstMathFunction(S))return"Number";if(!S.callee||!S.callee.name){if(S.callee.type==="SequenceExpression"&&S.callee.expressions[S.callee.expressions.length-1].property.name){const Y=S.callee.expressions[S.callee.expressions.length-1].property.name;return this.inferArgumentTypesIfNeeded(Y,S.arguments),this.lookupReturnType(Y,S,this)}if(this.getVariableSignature(S.callee,!0)==="this.color")return null;if(S.callee.type==="MemberExpression"&&S.callee.object&&S.callee.property&&S.callee.property.name&&S.arguments){const Y=S.callee.property.name;return this.inferArgumentTypesIfNeeded(Y,S.arguments),this.lookupReturnType(Y,S,this)}throw this.astErrorOutput("Unknown call expression",S)}if(S.callee&&S.callee.name){const Y=S.callee.name;return this.inferArgumentTypesIfNeeded(Y,S.arguments),this.lookupReturnType(Y,S,this)}throw this.astErrorOutput(`Unhandled getType Type "${S.type}"`,S);case"LogicalExpression":return"Boolean";case"BinaryExpression":switch(S.operator){case"%":case"/":if(this.fixIntegerDivisionAccuracy)return"Number";break;case">":case"<":return"Boolean";case"&":case"|":case"^":case"<<":case">>":case">>>":return"Integer"}const te=this.getType(S.left);if(this.isState("skip-literal-correction"))return te;if(te==="LiteralInteger"){const Y=this.getType(S.right);return Y==="LiteralInteger"?S.left.value%1===0?"Integer":"Float":Y}return k[te]||te;case"UpdateExpression":return this.getType(S.argument);case"UnaryExpression":return S.operator==="~"?"Integer":this.getType(S.argument);case"VariableDeclaration":{const Y=S.declarations;let re;for(let be=0;be<Y.length;be++){const ke=Y[be];re=this.getType(ke)}if(!re)throw this.astErrorOutput("Unable to find type for declaration",S);return re}case"VariableDeclarator":const Te=this.getDeclaration(S.id);if(!Te)throw this.astErrorOutput("Unable to find declarator",S);if(!Te.valueType)throw this.astErrorOutput("Unable to find declarator valueType",S);return Te.valueType;case"Identifier":if(S.name==="Infinity")return"Number";if(this.isAstVariable(S)&&this.getVariableSignature(S)==="value")return this.getCheckVariableType(S);const ie=this.findIdentifierOrigin(S);return ie&&ie.init?this.getType(ie.init):null;case"ReturnStatement":return this.getType(S.argument);case"MemberExpression":if(this.isAstMathFunction(S)){switch(S.property.name){case"ceil":return"Integer";case"floor":return"Integer";case"round":return"Integer"}return"Number"}if(this.isAstVariable(S)){switch(this.getVariableSignature(S)){case"value[]":return this.getLookupType(this.getCheckVariableType(S.object));case"value[][]":return this.getLookupType(this.getCheckVariableType(S.object.object));case"value[][][]":return this.getLookupType(this.getCheckVariableType(S.object.object.object));case"value[][][][]":return this.getLookupType(this.getCheckVariableType(S.object.object.object.object));case"value.thread.value":case"this.thread.value":return"Integer";case"this.output.value":return this.dynamicOutput?"Integer":"LiteralInteger";case"this.constants.value":return this.getConstantType(S.property.name);case"this.constants.value[]":return this.getLookupType(this.getConstantType(S.object.property.name));case"this.constants.value[][]":return this.getLookupType(this.getConstantType(S.object.object.property.name));case"this.constants.value[][][]":return this.getLookupType(this.getConstantType(S.object.object.object.property.name));case"this.constants.value[][][][]":return this.getLookupType(this.getConstantType(S.object.object.object.object.property.name));case"fn()[]":case"fn()[][]":case"fn()[][][]":return this.getLookupType(this.getType(S.object));case"value.value":if(this.isAstMathVariable(S))return"Number";switch(S.property.name){case"r":case"g":case"b":case"a":return this.getLookupType(this.getCheckVariableType(S.object))}case"[][]":return"Number"}throw this.astErrorOutput("Unhandled getType MemberExpression",S)}throw this.astErrorOutput("Unhandled getType MemberExpression",S);case"ConditionalExpression":return this.getType(S.consequent);case"FunctionDeclaration":case"FunctionExpression":const _e=this.findLastReturn(S.body);return _e?this.getType(_e):null;case"IfStatement":return this.getType(S.consequent);case"SequenceExpression":return this.getType(S.expressions[S.expressions.length-1]);default:throw this.astErrorOutput(`Unhandled getType Type "${S.type}"`,S)}}getCheckVariableType(S){const T=this.getVariableType(S);if(!T)throw this.astErrorOutput(`${S.type} is not defined`,S);return T}inferArgumentTypesIfNeeded(S,T){for(let G=0;G<T.length;G++){if(!this.needsArgumentType(S,G))continue;const te=this.getType(T[G]);if(!te)throw this.astErrorOutput(`Unable to infer argument ${G}`,T[G]);this.assignArgumentType(S,G,te)}}isAstMathVariable(S){const T=["E","PI","SQRT2","SQRT1_2","LN2","LN10","LOG2E","LOG10E"];return S.type==="MemberExpression"&&S.object&&S.object.type==="Identifier"&&S.object.name==="Math"&&S.property&&S.property.type==="Identifier"&&T.indexOf(S.property.name)>-1}isAstMathFunction(S){const T=["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","expm1","exp","floor","fround","imul","log","log2","log10","log1p","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"];return S.type==="CallExpression"&&S.callee&&S.callee.type==="MemberExpression"&&S.callee.object&&S.callee.object.type==="Identifier"&&S.callee.object.name==="Math"&&S.callee.property&&S.callee.property.type==="Identifier"&&T.indexOf(S.callee.property.name)>-1}isAstVariable(S){return S.type==="Identifier"||S.type==="MemberExpression"}isSafe(S){return this.isSafeDependencies(this.getDependencies(S))}isSafeDependencies(S){return S&&S.every?S.every(T=>T.isSafe):!0}getDependencies(S,T,G){if(T||(T=[]),!S)return null;if(Array.isArray(S)){for(let te=0;te<S.length;te++)this.getDependencies(S[te],T,G);return T}switch(S.type){case"AssignmentExpression":return this.getDependencies(S.left,T,G),this.getDependencies(S.right,T,G),T;case"ConditionalExpression":return this.getDependencies(S.test,T,G),this.getDependencies(S.alternate,T,G),this.getDependencies(S.consequent,T,G),T;case"Literal":T.push({origin:"literal",value:S.value,isSafe:G===!0?!1:S.value>-1/0&&S.value<1/0&&!isNaN(S.value)});break;case"VariableDeclarator":return this.getDependencies(S.init,T,G);case"Identifier":const te=this.getDeclaration(S);if(te)T.push({name:S.name,origin:"declaration",isSafe:G?!1:this.isSafeDependencies(te.dependencies)});else if(this.argumentNames.indexOf(S.name)>-1)T.push({name:S.name,origin:"argument",isSafe:!1});else if(this.strictTypingChecking)throw new Error(`Cannot find identifier origin "${S.name}"`);break;case"FunctionDeclaration":return this.getDependencies(S.body.body[S.body.body.length-1],T,G);case"ReturnStatement":return this.getDependencies(S.argument,T);case"BinaryExpression":case"LogicalExpression":return G=S.operator==="/"||S.operator==="*",this.getDependencies(S.left,T,G),this.getDependencies(S.right,T,G),T;case"UnaryExpression":case"UpdateExpression":return this.getDependencies(S.argument,T,G);case"VariableDeclaration":return this.getDependencies(S.declarations,T,G);case"ArrayExpression":return T.push({origin:"declaration",isSafe:!0}),T;case"CallExpression":return T.push({origin:"function",isSafe:!0}),T;case"MemberExpression":const Te=this.getMemberExpressionDetails(S);switch(Te.signature){case"value[]":this.getDependencies(S.object,T,G);break;case"value[][]":this.getDependencies(S.object.object,T,G);break;case"value[][][]":this.getDependencies(S.object.object.object,T,G);break;case"this.output.value":this.dynamicOutput&&T.push({name:Te.name,origin:"output",isSafe:!1});break}if(Te)return Te.property&&this.getDependencies(Te.property,T,G),Te.xProperty&&this.getDependencies(Te.xProperty,T,G),Te.yProperty&&this.getDependencies(Te.yProperty,T,G),Te.zProperty&&this.getDependencies(Te.zProperty,T,G),T;case"SequenceExpression":return this.getDependencies(S.expressions,T,G);default:throw this.astErrorOutput(`Unhandled type ${S.type} in getDependencies`,S)}return T}getVariableSignature(S,T){if(!this.isAstVariable(S))throw new Error(`ast of type "${S.type}" is not a variable signature`);if(S.type==="Identifier")return"value";const G=[];for(;S;)S.computed?G.push("[]"):S.type==="ThisExpression"?G.unshift("this"):S.property&&S.property.name?S.property.name==="x"||S.property.name==="y"||S.property.name==="z"?G.unshift(T?"."+S.property.name:".value"):S.property.name==="constants"||S.property.name==="thread"||S.property.name==="output"?G.unshift("."+S.property.name):G.unshift(T?"."+S.property.name:".value"):S.name?G.unshift(T?S.name:"value"):S.callee&&S.callee.name?G.unshift(T?S.callee.name+"()":"fn()"):S.elements?G.unshift("[]"):G.unshift("unknown"),S=S.object;const te=G.join("");return T||["value","value[]","value[][]","value[][][]","value[][][][]","value.value","value.thread.value","this.thread.value","this.output.value","this.constants.value","this.constants.value[]","this.constants.value[][]","this.constants.value[][][]","this.constants.value[][][][]","fn()[]","fn()[][]","fn()[][][]","[][]"].indexOf(te)>-1?te:null}build(){return this.toString().length>0}astGeneric(S,T){if(S===null)throw this.astErrorOutput("NULL ast",S);if(Array.isArray(S)){for(let G=0;G<S.length;G++)this.astGeneric(S[G],T);return T}switch(S.type){case"FunctionDeclaration":return this.astFunctionDeclaration(S,T);case"FunctionExpression":return this.astFunctionExpression(S,T);case"ReturnStatement":return this.astReturnStatement(S,T);case"Literal":return this.astLiteral(S,T);case"BinaryExpression":return this.astBinaryExpression(S,T);case"Identifier":return this.astIdentifierExpression(S,T);case"AssignmentExpression":return this.astAssignmentExpression(S,T);case"ExpressionStatement":return this.astExpressionStatement(S,T);case"EmptyStatement":return this.astEmptyStatement(S,T);case"BlockStatement":return this.astBlockStatement(S,T);case"IfStatement":return this.astIfStatement(S,T);case"SwitchStatement":return this.astSwitchStatement(S,T);case"BreakStatement":return this.astBreakStatement(S,T);case"ContinueStatement":return this.astContinueStatement(S,T);case"ForStatement":return this.astForStatement(S,T);case"WhileStatement":return this.astWhileStatement(S,T);case"DoWhileStatement":return this.astDoWhileStatement(S,T);case"VariableDeclaration":return this.astVariableDeclaration(S,T);case"VariableDeclarator":return this.astVariableDeclarator(S,T);case"ThisExpression":return this.astThisExpression(S,T);case"SequenceExpression":return this.astSequenceExpression(S,T);case"UnaryExpression":return this.astUnaryExpression(S,T);case"UpdateExpression":return this.astUpdateExpression(S,T);case"LogicalExpression":return this.astLogicalExpression(S,T);case"MemberExpression":return this.astMemberExpression(S,T);case"CallExpression":return this.astCallExpression(S,T);case"ArrayExpression":return this.astArrayExpression(S,T);case"DebuggerStatement":return this.astDebuggerStatement(S,T);case"ConditionalExpression":return this.astConditionalExpression(S,T)}throw this.astErrorOutput("Unknown ast type : "+S.type,S)}astErrorOutput(S,T){if(typeof this.source!="string")return new Error(S);const G=F.getAstString(this.source,T),Te=this.source.substr(T.start).split(/\n/),ie=Te.length>0?Te[Te.length-1]:0;return new Error(`${S} on line ${Te.length}, position ${ie.length}:
 ${G}`)}astDebuggerStatement(S,T){return T}astConditionalExpression(S,T){if(S.type!=="ConditionalExpression")throw this.astErrorOutput("Not a conditional expression",S);return T.push("("),this.astGeneric(S.test,T),T.push("?"),this.astGeneric(S.consequent,T),T.push(":"),this.astGeneric(S.alternate,T),T.push(")"),T}astFunction(S,T){throw new Error(`"astFunction" not defined on ${this.constructor.name}`)}astFunctionDeclaration(S,T){return this.isChildFunction(S)?T:this.astFunction(S,T)}astFunctionExpression(S,T){return this.isChildFunction(S)?T:this.astFunction(S,T)}isChildFunction(S){for(let T=0;T<this.functions.length;T++)if(this.functions[T]===S)return!0;return!1}astReturnStatement(S,T){return T}astLiteral(S,T){return this.literalTypes[this.astKey(S)]="Number",T}astBinaryExpression(S,T){return T}astIdentifierExpression(S,T){return T}astAssignmentExpression(S,T){return T}astExpressionStatement(S,T){return this.astGeneric(S.expression,T),T.push(";"),T}astEmptyStatement(S,T){return T}astBlockStatement(S,T){return T}astIfStatement(S,T){return T}astSwitchStatement(S,T){return T}astBreakStatement(S,T){return T.push("break;"),T}astContinueStatement(S,T){return T.push(`continue;
`),T}astForStatement(S,T){return T}astWhileStatement(S,T){return T}astDoWhileStatement(S,T){return T}astVariableDeclarator(S,T){return this.astGeneric(S.id,T),S.init!==null&&(T.push("="),this.astGeneric(S.init,T)),T}astThisExpression(S,T){return T}astSequenceExpression(S,T){const{expressions:G}=S,te=[];for(let Te=0;Te<G.length;Te++){const ie=G[Te],_e=[];this.astGeneric(ie,_e),te.push(_e.join(""))}return te.length>1?T.push("(",te.join(","),")"):T.push(te[0]),T}astUnaryExpression(S,T){return this.checkAndUpconvertBitwiseUnary(S,T)||(S.prefix?(T.push(S.operator),this.astGeneric(S.argument,T)):(this.astGeneric(S.argument,T),T.push(S.operator))),T}checkAndUpconvertBitwiseUnary(S,T){}astUpdateExpression(S,T){return S.prefix?(T.push(S.operator),this.astGeneric(S.argument,T)):(this.astGeneric(S.argument,T),T.push(S.operator)),T}astLogicalExpression(S,T){return T.push("("),this.astGeneric(S.left,T),T.push(S.operator),this.astGeneric(S.right,T),T.push(")"),T}astMemberExpression(S,T){return T}astCallExpression(S,T){return T}astArrayExpression(S,T){return T}getMemberExpressionDetails(S){if(S.type!=="MemberExpression")throw this.astErrorOutput(`Expression ${S.type} not a MemberExpression`,S);let T=null,G=null;const te=this.getVariableSignature(S);switch(te){case"value":return null;case"value.thread.value":case"this.thread.value":case"this.output.value":return{signature:te,type:"Integer",name:S.property.name};case"value[]":if(typeof S.object.name!="string")throw this.astErrorOutput("Unexpected expression",S);return T=S.object.name,{name:T,origin:"user",signature:te,type:this.getVariableType(S.object),xProperty:S.property};case"value[][]":if(typeof S.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",S);return T=S.object.object.name,{name:T,origin:"user",signature:te,type:this.getVariableType(S.object.object),yProperty:S.object.property,xProperty:S.property};case"value[][][]":if(typeof S.object.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",S);return T=S.object.object.object.name,{name:T,origin:"user",signature:te,type:this.getVariableType(S.object.object.object),zProperty:S.object.object.property,yProperty:S.object.property,xProperty:S.property};case"value[][][][]":if(typeof S.object.object.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",S);return T=S.object.object.object.object.name,{name:T,origin:"user",signature:te,type:this.getVariableType(S.object.object.object.object),zProperty:S.object.object.property,yProperty:S.object.property,xProperty:S.property};case"value.value":if(typeof S.property.name!="string")throw this.astErrorOutput("Unexpected expression",S);if(this.isAstMathVariable(S))return T=S.property.name,{name:T,origin:"Math",type:"Number",signature:te};switch(S.property.name){case"r":case"g":case"b":case"a":return T=S.object.name,{name:T,property:S.property.name,origin:"user",signature:te,type:"Number"};default:throw this.astErrorOutput("Unexpected expression",S)}case"this.constants.value":if(typeof S.property.name!="string")throw this.astErrorOutput("Unexpected expression",S);if(T=S.property.name,G=this.getConstantType(T),!G)throw this.astErrorOutput("Constant has no type",S);return{name:T,type:G,origin:"constants",signature:te};case"this.constants.value[]":if(typeof S.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",S);if(T=S.object.property.name,G=this.getConstantType(T),!G)throw this.astErrorOutput("Constant has no type",S);return{name:T,type:G,origin:"constants",signature:te,xProperty:S.property};case"this.constants.value[][]":{if(typeof S.object.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",S);if(T=S.object.object.property.name,G=this.getConstantType(T),!G)throw this.astErrorOutput("Constant has no type",S);return{name:T,type:G,origin:"constants",signature:te,yProperty:S.object.property,xProperty:S.property}}case"this.constants.value[][][]":{if(typeof S.object.object.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",S);if(T=S.object.object.object.property.name,G=this.getConstantType(T),!G)throw this.astErrorOutput("Constant has no type",S);return{name:T,type:G,origin:"constants",signature:te,zProperty:S.object.object.property,yProperty:S.object.property,xProperty:S.property}}case"fn()[]":case"fn()[][]":case"[][]":return{signature:te,property:S.property};default:throw this.astErrorOutput("Unexpected expression",S)}}findIdentifierOrigin(S){const T=[this.ast];for(;T.length>0;){const G=T[0];if(G.type==="VariableDeclarator"&&G.id&&G.id.name&&G.id.name===S.name)return G;if(T.shift(),G.argument)T.push(G.argument);else if(G.body)T.push(G.body);else if(G.declarations)T.push(G.declarations);else if(Array.isArray(G))for(let te=0;te<G.length;te++)T.push(G[te])}return null}findLastReturn(S){const T=[S||this.ast];for(;T.length>0;){const G=T.pop();if(G.type==="ReturnStatement")return G;if(G.type!=="FunctionDeclaration")if(G.argument)T.push(G.argument);else if(G.body)T.push(G.body);else if(G.declarations)T.push(G.declarations);else if(Array.isArray(G))for(let te=0;te<G.length;te++)T.push(G[te]);else G.consequent?T.push(G.consequent):G.cases&&T.push(G.cases)}return null}getInternalVariableName(S){return this._internalVariableNames.hasOwnProperty(S)||(this._internalVariableNames[S]=0),this._internalVariableNames[S]++,this._internalVariableNames[S]===1?S:S+this._internalVariableNames[S]}astKey(S,T=","){if(!S.start||!S.end)throw new Error("AST start and end needed");return`${S.start}${T}${S.end}`}}const k={Number:"Number",Float:"Float",Integer:"Integer",Array:"Number","Array(2)":"Number","Array(3)":"Number","Array(4)":"Number","Matrix(2)":"Number","Matrix(3)":"Number","Matrix(4)":"Number",Array2D:"Number",Array3D:"Number",Input:"Number",HTMLCanvas:"Array(4)",OffscreenCanvas:"Array(4)",HTMLImage:"Array(4)",ImageBitmap:"Array(4)",ImageData:"Array(4)",HTMLVideo:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number",MemoryOptimizedNumberTexture:"Number","Array1D(2)":"Array(2)","Array1D(3)":"Array(3)","Array1D(4)":"Array(4)","Array2D(2)":"Array(2)","Array2D(3)":"Array(3)","Array2D(4)":"Array(4)","Array3D(2)":"Array(2)","Array3D(3)":"Array(3)","Array3D(4)":"Array(4)","ArrayTexture(1)":"Number","ArrayTexture(2)":"Array(2)","ArrayTexture(3)":"Array(3)","ArrayTexture(4)":"Array(4)"};y.exports={FunctionNode:P}},{"../utils":114,"./function-tracer":11,acorn:1}],11:[function(g,y,N){const{utils:D}=g("../utils");function F(k){return k.length>0?k[k.length-1]:null}const z={trackIdentifiers:"trackIdentifiers",memberExpression:"memberExpression",inForLoopInit:"inForLoopInit"};class P{constructor(R){this.runningContexts=[],this.functionContexts=[],this.contexts=[],this.functionCalls=[],this.declarations=[],this.identifiers=[],this.functions=[],this.returnStatements=[],this.trackedIdentifiers=null,this.states=[],this.newFunctionContext(),this.scan(R)}isState(R){return this.states[this.states.length-1]===R}hasState(R){return this.states.indexOf(R)>-1}pushState(R){this.states.push(R)}popState(R){if(this.isState(R))this.states.pop();else throw new Error(`Cannot pop the non-active state "${R}"`)}get currentFunctionContext(){return F(this.functionContexts)}get currentContext(){return F(this.runningContexts)}newFunctionContext(){const R={"@contextType":"function"};this.contexts.push(R),this.functionContexts.push(R)}newContext(R){const S=Object.assign({"@contextType":"const/let"},this.currentContext);this.contexts.push(S),this.runningContexts.push(S),R();const{currentFunctionContext:T}=this;for(const G in T)!T.hasOwnProperty(G)||S.hasOwnProperty(G)||(S[G]=T[G]);return this.runningContexts.pop(),S}useFunctionContext(R){const S=F(this.functionContexts);this.runningContexts.push(S),R(),this.runningContexts.pop()}getIdentifiers(R){const S=this.trackedIdentifiers=[];return this.pushState(z.trackIdentifiers),R(),this.trackedIdentifiers=null,this.popState(z.trackIdentifiers),S}getDeclaration(R){const{currentContext:S,currentFunctionContext:T,runningContexts:G}=this,te=S[R]||T[R]||null;if(!te&&S===T&&G.length>0){const Te=G[G.length-2];if(Te[R])return Te[R]}return te}scan(R){if(R){if(Array.isArray(R)){for(let S=0;S<R.length;S++)this.scan(R[S]);return}switch(R.type){case"Program":this.useFunctionContext(()=>{this.scan(R.body)});break;case"BlockStatement":this.newContext(()=>{this.scan(R.body)});break;case"AssignmentExpression":case"LogicalExpression":this.scan(R.left),this.scan(R.right);break;case"BinaryExpression":this.scan(R.left),this.scan(R.right);break;case"UpdateExpression":if(R.operator==="++"){const S=this.getDeclaration(R.argument.name);S&&(S.suggestedType="Integer")}this.scan(R.argument);break;case"UnaryExpression":this.scan(R.argument);break;case"VariableDeclaration":R.kind==="var"?this.useFunctionContext(()=>{R.declarations=D.normalizeDeclarations(R),this.scan(R.declarations)}):(R.declarations=D.normalizeDeclarations(R),this.scan(R.declarations));break;case"VariableDeclarator":{const{currentContext:S}=this,T=this.hasState(z.inForLoopInit),G={ast:R,context:S,name:R.id.name,origin:"declaration",inForLoopInit:T,inForLoopTest:null,assignable:S===this.currentFunctionContext||!T&&!S.hasOwnProperty(R.id.name),suggestedType:null,valueType:null,dependencies:null,isSafe:null};S[R.id.name]||(S[R.id.name]=G),this.declarations.push(G),this.scan(R.id),this.scan(R.init);break}case"FunctionExpression":case"FunctionDeclaration":this.runningContexts.length===0?this.scan(R.body):this.functions.push(R);break;case"IfStatement":this.scan(R.test),this.scan(R.consequent),R.alternate&&this.scan(R.alternate);break;case"ForStatement":{let S;const T=this.newContext(()=>{this.pushState(z.inForLoopInit),this.scan(R.init),this.popState(z.inForLoopInit),S=this.getIdentifiers(()=>{this.scan(R.test)}),this.scan(R.update),this.newContext(()=>{this.scan(R.body)})});if(S)for(const G in T)G!=="@contextType"&&S.indexOf(G)>-1&&(T[G].inForLoopTest=!0);break}case"DoWhileStatement":case"WhileStatement":this.newContext(()=>{this.scan(R.body),this.scan(R.test)});break;case"Identifier":{this.isState(z.trackIdentifiers)&&this.trackedIdentifiers.push(R.name),this.identifiers.push({context:this.currentContext,declaration:this.getDeclaration(R.name),ast:R});break}case"ReturnStatement":this.returnStatements.push(R),this.scan(R.argument);break;case"MemberExpression":this.pushState(z.memberExpression),this.scan(R.object),this.scan(R.property),this.popState(z.memberExpression);break;case"ExpressionStatement":this.scan(R.expression);break;case"SequenceExpression":this.scan(R.expressions);break;case"CallExpression":this.functionCalls.push({context:this.currentContext,ast:R}),this.scan(R.arguments);break;case"ArrayExpression":this.scan(R.elements);break;case"ConditionalExpression":this.scan(R.test),this.scan(R.alternate),this.scan(R.consequent);break;case"SwitchStatement":this.scan(R.discriminant),this.scan(R.cases);break;case"SwitchCase":this.scan(R.test),this.scan(R.consequent);break;case"ThisExpression":case"Literal":case"DebuggerStatement":case"EmptyStatement":case"BreakStatement":case"ContinueStatement":break;default:throw new Error(`unhandled type "${R.type}"`)}}}}y.exports={FunctionTracer:P}},{"../utils":114}],12:[function(g,y,N){const{glWiretap:D}=g("gl-wiretap"),{utils:F}=g("../../utils");function z(G){return G.toString().replace("=>","").replace(/^function /,"").replace(/utils[.]/g,"/*utils.*/")}function P(G,te,Te,ie,_e){Te.built||Te.build.apply(Te,te),te=te?Array.from(te).map(ot=>{switch(typeof ot){case"boolean":return new Boolean(ot);case"number":return new Number(ot);default:return ot}}):null;const Y=[],re=D(Te.context,{useTrackablePrimitives:!0,onReadPixels:ot=>{if(Ae.subKernels){if(!be)Y.push(`    const result = { result: ${k(ot,Ae)} };`),be=!0;else{const Ze=Ae.subKernels[ke++].property;Y.push(`    result${isNaN(Ze)?"."+Ze:`[${Ze}]`} = ${k(ot,Ae)};`)}ke===Ae.subKernels.length&&Y.push("    return result;");return}ot?Y.push(`    return ${k(ot,Ae)};`):Y.push("    return null;")},onUnrecognizedArgumentLookup:ot=>{const Ze=T(ot,Ae.kernelArguments,[],re);if(Ze)return Ze;const gt=T(ot,Ae.kernelConstants,bt?Object.keys(bt).map(wt=>bt[wt]):[],re);return gt||null}});let be=!1,ke=0;const{source:rt,canvas:vt,output:Q,pipeline:U,graphical:Me,loopMaxIterations:Fe,constants:bt,optimizeFloatMemory:v,precision:I,fixIntegerDivisionAccuracy:M,functions:H,nativeFunctions:oe,subKernels:de,immutable:ue,argumentTypes:ve,constantTypes:xe,kernelArguments:Re,kernelConstants:Ue,tactic:Xe}=Te,Ae=new G(rt,{canvas:vt,context:re,checkContext:!1,output:Q,pipeline:U,graphical:Me,loopMaxIterations:Fe,constants:bt,optimizeFloatMemory:v,precision:I,fixIntegerDivisionAccuracy:M,functions:H,nativeFunctions:oe,subKernels:de,immutable:ue,argumentTypes:ve,constantTypes:xe,tactic:Xe});let Ge=[];if(re.setIndent(2),Ae.build.apply(Ae,te),Ge.push(re.toString()),re.reset(),Ae.kernelArguments.forEach((ot,Ze)=>{switch(ot.type){case"Integer":case"Boolean":case"Number":case"Float":case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":re.insertVariable(`uploadValue_${ot.name}`,ot.uploadValue);break;case"HTMLImageArray":for(let gt=0;gt<te[Ze].length;gt++){const wt=te[Ze];re.insertVariable(`uploadValue_${ot.name}[${gt}]`,wt[gt])}break;case"Input":re.insertVariable(`uploadValue_${ot.name}`,ot.uploadValue);break;case"MemoryOptimizedNumberTexture":case"NumberTexture":case"Array1D(2)":case"Array1D(3)":case"Array1D(4)":case"Array2D(2)":case"Array2D(3)":case"Array2D(4)":case"Array3D(2)":case"Array3D(3)":case"Array3D(4)":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":re.insertVariable(`uploadValue_${ot.name}`,te[Ze].texture);break;default:throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${ot.type}`)}}),Ge.push("/** start of injected functions **/"),Ge.push(`function ${z(F.flattenTo)}`),Ge.push(`function ${z(F.flatten2dArrayTo)}`),Ge.push(`function ${z(F.flatten3dArrayTo)}`),Ge.push(`function ${z(F.flatten4dArrayTo)}`),Ge.push(`function ${z(F.isArray)}`),Ae.renderOutput!==Ae.renderTexture&&Ae.formatValues&&Ge.push(`  const renderOutput = function ${z(Ae.formatValues)};`),Ge.push("/** end of injected functions **/"),Ge.push(`  const innerKernel = function (${Ae.kernelArguments.map(ot=>ot.varName).join(", ")}) {`),re.setIndent(4),Ae.run.apply(Ae,te),Ae.renderKernels?Ae.renderKernels():Ae.renderOutput&&Ae.renderOutput(),Ge.push("    /** start setup uploads for kernel values **/"),Ae.kernelArguments.forEach(ot=>{Ge.push("    "+ot.getStringValueHandler().split(`
`).join(`
    `))}),Ge.push("    /** end setup uploads for kernel values **/"),Ge.push(re.toString()),Ae.renderOutput===Ae.renderTexture){re.reset();const ot=re.getContextVariableName(Ae.framebuffer);if(Ae.renderKernels){const Ze=Ae.renderKernels(),gt=re.getContextVariableName(Ae.texture.texture);Ge.push(`    return {
      result: {
        texture: ${gt},
        type: '${Ze.result.type}',
        toArray: ${S(Ze.result,gt,ot)}
      },`);const{subKernels:wt,mappedTextures:Nt}=Ae;for(let ht=0;ht<wt.length;ht++){const Ut=Nt[ht],Bt=wt[ht],In=Ze[Bt.property],nn=re.getContextVariableName(Ut.texture);Ge.push(`
      ${Bt.property}: {
        texture: ${nn},
        type: '${In.type}',
        toArray: ${S(In,nn,ot)}
      },`)}Ge.push("    };")}else{const Ze=Ae.renderOutput(),gt=re.getContextVariableName(Ae.texture.texture);Ge.push(`    return {
        texture: ${gt},
        type: '${Ze.type}',
        toArray: ${S(Ze,gt,ot)}
      };`)}}Ge.push(`    ${_e?`
`+_e+"    ":""}`),Ge.push(Y.join(`
`)),Ge.push("  };"),Ae.graphical&&(Ge.push(R(Ae)),Ge.push("  innerKernel.getPixels = getPixels;")),Ge.push("  return innerKernel;");let et=[];return Ue.forEach(ot=>{et.push(`${ot.getStringValueHandler()}`)}),`function kernel(settings) {
  const { context, constants } = settings;
  ${et.join("")}
  ${ie||""}
${Ge.join(`
`)}
}`}function k(G,te){const Te=te.precision==="single"?G:`new Float32Array(${G}.buffer)`;return te.output[2]?`renderOutput(${Te}, ${te.output[0]}, ${te.output[1]}, ${te.output[2]})`:te.output[1]?`renderOutput(${Te}, ${te.output[0]}, ${te.output[1]})`:`renderOutput(${Te}, ${te.output[0]})`}function R(G){const te=G.getPixels.toString(),Te=!/^function/.test(te);return F.flattenFunctionToString(`${Te?"function ":""}${te}`,{findDependency:(ie,_e)=>ie==="utils"?`const ${_e} = ${F[_e].toString()};`:null,thisLookup:ie=>{if(ie==="context")return null;if(G.hasOwnProperty(ie))return JSON.stringify(G[ie]);throw new Error(`unhandled thisLookup ${ie}`)}})}function S(G,te,Te){const ie=G.toArray.toString(),_e=!/^function/.test(ie),Y=F.flattenFunctionToString(`${_e?"function ":""}${ie}`,{findDependency:(re,be)=>{if(re==="utils")return`const ${be} = ${F[be].toString()};`;if(re==="this")return be==="framebuffer"?"":`${_e?"function ":""}${G[be].toString()}`;throw new Error("unhandled fromObject")},thisLookup:(re,be)=>{if(re==="texture")return te;if(re==="context")return be?null:"gl";if(G.hasOwnProperty(re))return JSON.stringify(G[re]);throw new Error(`unhandled thisLookup ${re}`)}});return`() => {
  function framebuffer() { return ${Te}; };
  ${Y}
  return toArray();
  }`}function T(G,te,Te,ie,_e){if(G===null||te===null)return null;switch(typeof G){case"boolean":case"number":return null}if(typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement)for(let Y=0;Y<te.length;Y++){const re=te[Y];if(re.type!=="HTMLImageArray"&&re||re.uploadValue!==G)continue;const be=Te[Y].indexOf(G);if(be===-1)continue;const ke=`uploadValue_${re.name}[${be}]`;return ie.insertVariable(ke,G),ke}for(let Y=0;Y<te.length;Y++){const re=te[Y];if(G!==re.uploadValue)continue;const be=`uploadValue_${re.name}`;return ie.insertVariable(be,re),be}return null}y.exports={glKernelString:P}},{"../../utils":114,"gl-wiretap":3}],13:[function(g,y,N){const{Kernel:D}=g("../kernel"),{utils:F}=g("../../utils"),{GLTextureArray2Float:z}=g("./texture/array-2-float"),{GLTextureArray2Float2D:P}=g("./texture/array-2-float-2d"),{GLTextureArray2Float3D:k}=g("./texture/array-2-float-3d"),{GLTextureArray3Float:R}=g("./texture/array-3-float"),{GLTextureArray3Float2D:S}=g("./texture/array-3-float-2d"),{GLTextureArray3Float3D:T}=g("./texture/array-3-float-3d"),{GLTextureArray4Float:G}=g("./texture/array-4-float"),{GLTextureArray4Float2D:te}=g("./texture/array-4-float-2d"),{GLTextureArray4Float3D:Te}=g("./texture/array-4-float-3d"),{GLTextureFloat:ie}=g("./texture/float"),{GLTextureFloat2D:_e}=g("./texture/float-2d"),{GLTextureFloat3D:Y}=g("./texture/float-3d"),{GLTextureMemoryOptimized:re}=g("./texture/memory-optimized"),{GLTextureMemoryOptimized2D:be}=g("./texture/memory-optimized-2d"),{GLTextureMemoryOptimized3D:ke}=g("./texture/memory-optimized-3d"),{GLTextureUnsigned:rt}=g("./texture/unsigned"),{GLTextureUnsigned2D:vt}=g("./texture/unsigned-2d"),{GLTextureUnsigned3D:Q}=g("./texture/unsigned-3d"),{GLTextureGraphical:U}=g("./texture/graphical");class Me extends D{static get mode(){return"gpu"}static getIsFloatRead(){const v=`function kernelFunction() {
      return 1;
    }`,I=new this(v,{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[1],precision:"single",returnType:"Number",tactic:"speed"});I.build(),I.run();const M=I.renderOutput();return I.destroy(!0),M[0]===1}static getIsIntegerDivisionAccurate(){function v(oe,de){return oe[this.thread.x]/de[this.thread.x]}const I=new this(v.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[2],returnType:"Number",precision:"unsigned",tactic:"speed"}),M=[[6,6030401],[3,3991]];I.build.apply(I,M),I.run.apply(I,M);const H=I.renderOutput();return I.destroy(!0),H[0]===2&&H[1]===1511}static getIsSpeedTacticSupported(){function v(oe){return oe[this.thread.x]}const I=new this(v.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[4],returnType:"Number",precision:"unsigned",tactic:"speed"}),M=[[0,1,2,3]];I.build.apply(I,M),I.run.apply(I,M);const H=I.renderOutput();return I.destroy(!0),Math.round(H[0])===0&&Math.round(H[1])===1&&Math.round(H[2])===2&&Math.round(H[3])===3}static get testCanvas(){throw new Error(`"testCanvas" not defined on ${this.name}`)}static get testContext(){throw new Error(`"testContext" not defined on ${this.name}`)}static getFeatures(){const v=this.testContext,I=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:I,kernelMap:I,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.LOW_INT),lowFloatPrecision:v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.LOW_FLOAT),mediumIntPrecision:v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.MEDIUM_INT),mediumFloatPrecision:v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.MEDIUM_FLOAT),highIntPrecision:v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_INT),highFloatPrecision:v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_FLOAT)})}static setupFeatureChecks(){throw new Error(`"setupFeatureChecks" not defined on ${this.name}`)}static getSignature(v,I){return v.getVariablePrecisionString()+(I.length>0?":"+I.join(","):"")}setFixIntegerDivisionAccuracy(v){return this.fixIntegerDivisionAccuracy=v,this}setPrecision(v){return this.precision=v,this}setFloatTextures(v){return F.warnDeprecated("method","setFloatTextures","setOptimizeFloatMemory"),this.floatTextures=v,this}static nativeFunctionArguments(v){const I=[],M=[],H=[],oe=/^[a-zA-Z_]/,de=/[a-zA-Z_0-9]/;let ue=0,ve=null,xe=null;for(;ue<v.length;){const Re=v[ue],Ue=v[ue+1],Xe=H.length>0?H[H.length-1]:null;if(Xe==="FUNCTION_ARGUMENTS"&&Re==="/"&&Ue==="*"){H.push("MULTI_LINE_COMMENT"),ue+=2;continue}else if(Xe==="MULTI_LINE_COMMENT"&&Re==="*"&&Ue==="/"){H.pop(),ue+=2;continue}else if(Xe==="FUNCTION_ARGUMENTS"&&Re==="/"&&Ue==="/"){H.push("COMMENT"),ue+=2;continue}else if(Xe==="COMMENT"&&Re===`
`){H.pop(),ue++;continue}else if(Xe===null&&Re==="("){H.push("FUNCTION_ARGUMENTS"),ue++;continue}else if(Xe==="FUNCTION_ARGUMENTS"){if(Re===")"){H.pop();break}if(Re==="f"&&Ue==="l"&&v[ue+2]==="o"&&v[ue+3]==="a"&&v[ue+4]==="t"&&v[ue+5]===" "){H.push("DECLARE_VARIABLE"),xe="float",ve="",ue+=6;continue}else if(Re==="i"&&Ue==="n"&&v[ue+2]==="t"&&v[ue+3]===" "){H.push("DECLARE_VARIABLE"),xe="int",ve="",ue+=4;continue}else if(Re==="v"&&Ue==="e"&&v[ue+2]==="c"&&v[ue+3]==="2"&&v[ue+4]===" "){H.push("DECLARE_VARIABLE"),xe="vec2",ve="",ue+=5;continue}else if(Re==="v"&&Ue==="e"&&v[ue+2]==="c"&&v[ue+3]==="3"&&v[ue+4]===" "){H.push("DECLARE_VARIABLE"),xe="vec3",ve="",ue+=5;continue}else if(Re==="v"&&Ue==="e"&&v[ue+2]==="c"&&v[ue+3]==="4"&&v[ue+4]===" "){H.push("DECLARE_VARIABLE"),xe="vec4",ve="",ue+=5;continue}}else if(Xe==="DECLARE_VARIABLE"){if(ve===""){if(Re===" "){ue++;continue}if(!oe.test(Re))throw new Error("variable name is not expected string")}ve+=Re,de.test(Ue)||(H.pop(),M.push(ve),I.push(Fe[xe]))}ue++}if(H.length>0)throw new Error("GLSL function was not parsable");return{argumentNames:M,argumentTypes:I}}static nativeFunctionReturnType(v){return Fe[v.match(/int|float|vec[2-4]/)[0]]}static combineKernels(v,I){v.apply(null,arguments);const{texSize:M,context:H,threadDim:oe}=I.texSize;let de;if(I.precision==="single"){const ue=M[0],ve=Math.ceil(M[1]/4);de=new Float32Array(ue*ve*4*4),H.readPixels(0,0,ue,ve*4,H.RGBA,H.FLOAT,de)}else{const ue=new Uint8Array(M[0]*M[1]*4);H.readPixels(0,0,M[0],M[1],H.RGBA,H.UNSIGNED_BYTE,ue),de=new Float32Array(ue.buffer)}if(de=de.subarray(0,oe[0]*oe[1]*oe[2]),I.output.length===1)return de;if(I.output.length===2)return F.splitArray(de,I.output[0]);if(I.output.length===3)return F.splitArray(de,I.output[0]*I.output[1]).map(function(ve){return F.splitArray(ve,I.output[0])})}constructor(v,I){super(v,I),this.transferValues=null,this.formatValues=null,this.TextureConstructor=null,this.renderOutput=null,this.renderRawOutput=null,this.texSize=null,this.translatedSource=null,this.compiledFragmentShader=null,this.compiledVertexShader=null,this.switchingKernels=null,this._textureSwitched=null,this._mappedTextureSwitched=null}checkTextureSize(){const{features:v}=this.constructor;if(this.texSize[0]>v.maxTextureSize||this.texSize[1]>v.maxTextureSize)throw new Error(`Texture size [${this.texSize[0]},${this.texSize[1]}] generated by kernel is larger than supported size [${v.maxTextureSize},${v.maxTextureSize}]`)}translateSource(){throw new Error(`"translateSource" not defined on ${this.constructor.name}`)}pickRenderStrategy(v){if(this.graphical)return this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=I=>I,this.TextureConstructor=U,null;if(this.precision==="unsigned")if(this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=this.readPackedPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=Q,null):this.output[1]>0?(this.TextureConstructor=vt,null):(this.TextureConstructor=rt,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(v)}else switch(this.subKernels!==null&&(this.renderKernels=this.renderKernelsToArrays),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.renderOutput=this.renderValues,this.output[2]>0?(this.TextureConstructor=Q,this.formatValues=F.erect3DPackedFloat,null):this.output[1]>0?(this.TextureConstructor=vt,this.formatValues=F.erect2DPackedFloat,null):(this.TextureConstructor=rt,this.formatValues=F.erectPackedFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(v)}else if(this.precision==="single"){if(this.renderRawOutput=this.readFloatPixelsToFloat32Array,this.transferValues=this.readFloatPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.optimizeFloatMemory?this.output[2]>0?(this.TextureConstructor=ke,null):this.output[1]>0?(this.TextureConstructor=be,null):(this.TextureConstructor=re,null):this.output[2]>0?(this.TextureConstructor=Y,null):this.output[1]>0?(this.TextureConstructor=_e,null):(this.TextureConstructor=ie,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=k,null):this.output[1]>0?(this.TextureConstructor=P,null):(this.TextureConstructor=z,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=T,null):this.output[1]>0?(this.TextureConstructor=S,null):(this.TextureConstructor=R,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=Te,null):this.output[1]>0?(this.TextureConstructor=te,null):(this.TextureConstructor=G,null)}if(this.renderOutput=this.renderValues,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToArrays),this.optimizeFloatMemory)switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=ke,this.formatValues=F.erectMemoryOptimized3DFloat,null):this.output[1]>0?(this.TextureConstructor=be,this.formatValues=F.erectMemoryOptimized2DFloat,null):(this.TextureConstructor=re,this.formatValues=F.erectMemoryOptimizedFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=k,this.formatValues=F.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=P,this.formatValues=F.erect2DArray2,null):(this.TextureConstructor=z,this.formatValues=F.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=T,this.formatValues=F.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=S,this.formatValues=F.erect2DArray3,null):(this.TextureConstructor=R,this.formatValues=F.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=Te,this.formatValues=F.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=te,this.formatValues=F.erect2DArray4,null):(this.TextureConstructor=G,this.formatValues=F.erectArray4,null)}else switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=Y,this.formatValues=F.erect3DFloat,null):this.output[1]>0?(this.TextureConstructor=_e,this.formatValues=F.erect2DFloat,null):(this.TextureConstructor=ie,this.formatValues=F.erectFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=k,this.formatValues=F.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=P,this.formatValues=F.erect2DArray2,null):(this.TextureConstructor=z,this.formatValues=F.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=T,this.formatValues=F.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=S,this.formatValues=F.erect2DArray3,null):(this.TextureConstructor=R,this.formatValues=F.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=Te,this.formatValues=F.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=te,this.formatValues=F.erect2DArray4,null):(this.TextureConstructor=G,this.formatValues=F.erectArray4,null)}}else throw new Error(`unhandled precision of "${this.precision}"`);throw new Error(`unhandled return type "${this.returnType}"`)}getKernelString(){throw new Error("abstract method call")}getMainResultTexture(){switch(this.returnType){case"LiteralInteger":case"Float":case"Integer":case"Number":return this.getMainResultNumberTexture();case"Array(2)":return this.getMainResultArray2Texture();case"Array(3)":return this.getMainResultArray3Texture();case"Array(4)":return this.getMainResultArray4Texture();default:throw new Error(`unhandled returnType type ${this.returnType}`)}}getMainResultKernelNumberTexture(){throw new Error("abstract method call")}getMainResultSubKernelNumberTexture(){throw new Error("abstract method call")}getMainResultKernelArray2Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray2Texture(){throw new Error("abstract method call")}getMainResultKernelArray3Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray3Texture(){throw new Error("abstract method call")}getMainResultKernelArray4Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray4Texture(){throw new Error("abstract method call")}getMainResultGraphical(){throw new Error("abstract method call")}getMainResultMemoryOptimizedFloats(){throw new Error("abstract method call")}getMainResultPackedPixels(){throw new Error("abstract method call")}getMainResultString(){return this.graphical?this.getMainResultGraphical():this.precision==="single"?this.optimizeFloatMemory?this.getMainResultMemoryOptimizedFloats():this.getMainResultTexture():this.getMainResultPackedPixels()}getMainResultNumberTexture(){return F.linesToString(this.getMainResultKernelNumberTexture())+F.linesToString(this.getMainResultSubKernelNumberTexture())}getMainResultArray2Texture(){return F.linesToString(this.getMainResultKernelArray2Texture())+F.linesToString(this.getMainResultSubKernelArray2Texture())}getMainResultArray3Texture(){return F.linesToString(this.getMainResultKernelArray3Texture())+F.linesToString(this.getMainResultSubKernelArray3Texture())}getMainResultArray4Texture(){return F.linesToString(this.getMainResultKernelArray4Texture())+F.linesToString(this.getMainResultSubKernelArray4Texture())}getFloatTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} float;
`}getIntTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic,!0)} int;
`}getSampler2DTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2D;
`}getSampler2DArrayTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2DArray;
`}renderTexture(){return this.immutable?this.texture.clone():this.texture}readPackedPixelsToUint8Array(){if(this.precision!=="unsigned")throw new Error('Requires this.precision to be "unsigned"');const{texSize:v,context:I}=this,M=new Uint8Array(v[0]*v[1]*4);return I.readPixels(0,0,v[0],v[1],I.RGBA,I.UNSIGNED_BYTE,M),M}readPackedPixelsToFloat32Array(){return new Float32Array(this.readPackedPixelsToUint8Array().buffer)}readFloatPixelsToFloat32Array(){if(this.precision!=="single")throw new Error('Requires this.precision to be "single"');const{texSize:v,context:I}=this,M=v[0],H=v[1],oe=new Float32Array(M*H*4);return I.readPixels(0,0,M,H,I.RGBA,I.FLOAT,oe),oe}getPixels(v){const{context:I,output:M}=this,[H,oe]=M,de=new Uint8Array(H*oe*4);return I.readPixels(0,0,H,oe,I.RGBA,I.UNSIGNED_BYTE,de),new Uint8ClampedArray((v?de:F.flipPixels(de,H,oe)).buffer)}renderKernelsToArrays(){const v={result:this.renderOutput()};for(let I=0;I<this.subKernels.length;I++)v[this.subKernels[I].property]=this.mappedTextures[I].toArray();return v}renderKernelsToTextures(){const v={result:this.renderOutput()};if(this.immutable)for(let I=0;I<this.subKernels.length;I++)v[this.subKernels[I].property]=this.mappedTextures[I].clone();else for(let I=0;I<this.subKernels.length;I++)v[this.subKernels[I].property]=this.mappedTextures[I];return v}resetSwitchingKernels(){const v=this.switchingKernels;return this.switchingKernels=null,v}setOutput(v){const I=this.toKernelOutput(v);if(this.program){if(!this.dynamicOutput)throw new Error("Resizing a kernel with dynamicOutput: false is not possible");const M=[I[0],I[1]||1,I[2]||1],H=F.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},M),oe=this.texSize;if(oe){const ue=this.getVariablePrecisionString(oe,this.tactic),ve=this.getVariablePrecisionString(H,this.tactic);if(ue!==ve){this.debug&&console.warn("Precision requirement changed, asking GPU instance to recompile"),this.switchKernels({type:"outputPrecisionMismatch",precision:ve,needed:v});return}}this.output=I,this.threadDim=M,this.texSize=H;const{context:de}=this;if(de.bindFramebuffer(de.FRAMEBUFFER,this.framebuffer),this.updateMaxTexSize(),this.framebuffer.width=this.texSize[0],this.framebuffer.height=this.texSize[1],de.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),this.canvas.width=this.maxTexSize[0],this.canvas.height=this.maxTexSize[1],this.texture&&this.texture.delete(),this.texture=null,this._setupOutputTexture(),this.mappedTextures&&this.mappedTextures.length>0){for(let ue=0;ue<this.mappedTextures.length;ue++)this.mappedTextures[ue].delete();this.mappedTextures=null,this._setupSubOutputTextures()}}else this.output=I;return this}renderValues(){return this.formatValues(this.transferValues(),this.output[0],this.output[1],this.output[2])}switchKernels(v){this.switchingKernels?this.switchingKernels.push(v):this.switchingKernels=[v]}getVariablePrecisionString(v=this.texSize,I=this.tactic,M=!1){if(!I){if(!this.constructor.features.isSpeedTacticSupported)return"highp";const H=this.constructor.features[M?"lowIntPrecision":"lowFloatPrecision"],oe=this.constructor.features[M?"mediumIntPrecision":"mediumFloatPrecision"],de=this.constructor.features[M?"highIntPrecision":"highFloatPrecision"],ue=Math.log2(v[0]*v[1]);if(ue<=H.rangeMax)return"lowp";if(ue<=oe.rangeMax)return"mediump";if(ue<=de.rangeMax)return"highp";throw new Error("The required size exceeds that of the ability of your system")}switch(I){case"speed":return"lowp";case"balanced":return"mediump";case"precision":return"highp";default:throw new Error(`Unknown tactic "${I}" use "speed", "balanced", "precision", or empty for auto`)}}updateTextureArgumentRefs(v,I){if(this.immutable){if(this.texture.texture===I.texture){const{prevArg:M}=v;M&&(M.texture._refs===1&&(this.texture.delete(),this.texture=M.clone(),this._textureSwitched=!0),M.delete()),v.prevArg=I.clone()}else if(this.mappedTextures&&this.mappedTextures.length>0){const{mappedTextures:M}=this;for(let H=0;H<M.length;H++){const oe=M[H];if(oe.texture===I.texture){const{prevArg:de}=v;de&&(de.texture._refs===1&&(oe.delete(),M[H]=de.clone(),this._mappedTextureSwitched[H]=!0),de.delete()),v.prevArg=I.clone();return}}}}}onActivate(v){if(this._textureSwitched=!0,this.texture=v.texture,this.mappedTextures){for(let I=0;I<this.mappedTextures.length;I++)this._mappedTextureSwitched[I]=!0;this.mappedTextures=v.mappedTextures}}initCanvas(){}}const Fe={int:"Integer",float:"Number",vec2:"Array(2)",vec3:"Array(3)",vec4:"Array(4)"};y.exports={GLKernel:Me}},{"../../utils":114,"../kernel":36,"./texture/array-2-float":16,"./texture/array-2-float-2d":14,"./texture/array-2-float-3d":15,"./texture/array-3-float":19,"./texture/array-3-float-2d":17,"./texture/array-3-float-3d":18,"./texture/array-4-float":22,"./texture/array-4-float-2d":20,"./texture/array-4-float-3d":21,"./texture/float":25,"./texture/float-2d":23,"./texture/float-3d":24,"./texture/graphical":26,"./texture/memory-optimized":30,"./texture/memory-optimized-2d":28,"./texture/memory-optimized-3d":29,"./texture/unsigned":33,"./texture/unsigned-2d":31,"./texture/unsigned-3d":32}],14:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(2)"}toArray(){return D.erect2DArray2(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureArray2Float2D:z}},{"../../../utils":114,"./float":25}],15:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(2)"}toArray(){return D.erect3DArray2(this.renderValues(),this.output[0],this.output[1],this.output[2])}}y.exports={GLTextureArray2Float3D:z}},{"../../../utils":114,"./float":25}],16:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(2)"}toArray(){return D.erectArray2(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureArray2Float:z}},{"../../../utils":114,"./float":25}],17:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(3)"}toArray(){return D.erect2DArray3(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureArray3Float2D:z}},{"../../../utils":114,"./float":25}],18:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(3)"}toArray(){return D.erect3DArray3(this.renderValues(),this.output[0],this.output[1],this.output[2])}}y.exports={GLTextureArray3Float3D:z}},{"../../../utils":114,"./float":25}],19:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(3)"}toArray(){return D.erectArray3(this.renderValues(),this.output[0])}}y.exports={GLTextureArray3Float:z}},{"../../../utils":114,"./float":25}],20:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(4)"}toArray(){return D.erect2DArray4(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureArray4Float2D:z}},{"../../../utils":114,"./float":25}],21:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(4)"}toArray(){return D.erect3DArray4(this.renderValues(),this.output[0],this.output[1],this.output[2])}}y.exports={GLTextureArray4Float3D:z}},{"../../../utils":114,"./float":25}],22:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(4)"}toArray(){return D.erectArray4(this.renderValues(),this.output[0])}}y.exports={GLTextureArray4Float:z}},{"../../../utils":114,"./float":25}],23:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(1)"}toArray(){return D.erect2DFloat(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureFloat2D:z}},{"../../../utils":114,"./float":25}],24:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="ArrayTexture(1)"}toArray(){return D.erect3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}y.exports={GLTextureFloat3D:z}},{"../../../utils":114,"./float":25}],25:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTexture:F}=g("./index");class z extends F{get textureType(){return this.context.FLOAT}constructor(k){super(k),this.type="ArrayTexture(1)"}renderRawOutput(){const k=this.context,R=this.size;k.bindFramebuffer(k.FRAMEBUFFER,this.framebuffer()),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,this.texture,0);const S=new Float32Array(R[0]*R[1]*4);return k.readPixels(0,0,R[0],R[1],k.RGBA,k.FLOAT,S),S}renderValues(){return this._deleted?null:this.renderRawOutput()}toArray(){return D.erectFloat(this.renderValues(),this.output[0])}}y.exports={GLTextureFloat:z}},{"../../../utils":114,"./index":27}],26:[function(g,y,N){const{GLTextureUnsigned:D}=g("./unsigned");class F extends D{constructor(P){super(P),this.type="ArrayTexture(4)"}toArray(){return this.renderValues()}}y.exports={GLTextureGraphical:F}},{"./unsigned":33}],27:[function(g,y,N){const{Texture:D}=g("../../../texture");class F extends D{get textureType(){throw new Error(`"textureType" not implemented on ${this.name}`)}clone(){return new this.constructor(this)}beforeMutate(){return this.texture._refs>1?(this.newTexture(),!0):!1}cloneTexture(){this.texture._refs--;const{context:k,size:R,texture:S,kernel:T}=this;T.debug&&console.warn("cloning internal texture"),k.bindFramebuffer(k.FRAMEBUFFER,this.framebuffer()),z(k,S),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,S,0);const G=k.createTexture();z(k,G),k.texImage2D(k.TEXTURE_2D,0,this.internalFormat,R[0],R[1],0,this.textureFormat,this.textureType,null),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,R[0],R[1]),G._refs=1,this.texture=G}newTexture(){this.texture._refs--;const k=this.context,R=this.size;this.kernel.debug&&console.warn("new internal texture");const T=k.createTexture();z(k,T),k.texImage2D(k.TEXTURE_2D,0,this.internalFormat,R[0],R[1],0,this.textureFormat,this.textureType,null),T._refs=1,this.texture=T}clear(){if(this.texture._refs){this.texture._refs--;const S=this.context,T=this.texture=S.createTexture();z(S,T);const G=this.size;T._refs=1,S.texImage2D(S.TEXTURE_2D,0,this.internalFormat,G[0],G[1],0,this.textureFormat,this.textureType,null)}const{context:k,texture:R}=this;k.bindFramebuffer(k.FRAMEBUFFER,this.framebuffer()),k.bindTexture(k.TEXTURE_2D,R),z(k,R),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,R,0),k.clearColor(0,0,0,0),k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT)}delete(){this._deleted||(this._deleted=!0,!(this.texture._refs&&(this.texture._refs--,this.texture._refs))&&this.context.deleteTexture(this.texture))}framebuffer(){return this._framebuffer||(this._framebuffer=this.kernel.getRawValueFramebuffer(this.size[0],this.size[1])),this._framebuffer}}function z(P,k){P.activeTexture(P.TEXTURE15),P.bindTexture(P.TEXTURE_2D,k),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.NEAREST),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST)}y.exports={GLTexture:F}},{"../../../texture":113}],28:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="MemoryOptimizedNumberTexture"}toArray(){return D.erectMemoryOptimized2DFloat(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureMemoryOptimized2D:z}},{"../../../utils":114,"./float":25}],29:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="MemoryOptimizedNumberTexture"}toArray(){return D.erectMemoryOptimized3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}y.exports={GLTextureMemoryOptimized3D:z}},{"../../../utils":114,"./float":25}],30:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureFloat:F}=g("./float");class z extends F{constructor(k){super(k),this.type="MemoryOptimizedNumberTexture"}toArray(){return D.erectMemoryOptimizedFloat(this.renderValues(),this.output[0])}}y.exports={GLTextureMemoryOptimized:z}},{"../../../utils":114,"./float":25}],31:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureUnsigned:F}=g("./unsigned");class z extends F{constructor(k){super(k),this.type="NumberTexture"}toArray(){return D.erect2DPackedFloat(this.renderValues(),this.output[0],this.output[1])}}y.exports={GLTextureUnsigned2D:z}},{"../../../utils":114,"./unsigned":33}],32:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTextureUnsigned:F}=g("./unsigned");class z extends F{constructor(k){super(k),this.type="NumberTexture"}toArray(){return D.erect3DPackedFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}y.exports={GLTextureUnsigned3D:z}},{"../../../utils":114,"./unsigned":33}],33:[function(g,y,N){const{utils:D}=g("../../../utils"),{GLTexture:F}=g("./index");class z extends F{get textureType(){return this.context.UNSIGNED_BYTE}constructor(k){super(k),this.type="NumberTexture"}renderRawOutput(){const{context:k}=this;k.bindFramebuffer(k.FRAMEBUFFER,this.framebuffer()),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,this.texture,0);const R=new Uint8Array(this.size[0]*this.size[1]*4);return k.readPixels(0,0,this.size[0],this.size[1],k.RGBA,k.UNSIGNED_BYTE,R),R}renderValues(){return this._deleted?null:new Float32Array(this.renderRawOutput().buffer)}toArray(){return D.erectPackedFloat(this.renderValues(),this.output[0])}}y.exports={GLTextureUnsigned:z}},{"../../../utils":114,"./index":27}],34:[function(g,y,N){const D=g("gl"),{WebGLKernel:F}=g("../web-gl/kernel"),{glKernelString:z}=g("../gl/kernel-string");let P=null,k=null,R=null,S=null,T=null;class G extends F{static get isSupported(){return P!==null||(this.setupFeatureChecks(),P=R!==null),P}static setupFeatureChecks(){if(k=null,S=null,typeof D=="function")try{if(R=D(2,2,{preserveDrawingBuffer:!0}),!R||!R.getExtension)return;S={STACKGL_resize_drawingbuffer:R.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:R.getExtension("STACKGL_destroy_context"),OES_texture_float:R.getExtension("OES_texture_float"),OES_texture_float_linear:R.getExtension("OES_texture_float_linear"),OES_element_index_uint:R.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:R.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:R.getExtension("WEBGL_color_buffer_float")},T=this.getFeatures()}catch(Te){console.warn(Te)}}static isContextMatch(Te){try{return Te.getParameter(Te.RENDERER)==="ANGLE"}catch{return!1}}static getIsTextureFloat(){return!!S.OES_texture_float}static getIsDrawBuffers(){return!!S.WEBGL_draw_buffers}static getChannelCount(){return S.WEBGL_draw_buffers?R.getParameter(S.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return R.getParameter(R.MAX_TEXTURE_SIZE)}static get testCanvas(){return k}static get testContext(){return R}static get features(){return T}initCanvas(){return{}}initContext(){return D(2,2,{preserveDrawingBuffer:!0})}initExtensions(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}build(){super.build.apply(this,arguments),this.fallbackRequested||this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}destroyExtensions(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(Te){const ie=Te.getExtension("STACKGL_destroy_context");ie&&ie.destroy&&ie.destroy()}toString(){return z(this.constructor,arguments,this,`const gl = context || require('gl')(1, 1);
`,`    if (!context) { gl.getExtension('STACKGL_destroy_context').destroy(); }
`)}setOutput(Te){return super.setOutput(Te),this.graphical&&this.extensions.STACKGL_resize_drawingbuffer&&this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1]),this}}y.exports={HeadlessGLKernel:G}},{"../gl/kernel-string":12,"../web-gl/kernel":70,gl:2}],35:[function(g,y,N){class D{constructor(z,P){const{name:k,kernel:R,context:S,checkContext:T,onRequestContextHandle:G,onUpdateValueMismatch:te,origin:Te,strictIntegers:ie,type:_e,tactic:Y}=P;if(!k)throw new Error("name not set");if(!_e)throw new Error("type not set");if(!Te)throw new Error("origin not set");if(Te!=="user"&&Te!=="constants")throw new Error(`origin must be "user" or "constants" value is "${Te}"`);if(!G)throw new Error("onRequestContextHandle is not set");this.name=k,this.origin=Te,this.tactic=Y,this.varName=Te==="constants"?`constants.${k}`:k,this.kernel=R,this.strictIntegers=ie,this.type=z.type||_e,this.size=z.size||null,this.index=null,this.context=S,this.checkContext=T??!0,this.contextHandle=null,this.onRequestContextHandle=G,this.onUpdateValueMismatch=te,this.forceUploadEachRun=null}get id(){return`${this.origin}_${name}`}getSource(){throw new Error(`"getSource" not defined on ${this.constructor.name}`)}updateValue(z){throw new Error(`"updateValue" not defined on ${this.constructor.name}`)}}y.exports={KernelValue:D}},{}],36:[function(g,y,N){const{utils:D}=g("../utils"),{Input:F}=g("../input");class z{static get isSupported(){throw new Error(`"isSupported" not implemented on ${this.name}`)}static isContextMatch(R){throw new Error(`"isContextMatch" not implemented on ${this.name}`)}static getFeatures(){throw new Error(`"getFeatures" not implemented on ${this.name}`)}static destroyContext(R){throw new Error(`"destroyContext" called on ${this.name}`)}static nativeFunctionArguments(){throw new Error(`"nativeFunctionArguments" called on ${this.name}`)}static nativeFunctionReturnType(){throw new Error(`"nativeFunctionReturnType" called on ${this.name}`)}static combineKernels(){throw new Error(`"combineKernels" called on ${this.name}`)}constructor(R,S){if(typeof R!="object"){if(typeof R!="string")throw new Error("source not a string");if(!D.isFunctionString(R))throw new Error("source not a function string")}this.useLegacyEncoder=!1,this.fallbackRequested=!1,this.onRequestFallback=null,this.argumentNames=typeof R=="string"?D.getArgumentNamesFromString(R):null,this.argumentTypes=null,this.argumentSizes=null,this.argumentBitRatios=null,this.kernelArguments=null,this.kernelConstants=null,this.forceUploadKernelConstants=null,this.source=R,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.constantTypes=null,this.constantBitRatios=null,this.dynamicArguments=!1,this.dynamicOutput=!1,this.canvas=null,this.context=null,this.checkContext=null,this.gpu=null,this.functions=null,this.nativeFunctions=null,this.injectedNative=null,this.subKernels=null,this.validate=!0,this.immutable=!1,this.pipeline=!1,this.precision=null,this.tactic=null,this.plugins=null,this.returnType=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.optimizeFloatMemory=null,this.strictIntegers=!1,this.fixIntegerDivisionAccuracy=null,this.built=!1,this.signature=null}mergeSettings(R){for(let S in R)if(!(!R.hasOwnProperty(S)||!this.hasOwnProperty(S))){switch(S){case"output":if(!Array.isArray(R.output)){this.setOutput(R.output);continue}break;case"functions":this.functions=[];for(let T=0;T<R.functions.length;T++)this.addFunction(R.functions[T]);continue;case"graphical":R[S]&&!R.hasOwnProperty("precision")&&(this.precision="unsigned"),this[S]=R[S];continue;case"nativeFunctions":if(!R.nativeFunctions)continue;this.nativeFunctions=[];for(let T=0;T<R.nativeFunctions.length;T++){const G=R.nativeFunctions[T],{name:te,source:Te}=G;this.addNativeFunction(te,Te,G)}continue}this[S]=R[S]}this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext()),this.plugins||(this.plugins=this.initPlugins(R))}build(){throw new Error(`"build" not defined on ${this.constructor.name}`)}run(){throw new Error(`"run" not defined on ${this.constructor.name}`)}initCanvas(){throw new Error(`"initCanvas" not defined on ${this.constructor.name}`)}initContext(){throw new Error(`"initContext" not defined on ${this.constructor.name}`)}initPlugins(R){throw new Error(`"initPlugins" not defined on ${this.constructor.name}`)}addFunction(R,S={}){if(R.name&&R.source&&R.argumentTypes&&"returnType"in R)this.functions.push(R);else if("settings"in R&&"source"in R)this.functions.push(this.functionToIGPUFunction(R.source,R.settings));else if(typeof R=="string"||typeof R=="function")this.functions.push(this.functionToIGPUFunction(R,S));else throw new Error("function not properly defined");return this}addNativeFunction(R,S,T={}){const{argumentTypes:G,argumentNames:te}=T.argumentTypes?P(T.argumentTypes):this.constructor.nativeFunctionArguments(S)||{};return this.nativeFunctions.push({name:R,source:S,settings:T,argumentTypes:G,argumentNames:te,returnType:T.returnType||this.constructor.nativeFunctionReturnType(S)}),this}setupArguments(R){if(this.kernelArguments=[],this.argumentTypes)for(let S=0;S<this.argumentTypes.length;S++)this.kernelArguments.push({type:this.argumentTypes[S]});else if(!this.argumentTypes){this.argumentTypes=[];for(let S=0;S<R.length;S++){const T=D.getVariableType(R[S],this.strictIntegers),G=T==="Integer"?"Number":T;this.argumentTypes.push(G),this.kernelArguments.push({type:G})}}this.argumentSizes=new Array(R.length),this.argumentBitRatios=new Int32Array(R.length);for(let S=0;S<R.length;S++){const T=R[S];this.argumentSizes[S]=T.constructor===F?T.size:null,this.argumentBitRatios[S]=this.getBitRatio(T)}if(this.argumentNames.length!==R.length)throw new Error("arguments are miss-aligned")}setupConstants(){this.kernelConstants=[];let R=this.constantTypes===null;if(R&&(this.constantTypes={}),this.constantBitRatios={},this.constants)for(let S in this.constants){if(R){const T=D.getVariableType(this.constants[S],this.strictIntegers);this.constantTypes[S]=T,this.kernelConstants.push({name:S,type:T})}else this.kernelConstants.push({name:S,type:this.constantTypes[S]});this.constantBitRatios[S]=this.getBitRatio(this.constants[S])}}setOptimizeFloatMemory(R){return this.optimizeFloatMemory=R,this}toKernelOutput(R){return R.hasOwnProperty("x")?R.hasOwnProperty("y")?R.hasOwnProperty("z")?[R.x,R.y,R.z]:[R.x,R.y]:[R.x]:R}setOutput(R){return this.output=this.toKernelOutput(R),this}setDebug(R){return this.debug=R,this}setGraphical(R){return this.graphical=R,this.precision="unsigned",this}setLoopMaxIterations(R){return this.loopMaxIterations=R,this}setConstants(R){return this.constants=R,this}setConstantTypes(R){return this.constantTypes=R,this}setFunctions(R){for(let S=0;S<R.length;S++)this.addFunction(R[S]);return this}setNativeFunctions(R){for(let S=0;S<R.length;S++){const T=R[S],{name:G,source:te}=T;this.addNativeFunction(G,te,T)}return this}setInjectedNative(R){return this.injectedNative=R,this}setPipeline(R){return this.pipeline=R,this}setPrecision(R){return this.precision=R,this}setDimensions(R){return D.warnDeprecated("method","setDimensions","setOutput"),this.output=R,this}setOutputToTexture(R){return D.warnDeprecated("method","setOutputToTexture","setPipeline"),this.pipeline=R,this}setImmutable(R){return this.immutable=R,this}setCanvas(R){return this.canvas=R,this}setStrictIntegers(R){return this.strictIntegers=R,this}setDynamicOutput(R){return this.dynamicOutput=R,this}setHardcodeConstants(R){return D.warnDeprecated("method","setHardcodeConstants"),this.setDynamicOutput(R),this.setDynamicArguments(R),this}setDynamicArguments(R){return this.dynamicArguments=R,this}setUseLegacyEncoder(R){return this.useLegacyEncoder=R,this}setWarnVarUsage(R){return D.warnDeprecated("method","setWarnVarUsage"),this}getCanvas(){return D.warnDeprecated("method","getCanvas"),this.canvas}getWebGl(){return D.warnDeprecated("method","getWebGl"),this.context}setContext(R){return this.context=R,this}setArgumentTypes(R){if(Array.isArray(R))this.argumentTypes=R;else{this.argumentTypes=[];for(const S in R){if(!R.hasOwnProperty(S))continue;const T=this.argumentNames.indexOf(S);if(T===-1)throw new Error(`unable to find argument ${S}`);this.argumentTypes[T]=R[S]}}return this}setTactic(R){return this.tactic=R,this}requestFallback(R){if(!this.onRequestFallback)throw new Error(`"onRequestFallback" not defined on ${this.constructor.name}`);return this.fallbackRequested=!0,this.onRequestFallback(R)}validateSettings(){throw new Error(`"validateSettings" not defined on ${this.constructor.name}`)}addSubKernel(R){if(this.subKernels===null&&(this.subKernels=[]),!R.source)throw new Error('subKernel missing "source" property');if(!R.property&&isNaN(R.property))throw new Error('subKernel missing "property" property');if(!R.name)throw new Error('subKernel missing "name" property');return this.subKernels.push(R),this}destroy(R){throw new Error(`"destroy" called on ${this.constructor.name}`)}getBitRatio(R){if(this.precision==="single")return 4;if(Array.isArray(R[0]))return this.getBitRatio(R[0]);if(R.constructor===F)return this.getBitRatio(R.value);switch(R.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}getPixels(R){throw new Error(`"getPixels" called on ${this.constructor.name}`)}checkOutput(){if(!this.output||!D.isArray(this.output))throw new Error("kernel.output not an array");if(this.output.length<1)throw new Error("kernel.output is empty, needs at least 1 value");for(let R=0;R<this.output.length;R++)if(isNaN(this.output[R])||this.output[R]<1)throw new Error(`${this.constructor.name}.output[${R}] incorrectly defined as \`${this.output[R]}\`, needs to be numeric, and greater than 0`)}prependString(R){throw new Error(`"prependString" called on ${this.constructor.name}`)}hasPrependString(R){throw new Error(`"hasPrependString" called on ${this.constructor.name}`)}toJSON(){return{settings:{output:this.output,pipeline:this.pipeline,argumentNames:this.argumentNames,argumentsTypes:this.argumentTypes,constants:this.constants,pluginNames:this.plugins?this.plugins.map(R=>R.name):null,returnType:this.returnType}}}buildSignature(R){const S=this.constructor;this.signature=S.getSignature(this,S.getArgumentTypes(this,R))}static getArgumentTypes(R,S){const T=new Array(S.length);for(let G=0;G<S.length;G++){const te=S[G],Te=R.argumentTypes[G];if(te.type)T[G]=te.type;else switch(Te){case"Number":case"Integer":case"Float":case"ArrayTexture(1)":T[G]=D.getVariableType(te);break;default:T[G]=Te}}return T}static getSignature(R,S){throw new Error(`"getSignature" not implemented on ${this.name}`)}functionToIGPUFunction(R,S={}){if(typeof R!="string"&&typeof R!="function")throw new Error("source not a string or function");const T=typeof R=="string"?R:R.toString();let G=[];return Array.isArray(S.argumentTypes)?G=S.argumentTypes:typeof S.argumentTypes=="object"?G=D.getArgumentNamesFromString(T).map(te=>S.argumentTypes[te])||[]:G=S.argumentTypes||[],{name:D.getFunctionNameFromString(T)||null,source:T,argumentTypes:G,returnType:S.returnType||null}}onActivate(R){}}function P(k){const R=Object.keys(k),S=[];for(let T=0;T<R.length;T++){const G=R[T];S.push(k[G])}return{argumentTypes:S,argumentNames:R}}y.exports={Kernel:z}},{"../input":110,"../utils":114}],37:[function(g,y,N){const D=`__HEADER__;
__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;

const int LOOP_MAX = __LOOP_MAX__;

__PLUGINS__;
__CONSTANTS__;

varying vec2 vTexCoord;

float acosh(float x) {
  return log(x + sqrt(x * x - 1.0));
}

float sinh(float x) {
  return (pow(${Math.E}, x) - pow(${Math.E}, -x)) / 2.0;
}

float asinh(float x) {
  return log(x + sqrt(x * x + 1.0));
}

float atan2(float v1, float v2) {
  if (v1 == 0.0 || v2 == 0.0) return 0.0;
  return atan(v1 / v2);
}

float atanh(float x) {
  x = (x + 1.0) / (x - 1.0);
  if (x < 0.0) {
    return 0.5 * log(-x);
  }
  return 0.5 * log(x);
}

float cbrt(float x) {
  if (x >= 0.0) {
    return pow(x, 1.0 / 3.0);
  } else {
    return -pow(x, 1.0 / 3.0);
  }
}

float cosh(float x) {
  return (pow(${Math.E}, x) + pow(${Math.E}, -x)) / 2.0; 
}

float expm1(float x) {
  return pow(${Math.E}, x) - 1.0; 
}

float fround(highp float x) {
  return x;
}

float imul(float v1, float v2) {
  return float(int(v1) * int(v2));
}

float log10(float x) {
  return log2(x) * (1.0 / log2(10.0));
}

float log1p(float x) {
  return log(1.0 + x);
}

float _pow(float v1, float v2) {
  if (v2 == 0.0) return 1.0;
  return pow(v1, v2);
}

float tanh(float x) {
  float e = exp(2.0 * x);
  return (e - 1.0) / (e + 1.0);
}

float trunc(float x) {
  if (x >= 0.0) {
    return floor(x); 
  } else {
    return ceil(x);
  }
}

vec4 _round(vec4 x) {
  return floor(x + 0.5);
}

float _round(float x) {
  return floor(x + 0.5);
}

const int BIT_COUNT = 32;
int modi(int x, int y) {
  return x - y * (x / y);
}

int bitwiseOr(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseXOR(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseAnd(int a, int b) {
  int result = 0;
  int n = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 && b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseNot(int a) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if (modi(a, 2) == 0) {
      result += n;    
    }
    a = a / 2;
    n = n * 2;
  }
  return result;
}
int bitwiseZeroFillLeftShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n *= 2;
  }

  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

int bitwiseSignedRightShift(int num, int shifts) {
  return int(floor(float(num) / pow(2.0, float(shifts))));
}

int bitwiseZeroFillRightShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n /= 2;
  }
  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

vec2 integerMod(vec2 x, float y) {
  vec2 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec3 integerMod(vec3 x, float y) {
  vec3 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec4 integerMod(vec4 x, vec4 y) {
  vec4 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

float integerMod(float x, float y) {
  float res = floor(mod(x, y));
  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);
}

int integerMod(int x, int y) {
  return x - (y * int(x / y));
}

__DIVIDE_WITH_INTEGER_CHECK__;

// Here be dragons!
// DO NOT OPTIMIZE THIS CODE
// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE
// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME
const vec2 MAGIC_VEC = vec2(1.0, -256.0);
const vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);
const vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536
float decode32(vec4 texel) {
  __DECODE32_ENDIANNESS__;
  texel *= 255.0;
  vec2 gte128;
  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;
  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;
  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);
  float res = exp2(_round(exponent));
  texel.b = texel.b - 128.0 * gte128.x;
  res = dot(texel, SCALE_FACTOR) * exp2(_round(exponent-23.0)) + res;
  res *= gte128.y * -2.0 + 1.0;
  return res;
}

float decode16(vec4 texel, int index) {
  int channel = integerMod(index, 2);
  if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;
  if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;
  return 0.0;
}

float decode8(vec4 texel, int index) {
  int channel = integerMod(index, 4);
  if (channel == 0) return texel.r * 255.0;
  if (channel == 1) return texel.g * 255.0;
  if (channel == 2) return texel.b * 255.0;
  if (channel == 3) return texel.a * 255.0;
  return 0.0;
}

vec4 legacyEncode32(float f) {
  float F = abs(f);
  float sign = f < 0.0 ? 1.0 : 0.0;
  float exponent = floor(log2(F));
  float mantissa = (exp2(-exponent) * F);
  // exponent += floor(log2(mantissa));
  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;
  texel.rg = integerMod(texel.rg, 256.0);
  texel.b = integerMod(texel.b, 128.0);
  texel.a = exponent*0.5 + 63.5;
  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;
  texel = floor(texel);
  texel *= 0.003921569; // 1/255
  __ENCODE32_ENDIANNESS__;
  return texel;
}

// https://github.com/gpujs/gpu.js/wiki/Encoder-details
vec4 encode32(float value) {
  if (value == 0.0) return vec4(0, 0, 0, 0);

  float exponent;
  float mantissa;
  vec4  result;
  float sgn;

  sgn = step(0.0, -value);
  value = abs(value);

  exponent = floor(log2(value));

  mantissa = value*pow(2.0, -exponent)-1.0;
  exponent = exponent+127.0;
  result   = vec4(0,0,0,0);

  result.a = floor(exponent/2.0);
  exponent = exponent - result.a*2.0;
  result.a = result.a + 128.0*sgn;

  result.b = floor(mantissa * 128.0);
  mantissa = mantissa - result.b / 128.0;
  result.b = result.b + exponent*128.0;

  result.g = floor(mantissa*32768.0);
  mantissa = mantissa - result.g/32768.0;

  result.r = floor(mantissa*8388608.0);
  return result/255.0;
}
// Dragons end here

int index;
ivec3 threadId;

ivec3 indexTo3D(int idx, ivec3 texDim) {
  int z = int(idx / (texDim.x * texDim.y));
  idx -= z * int(texDim.x * texDim.y);
  int y = int(idx / texDim.x);
  int x = int(integerMod(idx, texDim.x));
  return ivec3(x, y, z);
}

float get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  return decode32(texel);
}

float get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x * 2;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));
  return decode16(texel, index);
}

float get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x * 4;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));
  return decode8(texel, index);
}

float getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 4);
  index = index / 4;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  if (channel == 0) return texel.r;
  if (channel == 1) return texel.g;
  if (channel == 2) return texel.b;
  if (channel == 3) return texel.a;
  return 0.0;
}

vec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  return texture2D(tex, st / vec2(texSize));
}

float getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return result[0];
}

vec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec2(result[0], result[1]);
}

vec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int channel = integerMod(index, 2);
  index = index / 2;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  if (channel == 0) return vec2(texel.r, texel.g);
  if (channel == 1) return vec2(texel.b, texel.a);
  return vec2(0.0, 0.0);
}

vec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec3(result[0], result[1], result[2]);
}

vec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));
  int vectorIndex = fieldIndex / 4;
  int vectorOffset = fieldIndex - vectorIndex * 4;
  int readY = vectorIndex / texSize.x;
  int readX = vectorIndex - readY * texSize.x;
  vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));
  
  if (vectorOffset == 0) {
    return tex1.xyz;
  } else if (vectorOffset == 1) {
    return tex1.yzw;
  } else {
    readX++;
    if (readX >= texSize.x) {
      readX = 0;
      readY++;
    }
    vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));
    if (vectorOffset == 2) {
      return vec3(tex1.z, tex1.w, tex2.x);
    } else {
      return vec3(tex1.w, tex2.x, tex2.y);
    }
  }
}

vec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  return getImage2D(tex, texSize, texDim, z, y, x);
}

vec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 2);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture2D(tex, st / vec2(texSize));
  return vec4(texel.r, texel.g, texel.b, texel.a);
}

vec4 actualColor;
void color(float r, float g, float b, float a) {
  actualColor = vec4(r,g,b,a);
}

void color(float r, float g, float b) {
  color(r,g,b,1.0);
}

void color(sampler2D image) {
  actualColor = texture2D(image, vTexCoord);
}

float modulo(float number, float divisor) {
  if (number < 0.0) {
    number = abs(number);
    if (divisor < 0.0) {
      divisor = abs(divisor);
    }
    return -mod(number, divisor);
  }
  if (divisor < 0.0) {
    divisor = abs(divisor);
  }
  return mod(number, divisor);
}

__INJECTED_NATIVE__;
__MAIN_CONSTANTS__;
__MAIN_ARGUMENTS__;
__KERNEL__;

void main(void) {
  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;
  __MAIN_RESULT__;
}`;y.exports={fragmentShader:D}},{}],38:[function(g,y,N){const{utils:D}=g("../../utils"),{FunctionNode:F}=g("../function-node");class z extends F{constructor(S,T){super(S,T),T&&T.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=T.fixIntegerDivisionAccuracy)}astConditionalExpression(S,T){if(S.type!=="ConditionalExpression")throw this.astErrorOutput("Not a conditional expression",S);const G=this.getType(S.consequent),te=this.getType(S.alternate);return G===null&&te===null?(T.push("if ("),this.astGeneric(S.test,T),T.push(") {"),this.astGeneric(S.consequent,T),T.push(";"),T.push("} else {"),this.astGeneric(S.alternate,T),T.push(";"),T.push("}"),T):(T.push("("),this.astGeneric(S.test,T),T.push("?"),this.astGeneric(S.consequent,T),T.push(":"),this.astGeneric(S.alternate,T),T.push(")"),T)}astFunction(S,T){if(this.isRootKernel)T.push("void");else{this.returnType||this.findLastReturn()&&(this.returnType=this.getType(S.body),this.returnType==="LiteralInteger"&&(this.returnType="Number"));const{returnType:G}=this;if(!G)T.push("void");else{const te=P[G];if(!te)throw new Error(`unknown type ${G}`);T.push(te)}}if(T.push(" "),T.push(this.name),T.push("("),!this.isRootKernel)for(let G=0;G<this.argumentNames.length;++G){const te=this.argumentNames[G];G>0&&T.push(", ");let Te=this.argumentTypes[this.argumentNames.indexOf(te)];if(!Te)throw this.astErrorOutput(`Unknown argument ${te} type`,S);Te==="LiteralInteger"&&(this.argumentTypes[G]=Te="Number");const ie=P[Te];if(!ie)throw this.astErrorOutput("Unexpected expression",S);const _e=D.sanitizeName(te);ie==="sampler2D"||ie==="sampler2DArray"?T.push(`${ie} user_${_e},ivec2 user_${_e}Size,ivec3 user_${_e}Dim`):T.push(`${ie} user_${_e}`)}T.push(`) {
`);for(let G=0;G<S.body.body.length;++G)this.astGeneric(S.body.body[G],T),T.push(`
`);return T.push(`}
`),T}astReturnStatement(S,T){if(!S.argument)throw this.astErrorOutput("Unexpected return statement",S);this.pushState("skip-literal-correction");const G=this.getType(S.argument);this.popState("skip-literal-correction");const te=[];switch(this.returnType||(G==="LiteralInteger"||G==="Integer"?this.returnType="Number":this.returnType=G),this.returnType){case"LiteralInteger":case"Number":case"Float":switch(G){case"Integer":te.push("float("),this.astGeneric(S.argument,te),te.push(")");break;case"LiteralInteger":this.castLiteralToFloat(S.argument,te),this.getType(S)==="Integer"&&(te.unshift("float("),te.push(")"));break;default:this.astGeneric(S.argument,te)}break;case"Integer":switch(G){case"Float":case"Number":this.castValueToInteger(S.argument,te);break;case"LiteralInteger":this.castLiteralToInteger(S.argument,te);break;default:this.astGeneric(S.argument,te)}break;case"Array(4)":case"Array(3)":case"Array(2)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"Input":this.astGeneric(S.argument,te);break;default:throw this.astErrorOutput(`unhandled return type ${this.returnType}`,S)}return this.isRootKernel?(T.push(`kernelResult = ${te.join("")};`),T.push("return;")):this.isSubKernel?(T.push(`subKernelResult_${this.name} = ${te.join("")};`),T.push(`return subKernelResult_${this.name};`)):T.push(`return ${te.join("")};`),T}astLiteral(S,T){if(isNaN(S.value))throw this.astErrorOutput("Non-numeric literal not supported : "+S.value,S);const G=this.astKey(S);return Number.isInteger(S.value)?this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[G]="Integer",T.push(`${S.value}`)):this.isState("casting-to-float")||this.isState("building-float")?(this.literalTypes[G]="Number",T.push(`${S.value}.0`)):(this.literalTypes[G]="Number",T.push(`${S.value}.0`)):this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[G]="Integer",T.push(Math.round(S.value))):(this.literalTypes[G]="Number",T.push(`${S.value}`)),T}astBinaryExpression(S,T){if(this.checkAndUpconvertOperator(S,T))return T;if(this.fixIntegerDivisionAccuracy&&S.operator==="/"){switch(T.push("divWithIntCheck("),this.pushState("building-float"),this.getType(S.left)){case"Integer":this.castValueToFloat(S.left,T);break;case"LiteralInteger":this.castLiteralToFloat(S.left,T);break;default:this.astGeneric(S.left,T)}switch(T.push(", "),this.getType(S.right)){case"Integer":this.castValueToFloat(S.right,T);break;case"LiteralInteger":this.castLiteralToFloat(S.right,T);break;default:this.astGeneric(S.right,T)}return this.popState("building-float"),T.push(")"),T}T.push("(");const G=this.getType(S.left)||"Number",te=this.getType(S.right)||"Number",Te=G+" & "+te;switch(Te){case"Integer & Integer":this.pushState("building-integer"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.astGeneric(S.right,T),this.popState("building-integer");break;case"Number & Float":case"Float & Number":case"Float & Float":case"Number & Number":this.pushState("building-float"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.astGeneric(S.right,T),this.popState("building-float");break;case"LiteralInteger & LiteralInteger":this.isState("casting-to-integer")||this.isState("building-integer")?(this.pushState("building-integer"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.astGeneric(S.right,T),this.popState("building-integer")):(this.pushState("building-float"),this.castLiteralToFloat(S.left,T),T.push(k[S.operator]||S.operator),this.castLiteralToFloat(S.right,T),this.popState("building-float"));break;case"Integer & Float":case"Integer & Number":if((S.operator===">"||S.operator==="<"&&S.right.type==="Literal")&&!Number.isInteger(S.right.value)){this.pushState("building-float"),this.castValueToFloat(S.left,T),T.push(k[S.operator]||S.operator),this.astGeneric(S.right,T),this.popState("building-float");break}if(this.pushState("building-integer"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.pushState("casting-to-integer"),S.right.type==="Literal"){const ie=[];if(this.astGeneric(S.right,ie),this.getType(S.right)==="Integer")T.push(ie.join(""));else throw this.astErrorOutput("Unhandled binary expression with literal",S)}else T.push("int("),this.astGeneric(S.right,T),T.push(")");this.popState("casting-to-integer"),this.popState("building-integer");break;case"Integer & LiteralInteger":this.pushState("building-integer"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.castLiteralToInteger(S.right,T),this.popState("building-integer");break;case"Number & Integer":this.pushState("building-float"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.castValueToFloat(S.right,T),this.popState("building-float");break;case"Float & LiteralInteger":case"Number & LiteralInteger":this.pushState("building-float"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.castLiteralToFloat(S.right,T),this.popState("building-float");break;case"LiteralInteger & Float":case"LiteralInteger & Number":this.isState("casting-to-integer")?(this.pushState("building-integer"),this.castLiteralToInteger(S.left,T),T.push(k[S.operator]||S.operator),this.castValueToInteger(S.right,T),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.pushState("casting-to-float"),this.astGeneric(S.right,T),this.popState("casting-to-float"),this.popState("building-float"));break;case"LiteralInteger & Integer":this.pushState("building-integer"),this.castLiteralToInteger(S.left,T),T.push(k[S.operator]||S.operator),this.astGeneric(S.right,T),this.popState("building-integer");break;case"Boolean & Boolean":this.pushState("building-boolean"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.astGeneric(S.right,T),this.popState("building-boolean");break;case"Float & Integer":this.pushState("building-float"),this.astGeneric(S.left,T),T.push(k[S.operator]||S.operator),this.castValueToFloat(S.right,T),this.popState("building-float");break;default:throw this.astErrorOutput(`Unhandled binary expression between ${Te}`,S)}return T.push(")"),T}checkAndUpconvertOperator(S,T){const G=this.checkAndUpconvertBitwiseOperators(S,T);if(G)return G;const Te={"%":this.fixIntegerDivisionAccuracy?"integerCorrectionModulo":"modulo","**":"pow"}[S.operator];if(!Te)return null;switch(T.push(Te),T.push("("),this.getType(S.left)){case"Integer":this.castValueToFloat(S.left,T);break;case"LiteralInteger":this.castLiteralToFloat(S.left,T);break;default:this.astGeneric(S.left,T)}switch(T.push(","),this.getType(S.right)){case"Integer":this.castValueToFloat(S.right,T);break;case"LiteralInteger":this.castLiteralToFloat(S.right,T);break;default:this.astGeneric(S.right,T)}return T.push(")"),T}checkAndUpconvertBitwiseOperators(S,T){const te={"&":"bitwiseAnd","|":"bitwiseOr","^":"bitwiseXOR","<<":"bitwiseZeroFillLeftShift",">>":"bitwiseSignedRightShift",">>>":"bitwiseZeroFillRightShift"}[S.operator];if(!te)return null;switch(T.push(te),T.push("("),this.getType(S.left)){case"Number":case"Float":this.castValueToInteger(S.left,T);break;case"LiteralInteger":this.castLiteralToInteger(S.left,T);break;default:this.astGeneric(S.left,T)}switch(T.push(","),this.getType(S.right)){case"Number":case"Float":this.castValueToInteger(S.right,T);break;case"LiteralInteger":this.castLiteralToInteger(S.right,T);break;default:this.astGeneric(S.right,T)}return T.push(")"),T}checkAndUpconvertBitwiseUnary(S,T){const te={"~":"bitwiseNot"}[S.operator];if(!te)return null;switch(T.push(te),T.push("("),this.getType(S.argument)){case"Number":case"Float":this.castValueToInteger(S.argument,T);break;case"LiteralInteger":this.castLiteralToInteger(S.argument,T);break;default:this.astGeneric(S.argument,T)}return T.push(")"),T}castLiteralToInteger(S,T){return this.pushState("casting-to-integer"),this.astGeneric(S,T),this.popState("casting-to-integer"),T}castLiteralToFloat(S,T){return this.pushState("casting-to-float"),this.astGeneric(S,T),this.popState("casting-to-float"),T}castValueToInteger(S,T){return this.pushState("casting-to-integer"),T.push("int("),this.astGeneric(S,T),T.push(")"),this.popState("casting-to-integer"),T}castValueToFloat(S,T){return this.pushState("casting-to-float"),T.push("float("),this.astGeneric(S,T),T.push(")"),this.popState("casting-to-float"),T}astIdentifierExpression(S,T){if(S.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",S);const G=this.getType(S),te=D.sanitizeName(S.name);return S.name==="Infinity"?T.push("3.402823466e+38"):G==="Boolean"?this.argumentNames.indexOf(te)>-1?T.push(`bool(user_${te})`):T.push(`user_${te}`):T.push(`user_${te}`),T}astForStatement(S,T){if(S.type!=="ForStatement")throw this.astErrorOutput("Invalid for statement",S);const G=[],te=[],Te=[],ie=[];let _e=null;if(S.init){const{declarations:Y}=S.init;Y.length>1&&(_e=!1),this.astGeneric(S.init,G);for(let re=0;re<Y.length;re++)Y[re].init&&Y[re].init.type!=="Literal"&&(_e=!1)}else _e=!1;if(S.test?this.astGeneric(S.test,te):_e=!1,S.update?this.astGeneric(S.update,Te):_e=!1,S.body&&(this.pushState("loop-body"),this.astGeneric(S.body,ie),this.popState("loop-body")),_e===null&&(_e=this.isSafe(S.init)&&this.isSafe(S.test)),_e){const Y=G.join(""),re=Y[Y.length-1]!==";";T.push(`for (${Y}${re?";":""}${te.join("")};${Te.join("")}){
`),T.push(ie.join("")),T.push(`}
`)}else{const Y=this.getInternalVariableName("safeI");G.length>0&&T.push(G.join(""),`
`),T.push(`for (int ${Y}=0;${Y}<LOOP_MAX;${Y}++){
`),te.length>0&&T.push(`if (!${te.join("")}) break;
`),T.push(ie.join("")),T.push(`
${Te.join("")};`),T.push(`}
`)}return T}astWhileStatement(S,T){if(S.type!=="WhileStatement")throw this.astErrorOutput("Invalid while statement",S);const G=this.getInternalVariableName("safeI");return T.push(`for (int ${G}=0;${G}<LOOP_MAX;${G}++){
`),T.push("if (!"),this.astGeneric(S.test,T),T.push(`) break;
`),this.astGeneric(S.body,T),T.push(`}
`),T}astDoWhileStatement(S,T){if(S.type!=="DoWhileStatement")throw this.astErrorOutput("Invalid while statement",S);const G=this.getInternalVariableName("safeI");return T.push(`for (int ${G}=0;${G}<LOOP_MAX;${G}++){
`),this.astGeneric(S.body,T),T.push("if (!"),this.astGeneric(S.test,T),T.push(`) break;
`),T.push(`}
`),T}astAssignmentExpression(S,T){if(S.operator==="%=")this.astGeneric(S.left,T),T.push("="),T.push("mod("),this.astGeneric(S.left,T),T.push(","),this.astGeneric(S.right,T),T.push(")");else if(S.operator==="**=")this.astGeneric(S.left,T),T.push("="),T.push("pow("),this.astGeneric(S.left,T),T.push(","),this.astGeneric(S.right,T),T.push(")");else{const G=this.getType(S.left),te=this.getType(S.right);return this.astGeneric(S.left,T),T.push(S.operator),G!=="Integer"&&te==="Integer"?(T.push("float("),this.astGeneric(S.right,T),T.push(")")):this.astGeneric(S.right,T),T}}astBlockStatement(S,T){if(this.isState("loop-body")){this.pushState("block-body");for(let G=0;G<S.body.length;G++)this.astGeneric(S.body[G],T);this.popState("block-body")}else{T.push(`{
`);for(let G=0;G<S.body.length;G++)this.astGeneric(S.body[G],T);T.push(`}
`)}return T}astVariableDeclaration(S,T){const G=S.declarations;if(!G||!G[0]||!G[0].init)throw this.astErrorOutput("Unexpected expression",S);const te=[];let Te=null;const ie=[];let _e=[];for(let Y=0;Y<G.length;Y++){const re=G[Y],be=re.init,ke=this.getDeclaration(re.id),rt=this.getType(re.init);let vt=rt;vt==="LiteralInteger"&&(ke.suggestedType==="Integer"?vt="Integer":vt="Number");const Q=P[vt];if(!Q)throw this.astErrorOutput(`Markup type ${vt} not handled`,S);const U=[];if(rt==="Integer"&&vt==="Integer"){if(ke.valueType="Number",Y===0||Te===null)U.push("float ");else if(vt!==Te)throw new Error("Unhandled declaration");Te=vt,U.push(`user_${D.sanitizeName(re.id.name)}=`),U.push("float("),this.astGeneric(be,U),U.push(")")}else ke.valueType=vt,Y===0||Te===null?U.push(`${Q} `):vt!==Te&&(ie.push(_e.join(",")),_e=[],U.push(`${Q} `)),Te=vt,U.push(`user_${D.sanitizeName(re.id.name)}=`),rt==="Number"&&vt==="Integer"?be.left&&be.left.type==="Literal"?this.astGeneric(be,U):(U.push("int("),this.astGeneric(be,U),U.push(")")):rt==="LiteralInteger"&&vt==="Integer"?this.castLiteralToInteger(be,U):this.astGeneric(be,U);_e.push(U.join(""))}return _e.length>0&&ie.push(_e.join(",")),te.push(ie.join(";")),T.push(te.join("")),T.push(";"),T}astIfStatement(S,T){return T.push("if ("),this.astGeneric(S.test,T),T.push(")"),S.consequent.type==="BlockStatement"?this.astGeneric(S.consequent,T):(T.push(` {
`),this.astGeneric(S.consequent,T),T.push(`
}
`)),S.alternate&&(T.push("else "),S.alternate.type==="BlockStatement"||S.alternate.type==="IfStatement"?this.astGeneric(S.alternate,T):(T.push(` {
`),this.astGeneric(S.alternate,T),T.push(`
}
`))),T}astSwitchStatement(S,T){if(S.type!=="SwitchStatement")throw this.astErrorOutput("Invalid switch statement",S);const{discriminant:G,cases:te}=S,Te=this.getType(G),ie=`switchDiscriminant${this.astKey(S,"_")}`;switch(Te){case"Float":case"Number":T.push(`float ${ie} = `),this.astGeneric(G,T),T.push(`;
`);break;case"Integer":T.push(`int ${ie} = `),this.astGeneric(G,T),T.push(`;
`);break}if(te.length===1&&!te[0].test)return this.astGeneric(te[0].consequent,T),T;let _e=!1,Y=[],re=!1,be=!1;for(let ke=0;ke<te.length;ke++){if(te[ke].test){if(ke===0||!be?(be=!0,T.push(`if (${ie} == `)):_e?(T.push(`${ie} == `),_e=!1):T.push(` else if (${ie} == `),Te==="Integer")switch(this.getType(te[ke].test)){case"Number":case"Float":this.castValueToInteger(te[ke].test,T);break;case"LiteralInteger":this.castLiteralToInteger(te[ke].test,T);break}else if(Te==="Float")switch(this.getType(te[ke].test)){case"LiteralInteger":this.castLiteralToFloat(te[ke].test,T);break;case"Integer":this.castValueToFloat(te[ke].test,T);break}else throw new Error("unhanlded");if(!te[ke].consequent||te[ke].consequent.length===0){_e=!0,T.push(" || ");continue}T.push(`) {
`)}else if(te.length>ke+1){re=!0,this.astGeneric(te[ke].consequent,Y);continue}else T.push(` else {
`);this.astGeneric(te[ke].consequent,T),T.push(`
}`)}return re&&(T.push(" else {"),T.push(Y.join("")),T.push("}")),T}astThisExpression(S,T){return T.push("this"),T}astMemberExpression(S,T){const{property:G,name:te,signature:Te,origin:ie,type:_e,xProperty:Y,yProperty:re,zProperty:be}=this.getMemberExpressionDetails(S);switch(Te){case"value.thread.value":case"this.thread.value":if(te!=="x"&&te!=="y"&&te!=="z")throw this.astErrorOutput("Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`",S);return T.push(`threadId.${te}`),T;case"this.output.value":if(this.dynamicOutput)switch(te){case"x":this.isState("casting-to-float")?T.push("float(uOutputDim.x)"):T.push("uOutputDim.x");break;case"y":this.isState("casting-to-float")?T.push("float(uOutputDim.y)"):T.push("uOutputDim.y");break;case"z":this.isState("casting-to-float")?T.push("float(uOutputDim.z)"):T.push("uOutputDim.z");break;default:throw this.astErrorOutput("Unexpected expression",S)}else switch(te){case"x":this.isState("casting-to-integer")?T.push(this.output[0]):T.push(this.output[0],".0");break;case"y":this.isState("casting-to-integer")?T.push(this.output[1]):T.push(this.output[1],".0");break;case"z":this.isState("casting-to-integer")?T.push(this.output[2]):T.push(this.output[2],".0");break;default:throw this.astErrorOutput("Unexpected expression",S)}return T;case"value":throw this.astErrorOutput("Unexpected expression",S);case"value[]":case"value[][]":case"value[][][]":case"value[][][][]":case"value.value":if(ie==="Math")return T.push(Math[te]),T;const rt=D.sanitizeName(te);switch(G){case"r":return T.push(`user_${rt}.r`),T;case"g":return T.push(`user_${rt}.g`),T;case"b":return T.push(`user_${rt}.b`),T;case"a":return T.push(`user_${rt}.a`),T}break;case"this.constants.value":if(typeof Y>"u")switch(_e){case"Array(2)":case"Array(3)":case"Array(4)":return T.push(`constants_${D.sanitizeName(te)}`),T}case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":case"this.constants.value[][][][]":break;case"fn()[]":return this.astCallExpression(S.object,T),T.push("["),T.push(this.memberExpressionPropertyMarkup(G)),T.push("]"),T;case"fn()[][]":return this.astCallExpression(S.object.object,T),T.push("["),T.push(this.memberExpressionPropertyMarkup(S.object.property)),T.push("]"),T.push("["),T.push(this.memberExpressionPropertyMarkup(S.property)),T.push("]"),T;case"[][]":return this.astArrayExpression(S.object,T),T.push("["),T.push(this.memberExpressionPropertyMarkup(G)),T.push("]"),T;default:throw this.astErrorOutput("Unexpected expression",S)}if(S.computed===!1)switch(_e){case"Number":case"Integer":case"Float":case"Boolean":return T.push(`${ie}_${D.sanitizeName(te)}`),T}const ke=`${ie}_${D.sanitizeName(te)}`;switch(_e){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(S.object,T),T.push("["),T.push(this.memberExpressionPropertyMarkup(Y)),T.push("]");break;case"HTMLImageArray":T.push(`getImage3D(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"ArrayTexture(1)":T.push(`getFloatFromSampler2D(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"Array1D(2)":case"Array2D(2)":case"Array3D(2)":T.push(`getMemoryOptimizedVec2(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"ArrayTexture(2)":T.push(`getVec2FromSampler2D(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"Array1D(3)":case"Array2D(3)":case"Array3D(3)":T.push(`getMemoryOptimizedVec3(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"ArrayTexture(3)":T.push(`getVec3FromSampler2D(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"Array1D(4)":case"Array2D(4)":case"Array3D(4)":T.push(`getMemoryOptimizedVec4(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"ArrayTexture(4)":case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLVideo":T.push(`getVec4FromSampler2D(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"NumberTexture":case"Array":case"Array2D":case"Array3D":case"Array4D":case"Input":case"Number":case"Float":case"Integer":if(this.precision==="single")T.push(`getMemoryOptimized32(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");else{const rt=ie==="user"?this.lookupFunctionArgumentBitRatio(this.name,te):this.constantBitRatios[te];switch(rt){case 1:T.push(`get8(${ke}, ${ke}Size, ${ke}Dim, `);break;case 2:T.push(`get16(${ke}, ${ke}Size, ${ke}Dim, `);break;case 4:case 0:T.push(`get32(${ke}, ${ke}Size, ${ke}Dim, `);break;default:throw new Error(`unhandled bit ratio of ${rt}`)}this.memberExpressionXYZ(Y,re,be,T),T.push(")")}break;case"MemoryOptimizedNumberTexture":T.push(`getMemoryOptimized32(${ke}, ${ke}Size, ${ke}Dim, `),this.memberExpressionXYZ(Y,re,be,T),T.push(")");break;case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":T.push(`${ke}[${this.memberExpressionPropertyMarkup(re)}]`),re&&T.push(`[${this.memberExpressionPropertyMarkup(Y)}]`);break;default:throw new Error(`unhandled member expression "${_e}"`)}return T}astCallExpression(S,T){if(!S.callee)throw this.astErrorOutput("Unknown CallExpression",S);let G=null;const te=this.isAstMathFunction(S);if(te||S.callee.object&&S.callee.object.type==="ThisExpression"?G=S.callee.property.name:S.callee.type==="SequenceExpression"&&S.callee.expressions[0].type==="Literal"&&!isNaN(S.callee.expressions[0].raw)?G=S.callee.expressions[1].property.name:G=S.callee.name,!G)throw this.astErrorOutput("Unhandled function, couldn't find name",S);switch(G){case"pow":G="_pow";break;case"round":G="_round";break}if(this.calledFunctions.indexOf(G)<0&&this.calledFunctions.push(G),G==="random"&&this.plugins&&this.plugins.length>0)for(let Te=0;Te<this.plugins.length;Te++){const ie=this.plugins[Te];if(ie.functionMatch==="Math.random()"&&ie.functionReplace)return T.push(ie.functionReplace),T}if(this.onFunctionCall&&this.onFunctionCall(this.name,G,S.arguments),T.push(G),T.push("("),te)for(let Te=0;Te<S.arguments.length;++Te){const ie=S.arguments[Te],_e=this.getType(ie);switch(Te>0&&T.push(", "),_e){case"Integer":this.castValueToFloat(ie,T);break;default:this.astGeneric(ie,T);break}}else{const Te=this.lookupFunctionArgumentTypes(G)||[];for(let ie=0;ie<S.arguments.length;++ie){const _e=S.arguments[ie];let Y=Te[ie];ie>0&&T.push(", ");const re=this.getType(_e);switch(Y||(this.triggerImplyArgumentType(G,ie,re,this),Y=re),re){case"Boolean":this.astGeneric(_e,T);continue;case"Number":case"Float":if(Y==="Integer"){T.push("int("),this.astGeneric(_e,T),T.push(")");continue}else if(Y==="Number"||Y==="Float"){this.astGeneric(_e,T);continue}else if(Y==="LiteralInteger"){this.castLiteralToFloat(_e,T);continue}break;case"Integer":if(Y==="Number"||Y==="Float"){T.push("float("),this.astGeneric(_e,T),T.push(")");continue}else if(Y==="Integer"){this.astGeneric(_e,T);continue}break;case"LiteralInteger":if(Y==="Integer"){this.castLiteralToInteger(_e,T);continue}else if(Y==="Number"||Y==="Float"){this.castLiteralToFloat(_e,T);continue}else if(Y==="LiteralInteger"){this.astGeneric(_e,T);continue}break;case"Array(2)":case"Array(3)":case"Array(4)":if(Y===re){if(_e.type==="Identifier")T.push(`user_${D.sanitizeName(_e.name)}`);else if(_e.type==="ArrayExpression"||_e.type==="MemberExpression"||_e.type==="CallExpression")this.astGeneric(_e,T);else throw this.astErrorOutput(`Unhandled argument type ${_e.type}`,S);continue}break;case"HTMLCanvas":case"OffscreenCanvas":case"HTMLImage":case"ImageBitmap":case"ImageData":case"HTMLImageArray":case"HTMLVideo":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"Array":case"Input":if(Y===re){if(_e.type!=="Identifier")throw this.astErrorOutput(`Unhandled argument type ${_e.type}`,S);this.triggerImplyArgumentBitRatio(this.name,_e.name,G,ie);const be=D.sanitizeName(_e.name);T.push(`user_${be},user_${be}Size,user_${be}Dim`);continue}break}throw this.astErrorOutput(`Unhandled argument combination of ${re} and ${Y} for argument named "${_e.name}"`,S)}}return T.push(")"),T}astArrayExpression(S,T){const G=this.getType(S),te=S.elements.length;switch(G){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":T.push(`mat${te}(`);break;default:T.push(`vec${te}(`)}for(let Te=0;Te<te;++Te){Te>0&&T.push(", ");const ie=S.elements[Te];this.astGeneric(ie,T)}return T.push(")"),T}memberExpressionXYZ(S,T,G,te){return G?te.push(this.memberExpressionPropertyMarkup(G),", "):te.push("0, "),T?te.push(this.memberExpressionPropertyMarkup(T),", "):te.push("0, "),te.push(this.memberExpressionPropertyMarkup(S)),te}memberExpressionPropertyMarkup(S){if(!S)throw new Error("Property not set");const T=this.getType(S),G=[];switch(T){case"Number":case"Float":this.castValueToInteger(S,G);break;case"LiteralInteger":this.castLiteralToInteger(S,G);break;default:this.astGeneric(S,G)}return G.join("")}}const P={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4","Matrix(2)":"mat2","Matrix(3)":"mat3","Matrix(4)":"mat4",Array2D:"sampler2D",Array3D:"sampler2D",Boolean:"bool",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",LiteralInteger:"float",NumberTexture:"sampler2D",MemoryOptimizedNumberTexture:"sampler2D","ArrayTexture(1)":"sampler2D","ArrayTexture(2)":"sampler2D","ArrayTexture(3)":"sampler2D","ArrayTexture(4)":"sampler2D",HTMLVideo:"sampler2D",HTMLCanvas:"sampler2D",OffscreenCanvas:"sampler2D",HTMLImage:"sampler2D",ImageBitmap:"sampler2D",ImageData:"sampler2D",HTMLImageArray:"sampler2DArray"},k={"===":"==","!==":"!="};y.exports={WebGLFunctionNode:z}},{"../../utils":114,"../function-node":10}],39:[function(g,y,N){const{WebGLKernelValueBoolean:D}=g("./kernel-value/boolean"),{WebGLKernelValueFloat:F}=g("./kernel-value/float"),{WebGLKernelValueInteger:z}=g("./kernel-value/integer"),{WebGLKernelValueHTMLImage:P}=g("./kernel-value/html-image"),{WebGLKernelValueDynamicHTMLImage:k}=g("./kernel-value/dynamic-html-image"),{WebGLKernelValueHTMLVideo:R}=g("./kernel-value/html-video"),{WebGLKernelValueDynamicHTMLVideo:S}=g("./kernel-value/dynamic-html-video"),{WebGLKernelValueSingleInput:T}=g("./kernel-value/single-input"),{WebGLKernelValueDynamicSingleInput:G}=g("./kernel-value/dynamic-single-input"),{WebGLKernelValueUnsignedInput:te}=g("./kernel-value/unsigned-input"),{WebGLKernelValueDynamicUnsignedInput:Te}=g("./kernel-value/dynamic-unsigned-input"),{WebGLKernelValueMemoryOptimizedNumberTexture:ie}=g("./kernel-value/memory-optimized-number-texture"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:_e}=g("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGLKernelValueNumberTexture:Y}=g("./kernel-value/number-texture"),{WebGLKernelValueDynamicNumberTexture:re}=g("./kernel-value/dynamic-number-texture"),{WebGLKernelValueSingleArray:be}=g("./kernel-value/single-array"),{WebGLKernelValueDynamicSingleArray:ke}=g("./kernel-value/dynamic-single-array"),{WebGLKernelValueSingleArray1DI:rt}=g("./kernel-value/single-array1d-i"),{WebGLKernelValueDynamicSingleArray1DI:vt}=g("./kernel-value/dynamic-single-array1d-i"),{WebGLKernelValueSingleArray2DI:Q}=g("./kernel-value/single-array2d-i"),{WebGLKernelValueDynamicSingleArray2DI:U}=g("./kernel-value/dynamic-single-array2d-i"),{WebGLKernelValueSingleArray3DI:Me}=g("./kernel-value/single-array3d-i"),{WebGLKernelValueDynamicSingleArray3DI:Fe}=g("./kernel-value/dynamic-single-array3d-i"),{WebGLKernelValueArray2:bt}=g("./kernel-value/array2"),{WebGLKernelValueArray3:v}=g("./kernel-value/array3"),{WebGLKernelValueArray4:I}=g("./kernel-value/array4"),{WebGLKernelValueUnsignedArray:M}=g("./kernel-value/unsigned-array"),{WebGLKernelValueDynamicUnsignedArray:H}=g("./kernel-value/dynamic-unsigned-array"),oe={unsigned:{dynamic:{Boolean:D,Integer:z,Float:F,Array:H,"Array(2)":bt,"Array(3)":v,"Array(4)":I,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:Te,NumberTexture:re,"ArrayTexture(1)":re,"ArrayTexture(2)":re,"ArrayTexture(3)":re,"ArrayTexture(4)":re,MemoryOptimizedNumberTexture:_e,HTMLCanvas:k,OffscreenCanvas:k,HTMLImage:k,ImageBitmap:k,ImageData:k,HTMLImageArray:!1,HTMLVideo:S},static:{Boolean:D,Float:F,Integer:z,Array:M,"Array(2)":bt,"Array(3)":v,"Array(4)":I,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:te,NumberTexture:Y,"ArrayTexture(1)":Y,"ArrayTexture(2)":Y,"ArrayTexture(3)":Y,"ArrayTexture(4)":Y,MemoryOptimizedNumberTexture:ie,HTMLCanvas:P,OffscreenCanvas:P,HTMLImage:P,ImageBitmap:P,ImageData:P,HTMLImageArray:!1,HTMLVideo:R}},single:{dynamic:{Boolean:D,Integer:z,Float:F,Array:ke,"Array(2)":bt,"Array(3)":v,"Array(4)":I,"Array1D(2)":vt,"Array1D(3)":vt,"Array1D(4)":vt,"Array2D(2)":U,"Array2D(3)":U,"Array2D(4)":U,"Array3D(2)":Fe,"Array3D(3)":Fe,"Array3D(4)":Fe,Input:G,NumberTexture:re,"ArrayTexture(1)":re,"ArrayTexture(2)":re,"ArrayTexture(3)":re,"ArrayTexture(4)":re,MemoryOptimizedNumberTexture:_e,HTMLCanvas:k,OffscreenCanvas:k,HTMLImage:k,ImageBitmap:k,ImageData:k,HTMLImageArray:!1,HTMLVideo:S},static:{Boolean:D,Float:F,Integer:z,Array:be,"Array(2)":bt,"Array(3)":v,"Array(4)":I,"Array1D(2)":rt,"Array1D(3)":rt,"Array1D(4)":rt,"Array2D(2)":Q,"Array2D(3)":Q,"Array2D(4)":Q,"Array3D(2)":Me,"Array3D(3)":Me,"Array3D(4)":Me,Input:T,NumberTexture:Y,"ArrayTexture(1)":Y,"ArrayTexture(2)":Y,"ArrayTexture(3)":Y,"ArrayTexture(4)":Y,MemoryOptimizedNumberTexture:ie,HTMLCanvas:P,OffscreenCanvas:P,HTMLImage:P,ImageBitmap:P,ImageData:P,HTMLImageArray:!1,HTMLVideo:R}}};function de(ue,ve,xe,Re){if(!ue)throw new Error("type missing");if(!ve)throw new Error("dynamic missing");if(!xe)throw new Error("precision missing");Re.type&&(ue=Re.type);const Ue=oe[xe][ve];if(Ue[ue]===!1)return null;if(Ue[ue]===void 0)throw new Error(`Could not find a KernelValue for ${ue}`);return Ue[ue]}y.exports={lookupKernelValueType:de,kernelValueMaps:oe}},{"./kernel-value/array2":41,"./kernel-value/array3":42,"./kernel-value/array4":43,"./kernel-value/boolean":44,"./kernel-value/dynamic-html-image":45,"./kernel-value/dynamic-html-video":46,"./kernel-value/dynamic-memory-optimized-number-texture":47,"./kernel-value/dynamic-number-texture":48,"./kernel-value/dynamic-single-array":49,"./kernel-value/dynamic-single-array1d-i":50,"./kernel-value/dynamic-single-array2d-i":51,"./kernel-value/dynamic-single-array3d-i":52,"./kernel-value/dynamic-single-input":53,"./kernel-value/dynamic-unsigned-array":54,"./kernel-value/dynamic-unsigned-input":55,"./kernel-value/float":56,"./kernel-value/html-image":57,"./kernel-value/html-video":58,"./kernel-value/integer":60,"./kernel-value/memory-optimized-number-texture":61,"./kernel-value/number-texture":62,"./kernel-value/single-array":63,"./kernel-value/single-array1d-i":64,"./kernel-value/single-array2d-i":65,"./kernel-value/single-array3d-i":66,"./kernel-value/single-input":67,"./kernel-value/unsigned-array":68,"./kernel-value/unsigned-input":69}],40:[function(g,y,N){const{WebGLKernelValue:D}=g("./index"),{Input:F}=g("../../../input");class z extends D{checkSize(k,R){if(!this.kernel.validate)return;const{maxTextureSize:S}=this.kernel.constructor.features;if(k>S||R>S)throw k>R?new Error(`Argument texture width of ${k} larger than maximum size of ${S} for your GPU`):k<R?new Error(`Argument texture height of ${R} larger than maximum size of ${S} for your GPU`):new Error(`Argument texture height and width of ${R} larger than maximum size of ${S} for your GPU`)}setup(){this.requestTexture(),this.setupTexture(),this.defineTexture()}requestTexture(){this.texture=this.onRequestTexture()}defineTexture(){const{context:k}=this;k.activeTexture(this.contextHandle),k.bindTexture(k.TEXTURE_2D,this.texture),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST)}setupTexture(){this.contextHandle=this.onRequestContextHandle(),this.index=this.onRequestIndex(),this.dimensionsId=this.id+"Dim",this.sizeId=this.id+"Size"}getBitRatio(k){if(Array.isArray(k[0]))return this.getBitRatio(k[0]);if(k.constructor===F)return this.getBitRatio(k.value);switch(k.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}destroy(){this.prevArg&&this.prevArg.delete(),this.context.deleteTexture(this.texture)}}y.exports={WebGLKernelArray:z}},{"../../../input":110,"./index":59}],41:[function(g,y,N){const{WebGLKernelValue:D}=g("./index");class F extends D{constructor(P,k){super(P,k),this.uploadValue=P}getSource(P){return this.origin==="constants"?`const vec2 ${this.id} = vec2(${P[0]},${P[1]});
`:`uniform vec2 ${this.id};
`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform2fv(this.id,this.uploadValue=P)}}y.exports={WebGLKernelValueArray2:F}},{"./index":59}],42:[function(g,y,N){const{WebGLKernelValue:D}=g("./index");class F extends D{constructor(P,k){super(P,k),this.uploadValue=P}getSource(P){return this.origin==="constants"?`const vec3 ${this.id} = vec3(${P[0]},${P[1]},${P[2]});
`:`uniform vec3 ${this.id};
`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform3fv(this.id,this.uploadValue=P)}}y.exports={WebGLKernelValueArray3:F}},{"./index":59}],43:[function(g,y,N){const{WebGLKernelValue:D}=g("./index");class F extends D{constructor(P,k){super(P,k),this.uploadValue=P}getSource(P){return this.origin==="constants"?`const vec4 ${this.id} = vec4(${P[0]},${P[1]},${P[2]},${P[3]});
`:`uniform vec4 ${this.id};
`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform4fv(this.id,this.uploadValue=P)}}y.exports={WebGLKernelValueArray4:F}},{"./index":59}],44:[function(g,y,N){g("../../../utils");const{WebGLKernelValue:D}=g("./index");class F extends D{constructor(P,k){super(P,k),this.uploadValue=P}getSource(P){return this.origin==="constants"?`const bool ${this.id} = ${P};
`:`uniform bool ${this.id};
`}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=P)}}y.exports={WebGLKernelValueBoolean:F}},{"../../../utils":114,"./index":59}],45:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueHTMLImage:F}=g("./html-image");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){const{width:R,height:S}=k;this.checkSize(R,S),this.dimensions=[R,S,1],this.textureSize=[R,S],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicHTMLImage:z}},{"../../../utils":114,"./html-image":57}],46:[function(g,y,N){const{WebGLKernelValueDynamicHTMLImage:D}=g("./dynamic-html-image");class F extends D{}y.exports={WebGLKernelValueDynamicHTMLVideo:F}},{"./dynamic-html-image":45}],47:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:F}=g("./memory-optimized-number-texture");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.dimensions=k.dimensions,this.checkSize(k.size[0],k.size[1]),this.textureSize=k.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicMemoryOptimizedNumberTexture:z}},{"../../../utils":114,"./memory-optimized-number-texture":61}],48:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueNumberTexture:F}=g("./number-texture");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.dimensions=k.dimensions,this.checkSize(k.size[0],k.size[1]),this.textureSize=k.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicNumberTexture:z}},{"../../../utils":114,"./number-texture":62}],49:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray:F}=g("./single-array");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.dimensions=D.getDimensions(k,!0),this.textureSize=D.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicSingleArray:z}},{"../../../utils":114,"./single-array":63}],50:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray1DI:F}=g("./single-array1d-i");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.setShape(k),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicSingleArray1DI:z}},{"../../../utils":114,"./single-array1d-i":64}],51:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray2DI:F}=g("./single-array2d-i");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.setShape(k),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicSingleArray2DI:z}},{"../../../utils":114,"./single-array2d-i":65}],52:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray3DI:F}=g("./single-array3d-i");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.setShape(k),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicSingleArray3DI:z}},{"../../../utils":114,"./single-array3d-i":66}],53:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleInput:F}=g("./single-input");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){let[R,S,T]=k.size;this.dimensions=new Int32Array([R||1,S||1,T||1]),this.textureSize=D.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicSingleInput:z}},{"../../../utils":114,"./single-input":67}],54:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueUnsignedArray:F}=g("./unsigned-array");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){this.dimensions=D.getDimensions(k,!0),this.textureSize=D.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const R=this.getTransferArrayType(k);this.preUploadValue=new R(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicUnsignedArray:z}},{"../../../utils":114,"./unsigned-array":68}],55:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueUnsignedInput:F}=g("./unsigned-input");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(k){let[R,S,T]=k.size;this.dimensions=new Int32Array([R||1,S||1,T||1]),this.textureSize=D.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);const G=this.getTransferArrayType(k.value);this.preUploadValue=new G(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGLKernelValueDynamicUnsignedInput:z}},{"../../../utils":114,"./unsigned-input":69}],56:[function(g,y,N){g("../../../utils");const{WebGLKernelValue:D}=g("./index");class F extends D{constructor(P,k){super(P,k),this.uploadValue=P}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(P){return this.origin==="constants"?Number.isInteger(P)?`const float ${this.id} = ${P}.0;
`:`const float ${this.id} = ${P};
`:`uniform float ${this.id};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform1f(this.id,this.uploadValue=P)}}y.exports={WebGLKernelValueFloat:F}},{"../../../utils":114,"./index":59}],57:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R);const{width:S,height:T}=k;this.checkSize(S,T),this.dimensions=[S,T,1],this.textureSize=[S,T],this.uploadValue=k}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,R.RGBA,R.UNSIGNED_BYTE,this.uploadValue=k),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueHTMLImage:z}},{"../../../utils":114,"./array":40}],58:[function(g,y,N){const{WebGLKernelValueHTMLImage:D}=g("./html-image");class F extends D{}y.exports={WebGLKernelValueHTMLVideo:F}},{"./html-image":57}],59:[function(g,y,N){const{utils:D}=g("../../../utils"),{KernelValue:F}=g("../../kernel-value");class z extends F{constructor(k,R){super(k,R),this.dimensionsId=null,this.sizeId=null,this.initialValueConstructor=k.constructor,this.onRequestTexture=R.onRequestTexture,this.onRequestIndex=R.onRequestIndex,this.uploadValue=null,this.textureSize=null,this.bitRatio=null,this.prevArg=null}get id(){return`${this.origin}_${D.sanitizeName(this.name)}`}setup(){}getTransferArrayType(k){if(Array.isArray(k[0]))return this.getTransferArrayType(k[0]);switch(k.constructor){case Array:case Int32Array:case Int16Array:case Int8Array:return Float32Array;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:case Float32Array:case Float64Array:return k.constructor}return console.warn("Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros"),k.constructor}getStringValueHandler(){throw new Error(`"getStringValueHandler" not implemented on ${this.constructor.name}`)}getVariablePrecisionString(){return this.kernel.getVariablePrecisionString(this.textureSize||void 0,this.tactic||void 0)}destroy(){}}y.exports={WebGLKernelValue:z}},{"../../../utils":114,"../../kernel-value":35}],60:[function(g,y,N){g("../../../utils");const{WebGLKernelValue:D}=g("./index");class F extends D{constructor(P,k){super(P,k),this.uploadValue=P}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(P){return this.origin==="constants"?`const int ${this.id} = ${parseInt(P)};
`:`uniform int ${this.id};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=P)}}y.exports={WebGLKernelValueInteger:F}},{"../../../utils":114,"./index":59}],61:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array"),z="Source and destination textures are the same.  Use immutable = true and manually cleanup kernel output texture memory with texture.delete()";class P extends F{constructor(R,S){super(R,S);const[T,G]=R.size;this.checkSize(T,G),this.dimensions=R.dimensions,this.textureSize=R.size,this.uploadValue=R.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;
`}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(R){if(R.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(R.constructor);return}if(this.checkContext&&R.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:S,context:T}=this;if(S.pipeline)if(S.immutable)S.updateTextureArgumentRefs(this,R);else{if(S.texture&&S.texture.texture===R.texture)throw new Error(z);if(S.mappedTextures){const{mappedTextures:G}=S;for(let te=0;te<G.length;te++)if(G[te].texture===R.texture)throw new Error(z)}}T.activeTexture(this.contextHandle),T.bindTexture(T.TEXTURE_2D,this.uploadValue=R.texture),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueMemoryOptimizedNumberTexture:P,sameError:z}},{"../../../utils":114,"./array":40}],62:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array"),{sameError:z}=g("./memory-optimized-number-texture");class P extends F{constructor(R,S){super(R,S);const[T,G]=R.size;this.checkSize(T,G);const{size:te,dimensions:Te}=R;this.bitRatio=this.getBitRatio(R),this.dimensions=Te,this.textureSize=te,this.uploadValue=R.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;
`}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(R){if(R.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(R.constructor);return}if(this.checkContext&&R.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);const{kernel:S,context:T}=this;if(S.pipeline)if(S.immutable)S.updateTextureArgumentRefs(this,R);else{if(S.texture&&S.texture.texture===R.texture)throw new Error(z);if(S.mappedTextures){const{mappedTextures:G}=S;for(let te=0;te<G.length;te++)if(G[te].texture===R.texture)throw new Error(z)}}T.activeTexture(this.contextHandle),T.bindTexture(T.TEXTURE_2D,this.uploadValue=R.texture),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueNumberTexture:P}},{"../../../utils":114,"./array":40,"./memory-optimized-number-texture":61}],63:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=4,this.dimensions=D.getDimensions(k,!0),this.textureSize=D.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return D.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueSingleArray:z}},{"../../../utils":114,"./array":40}],64:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=4,this.setShape(k)}setShape(k){const R=D.getDimensions(k,!0);this.textureSize=D.getMemoryOptimizedFloatTextureSize(R,this.bitRatio),this.dimensions=new Int32Array([R[1],1,1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return D.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flatten2dArrayTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueSingleArray1DI:z}},{"../../../utils":114,"./array":40}],65:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=4,this.setShape(k)}setShape(k){const R=D.getDimensions(k,!0);this.textureSize=D.getMemoryOptimizedFloatTextureSize(R,this.bitRatio),this.dimensions=new Int32Array([R[1],R[2],1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return D.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flatten3dArrayTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueSingleArray2DI:z}},{"../../../utils":114,"./array":40}],66:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=4,this.setShape(k)}setShape(k){const R=D.getDimensions(k,!0);this.textureSize=D.getMemoryOptimizedFloatTextureSize(R,this.bitRatio),this.dimensions=new Int32Array([R[1],R[2],R[3]]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return D.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flatten4dArrayTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueSingleArray3DI:z}},{"../../../utils":114,"./array":40}],67:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=4;let[S,T,G]=k.size;this.dimensions=new Int32Array([S||1,T||1,G||1]),this.textureSize=D.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return D.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}.value, uploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k.value,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueSingleInput:z}},{"../../../utils":114,"./array":40}],68:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=this.getBitRatio(k),this.dimensions=D.getDimensions(k,!0),this.textureSize=D.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(k),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return D.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}, preUploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k,this.preUploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueUnsignedArray:z}},{"../../../utils":114,"./array":40}],69:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("./array");class z extends F{constructor(k,R){super(k,R),this.bitRatio=this.getBitRatio(k);const[S,T,G]=k.size;this.dimensions=new Int32Array([S||1,T||1,G||1]),this.textureSize=D.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(k.value),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return D.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}.value, preUploadValue_${this.name})`])}getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(value.constructor);return}const{context:R}=this;D.flattenTo(k.value,this.preUploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGLKernelValueUnsignedInput:z}},{"../../../utils":114,"./array":40}],70:[function(g,y,N){const{GLKernel:D}=g("../gl/kernel"),{FunctionBuilder:F}=g("../function-builder"),{WebGLFunctionNode:z}=g("./function-node"),{utils:P}=g("../../utils"),k=g("../../plugins/math-random-uniformly-distributed"),{fragmentShader:R}=g("./fragment-shader"),{vertexShader:S}=g("./vertex-shader"),{glKernelString:T}=g("../gl/kernel-string"),{lookupKernelValueType:G}=g("./kernel-value-maps");let te=null,Te=null,ie=null,_e=null,Y=null;const re=[k],be=[],ke={};class rt extends D{static get isSupported(){return te!==null||(this.setupFeatureChecks(),te=this.isContextMatch(ie)),te}static setupFeatureChecks(){typeof document<"u"?Te=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(Te=new OffscreenCanvas(0,0)),Te&&(ie=Te.getContext("webgl")||Te.getContext("experimental-webgl"),!(!ie||!ie.getExtension)&&(_e={OES_texture_float:ie.getExtension("OES_texture_float"),OES_texture_float_linear:ie.getExtension("OES_texture_float_linear"),OES_element_index_uint:ie.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:ie.getExtension("WEBGL_draw_buffers")},Y=this.getFeatures()))}static isContextMatch(Q){return typeof WebGLRenderingContext<"u"?Q instanceof WebGLRenderingContext:!1}static getIsTextureFloat(){return!!_e.OES_texture_float}static getIsDrawBuffers(){return!!_e.WEBGL_draw_buffers}static getChannelCount(){return _e.WEBGL_draw_buffers?ie.getParameter(_e.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return ie.getParameter(ie.MAX_TEXTURE_SIZE)}static lookupKernelValueType(Q,U,Me,Fe){return G(Q,U,Me,Fe)}static get testCanvas(){return Te}static get testContext(){return ie}static get features(){return Y}static get fragmentShader(){return R}static get vertexShader(){return S}constructor(Q,U){super(Q,U),this.program=null,this.pipeline=U.pipeline,this.endianness=P.systemEndianness(),this.extensions={},this.argumentTextureCount=0,this.constantTextureCount=0,this.fragShader=null,this.vertShader=null,this.drawBuffersMap=null,this.maxTexSize=null,this.onRequestSwitchKernel=null,this.texture=null,this.mappedTextures=null,this.mergeSettings(Q.settings||U),this.threadDim=null,this.framebuffer=null,this.buffer=null,this.textureCache=[],this.programUniformLocationCache={},this.uniform1fCache={},this.uniform1iCache={},this.uniform2fCache={},this.uniform2fvCache={},this.uniform2ivCache={},this.uniform3fvCache={},this.uniform3ivCache={},this.uniform4fvCache={},this.uniform4ivCache={}}initCanvas(){if(typeof document<"u"){const Q=document.createElement("canvas");return Q.width=2,Q.height=2,Q}else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0)}initContext(){const Q={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl",Q)||this.canvas.getContext("experimental-webgl",Q)}initPlugins(Q){const U=[],{source:Me}=this;if(typeof Me=="string")for(let Fe=0;Fe<re.length;Fe++){const bt=re[Fe];Me.match(bt.functionMatch)&&U.push(bt)}else if(typeof Me=="object"&&Q.pluginNames)for(let Fe=0;Fe<re.length;Fe++){const bt=re[Fe];Q.pluginNames.some(I=>I===bt.name)&&U.push(bt)}return U}initExtensions(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:this.context.getExtension("WEBGL_color_buffer_float")}}validateSettings(Q){if(!this.validate){this.texSize=P.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);return}const{features:U}=this.constructor;if(this.optimizeFloatMemory===!0&&!U.isTextureFloat)throw new Error("Float textures are not supported");if(this.precision==="single"&&!U.isFloatRead)throw new Error("Single precision not supported");if(!this.graphical&&this.precision===null&&U.isTextureFloat&&(this.precision=U.isFloatRead?"single":"unsigned"),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(this.fixIntegerDivisionAccuracy===null?this.fixIntegerDivisionAccuracy=!U.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&U.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||this.output.length===0){if(Q.length!==1)throw new Error("Auto output only supported for kernels with only one input");const Me=P.getVariableType(Q[0],this.strictIntegers);switch(Me){case"Array":this.output=P.getDimensions(Me);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=Q[0].output;break;default:throw new Error("Auto output not supported for input type: "+Me)}}if(this.graphical){if(this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.precision==="precision"&&(this.precision="unsigned",console.warn("Cannot use graphical mode and single precision at the same time")),this.texSize=P.clone(this.output);return}else this.precision===null&&U.isTextureFloat&&(this.precision="single");this.texSize=P.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}updateMaxTexSize(){const{texSize:Q,canvas:U}=this;if(this.maxTexSize===null){let Me=be.indexOf(U);Me===-1&&(Me=be.length,be.push(U),ke[Me]=[Q[0],Q[1]]),this.maxTexSize=ke[Me]}this.maxTexSize[0]<Q[0]&&(this.maxTexSize[0]=Q[0]),this.maxTexSize[1]<Q[1]&&(this.maxTexSize[1]=Q[1])}setupArguments(Q){this.kernelArguments=[],this.argumentTextureCount=0;const U=this.argumentTypes===null;if(U&&(this.argumentTypes=[]),this.argumentSizes=[],this.argumentBitRatios=[],Q.length<this.argumentNames.length)throw new Error("not enough arguments for kernel");if(Q.length>this.argumentNames.length)throw new Error("too many arguments for kernel");const{context:Me}=this;let Fe=0;const bt=()=>this.createTexture(),v=()=>this.constantTextureCount+Fe++,I=H=>{this.switchKernels({type:"argumentMismatch",needed:H})},M=()=>Me.TEXTURE0+this.constantTextureCount+this.argumentTextureCount++;for(let H=0;H<Q.length;H++){const oe=Q[H],de=this.argumentNames[H];let ue;U?(ue=P.getVariableType(oe,this.strictIntegers),this.argumentTypes.push(ue)):ue=this.argumentTypes[H];const ve=this.constructor.lookupKernelValueType(ue,this.dynamicArguments?"dynamic":"static",this.precision,Q[H]);if(ve===null)return this.requestFallback(Q);const xe=new ve(oe,{name:de,type:ue,tactic:this.tactic,origin:"user",context:Me,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:bt,onRequestIndex:v,onUpdateValueMismatch:I,onRequestContextHandle:M});this.kernelArguments.push(xe),xe.setup(),this.argumentSizes.push(xe.textureSize),this.argumentBitRatios[H]=xe.bitRatio}}createTexture(){const Q=this.context.createTexture();return this.textureCache.push(Q),Q}setupConstants(Q){const{context:U}=this;this.kernelConstants=[],this.forceUploadKernelConstants=[];let Me=this.constantTypes===null;Me&&(this.constantTypes={}),this.constantBitRatios={};let Fe=0;for(const bt in this.constants){const v=this.constants[bt];let I;Me?(I=P.getVariableType(v,this.strictIntegers),this.constantTypes[bt]=I):I=this.constantTypes[bt];const M=this.constructor.lookupKernelValueType(I,"static",this.precision,v);if(M===null)return this.requestFallback(Q);const H=new M(v,{name:bt,type:I,tactic:this.tactic,origin:"constants",context:this.context,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:()=>this.createTexture(),onRequestIndex:()=>Fe++,onRequestContextHandle:()=>U.TEXTURE0+this.constantTextureCount++});this.constantBitRatios[bt]=H.bitRatio,this.kernelConstants.push(H),H.setup(),H.forceUploadEachRun&&this.forceUploadKernelConstants.push(H)}}build(){if(this.built||(this.initExtensions(),this.validateSettings(arguments),this.setupConstants(arguments),this.fallbackRequested)||(this.setupArguments(arguments),this.fallbackRequested))return;this.updateMaxTexSize(),this.translateSource();const Q=this.pickRenderStrategy(arguments);if(Q)return Q;const{texSize:U,context:Me,canvas:Fe}=this;Me.enable(Me.SCISSOR_TEST),this.pipeline&&this.precision==="single"?(Me.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),Fe.width=this.maxTexSize[0],Fe.height=this.maxTexSize[1]):(Me.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),Fe.width=this.maxTexSize[0],Fe.height=this.maxTexSize[1]);const bt=this.threadDim=Array.from(this.output);for(;bt.length<3;)bt.push(1);const v=this.getVertexShader(arguments),I=Me.createShader(Me.VERTEX_SHADER);Me.shaderSource(I,v),Me.compileShader(I),this.vertShader=I;const M=this.getFragmentShader(arguments),H=Me.createShader(Me.FRAGMENT_SHADER);if(Me.shaderSource(H,M),Me.compileShader(H),this.fragShader=H,this.debug&&(console.log("GLSL Shader Output:"),console.log(M)),!Me.getShaderParameter(I,Me.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+Me.getShaderInfoLog(I));if(!Me.getShaderParameter(H,Me.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+Me.getShaderInfoLog(H));const oe=this.program=Me.createProgram();Me.attachShader(oe,I),Me.attachShader(oe,H),Me.linkProgram(oe),this.framebuffer=Me.createFramebuffer(),this.framebuffer.width=U[0],this.framebuffer.height=U[1],this.rawValueFramebuffers={};const de=new Float32Array([-1,-1,1,-1,-1,1,1,1]),ue=new Float32Array([0,0,1,0,0,1,1,1]),ve=de.byteLength;let xe=this.buffer;xe?Me.bindBuffer(Me.ARRAY_BUFFER,xe):(xe=this.buffer=Me.createBuffer(),Me.bindBuffer(Me.ARRAY_BUFFER,xe),Me.bufferData(Me.ARRAY_BUFFER,de.byteLength+ue.byteLength,Me.STATIC_DRAW)),Me.bufferSubData(Me.ARRAY_BUFFER,0,de),Me.bufferSubData(Me.ARRAY_BUFFER,ve,ue);const Re=Me.getAttribLocation(this.program,"aPos");Me.enableVertexAttribArray(Re),Me.vertexAttribPointer(Re,2,Me.FLOAT,!1,0,0);const Ue=Me.getAttribLocation(this.program,"aTexCoord");Me.enableVertexAttribArray(Ue),Me.vertexAttribPointer(Ue,2,Me.FLOAT,!1,0,ve),Me.bindFramebuffer(Me.FRAMEBUFFER,this.framebuffer);let Xe=0;Me.useProgram(this.program);for(let Ae in this.constants)this.kernelConstants[Xe++].updateValue(this.constants[Ae]);this._setupOutputTexture(),this.subKernels!==null&&this.subKernels.length>0&&(this._mappedTextureSwitched={},this._setupSubOutputTextures()),this.buildSignature(arguments),this.built=!0}translateSource(){const Q=F.fromKernel(this,z,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=Q.getPrototypeString("kernel"),this.setupReturnTypes(Q)}setupReturnTypes(Q){if(!this.graphical&&!this.returnType&&(this.returnType=Q.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(let U=0;U<this.subKernels.length;U++){const Me=this.subKernels[U];Me.returnType||(Me.returnType=Q.getSubKernelResultType(U))}}run(){const{kernelArguments:Q,texSize:U,forceUploadKernelConstants:Me,context:Fe}=this;Fe.useProgram(this.program),Fe.scissor(0,0,U[0],U[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",U)),this.setUniform2f("ratio",U[0]/this.maxTexSize[0],U[1]/this.maxTexSize[1]);for(let bt=0;bt<Me.length;bt++){const v=Me[bt];if(v.updateValue(this.constants[v.name]),this.switchingKernels)return}for(let bt=0;bt<Q.length;bt++)if(Q[bt].updateValue(arguments[bt]),this.switchingKernels)return;if(this.plugins)for(let bt=0;bt<this.plugins.length;bt++){const v=this.plugins[bt];v.onBeforeRun&&v.onBeforeRun(this)}if(this.graphical){if(this.pipeline)return Fe.bindRenderbuffer(Fe.RENDERBUFFER,null),Fe.bindFramebuffer(Fe.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),Fe.drawArrays(Fe.TRIANGLE_STRIP,0,4),this.immutable?this.texture.clone():this.texture;Fe.bindRenderbuffer(Fe.RENDERBUFFER,null),Fe.bindFramebuffer(Fe.FRAMEBUFFER,null),Fe.drawArrays(Fe.TRIANGLE_STRIP,0,4);return}Fe.bindFramebuffer(Fe.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),this.subKernels!==null&&(this.immutable&&this._replaceSubOutputTextures(),this.drawBuffers()),Fe.drawArrays(Fe.TRIANGLE_STRIP,0,4)}drawBuffers(){this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)}getInternalFormat(){return this.context.RGBA}getTextureFormat(){const{context:Q}=this;switch(this.getInternalFormat()){case Q.RGBA:return Q.RGBA;default:throw new Error("Unknown internal format")}}_replaceOutputTexture(){if(this.texture.beforeMutate()||this._textureSwitched){const Q=this.context;Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,this.texture.texture,0),this._textureSwitched=!1}}_setupOutputTexture(){const Q=this.context,U=this.texSize;if(this.texture){Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,this.texture.texture,0);return}const Me=this.createTexture();Q.activeTexture(Q.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),Q.bindTexture(Q.TEXTURE_2D,Me),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.NEAREST);const Fe=this.getInternalFormat();this.precision==="single"?Q.texImage2D(Q.TEXTURE_2D,0,Fe,U[0],U[1],0,Q.RGBA,Q.FLOAT,null):Q.texImage2D(Q.TEXTURE_2D,0,Fe,U[0],U[1],0,Fe,Q.UNSIGNED_BYTE,null),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,Me,0),this.texture=new this.TextureConstructor({texture:Me,size:U,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_replaceSubOutputTextures(){const Q=this.context;for(let U=0;U<this.mappedTextures.length;U++){const Me=this.mappedTextures[U];(Me.beforeMutate()||this._mappedTextureSwitched[U])&&(Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0+U+1,Q.TEXTURE_2D,Me.texture,0),this._mappedTextureSwitched[U]=!1)}}_setupSubOutputTextures(){const Q=this.context;if(this.mappedTextures){for(let Me=0;Me<this.subKernels.length;Me++)Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0+Me+1,Q.TEXTURE_2D,this.mappedTextures[Me].texture,0);return}const U=this.texSize;this.drawBuffersMap=[Q.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let Me=0;Me<this.subKernels.length;Me++){const Fe=this.createTexture();this.drawBuffersMap.push(Q.COLOR_ATTACHMENT0+Me+1),Q.activeTexture(Q.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+Me),Q.bindTexture(Q.TEXTURE_2D,Fe),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.NEAREST),this.precision==="single"?Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,U[0],U[1],0,Q.RGBA,Q.FLOAT,null):Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,U[0],U[1],0,Q.RGBA,Q.UNSIGNED_BYTE,null),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0+Me+1,Q.TEXTURE_2D,Fe,0),this.mappedTextures.push(new this.TextureConstructor({texture:Fe,size:U,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}setUniform1f(Q,U){if(this.uniform1fCache.hasOwnProperty(Q)){const Fe=this.uniform1fCache[Q];if(U===Fe)return}this.uniform1fCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform1f(Me,U)}setUniform1i(Q,U){if(this.uniform1iCache.hasOwnProperty(Q)){const Fe=this.uniform1iCache[Q];if(U===Fe)return}this.uniform1iCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform1i(Me,U)}setUniform2f(Q,U,Me){if(this.uniform2fCache.hasOwnProperty(Q)){const bt=this.uniform2fCache[Q];if(U===bt[0]&&Me===bt[1])return}this.uniform2fCache[Q]=[U,Me];const Fe=this.getUniformLocation(Q);this.context.uniform2f(Fe,U,Me)}setUniform2fv(Q,U){if(this.uniform2fvCache.hasOwnProperty(Q)){const Fe=this.uniform2fvCache[Q];if(U[0]===Fe[0]&&U[1]===Fe[1])return}this.uniform2fvCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform2fv(Me,U)}setUniform2iv(Q,U){if(this.uniform2ivCache.hasOwnProperty(Q)){const Fe=this.uniform2ivCache[Q];if(U[0]===Fe[0]&&U[1]===Fe[1])return}this.uniform2ivCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform2iv(Me,U)}setUniform3fv(Q,U){if(this.uniform3fvCache.hasOwnProperty(Q)){const Fe=this.uniform3fvCache[Q];if(U[0]===Fe[0]&&U[1]===Fe[1]&&U[2]===Fe[2])return}this.uniform3fvCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform3fv(Me,U)}setUniform3iv(Q,U){if(this.uniform3ivCache.hasOwnProperty(Q)){const Fe=this.uniform3ivCache[Q];if(U[0]===Fe[0]&&U[1]===Fe[1]&&U[2]===Fe[2])return}this.uniform3ivCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform3iv(Me,U)}setUniform4fv(Q,U){if(this.uniform4fvCache.hasOwnProperty(Q)){const Fe=this.uniform4fvCache[Q];if(U[0]===Fe[0]&&U[1]===Fe[1]&&U[2]===Fe[2]&&U[3]===Fe[3])return}this.uniform4fvCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform4fv(Me,U)}setUniform4iv(Q,U){if(this.uniform4ivCache.hasOwnProperty(Q)){const Fe=this.uniform4ivCache[Q];if(U[0]===Fe[0]&&U[1]===Fe[1]&&U[2]===Fe[2]&&U[3]===Fe[3])return}this.uniform4ivCache[Q]=U;const Me=this.getUniformLocation(Q);this.context.uniform4iv(Me,U)}getUniformLocation(Q){return this.programUniformLocationCache.hasOwnProperty(Q)?this.programUniformLocationCache[Q]:this.programUniformLocationCache[Q]=this.context.getUniformLocation(this.program,Q)}_getFragShaderArtifactMap(Q){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),PLUGINS:this._getPluginsString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),INJECTED_NATIVE:this._getInjectedNative(),MAIN_CONSTANTS:this._getMainConstantsString(),MAIN_ARGUMENTS:this._getMainArgumentsString(Q),KERNEL:this.getKernelString(),MAIN_RESULT:this.getMainResultString(),FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getVertShaderArtifactMap(Q){return{FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getHeaderString(){return this.subKernels!==null?`#extension GL_EXT_draw_buffers : require
`:""}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};
`:` 1000;
`}_getPluginsString(){return this.plugins?this.plugins.map(Q=>Q.source&&this.source.match(Q.functionMatch)?Q.source:"").join(`
`):`
`}_getConstantsString(){const Q=[],{threadDim:U,texSize:Me}=this;return this.dynamicOutput?Q.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"):Q.push(`ivec3 uOutputDim = ivec3(${U[0]}, ${U[1]}, ${U[2]})`,`ivec2 uTexSize = ivec2(${Me[0]}, ${Me[1]})`),P.linesToString(Q)}_getTextureCoordinate(){const Q=this.subKernels;return Q===null||Q.length<1?`varying vec2 vTexCoord;
`:`out vec2 vTexCoord;
`}_getDecode32EndiannessString(){return this.endianness==="LE"?"":`  texel.rgba = texel.abgr;
`}_getEncode32EndiannessString(){return this.endianness==="LE"?"":`  texel.rgba = texel.abgr;
`}_getDivideWithIntegerCheckString(){return this.fixIntegerDivisionAccuracy?`float divWithIntCheck(float x, float y) {
  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {
    return float(int(x) / int(y));
  }
  return x / y;
}

float integerCorrectionModulo(float number, float divisor) {
  if (number < 0.0) {
    number = abs(number);
    if (divisor < 0.0) {
      divisor = abs(divisor);
    }
    return -(number - (divisor * floor(divWithIntCheck(number, divisor))));
  }
  if (divisor < 0.0) {
    divisor = abs(divisor);
  }
  return number - (divisor * floor(divWithIntCheck(number, divisor)));
}`:""}_getMainArgumentsString(Q){const U=[],{argumentNames:Me}=this;for(let Fe=0;Fe<Me.length;Fe++)U.push(this.kernelArguments[Fe].getSource(Q[Fe]));return U.join("")}_getInjectedNative(){return this.injectedNative||""}_getMainConstantsString(){const Q=[],{constants:U}=this;if(U){let Me=0;for(const Fe in U)this.constants.hasOwnProperty(Fe)&&Q.push(this.kernelConstants[Me++].getSource(this.constants[Fe]))}return Q.join("")}getRawValueFramebuffer(Q,U){if(this.rawValueFramebuffers[Q]||(this.rawValueFramebuffers[Q]={}),!this.rawValueFramebuffers[Q][U]){const Me=this.context.createFramebuffer();Me.width=Q,Me.height=U,this.rawValueFramebuffers[Q][U]=Me}return this.rawValueFramebuffers[Q][U]}getKernelResultDeclaration(){switch(this.returnType){case"Array(2)":return"vec2 kernelResult";case"Array(3)":return"vec3 kernelResult";case"Array(4)":return"vec4 kernelResult";case"LiteralInteger":case"Float":case"Number":case"Integer":return"float kernelResult";default:if(this.graphical)return"float kernelResult";throw new Error(`unrecognized output type "${this.returnType}"`)}}getKernelString(){const Q=[this.getKernelResultDeclaration()],{subKernels:U}=this;if(U!==null)switch(this.returnType){case"Number":case"Float":case"Integer":for(let Me=0;Me<U.length;Me++){const Fe=U[Me];Q.push(Fe.returnType==="Integer"?`int subKernelResult_${Fe.name} = 0`:`float subKernelResult_${Fe.name} = 0.0`)}break;case"Array(2)":for(let Me=0;Me<U.length;Me++)Q.push(`vec2 subKernelResult_${U[Me].name}`);break;case"Array(3)":for(let Me=0;Me<U.length;Me++)Q.push(`vec3 subKernelResult_${U[Me].name}`);break;case"Array(4)":for(let Me=0;Me<U.length;Me++)Q.push(`vec4 subKernelResult_${U[Me].name}`);break}return P.linesToString(Q)+this.translatedSource}getMainResultGraphical(){return P.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return P.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const Q=[];if(!this.subKernels)return"";for(let U=0;U<this.subKernels.length;U++)this.subKernels[U].returnType==="Integer"?Q.push(`  gl_FragData[${U+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[U].name}))`):Q.push(`  gl_FragData[${U+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[U].name})`);return P.linesToString(Q)}getMainResultMemoryOptimizedFloats(){const Q=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":const U=["r","g","b","a"];for(let Me=0;Me<U.length;Me++){const Fe=U[Me];this.getMainResultKernelMemoryOptimizedFloats(Q,Fe),this.getMainResultSubKernelMemoryOptimizedFloats(Q,Fe),Me+1<U.length&&Q.push("  index += 1")}break;default:throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`)}return P.linesToString(Q)}getMainResultKernelMemoryOptimizedFloats(Q,U){Q.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0].${U} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(Q,U){if(!this.subKernels)return Q;for(let Me=0;Me<this.subKernels.length;Me++)this.subKernels[Me].returnType==="Integer"?Q.push(`  gl_FragData[${Me+1}].${U} = float(subKernelResult_${this.subKernels[Me].name})`):Q.push(`  gl_FragData[${Me+1}].${U} = subKernelResult_${this.subKernels[Me].name}`)}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const Q=[];if(!this.subKernels)return Q;for(let U=0;U<this.subKernels.length;++U){const Me=this.subKernels[U];Me.returnType==="Integer"?Q.push(`  gl_FragData[${U+1}][0] = float(subKernelResult_${Me.name})`):Q.push(`  gl_FragData[${U+1}][0] = subKernelResult_${Me.name}`)}return Q}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const Q=[];if(!this.subKernels)return Q;for(let U=0;U<this.subKernels.length;++U)Q.push(`  gl_FragData[${U+1}][0] = subKernelResult_${this.subKernels[U].name}[0]`,`  gl_FragData[${U+1}][1] = subKernelResult_${this.subKernels[U].name}[1]`);return Q}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]","  gl_FragData[0][2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const Q=[];if(!this.subKernels)return Q;for(let U=0;U<this.subKernels.length;++U)Q.push(`  gl_FragData[${U+1}][0] = subKernelResult_${this.subKernels[U].name}[0]`,`  gl_FragData[${U+1}][1] = subKernelResult_${this.subKernels[U].name}[1]`,`  gl_FragData[${U+1}][2] = subKernelResult_${this.subKernels[U].name}[2]`);return Q}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = kernelResult"]}getMainResultSubKernelArray4Texture(){const Q=[];if(!this.subKernels)return Q;switch(this.returnType){case"Number":case"Float":case"Integer":for(let U=0;U<this.subKernels.length;++U)this.subKernels[U].returnType==="Integer"?Q.push(`  gl_FragData[${U+1}] = float(subKernelResult_${this.subKernels[U].name})`):Q.push(`  gl_FragData[${U+1}] = subKernelResult_${this.subKernels[U].name}`);break;case"Array(2)":for(let U=0;U<this.subKernels.length;++U)Q.push(`  gl_FragData[${U+1}][0] = subKernelResult_${this.subKernels[U].name}[0]`,`  gl_FragData[${U+1}][1] = subKernelResult_${this.subKernels[U].name}[1]`);break;case"Array(3)":for(let U=0;U<this.subKernels.length;++U)Q.push(`  gl_FragData[${U+1}][0] = subKernelResult_${this.subKernels[U].name}[0]`,`  gl_FragData[${U+1}][1] = subKernelResult_${this.subKernels[U].name}[1]`,`  gl_FragData[${U+1}][2] = subKernelResult_${this.subKernels[U].name}[2]`);break;case"Array(4)":for(let U=0;U<this.subKernels.length;++U)Q.push(`  gl_FragData[${U+1}][0] = subKernelResult_${this.subKernels[U].name}[0]`,`  gl_FragData[${U+1}][1] = subKernelResult_${this.subKernels[U].name}[1]`,`  gl_FragData[${U+1}][2] = subKernelResult_${this.subKernels[U].name}[2]`,`  gl_FragData[${U+1}][3] = subKernelResult_${this.subKernels[U].name}[3]`);break}return Q}replaceArtifacts(Q,U){return Q.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\n/g,(Me,Fe)=>{if(U.hasOwnProperty(Fe))return U[Fe];throw`unhandled artifact ${Fe}`})}getFragmentShader(Q){return this.compiledFragmentShader!==null?this.compiledFragmentShader:this.compiledFragmentShader=this.replaceArtifacts(this.constructor.fragmentShader,this._getFragShaderArtifactMap(Q))}getVertexShader(Q){return this.compiledVertexShader!==null?this.compiledVertexShader:this.compiledVertexShader=this.replaceArtifacts(this.constructor.vertexShader,this._getVertShaderArtifactMap(Q))}toString(){const Q=P.linesToString(["const gl = context"]);return T(this.constructor,arguments,this,Q)}destroy(Q){if(!this.context)return;this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer);for(const Me in this.rawValueFramebuffers){for(const Fe in this.rawValueFramebuffers[Me])this.context.deleteFramebuffer(this.rawValueFramebuffers[Me][Fe]),delete this.rawValueFramebuffers[Me][Fe];delete this.rawValueFramebuffers[Me]}if(this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program),this.texture){this.texture.delete();const Me=this.textureCache.indexOf(this.texture.texture);Me>-1&&this.textureCache.splice(Me,1),this.texture=null}if(this.mappedTextures&&this.mappedTextures.length){for(let Me=0;Me<this.mappedTextures.length;Me++){const Fe=this.mappedTextures[Me];Fe.delete();const bt=this.textureCache.indexOf(Fe.texture);bt>-1&&this.textureCache.splice(bt,1)}this.mappedTextures=null}if(this.kernelArguments)for(let Me=0;Me<this.kernelArguments.length;Me++)this.kernelArguments[Me].destroy();if(this.kernelConstants)for(let Me=0;Me<this.kernelConstants.length;Me++)this.kernelConstants[Me].destroy();for(;this.textureCache.length>0;){const Me=this.textureCache.pop();this.context.deleteTexture(Me)}if(Q){const Me=be.indexOf(this.canvas);Me>=0&&(be[Me]=null,ke[Me]=null)}if(this.destroyExtensions(),delete this.context,delete this.canvas,!this.gpu)return;const U=this.gpu.kernels.indexOf(this);U!==-1&&this.gpu.kernels.splice(U,1)}destroyExtensions(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(Q){const U=Q.getExtension("WEBGL_lose_context");U&&U.loseContext()}toJSON(){const Q=super.toJSON();return Q.functionNodes=F.fromKernel(this,z).toJSON(),Q.settings.threadDim=this.threadDim,Q}}y.exports={WebGLKernel:rt}},{"../../plugins/math-random-uniformly-distributed":112,"../../utils":114,"../function-builder":9,"../gl/kernel":13,"../gl/kernel-string":12,"./fragment-shader":37,"./function-node":38,"./kernel-value-maps":39,"./vertex-shader":71}],71:[function(g,y,N){const D=`__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;

attribute vec2 aPos;
attribute vec2 aTexCoord;

varying vec2 vTexCoord;
uniform vec2 ratio;

void main(void) {
  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);
  vTexCoord = aTexCoord;
}`;y.exports={vertexShader:D}},{}],72:[function(g,y,N){const D=`#version 300 es
__HEADER__;
__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;
__SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;

const int LOOP_MAX = __LOOP_MAX__;

__PLUGINS__;
__CONSTANTS__;

in vec2 vTexCoord;

float atan2(float v1, float v2) {
  if (v1 == 0.0 || v2 == 0.0) return 0.0;
  return atan(v1 / v2);
}

float cbrt(float x) {
  if (x >= 0.0) {
    return pow(x, 1.0 / 3.0);
  } else {
    return -pow(x, 1.0 / 3.0);
  }
}

float expm1(float x) {
  return pow(${Math.E}, x) - 1.0; 
}

float fround(highp float x) {
  return x;
}

float imul(float v1, float v2) {
  return float(int(v1) * int(v2));
}

float log10(float x) {
  return log2(x) * (1.0 / log2(10.0));
}

float log1p(float x) {
  return log(1.0 + x);
}

float _pow(float v1, float v2) {
  if (v2 == 0.0) return 1.0;
  return pow(v1, v2);
}

float _round(float x) {
  return floor(x + 0.5);
}


const int BIT_COUNT = 32;
int modi(int x, int y) {
  return x - y * (x / y);
}

int bitwiseOr(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseXOR(int a, int b) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 || b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseAnd(int a, int b) {
  int result = 0;
  int n = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {
      result += n;
    }
    a = a / 2;
    b = b / 2;
    n = n * 2;
    if(!(a > 0 && b > 0)) {
      break;
    }
  }
  return result;
}
int bitwiseNot(int a) {
  int result = 0;
  int n = 1;
  
  for (int i = 0; i < BIT_COUNT; i++) {
    if (modi(a, 2) == 0) {
      result += n;    
    }
    a = a / 2;
    n = n * 2;
  }
  return result;
}
int bitwiseZeroFillLeftShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n *= 2;
  }

  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

int bitwiseSignedRightShift(int num, int shifts) {
  return int(floor(float(num) / pow(2.0, float(shifts))));
}

int bitwiseZeroFillRightShift(int n, int shift) {
  int maxBytes = BIT_COUNT;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (maxBytes >= n) {
      break;
    }
    maxBytes *= 2;
  }
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= shift) {
      break;
    }
    n /= 2;
  }
  int result = 0;
  int byteVal = 1;
  for (int i = 0; i < BIT_COUNT; i++) {
    if (i >= maxBytes) break;
    if (modi(n, 2) > 0) { result += byteVal; }
    n = int(n / 2);
    byteVal *= 2;
  }
  return result;
}

vec2 integerMod(vec2 x, float y) {
  vec2 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec3 integerMod(vec3 x, float y) {
  vec3 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

vec4 integerMod(vec4 x, vec4 y) {
  vec4 res = floor(mod(x, y));
  return res * step(1.0 - floor(y), -res);
}

float integerMod(float x, float y) {
  float res = floor(mod(x, y));
  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);
}

int integerMod(int x, int y) {
  return x - (y * int(x/y));
}

__DIVIDE_WITH_INTEGER_CHECK__;

// Here be dragons!
// DO NOT OPTIMIZE THIS CODE
// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE
// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME
const vec2 MAGIC_VEC = vec2(1.0, -256.0);
const vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);
const vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536
float decode32(vec4 texel) {
  __DECODE32_ENDIANNESS__;
  texel *= 255.0;
  vec2 gte128;
  gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;
  gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;
  float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);
  float res = exp2(round(exponent));
  texel.b = texel.b - 128.0 * gte128.x;
  res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;
  res *= gte128.y * -2.0 + 1.0;
  return res;
}

float decode16(vec4 texel, int index) {
  int channel = integerMod(index, 2);
  return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;
}

float decode8(vec4 texel, int index) {
  int channel = integerMod(index, 4);
  return texel[channel] * 255.0;
}

vec4 legacyEncode32(float f) {
  float F = abs(f);
  float sign = f < 0.0 ? 1.0 : 0.0;
  float exponent = floor(log2(F));
  float mantissa = (exp2(-exponent) * F);
  // exponent += floor(log2(mantissa));
  vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;
  texel.rg = integerMod(texel.rg, 256.0);
  texel.b = integerMod(texel.b, 128.0);
  texel.a = exponent*0.5 + 63.5;
  texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;
  texel = floor(texel);
  texel *= 0.003921569; // 1/255
  __ENCODE32_ENDIANNESS__;
  return texel;
}

// https://github.com/gpujs/gpu.js/wiki/Encoder-details
vec4 encode32(float value) {
  if (value == 0.0) return vec4(0, 0, 0, 0);

  float exponent;
  float mantissa;
  vec4  result;
  float sgn;

  sgn = step(0.0, -value);
  value = abs(value);

  exponent = floor(log2(value));

  mantissa = value*pow(2.0, -exponent)-1.0;
  exponent = exponent+127.0;
  result   = vec4(0,0,0,0);

  result.a = floor(exponent/2.0);
  exponent = exponent - result.a*2.0;
  result.a = result.a + 128.0*sgn;

  result.b = floor(mantissa * 128.0);
  mantissa = mantissa - result.b / 128.0;
  result.b = result.b + exponent*128.0;

  result.g = floor(mantissa*32768.0);
  mantissa = mantissa - result.g/32768.0;

  result.r = floor(mantissa*8388608.0);
  return result/255.0;
}
// Dragons end here

int index;
ivec3 threadId;

ivec3 indexTo3D(int idx, ivec3 texDim) {
  int z = int(idx / (texDim.x * texDim.y));
  idx -= z * int(texDim.x * texDim.y);
  int y = int(idx / texDim.x);
  int x = int(integerMod(idx, texDim.x));
  return ivec3(x, y, z);
}

float get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize));
  return decode32(texel);
}

float get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int w = texSize.x * 2;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));
  return decode16(texel, index);
}

float get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int w = texSize.x * 4;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));
  return decode8(texel, index);
}

float getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + (texDim.x * (y + (texDim.y * z)));
  int channel = integerMod(index, 4);
  index = index / 4;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  index = index / 4;
  vec4 texel = texture(tex, st / vec2(texSize));
  return texel[channel];
}

vec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  return texture(tex, st / vec2(texSize));
}

vec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  return texture(tex, vec3(st / vec2(texSize), z));
}

float getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return result[0];
}

vec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec2(result[0], result[1]);
}

vec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 2);
  index = index / 2;
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize));
  if (channel == 0) return vec2(texel.r, texel.g);
  if (channel == 1) return vec2(texel.b, texel.a);
  return vec2(0.0, 0.0);
}

vec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  vec4 result = getImage2D(tex, texSize, texDim, z, y, x);
  return vec3(result[0], result[1], result[2]);
}

vec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));
  int vectorIndex = fieldIndex / 4;
  int vectorOffset = fieldIndex - vectorIndex * 4;
  int readY = vectorIndex / texSize.x;
  int readX = vectorIndex - readY * texSize.x;
  vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));

  if (vectorOffset == 0) {
    return tex1.xyz;
  } else if (vectorOffset == 1) {
    return tex1.yzw;
  } else {
    readX++;
    if (readX >= texSize.x) {
      readX = 0;
      readY++;
    }
    vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));
    if (vectorOffset == 2) {
      return vec3(tex1.z, tex1.w, tex2.x);
    } else {
      return vec3(tex1.w, tex2.x, tex2.y);
    }
  }
}

vec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  return getImage2D(tex, texSize, texDim, z, y, x);
}

vec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {
  int index = x + texDim.x * (y + texDim.y * z);
  int channel = integerMod(index, 2);
  int w = texSize.x;
  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;
  vec4 texel = texture(tex, st / vec2(texSize));
  return vec4(texel.r, texel.g, texel.b, texel.a);
}

vec4 actualColor;
void color(float r, float g, float b, float a) {
  actualColor = vec4(r,g,b,a);
}

void color(float r, float g, float b) {
  color(r,g,b,1.0);
}

float modulo(float number, float divisor) {
  if (number < 0.0) {
    number = abs(number);
    if (divisor < 0.0) {
      divisor = abs(divisor);
    }
    return -mod(number, divisor);
  }
  if (divisor < 0.0) {
    divisor = abs(divisor);
  }
  return mod(number, divisor);
}

__INJECTED_NATIVE__;
__MAIN_CONSTANTS__;
__MAIN_ARGUMENTS__;
__KERNEL__;

void main(void) {
  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;
  __MAIN_RESULT__;
}`;y.exports={fragmentShader:D}},{}],73:[function(g,y,N){const{utils:D}=g("../../utils"),{WebGLFunctionNode:F}=g("../web-gl/function-node");class z extends F{astIdentifierExpression(k,R){if(k.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",k);const S=this.getType(k),T=D.sanitizeName(k.name);return k.name==="Infinity"?R.push("intBitsToFloat(2139095039)"):S==="Boolean"?this.argumentNames.indexOf(T)>-1?R.push(`bool(user_${T})`):R.push(`user_${T}`):R.push(`user_${T}`),R}}y.exports={WebGL2FunctionNode:z}},{"../../utils":114,"../web-gl/function-node":38}],74:[function(g,y,N){const{WebGL2KernelValueBoolean:D}=g("./kernel-value/boolean"),{WebGL2KernelValueFloat:F}=g("./kernel-value/float"),{WebGL2KernelValueInteger:z}=g("./kernel-value/integer"),{WebGL2KernelValueHTMLImage:P}=g("./kernel-value/html-image"),{WebGL2KernelValueDynamicHTMLImage:k}=g("./kernel-value/dynamic-html-image"),{WebGL2KernelValueHTMLImageArray:R}=g("./kernel-value/html-image-array"),{WebGL2KernelValueDynamicHTMLImageArray:S}=g("./kernel-value/dynamic-html-image-array"),{WebGL2KernelValueHTMLVideo:T}=g("./kernel-value/html-video"),{WebGL2KernelValueDynamicHTMLVideo:G}=g("./kernel-value/dynamic-html-video"),{WebGL2KernelValueSingleInput:te}=g("./kernel-value/single-input"),{WebGL2KernelValueDynamicSingleInput:Te}=g("./kernel-value/dynamic-single-input"),{WebGL2KernelValueUnsignedInput:ie}=g("./kernel-value/unsigned-input"),{WebGL2KernelValueDynamicUnsignedInput:_e}=g("./kernel-value/dynamic-unsigned-input"),{WebGL2KernelValueMemoryOptimizedNumberTexture:Y}=g("./kernel-value/memory-optimized-number-texture"),{WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:re}=g("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGL2KernelValueNumberTexture:be}=g("./kernel-value/number-texture"),{WebGL2KernelValueDynamicNumberTexture:ke}=g("./kernel-value/dynamic-number-texture"),{WebGL2KernelValueSingleArray:rt}=g("./kernel-value/single-array"),{WebGL2KernelValueDynamicSingleArray:vt}=g("./kernel-value/dynamic-single-array"),{WebGL2KernelValueSingleArray1DI:Q}=g("./kernel-value/single-array1d-i"),{WebGL2KernelValueDynamicSingleArray1DI:U}=g("./kernel-value/dynamic-single-array1d-i"),{WebGL2KernelValueSingleArray2DI:Me}=g("./kernel-value/single-array2d-i"),{WebGL2KernelValueDynamicSingleArray2DI:Fe}=g("./kernel-value/dynamic-single-array2d-i"),{WebGL2KernelValueSingleArray3DI:bt}=g("./kernel-value/single-array3d-i"),{WebGL2KernelValueDynamicSingleArray3DI:v}=g("./kernel-value/dynamic-single-array3d-i"),{WebGL2KernelValueArray2:I}=g("./kernel-value/array2"),{WebGL2KernelValueArray3:M}=g("./kernel-value/array3"),{WebGL2KernelValueArray4:H}=g("./kernel-value/array4"),{WebGL2KernelValueUnsignedArray:oe}=g("./kernel-value/unsigned-array"),{WebGL2KernelValueDynamicUnsignedArray:de}=g("./kernel-value/dynamic-unsigned-array"),ue={unsigned:{dynamic:{Boolean:D,Integer:z,Float:F,Array:de,"Array(2)":I,"Array(3)":M,"Array(4)":H,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:_e,NumberTexture:ke,"ArrayTexture(1)":ke,"ArrayTexture(2)":ke,"ArrayTexture(3)":ke,"ArrayTexture(4)":ke,MemoryOptimizedNumberTexture:re,HTMLCanvas:k,OffscreenCanvas:k,HTMLImage:k,ImageBitmap:k,ImageData:k,HTMLImageArray:S,HTMLVideo:G},static:{Boolean:D,Float:F,Integer:z,Array:oe,"Array(2)":I,"Array(3)":M,"Array(4)":H,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:ie,NumberTexture:be,"ArrayTexture(1)":be,"ArrayTexture(2)":be,"ArrayTexture(3)":be,"ArrayTexture(4)":be,MemoryOptimizedNumberTexture:re,HTMLCanvas:P,OffscreenCanvas:P,HTMLImage:P,ImageBitmap:P,ImageData:P,HTMLImageArray:R,HTMLVideo:T}},single:{dynamic:{Boolean:D,Integer:z,Float:F,Array:vt,"Array(2)":I,"Array(3)":M,"Array(4)":H,"Array1D(2)":U,"Array1D(3)":U,"Array1D(4)":U,"Array2D(2)":Fe,"Array2D(3)":Fe,"Array2D(4)":Fe,"Array3D(2)":v,"Array3D(3)":v,"Array3D(4)":v,Input:Te,NumberTexture:ke,"ArrayTexture(1)":ke,"ArrayTexture(2)":ke,"ArrayTexture(3)":ke,"ArrayTexture(4)":ke,MemoryOptimizedNumberTexture:re,HTMLCanvas:k,OffscreenCanvas:k,HTMLImage:k,ImageBitmap:k,ImageData:k,HTMLImageArray:S,HTMLVideo:G},static:{Boolean:D,Float:F,Integer:z,Array:rt,"Array(2)":I,"Array(3)":M,"Array(4)":H,"Array1D(2)":Q,"Array1D(3)":Q,"Array1D(4)":Q,"Array2D(2)":Me,"Array2D(3)":Me,"Array2D(4)":Me,"Array3D(2)":bt,"Array3D(3)":bt,"Array3D(4)":bt,Input:te,NumberTexture:be,"ArrayTexture(1)":be,"ArrayTexture(2)":be,"ArrayTexture(3)":be,"ArrayTexture(4)":be,MemoryOptimizedNumberTexture:Y,HTMLCanvas:P,OffscreenCanvas:P,HTMLImage:P,ImageBitmap:P,ImageData:P,HTMLImageArray:R,HTMLVideo:T}}};function ve(xe,Re,Ue,Xe){if(!xe)throw new Error("type missing");if(!Re)throw new Error("dynamic missing");if(!Ue)throw new Error("precision missing");Xe.type&&(xe=Xe.type);const Ae=ue[Ue][Re];if(Ae[xe]===!1)return null;if(Ae[xe]===void 0)throw new Error(`Could not find a KernelValue for ${xe}`);return Ae[xe]}y.exports={kernelValueMaps:ue,lookupKernelValueType:ve}},{"./kernel-value/array2":75,"./kernel-value/array3":76,"./kernel-value/array4":77,"./kernel-value/boolean":78,"./kernel-value/dynamic-html-image":80,"./kernel-value/dynamic-html-image-array":79,"./kernel-value/dynamic-html-video":81,"./kernel-value/dynamic-memory-optimized-number-texture":82,"./kernel-value/dynamic-number-texture":83,"./kernel-value/dynamic-single-array":84,"./kernel-value/dynamic-single-array1d-i":85,"./kernel-value/dynamic-single-array2d-i":86,"./kernel-value/dynamic-single-array3d-i":87,"./kernel-value/dynamic-single-input":88,"./kernel-value/dynamic-unsigned-array":89,"./kernel-value/dynamic-unsigned-input":90,"./kernel-value/float":91,"./kernel-value/html-image":93,"./kernel-value/html-image-array":92,"./kernel-value/html-video":94,"./kernel-value/integer":95,"./kernel-value/memory-optimized-number-texture":96,"./kernel-value/number-texture":97,"./kernel-value/single-array":98,"./kernel-value/single-array1d-i":99,"./kernel-value/single-array2d-i":100,"./kernel-value/single-array3d-i":101,"./kernel-value/single-input":102,"./kernel-value/unsigned-array":103,"./kernel-value/unsigned-input":104}],75:[function(g,y,N){const{WebGLKernelValueArray2:D}=g("../../web-gl/kernel-value/array2");class F extends D{}y.exports={WebGL2KernelValueArray2:F}},{"../../web-gl/kernel-value/array2":41}],76:[function(g,y,N){const{WebGLKernelValueArray3:D}=g("../../web-gl/kernel-value/array3");class F extends D{}y.exports={WebGL2KernelValueArray3:F}},{"../../web-gl/kernel-value/array3":42}],77:[function(g,y,N){const{WebGLKernelValueArray4:D}=g("../../web-gl/kernel-value/array4");class F extends D{}y.exports={WebGL2KernelValueArray4:F}},{"../../web-gl/kernel-value/array4":43}],78:[function(g,y,N){const{WebGLKernelValueBoolean:D}=g("../../web-gl/kernel-value/boolean");class F extends D{}y.exports={WebGL2KernelValueBoolean:F}},{"../../web-gl/kernel-value/boolean":44}],79:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGL2KernelValueHTMLImageArray:F}=g("./html-image-array");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2DArray ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}updateValue(k){const{width:R,height:S}=k[0];this.checkSize(R,S),this.dimensions=[R,S,k.length],this.textureSize=[R,S],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGL2KernelValueDynamicHTMLImageArray:z}},{"../../../utils":114,"./html-image-array":92}],80:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueDynamicHTMLImage:F}=g("../../web-gl/kernel-value/dynamic-html-image");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}}y.exports={WebGL2KernelValueDynamicHTMLImage:z}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-html-image":45}],81:[function(g,y,N){g("../../../utils");const{WebGL2KernelValueDynamicHTMLImage:D}=g("./dynamic-html-image");class F extends D{}y.exports={WebGL2KernelValueDynamicHTMLVideo:F}},{"../../../utils":114,"./dynamic-html-image":80}],82:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:F}=g("../../web-gl/kernel-value/dynamic-memory-optimized-number-texture");class z extends F{getSource(){return D.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}}y.exports={WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:z}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-memory-optimized-number-texture":47}],83:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueDynamicNumberTexture:F}=g("../../web-gl/kernel-value/dynamic-number-texture");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}}y.exports={WebGL2KernelValueDynamicNumberTexture:z}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-number-texture":48}],84:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGL2KernelValueSingleArray:F}=g("../../web-gl2/kernel-value/single-array");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}updateValue(k){this.dimensions=D.getDimensions(k,!0),this.textureSize=D.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGL2KernelValueDynamicSingleArray:z}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array":98}],85:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGL2KernelValueSingleArray1DI:F}=g("../../web-gl2/kernel-value/single-array1d-i");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}updateValue(k){this.setShape(k),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGL2KernelValueDynamicSingleArray1DI:z}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array1d-i":99}],86:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGL2KernelValueSingleArray2DI:F}=g("../../web-gl2/kernel-value/single-array2d-i");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}updateValue(k){this.setShape(k),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGL2KernelValueDynamicSingleArray2DI:z}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array2d-i":100}],87:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGL2KernelValueSingleArray3DI:F}=g("../../web-gl2/kernel-value/single-array3d-i");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}updateValue(k){this.setShape(k),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGL2KernelValueDynamicSingleArray3DI:z}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array3d-i":101}],88:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGL2KernelValueSingleInput:F}=g("../../web-gl2/kernel-value/single-input");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}updateValue(k){let[R,S,T]=k.size;this.dimensions=new Int32Array([R||1,S||1,T||1]),this.textureSize=D.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(k)}}y.exports={WebGL2KernelValueDynamicSingleInput:z}},{"../../../utils":114,"../../web-gl2/kernel-value/single-input":102}],89:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueDynamicUnsignedArray:F}=g("../../web-gl/kernel-value/dynamic-unsigned-array");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}}y.exports={WebGL2KernelValueDynamicUnsignedArray:z}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-array":54}],90:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueDynamicUnsignedInput:F}=g("../../web-gl/kernel-value/dynamic-unsigned-input");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`uniform ${k} ivec2 ${this.sizeId}`,`uniform ${k} ivec3 ${this.dimensionsId}`])}}y.exports={WebGL2KernelValueDynamicUnsignedInput:z}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-input":55}],91:[function(g,y,N){g("../../../utils");const{WebGLKernelValueFloat:D}=g("../../web-gl/kernel-value/float");class F extends D{}y.exports={WebGL2KernelValueFloat:F}},{"../../../utils":114,"../../web-gl/kernel-value/float":56}],92:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelArray:F}=g("../../web-gl/kernel-value/array");class z extends F{constructor(k,R){super(k,R),this.checkSize(k[0].width,k[0].height),this.dimensions=[k[0].width,k[0].height,k.length],this.textureSize=[k[0].width,k[0].height]}defineTexture(){const{context:k}=this;k.activeTexture(this.contextHandle),k.bindTexture(k.TEXTURE_2D_ARRAY,this.texture),k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MIN_FILTER,k.NEAREST)}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};
`}getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2DArray ${this.id}`,`${k} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${k} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){const{context:R}=this;R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D_ARRAY,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!0),R.texImage3D(R.TEXTURE_2D_ARRAY,0,R.RGBA,k[0].width,k[0].height,k.length,0,R.RGBA,R.UNSIGNED_BYTE,null);for(let S=0;S<k.length;S++)R.texSubImage3D(R.TEXTURE_2D_ARRAY,0,0,0,S,k[S].width,k[S].height,1,R.RGBA,R.UNSIGNED_BYTE,this.uploadValue=k[S]);this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGL2KernelValueHTMLImageArray:z}},{"../../../utils":114,"../../web-gl/kernel-value/array":40}],93:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueHTMLImage:F}=g("../../web-gl/kernel-value/html-image");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`${k} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${k} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}y.exports={WebGL2KernelValueHTMLImage:z}},{"../../../utils":114,"../../web-gl/kernel-value/html-image":57}],94:[function(g,y,N){g("../../../utils");const{WebGL2KernelValueHTMLImage:D}=g("./html-image");class F extends D{}y.exports={WebGL2KernelValueHTMLVideo:F}},{"../../../utils":114,"./html-image":93}],95:[function(g,y,N){const{WebGLKernelValueInteger:D}=g("../../web-gl/kernel-value/integer");class F extends D{getSource(P){const k=this.getVariablePrecisionString();return this.origin==="constants"?`const ${k} int ${this.id} = ${parseInt(P)};
`:`uniform ${k} int ${this.id};
`}updateValue(P){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=P)}}y.exports={WebGL2KernelValueInteger:F}},{"../../web-gl/kernel-value/integer":60}],96:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:F}=g("../../web-gl/kernel-value/memory-optimized-number-texture");class z extends F{getSource(){const{id:k,sizeId:R,textureSize:S,dimensionsId:T,dimensions:G}=this,te=this.getVariablePrecisionString();return D.linesToString([`uniform sampler2D ${k}`,`${te} ivec2 ${R} = ivec2(${S[0]}, ${S[1]})`,`${te} ivec3 ${T} = ivec3(${G[0]}, ${G[1]}, ${G[2]})`])}}y.exports={WebGL2KernelValueMemoryOptimizedNumberTexture:z}},{"../../../utils":114,"../../web-gl/kernel-value/memory-optimized-number-texture":61}],97:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueNumberTexture:F}=g("../../web-gl/kernel-value/number-texture");class z extends F{getSource(){const{id:k,sizeId:R,textureSize:S,dimensionsId:T,dimensions:G}=this,te=this.getVariablePrecisionString();return D.linesToString([`uniform ${te} sampler2D ${k}`,`${te} ivec2 ${R} = ivec2(${S[0]}, ${S[1]})`,`${te} ivec3 ${T} = ivec3(${G[0]}, ${G[1]}, ${G[2]})`])}}y.exports={WebGL2KernelValueNumberTexture:z}},{"../../../utils":114,"../../web-gl/kernel-value/number-texture":62}],98:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray:F}=g("../../web-gl/kernel-value/single-array");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`${k} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${k} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA32F,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGL2KernelValueSingleArray:z}},{"../../../utils":114,"../../web-gl/kernel-value/single-array":63}],99:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray1DI:F}=g("../../web-gl/kernel-value/single-array1d-i");class z extends F{updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA32F,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGL2KernelValueSingleArray1DI:z}},{"../../../utils":114,"../../web-gl/kernel-value/single-array1d-i":64}],100:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray2DI:F}=g("../../web-gl/kernel-value/single-array2d-i");class z extends F{updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA32F,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGL2KernelValueSingleArray2DI:z}},{"../../../utils":114,"../../web-gl/kernel-value/single-array2d-i":65}],101:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleArray3DI:F}=g("../../web-gl/kernel-value/single-array3d-i");class z extends F{updateValue(k){if(k.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(k.constructor);return}const{context:R}=this;D.flattenTo(k,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA32F,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGL2KernelValueSingleArray3DI:z}},{"../../../utils":114,"../../web-gl/kernel-value/single-array3d-i":66}],102:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueSingleInput:F}=g("../../web-gl/kernel-value/single-input");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`${k} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${k} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(k){const{context:R}=this;D.flattenTo(k.value,this.uploadValue),R.activeTexture(this.contextHandle),R.bindTexture(R.TEXTURE_2D,this.texture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,!1),R.texImage2D(R.TEXTURE_2D,0,R.RGBA32F,this.textureSize[0],this.textureSize[1],0,R.RGBA,R.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}y.exports={WebGL2KernelValueSingleInput:z}},{"../../../utils":114,"../../web-gl/kernel-value/single-input":67}],103:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueUnsignedArray:F}=g("../../web-gl/kernel-value/unsigned-array");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`${k} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${k} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}y.exports={WebGL2KernelValueUnsignedArray:z}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-array":68}],104:[function(g,y,N){const{utils:D}=g("../../../utils"),{WebGLKernelValueUnsignedInput:F}=g("../../web-gl/kernel-value/unsigned-input");class z extends F{getSource(){const k=this.getVariablePrecisionString();return D.linesToString([`uniform ${k} sampler2D ${this.id}`,`${k} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${k} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}y.exports={WebGL2KernelValueUnsignedInput:z}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-input":69}],105:[function(g,y,N){const{WebGLKernel:D}=g("../web-gl/kernel"),{WebGL2FunctionNode:F}=g("./function-node"),{FunctionBuilder:z}=g("../function-builder"),{utils:P}=g("../../utils"),{fragmentShader:k}=g("./fragment-shader"),{vertexShader:R}=g("./vertex-shader"),{lookupKernelValueType:S}=g("./kernel-value-maps");let T=null,G=null,te=null,Te=null;class ie extends D{static get isSupported(){return T!==null||(this.setupFeatureChecks(),T=this.isContextMatch(te)),T}static setupFeatureChecks(){typeof document<"u"?G=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(G=new OffscreenCanvas(0,0)),G&&(te=G.getContext("webgl2"),!(!te||!te.getExtension)&&(te.getExtension("EXT_color_buffer_float"),te.getExtension("OES_texture_float_linear"),Te=this.getFeatures()))}static isContextMatch(Y){return typeof WebGL2RenderingContext<"u"?Y instanceof WebGL2RenderingContext:!1}static getFeatures(){const Y=this.testContext;return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),kernelMap:!0,isTextureFloat:!0,isDrawBuffers:!0,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.LOW_INT),lowFloatPrecision:Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.LOW_FLOAT),mediumIntPrecision:Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.MEDIUM_INT),mediumFloatPrecision:Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.MEDIUM_FLOAT),highIntPrecision:Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.HIGH_INT),highFloatPrecision:Y.getShaderPrecisionFormat(Y.FRAGMENT_SHADER,Y.HIGH_FLOAT)})}static getIsTextureFloat(){return!0}static getChannelCount(){return te.getParameter(te.MAX_DRAW_BUFFERS)}static getMaxTextureSize(){return te.getParameter(te.MAX_TEXTURE_SIZE)}static lookupKernelValueType(Y,re,be,ke){return S(Y,re,be,ke)}static get testCanvas(){return G}static get testContext(){return te}static get features(){return Te}static get fragmentShader(){return k}static get vertexShader(){return R}initContext(){const Y={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl2",Y)}initExtensions(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}validateSettings(Y){if(!this.validate){this.texSize=P.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);return}const{features:re}=this.constructor;if(this.precision==="single"&&!re.isFloatRead)throw new Error("Float texture outputs are not supported");if(!this.graphical&&this.precision===null&&(this.precision=re.isFloatRead?"single":"unsigned"),this.fixIntegerDivisionAccuracy===null?this.fixIntegerDivisionAccuracy=!re.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&re.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||this.output.length===0){if(Y.length!==1)throw new Error("Auto output only supported for kernels with only one input");const be=P.getVariableType(Y[0],this.strictIntegers);switch(be){case"Array":this.output=P.getDimensions(be);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=Y[0].output;break;default:throw new Error("Auto output not supported for input type: "+be)}}if(this.graphical){if(this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.precision==="single"&&(console.warn("Cannot use graphical mode and single precision at the same time"),this.precision="unsigned"),this.texSize=P.clone(this.output);return}else!this.graphical&&this.precision===null&&re.isTextureFloat&&(this.precision="single");this.texSize=P.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}translateSource(){const Y=z.fromKernel(this,F,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=Y.getPrototypeString("kernel"),this.setupReturnTypes(Y)}drawBuffers(){this.context.drawBuffers(this.drawBuffersMap)}getTextureFormat(){const{context:Y}=this;switch(this.getInternalFormat()){case Y.R32F:return Y.RED;case Y.RG32F:return Y.RG;case Y.RGBA32F:return Y.RGBA;case Y.RGBA:return Y.RGBA;default:throw new Error("Unknown internal format")}}getInternalFormat(){const{context:Y}=this;if(this.precision==="single"){if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":return this.optimizeFloatMemory?Y.RGBA32F:Y.R32F;case"Array(2)":return Y.RG32F;case"Array(3)":case"Array(4)":return Y.RGBA32F;default:throw new Error("Unhandled return type")}return Y.RGBA32F}return Y.RGBA}_setupOutputTexture(){const Y=this.context;if(this.texture){Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,this.texture.texture,0);return}Y.bindFramebuffer(Y.FRAMEBUFFER,this.framebuffer);const re=Y.createTexture(),be=this.texSize;Y.activeTexture(Y.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),Y.bindTexture(Y.TEXTURE_2D,re),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.REPEAT),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.REPEAT),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.NEAREST),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.NEAREST);const ke=this.getInternalFormat();this.precision==="single"?Y.texStorage2D(Y.TEXTURE_2D,1,ke,be[0],be[1]):Y.texImage2D(Y.TEXTURE_2D,0,ke,be[0],be[1],0,ke,Y.UNSIGNED_BYTE,null),Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,re,0),this.texture=new this.TextureConstructor({texture:re,size:be,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_setupSubOutputTextures(){const Y=this.context;if(this.mappedTextures){for(let be=0;be<this.subKernels.length;be++)Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0+be+1,Y.TEXTURE_2D,this.mappedTextures[be].texture,0);return}const re=this.texSize;this.drawBuffersMap=[Y.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let be=0;be<this.subKernels.length;be++){const ke=this.createTexture();this.drawBuffersMap.push(Y.COLOR_ATTACHMENT0+be+1),Y.activeTexture(Y.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+be),Y.bindTexture(Y.TEXTURE_2D,ke),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.NEAREST),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.NEAREST);const rt=this.getInternalFormat();this.precision==="single"?Y.texStorage2D(Y.TEXTURE_2D,1,rt,re[0],re[1]):Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,re[0],re[1],0,Y.RGBA,Y.UNSIGNED_BYTE,null),Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0+be+1,Y.TEXTURE_2D,ke,0),this.mappedTextures.push(new this.TextureConstructor({texture:ke,size:re,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}_getHeaderString(){return""}_getTextureCoordinate(){const Y=this.subKernels,re=this.getVariablePrecisionString(this.texSize,this.tactic);return Y===null||Y.length<1?`in ${re} vec2 vTexCoord;
`:`out ${re} vec2 vTexCoord;
`}_getMainArgumentsString(Y){const re=[],be=this.argumentNames;for(let ke=0;ke<be.length;ke++)re.push(this.kernelArguments[ke].getSource(Y[ke]));return re.join("")}getKernelString(){const Y=[this.getKernelResultDeclaration()],re=this.subKernels;if(re!==null)switch(Y.push("layout(location = 0) out vec4 data0"),this.returnType){case"Number":case"Float":case"Integer":for(let be=0;be<re.length;be++){const ke=re[be];Y.push(ke.returnType==="Integer"?`int subKernelResult_${ke.name} = 0`:`float subKernelResult_${ke.name} = 0.0`,`layout(location = ${be+1}) out vec4 data${be+1}`)}break;case"Array(2)":for(let be=0;be<re.length;be++)Y.push(`vec2 subKernelResult_${re[be].name}`,`layout(location = ${be+1}) out vec4 data${be+1}`);break;case"Array(3)":for(let be=0;be<re.length;be++)Y.push(`vec3 subKernelResult_${re[be].name}`,`layout(location = ${be+1}) out vec4 data${be+1}`);break;case"Array(4)":for(let be=0;be<re.length;be++)Y.push(`vec4 subKernelResult_${re[be].name}`,`layout(location = ${be+1}) out vec4 data${be+1}`);break}else Y.push("out vec4 data0");return P.linesToString(Y)+this.translatedSource}getMainResultGraphical(){return P.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return P.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0 = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){const Y=[];if(!this.subKernels)return"";for(let re=0;re<this.subKernels.length;re++)this.subKernels[re].returnType==="Integer"?Y.push(`  data${re+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[re].name}))`):Y.push(`  data${re+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[re].name})`);return P.linesToString(Y)}getMainResultKernelMemoryOptimizedFloats(Y,re){Y.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0.${re} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(Y,re){if(!this.subKernels)return Y;for(let be=0;be<this.subKernels.length;be++){const ke=this.subKernels[be];ke.returnType==="Integer"?Y.push(`  data${be+1}.${re} = float(subKernelResult_${ke.name})`):Y.push(`  data${be+1}.${re} = subKernelResult_${ke.name}`)}}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult"]}getMainResultSubKernelNumberTexture(){const Y=[];if(!this.subKernels)return Y;for(let re=0;re<this.subKernels.length;++re){const be=this.subKernels[re];be.returnType==="Integer"?Y.push(`  data${re+1}[0] = float(subKernelResult_${be.name})`):Y.push(`  data${re+1}[0] = subKernelResult_${be.name}`)}return Y}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){const Y=[];if(!this.subKernels)return Y;for(let re=0;re<this.subKernels.length;++re){const be=this.subKernels[re];Y.push(`  data${re+1}[0] = subKernelResult_${be.name}[0]`,`  data${re+1}[1] = subKernelResult_${be.name}[1]`)}return Y}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]","  data0[2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){const Y=[];if(!this.subKernels)return Y;for(let re=0;re<this.subKernels.length;++re){const be=this.subKernels[re];Y.push(`  data${re+1}[0] = subKernelResult_${be.name}[0]`,`  data${re+1}[1] = subKernelResult_${be.name}[1]`,`  data${re+1}[2] = subKernelResult_${be.name}[2]`)}return Y}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = kernelResult"]}getMainResultSubKernelArray4Texture(){const Y=[];if(!this.subKernels)return Y;for(let re=0;re<this.subKernels.length;++re)Y.push(`  data${re+1} = subKernelResult_${this.subKernels[re].name}`);return Y}destroyExtensions(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}toJSON(){const Y=super.toJSON();return Y.functionNodes=z.fromKernel(this,F).toJSON(),Y.settings.threadDim=this.threadDim,Y}}y.exports={WebGL2Kernel:ie}},{"../../utils":114,"../function-builder":9,"../web-gl/kernel":70,"./fragment-shader":72,"./function-node":73,"./kernel-value-maps":74,"./vertex-shader":106}],106:[function(g,y,N){const D=`#version 300 es
__FLOAT_TACTIC_DECLARATION__;
__INT_TACTIC_DECLARATION__;
__SAMPLER_2D_TACTIC_DECLARATION__;

in vec2 aPos;
in vec2 aTexCoord;

out vec2 vTexCoord;
uniform vec2 ratio;

void main(void) {
  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);
  vTexCoord = aTexCoord;
}`;y.exports={vertexShader:D}},{}],107:[function(g,y,N){const D=g("./index"),F=D.GPU;for(const P in D)D.hasOwnProperty(P)&&P!=="GPU"&&(F[P]=D[P]);typeof window<"u"&&z(window),typeof self<"u"&&z(self);function z(P){P.GPU||Object.defineProperty(P,"GPU",{get(){return F}})}y.exports=D},{"./index":109}],108:[function(g,y,N){const{gpuMock:D}=g("gpu-mock.js"),{utils:F}=g("./utils");g("./backend/kernel");const{CPUKernel:z}=g("./backend/cpu/kernel"),{HeadlessGLKernel:P}=g("./backend/headless-gl/kernel"),{WebGL2Kernel:k}=g("./backend/web-gl2/kernel"),{WebGLKernel:R}=g("./backend/web-gl/kernel"),{kernelRunShortcut:S}=g("./kernel-run-shortcut"),T=[P,k,R],G=["gpu","cpu"],te={headlessgl:P,webgl2:k,webgl:R};let Te=!0;class ie{static disableValidation(){Te=!1}static enableValidation(){Te=!0}static get isGPUSupported(){return T.some(re=>re.isSupported)}static get isKernelMapSupported(){return T.some(re=>re.isSupported&&re.features.kernelMap)}static get isOffscreenCanvasSupported(){return typeof Worker<"u"&&typeof OffscreenCanvas<"u"||typeof importScripts<"u"}static get isWebGLSupported(){return R.isSupported}static get isWebGL2Supported(){return k.isSupported}static get isHeadlessGLSupported(){return P.isSupported}static get isCanvasSupported(){return typeof HTMLCanvasElement<"u"}static get isGPUHTMLImageArraySupported(){return k.isSupported}static get isSinglePrecisionSupported(){return T.some(re=>re.isSupported&&re.features.isFloatRead&&re.features.isTextureFloat)}constructor(re){if(re=re||{},this.canvas=re.canvas||null,this.context=re.context||null,this.mode=re.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions=[],this.injectedNative=null,this.mode!=="dev"){if(this.chooseKernel(),re.functions)for(let be=0;be<re.functions.length;be++)this.addFunction(re.functions[be]);if(re.nativeFunctions)for(const be in re.nativeFunctions){if(!re.nativeFunctions.hasOwnProperty(be))continue;const ke=re.nativeFunctions[be],{name:rt,source:vt}=ke;this.addNativeFunction(rt,vt,ke)}}}chooseKernel(){if(this.Kernel)return;let re=null;if(this.context){for(let be=0;be<T.length;be++){const ke=T[be];if(ke.isContextMatch(this.context)){if(!ke.isSupported)throw new Error(`Kernel type ${ke.name} not supported`);re=ke;break}}if(re===null)throw new Error("unknown Context")}else if(this.mode){if(this.mode in te)(!Te||te[this.mode].isSupported)&&(re=te[this.mode]);else if(this.mode==="gpu"){for(let be=0;be<T.length;be++)if(T[be].isSupported){re=T[be];break}}else this.mode==="cpu"&&(re=z);if(!re)throw new Error(`A requested mode of "${this.mode}" and is not supported`)}else{for(let be=0;be<T.length;be++)if(T[be].isSupported){re=T[be];break}re||(re=z)}this.mode||(this.mode=re.mode),this.Kernel=re}createKernel(re,be){if(typeof re>"u")throw new Error("Missing source parameter");if(typeof re!="object"&&!F.isFunction(re)&&typeof re!="string")throw new Error("source parameter not a function");const ke=this.kernels;if(this.mode==="dev"){const v=D(re,_e(be));return ke.push(v),v}re=typeof re=="function"?re.toString():re;const rt={},vt=_e(be)||{};be&&typeof be.argumentTypes=="object"&&(vt.argumentTypes=Object.keys(be.argumentTypes).map(v=>be.argumentTypes[v]));function Q(v){console.warn("Falling back to CPU");const I=new z(re,{argumentTypes:bt.argumentTypes,constantTypes:bt.constantTypes,graphical:bt.graphical,loopMaxIterations:bt.loopMaxIterations,constants:bt.constants,dynamicOutput:bt.dynamicOutput,dynamicArgument:bt.dynamicArguments,output:bt.output,precision:bt.precision,pipeline:bt.pipeline,immutable:bt.immutable,optimizeFloatMemory:bt.optimizeFloatMemory,fixIntegerDivisionAccuracy:bt.fixIntegerDivisionAccuracy,functions:bt.functions,nativeFunctions:bt.nativeFunctions,injectedNative:bt.injectedNative,subKernels:bt.subKernels,strictIntegers:bt.strictIntegers,debug:bt.debug});I.build.apply(I,v);const M=I.run.apply(I,v);return bt.replaceKernel(I),M}function U(v,I,M){M.debug&&console.warn("Switching kernels");let H=null;if(M.signature&&!rt[M.signature]&&(rt[M.signature]=M),M.dynamicOutput)for(let Re=v.length-1;Re>=0;Re--){const Ue=v[Re];Ue.type==="outputPrecisionMismatch"&&(H=Ue.needed)}const oe=M.constructor,de=oe.getArgumentTypes(M,I),ue=oe.getSignature(M,de),ve=rt[ue];if(ve)return ve.onActivate(M),ve;const xe=rt[ue]=new oe(re,{argumentTypes:de,constantTypes:M.constantTypes,graphical:M.graphical,loopMaxIterations:M.loopMaxIterations,constants:M.constants,dynamicOutput:M.dynamicOutput,dynamicArgument:M.dynamicArguments,context:M.context,canvas:M.canvas,output:H||M.output,precision:M.precision,pipeline:M.pipeline,immutable:M.immutable,optimizeFloatMemory:M.optimizeFloatMemory,fixIntegerDivisionAccuracy:M.fixIntegerDivisionAccuracy,functions:M.functions,nativeFunctions:M.nativeFunctions,injectedNative:M.injectedNative,subKernels:M.subKernels,strictIntegers:M.strictIntegers,debug:M.debug,gpu:M.gpu,validate:Te,returnType:M.returnType,tactic:M.tactic,onRequestFallback:Q,onRequestSwitchKernel:U,texture:M.texture,mappedTextures:M.mappedTextures,drawBuffersMap:M.drawBuffersMap});return xe.build.apply(xe,I),bt.replaceKernel(xe),ke.push(xe),xe}const Me=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions,injectedNative:this.injectedNative,gpu:this,validate:Te,onRequestFallback:Q,onRequestSwitchKernel:U},vt),Fe=new this.Kernel(re,Me),bt=S(Fe);return this.canvas||(this.canvas=Fe.canvas),this.context||(this.context=Fe.context),ke.push(Fe),bt}createKernelMap(){let re,be;const ke=typeof arguments[arguments.length-2];if(ke==="function"||ke==="string"?(re=arguments[arguments.length-2],be=arguments[arguments.length-1]):re=arguments[arguments.length-1],this.mode!=="dev"&&(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&G.indexOf(this.mode)<0)throw new Error(`kernelMap not supported on ${this.Kernel.name}`);const rt=_e(be);if(be&&typeof be.argumentTypes=="object"&&(rt.argumentTypes=Object.keys(be.argumentTypes).map(vt=>be.argumentTypes[vt])),Array.isArray(arguments[0])){rt.subKernels=[];const vt=arguments[0];for(let Q=0;Q<vt.length;Q++){const U=vt[Q].toString(),Me=F.getFunctionNameFromString(U);rt.subKernels.push({name:Me,source:U,property:Q})}}else{rt.subKernels=[];const vt=arguments[0];for(let Q in vt){if(!vt.hasOwnProperty(Q))continue;const U=vt[Q].toString(),Me=F.getFunctionNameFromString(U);rt.subKernels.push({name:Me||Q,source:U,property:Q})}}return this.createKernel(re,rt)}combineKernels(){const re=arguments[0],be=arguments[arguments.length-1];if(re.kernel.constructor.mode==="cpu")return be;const ke=arguments[0].canvas,rt=arguments[0].context,vt=arguments.length-1;for(let Q=0;Q<vt;Q++)arguments[Q].setCanvas(ke).setContext(rt).setPipeline(!0);return function(){const Q=be.apply(this,arguments);return Q.toArray?Q.toArray():Q}}setFunctions(re){return this.functions=re,this}setNativeFunctions(re){return this.nativeFunctions=re,this}addFunction(re,be){return this.functions.push({source:re,settings:be}),this}addNativeFunction(re,be,ke){if(this.kernels.length>0)throw new Error('Cannot call "addNativeFunction" after "createKernels" has been called.');return this.nativeFunctions.push(Object.assign({name:re,source:be},ke)),this}injectNative(re){return this.injectedNative=re,this}destroy(){return new Promise((re,be)=>{this.kernels||re(),setTimeout(()=>{try{for(let rt=0;rt<this.kernels.length;rt++)this.kernels[rt].destroy(!0);let ke=this.kernels[0];ke&&(ke.kernel&&(ke=ke.kernel),ke.constructor.destroyContext&&ke.constructor.destroyContext(this.context))}catch(ke){be(ke)}re()},0)})}}function _e(Y){if(!Y)return{};const re=Object.assign({},Y);return Y.hasOwnProperty("floatOutput")&&(F.warnDeprecated("setting","floatOutput","precision"),re.precision=Y.floatOutput?"single":"unsigned"),Y.hasOwnProperty("outputToTexture")&&(F.warnDeprecated("setting","outputToTexture","pipeline"),re.pipeline=!!Y.outputToTexture),Y.hasOwnProperty("outputImmutable")&&(F.warnDeprecated("setting","outputImmutable","immutable"),re.immutable=!!Y.outputImmutable),Y.hasOwnProperty("floatTextures")&&(F.warnDeprecated("setting","floatTextures","optimizeFloatMemory"),re.optimizeFloatMemory=!!Y.floatTextures),re}y.exports={GPU:ie,kernelOrder:T,kernelTypes:G}},{"./backend/cpu/kernel":8,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/kernel":70,"./backend/web-gl2/kernel":105,"./kernel-run-shortcut":111,"./utils":114,"gpu-mock.js":4}],109:[function(g,y,N){const{GPU:D}=g("./gpu"),{alias:F}=g("./alias"),{utils:z}=g("./utils"),{Input:P,input:k}=g("./input"),{Texture:R}=g("./texture"),{FunctionBuilder:S}=g("./backend/function-builder"),{FunctionNode:T}=g("./backend/function-node"),{CPUFunctionNode:G}=g("./backend/cpu/function-node"),{CPUKernel:te}=g("./backend/cpu/kernel"),{HeadlessGLKernel:Te}=g("./backend/headless-gl/kernel"),{WebGLFunctionNode:ie}=g("./backend/web-gl/function-node"),{WebGLKernel:_e}=g("./backend/web-gl/kernel"),{kernelValueMaps:Y}=g("./backend/web-gl/kernel-value-maps"),{WebGL2FunctionNode:re}=g("./backend/web-gl2/function-node"),{WebGL2Kernel:be}=g("./backend/web-gl2/kernel"),{kernelValueMaps:ke}=g("./backend/web-gl2/kernel-value-maps"),{GLKernel:rt}=g("./backend/gl/kernel"),{Kernel:vt}=g("./backend/kernel"),{FunctionTracer:Q}=g("./backend/function-tracer"),U=g("./plugins/math-random-uniformly-distributed");y.exports={alias:F,CPUFunctionNode:G,CPUKernel:te,GPU:D,FunctionBuilder:S,FunctionNode:T,HeadlessGLKernel:Te,Input:P,input:k,Texture:R,utils:z,WebGL2FunctionNode:re,WebGL2Kernel:be,webGL2KernelValueMaps:ke,WebGLFunctionNode:ie,WebGLKernel:_e,webGLKernelValueMaps:Y,GLKernel:rt,Kernel:vt,FunctionTracer:Q,plugins:{mathRandom:U}}},{"./alias":5,"./backend/cpu/function-node":6,"./backend/cpu/kernel":8,"./backend/function-builder":9,"./backend/function-node":10,"./backend/function-tracer":11,"./backend/gl/kernel":13,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/function-node":38,"./backend/web-gl/kernel":70,"./backend/web-gl/kernel-value-maps":39,"./backend/web-gl2/function-node":73,"./backend/web-gl2/kernel":105,"./backend/web-gl2/kernel-value-maps":74,"./gpu":108,"./input":110,"./plugins/math-random-uniformly-distributed":112,"./texture":113,"./utils":114}],110:[function(g,y,N){class D{constructor(P,k){this.value=P,Array.isArray(k)?this.size=k:(this.size=new Int32Array(3),k.z?this.size=new Int32Array([k.x,k.y,k.z]):k.y?this.size=new Int32Array([k.x,k.y]):this.size=new Int32Array([k.x]));const[R,S,T]=this.size;if(T){if(this.value.length!==R*S*T)throw new Error(`Input size ${this.value.length} does not match ${R} * ${S} * ${T} = ${S*R*T}`)}else if(S){if(this.value.length!==R*S)throw new Error(`Input size ${this.value.length} does not match ${R} * ${S} = ${S*R}`)}else if(this.value.length!==R)throw new Error(`Input size ${this.value.length} does not match ${R}`)}toArray(){const{utils:P}=g("./utils"),[k,R,S]=this.size;return S?P.erectMemoryOptimized3DFloat(this.value.subarray?this.value:new Float32Array(this.value),k,R,S):R?P.erectMemoryOptimized2DFloat(this.value.subarray?this.value:new Float32Array(this.value),k,R):this.value}}function F(z,P){return new D(z,P)}y.exports={Input:D,input:F}},{"./utils":114}],111:[function(g,y,N){const{utils:D}=g("./utils");function F(P){let k=function(){return P.build.apply(P,arguments),k=function(){let S=P.run.apply(P,arguments);if(P.switchingKernels){const T=P.resetSwitchingKernels(),G=P.onRequestSwitchKernel(T,arguments,P);R.kernel=P=G,S=G.run.apply(G,arguments)}return P.renderKernels?P.renderKernels():P.renderOutput?P.renderOutput():S},k.apply(P,arguments)};const R=function(){return k.apply(P,arguments)};return R.exec=function(){return new Promise((S,T)=>{try{S(k.apply(this,arguments))}catch(G){T(G)}})},R.replaceKernel=function(S){P=S,z(P,R)},z(P,R),R}function z(P,k){if(k.kernel){k.kernel=P;return}const R=D.allPropertiesOf(P);for(let S=0;S<R.length;S++){const T=R[S];T[0]==="_"&&T[1]==="_"||(typeof P[T]=="function"?T.substring(0,3)==="add"||T.substring(0,3)==="set"?k[T]=function(){return k.kernel[T].apply(k.kernel,arguments),k}:k[T]=function(){return k.kernel[T].apply(k.kernel,arguments)}:(k.__defineGetter__(T,()=>k.kernel[T]),k.__defineSetter__(T,G=>{k.kernel[T]=G})))}k.kernel=P}y.exports={kernelRunShortcut:F}},{"./utils":114}],112:[function(g,y,N){const S={name:"math-random-uniformly-distributed",onBeforeRun:T=>{T.setUniform1f("randomSeed1",Math.random()),T.setUniform1f("randomSeed2",Math.random())},functionMatch:"Math.random()",functionReplace:"nrand(vTexCoord)",functionReturnType:"Number",source:`// https://www.shadertoy.com/view/4t2SDh
//note: uniformly distributed, normalized rand, [0,1]
highp float randomSeedShift = 1.0;
highp float slide = 1.0;
uniform highp float randomSeed1;
uniform highp float randomSeed2;

highp float nrand(highp vec2 n) {
  highp float result = fract(sin(dot((n.xy + 1.0) * vec2(randomSeed1 * slide, randomSeed2 * randomSeedShift), vec2(12.9898, 78.233))) * 43758.5453);
  randomSeedShift = result;
  if (randomSeedShift > 0.5) {
    slide += 0.00009; 
  } else {
    slide += 0.0009;
  }
  return result;
}`};y.exports=S},{}],113:[function(g,y,N){class D{constructor(z){const{texture:P,size:k,dimensions:R,output:S,context:T,type:G="NumberTexture",kernel:te,internalFormat:Te,textureFormat:ie}=z;if(!S)throw new Error('settings property "output" required.');if(!T)throw new Error('settings property "context" required.');if(!P)throw new Error('settings property "texture" required.');if(!te)throw new Error('settings property "kernel" required.');this.texture=P,P._refs?P._refs++:P._refs=1,this.size=k,this.dimensions=R,this.output=S,this.context=T,this.kernel=te,this.type=G,this._deleted=!1,this.internalFormat=Te,this.textureFormat=ie}toArray(){throw new Error(`Not implemented on ${this.constructor.name}`)}clone(){throw new Error(`Not implemented on ${this.constructor.name}`)}delete(){throw new Error(`Not implemented on ${this.constructor.name}`)}clear(){throw new Error(`Not implemented on ${this.constructor.name}`)}}y.exports={Texture:D}},{}],114:[function(g,y,N){const D=g("acorn"),{Input:F}=g("./input"),{Texture:z}=g("./texture"),P=/function ([^(]*)/,k=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,R=/([^\s,]+)/g,S={systemEndianness(){return Te},getSystemEndianness(){const ie=new ArrayBuffer(4),_e=new Uint32Array(ie),Y=new Uint8Array(ie);if(_e[0]=3735928559,Y[0]===239)return"LE";if(Y[0]===222)return"BE";throw new Error("unknown endianness")},isFunction(ie){return typeof ie=="function"},isFunctionString(ie){return typeof ie=="string"?ie.slice(0,8).toLowerCase()==="function":!1},getFunctionNameFromString(ie){const _e=P.exec(ie);return!_e||_e.length===0?null:_e[1].trim()},getFunctionBodyFromString(ie){return ie.substring(ie.indexOf("{")+1,ie.lastIndexOf("}"))},getArgumentNamesFromString(ie){const _e=ie.replace(k,"");let Y=_e.slice(_e.indexOf("(")+1,_e.indexOf(")")).match(R);return Y===null&&(Y=[]),Y},clone(ie){if(ie===null||typeof ie!="object"||ie.hasOwnProperty("isActiveClone"))return ie;const _e=ie.constructor();for(let Y in ie)Object.prototype.hasOwnProperty.call(ie,Y)&&(ie.isActiveClone=null,_e[Y]=S.clone(ie[Y]),delete ie.isActiveClone);return _e},isArray(ie){return!isNaN(ie.length)},getVariableType(ie,_e){if(S.isArray(ie))return ie.length>0&&ie[0].nodeName==="IMG"?"HTMLImageArray":"Array";switch(ie.constructor){case Boolean:return"Boolean";case Number:return _e&&Number.isInteger(ie)?"Integer":"Float";case z:return ie.type;case F:return"Input"}if("nodeName"in ie)switch(ie.nodeName){case"IMG":return"HTMLImage";case"CANVAS":return"HTMLImage";case"VIDEO":return"HTMLVideo"}else{if(ie.hasOwnProperty("type"))return ie.type;if(typeof OffscreenCanvas<"u"&&ie instanceof OffscreenCanvas)return"OffscreenCanvas";if(typeof ImageBitmap<"u"&&ie instanceof ImageBitmap)return"ImageBitmap";if(typeof ImageData<"u"&&ie instanceof ImageData)return"ImageData"}return"Unknown"},getKernelTextureSize(ie,_e){let[Y,re,be]=_e,ke=(Y||1)*(re||1)*(be||1);return ie.optimizeFloatMemory&&ie.precision==="single"&&(Y=ke=Math.ceil(ke/4)),re>1&&Y*re===ke?new Int32Array([Y,re]):S.closestSquareDimensions(ke)},closestSquareDimensions(ie){const _e=Math.sqrt(ie);let Y=Math.ceil(_e),re=Math.floor(_e);for(;Y*re<ie;)Y--,re=Math.ceil(ie/Y);return new Int32Array([re,Math.ceil(ie/re)])},getMemoryOptimizedFloatTextureSize(ie,_e){const re=S.roundTo((ie[0]||1)*(ie[1]||1)*(ie[2]||1)*(ie[3]||1),4)/_e;return S.closestSquareDimensions(re)},getMemoryOptimizedPackedTextureSize(ie,_e){const[Y,re,be]=ie,rt=S.roundTo((Y||1)*(re||1)*(be||1),4)/(4/_e);return S.closestSquareDimensions(rt)},roundTo(ie,_e){return Math.floor((ie+_e-1)/_e)*_e},getDimensions(ie,_e){let Y;if(S.isArray(ie)){const re=[];let be=ie;for(;S.isArray(be);)re.push(be.length),be=be[0];Y=re.reverse()}else if(ie instanceof z)Y=ie.output;else if(ie instanceof F)Y=ie.size;else throw new Error(`Unknown dimensions of ${ie}`);if(_e)for(Y=Array.from(Y);Y.length<3;)Y.push(1);return new Int32Array(Y)},flatten2dArrayTo(ie,_e){let Y=0;for(let re=0;re<ie.length;re++)_e.set(ie[re],Y),Y+=ie[re].length},flatten3dArrayTo(ie,_e){let Y=0;for(let re=0;re<ie.length;re++)for(let be=0;be<ie[re].length;be++)_e.set(ie[re][be],Y),Y+=ie[re][be].length},flatten4dArrayTo(ie,_e){let Y=0;for(let re=0;re<ie.length;re++)for(let be=0;be<ie[re].length;be++)for(let ke=0;ke<ie[re][be].length;ke++)_e.set(ie[re][be][ke],Y),Y+=ie[re][be][ke].length},flattenTo(ie,_e){S.isArray(ie[0])?S.isArray(ie[0][0])?S.isArray(ie[0][0][0])?S.flatten4dArrayTo(ie,_e):S.flatten3dArrayTo(ie,_e):S.flatten2dArrayTo(ie,_e):_e.set(ie)},splitArray(ie,_e){const Y=[];for(let re=0;re<ie.length;re+=_e)Y.push(new ie.constructor(ie.buffer,re*4+ie.byteOffset,_e));return Y},getAstString(ie,_e){const Y=Array.isArray(ie)?ie:ie.split(/\r?\n/g),re=_e.loc.start,be=_e.loc.end,ke=[];if(re.line===be.line)ke.push(Y[re.line-1].substring(re.column,be.column));else{ke.push(Y[re.line-1].slice(re.column));for(let rt=re.line;rt<be.line;rt++)ke.push(Y[rt]);ke.push(Y[be.line-1].slice(0,be.column))}return ke.join(`
`)},allPropertiesOf(ie){const _e=[];do _e.push.apply(_e,Object.getOwnPropertyNames(ie));while(ie=Object.getPrototypeOf(ie));return _e},linesToString(ie){return ie.length>0?ie.join(`;
`)+`;
`:`
`},warnDeprecated(ie,_e,Y){console.warn(Y?`You are using a deprecated ${ie} "${_e}". It has been replaced with "${Y}". Fixing, but please upgrade as it will soon be removed.`:`You are using a deprecated ${ie} "${_e}". It has been removed. Fixing, but please upgrade as it will soon be removed.`)},flipPixels:(ie,_e,Y)=>{const re=Y/2|0,be=_e*4,ke=new Uint8ClampedArray(_e*4),rt=ie.slice(0);for(let vt=0;vt<re;++vt){const Q=vt*be,U=(Y-vt-1)*be;ke.set(rt.subarray(Q,Q+be)),rt.copyWithin(Q,U,U+be),rt.set(ke,U)}return rt},erectPackedFloat:(ie,_e)=>ie.subarray(0,_e),erect2DPackedFloat:(ie,_e,Y)=>{const re=new Array(Y);for(let be=0;be<Y;be++){const ke=be*_e,rt=ke+_e;re[be]=ie.subarray(ke,rt)}return re},erect3DPackedFloat:(ie,_e,Y,re)=>{const be=new Array(re);for(let ke=0;ke<re;ke++){const rt=new Array(Y);for(let vt=0;vt<Y;vt++){const Q=ke*Y*_e+vt*_e,U=Q+_e;rt[vt]=ie.subarray(Q,U)}be[ke]=rt}return be},erectMemoryOptimizedFloat:(ie,_e)=>ie.subarray(0,_e),erectMemoryOptimized2DFloat:(ie,_e,Y)=>{const re=new Array(Y);for(let be=0;be<Y;be++){const ke=be*_e;re[be]=ie.subarray(ke,ke+_e)}return re},erectMemoryOptimized3DFloat:(ie,_e,Y,re)=>{const be=new Array(re);for(let ke=0;ke<re;ke++){const rt=new Array(Y);for(let vt=0;vt<Y;vt++){const Q=ke*Y*_e+vt*_e;rt[vt]=ie.subarray(Q,Q+_e)}be[ke]=rt}return be},erectFloat:(ie,_e)=>{const Y=new Float32Array(_e);let re=0;for(let be=0;be<_e;be++)Y[be]=ie[re],re+=4;return Y},erect2DFloat:(ie,_e,Y)=>{const re=new Array(Y);let be=0;for(let ke=0;ke<Y;ke++){const rt=new Float32Array(_e);for(let vt=0;vt<_e;vt++)rt[vt]=ie[be],be+=4;re[ke]=rt}return re},erect3DFloat:(ie,_e,Y,re)=>{const be=new Array(re);let ke=0;for(let rt=0;rt<re;rt++){const vt=new Array(Y);for(let Q=0;Q<Y;Q++){const U=new Float32Array(_e);for(let Me=0;Me<_e;Me++)U[Me]=ie[ke],ke+=4;vt[Q]=U}be[rt]=vt}return be},erectArray2:(ie,_e)=>{const Y=new Array(_e),re=_e*4;let be=0;for(let ke=0;ke<re;ke+=4)Y[be++]=ie.subarray(ke,ke+2);return Y},erect2DArray2:(ie,_e,Y)=>{const re=new Array(Y),be=_e*4;for(let ke=0;ke<Y;ke++){const rt=new Array(_e),vt=ke*be;let Q=0;for(let U=0;U<be;U+=4)rt[Q++]=ie.subarray(U+vt,U+vt+2);re[ke]=rt}return re},erect3DArray2:(ie,_e,Y,re)=>{const be=_e*4,ke=new Array(re);for(let rt=0;rt<re;rt++){const vt=new Array(Y);for(let Q=0;Q<Y;Q++){const U=new Array(_e),Me=rt*be*Y+Q*be;let Fe=0;for(let bt=0;bt<be;bt+=4)U[Fe++]=ie.subarray(bt+Me,bt+Me+2);vt[Q]=U}ke[rt]=vt}return ke},erectArray3:(ie,_e)=>{const Y=new Array(_e),re=_e*4;let be=0;for(let ke=0;ke<re;ke+=4)Y[be++]=ie.subarray(ke,ke+3);return Y},erect2DArray3:(ie,_e,Y)=>{const re=_e*4,be=new Array(Y);for(let ke=0;ke<Y;ke++){const rt=new Array(_e),vt=ke*re;let Q=0;for(let U=0;U<re;U+=4)rt[Q++]=ie.subarray(U+vt,U+vt+3);be[ke]=rt}return be},erect3DArray3:(ie,_e,Y,re)=>{const be=_e*4,ke=new Array(re);for(let rt=0;rt<re;rt++){const vt=new Array(Y);for(let Q=0;Q<Y;Q++){const U=new Array(_e),Me=rt*be*Y+Q*be;let Fe=0;for(let bt=0;bt<be;bt+=4)U[Fe++]=ie.subarray(bt+Me,bt+Me+3);vt[Q]=U}ke[rt]=vt}return ke},erectArray4:(ie,_e)=>{const Y=new Array(ie),re=_e*4;let be=0;for(let ke=0;ke<re;ke+=4)Y[be++]=ie.subarray(ke,ke+4);return Y},erect2DArray4:(ie,_e,Y)=>{const re=_e*4,be=new Array(Y);for(let ke=0;ke<Y;ke++){const rt=new Array(_e),vt=ke*re;let Q=0;for(let U=0;U<re;U+=4)rt[Q++]=ie.subarray(U+vt,U+vt+4);be[ke]=rt}return be},erect3DArray4:(ie,_e,Y,re)=>{const be=_e*4,ke=new Array(re);for(let rt=0;rt<re;rt++){const vt=new Array(Y);for(let Q=0;Q<Y;Q++){const U=new Array(_e),Me=rt*be*Y+Q*be;let Fe=0;for(let bt=0;bt<be;bt+=4)U[Fe++]=ie.subarray(bt+Me,bt+Me+4);vt[Q]=U}ke[rt]=vt}return ke},flattenFunctionToString:(ie,_e)=>{const{findDependency:Y,thisLookup:re,doNotDefine:be}=_e;let ke=_e.flattened;ke||(ke=_e.flattened={});const rt=D.parse(ie),vt=[];let Q=0;function U(Fe){if(Array.isArray(Fe)){const bt=[];for(let v=0;v<Fe.length;v++)bt.push(U(Fe[v]));return bt.join("")}switch(Fe.type){case"Program":return U(Fe.body)+(Fe.body[0].type==="VariableDeclaration"?";":"");case"FunctionDeclaration":return`function ${Fe.id.name}(${Fe.params.map(U).join(", ")}) ${U(Fe.body)}`;case"BlockStatement":{const v=[];Q+=2;for(let I=0;I<Fe.body.length;I++){const M=U(Fe.body[I]);M&&v.push(" ".repeat(Q)+M,`;
`)}return Q-=2,`{
${v.join("")}}`}case"VariableDeclaration":const bt=S.normalizeDeclarations(Fe).map(U).filter(v=>v!==null);return bt.length<1?"":`${Fe.kind} ${bt.join(",")}`;case"VariableDeclarator":return Fe.init.object&&Fe.init.object.type==="ThisExpression"?re(Fe.init.property.name,!0)?`${Fe.id.name} = ${U(Fe.init)}`:null:`${Fe.id.name} = ${U(Fe.init)}`;case"CallExpression":{if(Fe.callee.property.name==="subarray")return`${U(Fe.callee.object)}.${U(Fe.callee.property)}(${Fe.arguments.map(v=>U(v)).join(", ")})`;if(Fe.callee.object.name==="gl"||Fe.callee.object.name==="context")return`${U(Fe.callee.object)}.${U(Fe.callee.property)}(${Fe.arguments.map(v=>U(v)).join(", ")})`;if(Fe.callee.object.type==="ThisExpression")return vt.push(Y("this",Fe.callee.property.name)),`${Fe.callee.property.name}(${Fe.arguments.map(v=>U(v)).join(", ")})`;if(Fe.callee.object.name){const v=Y(Fe.callee.object.name,Fe.callee.property.name);return v===null?`${Fe.callee.object.name}.${Fe.callee.property.name}(${Fe.arguments.map(I=>U(I)).join(", ")})`:(vt.push(v),`${Fe.callee.property.name}(${Fe.arguments.map(I=>U(I)).join(", ")})`)}else{if(Fe.callee.object.type==="MemberExpression")return`${U(Fe.callee.object)}.${Fe.callee.property.name}(${Fe.arguments.map(v=>U(v)).join(", ")})`;throw new Error("unknown ast.callee")}}case"ReturnStatement":return`return ${U(Fe.argument)}`;case"BinaryExpression":return`(${U(Fe.left)}${Fe.operator}${U(Fe.right)})`;case"UnaryExpression":return Fe.prefix?`${Fe.operator} ${U(Fe.argument)}`:`${U(Fe.argument)} ${Fe.operator}`;case"ExpressionStatement":return`${U(Fe.expression)}`;case"SequenceExpression":return`(${U(Fe.expressions)})`;case"ArrowFunctionExpression":return`(${Fe.params.map(U).join(", ")}) => ${U(Fe.body)}`;case"Literal":return Fe.raw;case"Identifier":return Fe.name;case"MemberExpression":return Fe.object.type==="ThisExpression"?re(Fe.property.name):Fe.computed?`${U(Fe.object)}[${U(Fe.property)}]`:U(Fe.object)+"."+U(Fe.property);case"ThisExpression":return"this";case"NewExpression":return`new ${U(Fe.callee)}(${Fe.arguments.map(v=>U(v)).join(", ")})`;case"ForStatement":return`for (${U(Fe.init)};${U(Fe.test)};${U(Fe.update)}) ${U(Fe.body)}`;case"AssignmentExpression":return`${U(Fe.left)}${Fe.operator}${U(Fe.right)}`;case"UpdateExpression":return`${U(Fe.argument)}${Fe.operator}`;case"IfStatement":return`if (${U(Fe.test)}) ${U(Fe.consequent)}`;case"ThrowStatement":return`throw ${U(Fe.argument)}`;case"ObjectPattern":return Fe.properties.map(U).join(", ");case"ArrayPattern":return Fe.elements.map(U).join(", ");case"DebuggerStatement":return"debugger;";case"ConditionalExpression":return`${U(Fe.test)}?${U(Fe.consequent)}:${U(Fe.alternate)}`;case"Property":if(Fe.kind==="init")return U(Fe.key)}throw new Error(`unhandled ast.type of ${Fe.type}`)}const Me=U(rt);if(vt.length>0){const Fe=[];for(let bt=0;bt<vt.length;bt++){const v=vt[bt];ke[v]||(ke[v]=!0),v&&Fe.push(S.flattenFunctionToString(v,_e)+`
`)}return Fe.join("")+Me}return Me},normalizeDeclarations:ie=>{if(ie.type!=="VariableDeclaration")throw new Error('Ast is not of type "VariableDeclaration"');const _e=[];for(let Y=0;Y<ie.declarations.length;Y++){const re=ie.declarations[Y];if(re.id&&re.id.type==="ObjectPattern"&&re.id.properties){const{properties:be}=re.id;for(let ke=0;ke<be.length;ke++){const rt=be[ke];if(rt.value.type==="ObjectPattern"&&rt.value.properties)for(let vt=0;vt<rt.value.properties.length;vt++){const Q=rt.value.properties[vt];if(Q.type==="Property")_e.push({type:"VariableDeclarator",id:{type:"Identifier",name:Q.key.name},init:{type:"MemberExpression",object:{type:"MemberExpression",object:re.init,property:{type:"Identifier",name:rt.key.name},computed:!1},property:{type:"Identifier",name:Q.key.name},computed:!1}});else throw new Error("unexpected state")}else if(rt.value.type==="Identifier")_e.push({type:"VariableDeclarator",id:{type:"Identifier",name:rt.value&&rt.value.name?rt.value.name:rt.key.name},init:{type:"MemberExpression",object:re.init,property:{type:"Identifier",name:rt.key.name},computed:!1}});else throw new Error("unexpected state")}}else if(re.id&&re.id.type==="ArrayPattern"&&re.id.elements){const{elements:be}=re.id;for(let ke=0;ke<be.length;ke++){const rt=be[ke];if(rt.type==="Identifier")_e.push({type:"VariableDeclarator",id:{type:"Identifier",name:rt.name},init:{type:"MemberExpression",object:re.init,property:{type:"Literal",value:ke,raw:ke.toString(),start:rt.start,end:rt.end},computed:!0}});else throw new Error("unexpected state")}}else _e.push(re)}return _e},splitHTMLImageToRGB:(ie,_e)=>{const Y=ie.createKernel(function(vt){return vt[this.thread.y][this.thread.x].r*255},{output:[_e.width,_e.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),re=ie.createKernel(function(vt){return vt[this.thread.y][this.thread.x].g*255},{output:[_e.width,_e.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),be=ie.createKernel(function(vt){return vt[this.thread.y][this.thread.x].b*255},{output:[_e.width,_e.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),ke=ie.createKernel(function(vt){return vt[this.thread.y][this.thread.x].a*255},{output:[_e.width,_e.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),rt=[Y(_e),re(_e),be(_e),ke(_e)];return rt.rKernel=Y,rt.gKernel=re,rt.bKernel=be,rt.aKernel=ke,rt.gpu=ie,rt},splitRGBAToCanvases:(ie,_e,Y,re)=>{const be=ie.createKernel(function(Q){const U=Q[this.thread.y][this.thread.x];this.color(U.r/255,0,0,255)},{output:[Y,re],graphical:!0,argumentTypes:{v:"Array2D(4)"}});be(_e);const ke=ie.createKernel(function(Q){const U=Q[this.thread.y][this.thread.x];this.color(0,U.g/255,0,255)},{output:[Y,re],graphical:!0,argumentTypes:{v:"Array2D(4)"}});ke(_e);const rt=ie.createKernel(function(Q){const U=Q[this.thread.y][this.thread.x];this.color(0,0,U.b/255,255)},{output:[Y,re],graphical:!0,argumentTypes:{v:"Array2D(4)"}});rt(_e);const vt=ie.createKernel(function(Q){const U=Q[this.thread.y][this.thread.x];this.color(255,255,255,U.a/255)},{output:[Y,re],graphical:!0,argumentTypes:{v:"Array2D(4)"}});return vt(_e),[be.canvas,ke.canvas,rt.canvas,vt.canvas]},getMinifySafeName:ie=>{try{const _e=D.parse(`const value = ${ie.toString()}`),{init:Y}=_e.body[0].declarations[0];return Y.body.name||Y.body.body[0].argument.name}catch{throw new Error("Unrecognized function type.  Please use `() => yourFunctionVariableHere` or function() { return yourFunctionVariableHere; }")}},sanitizeName:function(ie){return T.test(ie)&&(ie=ie.replace(T,"S_S")),G.test(ie)?ie=ie.replace(G,"U_U"):te.test(ie)&&(ie=ie.replace(te,"u_u")),ie}},T=/\$/,G=/__/,te=/_/,Te=S.getSystemEndianness();y.exports={utils:S}},{"./input":110,"./texture":113,acorn:1}]},{},[107])(107)})});const me={toTable(O){const d=O.reduce((g,y)=>Object.assign(g,y),{});return me.toHash(d)},toTable2D(O){const d={};let g=0;for(let y=0;y<O.length;y++){const N=O[y];for(let D=0;D<N.length;D++){const F=N[D];for(const z in F)F.hasOwnProperty(z)&&!d.hasOwnProperty(z)&&(d[z]=g++)}}return d},toInputTable2D(O){const d={};let g=0;for(let y=0;y<O.length;y++){const N=O[y].input;for(let D=0;D<N.length;D++){const F=N[D];for(const z in F)F.hasOwnProperty(z)&&(d.hasOwnProperty(z)||(d[z]=g++))}}return d},toOutputTable2D(O){const d={};let g=0;for(let y=0;y<O.length;y++){const N=O[y].output;for(let D=0;D<N.length;D++){const F=N[D];for(const z in F)F.hasOwnProperty(z)&&(d.hasOwnProperty(z)||(d[z]=g++))}}return d},toHash(O){const d={};let g=0;const y=Object.keys(O);for(let N=0;N<y.length;N++)d[y[N]]=g++;return d},toArray(O,d,g){const y=new Float32Array(g);for(const N in O)O.hasOwnProperty(N)&&(y[O[N]]=d.hasOwnProperty(N)?d[N]:0);return y},toArrayShort(O,d){const g=[];for(const y in O)if(O.hasOwnProperty(y)){if(!d.hasOwnProperty(y))break;g[O[y]]=d[y]}return Float32Array.from(g)},toArrays(O,d,g){const y=[];for(let N=0;N<d.length;N++)y.push(this.toArray(O,d[N],g));return y},toObject(O,d){const g={};for(const y in O)O.hasOwnProperty(y)&&(g[y]=d[O[y]]);return g},toObjectPartial(O,d,g=0,y=0){const N={};let D=0;for(const F in O)O.hasOwnProperty(F)&&(g>0&&D++<g||y>0&&D++>=y||(N[F]=d[O[F]-g]));return N},dataShape(O){const d=[];let g;O.hasOwnProperty("input")?(d.push("datum"),g=O.input):Array.isArray(O)?O[0]&&O[0].input?(d.push("array","datum"),g=O[0].input):Array.isArray(O[0])?(d.push("array"),g=O[0]):g=O:g=O;let y;for(;g;)if(y=Object.keys(g)[0],Array.isArray(g)||typeof g.buffer=="object"){d.push("array");const N=g[parseInt(y)];if(typeof N=="number"){d.push("number");break}else g=N}else if(typeof g=="object"&&typeof g.buffer!="object"){d.push("object");const N=g[y];if(typeof N=="number"){d.push("number");break}else g=N}else throw new Error("unhandled signature");return d},addKeys(O,d){if(Array.isArray(O))return d;let g=Object.keys(d).length;for(const y in O)O.hasOwnProperty(y)&&(d.hasOwnProperty(y)||(d[y]=g++));return d}};var Ce=q(function(O,d){var g=W&&W.__assign||function(){return g=Object.assign||function(F){for(var z,P=1,k=arguments.length;P<k;P++){z=arguments[P];for(var R in z)Object.prototype.hasOwnProperty.call(z,R)&&(F[R]=z[R])}return F},g.apply(this,arguments)};Object.defineProperty(d,"__esModule",{value:!0}),d.thaw=d.Block=d.Thaw=void 0;var y=(function(){function F(z,P){var k=this;P===void 0&&(P={});var R=g(g({},F.defaultSettings),P),S=R.each,T=R.done;this.i=0,this.isStopped=!1,this.items=z,this.options=P,this.tick=function(){if(!k.isStopped&&(k.timeout=setTimeout(k.tick,0),!F.thawing)){var G=k.items[k.i];if(k.i>=k.items.length){T!==null&&(F.thawing=!0,T(),F.thawing=!1),k.isStopped=!0,clearTimeout(k.timeout);return}S!==null?(F.thawing=!0,S(G,k.i),F.thawing=!1):G!==void 0&&G(),k.i++}},F.thaws.push(this),P.delay||this.tick()}return Object.defineProperty(F,"isThawing",{get:function(){return F.thawing},enumerable:!1,configurable:!0}),F.stopAll=function(){for(var z=0;z<F.thaws.length;z++)F.thaws[z].stop()},F.prototype.makeReady=function(){return this.isStopped?(this.isStopped=!1,!0):!1},F.prototype.add=function(z){return this.items.push(z),this.makeReady()&&this.tick(),this},F.prototype.insert=function(z){return this.items.splice(this.i,0,z),this.makeReady()&&this.tick(),this},F.prototype.addArray=function(z){return this.items=this.items.concat(z),this.makeReady()&&this.tick(),this},F.prototype.insertArray=function(z){var P=this.items.splice(0,this.i),k=this.items;return this.items=P.concat(z,k),this.makeReady()&&this.tick(),this},F.prototype.stop=function(){return this.isStopped=!0,clearTimeout(this.timeout),this.options.done&&this.options.done(),this},F.thawing=!1,F.thaws=[],F.defaultSettings={each:null,done:null},F})();d.Thaw=y;function N(F,z){return new y(F,z)}d.thaw=N;var D=(function(){function F(z,P){P===void 0&&(P=200),this.index=0,this.thaws=[],this.count=P,this.options=z}return F.prototype.add=function(z){var P=this.next();return P.add(z),this},F.prototype.addArray=function(z){var P=this.next();return P.addArray(z),this},F.prototype.insert=function(z){var P=this.next();return P.insert(z),this},F.prototype.insertArray=function(z){var P=this.next();return P.insertArray(z),this},F.prototype.stop=function(){for(var z=0;z<this.thaws.length;z++)this.thaws[z].stop();return this},F.prototype.next=function(){var z,P=this.thaws;return P.length<this.count?(z=new y([],this.options),P.push(z)):z=P[this.index]||null,this.index++,this.index>=this.count&&(this.index=0),z},F})();d.Block=D,typeof window<"u"&&(window.Thaw=y,window.thaw=N,window.Thaw.Block=D)});function Ve(O){const d=[];for(let g=0;g<O.length;g++)d.push(Float32Array.from(O[g]));return d}function pe(O,d){const g=[];for(let y=0;y<O.length;y++)g.push(Float32Array.from(O[y]));for(let y=0;y<d.length;y++)g.push(Float32Array.from(d[y]));return g}function ee(O){const d=[];for(let g=0;g<O.length;g++)d.push(Float32Array.from([O[g]]));return d}function J(O,d){const g=[];for(let y=0;y<O.length;y++)g.push(Float32Array.from([O[y]]));for(let y=0;y<d.length;y++)g.push(Float32Array.from([d[y]]));return g}function ye(O){return Float32Array.from(O)}function X(O,d,g,y,N,D){const F=[];for(let z=0;z<O.length;z++){const P=O[z],k=new Float32Array(N);for(const R in P)P.hasOwnProperty(R)&&(k[g[R]]=P[R]);F.push(k)}for(let z=0;z<d.length;z++){const P=d[z],k=new Float32Array(D);for(const R in P)P.hasOwnProperty(R)&&(k[y[R]]=P[R]);F.push(k)}return F}function ae(O){const d=[];for(const g in O)O.hasOwnProperty(g)&&d.push(Float32Array.from([O[g]]));return d}function le(O,d){const g=[];for(const y in O)O.hasOwnProperty(y)&&g.push(Float32Array.from([O[y]]));for(const y in d)d.hasOwnProperty(y)&&g.push(Float32Array.from([d[y]]));return g}function ze(O,d,g){const y=new Float32Array(g);for(const N in O)O.hasOwnProperty(N)&&(y[d[N]]=O[N]);return y}class nt{constructor(d,g){this.prop=null,this.table={},this.length=0;const y=this.table;if(g){this.prop=g;for(let N=0;N<d.length;N++){const F=d[N][g];for(const z in F)F.hasOwnProperty(z)&&(y.hasOwnProperty(z)||(y[z]=this.length++))}}else if(Array.isArray(d)&&Array.isArray(d[0]))for(let N=0;N<d.length;N++){const D=d[N];for(let F=0;F<D.length;F++){const z=D[F];for(const P in z)z.hasOwnProperty(P)&&(y.hasOwnProperty(P)||(y[P]=this.length++))}}else for(let N=0;N<d.length;N++){const D=d[N];for(const F in D)D.hasOwnProperty(F)&&(y.hasOwnProperty(F)||(y[F]=this.length++))}}}function je(O){return Array.isArray(O)||O instanceof Float32Array?Math.max(...O):Math.max(...Object.values(O))}function Je(O){let d=0;for(let g=0;g<O.length;g++)d+=O[g]**2;return d/O.length}function qe(){return Math.random()*.4-.2}function lt(O,d){return Math.random()*(d-O)+O}function Tt(){if(Tt.returnV)return Tt.returnV=!1,Tt.vVal;const O=2*Math.random()-1,d=2*Math.random()-1,g=O*O+d*d;if(g===0||g>1)return Tt();const y=Math.sqrt(-2*Math.log(g)/g);return Tt.vVal=d*y,Tt.returnV=!0,O*y}function Ne(O,d){return Math.floor(Math.random()*(d-O)+O)}function se(O,d){return O+Tt()*d}Tt.returnV=!1,Tt.vVal=0;var Ee=Object.freeze({__proto__:null,randomFloat:lt,gaussRandom:Tt,randomInteger:Ne,randomN:se});function Le(O,d=null){const g=new Float32Array(O);if(d===null)for(let y=0;y<O;y++)g[y]=qe();else for(let y=0;y<O;y++)g[y]=lt(-d,d);return g}function Be(O,d,g){const y=new Array(d);for(let N=0;N<d;N++)y[N]=Le(O,g);return y}function He(O,d,g,y){const N=new Array(g);for(let D=0;D<g;D++)N[D]=Be(O,d,y);return N}function Ye(O){return new Float32Array(O)}function it(O,d){if(O.buffer instanceof ArrayBuffer)return null;if(Array.isArray(O))return ye;if(!d)throw new Error("table is not Object");const{length:g}=Object.keys(d);return y=>{const N=new Float32Array(g);for(const D in d)d.hasOwnProperty(D)&&typeof y[D]=="number"&&(N[d[D]]=y[D]||0);return N}}function ct(){return{inputSize:0,outputSize:0,binaryThresh:.5}}function Et(){return{activation:"sigmoid",iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,leakyReluAlpha:.01,learningRate:.3,momentum:.1,callbackPeriod:10,timeout:1/0,beta1:.9,beta2:.999,epsilon:1e-8}}class Ft{constructor(d={}){this.options=ct(),this.trainOpts=Et(),this.sizes=[],this.outputLayer=-1,this.biases=[],this.weights=[],this.outputs=[],this.deltas=[],this.changes=[],this.errors=[],this.errorCheckInterval=1,this.inputLookup=null,this.inputLookupLength=0,this.outputLookup=null,this.outputLookupLength=0,this._formatInput=null,this._formatOutput=null,this.runInput=D=>(this.setActivation(),this.runInput(D)),this.calculateDeltas=D=>(this.setActivation(),this.calculateDeltas(D)),this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[],this.iterations=0,this.options={...this.options,...d},this.updateTrainingOptions(d);const{inputSize:g,hiddenLayers:y,outputSize:N}=this.options;g&&N&&(this.sizes=[g].concat(y??[]).concat([N]))}initialize(){if(!this.sizes.length)throw new Error("Sizes must be set before initializing");this.outputLayer=this.sizes.length-1,this.biases=new Array(this.outputLayer),this.weights=new Array(this.outputLayer),this.outputs=new Array(this.outputLayer),this.deltas=new Array(this.outputLayer),this.changes=new Array(this.outputLayer),this.errors=new Array(this.outputLayer);for(let d=0;d<=this.outputLayer;d++){const g=this.sizes[d];if(this.deltas[d]=Ye(g),this.errors[d]=Ye(g),this.outputs[d]=Ye(g),d>0){this.biases[d]=Le(g),this.weights[d]=new Array(g),this.changes[d]=new Array(g);for(let y=0;y<g;y++){const N=this.sizes[d-1];this.weights[d][y]=Le(N),this.changes[d][y]=Ye(N)}}}this.setActivation(),this.trainOpts.praxis==="adam"&&this._setupAdam()}setActivation(d){const g=d??this.trainOpts.activation;switch(g){case"sigmoid":this.runInput=this._runInputSigmoid,this.calculateDeltas=this._calculateDeltasSigmoid;break;case"relu":this.runInput=this._runInputRelu,this.calculateDeltas=this._calculateDeltasRelu;break;case"leaky-relu":this.runInput=this._runInputLeakyRelu,this.calculateDeltas=this._calculateDeltasLeakyRelu;break;case"tanh":this.runInput=this._runInputTanh,this.calculateDeltas=this._calculateDeltasTanh;break;default:throw new Error(`Unknown activation ${g}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}}get isRunnable(){return this.sizes.length>0}run(d){if(!this.isRunnable)throw new Error("network not runnable");let g;this.inputLookup?g=me.toArray(this.inputLookup,d,this.inputLookupLength):g=d,this.validateInput(g);const y=this.runInput(g).slice(0);return this.outputLookup?me.toObject(this.outputLookup,y):y}_runInputSigmoid(d){this.outputs[0]=d;let g=null;for(let y=1;y<=this.outputLayer;y++){const N=this.sizes[y],D=this.weights[y],F=this.biases[y],z=this.outputs[y];for(let P=0;P<N;P++){const k=D[P];let R=F[P];for(let S=0;S<k.length;S++)R+=k[S]*d[S];z[P]=1/(1+Math.exp(-R))}g=d=z}if(!g)throw new Error("output was empty");return g}_runInputRelu(d){this.outputs[0]=d;let g=null;for(let y=1;y<=this.outputLayer;y++){const N=this.sizes[y],D=this.weights[y],F=this.biases[y],z=this.outputs[y];for(let P=0;P<N;P++){const k=D[P];let R=F[P];for(let S=0;S<k.length;S++)R+=k[S]*d[S];z[P]=R<0?0:R}g=d=z}if(!g)throw new Error("output was empty");return g}_runInputLeakyRelu(d){this.outputs[0]=d;const{leakyReluAlpha:g}=this.trainOpts;let y=null;for(let N=1;N<=this.outputLayer;N++){const D=this.sizes[N],F=this.weights[N],z=this.biases[N],P=this.outputs[N];for(let k=0;k<D;k++){const R=F[k];let S=z[k];for(let T=0;T<R.length;T++)S+=R[T]*d[T];P[k]=Math.max(S,g*S)}y=d=P}if(!y)throw new Error("output was empty");return y}_runInputTanh(d){this.outputs[0]=d;let g=null;for(let y=1;y<=this.outputLayer;y++){const N=this.sizes[y],D=this.weights[y],F=this.biases[y],z=this.outputs[y];for(let P=0;P<N;P++){const k=D[P];let R=F[P];for(let S=0;S<k.length;S++)R+=k[S]*d[S];z[P]=Math.tanh(R)}g=d=z}if(!g)throw new Error("output was empty");return g}verifyIsInitialized(d){this.sizes.length&&this.outputLayer>0||(this.sizes=[],this.sizes.push(d[0].input.length),this.options.hiddenLayers?this.options.hiddenLayers.forEach(g=>{this.sizes.push(g)}):this.sizes.push(Math.max(3,Math.floor(d[0].input.length/2))),this.sizes.push(d[0].output.length),this.initialize())}updateTrainingOptions(d){const g={...this.trainOpts,...d};this.validateTrainingOptions(g),this.trainOpts=g,this.setLogMethod(this.trainOpts.log)}validateTrainingOptions(d){const g={activation:()=>["sigmoid","relu","leaky-relu","tanh"].includes(d.activation),iterations:()=>{const y=d.iterations;return typeof y=="number"&&y>0},errorThresh:()=>{const y=d.errorThresh;return typeof y=="number"&&y>0&&y<1},log:()=>{const y=d.log;return typeof y=="function"||typeof y=="boolean"},logPeriod:()=>{const y=d.logPeriod;return typeof y=="number"&&y>0},leakyReluAlpha:()=>{const y=d.leakyReluAlpha;return typeof y=="number"&&y>0&&y<1},learningRate:()=>{const y=d.learningRate;return typeof y=="number"&&y>0&&y<1},momentum:()=>{const y=d.momentum;return typeof y=="number"&&y>0&&y<1},callback:()=>{const y=d.callback;return typeof y=="function"||y===void 0},callbackPeriod:()=>{const y=d.callbackPeriod;return typeof y=="number"&&y>0},timeout:()=>{const y=d.timeout;return typeof y=="number"&&y>0},praxis:()=>{const y=d.praxis;return!y||y==="adam"},beta1:()=>{const y=d.beta1;return y>0&&y<1},beta2:()=>{const y=d.beta2;return y>0&&y<1},epsilon:()=>{const y=d.epsilon;return y>0&&y<1}};for(const y in g){const N=d;if(!g[y]())throw new Error(`[${y}, ${N[y]}] is out of normal training range, your network will probably not train.`)}}getTrainOptsJSON(){const{activation:d,iterations:g,errorThresh:y,log:N,logPeriod:D,leakyReluAlpha:F,learningRate:z,momentum:P,callbackPeriod:k,timeout:R,praxis:S,beta1:T,beta2:G,epsilon:te}=this.trainOpts;return{activation:d,iterations:g,errorThresh:y,log:typeof N=="function"?!0:typeof N=="boolean"?N:!1,logPeriod:D,leakyReluAlpha:F,learningRate:z,momentum:P,callbackPeriod:k,timeout:R===1/0?"Infinity":R,praxis:S,beta1:T,beta2:G,epsilon:te}}setLogMethod(d){typeof d=="function"?this.trainOpts.log=d:d?this.trainOpts.log=this.logTrainingStatus:this.trainOpts.log=!1}logTrainingStatus(d){console.log(`iterations: ${d.iterations}, training error: ${d.error}`)}calculateTrainingError(d){let g=0;for(let y=0;y<d.length;++y)g+=this.trainPattern(d[y],!0);return g/d.length}trainPatterns(d){for(let g=0;g<d.length;++g)this.trainPattern(d[g])}trainingTick(d,g,y){const{callback:N,callbackPeriod:D,errorThresh:F,iterations:z,log:P,logPeriod:k}=this.trainOpts;return g.iterations>=z||g.error<=F||Date.now()>=y?!1:(g.iterations++,P&&g.iterations%k===0?(g.error=this.calculateTrainingError(d),P(g)):g.iterations%this.errorCheckInterval===0?g.error=this.calculateTrainingError(d):this.trainPatterns(d),N&&g.iterations%D===0&&N({iterations:g.iterations,error:g.error}),!0)}prepTraining(d,g={}){this.updateTrainingOptions(g);const y=this.formatData(d),N=Date.now()+this.trainOpts.timeout,D={error:1,iterations:0};return this.verifyIsInitialized(y),this.validateData(y),{preparedData:y,status:D,endTime:N}}train(d,g={}){const{preparedData:y,status:N,endTime:D}=this.prepTraining(d,g);for(;this.trainingTick(y,N,D););return N}async trainAsync(d,g={}){const{preparedData:y,status:N,endTime:D}=this.prepTraining(d,g);return await new Promise((F,z)=>{try{const P=new Ce.Thaw(new Array(this.trainOpts.iterations),{delay:!0,each:()=>this.trainingTick(y,N,D)||P.stop(),done:()=>F(N)});P.tick()}catch(P){z(P)}})}trainPattern(d,g){return this.runInput(d.input),this.calculateDeltas(d.output),this.adjustWeights(),g?Je(this.errors[this.outputLayer]):null}_calculateDeltasSigmoid(d){for(let g=this.outputLayer;g>=0;g--){const y=this.sizes[g],N=this.outputs[g],D=this.errors[g],F=this.deltas[g],z=this.weights[g+1];for(let P=0;P<y;P++){const k=N[P];let R=0;if(g===this.outputLayer)R=d[P]-k;else{const S=this.deltas[g+1];for(let T=0;T<S.length;T++)R+=S[T]*z[T][P]}D[P]=R,F[P]=R*k*(1-k)}}}_calculateDeltasRelu(d){for(let g=this.outputLayer;g>=0;g--){const y=this.sizes[g],N=this.outputs[g],D=this.weights[g+1],F=this.deltas[g+1],z=this.errors[g],P=this.deltas[g];for(let k=0;k<y;k++){const R=N[k];let S=0;if(g===this.outputLayer)S=d[k]-R;else for(let T=0;T<F.length;T++)S+=F[T]*D[T][k];z[k]=S,P[k]=R>0?S:0}}}_calculateDeltasLeakyRelu(d){const g=this.trainOpts.leakyReluAlpha;for(let y=this.outputLayer;y>=0;y--){const N=this.sizes[y],D=this.outputs[y],F=this.deltas[y+1],z=this.weights[y+1],P=this.errors[y],k=this.deltas[y];for(let R=0;R<N;R++){const S=D[R];let T=0;if(y===this.outputLayer)T=d[R]-S;else for(let G=0;G<F.length;G++)T+=F[G]*z[G][R];P[R]=T,k[R]=S>0?T:g*T}}}_calculateDeltasTanh(d){for(let g=this.outputLayer;g>=0;g--){const y=this.sizes[g],N=this.outputs[g],D=this.deltas[g+1],F=this.weights[g+1],z=this.errors[g],P=this.deltas[g];for(let k=0;k<y;k++){const R=N[k];let S=0;if(g===this.outputLayer)S=d[k]-R;else for(let T=0;T<D.length;T++)S+=D[T]*F[T][k];z[k]=S,P[k]=(1-R*R)*S}}}adjustWeights(){const{learningRate:d,momentum:g}=this.trainOpts;for(let y=1;y<=this.outputLayer;y++){const N=this.outputs[y-1],D=this.sizes[y],F=this.deltas[y],z=this.changes[y],P=this.weights[y],k=this.biases[y];for(let R=0;R<D;R++){const S=F[R];for(let T=0;T<N.length;T++){let G=z[R][T];G=d*S*N[T]+g*G,z[R][T]=G,P[R][T]+=G}k[R]+=d*S}}}_setupAdam(){this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[],this.iterations=0;for(let d=0;d<=this.outputLayer;d++){const g=this.sizes[d];if(d>0){this.biasChangesLow[d]=Ye(g),this.biasChangesHigh[d]=Ye(g),this.changesLow[d]=new Array(g),this.changesHigh[d]=new Array(g);for(let y=0;y<g;y++){const N=this.sizes[d-1];this.changesLow[d][y]=Ye(N),this.changesHigh[d][y]=Ye(N)}}}this.adjustWeights=this._adjustWeightsAdam}_adjustWeightsAdam(){this.iterations++;const{iterations:d}=this,{beta1:g,beta2:y,epsilon:N,learningRate:D}=this.trainOpts;for(let F=1;F<=this.outputLayer;F++){const z=this.outputs[F-1],P=this.sizes[F],k=this.deltas[F],R=this.changesLow[F],S=this.changesHigh[F],T=this.weights[F],G=this.biases[F],te=this.biasChangesLow[F],Te=this.biasChangesHigh[F];for(let ie=0;ie<P;ie++){const _e=k[ie];for(let vt=0;vt<z.length;vt++){const Q=_e*z[vt],U=R[ie][vt]*g+(1-g)*Q,Me=S[ie][vt]*y+(1-y)*Q*Q,Fe=U/(1-Math.pow(g,d)),bt=Me/(1-Math.pow(y,d));R[ie][vt]=U,S[ie][vt]=Me,T[ie][vt]+=D*Fe/(Math.sqrt(bt)+N)}const Y=k[ie],re=te[ie]*g+(1-g)*Y,be=Te[ie]*y+(1-y)*Y*Y,ke=te[ie]/(1-Math.pow(g,d)),rt=Te[ie]/(1-Math.pow(y,d));te[ie]=re,Te[ie]=be,G[ie]+=D*ke/(Math.sqrt(rt)+N)}}}validateData(d){const g=this.sizes[0],y=this.sizes[this.sizes.length-1],{length:N}=d;for(let D=0;D<N;D++){const{input:F,output:z}=d[D];if(F.length!==g)throw new Error(`input at index ${D} length ${F.length} must be ${g}`);if(d[D].output.length!==y)throw new Error(`output at index ${D} length ${z.length} must be ${y}`)}}validateInput(d){const g=this.sizes[0];if(d.length!==g)throw new Error(`input length ${d.length} must match options.inputSize of ${g}`)}formatData(d){if(!Array.isArray(d[0].input))if(this.inputLookup)this.inputLookupLength=Object.keys(this.inputLookup).length;else{const g=new nt(d,"input");this.inputLookup=g.table,this.inputLookupLength=g.length}if(!Array.isArray(d[0].output))if(this.outputLookup)this.outputLookupLength=Object.keys(this.outputLookup).length;else{const g=new nt(d,"output");this.outputLookup=g.table,this.outputLookupLength=g.length}if(this._formatInput||(this._formatInput=it(d[0].input,this.inputLookup)),this._formatOutput||(this._formatOutput=it(d[0].output,this.outputLookup)),this._formatInput&&this._formatOutput){const g=[];for(let y=0;y<d.length;y++)g.push({input:this._formatInput(d[y].input),output:this._formatOutput(d[y].output)});return g}if(this._formatInput){const g=[];for(let y=0;y<d.length;y++)g.push({input:this._formatInput(d[y].input),output:d[y].output});return g}if(this._formatOutput){const g=[];for(let y=0;y<d.length;y++)g.push({input:d[y].input,output:this._formatOutput(d[y].output)});return g}return d}addFormat(d){var g,y;(!Array.isArray(d.input)||typeof d.input[0]!="number")&&(this.inputLookup=me.addKeys(d.input,(g=this.inputLookup)!==null&&g!==void 0?g:{}),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length)),(!Array.isArray(d.output)||typeof d.output[0]!="number")&&(this.outputLookup=me.addKeys(d.output,(y=this.outputLookup)!==null&&y!==void 0?y:{}),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length))}test(d){const{preparedData:g}=this.prepTraining(d),y=g[0].output.length===1,N=[];let D=0;if(y){let F=0,z=0,P=0,k=0;for(let R=0;R<g.length;R++){const S=this.runInput(g[R].input),T=g[R].output,G=S[0]>this.options.binaryThresh?1:0,te=T[0];if(G!==te){const Te=g[R];N.push({input:Te.input,output:Te.output,actual:G,expected:te})}G===0&&te===0?k++:G===1&&te===1?P++:G===0&&te===1?z++:G===1&&te===0&&F++,D+=Je(S.map((Te,ie)=>T[ie]-Te))}return{error:D/g.length,misclasses:N,total:g.length,trueNeg:k,truePos:P,falseNeg:z,falsePos:F,precision:P>0?P/(P+F):0,recall:P>0?P/(P+z):0,accuracy:(k+P)/g.length}}for(let F=0;F<g.length;F++){const z=this.runInput(g[F].input),P=g[F].output,k=z.indexOf(je(z)),R=P.indexOf(je(P));if(k!==R){const S=g[F];N.push({input:S.input,output:S.output,actual:k,expected:R})}D+=Je(z.map((S,T)=>P[T]-S))}return{error:D/g.length,misclasses:N,total:g.length}}toJSON(){var d,g;this.isRunnable||this.initialize();const y=this.weights.map(z=>z.map(P=>Array.from(P))),N=this.biases.map(z=>Array.from(z)),D=[],F=this.sizes.length-1;for(let z=0;z<=F;z++)D.push({weights:(d=y[z])!==null&&d!==void 0?d:[],biases:(g=N[z])!==null&&g!==void 0?g:[]});return{type:"NeuralNetwork",sizes:[...this.sizes],layers:D,inputLookup:this.inputLookup?{...this.inputLookup}:null,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup?{...this.outputLookup}:null,outputLookupLength:this.outputLookupLength,options:{...this.options},trainOpts:this.getTrainOptsJSON()}}fromJSON(d){if(this.options={...ct(),...d.options},d.hasOwnProperty("trainOpts")){const D={...d.trainOpts,timeout:d.trainOpts.timeout==="Infinity"?1/0:d.trainOpts.timeout};this.updateTrainingOptions(D)}this.sizes=d.sizes,this.initialize(),this.inputLookup=d.inputLookup?{...d.inputLookup}:null,this.inputLookupLength=d.inputLookupLength,this.outputLookup=d.outputLookup?{...d.outputLookup}:null,this.outputLookupLength=d.outputLookupLength;const g=d.layers,y=this.weights.map((D,F)=>g[F].weights.map(z=>Float32Array.from(z))),N=this.biases.map((D,F)=>Float32Array.from(g[F].biases));for(let D=0;D<=this.outputLayer;D++)this.weights[D]=y[D]||[],this.biases[D]=N[D]||[];return this}toFunction(d){const{activation:g,leakyReluAlpha:y}=this.trainOpts;let N=!1;const D=(S,T)=>{if(S===0)return`(input[${T}]||0)`;const G=this.weights[S][T],te=this.biases[S][T];if(!G)throw new Error(`weights at layerIndex ${S} & nodeIndex ${T} not found`);if(!te)throw new Error(`bias as layerIndex ${S} & nodeIndex ${T} not found`);const Te=[];G.forEach((_e,Y)=>{_e<0?Te.push(`${_e}*${D(S-1,Y)}`):Te.push(`+${_e}*${D(S-1,Y)}`)});const ie=`(${te.toString()}${Te.join("")})`;switch(g){case"sigmoid":return`1/(1+1/Math.exp(${ie}))`;case"relu":return N=!0,`((v=${ie})<0?0:v)`;case"leaky-relu":return N=!0,`Math.max((v=${ie}),${y}*v)`;case"tanh":return`Math.tanh(${ie})`;default:throw new Error(`Unknown activation ${g}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}};function F(S){if(S.find(T=>T.includes('"')))throw new Error(`key contains '"', which is not compatible`)}const z=[];let P,k="";if(this.inputLookup){const S=Object.keys(this.inputLookup);F(S),k=`input = new Float32Array([${Object.keys(this.inputLookup).map(T=>`input["${T}"]`).join(",")}]);`}if(this.sizes.length<1)throw new Error("No layers");for(let S=0;S<this.sizes[this.outputLayer];S++)z.push(D(this.outputLayer,S));if(this.outputLookup){const S=Object.keys(this.outputLookup);F(S),P=`{${S.map((G,te)=>`"${G}":${z[te]}`).join(",")}}`}else P=`[${z.join(",")}]`;const R=`${k}${N?"var v;":""}return ${P};`;return new Function("input",d?d(R):R)}}let Wt=null;function qt(O){Wt=O}function kt(O,d){let g=Wt;return g===null&&(g=new he.GPU({mode:"gpu"}),qt(g)),g.createKernel(O,d).setPipeline(!0)}function Pe(O,d,g){let y=Wt;return y===null&&(y=new he.GPU({mode:"gpu"}),qt(y)),y.createKernelMap(O,d,g).setPipeline(!0)}function $t(O,d){return new he.Input(O,d)}function Pt(O){O instanceof he.Texture&&O.delete()}function Tn(O){if(O instanceof he.Texture){O.clear();return}if(Array.isArray(O)){if(typeof O[0]=="number")O.fill(0);else if(typeof O[0][0]=="number"){for(let d=0;d<O.length;d++)O[d].fill(0);return}else if(typeof O[0][0][0]=="number"){for(let d=0;d<O.length;d++){const g=O[d];for(let y=0;y<g.length;y++)g[y].fill(0)}return}}if(O instanceof Float32Array){O.fill(0);return}throw new Error("unhandled value")}function _t(O){if(O instanceof he.Texture)return O.clone();if(O instanceof Float32Array)return O.slice(0);if(Array.isArray(O)){if(typeof O[0]=="number")return O.slice(0);if(typeof O[0][0]=="number"){const d=new Array(O.length);for(let g=0;g<O.length;g++)d[g]=O[g].slice(0);return d}else if(typeof O[0][0][0]=="number"){const d=new Array(O.length);for(let g=0;g<O.length;g++){const y=O[g],N=new Array(y.length);for(let D=0;D<y.length;D++)N[D]=y[D].slice(0)}return d}}throw new Error("unhandled value")}function rn(O,d,g){let y=d[this.thread.x];for(let N=0;N<this.constants.size;N++)y+=O[this.thread.x][N]*g[N];return 1/(1+Math.exp(-y))}function Jt(O,d,g){let y=d[this.thread.x];for(let N=0;N<this.constants.size;N++)y+=O[this.thread.x][N]*g[N];return y<0?0:y}function En(O,d,g){let y=d[this.thread.x];for(let N=0;N<this.constants.size;N++)y+=O[this.thread.x][N]*g[N];return y<0?0:.01*y}function wn(O,d,g){let y=d[this.thread.x];for(let N=0;N<this.constants.size;N++)y+=O[this.thread.x][N]*g[N];return Math.tanh(y)}function Un(O,d){return d-O}function ii(O,d){return O*d*(1-d)}function Bn(O,d){return d>0?O:0}function li(O,d){return d>0?O:.01*O}function Xn(O,d){return(1-d*d)*O}function cn(O,d,g,y){let N=0;for(let D=0;D<d;D++)N+=y[D]*g[D][O];return N}function $n(O,d,g,y,N){return O*y*N+d*g}function hn(O,d){return O+d}function nr(O,d){return O[this.thread.x]+d[this.thread.x]*this.constants.learningRate}function Jn(O){let d=0;for(let g=0;g<this.constants.size;g++)d+=O[g]**2;return d/this.constants.size}class vn extends Ft{constructor(d={}){super(d),this.texturizeInputData=()=>{throw new Error("not yet setup")},this.forwardPropagate=[],this.backwardPropagate=[],this.changesPropagate=[],this.biasesPropagate=[],this.getMSE=()=>{throw new Error("not yet setup")},this._addMSE=()=>{throw new Error("not yet setup")},this._divideMSESum=()=>{throw new Error("not yet setup")},this.outputs=[],this.deltas=[],this.errors=[],this.weights=[],this.changes=[],this.biases=[],this.runInput=g=>{let y;this.outputs[0]=g;for(let N=1;N<=this.outputLayer;N++)Pt(this.outputs[N]),this.outputs[N]=this.forwardPropagate[N](this.weights[N],this.biases[N],g),y=g=this.outputs[N];return y},this.calculateDeltas=g=>{for(let y=this.outputLayer;y>0;y--){Pt(this.deltas[y]),Pt(this.errors[y]);let N;y===this.outputLayer?N=this.backwardPropagate[y](this.outputs[y],g):N=this.backwardPropagate[y](this.weights[y+1],this.outputs[y],this.deltas[y+1]),this.deltas[y]=N.result,this.errors[y]=N.error}},this.errorCheckInterval=100,this.gpu=new he.GPU({mode:d.mode})}initialize(){super.initialize(),this.buildRunInput(),this.buildCalculateDeltas(),this.buildGetChanges(),this.buildChangeBiases(),this.buildGetMSE()}setActivation(){}trainPattern(d,g){return this.runInput(d.input),this.calculateDeltas(d.output),this.adjustWeights(),g?this.getMSE(this.errors[this.outputLayer]):null}calculateTrainingError(d){let g=new Float32Array([0]);for(let N=0;N<d.length;++N){const D=g,F=this.trainPattern(d[N],!0);g=this._addMSE(g,F),Pt(F),Pt(D)}const y=this._divideMSESum(d.length,g);return Pt(g),(y instanceof he.Texture?y.toArray():y)[0]}adjustWeights(){this.getChanges(),this.changeBiases()}buildRunInput(){let d=null;switch(this.trainOpts.activation){case"sigmoid":d=rn;break;case"relu":d=Jt;break;case"leaky-relu":d=En;break;case"tanh":d=wn;break;default:throw new Error(`Unknown activation ${this.trainOpts.activation}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}for(let g=1;g<=this.outputLayer;g++)this.forwardPropagate[g]=this.gpu.createKernel(d,{output:[this.sizes[g]],pipeline:!0,constants:{size:this.sizes[g-1]},immutable:!0});this.texturizeInputData=this.gpu.createKernel(function(g){return g[this.thread.x]},{output:[this.sizes[1]],pipeline:!0,immutable:!0})}buildCalculateDeltas(){let d;switch(this.trainOpts.activation){case"sigmoid":d=ii;break;case"relu":d=Bn;break;case"leaky-relu":d=li;break;case"tanh":d=Xn;break;default:throw new Error(`Unknown activation ${this.trainOpts.activation}. Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'`)}d=he.alias(he.utils.getMinifySafeName(()=>d),d),this.gpu.addFunction(d);for(let g=this.outputLayer;g>0;g--)g===this.outputLayer?this.backwardPropagate[this.outputLayer]=this.gpu.createKernelMap({error:Un},function(y,N){const D=y[this.thread.x],F=N[this.thread.x];return d(Un(D,F),D)},{output:[this.sizes[this.outputLayer]],pipeline:!0,immutable:!0}):this.backwardPropagate[g]=this.gpu.createKernelMap({error:cn},function(y,N,D){const F=N[this.thread.x];return d(cn(this.thread.x,this.constants.size,y,D),F)},{output:[this.sizes[g]],pipeline:!0,constants:{size:this.sizes[g+1]},immutable:!0})}buildGetChanges(){for(let d=1;d<=this.outputLayer;d++)this.changesPropagate[d]=this.gpu.createKernelMap({weights:hn,changes:$n},function(g,y,N,D){const F=$n(this.constants.learningRate,this.constants.momentum,D[this.thread.y][this.thread.x],y[this.thread.y],g[this.thread.x]);return hn(F,N[this.thread.y][this.thread.x])},{output:[this.sizes[d-1],this.sizes[d]],pipeline:!0,constants:{size:this.sizes[d-1],learningRate:this.trainOpts.learningRate,momentum:this.trainOpts.momentum},immutable:!0})}getChanges(){for(let d=1;d<=this.outputLayer;d++){const g=this.weights[d],y=this.changes[d],N=this.changesPropagate[d](this.outputs[d-1],this.deltas[d],g,y);Pt(g),Pt(y),this.weights[d]=N.weights,this.changes[d]=N.changes,Pt(N.result)}}buildChangeBiases(){for(let d=1;d<=this.outputLayer;d++)this.biasesPropagate[d]=this.gpu.createKernel(nr,{output:[this.sizes[d]],pipeline:!0,constants:{learningRate:this.trainOpts.learningRate},immutable:!0})}changeBiases(){for(let d=1;d<=this.outputLayer;d++){const g=this.biases[d];this.biases[d]=this.biasesPropagate[d](g,this.deltas[d]),Pt(g)}}buildGetMSE(){this.getMSE=this.gpu.createKernel(Jn,{output:[1],constants:{size:this.sizes[this.outputLayer]},pipeline:!0,immutable:!0}),this._addMSE=this.gpu.createKernel(function(d,g){return d[0]+g[0]},{output:[1],pipeline:!0,immutable:!0}),this._divideMSESum=this.gpu.createKernel(function(d,g){const y=g[0];return y>0?y/d:0},{output:[1]})}run(d){if(!this.isRunnable)throw new Error("network not runnable");let g;this.inputLookup?g=me.toArray(this.inputLookup,d,this.inputLookupLength):g=d,this.validateInput(g);const y=this.runInput(g),N=y instanceof he.Texture?y.toArray():y;return this.outputLookup?me.toObject(this.outputLookup,N):N}prepTraining(d,g={}){this.updateTrainingOptions(g);const y=this.formatData(d),N=Date.now()+this.trainOpts.timeout,D={error:1,iterations:0};this.verifyIsInitialized(y);const F=this.gpu.createKernel(function(z){return z[this.thread.x]},{output:[y[0].output.length],pipeline:!0,immutable:!0});return{preparedData:y.map(z=>({input:this.texturizeInputData(z.input),output:F(z.output)})),status:D,endTime:N}}toFunction(){throw new Error(`${this.constructor.name}-toFunction is not yet implemented`)}toJSON(){var d,g;this.sizes===null&&this.initialize();const y=this.weights.map(F=>(F instanceof he.Texture?F.toArray():F).map(z=>Array.from(z))),N=this.biases.map(F=>Array.from(F instanceof he.Texture?F.toArray():F)),D=[];for(let F=0;F<=this.outputLayer;F++)D.push({weights:(d=y[F])!==null&&d!==void 0?d:[],biases:(g=N[F])!==null&&g!==void 0?g:[]});return{type:"NeuralNetworkGPU",sizes:[...this.sizes],layers:D,inputLookup:this.inputLookup?{...this.inputLookup}:null,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup?{...this.outputLookup}:null,outputLookupLength:this.outputLookupLength,options:{...this.options},trainOpts:this.getTrainOptsJSON()}}}class On extends Error{constructor(d){super(`Cannot run a ${d.constructor.name} before it is trained.`)}}class qn{constructor(d){d??(d={}),d.binaryThresh,d.hiddenLayers,d.decodedSize&&d.decodedSize,this.denoiser=new vn(d)}denoise(d){return this.denoiser.run(d)}decode(d){if(!this.decoder)throw new On(this);return this.decoder.run(d)}encode(d){if(!this.denoiser)throw new On(this);this.denoiser.run(d);let g=this.encodedLayer;return g instanceof he.Texture?g=g.toArray():g=g.slice(0),g}likelyIncludesAnomalies(d,g=.2){var y;const N=[],D=this.denoise(d);for(let P=0;P<((y=d.length)!==null&&y!==void 0?y:0);P++)N[P]=Math.abs(d[P]-D[P]);return N.reduce((P,k)=>P+k)/d.length>g}train(d,g){const y=[];for(const D of d)y.push({input:D,output:D});const N=this.denoiser.train(y,g);return this.decoder=this.createDecoder(),N}createDecoder(){const d=this.denoiser.toJSON(),g=[],y=[];for(let D=this.encodedLayerIndex;D<this.denoiser.sizes.length;D++)g.push(d.layers[D]),y.push(d.sizes[D]);return d.layers=g,d.sizes=y,d.options.inputSize=d.sizes[0],new vn().fromJSON(d)}get encodedLayer(){return this.denoiser.outputs[this.encodedLayerIndex]}get encodedLayerIndex(){return Math.round(this.denoiser.outputs.length*.5)-1}}class un{constructor(d){this.json={avgs:{error:0,iterations:0,testTime:0,trainTime:0},stats:{total:0,testSize:0,trainSize:0},sets:[]},this.initClassifier=d}testPartition(d,g,y){const N=this.initClassifier(),D=Date.now(),F=N.train(g,d),z=Date.now(),P=N.test(y),k=Date.now();return{...P,trainTime:z-D,testTime:k-z,iterations:F.iterations,error:F.error,total:P.total,network:N.toJSON()}}shuffleArray(d){for(let g=d.length-1;g>0;g--){const y=Math.floor(Math.random()*(g+1)),N=d[g];d[g]=d[y],d[y]=N}return d}train(d,g={},y=4){if(d.length<y)throw new Error(`Training set size is too small for ${d.length} k folds of ${y}`);this.shuffleArray(d);const N=d.length/y,D={trainTime:0,testTime:0,iterations:0,error:0},F={total:0,testSize:0,trainSize:0},z={total:0,testSize:0,trainSize:0,truePos:0,trueNeg:0,falsePos:0,falseNeg:0,precision:0,recall:0,accuracy:0},P=[];let k=null;for(let R=0;R<y;R++){const S=d.slice(0),T=S.splice(R*N,N),G=S,te=this.testPartition(g,G,T);k===null&&(k=te.hasOwnProperty("falseNeg")&&te.hasOwnProperty("falsePos")&&te.hasOwnProperty("trueNeg")&&te.hasOwnProperty("truePos"),k&&Object.assign(F,z)),D.iterations+=te.iterations,D.testTime+=te.testTime,D.trainTime+=te.trainTime,D.error+=te.error,F.total+=te.total,un.isBinaryStats(F)&&un.isBinaryPartitionResults(te)&&(F.accuracy+=te.accuracy,F.falseNeg+=te.falseNeg,F.falsePos+=te.falsePos,F.precision+=te.precision,F.recall+=te.recall,F.trueNeg+=te.trueNeg,F.truePos+=te.truePos),P.push(te)}return D.error/=y,D.iterations/=y,D.testTime/=y,D.trainTime/=y,un.isBinaryStats(F)&&(F.precision=F.truePos/(F.truePos+F.falsePos),F.recall=F.truePos/(F.truePos+F.falseNeg),F.accuracy=(F.trueNeg+F.truePos)/F.total),F.testSize=N,F.trainSize=d.length-N,this.json={avgs:D,stats:F,sets:P},this.json}toNeuralNetwork(){return this.fromJSON(this.json)}toJSON(){return this.json}fromJSON(d){const g=d.sets.reduce((y,N)=>y.error<N.error?y:N);return this.initClassifier().fromJSON(g.network)}}un.isBinaryStats=O=>O.accuracy!==void 0,un.isBinaryResults=O=>O.stats.accuracy!==void 0,un.isBinaryPartitionResults=O=>O.accuracy!==void 0;function Pi(O){let d=0;for(let g=0;g<this.constants.height;g++)for(let y=0;y<this.constants.width;y++)d+=O[g][y]**2;return d/this.constants.length}class Mn{constructor({width:d,height:g}){this.calculate=kt(Pi,{output:[1],constants:{width:d,height:g,length:d*g},immutable:!0}),this.addAbsolute=kt(function(y,N){return y[0]+Math.abs(N[0][0])},{output:[1],immutable:!0}),this.add=kt(function(y,N){return y[0]+N[0]},{output:[1],immutable:!0}),this.divide=kt(function(y,N){const D=N[0];return D>0?D/y:0},{output:[1],immutable:!0})}}const Sn={width:1,height:1,depth:null,weights:null,deltas:null,praxis:null,praxisOpts:null,cleanupDeltas:!0};class Qn{constructor(d){this.praxis=null,this.predictKernel=null,this.compareKernel=null,d?this.settings={...Sn,...d}:this.settings={...Sn},this.setupPraxis()}get width(){var d;return(d=this.settings.width)!==null&&d!==void 0?d:0}get height(){var d;return(d=this.settings.height)!==null&&d!==void 0?d:0}get depth(){var d;return(d=this.settings.depth)!==null&&d!==void 0?d:0}get weights(){return this.settings.weights}set weights(d){this.settings.weights=d,this.settings.cleanupDeltas&&this.deltas&&Tn(this.deltas)}get deltas(){return this.settings.deltas}set deltas(d){this.settings.deltas=d}get id(){var d;return(d=this.settings.id)!==null&&d!==void 0?d:""}set id(d){this.settings.id=d}setupPraxis(){const{initPraxis:d,praxis:g,praxisOpts:y}=this.settings;this.praxis||(d?y?this.praxis=d(this,y):this.praxis=d(this):g&&(this.praxis=g))}validate(){if(Number.isNaN(this.height))throw new Error(`${this.constructor.name} layer height is not a number`);if(Number.isNaN(this.width))throw new Error(`${this.constructor.name} layer width is not a number`);if(this.height<1)throw new Error(`${this.constructor.name} layer height is less than 1`);if(this.width<1)throw new Error(`${this.constructor.name} layer width is less than 1`)}setupKernels(d){}reuseKernels(d){if(d.width!==this.width)throw new Error(`${this.constructor.name} kernel width mismatch ${d.width} is not ${this.width}`);if(d.height!==this.height)throw new Error(`${this.constructor.name} kernel width mismatch ${d.height} is not ${this.height}`);if(d.hasOwnProperty("predictKernel")&&d.predictKernel!==null){if(!d.predictKernel.immutable)throw new Error(`${d.constructor.name}.predictKernel is not reusable, set kernel.immutable = true`);this.predictKernel=d.predictKernel}if(d.hasOwnProperty("compareKernel")&&d.compareKernel!==null){if(!d.compareKernel.immutable)throw new Error(`${d.constructor.name}.compareKernel is not reusable, set kernel.immutable = true`);this.compareKernel=d.compareKernel}this.praxis=d.praxis}predict(d){}compare(d){}learn(d){}toArray(){return Array.isArray(this.weights)?this.weights:this.weights.toArray()}toJSON(){return Qn.toJSON(this)}static toJSON(d){const{weights:g}=d;return{width:d.width,height:d.height,depth:d.depth,weights:tn(g&&g instanceof he.Texture?g.toArray():g),type:d.constructor.name,praxisOpts:d.praxis?d.praxis.toJSON():null}}}function tn(O){if(O===null)return null;if(Array.isArray(O)){if(typeof O[0]=="number")return O;if(Array.isArray(O[0])&&typeof O[0][0]=="number")return O;if(Array.isArray(O[0][0])&&typeof O[0][0][0]=="number")return O;if(O[0]instanceof Float32Array)return O.map(g=>Array.from(g));if(O[0][0]instanceof Float32Array)return O.map(g=>g.map(y=>Array.from(y)))}else if(O)return Array.from(O);throw new Error("unexpected value")}function Gt(O,d){const g=new Array(d);for(let y=0;y<d;y++)g[y]=Ye(O);return g}function Kn(O,d,g){const y=new Array(g);for(let N=0;N<g;N++)y[N]=Gt(O,d);return y}class Nr extends Qn{constructor(d,g){super(g),this.inputLayer=d;const{width:y,height:N,depth:D}=this;this.predictKernel=null,this.compareKernel=null,this.validate(),D>0?(this.weights=Kn(y,N,D),this.deltas=Kn(y,N,D)):N>0&&(this.weights=Gt(y,N),this.deltas=Gt(y,N)),this.setupPraxis()}get width(){return this.inputLayer.width}get height(){return this.inputLayer.height}get depth(){return this.inputLayer.depth}}class vr extends Qn{constructor(d,g){super(),this.settings=d,this.inputLayer=g}get width(){return this.inputLayer.width}get height(){return this.inputLayer.height}get depth(){return this.inputLayer.depth}get filterCount(){return this.settings.filterCount}get filterWidth(){return this.settings.filterWidth}get filterHeight(){return this.settings.filterHeight}get filters(){return this.settings.filters}set filters(d){this.settings.filters=d}get filterDeltas(){return this.settings.filterDeltas}set filterDeltas(d){this.settings.filterDeltas=d}}class Pr{constructor(){this.predictKernel=null,this.compareKernel=null,this.praxis=null}get width(){return this.settings.width}get height(){return this.settings.height}get depth(){return this.settings.depth}get weights(){return this.settings.weights}set weights(d){this.settings.weights=d}get deltas(){return this.settings.deltas}set deltas(d){this.settings.deltas=d}toJSON(){return Qn.toJSON(this)}}class Ri extends Qn{constructor(d,g){super({...g,width:d.width,height:d.height,depth:d.depth}),this.inputLayer=d}validate(){var d;if(super.validate(),this.width!==this.inputLayer.width)throw new Error(`width of ${this.width} does not match inputLayer.width of ${this.inputLayer.width}`);if(this.height!==this.inputLayer.height)throw new Error(`height of ${this.height} does not match inputLayer.height of ${this.inputLayer.height}`);if(this.depth!==((d=this.inputLayer.depth)!==null&&d!==void 0?d:0))throw new Error(`depth of ${this.depth} does not match inputLayer.depth of ${this.inputLayer.depth}`)}}class pn extends Qn{constructor(d,g,y){super(y),this.inputLayer1=d,this.inputLayer2=g,this.validate(),this.weights=Gt(this.width,this.height),this.deltas=Gt(this.width,this.height),this.setupPraxis()}}function Ra(O,d){return O[this.thread.y][this.thread.x]-d[this.thread.x]}function sa(O,d){return O[this.thread.y][this.thread.x]-d[this.thread.y][this.thread.x]}class Or extends Qn{constructor(d,g){if(super(d),this.inputLayer=g,this.validate(),this.depth)throw new Error("Target layer not implemented for depth");this.height?(this.weights=Gt(this.width,this.height),this.deltas=Gt(this.width,this.height),this.errors=Gt(this.width,this.height)):(this.weights=Ye(this.width),this.deltas=Ye(this.width),this.errors=Ye(this.width))}setupKernels(){this.width===1?this.compareKernel=kt(Ra,{output:[this.width,this.height],immutable:!0}):this.compareKernel=kt(sa,{output:[this.width,this.height],immutable:!0})}predict(){Pt(this.weights),this.weights=_t(this.inputLayer.weights)}compare(d){Pt(this.deltas),Pt(this.errors),Pt(this.inputLayer.deltas),this.deltas=this.compareKernel(this.weights,d),this.inputLayer.deltas=_t(this.deltas),this.errors=_t(this.deltas)}setupPraxis(){}}function bs(O,d){return new Or(O,d)}class Oi{}class ir extends Qn{}class cr extends Qn{learn(d){const{weights:g}=this;if(!this.praxis)throw new Error("this.praxis not defined");this.weights=this.praxis.run(this,d),Pt(g)}}class cs{constructor(d,g={}){this.layerTemplate=d,this.settings={...g},this.kernel=null}get width(){return this.layerTemplate.width}get height(){return this.layerTemplate.height}get depth(){return this.layerTemplate.depth}setupKernels(){}reuseKernels(d){if(d.width!==this.width)throw new Error(`${this.constructor.name} kernel width mismatch ${d.width} is not ${this.width}`);if(d.height!==this.height)throw new Error(`${this.constructor.name} kernel width mismatch ${d.height} is not ${this.height}`);d.hasOwnProperty("kernel")&&(this.kernel=d.kernel)}toJSON(){return{...this.settings}}}function ns(O,d){return O[this.thread.y][this.thread.x]+this.constants.learningRate*d[this.thread.y][this.thread.x]}const qi={learningRate:.3};class Yi extends cs{constructor(d,g){super(d),this.settings={...qi,...g},this.kernel=null}run(d){return this.kernel(d.weights,d.deltas)}setupKernels(){var d;this.kernel=kt(ns,{output:[this.width,this.height],constants:{learningRate:(d=this.settings.learningRate)!==null&&d!==void 0?d:.01}})}}function Xr(O,d){return new Yi(O,d)}function hs(O){return O}function ya(O,d,g,y){const N=O[this.thread.y][this.thread.x],D=y[this.thread.y][0],F=d[this.thread.y][this.thread.x],z=g[this.thread.x][0],P=this.constants.learningRate*D*z+this.constants.momentum*N;return F+P}const Ba={learningRate:.3,momentum:.1,weightsLayer:null,incomingLayer:null,deltaLayer:null};class ds extends cs{constructor(d,g){super(d),this.kernelMap=null,this.settings={...Ba,...g},this.changes=Gt(d.width,d.height)}get learningRate(){return this.settings.learningRate}get momentum(){return this.settings.momentum}get weightsLayer(){return this.settings.weightsLayer}set weightsLayer(d){this.settings.weightsLayer=d}get deltaLayer(){return this.settings.deltaLayer}set deltaLayer(d){this.settings.deltaLayer=d}get incomingLayer(){return this.settings.incomingLayer}set incomingLayer(d){this.settings.incomingLayer=d}run(){const d=this.kernelMap(this.changes,this.weightsLayer.weights,this.incomingLayer.weights,this.deltaLayer.deltas);return this.changes=d.changes,d.result}setupKernels(){this.kernelMap=Pe({changes:hs},ya,{output:[this.width,this.height],constants:{learningRate:this.learningRate,momentum:this.momentum}})}}function Jr(O,d){return new ds(O,d)}function ro(O,d,g){return g*d+(1-d)*O*O}function Ms(O,d,g){return O>d?d:O<g?g:O}function Fs(O,d,g){const y=d[this.thread.y][this.thread.x],N=Ms(y,this.constants.clipValue,-this.constants.clipValue),D=O[this.thread.y][this.thread.x],F=g[this.thread.y][this.thread.x],z=ro(y,this.constants.decayRate,F);return D+-this.constants.learningRate*N/Math.sqrt(z+this.constants.smoothEps)-this.constants.regularizationStrength*D}const aa={decayRate:.999,regularizationStrength:1e-6,learningRate:.01,smoothEps:1e-8,clipValue:5};class js extends cs{constructor(d,g={}){super(d),this.kernelMap=null,this.settings={...aa,...g},this.momenta=Gt(d.width,d.height)}get clipValue(){return this.settings.clipValue}get decayRate(){return this.settings.decayRate}get learningRate(){return this.settings.learningRate}get regularizationStrength(){return this.settings.regularizationStrength}get smoothEps(){return this.settings.smoothEps}run(d){const{momenta:g,result:y}=this.kernelMap(d.weights,d.deltas,this.momenta);return Pt(this.momenta),this.momenta=g,y}setupKernels(){this.kernelMap=Pe({momenta:ro},Fs,{output:[this.width,this.height],constants:{clipValue:this.clipValue,decayRate:this.decayRate,learningRate:this.learningRate,regularizationStrength:this.regularizationStrength,smoothEps:this.smoothEps},functions:[Ms],immutable:!0})}}function hr(O,d){return new js(O,d)}var va=Object.freeze({__proto__:null,ArthurDeviationBiases:Yi,arthurDeviationBiases:Xr,ArthurDeviationWeights:ds,arthurDeviationWeights:Jr,MomentumRootMeanSquaredPropagation:js,momentumRootMeanSquaredPropagation:hr,MRmsProp:js,mRmsProp:hr});function Is(O,d){O.hasOwnProperty("inputLayer")?Is(O.inputLayer,d):(O.hasOwnProperty("inputLayer1")&&Is(O.inputLayer1,d),O.hasOwnProperty("inputLayer2")&&Is(O.inputLayer2,d)),d(O)}function jo(O){const d=O.slice(0);for(let g=0;g<d.length;g++){let y=0;Is(d[g],N=>{d.includes(N)||(d.splice(g+y,0,N),y++)})}return d}function nl(O,d){if(O.width!==d.width)throw new Error(`Layer width mismatch of ${O.width} and ${d.width}`);if(O.height!==d.height)throw new Error(`Layer height mismatch of ${O.height} and ${d.height}`)}function il(O,d){return O[this.thread.y][this.thread.x]+d[this.thread.y][this.thread.x]}class Vo extends pn{get width(){return this.inputLayer1.width}get height(){return this.inputLayer1.height}get depth(){return this.inputLayer1.depth}validate(){super.validate(),nl(this.inputLayer1,this.inputLayer2)}setupKernels(){this.predictKernel=kt(il,{output:[this.width,this.height],immutable:!0})}predict(){Pt(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights)}compare(){Pt(this.inputLayer1.deltas),Pt(this.inputLayer2.deltas),this.inputLayer1.deltas=_t(this.deltas),this.inputLayer2.deltas=_t(this.deltas)}}function oi(O,d,g){return new Vo(O,d,g)}const Hr={...Sn,std:null};class _r extends cr{constructor(d){super(),this.settings={...Hr,...d},this.setupPraxis(),this.validate(),this.weights||(this.weights=Be(this.width,this.height,d.std)),this.deltas||(this.deltas=Gt(this.width,this.height))}predict(){}compare(){}}function dn(O){return new _r(O)}function Da(O,d){let g=0;for(let y=0;y<this.constants.size;y++)g+=O[this.thread.y][y]*d[y][this.thread.x];return g}function zs(O,d,g){let y=d[this.thread.y][this.thread.x];for(let N=0;N<this.constants.size;N++)y+=O[this.thread.y][N]*g[this.thread.x][N];return y}function yi(O,d,g){let y=d[this.thread.y][this.thread.x];for(let N=0;N<this.constants.size;N++)y+=O[N][this.thread.x]*g[N][this.thread.y];return y}class $a extends pn{constructor(){super(...arguments),this.compareKernel1=null,this.compareKernel2=null}get width(){return this.inputLayer2.width}set width(d){throw new Error("Cannot set width on Multiply")}get height(){return this.inputLayer1.height}set height(d){throw new Error("Cannot set height on Multiply")}get depth(){return this.inputLayer1.depth}set depth(d){throw new Error("Cannot set depth on Multiply")}validate(){if(super.validate(),this.inputLayer1.width!==this.inputLayer2.height)throw new Error(`Layer width mismatch of ${this.inputLayer1.width} and ${this.inputLayer2.height}`)}setupKernels(){this.predictKernel=kt(Da,{output:[this.width,this.height],constants:{size:this.inputLayer2.height},immutable:!0}),this.compareKernel1=kt(zs,{output:[this.inputLayer1.width,this.inputLayer1.height],constants:{size:this.inputLayer2.width},immutable:!0}),this.compareKernel2=kt(yi,{output:[this.inputLayer2.width,this.inputLayer2.height],constants:{size:this.inputLayer1.height},immutable:!0})}reuseKernels(d){super.reuseKernels(d),this.compareKernel1=d.compareKernel1,this.compareKernel2=d.compareKernel2}predict(){if(Pt(this.weights),!this.predictKernel)throw new Error("this.predictKernel is not set");this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights)}compare(){if(!this.compareKernel1)throw new Error("this.compareKernel1 not set");if(!this.compareKernel2)throw new Error("this.compareKernel2 not set");const d=this.inputLayer1.deltas,g=this.inputLayer2.deltas,y=this.compareKernel1(this.deltas,this.inputLayer1.deltas,this.inputLayer2.weights),N=this.compareKernel2(this.deltas,this.inputLayer2.deltas,this.inputLayer1.weights);this.inputLayer2.deltas=N,this.inputLayer1.deltas=y,Pt(d),Pt(g)}setupPraxis(){}toJSON(){return{...super.toJSON(),width:this.width,height:this.height}}}function ri(O,d,g){return new $a(O,d,g)}function dr(O){return 1/(1+Math.exp(-O[this.thread.y][this.thread.x]))}function Mr(O){return 1/(1+Math.exp(-O[this.thread.z][this.thread.y][this.thread.x]))}function zo(O,d){const g=O[this.thread.y][this.thread.x],y=d[this.thread.y][this.thread.x];return g*(1-g)*y}function $l(O,d){const g=O[this.thread.z][this.thread.y][this.thread.x],y=d[this.thread.z][this.thread.y][this.thread.x];return g*(1-g)*y}class Uo extends Nr{setupKernels(){this.depth>0?(this.predictKernel=kt(Mr,{output:[this.width,this.height,this.depth],functions:[l],immutable:!0}),this.compareKernel=kt($l,{output:[this.width,this.height,this.depth],functions:[u],immutable:!0})):(this.predictKernel=kt(dr,{output:[this.width,this.height],functions:[l],immutable:!0}),this.compareKernel=kt(zo,{output:[this.width,this.height],functions:[u],immutable:!0}))}predict(){Pt(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){Pt(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}learn(d){}}function br(O,d){return new Uo(O,d)}function _l(O,d){const{height:g}=O;function y(S,T){const G=Jr(S,T);return G.setupKernels(),G}function N(S,T){const G=Xr(S,T);return G.setupKernels(),G}const D=dn({id:"weights",height:g,width:d.height,initPraxis:y}),F=dn({id:"biases",height:g,initPraxis:N}),z=ri(D,d),P=oi(z,F),k=br(P),R=D.praxis;return R.weightsLayer=D,R.incomingLayer=d,R.deltaLayer=k,k}function oa(O,d){if(typeof O.stride=="number")return{strideX:O.stride,strideY:O.stride};{let g=d.stride,y=d.stride;return typeof O.strideX=="number"&&(g=O.strideX),typeof O.strideY=="number"&&(y=O.strideY),{strideX:g,strideY:y}}}function Mi(O,d){if(typeof O.padding=="number")return{paddingX:O.padding,paddingY:O.padding};{let g=d.padding,y=d.padding;return typeof O.paddingX=="number"&&(g=O.paddingX),typeof O.paddingY=="number"&&(y=O.paddingY),{paddingX:g,paddingY:y}}}function so(O,d){return new Float32Array(O).fill(d)}function bl(O,d,g){const y=this.constants.paddingX-this.thread.x*this.constants.strideX,N=this.thread.x*this.constants.strideX-this.constants.paddingX,D=Math.min(this.constants.filterWidth,y+this.constants.inputWidth),F=this.constants.paddingY-this.thread.y*this.constants.strideY,z=this.thread.y*this.constants.strideY-this.constants.paddingY,P=Math.min(this.constants.filterHeight,F+this.constants.inputHeight);let k=0;for(let R=0;R<this.constants.inputDepth;R++)for(let S=Math.max(0,F),T=Math.max(0,z);S<P;S++,T++)for(let G=Math.max(0,y),te=Math.max(0,N);G<D;G++,te++)k+=d[R][S][G]*O[R][T][te];return k+g[this.thread.z]}function xl(O,d,g){const y=Math.max(0,Math.ceil((this.constants.paddingX-this.thread.x)/this.constants.strideX)),N=y*this.constants.strideX+this.thread.x-this.constants.paddingX,D=Math.min(this.constants.deltaWidth,Math.floor((this.constants.inputWidth-1-this.thread.x+this.constants.paddingX)/this.constants.strideX)+1),F=Math.max(0,Math.ceil((this.constants.paddingY-this.thread.y)/this.constants.strideY)),z=F*this.constants.strideY+this.thread.y-this.constants.paddingY,P=Math.min(this.constants.deltaHeight,Math.floor((this.constants.inputHeight-1-this.thread.y+this.constants.paddingY)/this.constants.strideY)+1);let k=O[this.thread.z][this.thread.y][this.thread.x];for(let R=F,S=z;R<P;R++,S+=this.constants.strideY)for(let T=y,G=N;T<D;T++,G+=this.constants.strideX)k+=d[this.thread.z][S][G]*g[this.constants.deltaZ][R][T];return k}function Bo(O,d,g){const y=this.thread.x+this.constants.paddingX,N=y<this.constants.filterWidth?0:Math.floor((y-this.constants.filterWidth+this.constants.strideX)/this.constants.strideX),D=y-N*this.constants.strideX,F=Math.min(N+Math.floor(D/this.constants.strideX)+1,this.constants.deltaWidth),z=this.thread.y+this.constants.paddingY,P=z<this.constants.filterHeight?0:Math.floor((z-this.constants.filterHeight+this.constants.strideY)/this.constants.strideY),k=z-P*this.constants.strideY,R=Math.min(P+Math.floor(k/this.constants.strideY)+1,this.constants.deltaHeight);let S=O[this.thread.z][this.thread.y][this.thread.x],T=P;for(let G=k;T<R;G-=this.constants.strideY,T++){let te=N;for(let Te=D;te<F;Te-=this.constants.strideX,te++)S+=d[this.thread.z][G][Te]*g[this.constants.deltaZ][T][te]}return S}function Ha(O,d){let g=0;for(let y=0;y<this.constants.deltaHeight;y++)for(let N=0;N<this.constants.deltaWidth;N++)g+=d[this.thread.z][y][N];return O[this.thread.z][this.thread.y][this.thread.x]+g}const At={stride:0,padding:0,bias:.1,filterCount:1,filterWidth:0,filterHeight:0};class St extends vr{constructor(d,g){var y,N,D;super(d,g),this.compareFilterDeltasKernel=null,this.compareInputDeltasKernel=null,this.compareBiasesKernel=null,this.settings={...At,...d,...Mi(d,At),...oa(d,At)},this.weights=(y=d.weights)!==null&&y!==void 0?y:He(this.width,this.height,this.depth),this.deltas=Kn(this.width,this.height,this.depth),this.biases=so(this.depth,this.bias),this.biasDeltas=(N=d.biasDeltas)!==null&&N!==void 0?N:Le(this.depth),this.filters=(D=d.filters)!==null&&D!==void 0?D:He(this.filterWidth,this.filterHeight,this.filterCount),this.filterDeltas=Kn(this.filterWidth,this.filterHeight,this.filterCount),this.validate()}get strideX(){return this.settings.strideX}get strideY(){return this.settings.strideY}get paddingX(){return this.settings.paddingX}get paddingY(){return this.settings.paddingX}get width(){return Math.floor((this.inputLayer.width+this.paddingX*2-this.filterWidth)/this.strideX+1)}get height(){return Math.floor((this.inputLayer.height+this.paddingY*2-this.filterHeight)/this.strideY+1)}get bias(){return this.settings.bias}get depth(){return this.filterCount}get biases(){return this.settings.biases}set biases(d){this.settings.biases=d}get biasDeltas(){return this.settings.biasDeltas}set biasDeltas(d){this.settings.biasDeltas=d}get filters(){return this.settings.filters}set filters(d){this.settings.filters=d}get filterDeltas(){return this.settings.filterDeltas}set filterDeltas(d){this.settings.filterDeltas=d}setupKernels(){this.predictKernel=kt(bl,{constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,inputDepth:this.inputLayer.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight},output:[this.width,this.height,this.depth],immutable:!0}),this.compareFilterDeltasKernel=kt(xl,{constants:{deltaWidth:this.width,deltaHeight:this.height,deltaZ:this.depth,inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,inputDepth:this.inputLayer.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight},output:[this.width,this.height,this.depth],immutable:!0}),this.compareInputDeltasKernel=kt(Bo,{constants:{deltaWidth:this.width,deltaHeight:this.height,deltaZ:this.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight,filterCount:this.filterCount},output:[this.inputLayer.width,this.inputLayer.height,this.inputLayer.depth],immutable:!0}),this.compareBiasesKernel=kt(Ha,{output:[1,1,this.depth],constants:{deltaWidth:this.width,deltaHeight:this.height},immutable:!0})}predict(){this.weights=this.predictKernel(this.inputLayer.weights,this.filters,this.biases)}compare(){const{filterDeltas:d,biasDeltas:g}=this;this.filterDeltas=this.compareFilterDeltasKernel(d,this.inputLayer.weights,this.deltas),Pt(d),this.biasDeltas=this.compareBiasesKernel(g,this.deltas),Pt(g),Pt(this.deltas),this.deltas=this.compareInputDeltasKernel(this.filters,this.inputLayer.deltas),Pt(this.inputLayer.deltas),this.inputLayer.deltas=_t(this.deltas)}learn(d){const{weights:g}=this;this.weights=this.praxis.run(this,d),Pt(g)}}function fn(O,d){return new St(O,d)}function ui(O){return O}function Xi(O){return Math.random()<this.constants.probability?0:O[this.thread.y][this.thread.x]}function vi(O){return O[this.thread.y][this.thread.x]*this.constants.probability}function Qt(O,d){return O[this.thread.y][this.thread.x]===0?0:d[this.thread.y][this.thread.x]}const xs={...Sn,probability:.5};class _a extends vr{constructor(d,g){super(g,d),this.predictKernelMap=null,this.settings={...xs,...g},this.dropouts=null,this.validate()}setupKernels(d){const g=[this.width,this.height];d?(this.predictKernelMap=Pe({dropouts:ui},Xi,{output:g,immutable:!0}),this.compareKernel=kt(Qt,{output:g,immutable:!0})):this.predictKernelMap=Pe({},vi,{output:g,immutable:!0})}predict(){Pt(this.weights),this.dropouts&&Pt(this.dropouts);const{result:d,dropouts:g}=this.predictKernelMap(this.inputLayer.weights);this.weights=d,this.dropouts=g}compare(){Pt(this.deltas),this.deltas=this.compareKernel(this.dropouts,this.inputLayer.deltas)}}function Us(O,d){return new _a(O,d)}function Er(O,d){const{height:g,praxisOpts:y=null}=O,N=dn({id:"weights",height:g,width:d.height,praxisOpts:y}),D=dn({id:"biases",height:g,praxisOpts:y});return br(oi(ri(N,d,{praxisOpts:y}),D,{praxisOpts:y}),{praxisOpts:y})}function Ai(O,d,g){let y=0,N=0;for(let D=0;D<this.constants.inputHeight;D++)for(let F=0;F<this.constants.inputWidth;F++)y+=O[D][F]*d[this.thread.x][N],N++;return y+g[this.thread.x]}function ba(O,d,g){let y=0,N=0;for(let D=0;D<this.constants.inputDepth;D++)for(let F=0;F<this.constants.inputHeight;F++)for(let z=0;z<this.constants.inputWidth;z++)y+=O[D][F][z]*d[this.thread.x][N],N++;return y+g[this.thread.x]}function Ci(O,d,g){let y=0;const N=this.thread.x+this.thread.y*this.output.x;for(let D=0;D<this.constants.filterCount;D++)y+=g[D][N]*d[0][D];return y+O[this.thread.y][this.thread.x]}function Bs(O,d,g){let y=0;const N=this.thread.x+this.thread.y*this.output.x;for(let D=0;D<this.constants.filterCount;D++)y+=g[D][N]*d[0][D];return y+O[this.thread.z][this.thread.y][this.thread.x]}function Ga(O,d){return O[this.thread.x]+d[this.thread.y][this.thread.x]}function $s(O,d,g){return O[this.thread.y][this.thread.x]+d[this.thread.y][this.thread.x]*g[this.constants.deltaY][this.constants.deltaX]}function gn(O,d,g){const y=Math.floor(this.thread.x/(this.constants.inputWidth*this.constants.inputHeight)),N=Math.floor((this.thread.x-y*this.constants.inputWidth*this.constants.inputHeight)/this.constants.inputWidth),D=this.thread.x-this.constants.inputWidth*(N+this.constants.inputHeight*y);return O[this.thread.y][this.thread.x]+d[y][N][D]*g[0][this.thread.y]}class ks extends vr{constructor(d,g){super(d,g),this.compareFilterDeltasKernel=null,this.compareInputDeltasKernel=null,this.compareBiasesKernel=null,this.settings={...d},this.validate();const y=g.width*g.height*g.depth;this.biases=so(this.height,this.bias),this.biasDeltas=Ye(this.height),this.filters=Be(y,this.height),this.filterDeltas=Gt(y,this.height),this.depth>0?(this.weights=He(this.width,this.height,this.depth),this.deltas=Kn(this.width,this.height,this.depth)):this.height>0&&(this.weights=Be(this.width,this.height),this.deltas=Gt(this.width,this.height))}get bias(){return this.settings.bias}get biases(){return this.settings.biases}set biases(d){this.settings.biases=d}get biasDeltas(){return this.settings.biases}set biasDeltas(d){this.settings.biasDeltas=d}validate(){if(super.validate(),this.depth>0)throw new Error("depth not supported")}setupKernels(){const{inputLayer:d}=this,g=d.width*d.height*d.depth;d.depth>0?(this.predictKernel=kt(ba,{output:[this.width,this.height],constants:{inputHeight:d.height,inputWidth:d.width,inputDepth:d.depth}}),this.compareFilterDeltasKernel=kt(gn,{output:[g,this.height],constants:{deltaX:0,deltaY:0,inputWidth:d.width,inputHeight:d.height},immutable:!0}),this.compareInputDeltasKernel=kt(Bs,{output:[d.width,d.height,d.depth],constants:{filterCount:this.height},immutable:!0})):(this.predictKernel=kt(Ai,{output:[this.width,this.height],constants:{inputHeight:d.height,inputWidth:d.width}}),this.compareFilterDeltasKernel=kt($s,{output:[g,this.height],constants:{deltaX:0,deltaY:0,inputWidth:d.width,inputHeight:d.height}}),this.compareInputDeltasKernel=kt(Ci,{output:[d.width,d.height],constants:{filterCount:this.height}})),this.compareBiasesKernel=kt(Ga,{output:[this.width,this.height]})}predict(){this.weights=this.predictKernel(this.inputLayer.weights,this.filters,this.biases)}compare(){const d=this.inputLayer.deltas;this.inputLayer.deltas=this.compareInputDeltasKernel(d,this.deltas,this.filters),Pt(d);const{biasDeltas:g,filterDeltas:y}=this;this.biasDeltas=this.compareBiasesKernel(this.biases,this.deltas),this.filterDeltas=this.compareFilterDeltasKernel(y,this.inputLayer.weights,this.deltas),Pt(g),Pt(y)}}function La(O,d){return new ks(O,d)}function Ir(O){return-O[this.thread.y][this.thread.x]}class kr extends Ri{constructor(d,g){super(d,g),this.validate()}setupKernels(){this.predictKernel=kt(Ir,{output:[this.width,this.height]})}predict(){this.weights=this.predictKernel(this.inputLayer.weights)}}function Hs(O,d){return new kr(O,d)}function xr(O,d){return O[this.thread.y][this.thread.x]*d[this.thread.y][this.thread.x]}function Gs(O,d){return O[this.thread.y][this.thread.x]*d[this.thread.y][this.thread.x]}class Ka extends pn{get width(){return this.inputLayer1.width}get height(){return this.inputLayer1.height}get depth(){return this.inputLayer1.depth}validate(){super.validate(),nl(this.inputLayer1,this.inputLayer2)}setupKernels(){this.predictKernel=kt(xr,{output:[this.width,this.height],immutable:!0}),this.compareKernel=kt(Gs,{output:[this.width,this.height],immutable:!0})}predict(){Pt(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights)}compare(){Pt(this.inputLayer1.deltas),Pt(this.inputLayer2.deltas),this.inputLayer1.deltas=this.compareKernel(this.inputLayer2.weights,this.deltas),this.inputLayer2.deltas=this.compareKernel(this.inputLayer1.weights,this.deltas)}}function Gr(O,d,g){return new Ka(O,d,g)}function Wa(O){return new Float32Array(O).fill(1)}function fs(O,d){const g=new Array(d);for(let y=0;y<d;y++)g[y]=Wa(O);return g}class ao extends cr{constructor(d){super(d),this.validate(),this.weights=fs(this.width,this.height),this.deltas=Gt(this.width,this.height)}}function To(O){return new ao(O)}function Ks(O){return f(O[this.thread.y][this.thread.x])}function on(O){return f(O[this.thread.z][this.thread.y][this.thread.x])}function Di(O,d){return x(O[this.thread.y][this.thread.x],d[this.thread.y][this.thread.x])}function Cr(O,d){return x(O[this.thread.z][this.thread.y][this.thread.x],d[this.thread.z][this.thread.y][this.thread.x])}class la extends Nr{setupKernels(){this.depth>0?(this.predictKernel=kt(on,{output:[this.width,this.height,this.depth],functions:[f],immutable:!0}),this.compareKernel=kt(Cr,{output:[this.width,this.height,this.depth],functions:[x],immutable:!0})):(this.predictKernel=kt(Ks,{output:[this.width,this.height],functions:[f],immutable:!0}),this.compareKernel=kt(Di,{output:[this.width,this.height],functions:[x],immutable:!0}))}predict(){Pt(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){Pt(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}function j(O,d){return new la(O,d)}class fe extends cr{constructor(d){super(d),this.validate(),this.weights=Gt(this.width,this.height),this.deltas=Gt(this.width,this.height)}predict(){}compare(){}}function Oe(O){return new fe(O)}function We(O,d,g){const{height:y}=O,N=dn({height:y,width:g.height}),D=dn({width:y,height:y}),F=Oe({height:y}),z=br(oi(oi(ri(N,g),ri(D,d)),F)),P=dn({height:y,width:g.height}),k=dn({width:y,height:y}),R=Oe({height:y}),S=br(oi(oi(ri(P,g),ri(k,d)),R)),T=dn({height:y,width:g.height}),G=dn({width:y,height:y}),te=Oe({height:y}),Te=j(oi(oi(ri(T,g),ri(G,Gr(S,d))),te));return oi(Gr(oi(To({width:z.width,height:z.height}),Hs(z)),Te),Gr(d,z))}const tt={weights:null};class It extends ir{constructor(d){super({...tt,...d}),this.reshapeInput=null,this.validate(),this.reshapeInput=null,this.deltas=Gt(this.width,this.height)}setupKernels(){this.width===1&&(this.predict=this.predict1D,this.reshapeInput=kt(function(d){return d[this.thread.y]},{output:[1,this.height],immutable:!0}))}reuseKernels(d){this.reshapeInput=d.reshapeInput}predict(d){if((Array.isArray(d)||d instanceof Float32Array)&&typeof d[0]=="number"&&d.length===this.height*this.width)Pt(this.weights),this.weights=$t(d,[this.width,this.height]);else if(Array.isArray(d)&&d.length===this.height&&(Array.isArray(d[0])||d[0]instanceof Float32Array)&&d[0].length===this.width)this.weights=_t(d);else throw new Error("Inputs are not of sized correctly")}predict1D(d){this.weights&&Pt(this.weights),this.reshapeInput?this.weights=this.reshapeInput(d):this.weights=d}compare(){}learn(){}}function Mt(O){return new It(O)}function ln(O){return w(O[this.thread.y][this.thread.x])}function mn(O){return w(O[this.thread.z][this.thread.y][this.thread.x])}function Vn(O,d){return A(O[this.thread.y][this.thread.x],d[this.thread.y][this.thread.x])}function Rn(O,d){return A(O[this.thread.z][this.thread.y][this.thread.x],d[this.thread.z][this.thread.y][this.thread.x])}class Ei extends Nr{setupKernels(){const{width:d,height:g,depth:y}=this.inputLayer;this.depth>0?(this.predictKernel=kt(mn,{output:[d,g,y],functions:[w],immutable:!0}),this.compareKernel=kt(Rn,{output:[d,g,y],functions:[A],immutable:!0})):(this.predictKernel=kt(ln,{output:[d,g],functions:[w],immutable:!0}),this.compareKernel=kt(Vn,{output:[d,g],functions:[A],immutable:!0}))}predict(){Pt(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){const{deltas:d}=this;this.deltas=this.compareKernel(this.weights,d),Pt(d)}}function Rr(O,d){return new Ei(O,d)}function fr(O,d,g){const{height:y}=O;if(typeof y!="number")throw new Error("no settings.height given");g.setDimensions&&g.setDimensions(1,y);const N=dn({width:d.height,height:y,std:.08,id:"inputGateWeights"}),D=dn({width:y,height:y,std:.08,id:"inputGatePeepholes"}),F=Oe({width:1,height:y,id:"inputGateBias"}),z=br(oi(oi(ri(N,d),ri(D,g)),F),{id:"inputGate"}),P=dn({width:d.height,height:y,std:.08,id:"forgetGateWeights"}),k=dn({width:y,height:y,std:.08,id:"forgetGatePeepholes"}),R=Oe({width:1,height:y,id:"forgetGateBias"}),S=br(oi(oi(ri(P,d),ri(k,g)),R),{id:"forgetGate"}),T=dn({width:d.height,height:y,std:.08,id:"outputGateWeights"}),G=dn({width:y,height:y,std:.08,id:"outputGatePeepholes"}),te=Oe({width:1,height:y,id:"outputGateBias"}),Te=br(oi(oi(ri(T,d),ri(G,g)),te),{id:"outputGate"}),ie=dn({width:d.height,height:y,std:.08,id:"memoryWeights"}),_e=dn({width:y,height:y,std:.08,id:"memoryPeepholes"}),Y=Oe({width:1,height:y,id:"memoryBias"}),re=j(oi(oi(ri(ie,d),ri(_e,g)),Y),{id:"memory"}),be=Gr(S,g,{id:"retainCell"}),ke=Gr(z,re,{id:"writeCell"}),rt=oi(be,ke,{id:"cell"});return Gr(Te,j(rt),{id:"activations"})}function E(O,d){const{height:g}=O,y=dn({height:g,width:d.height,id:"outputGate",std:.08}),N=dn({height:g,id:"output",std:.08}),D=ri(y,d,{id:"outputGateConnected"});return bs({id:"target",...O},oi(D,N))}function K(O){return O}function ne(O){return O}function Ie(O){const d=this.thread.x*this.constants.strideX-this.constants.paddingX,g=this.thread.y*this.constants.strideY-this.constants.paddingY,y=d+this.constants.filterWidth,N=g+this.constants.filterHeight,D=Math.max(d,0),F=Math.max(g,0),z=Math.min(y,this.constants.inputWidth),P=Math.min(N,this.constants.inputHeight);let k=O[this.thread.z][F][D];for(let R=F;R<P;R++)for(let S=D;S<z;S++){const T=O[this.thread.z][R][S];T>k&&(k=T)}return k}function at(O,d,g){const y=this.thread.x+.5,N=this.thread.y+.5,D=1/this.constants.strideX,F=1/this.constants.strideY,z=Math.max(0,Math.ceil((y-this.constants.filterWidth+this.constants.paddingX)*D)),P=Math.max(0,Math.ceil((N-this.constants.filterHeight+this.constants.paddingY)*F)),k=Math.min(Math.ceil((y+this.constants.paddingX)*D),this.constants.outputWidth),R=Math.min(Math.ceil((N+this.constants.paddingY)*F),this.constants.outputHeight);let S=0;for(let T=P;T<R;T++)for(let G=z;G<k;G++){const te=d[T][G],Te=g[T][G];Math.abs(te-this.thread.x)<.1&&Math.abs(Te-this.thread.y)<.1&&(S+=O[T][G])}return S}const ft={padding:0,stride:0};class Vt extends vr{constructor(d,g){super(d,g),this.predictKernelMap=null,this.settings={...d,...oa(d,ft),...Mi(d,ft)},this.weights=He(this.width,this.height,this.depth),this.deltas=Kn(this.width,this.height,this.depth),this.validate()}get strideX(){return this.settings.strideX}get strideY(){return this.settings.strideY}get paddingX(){return this.settings.paddingX}get paddingY(){return this.settings.paddingY}get width(){return Math.ceil((this.inputLayer.width+this.paddingX*2-this.filterWidth)/this.strideX+1)}get height(){return Math.floor((this.inputLayer.height+this.paddingY*2-this.filterHeight)/this.strideY+1)}get depth(){return this.settings.filterCount}get filterCount(){return this.settings.filterCount}get switchX(){return this.settings.switchX}set switchX(d){this.settings.switchX=d}get switchY(){return this.settings.switchY}set switchY(d){this.settings.switchY=d}setupKernels(){this.predictKernelMap=Pe({switchX:ne,switchY:K},Ie,{output:[this.width,this.height,this.depth],constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,paddingX:this.paddingX,paddingY:this.paddingY,filterHeight:this.filterHeight,filterWidth:this.filterWidth,strideX:this.strideX,strideY:this.strideY}}),this.compareKernel=kt(at,{output:[this.inputLayer.width,this.inputLayer.height,this.inputLayer.depth],constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,outputWidth:this.width,outputHeight:this.height,filterWidth:this.filterWidth,filterHeight:this.filterHeight,paddingX:this.paddingX,paddingY:this.paddingY,strideX:this.strideX,strideY:this.strideY}})}predict(){const{result:d,switchX:g,switchY:y}=this.predictKernelMap(this.inputLayer.weights);this.switchX=g,this.switchY=y,this.weights=d}compare(){const d=this.inputLayer.deltas;this.inputLayer.deltas=this.compareKernel(this.deltas,this.switchX,this.switchY),Pt(d)}}function Zn(O,d){return new Vt(O,d)}class lr extends Pr{constructor(d){super(),this.praxis=null,this.predictKernel=null,this.compareKernel=null,this.settings={},this.recurrentInput=d,this.validate()}get width(){return this.recurrentInput.width}get height(){return this.recurrentInput.height}get depth(){return this.recurrentInput.depth}get deltas(){return this.recurrentInput.deltas}set deltas(d){const g=this.recurrentInput.deltas;this.recurrentInput.deltas=d,Pt(g)}get weights(){return this.recurrentInput.weights}set weights(d){const g=this.recurrentInput.weights;this.recurrentInput.weights=d,Pt(g)}validate(){if(Qn.prototype.validate.call(this),this.width!==this.recurrentInput.width)throw new Error(`${this.constructor.name} layer width ${this.width} and ${this.recurrentInput.constructor.name} width (${this.recurrentInput.width}) are not same`);if(this.height!==this.recurrentInput.height)throw new Error(`${this.constructor.name} layer height ${this.height} and ${this.recurrentInput.constructor.name} width (${this.recurrentInput.height}) are not same`)}setDimensions(d,g){this.recurrentInput.width=d,this.recurrentInput.height=g}predict(){}compare(){}learn(){}setupKernels(){}reuseKernels(){}}class ci extends Pr{constructor(d){super(),this.praxis=null,this.settings={},this.predictKernel=null,this.compareKernel=null,d&&(this.settings={...d})}setDimensions(d,g){this.praxis=null,this.settings={...this.settings,width:d,height:g,weights:Gt(d,g),deltas:Gt(d,g)}}setupKernels(){}reuseKernels(){}predict(){}compare(){}learn(d){const{weights:g}=this;this.weights=this.praxis.run(this,d),Pt(g)}}function rr(){return new ci}function Ws(O){return n(O[this.thread.y][this.thread.x])}function ua(O,d){return r(O[this.thread.y][this.thread.x],d[this.thread.y][this.thread.x])}function wr(O){return n(O[this.thread.z][this.thread.y][this.thread.x])}function ca(O,d){return r(O[this.thread.z][this.thread.y][this.thread.x],d[this.thread.z][this.thread.y][this.thread.x])}class qa extends Nr{setupKernels(){const{width:d,height:g,depth:y}=this.inputLayer;y>0?(this.predictKernel=kt(wr,{output:[d,g,y],functions:[n],immutable:!0}),this.compareKernel=kt(ca,{output:[d,g,y],functions:[r],immutable:!0})):(this.predictKernel=kt(Ws,{output:[d,g],functions:[n],immutable:!0}),this.compareKernel=kt(ua,{output:[d,g],functions:[r],immutable:!0}))}predict(){Pt(this.weights),this.weights=this.predictKernel(this.inputLayer.weights)}compare(){Pt(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}function $o(O,d){return new qa(O,d)}function rl(O,d,g){const{height:y}=O;if(typeof y!="number")throw new Error("height not set");g.setDimensions&&g.setDimensions(1,y);const N=dn({id:"weight",height:y,width:d.height,std:.08}),D=dn({id:"transition",height:y,width:y,std:.08}),F=Oe({id:"bias",height:y});return $o(oi(oi(ri(N,d),ri(D,g)),F))}class xa extends Qn{constructor(d,g){super(d),this.inputLayer=g,this.validate()}predict(){Pt(this.weights),this.weights=_t(this.inputLayer.weights)}learn(){}}function wl(O,d){return new xa(O,d)}function Mu(O){let d=-1/0;for(let g=0;g<this.constants.inputHeight;g++)for(let y=0;y<this.constants.inputWidth;y++){const N=O[g][y];N>d&&(d=N)}return d}function hc(O){let d=-1/0;for(let g=0;g<this.constants.inputDepth;g++)for(let y=0;y<this.constants.inputHeight;y++)for(let N=0;N<this.constants.inputWidth;N++){const D=O[g][y][N];D>d&&(d=D)}return d}function oo(O){let d=0;for(let g=0;g<this.constants.inputHeight;g++)for(let y=0;y<this.constants.inputWidth;y++)d+=O[g][y];return d}function Ho(O){let d=0;for(let g=0;g<this.constants.inputDepth;g++)for(let y=0;y<this.constants.inputHeight;y++)for(let N=0;N<this.constants.inputWidth;N++)d+=O[g][y][N];return d}function Sl(O,d){return Math.exp(O[this.thread.x]-d[0])}function dc(O,d){return Math.exp(O[this.thread.z][this.thread.y][this.thread.x]-d[0])}function Go(O,d){return O[this.thread.y][this.thread.x]/d[0]}function Hl(O,d){return O[this.thread.z][this.thread.y][this.thread.x]/d[0]}function Ya(O,d){let g=0;return this.thread.x+this.thread.y*this.output.x===O&&(g=1),-(g-d[this.thread.y][this.thread.x])}function Na(O,d){let g=0;return this.thread.x+this.thread.y*this.output.x+this.thread.z*this.output.x*this.output.y===O&&(g=1),-(g-d[this.thread.z][this.thread.y][this.thread.x])}class Ko extends Ri{constructor(d,g){super(d,g),this.errors=null,this.getExponentialsKernel=null,this.getMaxValueKernel=null,this.getSumKernel=null,this.validate(),this.depth>0?(this.weights=He(this.width,this.height,this.depth),this.deltas=Kn(this.width,this.height,this.depth)):this.height>0?(this.weights=Be(this.width,this.height),this.deltas=Gt(this.width,this.height)):(this.weights=Le(this.width),this.deltas=Ye(this.width))}setupKernels(){const{width:d,height:g,depth:y}=this;y>0?(this.getExponentialsKernel=kt(dc,{output:[d,g,y]}),this.getMaxValueKernel=kt(hc,{output:[1,1,1],constants:{inputWidth:d,inputHeight:g,inputDepth:y}}),this.getSumKernel=kt(Ho,{output:[1,1,1],constants:{inputWidth:d,inputHeight:g,inputDepth:y}}),this.predictKernel=kt(Hl,{output:[d,g,y]}),this.compareKernel=kt(Na,{output:[d,g,y],immutable:!0})):(this.getExponentialsKernel=kt(Sl,{output:[d,g]}),this.getMaxValueKernel=kt(Mu,{output:[1,1],constants:{inputWidth:d,inputHeight:g}}),this.getSumKernel=kt(oo,{output:[1,1],constants:{inputWidth:d,inputHeight:g}}),this.predictKernel=kt(Go,{output:[d,g]}),this.compareKernel=kt(Ya,{output:[d,g],immutable:!0}))}predict(){const d=this.getMaxValueKernel(this.inputLayer.weights),g=this.getExponentialsKernel(this.inputLayer.weights,d),y=this.getSumKernel(g);this.weights=this.predictKernel(g,y)}compare(d){const{deltas:g,errors:y}=this;this.errors=this.compareKernel(d[0],g),this.deltas=_t(this.errors),Pt(g),Pt(y);const N=this.inputLayer.deltas;this.inputLayer.deltas=_t(this.deltas),Pt(N)}}function sl(O,d){return new Ko(O,d)}class al extends Qn{constructor(d,g){super(g),this.inputLayer=d}predict(){Pt(this.weights),this.weights=_t(this.inputLayer.weights),this.validate()}learn(){}}function Fu(O,d){return new al(O,d)}function fu(O){return O[this.thread.x][this.thread.y]}const ps=fu;class fc extends Ri{get width(){return this.inputLayer.height}get height(){return this.inputLayer.width}constructor(d){super(d),this.validate()}setupKernels(){this.predictKernel=kt(fu,{output:[this.height,this.width]}),this.compareKernel=kt(ps,{output:[this.width,this.height]})}predict(){this.weights=this.predictKernel(this.inputLayer.weights)}compare(){this.inputLayer.deltas=this.compareKernel(this.deltas)}}function ol(O){return new fc(O)}const Cs={Activation:Nr,Internal:Pr,InternalModel:Oi,EntryPoint:ir,Filter:vr,Model:cr,Modifier:Ri,Operator:pn,Target:Or};var Rs=Object.freeze({__proto__:null,layerTypes:Cs,Add:Vo,add:oi,arthurFeedForward:_l,BaseLayer:Qn,baseLayerDefaultSettings:Sn,Convolution:St,convolution:fn,Dropout:_a,dropout:Us,feedForward:Er,FullyConnected:ks,fullyConnected:La,gru:We,Input:It,input:Mt,LeakyRelu:Ei,leakyRelu:Rr,lstmCell:fr,Multiply:$a,multiply:ri,MultiplyElement:Ka,multiplyElement:Gr,Negative:kr,negative:Hs,Ones:ao,ones:To,output:E,Pool:Vt,pool:Zn,Random:_r,random:dn,RecurrentInput:lr,RecurrentZeros:ci,rnnCell:rl,Regression:xa,regression:wl,Relu:qa,relu:$o,Sigmoid:Uo,sigmoid:br,SoftMax:Ko,softMax:sl,SVM:al,svm:Fu,Tanh:la,tanh:j,Target:Or,target:bs,Transpose:fc,transpose:ol,Zeros:fe,zeros:Oe});const Tl=Object.keys(Rs);function lo(O,d,g){if(!Tl.find(N=>N===O.type))return null;const y=Rs[O.type];if(y.prototype instanceof Cs.Filter){if(!d)throw new Error("inputLayer missing");return new y(O,d)}else if(y.prototype instanceof Cs.Activation||y.prototype instanceof Cs.Modifier){if(!d)throw new Error("inputLayer missing");return new y(d,O)}else{if(y.prototype instanceof Cs.Internal)return new y(O);if(y.prototype instanceof Cs.Operator){if(!d)throw new Error("inputLayer1 missing");if(!g)throw new Error("inputLayer2 missing");return new y(d,g,O)}else{if(y.prototype instanceof Cs.InternalModel||y.prototype instanceof Cs.EntryPoint||y.prototype instanceof Cs.Model)return new y(O);if(y===Or){if(!d)throw new Error("inputLayer missing");return new y(O,d)}}}return null}const ju={learningRate:.3,binaryThresh:.5,initPraxis:(O,d)=>{var g;return hr(O,(g=O.settings.praxisOpts)!==null&&g!==void 0?g:d)}},Wo={iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,callbackPeriod:10,errorCheckInterval:100,timeout:1/0};class uo{constructor(d={}){this.trainOpts={},this.layers=null,this._inputLayer=null,this._hiddenLayers=null,this._outputLayer=null,this._model=null,this.meanSquaredError=null,this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null,this.options={...ju,...d},this._updateTrainingOptions({...Wo,...d})}static _validateTrainingOptions(d){const{iterations:g,errorThresh:y,log:N,logPeriod:D,learningRate:F,callback:z,callbackPeriod:P,timeout:k}=d,R={iterations:()=>typeof g=="number"&&g>0,errorThresh:()=>typeof y=="number"&&y>0&&y<1,log:()=>typeof N=="function"||typeof N=="boolean",logPeriod:()=>typeof D=="number"&&D>0,learningRate:()=>typeof F=="number"&&F>0&&F<1,callback:()=>typeof z=="function"||z===null,callbackPeriod:()=>typeof P=="number"&&P>0,timeout:()=>typeof k=="number"&&k>0};Object.keys(Wo).forEach(S=>{if(R.hasOwnProperty(S)&&!R[S]()){const T=d[S];throw new Error(`[${S}, ${(T??"undefined").toString()}] is out of normal training range, your network will probably not train.`)}})}_setLogMethod(d){typeof d=="function"?this.trainOpts.log=d:d?this.trainOpts.log=console.log:this.trainOpts.log=!1}_updateTrainingOptions(d){var g;this.trainOpts={...Wo,...this.trainOpts,...d},uo._validateTrainingOptions(this.trainOpts),this._setLogMethod((g=d.log)!==null&&g!==void 0?g:this.trainOpts.log);const{callback:y,callbackPeriod:N,errorCheckInterval:D}=this.trainOpts;y&&N!==D&&console.warn(`options.callbackPeriod with value of ${(N??"undefined").toString()} does not match options.errorCheckInterval with value of ${(D??"undefined").toString()}, if logging error, it will repeat.  These values may need to match`)}_connectOptionsLayers(){const{inputLayerIndex:d,outputLayerIndex:g,layers:y}=this.options;if(!y)throw new Error("this.options.layers in unexpected state");if(typeof d!="number")throw new Error("inputLayerIndex not a number");if(typeof g!="number")throw new Error("inputLayerIndex not a number");const N=y[d];if(!N)throw new Error("inputLayer not found in this.options.layers");const D=y[g];if(!D)throw new Error("outputLayer not found in this.options.layers");return this._inputLayer=N,this._hiddenLayers=y.slice(d,g-d),this._outputLayer=D,y}_connectNewLayers(){const{inputLayer:d,outputLayer:g}=this.options;if(!d)throw new Error("inputLayer not defined");const y=[];this._inputLayer=d();const N=this._connectHiddenLayers(this._inputLayer);if(!g)throw new Error("outputLayer not defined");return this._outputLayer=g(N[N.length-1],N.length),y.push(this._inputLayer),y.push(...N),y.push(this._outputLayer),jo(y)}_connectHiddenLayers(d){this._hiddenLayers=[];const g=[],{hiddenLayers:y}=this.options;if(!y)throw new Error("hiddenLayers not defined");for(let N=0;N<y.length;N++){const D=y[N](d,N);g.push(D),this._hiddenLayers.push(D),d=D}return g}initialize(){this.layers=this.options.layers?this._connectOptionsLayers():this._connectNewLayers(),this.initializeLayers(this.layers),this._model=this.layers.filter(d=>d instanceof cr)}initializeLayers(d){var g,y;for(let D=0;D<d.length;D++){const F=d[D];F.setupKernels(!0),F instanceof cr&&F.praxis===null&&typeof this.options.initPraxis=="function"&&(F.praxis=this.options.initPraxis(F,(y=(g=F.settings.praxisOpts)!==null&&g!==void 0?g:this.options.praxisOpts)!==null&&y!==void 0?y:{}),F.praxis.setupKernels())}const N=d[d.length-1];this.meanSquaredError=new Mn({width:N.width,height:N.height})}run(d){let g;if(Array.isArray(d)||d.buffer)g=d;else if(this.inputLookup)g=me.toArray(this.inputLookup,d,this.inputLookupLength);else throw new Error("input is incompatible with net");let y=this.runInput(g);return y instanceof he.Texture&&(y=y.toArray()),this.outputLookup?me.toObject(this.outputLookup,y):y}runInput(d){if(!this.layers)throw new Error("not initialized");this.layers[0].predict(d);for(let g=1;g<this.layers.length;g++)this.layers[g].predict();return this.layers[this.layers.length-1].weights}train(d,g={}){const{preparedData:y,status:N,endTime:D}=this._prepTraining(d,g);let F=!0;const z=()=>this._calculateTrainingError(y),P=()=>this._trainPatterns(y);for(;F;)F=this._trainingTick(N,D,z,P);return N}async trainAsync(d,g={}){const{preparedData:y,status:N,endTime:D}=this._prepTraining(d,g);return await new Promise((F,z)=>{try{const P=()=>this._calculateTrainingError(y),k=()=>this._trainPatterns(y),R=new Ce.Thaw(new Array(this.trainOpts.iterations),{delay:!0,each:()=>this._trainingTick(N,D,P,k)||R.stop(),done:()=>F(N)});R.tick()}catch(P){z(P)}})}_trainingTick(d,g,y,N){const{trainOpts:D}=this;return d.iterations>=D.iterations||d.error<=D.errorThresh||Date.now()>=g?!1:(typeof D.log=="function"&&d.iterations%D.logPeriod===0?(d.error=y(),D.log(`iterations: ${d.iterations}, training error: ${d.error}`)):d.iterations%D.errorCheckInterval===0?d.error=y():N(),D.callback&&d.iterations%D.callbackPeriod===0&&D.callback(Object.assign(d)),d.iterations++,!0)}_prepTraining(d,g){this._updateTrainingOptions(g);const y=this.formatData(d),N=this.trainOpts.timeout?Date.now()+this.trainOpts.timeout:0,D={error:1,iterations:0};return this.verifyIsInitialized(),{preparedData:this.transferData(y),status:D,endTime:N}}verifyIsInitialized(){this._model||this.initialize()}_calculateTrainingError(d){let g=new Float32Array([0]);const y=this.meanSquaredError;for(let D=0;D<d.length;++D){const F=g,z=this._trainPattern(d[D].input,d[D].output,!0);g=y.add(g,z),Pt(z),Pt(F)}const N=y.divide(d.length,g);if(Pt(g),N instanceof he.Texture){const D=N.toArray();return Pt(N),D[0]}return N[0]}_trainPatterns(d){for(let g=0;g<d.length;++g)this._trainPattern(d[g].input,d[g].output,!1)}_trainPattern(d,g,y){var N;if(this.runInput(d),this._calculateDeltas(g),this.adjustWeights(),y){if(!(!((N=this._outputLayer)===null||N===void 0)&&N.errors))throw new Error("outputLayer.errors not defined");return this.meanSquaredError.calculate(this._outputLayer.errors)}return null}_calculateDeltas(d){const g=this.layers;for(let y=g.length-1;y>-1;y--)g[y].compare(d)}adjustWeights(){const d=this._model;for(let g=0;g<d.length;g++)d[g].learn(this.trainOpts.learningRate)}formatData(d){if(!Array.isArray(d)){const D=[];D.push(d),d=D}const g=d[0].input;let y;if(Array.isArray(d)&&!Array.isArray(g)&&!(g instanceof Float32Array)){if(!this.inputLookup){const D=new nt(d,"input");this.inputLookup=D.table,this.inputLookupLength=D.length}y=d.map(D=>({input:me.toArray(this.inputLookup,D.input,this.inputLookupLength)}),this)}else y=d;const N=d[0].output;if(!Array.isArray(N)&&!(N instanceof Float32Array)){if(!this.outputLookup){const D=new nt(d,"output");this.outputLookup=D.table,this.outputLookupLength=D.length}y=d.map((D,F)=>{const z=me.toArray(this.outputLookup,D.output,this.inputLookupLength);return{input:y[F].input,output:z}},this)}return y}transferData(d){const g=new Array(d.length),y=kt(function(D){return D[this.thread.x]},{output:[d[0].input.length],immutable:!0}),N=kt(function(D){return D[this.thread.x]},{output:[d[0].output.length],immutable:!0});for(let D=0;D<d.length;D++){const F=d[D];g[D]={input:y(F.input),output:N(F.output)}}return g}test(){throw new Error(`${this.constructor.name}-test is not yet implemented`)}toJSON(){var d;if(this.layers||this.initialize(),!this._model||!this.layers||!this._inputLayer||!this._hiddenLayers||!this._outputLayer)throw new Error("network is not initialized");const g=[];for(let y=0;y<this.layers.length;y++){const N=this.layers[y],D=N.toJSON();N.hasOwnProperty("inputLayer")?D.inputLayerIndex=this.layers.indexOf(N.inputLayer):N.hasOwnProperty("inputLayer1")&&N.hasOwnProperty("inputLayer2")&&(D.inputLayer1Index=this.layers.indexOf(N.inputLayer1),D.inputLayer2Index=this.layers.indexOf(N.inputLayer2)),g.push(D)}return{type:this.constructor.name,sizes:(d=this.options.sizes)!==null&&d!==void 0?d:[this._inputLayer.height].concat(this._hiddenLayers.map(y=>y.height)).concat([this._outputLayer.height]),outputLayerIndex:this.layers.indexOf(this._outputLayer),layers:g,inputLayerIndex:this.layers.indexOf(this._inputLayer)}}static fromJSON(d,g){var y,N,D,F;const z=d.layers,P=[],k=g?(y=lo(z[0]))!==null&&y!==void 0?y:g(z[0]):lo(z[0]);if(!k)throw new Error("unable to find layer");P.push(k);for(let R=1;R<z.length;R++){const S=z[R];if(typeof S.inputLayerIndex>"u"&&typeof S.inputLayer1Index>"u"&&typeof S.inputLayer2Index>"u"){const T=g?(N=lo(S))!==null&&N!==void 0?N:g(S):lo(S);if(!T)throw new Error("unable to find layer");P.push(T)}else if(typeof S.inputLayerIndex=="number"){const T=P[S.inputLayerIndex];if(!T)throw new Error("inputLayer1 not found");const G=g?(D=lo(S,T))!==null&&D!==void 0?D:g(S,T):lo(S,T);if(!G)throw new Error("unable to find layer");P.push(G)}else{if(typeof S.inputLayer1Index!="number")throw new Error("Cannot create network from provided JSON. inputLayer1Index not defined.");if(typeof S.inputLayer2Index!="number")throw new Error("Cannot create network from provided JSON. inputLayer2Index not defined.");const T=P[S.inputLayer1Index],G=P[S.inputLayer2Index];if(T===void 0)throw new Error(`Cannot create network from provided JSON. layer of index ${S.inputLayer1Index} not found.`);if(G===void 0)throw new Error(`Cannot create network from provided JSON. layer of index ${S.inputLayer2Index} not found.`);const te=g?(F=lo(S,T,G))!==null&&F!==void 0?F:g(S,T,G):lo(S,T,G);if(!te)throw new Error("unable to find layer");P.push(te)}}return new this({...d,layers:P})}toFunction(){throw new Error(`${this.constructor.name}-toFunction is not yet implemented`)}}function ll(O,d){if(!d)throw new TypeError(`Required parameter 'net' is of type ${typeof d}. Must be of type 'brain.NeuralNetwork'`);const g=d.run(O);let y=null,N=-1;return Object.entries(g).forEach(([D,F])=>{typeof F<"u"&&typeof F=="number"&&F>N&&(y=D,N=F)}),y}class Gl extends Pr{constructor(){super(...arguments),this.settings={},this.layer=null}setLayer(d){this.layer=d}get width(){if(!this.layer)throw new Error("layer not set");return this.layer.width}set width(d){throw new Error(`${this.constructor.name}-width is not yet implemented`)}get height(){if(!this.layer)throw new Error("layer not set");return this.layer.height}set height(d){throw new Error(`${this.constructor.name}-height is not yet implemented`)}get deltas(){if(!this.layer)throw new Error("layer not set");return this.layer.deltas}set deltas(d){if(!this.layer)throw new Error("layer not set");Pt(this.layer.deltas),this.layer.deltas=d}get weights(){if(!this.layer)throw new Error("layer not set");return this.layer.weights}set weights(d){if(!this.layer)throw new Error("layer not set");Pt(this.layer.weights),this.layer.weights=d}predict(){}compare(){}learn(){throw new Error("no longer using")}setupKernels(){}reuseKernels(){}}class Xa extends uo{constructor(d={}){super(d),this.trainOpts={},this._outputConnection=null,this._layerSets=[],this._hiddenLayerOutputIndices=[],this._model=null}_connectLayers(){if(!this.options.inputLayer)throw new Error("inputLayer not found");if(!this.options.outputLayer)throw new Error("outputLayer not found");const d=this.options.inputLayer(),g=this._connectHiddenLayers(d),y=this.options.outputLayer(g[g.length-1],-1);return{inputLayer:d,hiddenLayers:g,outputLayer:y}}_connectLayersDeep(){const d=[],g=this._layerSets[this._layerSets.length-1];let y=0;function N(F){const z=g.indexOf(F);if(z<0)throw new Error("unable to find layer");return d[z]}function D(F){return{...F.settings,weights:null,deltas:null,praxis:null}}for(let F=0;F<g.length;F++){const z=g[F];let P;if(z instanceof Nr)P=new z.constructor(N(z.inputLayer),D(z));else if(z instanceof ir)P=new z.constructor(D(z));else if(z instanceof vr)P=new z.constructor(D(z.inputLayer),N(z.inputLayer));else if(z instanceof Pr){const k=g[this._hiddenLayerOutputIndices[y++]];if(z instanceof Gl)throw new Error("unfinished");if(z instanceof lr)P=new lr(k);else if(z instanceof ci)P=new lr(k);else throw new Error(`hidden layer ${z.constructor.name} extends unknown hidden layer`)}else if(z instanceof Oi||z instanceof cr)P=z;else if(z instanceof Ri)P=new z.constructor(N(z.inputLayer),D(z.inputLayer));else if(z instanceof pn)P=new z.constructor(N(z.inputLayer1),N(z.inputLayer2),D(z));else if(z instanceof Or)P=new z.constructor(D(z),N(z.inputLayer));else throw new Error(`hidden layer ${z.constructor.name} extends unknown hidden layer`);d.push(P)}return d}_connectHiddenLayers(d){const g=[];if(!this.options.hiddenLayers)throw new Error("hiddenLayers not defined");for(let y=0;y<this.options.hiddenLayers.length;y++){const N=new ci,D=this.options.hiddenLayers[y](d,N,y);d=D,g.push(D)}return g}initialize(){this._outputConnection=new Gl;let d;if(this.options.layers)d=this._connectOptionsLayers();else{const{inputLayer:g,hiddenLayers:y,outputLayer:N}=this._connectLayers();d=jo([g,...y,N]),this._hiddenLayerOutputIndices=y.map(D=>d.indexOf(D)),this._inputLayer=g,this._hiddenLayers=y,this._outputLayer=N}this.layers=d,this._layerSets=[d],this._model=d.filter(g=>g instanceof cr||g instanceof Oi),this.initializeLayers(d)}initializeDeep(){const d=this._connectLayersDeep();for(let g=0;g<d.length;g++){const y=d[g];y.setupKernels(!0),y.reuseKernels(this._layerSets[0][g])}this._layerSets.push(d)}run(d){for(;this._layerSets.length<=d.length;)this.initializeDeep();const g=this.runInputs(d);return g instanceof he.Texture?g.toArray():g}runInput(d){throw new Error("use .runInputs()")}runInputs(d){for(;this._layerSets.length<d.length;)this.initializeDeep();const g=d.length-1;for(let D=0;D<=g;D++){const F=this._layerSets[D];F[0].predict(d[D]);for(let z=1;z<F.length;z++)F[z].predict()}const y=this._layerSets[g],N=y[y.length-1].weights;return this.end(),N}train(d,g={}){const{preparedData:y,status:N,endTime:D}=this._prepTraining(d,g);let F=!0;const z=()=>this._calculateTrainingError(y),P=()=>this._trainPatterns(y);for(;F;)F=this._trainingTick(N,D,z,P);return N}end(){const d=this._layerSets.length-1,g=this._layerSets[d];g[0].predict([new Float32Array([0])]);for(let y=1;y<g.length;y++)g[y].predict()}transferData(d){return d}_prepTraining(d,g){this._updateTrainingOptions(g);const y=this.trainOpts.timeout?Date.now()+this.trainOpts.timeout:0,N={error:1,iterations:0};return this.verifyIsInitialized(),{preparedData:this.transferData(d),status:N,endTime:y}}_calculateTrainingError(d){if(!this.meanSquaredError)throw new Error("this.meanSquaredError not setup");let g=new Float32Array(1);for(let N=0;N<d.length;++N){const D=g,F=this._trainPattern(d[N],!0);g=this.meanSquaredError.add(g,F),Pt(F),Pt(D)}const y=this.meanSquaredError.divide(d.length,g);return Pt(g),y instanceof he.Texture?y.toArray()[0]:y[0]}formatData(d){return d}_calculateDeltas(d){const g=this._layerSets[this._layerSets.length-1];for(let y=g.length-2;y>=0;y--)g[y].compare();for(let y=d.length-2;y>=0;y--){const N=this._layerSets[y];N[N.length-1].compare(d[y+1]);for(let D=N.length-2;D>=0;D--)N[D].compare()}}adjustWeights(){var d;const g=this._model;for(let y=0;y<g.length;y++)g[y].learn((d=this.options.learningRate)!==null&&d!==void 0?d:0)}_trainPatterns(d){for(let g=0;g<d.length;++g)this._trainPattern(d[g],!1)}_trainPattern(d,g){if(this.runInputs(d),this._calculateDeltas(d),this.adjustWeights(),g){if(!this.meanSquaredError)throw new Error("this.meanSquaredError not setup");let y=new Float32Array(1);for(let N=0,D=d.length-2;N<=D;N++){const F=this._layerSets[N],z=F[F.length-1],P=y;y=this.meanSquaredError.addAbsolute(P,z.errors),Pt(P)}return _t(this.meanSquaredError.divide(d.length,y))}return null}}class Wn{constructor(d,g){this.rows=0,this.columns=0,d&&(this.rows=d),g&&(this.columns=g),this.weights=Ye(this.rows*this.columns),this.deltas=Ye(this.rows*this.columns)}getWeight(d,g){const y=this.columns*d+g;if(y<0||y>=this.weights.length)throw new Error("get accessor is skewed");return this.weights[y]}setWeight(d,g,y){const N=this.columns*d+g;if(N<0||N>=this.weights.length)throw new Error("set accessor is skewed");return this.weights[N]=y,this}getDelta(d,g){const y=this.columns*d+g;if(y<0||y>=this.deltas.length)throw new Error("get accessor is skewed");return this.deltas[y]}setDelta(d,g,y){const N=this.columns*d+g;if(N<0||N>=this.weights.length)throw new Error("set accessor is skewed");return this.deltas[N]=y,this}toJSON(){return{rows:this.rows,columns:this.columns,weights:Array.from(this.weights.slice(0))}}static fromJSON(d){const g=new Wn(d.rows,d.columns);for(let y=0,N=d.rows*d.columns;y<N;y++)g.weights[y]=d.weights[y];return g}static fromArray(d){const g=new Wn(d.length,d[0].length);return g.fromArray(d),g}deltasToArray(){return this.toArray("deltas")}weightsToArray(){return this.toArray("weights")}toArray(d="weights"){const g=new Array(this.rows);return this.iterate({row:y=>{g[y]=new Array(this.columns)},column:(y,N)=>{d==="weights"?g[y][N]=this.getWeight(y,N):d==="deltas"&&(g[y][N]=this.getDelta(y,N))}}),g}fromArray(d,g="weights"){if(d.length!==this.rows)throw new Error("rows do not match");if(d[0].length!==this.columns)throw new Error("columns do not match");return this.iterate({column:(y,N)=>{const D=d[y][N];if(typeof D!="number")throw new Error("value not number");g==="weights"?this.setWeight(y,N,D):g==="deltas"&&this.setDelta(y,N,D)}}),this}iterate(d){const g=this.rows,y=this.columns;for(let N=0;N<g;N++){d.row&&d.row(N);for(let D=0;D<y;D++)d.column&&d.column(N,D)}return this}}class Ii extends Wn{constructor(d,g,y){super(d,g),this.std=y;for(let N=0,D=this.weights.length;N<D;N++)this.weights[N]=lt(-y,y)}}class is{constructor(d,g=0){this.values=d,this.indexTable={},this.characterTable={},this.characters=[],this.specialIndexes=[],this.isSetup=!1,d!==void 0&&this.setup(d,g)}setup(d,g=0){if(this.isSetup)throw new Error("DataFormatter is already setup");this.values=d,this.buildCharactersFromIterable(d),this.buildTables(g),d[0].input&&this.addInputOutput(),this.addUnrecognized(),this.isSetup=!0}buildCharactersFromIterable(d){const g={};for(let y=0,N=d.length;y<N;y++){const D=d[y];if(D.hasOwnProperty("length")){const F=D;for(let z=0,P=F.length;z<P;z++){const k=F[z];g.hasOwnProperty(k)||(g[k]=!0,this.characters.push(k))}}else if(typeof D=="number"){if(g.hasOwnProperty(D))continue;g[D]=!0,this.characters.push(D)}else if(typeof D=="boolean"){const F=D.toString();if(g.hasOwnProperty(F))continue;g[F]=!0,this.characters.push(F)}else if(Array.isArray(D)&&typeof D[0]=="string")for(let F=0;F<D.length;F++){const z=D[F];g.hasOwnProperty(z)||(g[z]=!0,this.characters.push(z))}else if(Array.isArray(D)&&(typeof D[0]=="number"||typeof D[0]=="boolean"))for(let F=0;F<D.length;F++){const z=D[F].toString();g.hasOwnProperty(y)||(g[z]=!0,this.characters.push(z))}else if(D.hasOwnProperty("input")&&D.hasOwnProperty("output")){const{input:F,output:z}=D;Array.isArray(F)?this.addCharacters(F,g):this.addCharacters(F.toString(),g),Array.isArray(z)?this.addCharacters(z,g):this.addCharacters(z.toString(),g)}else throw new Error("Unhandled value")}}addCharacters(d,g){for(let y=0;y<d.length;y++){const N=d[y].toString();g.hasOwnProperty(N)||(g[N]=!0,this.characters.push(N))}}buildTables(d){const g=this.characters.length;for(let y=0;y<g;y++){const N=this.characters[y];y>=d&&(this.indexTable[N]=y,this.characterTable[y]=N)}}toIndexes(d,g=0){const y=[],{indexTable:N}=this;switch(typeof d){case"number":case"boolean":d=d.toString()}for(let D=0,F=d.length;D<F;D++){const z=d[D].toString();let P=N[z];if(P===void 0)if(N.unrecognized)P=N.unrecognized;else throw new Error(`unrecognized character "${z}"`);P<g||y.push(P)}return y}toIndexesInputOutput(d,g,y=0){const N=this.toIndexesValue(d,y,!0);return typeof g>"u"?N:N.concat(this.toIndexesValue(g,y,!1))}toIndexesValue(d,g,y){if(typeof d=="string")d=d.split("");else if(typeof d=="number"||typeof d=="boolean")d=d.toString().split("");else if(Array.isArray(d)&&(typeof d[0]=="number"||typeof d[0]=="boolean"||typeof d[0]=="string"))d=d.map(N=>N.toString());else throw new Error("unrecognized value");return y&&(d=d.concat(["stop-input","start-output"])),this.toIndexes(d,g)}toCharacters(d,g=0){const y=[],{indexTable:N,characterTable:D}=this;for(let F=0,z=d.length;F<z;F++){const P=d[F];if(P<g)continue;let k=D[P];if(k===void 0)if(N.unrecognized)k=D[N.unrecognized];else throw new Error(`unrecognized index "${P}"`);else k!==null&&y.push(k.toString())}return y}toString(d,g){return this.toCharacters(d,g).join("")}addInputOutput(){this.addSpecial("stop-input"),this.addSpecial("start-output")}addUnrecognized(){this.addSpecial("unrecognized")}static fromAllPrintable(d,g=[`
`]){for(let y=32;y<=126;y++)g.push(String.fromCharCode(y));return new is(g,d)}static fromAllPrintableInputOutput(d,g=[`
`]){const y=is.fromAllPrintable(d,g);return y.addInputOutput(),y.addUnrecognized(),y}static fromStringInputOutput(d,g){const y=Array.from(new Set(d)).join(""),N=new is(y.split(""),g);return N.addInputOutput(),N.addUnrecognized(),N.isSetup=!0,N}static fromArrayInputOutput(d,g){const y=[];for(let F=0;F<d.length;F++){const z=d[F];y.push(Li(z.input),Li(z.output))}const N=Array.isArray(y)?y.flat():y,D=new is(Array.from(new Set(N)),g);return D.addInputOutput(),D.addUnrecognized(),D.isSetup=!0,D}static fromString(d,g=0){const y=Array.from(new Set(d)).join("");return new is(y.split(""),g)}toJSON(){return{indexTable:this.indexTable,characterTable:this.characterTable,values:this.values,characters:this.characters,specialIndexes:this.specialIndexes}}static fromJSON(d){const g=new is;return g.indexTable=d.indexTable,g.characterTable=d.characterTable,g.values=d.values,g.characters=d.characters,g.specialIndexes=d.specialIndexes,g.isSetup=!0,g}addSpecial(d,g=null){const y=this.indexTable[d]=this.characters.length;this.characterTable[y]=g,this.specialIndexes.push(this.characters.length),this.characters.push(d)}toFunctionString(){return`
var characterTable = ${JSON.stringify(this.characterTable)};
var indexTable = ${JSON.stringify(this.indexTable)};
var characters = ${JSON.stringify(this.characters)};
var dataFormatter = {
  toIndexes: function ${this.toIndexes.toString()},
  toIndexesInputOutput: function ${this.toIndexesInputOutput.toString()},
  toCharacters: function ${this.toCharacters.toString()},
  toIndexesValue: function ${this.toIndexesValue.toString()},
};`}formatDataIn(d,g){var y;return d===void 0?[]:Array.isArray(d)&&typeof d[0]=="number"?d:!((y=this.indexTable)===null||y===void 0)&&y.hasOwnProperty("stop-input")?this.toIndexesInputOutput(d,g):this.toIndexes(d)}formatDataOut(d,g){return this.toCharacters(g).join("")}format(d){if(typeof d[0]=="number"&&!Array.isArray(d[0])&&(!d[0].hasOwnProperty("input")||!d[0].hasOwnProperty("output")))return d;const g=[];if(typeof d[0]=="string"||typeof d[0]=="number"||Array.isArray(d[0]))if(this.isSetup)for(let y=0,N=d.length;y<N;y++)g.push(this.formatDataIn(d[y]));else{this.setup(d);for(let y=0;y<d.length;y++)g.push(this.formatDataIn(Li(d[y])))}else if(d[0].input&&d[0].output){this.isSetup||this.setup(d);for(let y=0,N=d.length;y<N;y++)g.push(this.formatDataIn(Li(d[y].input),Li(d[y].output)))}else throw new Error("unrecognized data");return g}}function Li(O){if(typeof O=="string")return O;if(typeof O=="number"||typeof O=="boolean")return O.toString();if(Array.isArray(O)&&typeof O[0]=="string")return O;if(typeof O[0]=="boolean")return O.map(d=>d.toString());if(typeof O[0]=="number")return O.map(d=>d.toString());throw new Error("unrecognized value, expected string[], string, number[], number, boolean[], or boolean")}function zi(O,d){O.rows=d.rows,O.columns=d.columns,O.weights=d.weights.slice(0),O.deltas=d.deltas.slice(0)}function Dr(O,d,g){for(let y=0;y<d.weights.length;y++)O.weights[y]=d.weights[y]+g.weights[y],O.deltas[y]=0}function gs(O,d,g){for(let y=0;y<O.deltas.length;y++)d.deltas[y]=O.deltas[y],g.deltas[y]=O.deltas[y]}function ul(O){for(let d=0;d<O.weights.length;d++)O.weights[d]=1,O.deltas[d]=0}function qo(O,d){O.rows=d.rows,O.columns=d.columns,O.weights=d.weights.slice(0),O.deltas=d.deltas.slice(0);for(let g=0;g<d.weights.length;g++)O.weights[g]=-d.weights[g],O.deltas[g]=0}function pu(O,d,g){const y=d.rows,N=d.columns,D=g.columns;for(let F=0;F<y;F++){const z=N*F,P=D*F;for(let k=0;k<D;k++){let R=0;for(let S=0;S<N;S++){const T=D*S,G=z+S,te=T+k;R+=d.weights[G]*g.weights[te],d.deltas[G]=0,g.deltas[te]=0}O.weights[P+k]=R}}}function pc(O,d,g){const y=d.rows,N=d.columns,D=g.columns;for(let F=0;F<y;F++){const z=N*F,P=D*F;for(let k=0;k<D;k++)for(let R=0;R<N;R++){const S=D*R,T=z+R,G=S+k,te=O.deltas[P+k];d.deltas[T]+=g.weights[G]*te,g.deltas[G]+=d.weights[T]*te}}}function gd(O,d,g){const{weights:y}=d;for(let N=0;N<y.length;N++)O.weights[N]=d.weights[N]*g.weights[N],O.deltas[N]=0}function vf(O,d,g){for(let y=0;y<d.weights.length;y++)d.deltas[y]=g.weights[y]*O.deltas[y],g.deltas[y]=d.weights[y]*O.deltas[y]}function _f(O,d){for(let g=0;g<d.weights.length;g++)O.weights[g]=Math.max(0,d.weights[g]),O.deltas[g]=0}function bf(O,d){for(let g=0;g<O.deltas.length;g++)d.deltas[g]=d.weights[g]>0?O.deltas[g]:0}function md(O,d,g){const{columns:y}=d,N=y*g;for(let D=0;D<y;D++)O.weights[D]=d.weights[N+D],O.deltas[D]=0}function yd(O,d,g){const{columns:y}=d,N=y*g;for(let D=0;D<y;D++)d.deltas[N+D]=O.deltas[D]}function gu(O,d){for(let g=0;g<d.weights.length;g++)O.weights[g]=1/(1+Math.exp(-d.weights[g])),O.deltas[g]=0}function Ao(O,d){for(let g=0;g<O.deltas.length;g++){const y=O.weights[g];d.deltas[g]=y*(1-y)*O.deltas[g]}}function Kl(O){const d=new Wn(O.rows,O.columns);let g=-999999;for(let N=0;N<O.weights.length;N++)O.weights[N]>g&&(g=O.weights[N]);let y=0;for(let N=0;N<O.weights.length;N++)d.weights[N]=Math.exp(O.weights[N]-g),y+=d.weights[N];for(let N=0;N<O.weights.length;N++)d.weights[N]/=y;return d}function co(O,d){for(let g=0;g<d.weights.length;g++)O.weights[g]=Math.tanh(d.weights[g]),O.deltas[g]=0}function mu(O,d){for(let g=0;g<O.deltas.length;g++){const y=O.weights[g];d.deltas[g]=(1-y*y)*O.deltas[g]}}class gc{constructor(){this.states=[],this.inputRow=0}add(d,g){if(d.weights.length!==g.weights.length)throw new Error("misaligned matrices");const y=new Wn(d.rows,d.columns);return this.states.push({name:"add",product:y,left:d,right:g,forwardFn:Dr,backpropagationFn:gs}),y}allOnes(d,g){const y=new Wn(d,g);return this.states.push({name:"allOnes",product:y,left:y,forwardFn:ul,backpropagationFn:()=>{}}),y}cloneNegative(d){const g=new Wn(d.rows,d.columns);return this.states.push({name:"cloneNegative",product:g,left:d,forwardFn:qo,backpropagationFn:()=>{}}),g}subtract(d,g){if(d.weights.length!==g.weights.length)throw new Error("misaligned matrices");return this.add(this.add(this.allOnes(d.rows,d.columns),this.cloneNegative(d)),g)}multiply(d,g){if(d.columns!==g.rows)throw new Error("misaligned matrices");const y=new Wn(d.rows,g.columns);return this.states.push({name:"multiply",product:y,left:d,right:g,forwardFn:pu,backpropagationFn:pc}),y}multiplyElement(d,g){if(d.weights.length!==g.weights.length)throw new Error("misaligned matrices");const y=new Wn(d.rows,d.columns);return this.states.push({name:"multiplyElement",product:y,left:d,right:g,forwardFn:gd,backpropagationFn:vf}),y}relu(d){const g=new Wn(d.rows,d.columns);return this.states.push({name:"relu",product:g,left:d,forwardFn:_f,backpropagationFn:bf}),g}input(d){return this.states.push({name:"input",product:d,forwardFn:g=>{if(this.inputValue){if(this.inputValue.length!==g.weights.length)throw new Error("this.inputValue is of wrong dimensions");g.weights=d.weights=this.inputValue}},backpropagationFn:()=>{}}),d}inputMatrixToRow(d){const g=this,y=new Wn(d.columns,1);return this.states.push({name:"inputMatrixToRow",product:y,left:d,get right(){return g.inputRow},forwardFn:md,backpropagationFn:yd}),y}sigmoid(d){const g=new Wn(d.rows,d.columns);return this.states.push({name:"sigmoid",product:g,left:d,forwardFn:gu,backpropagationFn:Ao}),g}tanh(d){const g=new Wn(d.rows,d.columns);return this.states.push({name:"tanh",product:g,left:d,forwardFn:co,backpropagationFn:mu}),g}observe(d){return this.states.push({name:"observe",product:new Wn,forwardFn:()=>{},backpropagationFn:()=>{}}),d}runIndex(d=0){this.inputRow=d;let g=this.states[0];for(let y=0,N=this.states.length;y<N;y++)g=this.states[y],g.hasOwnProperty("forwardFn")&&g.forwardFn(g.product,g.left,g.right);return g.product}runInput(d){this.inputValue=d;let g=this.states[0];for(let y=0,N=this.states.length;y<N;y++)g=this.states[y],g.hasOwnProperty("forwardFn")&&g.forwardFn(g.product,g.left,g.right);return g.product}backpropagate(){let d=this.states.length,g=this.states[0];for(;d-- >0;)g=this.states[d],g.hasOwnProperty("backpropagationFn")&&g.backpropagationFn(g.product,g.left,g.right);return g.product}backpropagateIndex(d=0){this.inputRow=d;let g=this.states.length,y=this.states[0];for(;g-- >0;)y=this.states[g],y.hasOwnProperty("backpropagationFn")&&y.backpropagationFn(y.product,y.left,y.right);return y.product}predictTarget(d,g){let y=0;const N=this.runInput(d);for(let D=0;D<N.weights.length;D++){const F=N.weights[D]-g[D];y+=Math.abs(F),N.deltas[D]=F}return y}predictTargetIndex(d,g){const y=this.runIndex(d),N=y,D=Kl(y);return N.deltas=D.weights.slice(0),N.deltas[g]-=1,-Math.log2(D.weights[g])}}function yu(O){const{weights:d}=O;let g=d[0],y=0;for(let N=1;N<d.length;N++){const D=d[N];D<g||(y=N,g=D)}return y}function vu(O){const d=lt(0,1),g=O.weights;let y=0,N=0;for(;;){if(y+=g[N],y>d)return N;N++}}const Al={iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.01,callbackPeriod:10,timeout:1/0},ho=()=>({inputSize:20,inputRange:20,hiddenLayers:[20,20],outputSize:20,decayRate:.999,smoothEps:1e-8,regc:1e-6,clipval:5,maxPredictionLength:100,dataFormatter:new is});class El{constructor(d={}){this.options={...ho()},this.trainOpts={...Al},this.stepCache={},this.runs=0,this.ratioClipped=0,this.model=Object.seal({isInitialized:!1,input:new Wn(0,0),hiddenLayers:[],output:new Wn(0,0),equations:[],allMatrices:[],equationConnections:[],outputConnector:new Ii(0,0,.08)}),this.initialLayerInputs=[],this.options={...this.options,...d},this.updateTrainingOptions({...Al}),d.json&&this.fromJSON(d.json)}initialize(){const{dataFormatter:d}=this.options;d?.characters.length&&(this.options.inputSize=this.options.inputRange=this.options.outputSize=d.characters.length),this.model=this.mapModel()}createHiddenLayers(){const{hiddenLayers:d,inputSize:g}=this.options,y=[];y.push(this.getHiddenLayer(d[0],g));let N=d[0];for(let D=1;D<d.length;D++){const F=d[D];y.push(this.getHiddenLayer(F,N)),N=F}return y}getHiddenLayer(d,g){return{weight:new Ii(d,g,.08),transition:new Ii(d,d,.08),bias:new Wn(d,1)}}getEquation(d,g,y,N){if(!N.weight||!N.transition||!N.bias)throw new Error("hiddenLayer does not have expected properties");const D=d.relu.bind(d),F=d.add.bind(d),z=d.multiply.bind(d);return D(F(F(z(N.weight,g),z(N.transition,y)),N.bias))}createInputMatrix(){const{inputRange:d,inputSize:g}=this.options;if(d<1)throw new Error("this.options.inputRange not an expected number");if(g<1)throw new Error("this.options.inputSize not an expected number");return new Ii(d+1,g,.08)}createOutputMatrices(){const{outputSize:d,hiddenLayers:g}=this.options,y=qs(g);return{outputConnector:new Ii(d+1,y,.08),output:new Wn(d+1,1)}}bindEquation(){const{model:d}=this,{hiddenLayers:g}=this.options,y=new gc,N=[],D=d.equationConnections.length>0?qs(d.equationConnections):this.initialLayerInputs;let F=this.getEquation(y,y.inputMatrixToRow(d.input),D[0],d.hiddenLayers[0]);N.push(F);for(let z=1,P=g.length;z<P;z++){if(!D[z])throw new Error(`Cannot find equation at index ${z}`);F=this.getEquation(y,F,D[z],d.hiddenLayers[z]),N.push(F)}d.equationConnections.push(N),y.add(y.multiply(d.outputConnector,F),d.output),d.equations.push(y)}mapModel(){const d=[];this.initialLayerInputs=this.options.hiddenLayers.map(F=>new Wn(F,1));const g=this.createInputMatrix();d.push(g);const y=this.createHiddenLayers();if(!y.length)throw new Error("net.hiddenLayers not set");for(let F=0,z=y.length;F<z;F++){const P=y[F];for(const k in P)P.hasOwnProperty(k)&&d.push(P[k])}const{output:N,outputConnector:D}=this.createOutputMatrices();return d.push(D),d.push(N),Object.seal({isInitialized:!0,input:g,hiddenLayers:y,output:N,equations:[],allMatrices:d,equationConnections:[],outputConnector:D})}trainInput(d){this.runs++;const{model:g}=this,y=d.length;let N=0,D;for(;g.equations.length<=d.length+1;)this.bindEquation();for(let F=-1,z=d.length;F<z;F++){const P=F+1;D=g.equations[P];const k=F===-1?0:d[F]+1,R=F===y-1?0:d[F+1]+1;N+=D.predictTargetIndex(k,R)}return Math.pow(2,N/(y-1))/100}backpropagate(d){let g=d.length;const{model:y}=this,{equations:N}=y;for(;g>0;)N[g].backpropagateIndex(d[g-1]+1),g--;N[0].backpropagateIndex(0)}adjustWeights(){const{regc:d,clipval:g,decayRate:y,smoothEps:N}=this.options,{trainOpts:D,model:F,stepCache:z}=this,{learningRate:P}=D,{allMatrices:k}=F;let R=0,S=0;for(let T=0;T<k.length;T++){const G=k[T],{weights:te,deltas:Te}=G;T in z||(z[T]=Ye(G.rows*G.columns));const ie=z[T];for(let _e=0;_e<te.length;_e++){let Y=Te[_e];const re=te[_e];ie[_e]=ie[_e]*y+(1-y)*Y*Y,Y>g?(Y=g,R++):Y<-g&&(Y=-g,R++),S++,te[_e]=re+-P*Y/Math.sqrt(ie[_e]+N)-d*re}}this.ratioClipped=R/S}get isRunnable(){return this.model&&this.model.equations.length===0?(console.error("No equations bound, did you run train()?"),!1):!0}checkRunnable(){if(!this.isRunnable)throw new Error("Network not runnable")}run(d=[],g=!1,y=1){const N=this.options.maxPredictionLength+(d!==null?d.length:0)+(this.options.dataFormatter?this.options.dataFormatter.specialIndexes.length:0);this.checkRunnable();const D=this.options.dataFormatter&&d.length>0?this.options.dataFormatter.formatDataIn(d):d,{model:F}=this,z=[];let P=0;for(;;){const k=P===0?0:P<D.length?D[P-1]+1:z[P-1];for(;F.equations.length<=P;)this.bindEquation();const S=F.equations[P].runIndex(k),T=new Wn(F.output.rows,F.output.columns);if(zi(T,S),y!==1&&g)for(let Te=0,ie=T.weights.length;Te<ie;Te++)T.weights[Te]/=y;const G=Kl(T),te=g?vu(G):yu(G);if(P++,te===0||P>=N)break;z.push(te)}return this.options.dataFormatter.formatDataOut(D,z.slice(D.length).map(k=>k-1))}verifyIsInitialized(){this.model.isInitialized||this.initialize()}updateTrainingOptions(d){var g;this.trainOpts={...Al,...d},this.validateTrainingOptions(this.trainOpts),this.setLogMethod((g=d.log)!==null&&g!==void 0?g:this.trainOpts.log)}validateTrainingOptions(d){const g={iterations:()=>{const y=d.iterations;return typeof y=="number"&&y>0},errorThresh:()=>{const y=d.errorThresh;return typeof y=="number"&&y>0&&y<1},log:()=>{const y=d.log;return typeof y=="function"||typeof y=="boolean"},logPeriod:()=>{const y=d.logPeriod;return typeof y=="number"&&y>0},learningRate:()=>{const y=d.learningRate;return typeof y=="number"&&y>0&&y<1},callback:()=>{const y=d.callback;return typeof y=="function"||y===void 0},callbackPeriod:()=>{const y=d.callbackPeriod;return typeof y=="number"&&y>0},timeout:()=>{const y=d.timeout;return typeof y=="number"&&y>0}};for(const y in g){const N=d;if(!g[y]())throw new Error(`[${y}, ${N[y]}] is out of normal training range, your network will probably not train.`)}}setLogMethod(d){typeof d=="function"?this.trainOpts.log=d:d?this.trainOpts.log=console.log:this.trainOpts.log=!1}prepTraining(d,g){var y;this.updateTrainingOptions(g);const N=this.options.dataFormatter.format(d),D=Date.now()+((y=this.trainOpts.timeout)!==null&&y!==void 0?y:0),F={error:1,iterations:0};return this.verifyIsInitialized(),{preparedData:N,status:F,endTime:D}}train(d,g={}){var y;this.trainOpts=g={...Al,...g};const{iterations:N,errorThresh:D,logPeriod:F,callback:z,callbackPeriod:P}=this.trainOpts,k=g.log===!0?console.log:g.log;let R=1/0,S,T;if(!((y=this.options)===null||y===void 0)&&y.dataFormatter)T=this.options.dataFormatter.format(d);else if(Array.isArray(d)&&Array.isArray(d[0])&&typeof d[0][0]=="number")T=d;else throw new Error("training not in expected format of number[][]");for(this.verifyIsInitialized(),S=0;S<N&&R>D;S++){let G=0;for(let te=0;te<T.length;te++){const Te=this.trainPattern(T[te],!0);G+=Te}if(R=G/d.length,isNaN(R))throw new Error("Network error rate is unexpected NaN, check network configurations and try again. Most probably input format is not correct or training data is not enough. ");k&&S%F===0&&k(`iterations: ${S}, training error: ${R}`),z&&S%P===0&&z({error:R,iterations:S})}return{error:R,iterations:S}}addFormat(d){}formatData(d){const g=[];for(let y=0;y<d.length;y++)g.push(this.options.dataFormatter.formatDataIn(d[y]));return g}toJSON(){this.model.isInitialized||this.initialize();const{model:d,options:g}=this;return{type:this.constructor.name,options:{...g,dataFormatter:g.dataFormatter.toJSON()},trainOpts:{...this.trainOpts,timeout:this.trainOpts.timeout===1/0?"Infinity":this.trainOpts.timeout},input:d.input.toJSON(),hiddenLayers:d.hiddenLayers.map(y=>{const N={};for(const D in y)y.hasOwnProperty(D)&&(N[D]=y[D].toJSON());return N}),outputConnector:this.model.outputConnector.toJSON(),output:this.model.output.toJSON()}}fromJSON(d){const{options:g}=d,y=[],N=Wn.fromJSON(d.input);y.push(N);const D=[];d.hiddenLayers.forEach(P=>{const k={};for(const R in P)k[R]=Wn.fromJSON(P[R]),y.push(k[R]);D.push(k)});const F=Wn.fromJSON(d.outputConnector);y.push(F);const z=Wn.fromJSON(d.output);return y.push(z),g.dataFormatter?this.options={...ho(),...g,dataFormatter:is.fromJSON(g.dataFormatter)}:this.options={...ho(),...g,dataFormatter:new is},this.model=Object.seal({isInitialized:!0,input:N,hiddenLayers:D,output:z,allMatrices:y,outputConnector:F,equations:[],equationConnections:[]}),this.initialLayerInputs=this.options.hiddenLayers.map(P=>new Wn(P,1)),this.bindEquation(),this}toFunction(d){const{model:g}=this,{equations:y}=this.model,N=y[1],{states:D}=N,F=JSON.stringify(this.toJSON());function z(ie){const _e=g.equationConnections[0],{states:Y}=y[0];for(let re=0,be=Y.length;re<be;re++)if(Y[re].product===ie)return re;return _e.indexOf(ie)}function P(ie,_e){for(let Y=0,re=D.length;Y<re;Y++){const be=D[Y];if(Y===_e){const ke=z(ie);return ke>-1&&(ie===be.left||ie===be.right)?`typeof prevStates[${ke}] === 'object' ? prevStates[${ke}].product : new Matrix(${ie.rows}, ${ie.columns})`:`new Matrix(${ie.rows}, ${ie.columns})`}if(ie===be.product)return`states[${Y}].product`;if(ie===be.right)return`states[${Y}].right`;if(ie===be.left)return`states[${Y}].left`}return""}function k(ie,_e){if(!ie||!ie.rows||!ie.columns)return"null";if(ie===g.input)return"json.input";if(ie===g.outputConnector)return"json.outputConnector";if(ie===g.output)return"json.output";for(let Y=0,re=g.hiddenLayers.length;Y<re;Y++){const be=g.hiddenLayers[Y];for(const ke in be)if(be.hasOwnProperty(ke)&&be[ke]===ie)return`json.hiddenLayers[${Y}].${ke}`}return P(ie,_e)}function R(ie){const _e=ie.toString().split("{");_e.shift();const re=_e.join("{").split("}");return re.pop(),re.join("}").split(`
`).join(`
        `).replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")}function S(ie){return`src/recurrent/matrix/${ie.replace(/[A-Z]/g,function(_e){return`-${_e.toLowerCase()}`})}.js`}const T=[],G={},te=[];for(let ie=0,_e=D.length;ie<_e;ie++){const Y=D[ie];T.push(`states[${ie}] = {
      name: '${Y.forwardFn.name}',
      left: ${Y.left?k(Y.left,ie):"undefined"},
      right: ${Y.right?k(Y.right,ie):"undefined"},
      product: ${k(Y.product,ie)}
    }`);const re=Y.forwardFn.name;G[re]||(G[re]=!0,te.push(`        case '${re}': //compiled from ${S(re)}
          ${R(Y.forwardFn.toString())}
          break;`))}const Te=`
  if (typeof rawInput === 'undefined') rawInput = [];
  if (typeof isSampleI === 'undefined') isSampleI = false;
  if (typeof temperature === 'undefined') temperature = 1;
  var json = ${F};
  ${this.options.dataFormatter?`${this.options.dataFormatter.toFunctionString()};
  Object.assign(dataFormatter, json.options.dataFormatter);`:""}
  ${this.options.dataFormatter&&typeof this.options.dataFormatter.formatDataIn=="function"?`const formatDataIn = function (input, output) { ${R(this.options.dataFormatter.formatDataIn.toString())} }.bind(dataFormatter);`:""}
  ${this.options.dataFormatter!==null&&typeof this.options.dataFormatter.formatDataOut=="function"?`const formatDataOut = function formatDataOut(input, output) { ${R(this.options.dataFormatter.formatDataOut.toString())} }.bind(dataFormatter);`:""}
  var maxPredictionLength =
    ${this.options.maxPredictionLength} +
    rawInput.length +
    ${this.options.dataFormatter?this.options.dataFormatter.specialIndexes.length:0};
  var input = ${this.options.dataFormatter&&typeof this.options.dataFormatter.formatDataIn=="function"?"formatDataIn(rawInput)":"rawInput"};
  var _i = 0;
  var output = [];
  var states = [];
  var prevStates;
  while (true) {
    var previousIndex = (_i === 0
        ? 0
        : _i < input.length
          ? input[_i - 1] + 1
          : output[_i - 1])
          ;
    var rowPluckIndex = previousIndex;
    prevStates = states;
    states = [];
    ${T.join(`;
    `)};
    for (var stateIndex = 0, stateMax = ${T.length}; stateIndex < stateMax; stateIndex++) {
      var state = states[stateIndex];
      var product = state.product;
      var left = state.left;
      var right = state.right;
      switch (state.name) {
${te.join(`
`)}
      }
    }

    var logProbabilities = state.product;
    if (temperature !== 1 && isSampleI) {
      for (var q = 0, nq = logProbabilities.weights.length; q < nq; q++) {
        logProbabilities.weights[q] /= temperature;
      }
    }

    var probs = softmax(logProbabilities);
    var nextIndex = isSampleI ? sampleI(probs) : maxI(probs);

    _i++;
    if (nextIndex === 0) {
      break;
    }
    if (_i >= maxPredictionLength) {
      break;
    }

    output.push(nextIndex);
  }
  ${this.options.dataFormatter&&typeof this.options.dataFormatter.formatDataOut=="function"?"return formatDataOut(input, output.slice(input.length).map(function(value) { return value - 1; }))":"return output.slice(input.length).map(function(value) { return value - 1; })"};
  function Matrix(rows, columns) {
    this.rows = rows;
    this.columns = columns;
    this.weights = zeros(rows * columns);
  }
  ${Ye.toString()}
  ${Kl.toString().replace("_1.Matrix","Matrix")}
  ${lt.toString()}
  ${vu.toString()}
  ${yu.toString()}`;return new Function("rawInput","isSampleI","temperature",d?d(Te):Te)}trainPattern(d,g){const y=this.trainInput(d);return this.backpropagate(d),this.adjustWeights(),g?y:0}}function qs(O){return O[O.length-1]}class Ys extends El{getHiddenLayer(d,g){return mc(d,g)}getEquation(d,g,y,N){return ha(d,g,y,N)}}function mc(O,d){return{updateGateInputMatrix:new Ii(O,d,.08),updateGateHiddenMatrix:new Ii(O,O,.08),updateGateBias:new Wn(O,1),resetGateInputMatrix:new Ii(O,d,.08),resetGateHiddenMatrix:new Ii(O,O,.08),resetGateBias:new Wn(O,1),cellWriteInputMatrix:new Ii(O,d,.08),cellWriteHiddenMatrix:new Ii(O,O,.08),cellWriteBias:new Wn(O,1)}}function ha(O,d,g,y){if(!y.updateGateInputMatrix||!y.updateGateHiddenMatrix||!y.updateGateBias||!y.resetGateInputMatrix||!y.resetGateHiddenMatrix||!y.resetGateBias||!y.cellWriteInputMatrix||!y.cellWriteHiddenMatrix||!y.cellWriteBias)throw new Error("hiddenLayer does not have expected properties");const N=O.sigmoid.bind(O),D=O.add.bind(O),F=O.multiply.bind(O),z=O.multiplyElement.bind(O),P=O.tanh.bind(O),k=O.allOnes.bind(O),R=O.cloneNegative.bind(O),S=N(D(D(F(y.updateGateInputMatrix,d),F(y.updateGateHiddenMatrix,g)),y.updateGateBias)),T=N(D(D(F(y.resetGateInputMatrix,d),F(y.resetGateHiddenMatrix,g)),y.resetGateBias)),G=P(D(D(F(y.cellWriteInputMatrix,d),F(y.cellWriteHiddenMatrix,z(T,g))),y.cellWriteBias));return D(z(D(k(S.rows,S.columns),R(S)),G),z(g,S))}class yc{constructor(d,g){this.prop=g,this.length=0,this.table={};for(let y=0;y<d.length;y++){const D=d[y][g];for(let F=0;F<D.length;F++){const z=D[F];for(const P in z)z.hasOwnProperty(P)&&(this.table.hasOwnProperty(P)||(this.table[P]=this.length++))}}}}const fo=()=>({...ho(),inputSize:1,hiddenLayers:[20],outputSize:1,inputRange:0});class Wl extends El{constructor(d={}){super(),this.inputLookupLength=0,this.inputLookup=null,this.outputLookup=null,this.outputLookupLength=0,this.model=Object.seal({isInitialized:!1,hiddenLayers:[],output:new Wn(0,0),equations:[],allMatrices:[],equationConnections:[],outputConnector:new Ii(0,0,.08)}),this.options=fo(),this.options={...this.options,...d},this.updateTrainingOptions({...Vu,...d}),d.json&&this.fromJSON(d.json)}createInputMatrix(){throw new Error("Input Matrices do not exist on RNNTimeStep")}createOutputMatrices(){const{outputSize:d}=this.options,g=qs(this.options.hiddenLayers),y=new Ii(d,g,.08);return{output:new Ii(d,1,.08),outputConnector:y}}bindEquation(){const{model:d,options:g}=this,{hiddenLayers:y,inputSize:N}=g,D=d.hiddenLayers,F=new gc,z=[],P=d.equationConnections.length>0?d.equationConnections[d.equationConnections.length-1]:this.initialLayerInputs;let k=this.getEquation(F,F.input(new Wn(N,1)),P[0],D[0]);z.push(k);for(let R=1,S=y.length;R<S;R++)k=this.getEquation(F,k,P[R],D[R]),z.push(k);d.equationConnections.push(z),F.add(F.multiply(d.outputConnector,k),d.output),d.equations.push(F)}initialize(){this.model=this.mapModel()}mapModel(){const d=[];this.initialLayerInputs=this.options.hiddenLayers.map(D=>new Wn(D,1));const g=this.createHiddenLayers();for(let D=0,F=g.length;D<F;D++){const z=g[D];for(const P in z)z.hasOwnProperty(P)&&d.push(z[P])}const{outputConnector:y,output:N}=this.createOutputMatrices();return d.push(y),d.push(N),Object.seal({isInitialized:!0,hiddenLayers:g,output:N,equations:[],allMatrices:d,equationConnections:[],outputConnector:y})}backpropagate(){for(let d=this.model.equations.length-1;d>-1;d--)this.model.equations[d].backpropagate()}run(d){const g=me.dataShape(d).join(",");switch(g){case"array,number":return this.runArray(d);case"array,array,number":return this.runArrayOfArray(d);case"object,number":return this.runObject(d);case"array,object,number":return this.runArrayOfObject(d);default:throw new Error(`Unrecognized data shape ${g}`)}}forecast(d,g=1){const y=me.dataShape(d).join(",");switch(y){case"array,number":return this.forecastArray(d,g);case"array,array,number":return this.forecastArrayOfArray(d,g);case"object,number":return this.runObject(d);case"array,object,number":return this.forecastArrayOfObject(d,g);default:throw new Error(`Unrecognized data shape ${y}`)}}forecastArray(d,g=1){this.checkRunnable();const{model:y}=this,{equations:N}=y,D=d.length+g;for(;N.length<=D;)this.bindEquation();let F,z=0;if(this.options.inputSize===1)for(let k=0;k<d.length;k++)F=N[z++].runInput(Float32Array.from([d[k]]));else for(let k=0;k<d.length;k++)F=N[z++].runInput(Float32Array.from([]));if(!F)throw new Error("lastOutput not set");const P=[F.weights[0]];for(let k=0,R=g-1;k<R;k++)F=N[z++].runInput(F.weights),P.push(F.weights[0]);return this.end(),Float32Array.from(P)}forecastArrayOfArray(d,g=1){this.checkRunnable();const{model:y}=this,{equations:N}=y,D=d.length+g;for(;N.length<=D;)this.bindEquation();let F,z=0;for(let k=0;k<d.length;k++)F=N[z++].runInput(d[k]);if(!F)throw new Error("lastOutput not set");const P=[Float32Array.from(F.weights)];for(let k=0,R=g-1;k<R;k++)F=N[z++].runInput(F.weights),P.push(Float32Array.from(F.weights.slice(0)));return this.end(),P}forecastArrayOfObject(d,g=1){if(!this.inputLookup)throw new Error("this.inputLookup not set");if(!this.outputLookup)throw new Error("this.outputLookup not set");const y=d.map(N=>me.toArray(this.inputLookup,N,this.inputLookupLength));return this.forecastArrayOfArray(y,g).map(N=>me.toObject(this.outputLookup,N))}train(d,g={}){this.trainOpts=g={...Al,...g},this.options.inputSize===1&&this.options.outputSize===1&&this.setSize(d),this.verifySize();const y=this.formatData(d);let N=1/0,D;this.verifyIsInitialized();const{iterations:F,errorThresh:z,logPeriod:P,callback:k,callbackPeriod:R}=this.trainOpts,S=g.log===!0?console.log:g.log;for(D=0;D<F&&N>z;D++){let T=0;for(let G=0;G<y.length;G++){const te=this.trainPattern(y[G],!0);T+=te}if(N=T/y.length,isNaN(N))throw new Error("Network error rate is unexpected NaN, check network configurations and try again. Most probably input format is not correct or training data is not enough. ");S&&D%P===0&&S(`iterations: ${D}, training error: ${N}`),k&&D%R===0&&k({error:N,iterations:D})}return{error:N,iterations:D}}trainArrayOfArray(d){if(d.length<2)throw new Error("input must be an array of 2 or more");const{equations:g}=this.model;for(;g.length<d.length;)this.bindEquation();let y=0;for(let N=0,D=d.length-1;N<D;N++)y+=g[N].predictTarget(d[N],d[N+1]);return this.end(),y/d.length}trainPattern(d,g){const y=this.trainArrayOfArray(d);return this.backpropagate(),this.adjustWeights(),g?y:0}setSize(d){let g=0;switch(me.dataShape(d).join(",")){case"array,array,number":case"array,object,number":case"array,datum,array,number":case"array,datum,object,number":g=1;break;case"array,array,array,number":g=d[0][0].length;break;case"array,array,object,number":g=Object.keys(me.toTable2D(d)).length;break;case"array,datum,array,array,number":g=d[0].input[0].length;break;case"array,datum,array,object,number":g=Object.keys(me.toInputTable2D(d)).length;break;default:throw new Error("unknown data shape or configuration")}this.options=Object.seal({...this.options,inputSize:g,outputSize:g})}verifySize(){if((this.options.inputSize||this.options.outputSize)&&this.options.inputSize!==this.options.outputSize)throw new Error("manually set inputSize and outputSize mismatch")}runArray(d){this.checkRunnable();const{equations:g}=this.model;for(;g.length<=d.length;)this.bindEquation();let y;for(let N=0;N<d.length;N++)y=g[N].runInput(new Float32Array([d[N]]));return this.end(),y.weights[0]}runArrayOfArray(d){this.checkRunnable();const{model:g}=this,{equations:y}=g;for(;y.length<=d.length;)this.bindEquation();let N;for(let D=0;D<d.length;D++)N=y[D].runInput(d[D]).weights;return this.end(),N??Float32Array.from([])}runObject(d){if(!this.inputLookup)throw new Error("this.inputLookup not set");if(!this.outputLookup)throw new Error("this.outputLookup not set");if(!this.outputLookupLength)throw new Error("this.outputLookupLength not set");if(this.inputLookup===this.outputLookup){const g=me.toArrayShort(this.inputLookup,d);return me.toObjectPartial(this.outputLookup,this.forecastArray(g,this.outputLookupLength-g.length),g.length)}return me.toObject(this.outputLookup,this.forecastArray(me.toArray(this.inputLookup,d,this.inputLookupLength),this.outputLookupLength))}runArrayOfObject(d){if(this.inputLookup===null)throw new Error("this.inputLookup not set");if(this.outputLookup===null)throw new Error("this.outputLookup not set");const g=d.map(y=>me.toArray(this.inputLookup,y,this.inputLookupLength));return this.forecastArrayOfArray(g,1).map(y=>me.toObject(this.outputLookup,y))[0]}runArrayOfObjectOfArray(d){if(!this.inputLookup)throw new Error("this.inputLookup not set");if(!this.outputLookup)throw new Error("this.outputLookup not set");return me.toObject(this.outputLookup,this.runArrayOfArray(me.toArrays(this.inputLookup,d,this.inputLookupLength)))}end(){this.model.equations[this.model.equations.length-1].runInput(new Float32Array(this.options.outputSize))}requireInputOutputOfOne(){if(this.options.inputSize!==1)throw new Error("inputSize must be 1 for this data size");if(this.options.outputSize!==1)throw new Error("outputSize must be 1 for this data size")}formatArray(d){const g=[];this.requireInputOutputOfOne();for(let y=0;y<d.length;y++)g.push(Float32Array.from([d[y]]));return[g]}formatArrayOfArray(d){const g=[],{inputSize:y,outputSize:N}=this.options;if(y===1&&N===1){for(let D=0;D<d.length;D++)g.push(ee(d[D]));return g}if(y!==d[0].length)throw new Error("inputSize must match data input size");if(N!==d[0].length)throw new Error("outputSize must match data output size");for(let D=0;D<d.length;D++)g.push(Float32Array.from(d[D]));return[g]}formatArrayOfObject(d){if(this.requireInputOutputOfOne(),!this.inputLookup){const y=new nt(d);this.inputLookup=this.outputLookup=y.table,this.inputLookupLength=this.outputLookupLength=y.length}const g=[];for(let y=0;y<d.length;y++)g.push(ae(d[y]));return g}formatArrayOfObjectMulti(d){if(!this.inputLookup){const y=new nt(d);this.inputLookup=this.outputLookup=y.table,this.inputLookupLength=this.outputLookupLength=y.length}const g=[];for(let y=0;y<d.length;y++)g.push([ze(d[y],this.inputLookup,this.inputLookupLength)]);return g}formatArrayOfDatumOfArray(d){const g=[];this.requireInputOutputOfOne();for(let y=0;y<d.length;y++){const N=d[y];g.push(J(N.input,N.output))}return g}formatArrayOfDatumOfObject(d){if(this.requireInputOutputOfOne(),!this.inputLookup){const y=new nt(d,"input");this.inputLookup=y.table,this.inputLookupLength=y.length}if(!this.outputLookup){const y=new nt(d,"output");this.outputLookup=y.table,this.outputLookupLength=y.length}const g=[];for(let y=0;y<d.length;y++){const N=d[y];g.push(le(N.input,N.output))}return g}formatArrayOfArrayOfArray(d){const g=[];for(let y=0;y<d.length;y++)g.push(Ve(d[y]));return g}formatArrayOfArrayOfObject(d){if(!this.inputLookup){const y=new nt(d);this.inputLookup=this.outputLookup=y.table,this.inputLookupLength=this.outputLookupLength=y.length}const g=[];for(let y=0;y<d.length;y++){const N=[];for(let D=0;D<d[y].length;D++)N.push(ze(d[y][D],this.inputLookup,this.inputLookupLength));g.push(N)}return g}formatArrayOfDatumOfArrayOfArray(d){const g=[],{inputSize:y,outputSize:N}=this.options;if(y!==d[0].input[0].length)throw new Error("inputSize must match data input size");if(N!==d[0].output[0].length)throw new Error("outputSize must match data output size");for(let D=0;D<d.length;D++){const F=d[D];g.push(pe(F.input,F.output))}return g}formatArrayOfDatumOfArrayOfObject(d){if(!this.inputLookup){const y=new yc(d,"input");this.inputLookup=y.table,this.inputLookupLength=y.length}if(!this.outputLookup){const y=new yc(d,"output");this.outputLookup=y.table,this.outputLookupLength=y.length}if(!this.outputLookupLength)throw new Error("this.outputLookupLength not set to usable number");const g=[];for(let y=0;y<d.length;y++){const N=d[y];g.push(X(N.input,N.output,this.inputLookup,this.outputLookup,this.inputLookupLength,this.outputLookupLength))}return g}formatData(d){switch(me.dataShape(d).join(",")){case"array,number":return this.formatArray(d);case"array,array,number":return this.formatArrayOfArray(d);case"array,object,number":return this.options.inputSize===1?this.formatArrayOfObject(d):this.formatArrayOfObjectMulti(d);case"array,datum,array,number":return this.formatArrayOfDatumOfArray(d);case"array,datum,object,number":return this.formatArrayOfDatumOfObject(d);case"array,array,array,number":return this.formatArrayOfArrayOfArray(d);case"array,array,object,number":return this.formatArrayOfArrayOfObject(d);case"array,datum,array,array,number":return this.formatArrayOfDatumOfArrayOfArray(d);case"array,datum,array,object,number":return this.formatArrayOfDatumOfArrayOfObject(d);default:throw new Error("unknown data shape or configuration")}}test(d){const g=[];let y=0;const N=this.formatData(d);for(let D=0;D<N.length;D++){const F=N[D],z=this.run(F.splice(0,F.length-1)),P=F[F.length-1];let k=0,R=0;for(let T=0;T<z.length;T++){R++;const G=P[T]-z[T];k+=G*G}if(y+=k/R,Math.abs(k)>this.trainOpts.errorThresh){const T=d[D];g.push({value:T,actual:z})}}return{error:y/N.length,misclasses:g,total:N.length}}addFormat(d){var g,y,N,D,F,z;switch(me.dataShape(d).join(",")){case"array,array,number":case"datum,array,array,number":case"array,number":case"datum,array,number":return;case"datum,object,number":{this.inputLookup=me.addKeys(d.input,(g=this.inputLookup)!==null&&g!==void 0?g:{}),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=me.addKeys(d.output,(y=this.outputLookup)!==null&&y!==void 0?y:{}),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break}case"object,number":{this.inputLookup=this.outputLookup=me.addKeys(d,(N=this.inputLookup)!==null&&N!==void 0?N:{}),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break}case"array,object,number":{const k=d;for(let R=0;R<k.length;R++)this.inputLookup=this.outputLookup=me.addKeys(k[R],(D=this.inputLookup)!==null&&D!==void 0?D:{}),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break}case"datum,array,object,number":{const k=d,R=k.input;for(let T=0;T<R.length;T++)this.inputLookup=me.addKeys(R[T],(F=this.inputLookup)!==null&&F!==void 0?F:{}),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length);const S=k.output;for(let T=0;T<S.length;T++)this.outputLookup=me.addKeys(S[T],(z=this.outputLookup)!==null&&z!==void 0?z:{}),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break}default:throw new Error("unknown data shape or configuration")}}toJSON(){this.model||this.initialize();const{model:d}=this,g={...this.options,...ho};return{type:this.constructor.name,options:g,hiddenLayers:d.hiddenLayers.map(y=>{const N={};for(const D in y)y.hasOwnProperty(D)&&(N[D]=y[D].toJSON());return N}),outputConnector:d.outputConnector.toJSON(),output:d.output.toJSON(),inputLookup:this.inputLookup,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup,outputLookupLength:this.outputLookupLength}}fromJSON(d){const{options:g}=d,y=[],N=[];d.hiddenLayers.forEach(z=>{const P={};for(const k in z)P[k]=Wn.fromJSON(z[k]),y.push(P[k]);N.push(P)});const D=Wn.fromJSON(d.outputConnector);y.push(D);const F=Wn.fromJSON(d.output);return y.push(F),this.options={...fo(),...g},this.inputLookup=d.inputLookup,this.inputLookupLength=d.inputLookupLength,this.outputLookup=d.outputLookup,this.outputLookupLength=d.outputLookupLength,this.model=Object.seal({isInitialized:!0,hiddenLayers:N,output:F,allMatrices:y,outputConnector:D,equations:[],equationConnections:[]}),this.initialLayerInputs=g.hiddenLayers.map(z=>new Wn(z,1)),this.bindEquation(),this}toFunction(d){const{model:g,inputLookup:y,inputLookupLength:N,outputLookup:D,outputLookupLength:F}=this,{inputSize:z}=this.options,{equations:P}=g,k=P[1],{states:R}=k,S=JSON.stringify(this.toJSON());function T(Q){const U=g.equationConnections[0],{states:Me}=P[0];for(let Fe=0,bt=Me.length;Fe<bt;Fe++)if(Me[Fe].product===Q)return Fe;return U.indexOf(Q)}function G(Q,U){for(let Me=0,Fe=R.length;Me<Fe;Me++){const bt=R[Me];if(Me===U){const v=T(Q);switch(Q){case bt.left:if(v>-1)return`typeof prevStates[${v}] === 'object' ? prevStates[${v}].product : new Matrix(${Q.rows}, ${Q.columns})`;case bt.right:if(v>-1)return`typeof prevStates[${v}] === 'object' ? prevStates[${v}].product : new Matrix(${Q.rows}, ${Q.columns})`;case bt.product:return`new Matrix(${Q.rows}, ${Q.columns})`;default:throw Error("unknown state")}}if(Q===bt.product)return`states[${Me}].product`;if(Q===bt.right)return`states[${Me}].right`;if(Q===bt.left)return`states[${Me}].left`}return""}function te(Q,U){if(!Q||!Q.rows||!Q.columns)return"null";if(Q===g.outputConnector)return"json.outputConnector";if(Q===g.output)return"json.output";for(let Me=0,Fe=g.hiddenLayers.length;Me<Fe;Me++){const bt=g.hiddenLayers[Me];for(const v in bt)if(bt.hasOwnProperty(v)&&bt[v]===Q)return`json.hiddenLayers[${Me}].${v}`}return G(Q,U)}function Te(){return y?z===1?y===D?`function lookupInput(input) {
            var table = ${JSON.stringify(y)};
            var result = [];
            for (var p in table) {
              if (!input.hasOwnProperty(p)) break;
              result.push(Float32Array.from([input[p]]));
            }
            return result;
          }`:`function lookupInput(input) {
          var table = ${JSON.stringify(y)};
          var result = [];
          for (var p in table) {
            result.push(Float32Array.from([input[p]]));
          }
          return result;
        }`:`function lookupInput(rawInputs) {
        var table = ${JSON.stringify(y)};
        var result = [];
        for (var i = 0; i < rawInputs.length; i++) {
          var rawInput = rawInputs[i];
          var input = new Float32Array(${N});
          for (var p in table) {
            input[table[p]] = rawInput.hasOwnProperty(p) ? rawInput[p] : 0;
          }
          result.push(input);
        }
        return result;
      }`:""}function ie(){return D?z===1?y===D?`function lookupOutputPartial(output, input) {
            var table = ${JSON.stringify(D)};
            var offset = input.length;
            var result = {};
            var i = 0;
            for (var p in table) {
              if (i++ < offset) continue;
              result[p] = output[table[p] - offset][0];
            }
            return result;
          }`:`function lookupOutput(output) {
          var table = ${JSON.stringify(D)};
          var result = {};
          for (var p in table) {
            result[p] = output[table[p]][0];
          }
          return result;
        }`:`function lookupOutput(output) {
        var table = ${JSON.stringify(D)};
        var result = {};
        for (var p in table) {
          result[p] = output[table[p]];
        }
        return result;
      }`:""}function _e(Q){const U=Q.toString().split("{");U.shift();const Fe=U.join("{").split("}");return Fe.pop(),Fe.join("}").split(`
`).join(`
        `).replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")}function Y(Q){return`src/recurrent/matrix/${Q.replace(/[A-Z]/g,function(U){return`-${U.toLowerCase()}`})}.js`}const re=[],be={},ke=[];for(let Q=0,U=R.length;Q<U;Q++){const Me=R[Q];re.push(`states[${Q}] = {
      name: '${Me.forwardFn.name}',
      left: ${Me.left?te(Me.left,Q):"undefined"},
      right: ${Me.right?te(Me.right,Q):"undefined"},
      product: ${te(Me.product,Q)}
    }`);const Fe=Me.forwardFn.name;be[Fe]||(be[Fe]=!0,Me.name==="input"?(ke.push(`case '${Fe}':`),ke.push(y&&z===1?"product.weights = _i < input.length ? input[_i]: prevStates[prevStates.length - 1].product.weights;":z===1?"product.weights = [input[_i]];":"product.weights = input[_i];"),ke.push("break;")):ke.push(`        case '${Fe}':${Fe!=="forwardFn"?` //compiled from ${Y(Fe)}`:""}
          ${_e(Me.forwardFn.toString())}
          break;`))}const rt=z===1&&this.outputLookup,vt=`
  var input = ${this.inputLookup?"lookupInput(rawInput)":"rawInput"};
  var json = ${S};
  var output = [];
  var states = [];
  var prevStates;
  var state;
  var max = ${rt?y===D?N:`input.length + ${F-1}`:"input.length"};
  for (var _i = 0; _i < max; _i++) {
    prevStates = states;
    states = [];
    ${re.join(`;
    `)};
    for (var stateIndex = 0, stateMax = ${re.length}; stateIndex < stateMax; stateIndex++) {
      state = states[stateIndex];
      var product = state.product;
      var left = state.left;
      var right = state.right;

      switch (state.name) {
${ke.join(`
`)}
      }
    }
    ${z===1&&y?"if (_i >= input.length - 1) { output.push(state.product.weights); }":"output = state.product.weights;"}
  }
  ${D?D===y?"return lookupOutputPartial(output, input)":"return lookupOutput(output)":z===1?"return output[0]":"return output"};
  ${Te()}
  ${ie()}

  function Matrix(rows, columns) {
    this.rows = rows;
    this.columns = columns;
    this.weights = new Float32Array(rows * columns);
  }
  ${Kl.toString().replace("_2.default","Matrix")}
  ${lt.toString()}
  ${vu.toString()}
  ${yu.toString()}`;return new Function("rawInput",d?d(vt):vt)}}const Vu={...Al};class Il extends Wl{getHiddenLayer(d,g){return mc(d,g)}getEquation(d,g,y,N){return ha(d,g,y,N)}}class zu extends El{getHiddenLayer(d,g){return vc(d,g)}getEquation(d,g,y,N){return _u(d,g,y,N)}}function vc(O,d){return{inputMatrix:new Ii(O,d,.08),inputHidden:new Ii(O,O,.08),inputBias:new Wn(O,1),forgetMatrix:new Ii(O,d,.08),forgetHidden:new Ii(O,O,.08),forgetBias:new Wn(O,1),outputMatrix:new Ii(O,d,.08),outputHidden:new Ii(O,O,.08),outputBias:new Wn(O,1),cellActivationMatrix:new Ii(O,d,.08),cellActivationHidden:new Ii(O,O,.08),cellActivationBias:new Wn(O,1)}}function _u(O,d,g,y){if(!y.inputMatrix||!y.inputHidden||!y.inputBias||!y.forgetMatrix||!y.forgetHidden||!y.forgetBias||!y.outputMatrix||!y.outputHidden||!y.outputBias||!y.cellActivationMatrix||!y.cellActivationHidden||!y.cellActivationBias)throw new Error("hiddenLayer does not have expected properties");const N=O.sigmoid.bind(O),D=O.add.bind(O),F=O.multiply.bind(O),z=O.multiplyElement.bind(O),P=O.tanh.bind(O),k=N(D(D(F(y.inputMatrix,d),F(y.inputHidden,g)),y.inputBias)),R=N(D(D(F(y.forgetMatrix,d),F(y.forgetHidden,g)),y.forgetBias)),S=N(D(D(F(y.outputMatrix,d),F(y.outputHidden,g)),y.outputBias)),T=P(D(D(F(y.cellActivationMatrix,d),F(y.cellActivationHidden,g)),y.cellActivationBias)),G=z(R,g),te=z(k,T),Te=D(G,te);return z(S,P(Te))}class _c extends Wl{getHiddenLayer(d,g){return vc(d,g)}getEquation(d,g,y,N){return _u(d,g,y,N)}}function Eo(O,d){const g=[];for(;O<d;O++)g.push(O);return g}function Uu(O){return Array.isArray(O)?Float32Array.from(O):Float32Array.from(Object.values(O))}function bu({pixelX:O,pixelY:d,radius:g,inputs:y,row:N,line:D,fontSize:F,fontClassName:z}){let P=`<rect
              x="${O/2-g}"
              y="${d/2+N*d-g}"
              width="${2*g}"
              height="${2*g}"
              stroke="black"
              stroke-width="1"
              fill="${y.color}"
              class="${y.className}" />
            <line
              x1="${O/4}"
              y1="${d/2+N*d}"
              x2="${O/2-g}"
              y2="${d/2+N*d}"
              style="stroke:${D.color};stroke-width:${D.width}"
              class="${D.className}" />`;return y.labels&&(P+=`<text
              x="${O/8}"
              y="${d/2+N*d-5}"
              fill="black"
              font-size="${F}"
              class="${z}">${y.labels[N]}</text>`),P}function sh({pixelX:O,pixelY:d,row:g,column:y,radius:N,hidden:D}){return`<circle
            cx="${O/2+y*O}"
            cy="${d/2+g*d}"
            r="${N}"
            stroke="black"
            stroke-width="1"
            fill="${D.color}"
            class="${D.className}" />`}function bc({pixelX:O,pixelY:d,row:g,column:y,line:N,outputs:D,radius:F}){return`<circle
            cx="${O/2+y*O}"
            cy="${d/2+g*d}"
            r="${F}"
            stroke="black"
            stroke-width="1"
            fill="${D.color}"
            class="${D.className}" />
          <line
            x1="${O/2+y*O+F}"
            y1="${d/2+g*d}"
            x2="${O/2+y*O+O/4}"
            y2="${d/2+g*d}"
            style="stroke:${N.color};stroke-width:${N.width}"
            class="${N.className}" />`}function Io({pixelX:O,pixelY:d,row:g,column:y,radius:N,lineY:D,line:F,previousConnectionIndex:z}){return`<line
            x1="${O/2+(y-1)*O+N}"
            y1="${D/2+z*D}"
            x2="${O/2+y*O-N}"
            y2="${d/2+g*d}"
            style="stroke:${F.color};stroke-width:${F.width}"
            class="${F.className}" />`}function Ja(O){const{sizes:d,height:g,width:y}=O;let N="";const D=y/d.length;for(let F=0;F<d.length;F++){const z=d[F],P=g/z;for(let k=0;k<z;k++)if(F===0)N+=bu({pixelX:D,pixelY:P,row:k,...O});else{F===d.length-1?N+=bc({pixelX:D,pixelY:P,row:k,column:F,...O}):N+=sh({pixelX:D,pixelY:P,row:k,column:F,...O});const R=d[F-1],S=g/R;for(let T=0;T<R;T++)N+=Io({pixelX:D,pixelY:P,row:k,column:F,lineY:S,previousConnectionIndex:T,...O})}}return N}function ql({pixelX:O,pixelY:d,row:g,column:y,radius:N,recurrentLine:D}){const F=O/2+y*O+N+1,z=d/2+g*d,P=F-N*2-2,k=z,R=P+100,S=k+50,T=F-100,G=z+50;return`<path
              d="M ${F} ${z} C ${R} ${S}, ${T} ${G}, ${P} ${k}"
              stroke="${D.color}"
              stroke-width="${D.width}"
              fill="transparent"
              stroke-linecap="round"
              marker-end="url(#arrow)"
              class="${D.className}" />`}function po(O){const{width:d,height:g,recurrentLine:y,sizes:N,radius:D}=O,F=d/N.length;let z=`<defs>
              <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L0,6 L9,3 z" fill="${y.color}" />
              </marker>
            </defs>`;z+=Ja(O);for(let P=1;P<N.length;P++){const k=N[P],R=g/k;for(let S=0;S<k;S++)z+=ql({pixelX:F,pixelY:R,row:S,column:P,radius:D,recurrentLine:y})}return z}function ko(O){const{options:d}=O;if(!d)throw new Error("options not defined");if(!d.inputLayer)throw new Error("options.inputLater not defined");if(!d.hiddenLayers)throw new Error("options.hiddenLayers not defined");if(d.hiddenLayers.length<1)throw new Error("options.hiddenLayers is empty");if(!d.outputLayer)throw new Error("options.outputLayer not defined");const g=d.inputLayer(),y=[];y.push(d.hiddenLayers[0](g,0));for(let D=1;D<d.hiddenLayers.length;D++)y.push(d.hiddenLayers[D](y[D-1],D));const N=d.outputLayer(y[y.length-1],y.length);return{inputSize:g.height,hiddenLayers:y.map(D=>D.height),outputSize:N.height}}function go(O){const d=[],{options:g}=O;if(!g.inputLayer)throw new Error("inputLayer not defined");if(!g.outputLayer)throw new Error("outputLayer not defined");const y=g.inputLayer();d.push(g.hiddenLayers[0](y,rr(),0));for(let D=1;D<g.hiddenLayers.length;D++)d.push(g.hiddenLayers[D](d[D-1],rr(),D));const N=g.outputLayer(d[d.length-1],-1);return{inputSize:y.height,hiddenLayers:d.map(D=>D.height),outputSize:N.height}}function xc(O,d,g){return`<svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            version="1.1"
            width="${d}"
            height="${g}">${O}</svg>`}function vd(O){return O.sizes}function ah(O){const{options:d,sizes:g}=O,{inputSize:y,outputSize:N,hiddenLayers:D}=d;if(!g){if(typeof y=="number"&&y<1)throw new Error("inputSize not set");if(typeof N=="number"&&N<1)throw new Error("outputSize not set");if(D?.some(F=>F<1))throw new Error("hiddenLayers not set")}return typeof y=="number"&&Array.isArray(D)&&typeof N=="number"?[y].concat(D).concat([N]):g}function _d(O){const{options:d}=O,{inputSize:g,outputSize:y,hiddenLayers:N}=d;return[g].concat(N).concat([y])}function da(){return{line:{width:.5,color:"black",className:"connection"},recurrentLine:{width:1,color:"red",className:"recurrence"},inputs:{color:"rgba(0, 128, 0, 0.5)",labels:null,className:"input"},outputs:{color:"rgba(100, 149, 237, 0.5)",className:"output"},hidden:{color:"rgba(255, 127, 80, 0.5)",className:"hidden-neuron"},fontSize:"14px",fontClassName:"label",radius:8,width:400,height:250,sizes:[]}}function Fr(O,d){const g={...da(),...d},{width:y,height:N,inputs:D}=g;let F=[];if(O instanceof Ft||O instanceof vn)F=ah(O);else if(O instanceof Xa){const{inputSize:z,hiddenLayers:P,outputSize:k}=go(O);F=[z].concat(P).concat([k])}else if(O instanceof uo){const{inputSize:z,hiddenLayers:P,outputSize:k}=ko(O);F=[z].concat(P).concat([k])}else{if(O instanceof El||O instanceof zu||O instanceof Ys||O instanceof Wl||O instanceof _c||O instanceof Il)return xc(po({...g,sizes:bi(_d(O),D.labels)}),y,N);if(O.hasOwnProperty("type"))switch(O.type){case"NeuralNetwork":case"NeuralNetworkGPU":return xc(Ja({...g,sizes:bi(vd(O),D.labels)}),y,N);case"RNN":case"GRU":case"LSTM":case"RNNTimeStep":case"GRUTimeStep":case"LSTMTimeStep":return xc(po({...g,sizes:bi(_d(O),D.labels)}),y,N);default:throw new Error("unrecognized network")}else if(O.hasOwnProperty("inputSize")&&O.hasOwnProperty("hiddenLayers")&&O.hasOwnProperty("outputSize")){const{inputSize:z,hiddenLayers:P,outputSize:k}=O;F=[z,...P,k]}else if(O.hasOwnProperty("sizes"))F=O.sizes;else throw new Error("unrecognized network")}return xc(Ja({...g,sizes:bi(F,D.labels)}),y,N)}function bi(O,d){if(!O)throw new Error("sizes not set");if(O.some(g=>g<1))throw new Error("sizes not set correctly");if(d&&d.length!==O[0])throw new Error("not enough labels for inputs");return O}const Pa={RNNTimeStep:Wl,LSTMTimeStep:_c,GRUTimeStep:Il,RNN:El,LSTM:zu,GRU:Ys},rs={max:je,mse:Je,ones:Wa,ones2D:fs,random:Ee,randomWeight:qe,randos:Le,range:Eo,toArray:Uu,DataFormatter:is,zeros:Ye,toSVG:Fr};t.AE=qn,t.CrossValidate=un,t.FeedForward=uo,t.NeuralNetwork=Ft,t.NeuralNetworkGPU=vn,t.Recurrent=Xa,t.activation=$,t.layer=Rs,t.layerTypes=Cs,t.likely=ll,t.lookup=me,t.praxis=va,t.recurrent=Pa,t.utilities=rs,Object.defineProperty(t,"__esModule",{value:!0})}))})(Ug,Ug.exports)),Ug.exports}var MH=OH();const Ku=tC(MH);class FH{constructor(){this.networks={workoutTiming:new Ku.recurrent.LSTM,mealTiming:new Ku.recurrent.LSTM,sleepSchedule:new Ku.recurrent.LSTM,energyLevels:new Ku.NeuralNetwork,moodPatterns:new Ku.NeuralNetwork,productivityScore:new Ku.NeuralNetwork,stressLevels:new Ku.NeuralNetwork,hydration:new Ku.NeuralNetwork,motivation:new Ku.NeuralNetwork,habitSuccess:new Ku.NeuralNetwork},this.trainingData={workouts:[],meals:[],sleep:[],energy:[],mood:[],productivity:[],stress:[],hydration:[],steps:[],heartRate:[],location:[],screenTime:[],socialInteraction:[]},this.insights={bestWorkoutTime:null,bestMealTimes:[],optimalSleepSchedule:null,energyPeakTimes:[],stressTriggers:[],motivationNeededTimes:[],productivePeriods:[],hydrationReminders:[]},this.modelsTrainedCount=0,this.lastTrainingDate=null,this.accuracyScores={},this.userBaseline={energyBaseline:null,sleepSensitivity:1.5,workoutBoost:2,avgDailySteps:null,avgSleep:7,energyByHour:{},energyByDayOfWeek:{}},this.autoEnergyInterval=null,this.init()}async init(){await this.loadTrainingData(),await this.loadModels(),await this.loadUserBaseline(),this.startContinuousLearning(),this.startAutoEnergyTracking()}async trackWorkout(e){const t={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),duration:e.duration||0,type:e.type||"general",intensity:e.intensity||"moderate",completed:e.completed!==!1,energyBefore:e.energyBefore||5,energyAfter:e.energyAfter||7,mood:e.mood||"neutral",location:e.location||"gym"};this.trainingData.workouts.push(t),await this.saveTrainingData(),this.trainingData.workouts.length%5===0&&await this.trainWorkoutTimingModel()}async trackMeal(e){const t={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),mealType:e.type||"meal",calories:e.calories||0,protein:e.protein||0,carbs:e.carbs||0,fats:e.fats||0,healthy:e.healthy!==!1,energyAfter:e.energyAfter||5,satisfaction:e.satisfaction||5,digestiveComfort:e.digestiveComfort||5};this.trainingData.meals.push(t),await this.saveTrainingData(),this.trainingData.meals.length%5===0&&await this.trainMealTimingModel()}async trackSleep(e){const t={timestamp:Date.now(),bedtime:e.bedtime||new Date().getHours(),wakeTime:e.wakeTime||new Date().getHours(),duration:e.duration||8,quality:e.quality||5,energyNextDay:e.energyNextDay||5,mood:e.mood||"neutral",dreams:e.dreams||!1,interruptions:e.interruptions||0};this.trainingData.sleep.push(t),await this.saveTrainingData(),this.trainingData.sleep.length%3===0&&await this.trainSleepModel()}async trackEnergy(e,t={}){const n={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),energyLevel:e,recentWorkout:t.recentWorkout||!1,recentMeal:t.recentMeal||!1,hoursSlept:t.hoursSlept||7,hydrationLevel:t.hydrationLevel||5,stressLevel:t.stressLevel||3,caffeineConsumed:t.caffeineConsumed||!1};this.trainingData.energy.push(n),await this.saveTrainingData(),this.trainingData.energy.length%10===0&&await this.trainEnergyPredictionModel()}async trackMood(e,t=[]){const n={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),mood:e,moodScore:this.moodToScore(e),triggers:t,recentExercise:t.includes("workout"),social:t.includes("social"),workStress:t.includes("work")};this.trainingData.mood.push(n),await this.saveTrainingData(),this.trainingData.mood.length%10===0&&await this.trainMoodPredictionModel()}async trackStress(e,t=null){const n={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),stressLevel:e,cause:t,hoursSlept:7,exerciseToday:!1,meditationDone:!1};this.trainingData.stress.push(n),await this.saveTrainingData(),this.trainingData.stress.length%5===0&&await this.trainStressModel()}async trackHydration(e,t={}){const n={timestamp:Date.now(),hour:new Date().getHours(),waterAmount:e,exercised:t.exercised||!1,temperature:t.temperature||20,thirstLevel:t.thirstLevel||3};this.trainingData.hydration.push(n),await this.saveTrainingData()}async trackSteps(e,t={}){const n={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),steps:e,activeMinutes:t.activeMinutes||0,energyLevel:t.energyLevel||5};this.trainingData.steps.push(n),await this.saveTrainingData()}async trackLocation(e){const t={timestamp:Date.now(),hour:new Date().getHours(),dayOfWeek:new Date().getDay(),latitude:e.latitude,longitude:e.longitude,locationType:e.type||"unknown",duration:e.duration||0};this.trainingData.location.push(t),await this.saveTrainingData()}startAutoEnergyTracking(){this.trackEnergyAutomatically().catch(e=>{}),this.autoEnergyInterval=setInterval(async()=>{try{await this.trackEnergyAutomatically()}catch{}},3600*1e3)}async trackEnergyAutomatically(){try{const e=await this.calculateAutoEnergy();await this.trackEnergy(e.level,{recentWorkout:e.context.recentWorkout,recentMeal:e.context.recentMeal,hoursSlept:e.context.hoursSlept,hydrationLevel:e.context.hydrationLevel,stressLevel:3,caffeineConsumed:!1})}catch{}}async calculateAutoEnergy(){const e=this.userBaseline.energyBaseline||6,t=await this.getCurrentContext(),n=this.calculateSleepImpact(t),r=this.calculateActivityImpact(t),s=this.calculateWorkoutImpact(t),l=this.calculateMealImpact(t),u=this.calculateHydrationImpact(t),h=this.calculateTimeOfDayImpact(),f=this.calculateDayOfWeekImpact();let x=e+n+r+s+l+u+h+f;return x=Math.max(1,Math.min(10,x)),this.trainingData.energy.length>50&&!this.userBaseline.energyBaseline&&(this.userBaseline.energyBaseline=this.calculateAverageEnergy(),await this.saveUserBaseline()),{level:Math.round(x),confidence:this.calculateEnergyConfidence(),context:t}}async getCurrentContext(){const e=this.trainingData.sleep[this.trainingData.sleep.length-1],t=e?e.duration:7,n=Date.now()-14400*1e3,r=this.trainingData.workouts.some(x=>x.timestamp>n),s=Date.now()-10800*1e3,l=this.trainingData.meals.some(x=>x.timestamp>s),u=this.trainingData.hydration.filter(x=>x.timestamp>s),h=Math.min(10,u.length*2),f=this.trainingData.steps.filter(x=>{const p=new Date().toISOString().split("T")[0];return new Date(x.timestamp).toISOString().split("T")[0]===p}).reduce((x,p)=>x+p.steps,0);return{hoursSlept:t,recentWorkout:r,recentMeal:l,hydrationLevel:h,todaySteps:f}}calculateSleepImpact(e){return e.hoursSlept?(e.hoursSlept-this.userBaseline.avgSleep)*this.userBaseline.sleepSensitivity:0}calculateActivityImpact(e){if(!this.userBaseline.avgDailySteps||!e.todaySteps)return 0;const t=(e.todaySteps-this.userBaseline.avgDailySteps)/this.userBaseline.avgDailySteps;return Math.min(2,Math.max(-2,t*2))}calculateWorkoutImpact(e){if(!e.recentWorkout){const r=Date.now()-2592e5;return this.trainingData.workouts.some(l=>l.timestamp>r)?0:-1}const t=[...this.trainingData.workouts].sort((r,s)=>s.timestamp-r.timestamp)[0];if(!t)return 0;const n=(Date.now()-t.timestamp)/(3600*1e3);return n<2?this.userBaseline.workoutBoost:n<4?this.userBaseline.workoutBoost/2:0}calculateMealImpact(e){if(!e.recentMeal){const r=Date.now()-144e5;return this.trainingData.meals.some(l=>l.timestamp>r)?0:-1}const t=[...this.trainingData.meals].sort((r,s)=>s.timestamp-r.timestamp)[0];if(!t)return 0;const n=(Date.now()-t.timestamp)/(3600*1e3);return n<.5?.5:n<2?1:0}calculateHydrationImpact(e){const t=e.hydrationLevel||5;return t<3?-.5:t>7?.5:0}calculateTimeOfDayImpact(){const e=new Date().getHours();return this.userBaseline.energyByHour[e]?this.userBaseline.energyByHour[e]:e>=7&&e<=9?1:e>=14&&e<=15?-1:e>=22?-2:0}calculateDayOfWeekImpact(){const e=new Date().getDay();return this.userBaseline.energyByDayOfWeek[e]?this.userBaseline.energyByDayOfWeek[e]:e===0||e===6?.5:e===1?-.5:0}calculateEnergyConfidence(){const e=this.trainingData.energy.length;return e<10?30:e<50?60:e<100?80:95}async trainWorkoutTimingModel(){if(!(this.trainingData.workouts.length<10))try{const e=this.trainingData.workouts.map(r=>({input:[r.hour/24,r.dayOfWeek/7,r.energyBefore/10,r.completed?1:0],output:[r.completed?1:0,r.energyAfter/10]}));this.networks.workoutTiming.train(e,{iterations:2e3,errorThresh:.005,log:!1});const t=[];for(let r=6;r<=22;r++){const s=this.networks.workoutTiming.run([r/24,new Date().getDay()/7,.7,1]);t.push({hour:r,success:s[0],energyAfter:s[1]})}const n=t.sort((r,s)=>s.success+s.energyAfter-(r.success+r.energyAfter))[0];this.insights.bestWorkoutTime=n.hour,this.modelsTrainedCount++,console.log(` Workout timing model trained! Best time: ${n.hour}:00`)}catch(e){console.error("Workout timing training error:",e)}}async trainMealTimingModel(){if(!(this.trainingData.meals.length<15))try{const e=this.trainingData.meals.map(n=>({input:[n.hour/24,n.dayOfWeek/7,n.calories/1e3,n.protein/50,n.healthy?1:0],output:[n.energyAfter/10,n.satisfaction/10,n.digestiveComfort/10]}));this.networks.mealTiming.train(e,{iterations:2e3,errorThresh:.005,log:!1});const t=[7,12,18];this.insights.bestMealTimes=t.map(n=>({hour:n,type:n===7?"breakfast":n===12?"lunch":"dinner"})),this.modelsTrainedCount++,console.log(" Meal timing model trained!")}catch(e){console.error("Meal timing training error:",e)}}async trainSleepModel(){if(!(this.trainingData.sleep.length<7))try{const e=this.trainingData.sleep.map(r=>({input:[r.bedtime/24,r.duration/12,r.interruptions/5],output:[r.quality/10,r.energyNextDay/10]}));this.networks.sleepSchedule.train(e,{iterations:2e3,errorThresh:.005,log:!1});const t=[];for(let r=21;r<=24;r++){const s=this.networks.sleepSchedule.run([r/24,.6666666666666666,0]);t.push({bedtime:r,quality:s[0],energy:s[1]})}const n=t.sort((r,s)=>s.quality+s.energy-(r.quality+r.energy))[0];this.insights.optimalSleepSchedule={bedtime:n.bedtime,wakeTime:(n.bedtime+8)%24,duration:8},this.modelsTrainedCount++,console.log(` Sleep model trained! Optimal bedtime: ${n.bedtime}:00`)}catch(e){console.error("Sleep training error:",e)}}async trainEnergyPredictionModel(){if(!(this.trainingData.energy.length<20))try{const e=this.trainingData.energy.map(n=>({input:[n.hour/24,n.dayOfWeek/7,n.hoursSlept/12,n.recentWorkout?1:0,n.recentMeal?1:0,n.hydrationLevel/10,n.stressLevel/10,n.caffeineConsumed?1:0],output:[n.energyLevel/10]}));this.networks.energyLevels.train(e,{iterations:2e3,errorThresh:.005,log:!1});const t=[];for(let n=6;n<=22;n++){const r=this.networks.energyLevels.run([n/24,new Date().getDay()/7,.6666666666666666,!1,n===12||n===18,.7,.3,n<12]);t.push({hour:n,energy:r[0]*10})}this.insights.energyPeakTimes=t.sort((n,r)=>r.energy-n.energy).slice(0,3).map(n=>n.hour),this.modelsTrainedCount++,console.log(" Energy prediction model trained!")}catch(e){console.error("Energy training error:",e)}}async trainMoodPredictionModel(){if(!(this.trainingData.mood.length<20))try{const e=this.trainingData.mood.map(t=>({input:[t.hour/24,t.dayOfWeek/7,t.recentExercise?1:0,t.social?1:0,t.workStress?1:0],output:[t.moodScore/10]}));this.networks.moodPatterns.train(e,{iterations:2e3,errorThresh:.005,log:!1}),this.modelsTrainedCount++,console.log(" Mood prediction model trained!")}catch(e){console.error("Mood training error:",e)}}async trainStressModel(){if(!(this.trainingData.stress.length<10))try{const e=this.trainingData.stress.map(t=>({input:[t.hour/24,t.dayOfWeek/7,t.hoursSlept/12,t.exerciseToday?1:0,t.meditationDone?1:0],output:[t.stressLevel/10]}));this.networks.stressLevels.train(e,{iterations:2e3,errorThresh:.005,log:!1}),this.modelsTrainedCount++,console.log(" Stress prediction model trained!")}catch(e){console.error("Stress training error:",e)}}predictBestWorkoutTime(){return this.insights.bestWorkoutTime?{hour:this.insights.bestWorkoutTime,confidence:this.calculateConfidence("workoutTiming"),reasoning:`Based on ${this.trainingData.workouts.length} workout sessions, you perform best around ${this.insights.bestWorkoutTime}:00`}:{hour:18,confidence:.5,reasoning:"Need more data to personalize"}}predictOptimalMealTime(e){const t={breakfast:7,lunch:12,dinner:18},n=this.insights.bestMealTimes.find(r=>r.type===e)?.hour||t[e];return{hour:n,confidence:this.calculateConfidence("mealTiming"),reasoning:`Your body responds best to ${e} around ${n}:00`}}predictEnergyLevel(e=new Date().getHours()){if(this.trainingData.energy.length<20)return{level:5,confidence:.3};try{const t=this.networks.energyLevels.run([e/24,new Date().getDay()/7,.5833333333333334,!1,e===12||e===18,.7,.3,e<12]);return{level:Math.round(t[0]*10),confidence:this.calculateConfidence("energyLevels"),peakTimes:this.insights.energyPeakTimes}}catch{return{level:5,confidence:.3}}}predictMood(e={}){if(this.trainingData.mood.length<20)return{mood:"neutral",score:5,confidence:.3};try{const t=this.networks.moodPatterns.run([new Date().getHours()/24,new Date().getDay()/7,e.recentExercise?1:0,e.social?1:0,e.workStress?1:0]),n=Math.round(t[0]*10);return{mood:this.scoreToMood(n),score:n,confidence:this.calculateConfidence("moodPatterns")}}catch{return{mood:"neutral",score:5,confidence:.3}}}predictStressLevel(e={}){if(this.trainingData.stress.length<10)return{level:3,confidence:.3};try{const t=this.networks.stressLevels.run([new Date().getHours()/24,new Date().getDay()/7,e.hoursSlept/12||.5833333333333334,e.exerciseToday?1:0,e.meditationDone?1:0]);return{level:Math.round(t[0]*10),confidence:this.calculateConfidence("stressLevels")}}catch{return{level:3,confidence:.3}}}predictHabitSuccess(e,t){const n=this.trainingData.workouts.filter(s=>{const l=new Date(s.timestamp).getHours();return Math.abs(l-t)<=1});return n.length===0?{success:.5,confidence:.2}:{success:n.filter(s=>s.completed).length/n.length,confidence:Math.min(n.length/20,1)}}getPersonalizedRecommendations(){const e=[],t=new Date().getHours(),n=this.predictBestWorkoutTime();Math.abs(t-n.hour)<=1&&e.push({type:"workout",priority:"high",title:" Perfect Time for Workout!",message:`This is your optimal workout time. ${n.reasoning}`,confidence:n.confidence});const r=this.predictEnergyLevel();r.level<4&&e.push({type:"energy",priority:"high",title:" Energy Boost Needed",message:"Consider a quick walk, healthy snack, or power nap",confidence:r.confidence});const s=this.trainingData.hydration[this.trainingData.hydration.length-1];(!s||Date.now()-s.timestamp>7200*1e3)&&e.push({type:"hydration",priority:"medium",title:" Time to Hydrate",message:"You haven't logged water in 2+ hours",confidence:.9});const l=["breakfast","lunch","dinner"],u=[7,12,18];l.forEach((f,x)=>{if(Math.abs(t-u[x])<=1){const p=this.trainingData.meals[this.trainingData.meals.length-1];(!p||Date.now()-p.timestamp>14400*1e3)&&e.push({type:"meal",priority:"medium",title:` ${f.charAt(0).toUpperCase()+f.slice(1)} Time`,message:`Time for ${f} based on your routine`,confidence:.8})}}),this.insights.optimalSleepSchedule&&t>=this.insights.optimalSleepSchedule.bedtime-1&&e.push({type:"sleep",priority:"high",title:" Optimal Bedtime Approaching",message:`Best sleep starts at ${this.insights.optimalSleepSchedule.bedtime}:00`,confidence:.9});const h=this.predictStressLevel();return h.level>6&&e.push({type:"stress",priority:"high",title:" Stress Management Recommended",message:"Try meditation, deep breathing, or light exercise",confidence:h.confidence}),e.sort((f,x)=>{const p={high:3,medium:2,low:1};return p[x.priority]-p[f.priority]})}getLifeOptimizationReport(){return{workoutOptimization:{bestTime:this.insights.bestWorkoutTime||18,consistency:this.calculateWorkoutConsistency(),improvement:this.calculateImprovementRate("workouts")},nutritionOptimization:{bestMealTimes:this.insights.bestMealTimes,healthyChoiceRate:this.calculateHealthyMealRate(),improvement:this.calculateImprovementRate("meals")},sleepOptimization:{optimalSchedule:this.insights.optimalSleepSchedule,averageQuality:this.calculateAverageSleepQuality(),consistency:this.calculateSleepConsistency()},energyOptimization:{peakTimes:this.insights.energyPeakTimes,averageLevel:this.calculateAverageEnergy(),trend:this.calculateEnergyTrend()},overallScore:this.calculateOverallLifeScore(),modelsTrainedCount:this.modelsTrainedCount,dataPoints:this.getTotalDataPoints(),accuracy:this.calculateOverallAccuracy()}}moodToScore(e){return{happy:9,excited:10,content:8,calm:7,neutral:5,tired:4,anxious:3,sad:2,stressed:1}[e]||5}scoreToMood(e){return e>=9?"happy":e>=7?"content":e>=5?"neutral":e>=3?"tired":"stressed"}calculateConfidence(e){const n={workoutTiming:this.trainingData.workouts.length,mealTiming:this.trainingData.meals.length,sleepSchedule:this.trainingData.sleep.length,energyLevels:this.trainingData.energy.length,moodPatterns:this.trainingData.mood.length,stressLevels:this.trainingData.stress.length}[e]||0;return n<10?.3:n<30?.6:n<100?.8:.95}calculateWorkoutConsistency(){return this.trainingData.workouts.length<7?0:this.trainingData.workouts.filter(t=>Date.now()-t.timestamp<10080*60*1e3).length/7*100}calculateHealthyMealRate(){return this.trainingData.meals.length===0?0:this.trainingData.meals.filter(t=>t.healthy).length/this.trainingData.meals.length*100}calculateAverageSleepQuality(){return this.trainingData.sleep.length===0?0:this.trainingData.sleep.reduce((t,n)=>t+n.quality,0)/this.trainingData.sleep.length}calculateSleepConsistency(){if(this.trainingData.sleep.length<7)return 0;const e=this.trainingData.sleep.map(n=>n.bedtime),t=this.calculateVariance(e);return Math.max(0,100-t*10)}calculateAverageEnergy(){return this.trainingData.energy.length===0?5:this.trainingData.energy.reduce((t,n)=>t+n.energyLevel,0)/this.trainingData.energy.length}calculateEnergyTrend(){if(this.trainingData.energy.length<14)return"stable";const e=this.trainingData.energy.slice(0,7),t=this.trainingData.energy.slice(-7),n=e.reduce((s,l)=>s+l.energyLevel,0)/7,r=t.reduce((s,l)=>s+l.energyLevel,0)/7;return r>n+1?"improving":r<n-1?"declining":"stable"}calculateOverallLifeScore(){const e=Math.min(this.calculateWorkoutConsistency(),100),t=this.calculateHealthyMealRate(),n=this.calculateAverageSleepQuality()*10,r=this.calculateAverageEnergy()*10;return Math.round((e+t+n+r)/4)}getTotalDataPoints(){return Object.values(this.trainingData).reduce((e,t)=>e+t.length,0)}calculateOverallAccuracy(){return Math.min(this.modelsTrainedCount/10,1)*100}calculateImprovementRate(e){const t=this.trainingData[e];if(t.length<14)return 0;const n=t.slice(0,7);return(t.slice(-7).length-n.length)/n.length*100}calculateVariance(e){const t=e.reduce((r,s)=>r+s,0)/e.length,n=e.map(r=>Math.pow(r-t,2));return Math.sqrt(n.reduce((r,s)=>r+s,0)/e.length)}async saveTrainingData(){try{await yn.set({key:"brainjs_training_data",value:JSON.stringify(this.trainingData)}),await yn.set({key:"brainjs_insights",value:JSON.stringify(this.insights)})}catch(e){console.error("Error saving training data:",e)}}async saveUserBaseline(){try{await yn.set({key:"brainjs_user_baseline",value:JSON.stringify(this.userBaseline)}),console.log(" User baseline saved:",this.userBaseline)}catch(e){console.error("Error saving user baseline:",e)}}async loadUserBaseline(){try{const{value:e}=await yn.get({key:"brainjs_user_baseline"});e&&(this.userBaseline={...this.userBaseline,...JSON.parse(e)},console.log(" User baseline loaded:",this.userBaseline))}catch(e){console.error("Error loading user baseline:",e)}}async loadTrainingData(){try{const{value:e}=await yn.get({key:"brainjs_training_data"});e&&(this.trainingData=JSON.parse(e));const{value:t}=await yn.get({key:"brainjs_insights"});t&&(this.insights=JSON.parse(t)),console.log(` Loaded ${this.getTotalDataPoints()} data points`)}catch(e){console.error("Error loading training data:",e)}}async saveModels(){try{const e={};for(const[t,n]of Object.entries(this.networks))try{e[t]=n.toJSON()}catch{}await yn.set({key:"brainjs_models",value:JSON.stringify(e)}),console.log(" Models saved")}catch(e){console.error("Error saving models:",e)}}async loadModels(){try{const{value:e}=await yn.get({key:"brainjs_models"});if(e){const t=JSON.parse(e);for(const[n,r]of Object.entries(t))r&&this.networks[n]&&(this.networks[n].fromJSON(r),this.modelsTrainedCount++);console.log(` Loaded ${this.modelsTrainedCount} trained models`)}}catch(e){console.error("Error loading models:",e)}}startContinuousLearning(){setInterval(async()=>{console.log(" Starting daily model retraining..."),await this.trainWorkoutTimingModel(),await this.trainMealTimingModel(),await this.trainSleepModel(),await this.trainEnergyPredictionModel(),await this.trainMoodPredictionModel(),await this.trainStressModel(),await this.saveModels(),this.lastTrainingDate=Date.now(),console.log(" Daily retraining complete!")},1440*60*1e3)}}const iS=new FH;class jH{constructor(){this.currentUser=null,this.authListeners=[],this.useFirebase=!1}async initialize(){try{if(this.useFirebase=Fi.initialize(),this.useFirebase){const t=Fi.getCurrentUser();if(t){const n=await Fi.getUserProfile(t.uid);if(n){this.currentUser=n,localStorage.setItem("wellnessai_user",JSON.stringify(this.currentUser)),await Jh.onUserLogin(t.uid),this.notifyAuthStateChanged();return}}}const{value:e}=await yn.get({key:"wellnessai_user"});if(e)try{if(this.currentUser=JSON.parse(e),this.currentUser&&(!this.currentUser.profile||!this.currentUser.profile.profileCompleted)){console.log(" Profile empty locally, checking Firestore cloud...");try{const t=await mi.get("user_profile",this.currentUser.uid);t&&t.profileCompleted&&(console.log(" Profile found in cloud! Restoring..."),this.currentUser.profile=t,await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)}),console.log(" Profile restored from Firestore successfully"))}catch(t){console.warn(" Could not restore profile from cloud:",t)}}this.notifyAuthStateChanged()}catch{await yn.remove({key:"wellnessai_user"})}}catch{}}async signUp(e,t,n){try{if(!e||!t||!n)throw new Error("All fields are required");if(t.length<8)throw new Error("Password must be at least 8 characters");if(!this.isValidEmail(e))throw new Error("Invalid email format");if(!this.isStrongPassword(t))throw new Error("Password must contain uppercase, lowercase, number, and special character");const r=await this.getAllUsers();if(r.find(u=>u.email===e))throw new Error("Email already registered");const s=await qf.getId(),l={id:this.generateUserId(),email:e.toLowerCase().trim(),name:n.trim(),password:await this.hashPasswordSecure(t),createdAt:new Date().toISOString(),deviceId:s.identifier,profile:{avatar:this.getDefaultAvatar(),photo:null,age:null,gender:null,height:null,weight:null,goalSteps:1e4,notifications:!0,allergens:[],intolerances:[],dietaryPreferences:[],customRestrictions:[],allergenSeverity:{},foodLog:[],symptomLog:[],safetyPreferences:{},hiddenAllergenKnowledge:[]},stats:{totalSteps:0,totalDays:0,longestStreak:0,currentStreak:0},subscription:{plan:"free",active:!1,startDate:null,endDate:null,stripeCustomerId:null,stripeSubscriptionId:null}};if(r.push(l),await yn.set({key:"wellnessai_users",value:JSON.stringify(r)}),this.currentUser={...l},delete this.currentUser.password,await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)}),this.useFirebase)try{const u=await Fi.signUp(e,t,n);u.success&&await Jh.onUserLogin(u.user.uid)}catch{}return this.notifyAuthStateChanged(),{success:!0,user:this.currentUser}}catch(r){return{success:!1,error:r.message}}}async signIn(e,t){try{if(!e||!t)throw new Error("Email and password are required");if(this.useFirebase)try{const l=await Fi.signIn(e,t);if(l.success){const u=await Fi.getUserProfile(l.user.uid);if(u)return this.currentUser=u,await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)}),await Jh.onUserLogin(l.user.uid),this.notifyAuthStateChanged(),{success:!0,user:this.currentUser}}}catch{}const r=(await this.getAllUsers()).find(l=>l.email===e.toLowerCase().trim());if(!r)throw new Error("No account found with this email");const s=this.hashPassword(t);if(r.password!==s)throw new Error("Incorrect password");return this.currentUser={...r},delete this.currentUser.password,await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)}),this.notifyAuthStateChanged(),{success:!0,user:this.currentUser}}catch(n){return{success:!1,error:n.message}}}async signOut(){return this.currentUser=null,localStorage.removeItem("wellnessai_user"),await yn.remove({key:"wellnessai_user"}),this.notifyAuthStateChanged(),{success:!0}}getCurrentUser(){return this.currentUser}isLoggedIn(){return this.currentUser!==null}async updateProfile(e){if(!this.currentUser)throw new Error("No user logged in");try{const t=await this.getAllUsers();if(!this.currentUser.id){const r="user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),s={id:r,email:this.currentUser.email,displayName:this.currentUser.displayName||this.currentUser.email,emailVerified:this.currentUser.emailVerified||!1,createdAt:new Date().toISOString(),profile:e};t.push(s),await yn.set({key:"wellnessai_users",value:JSON.stringify(t)}),this.currentUser.id=r,this.currentUser.profile=e,await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)});return}const n=t.findIndex(r=>r.id===this.currentUser.id);if(n===-1){const r={id:this.currentUser.id,email:this.currentUser.email,displayName:this.currentUser.displayName||this.currentUser.email,emailVerified:this.currentUser.emailVerified||!1,createdAt:new Date().toISOString(),profile:e};t.push(r),localStorage.setItem("wellnessai_users",JSON.stringify(t)),await yn.set({key:"wellnessai_users",value:JSON.stringify(t)}),this.currentUser.profile=e,localStorage.setItem("wellnessai_user",JSON.stringify(this.currentUser)),await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)});return}if(t[n]={...t[n],profile:{...t[n].profile,...e}},localStorage.setItem("wellnessai_users",JSON.stringify(t)),await yn.set({key:"wellnessai_users",value:JSON.stringify(t)}),this.currentUser={...t[n]},delete this.currentUser.password,await yn.set({key:"wellnessai_user",value:JSON.stringify(this.currentUser)}),this.useFirebase)try{await mi.save("user_profile",this.currentUser.profile,this.currentUser.uid)}catch{}return this.notifyAuthStateChanged(),{success:!0,user:this.currentUser}}catch(t){return{success:!1,error:t.message}}}async resetPassword(e){return(await this.getAllUsers()).find(r=>r.email===e.toLowerCase().trim())?{success:!0,message:"Password reset instructions sent to your email"}:{success:!0,message:"If this email is registered, you will receive reset instructions"}}onAuthStateChanged(e){return this.authListeners.push(e),e(this.currentUser),()=>{this.authListeners=this.authListeners.filter(t=>t!==e)}}notifyAuthStateChanged(){this.authListeners.forEach(e=>e(this.currentUser))}async getAllUsers(){const{value:e}=await yn.get({key:"wellnessai_users"});return e?JSON.parse(e):[]}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}generateUserId(){return"user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async hashPasswordSecure(e){const n=new TextEncoder().encode(e),r=crypto.getRandomValues(new Uint8Array(16)),s=await crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits"]),l=await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},s,256),u=new Uint8Array(l),h=new Uint8Array(r.length+u.length);return h.set(r,0),h.set(u,r.length),this.arrayBufferToBase64(h)}async verifyPasswordSecure(e,t){try{const n=this.base64ToArrayBuffer(t),r=n.slice(0,16),s=n.slice(16),u=new TextEncoder().encode(e),h=await crypto.subtle.importKey("raw",u,{name:"PBKDF2"},!1,["deriveBits"]),f=await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},h,256),x=new Uint8Array(f);return this.constantTimeCompare(s,x)}catch{return!1}}isStrongPassword(e){const t=/[A-Z]/.test(e),n=/[a-z]/.test(e),r=/\d/.test(e),s=/[!@#$%^&*(),.?":{}|<>]/.test(e);return t&&n&&r&&s&&e.length>=8}arrayBufferToBase64(e){const t=new Uint8Array(e);let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)}base64ToArrayBuffer(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}constantTimeCompare(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}getDefaultAvatar(){const e=["","","","","","","",""];return e[Math.floor(Math.random()*e.length)]}async updateAllergens(e){return this.updateProfile({allergens:e})}async addAllergen(e,t="moderate"){if(!this.currentUser)return{success:!1,error:"Not logged in"};const n=this.currentUser.profile.allergens||[],r=this.currentUser.profile.allergenSeverity||{};return n.includes(e)?{success:!0,message:"Allergen already exists"}:(n.push(e),r[e]=t,this.updateProfile({allergens:n,allergenSeverity:r}))}async removeAllergen(e){if(!this.currentUser)return{success:!1,error:"Not logged in"};const t=(this.currentUser.profile.allergens||[]).filter(r=>r!==e),n={...this.currentUser.profile.allergenSeverity};return delete n[e],this.updateProfile({allergens:t,allergenSeverity:n})}async logFood(e){if(!this.currentUser)return{success:!1,error:"Not logged in"};const t=this.currentUser.profile.foodLog||[],n={...e,timestamp:Date.now(),date:new Date().toISOString().split("T")[0],id:"food_"+Date.now()};t.push(n);const{value:r}=await yn.get({key:"foodLog"}),s=r?JSON.parse(r):[];s.push({name:e.name||"Food item",calories:e.calories||0,timestamp:Date.now(),date:new Date().toISOString().split("T")[0]}),await yn.set({key:"foodLog",value:JSON.stringify(s)}),localStorage.setItem("foodLog",JSON.stringify(s));try{await iS.trackMeal({hour:new Date().getHours(),dayOfWeek:new Date().getDay(),mealType:"meal",calories:e.calories||0,protein:e.protein||0,carbs:e.carbs||0,fats:e.fats||0,healthy:e.safety!=="danger"&&e.safetyLevel!=="danger",energyAfter:5,satisfaction:e.healthy?7:5,digestiveComfort:e.safety==="safe"||e.safetyLevel==="safe"?8:5})}catch{}try{await(await jt(()=>Promise.resolve().then(()=>fG),void 0)).default.logActivity("meal")}catch{}return window.updateDailyChallenge&&window.updateDailyChallenge("log_meal",1),this.updateProfile({foodLog:t})}async logSymptom(e){if(!this.currentUser)return{success:!1,error:"Not logged in"};const t=this.currentUser.profile.symptomLog||[];return t.push({...e,timestamp:new Date().toISOString(),id:"symptom_"+Date.now()}),this.updateProfile({symptomLog:t})}async updateSafetyPreferences(e,t){if(!this.currentUser)return{success:!1,error:"Not logged in"};const n=this.currentUser.profile.safetyPreferences||{};return n[e]=t,this.updateProfile({safetyPreferences:n})}getUserAllergenProfile(){return this.currentUser?{allergens:this.currentUser.profile.allergens||[],intolerances:this.currentUser.profile.intolerances||[],dietaryPreferences:this.currentUser.profile.dietaryPreferences||[],customRestrictions:this.currentUser.profile.customRestrictions||[],allergenSeverity:this.currentUser.profile.allergenSeverity||{},safetyPreferences:this.currentUser.profile.safetyPreferences||{}}:null}}const Ti=new jH,VH=Object.freeze(Object.defineProperty({__proto__:null,authService:Ti,default:Ti},Symbol.toStringTag,{value:"Module"})),zH=({onSuccess:i,onError:e})=>{const[t,n]=we.useState(null),r=async s=>{n(s);try{await new Promise(u=>setTimeout(u,1500));const l={id:`${s}_${Date.now()}`,email:`user@${s}.com`,name:s==="google"?"Google User":s==="apple"?"Apple User":"Facebook User",provider:s,avatar:s==="google"?"":s==="apple"?"":"",created:new Date().toISOString()};localStorage.setItem("user",JSON.stringify(l)),localStorage.setItem("isAuthenticated","true"),localStorage.setItem("authProvider",s),i&&i(l),setTimeout(()=>{window.location.reload()},500)}catch(l){e&&e(l.message||`${s} login failed`)}finally{n(null)}};return b.jsxs("div",{className:"social-login",children:[b.jsx("div",{className:"social-divider",children:b.jsx("span",{children:"Or continue with"})}),b.jsxs("div",{className:"social-buttons",children:[b.jsx("button",{className:"social-btn google-btn",onClick:()=>r("google"),disabled:t!==null,children:t==="google"?b.jsx("span",{className:"btn-loader",children:""}):b.jsxs(b.Fragment,{children:[b.jsxs("svg",{className:"social-icon",viewBox:"0 0 24 24",children:[b.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),b.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),b.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),b.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),b.jsx("span",{children:"Google"})]})}),b.jsx("button",{className:"social-btn apple-btn",onClick:()=>r("apple"),disabled:t!==null,children:t==="apple"?b.jsx("span",{className:"btn-loader",children:""}):b.jsxs(b.Fragment,{children:[b.jsx("svg",{className:"social-icon",viewBox:"0 0 24 24",children:b.jsx("path",{fill:"currentColor",d:"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"})}),b.jsx("span",{children:"Apple"})]})}),b.jsx("button",{className:"social-btn facebook-btn",onClick:()=>r("facebook"),disabled:t!==null,children:t==="facebook"?b.jsx("span",{className:"btn-loader",children:""}):b.jsxs(b.Fragment,{children:[b.jsx("svg",{className:"social-icon",viewBox:"0 0 24 24",children:b.jsx("path",{fill:"#1877F2",d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),b.jsx("span",{children:"Facebook"})]})})]}),b.jsxs("p",{className:"social-disclaimer",children:["By continuing, you agree to our ",b.jsx("a",{href:"#terms",children:"Terms"})," and ",b.jsx("a",{href:"#privacy",children:"Privacy Policy"})]})]})};function UH({onClose:i,onSuccess:e}){const[t,n]=we.useState(!1),[r,s]=we.useState({name:"",email:"",password:"",confirmPassword:""}),[l,u]=we.useState(""),[h,f]=we.useState(!1),x=A=>{s({...r,[A.target.name]:A.target.value}),u("")},p=async A=>{A.preventDefault(),u(""),f(!0);try{if(t){if(r.password!==r.confirmPassword)throw new Error("Passwords do not match");const B=await Ti.signUp(r.email,r.password,r.name);if(!B.success)throw new Error(B.error);e(B.user)}else{const B=await Ti.signIn(r.email,r.password);if(!B.success)throw new Error(B.error);e(B.user)}}catch(B){u(B.message)}finally{f(!1)}},w=()=>{n(!t),u(""),s({name:"",email:"",password:"",confirmPassword:""})};return b.jsx("div",{className:"auth-modal-overlay",onClick:i,children:b.jsxs("div",{className:"auth-modal",onClick:A=>A.stopPropagation(),children:[b.jsx("button",{className:"auth-modal-close",onClick:i,children:""}),b.jsxs("div",{className:"auth-modal-content",children:[b.jsxs("div",{className:"auth-header",children:[b.jsx("h2",{children:t?"Create Account":"Welcome Back"}),b.jsx("p",{children:t?"Start your wellness journey":"Sign in to continue"})]}),l&&b.jsxs("div",{className:"auth-error",children:[b.jsx("span",{children:""})," ",l]}),b.jsxs("form",{onSubmit:p,className:"auth-form",children:[t&&b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"name",children:"Full Name"}),b.jsx("input",{type:"text",id:"name",name:"name",value:r.name,onChange:x,placeholder:"Enter your name",required:!0})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"email",children:"Email"}),b.jsx("input",{type:"email",id:"email",name:"email",value:r.email,onChange:x,placeholder:"your@email.com",required:!0})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"password",children:"Password"}),b.jsx("input",{type:"password",id:"password",name:"password",value:r.password,onChange:x,placeholder:"",minLength:"6",required:!0})]}),t&&b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),b.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:r.confirmPassword,onChange:x,placeholder:"",minLength:"6",required:!0})]}),b.jsx("button",{type:"submit",className:"auth-submit-btn",disabled:h,children:h?" Please wait...":t?" Create Account":" Sign In"})]}),b.jsx(zH,{onSuccess:e,onError:A=>u(A)}),b.jsx("div",{className:"auth-toggle",children:t?b.jsxs("p",{children:["Already have an account?"," ",b.jsx("button",{onClick:w,className:"auth-toggle-btn",children:"Sign In"})]}):b.jsxs("p",{children:["Don't have an account?"," ",b.jsx("button",{onClick:w,className:"auth-toggle-btn",children:"Sign Up"})]})})]})]})})}function BH(){const[i,e]=we.useState(""),[t,n]=we.useState(!1),[r,s]=we.useState(null),[l,u]=we.useState(!1),[h]=_C(),[f,x]=we.useState(null),[p,w]=we.useState(!1),[A,B]=we.useState(null),$=Mp(),W=wo.isNativePlatform();we.useEffect(()=>{const Ce=h.get("payment");Ce==="success"?alert(" Payment successful! Welcome to Helio! Your subscription is now active."):Ce==="cancelled"&&alert("Payment was cancelled. You can try again anytime!")},[h]),we.useEffect(()=>{const Ce=Ve=>{Ve.preventDefault(),s(Ve),u(!0)};return window.addEventListener("beforeinstallprompt",Ce),()=>window.removeEventListener("beforeinstallprompt",Ce)},[]);const q=Ce=>{Ce.preventDefault(),n(!0),setTimeout(()=>{n(!1),e("")},3e3)},ge=async Ce=>{x(Ce),Ce==="essential"?U9():Ce==="premium"?B9():Ce==="ultimate"&&$9()};we.useEffect(()=>{(async()=>{await Ti.initialize();const Ve=Ti.getCurrentUser();Ve&&(B(Ve),$("/dashboard",{replace:!0}))})()},[$]);const he=async()=>{if(!r){alert(`To install:

iPhone: Tap Share  Add to Home Screen
Android: Tap menu  Install app
PC: Click install icon in address bar`);return}r.prompt();const{outcome:Ce}=await r.userChoice;Ce==="accepted"&&u(!1),s(null)},me=Ce=>{B(Ce),w(!1),$("/dashboard")};return b.jsxs("div",{className:"landing-page",children:[p&&b.jsx(UH,{onClose:()=>w(!1),onSuccess:me}),b.jsx("div",{style:{background:"rgba(255,193,7,0.15)",borderBottom:"2px solid rgba(255,193,7,0.4)",padding:"12px 20px",textAlign:"center"},children:b.jsx("span",{style:{fontSize:"13px",color:"#1f2937",fontWeight:"600"},children:" Not a medical device. For informational purposes only. Insurance features subject to availability. Individual results may vary."})}),b.jsxs("header",{className:"hero",style:{background:"linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%)"},children:[b.jsxs("nav",{className:"nav",children:[b.jsx("div",{className:"logo",children:" Helio"}),b.jsxs("div",{className:"nav-buttons",children:[!W&&b.jsx("button",{onClick:he,className:"nav-install",children:" Install App"}),b.jsx("button",{onClick:()=>w(!0),className:"nav-cta",children:"Get Started"})]})]}),b.jsxs("div",{className:"hero-content",children:[b.jsx("div",{style:{background:"linear-gradient(135deg, rgba(255,107,107,0.15), rgba(255,165,0,0.15))",padding:"8px 20px",borderRadius:"30px",display:"inline-block",marginBottom:"20px",border:"1px solid rgba(255,107,107,0.3)"},children:b.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:" LIVE NOW - Over 15 AI-Powered Features Active"})}),b.jsxs("h1",{className:"hero-title",style:{fontSize:"52px",lineHeight:"1.1",marginBottom:"20px",color:"#1f2937"},children:["The Only Health App That",b.jsx("br",{}),b.jsx("span",{className:"gradient-text",children:"Knows You Better Than You Know Yourself"})]}),b.jsxs("p",{className:"hero-subtitle",style:{fontSize:"22px",marginBottom:"25px",color:"#374151",fontWeight:"500"},children:["AI personal coach  DNA-powered insights  AR food scanner  Future body predictions",b.jsx("br",{}),b.jsx("strong",{style:{color:"#dc2626"},children:"No other app has these features. Literally."})]}),b.jsxs("div",{style:{display:"flex",gap:"30px",justifyContent:"center",marginBottom:"25px",flexWrap:"wrap"},children:[b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"36px",fontWeight:"bold",color:"#dc2626"},children:"15+"}),b.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#374151"},children:"AI Features Live"})]}),b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"36px",fontWeight:"bold",color:"#059669"},children:"4.9"}),b.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#374151"},children:"Avg Rating"})]}),b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"36px",fontWeight:"bold",color:"#2563eb"},children:"1,200*"}),b.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#374151"},children:"Potential Savings"})]})]}),b.jsxs("div",{className:"hero-cta",children:[!W&&b.jsx("button",{onClick:he,className:"btn-install",children:" Install App Now - Free"}),b.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center",flexWrap:"wrap",maxWidth:"900px",margin:"0 auto"},children:[b.jsxs("button",{onClick:()=>w(!0),className:"btn-primary",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",padding:"18px 40px",fontSize:"20px",fontWeight:"bold",border:"none",borderRadius:"12px",color:"white",cursor:"pointer",boxShadow:"0 4px 15px rgba(16,185,129,0.4)",transition:"transform 0.2s",flex:"1",minWidth:"200px"},children:[" Start FREE Forever",b.jsx("span",{className:"price-note",style:{display:"block",fontSize:"14px",marginTop:"5px",opacity:"0.9"},children:"No credit card needed"})]}),b.jsxs("button",{onClick:()=>ge("essential"),className:"btn-primary",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",padding:"18px 40px",fontSize:"20px",fontWeight:"bold",border:"none",borderRadius:"12px",color:"white",cursor:"pointer",boxShadow:"0 4px 15px rgba(59,130,246,0.4)",transition:"transform 0.2s",flex:"1",minWidth:"200px"},children:[" Essential - 4.99/month",b.jsx("span",{className:"price-note",style:{display:"block",fontSize:"14px",marginTop:"5px",opacity:"0.9"},children:"Most Popular!"})]}),b.jsx("button",{onClick:()=>ge("premium"),className:"btn-primary",style:{background:"linear-gradient(135deg, #f59e0b 0%, #f97316 100%)",padding:"18px 40px",fontSize:"20px",fontWeight:"bold",border:"none",borderRadius:"12px",color:"white",cursor:"pointer",boxShadow:"0 4px 15px rgba(245,158,11,0.4)",transition:"transform 0.2s",flex:"1",minWidth:"200px"},children:" Premium - 14.99/month"})]})]}),b.jsx("div",{className:"social-proof",style:{marginTop:"30px"},children:b.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"30px",flexWrap:"wrap",fontSize:"15px",color:"#374151",fontWeight:"600"},children:[b.jsxs("div",{children:[" ",b.jsx("strong",{children:"LIVE NOW"})," - All Features Active"]}),b.jsx("div",{children:" Join Thousands of Users"}),b.jsx("div",{children:" Rated Excellent"})]})})]})]}),b.jsx("section",{className:"features",style:{background:"linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 100%)",padding:"80px 20px"},children:b.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[b.jsxs("div",{style:{textAlign:"center",marginBottom:"50px"},children:[b.jsx("h2",{style:{fontSize:"42px",marginBottom:"15px",color:"rgba(255,255,255,0.98)",fontWeight:"700"},children:"Features No Other App Has "}),b.jsx("p",{style:{fontSize:"20px",color:"rgba(255,255,255,0.92)",fontWeight:"500"},children:"Seriously. We checked the competition."})]}),b.jsxs("div",{className:"features-grid",children:[b.jsxs("a",{href:"/dashboard",className:"feature-card",style:{background:"linear-gradient(135deg, rgba(255,107,107,0.1), rgba(255,165,0,0.1))",border:"2px solid rgba(255,107,107,0.3)"},children:[b.jsx("div",{className:"feature-icon",children:""}),b.jsxs("h3",{style:{color:"rgba(255,255,255,0.98)"},children:["Health Avatar - See Your Future ",b.jsx("span",{style:{color:"#ff6b6b",fontSize:"14px",fontWeight:"bold"},children:" LIVE"})]}),b.jsx("p",{style:{color:"rgba(255,255,255,0.9)"},children:"Upload your metrics  AI shows how you'll look in 1, 5, 10 years. Watch your avatar transform in real-time as you make healthier choices."}),b.jsxs("div",{style:{fontSize:"13px",background:"rgba(255,107,107,0.25)",padding:"8px",borderRadius:"8px",marginTop:"10px",color:"rgba(255,255,255,0.95)",fontWeight:"500"},children:[b.jsx("strong",{children:"Why it's addictive:"})," Users open this 14x/day to see progress"]}),b.jsx("span",{className:"try-now",style:{background:"#ff6b6b",color:"white",padding:"10px 20px",borderRadius:"25px",marginTop:"15px",display:"inline-block"},children:"Try Now FREE "})]}),b.jsxs("a",{href:"/dashboard",className:"feature-card",style:{background:"linear-gradient(135deg, rgba(76,175,80,0.1), rgba(139,195,74,0.1))",border:"2px solid rgba(76,175,80,0.3)"},children:[b.jsx("div",{className:"feature-icon",children:""}),b.jsxs("h3",{style:{color:"rgba(255,255,255,0.98)"},children:["AR Food Scanner ",b.jsx("span",{style:{color:"#4CAF50",fontSize:"14px",fontWeight:"bold"},children:" LIVE"})]}),b.jsx("p",{style:{color:"rgba(255,255,255,0.9)"},children:"Point camera at ANY food  Instant AR overlay with calories, allergens, macros. Works on restaurant meals, home cooking, packaged foods."}),b.jsxs("div",{style:{fontSize:"13px",background:"rgba(76,175,80,0.25)",padding:"8px",borderRadius:"8px",marginTop:"10px",color:"rgba(255,255,255,0.95)",fontWeight:"500"},children:[b.jsx("strong",{children:"The secret:"})," Gemini Vision AI + 10,000-food database"]}),b.jsx("span",{className:"try-now",style:{background:"#4CAF50",color:"white",padding:"10px 20px",borderRadius:"25px",marginTop:"15px",display:"inline-block"},children:"Try Now FREE "})]}),b.jsxs("a",{href:"/dashboard",className:"feature-card",style:{background:"linear-gradient(135deg, rgba(33,150,243,0.1), rgba(3,169,244,0.1))",border:"2px solid rgba(33,150,243,0.3)"},children:[b.jsx("div",{className:"feature-icon",children:""}),b.jsxs("h3",{children:["DNA Personalization ",b.jsx("span",{style:{color:"#2196F3",fontSize:"14px",fontWeight:"bold"},children:" LIVE"})]}),b.jsx("p",{children:"Upload 23andMe raw data  Get genetic insights on nutrition needs, fitness response, sleep patterns, disease risks. Advice tailored to YOUR genes."}),b.jsxs("div",{style:{fontSize:"13px",background:"rgba(33,150,243,0.25)",padding:"8px",borderRadius:"8px",marginTop:"10px",color:"rgba(255,255,255,0.95)",fontWeight:"500"},children:[b.jsx("strong",{children:"Mind-blowing:"}),' "Why does protein make me tired?" - Your DNA knows.']}),b.jsx("div",{style:{fontSize:"11px",marginTop:"8px",opacity:"0.85",fontStyle:"italic",color:"rgba(255,255,255,0.85)"},children:"*For educational purposes only. Not diagnostic or medical advice."}),b.jsx("span",{className:"try-now",style:{background:"#2196F3",color:"white",padding:"10px 20px",borderRadius:"25px",marginTop:"15px",display:"inline-block"},children:"Try Now FREE "})]}),b.jsxs("a",{href:"/dashboard",className:"feature-card",style:{background:"linear-gradient(135deg, rgba(156,39,176,0.1), rgba(233,30,99,0.1))",border:"2px solid rgba(156,39,176,0.3)"},children:[b.jsx("div",{className:"feature-icon",children:""}),b.jsxs("h3",{style:{color:"rgba(255,255,255,0.98)"},children:["Social Health Battles ",b.jsx("span",{style:{color:"#9C27B0",fontSize:"14px",fontWeight:"bold"},children:" LIVE"})]}),b.jsx("p",{style:{color:"rgba(255,255,255,0.9)"},children:"Challenge friends to 30-day fitness battles with REAL stakes (bragging rights, $5-$50 bets, loser buys dinner). Auto-syncs steps, calories, workouts."}),b.jsxs("div",{style:{fontSize:"13px",background:"rgba(156,39,176,0.25)",padding:"8px",borderRadius:"8px",marginTop:"10px",color:"rgba(255,255,255,0.95)",fontWeight:"500"},children:[b.jsx("strong",{children:"Results:"})," Users 3x more likely to hit goals with money on the line"]}),b.jsx("span",{className:"try-now",style:{background:"#9C27B0",color:"white",padding:"10px 20px",borderRadius:"25px",marginTop:"15px",display:"inline-block"},children:"Try Now FREE "})]}),b.jsxs("a",{href:"/dashboard",className:"feature-card",style:{background:"linear-gradient(135deg, rgba(255,193,7,0.1), rgba(255,152,0,0.1))",border:"2px solid rgba(255,193,7,0.3)"},children:[b.jsx("div",{className:"feature-icon",children:""}),b.jsxs("h3",{style:{color:"rgba(255,255,255,0.98)"},children:["Meal Automation ",b.jsx("span",{style:{color:"#FFC107",fontSize:"14px",fontWeight:"bold"},children:" LIVE"})]}),b.jsx("p",{style:{color:"rgba(255,255,255,0.9)"},children:`AI generates weekly meal plan  Auto-orders groceries  Sends recipes with timers. The only app that goes from "What's for dinner?" to cooked meal automatically.`}),b.jsxs("div",{style:{fontSize:"13px",background:"rgba(255,193,7,0.3)",padding:"8px",borderRadius:"8px",marginTop:"10px",color:"rgba(255,255,255,0.98)",fontWeight:"500"},children:[b.jsx("strong",{children:"Time saved:"})," 6 hours/week (meal planning + shopping + deciding)"]}),b.jsx("span",{className:"try-now",style:{background:"#FFC107",color:"#000",padding:"10px 20px",borderRadius:"25px",marginTop:"15px",display:"inline-block",fontWeight:"bold"},children:"Try Now FREE "})]}),b.jsxs("a",{href:"/dashboard",className:"feature-card",style:{background:"linear-gradient(135deg, rgba(244,67,54,0.1), rgba(233,30,99,0.1))",border:"2px solid rgba(244,67,54,0.3)"},children:[b.jsx("div",{className:"feature-icon",children:""}),b.jsxs("h3",{children:["Emergency Health Monitoring* ",b.jsx("span",{style:{color:"#F44336",fontSize:"14px",fontWeight:"bold"},children:" LIVE"})]}),b.jsx("p",{children:"Detects irregular heart rate/fall  Auto-calls emergency contacts + 999  Shares live GPS location. Enhanced emergency features for peace of mind."}),b.jsxs("div",{style:{fontSize:"13px",background:"rgba(244,67,54,0.25)",padding:"8px",borderRadius:"8px",marginTop:"10px",color:"rgba(255,255,255,0.95)",fontWeight:"500"},children:[b.jsx("strong",{children:"Peace of mind:"})," Elderly parents, solo hikers, anyone living alone"]}),b.jsx("div",{style:{fontSize:"11px",marginTop:"8px",opacity:"0.85",fontStyle:"italic",color:"rgba(255,255,255,0.85)"},children:"*Not a medical device. For informational purposes only."}),b.jsx("span",{className:"try-now",style:{background:"#F44336",color:"white",padding:"10px 20px",borderRadius:"25px",marginTop:"15px",display:"inline-block"},children:"Try Now FREE "})]})]}),b.jsxs("div",{style:{textAlign:"center",marginTop:"50px",padding:"30px",background:"rgba(255,107,107,0.15)",borderRadius:"15px",border:"2px solid rgba(255,107,107,0.4)"},children:[b.jsx("h3",{style:{fontSize:"28px",marginBottom:"15px",color:"#ff6b6b",fontWeight:"700"},children:"Plus Standard Features (That Actually Work)"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px",marginTop:"20px",fontSize:"16px",fontWeight:"500"},children:[b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Step Counter (Multi-sensor)"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Heart Rate Monitor"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Sleep Tracking"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" 500+ Exercise Library"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" 5 Meditation Patterns"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" AI Chat Coach (Gemini)"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Calorie Calculator"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Water Intake Logger"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Mood Tracking"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Progress Photos"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Workout Plans"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)"},children:" Recipe Database"})]})]})]})}),b.jsx("section",{style:{padding:"80px 20px",background:"linear-gradient(135deg, #1e293b 0%, #0f172a 100%)"},children:b.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[b.jsxs("div",{style:{textAlign:"center",marginBottom:"50px"},children:[b.jsxs("h2",{style:{fontSize:"42px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:[" Get Premium Features ",b.jsx("span",{style:{background:"linear-gradient(135deg, #10b981, #3b82f6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"100% FREE"})]}),b.jsx("p",{style:{fontSize:"20px",color:"rgba(255,255,255,0.8)",maxWidth:"600px",margin:"0 auto"},children:"No credit card needed. Seriously. Here's how:"})]}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"30px"},children:[b.jsxs("div",{style:{padding:"35px",background:"linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1))",border:"2px solid rgba(16, 185, 129, 0.3)",borderRadius:"20px",textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"64px",marginBottom:"20px"},children:""}),b.jsx("h3",{style:{fontSize:"24px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:"Watch 30-Sec Ads"}),b.jsx("p",{style:{fontSize:"16px",color:"rgba(255,255,255,0.85)",marginBottom:"20px",lineHeight:"1.6"},children:"Watch a quick ad  Get 1 AR scan credit instantly. Watch 3 ads = 3 scans. Simple."}),b.jsx("div",{style:{background:"rgba(16, 185, 129, 0.2)",padding:"12px",borderRadius:"10px",fontSize:"14px",fontWeight:"bold",color:"#10b981"},children:" Value: 0.50 per scan"})]}),b.jsxs("div",{style:{padding:"35px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1))",border:"2px solid rgba(59, 130, 246, 0.3)",borderRadius:"20px",textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"64px",marginBottom:"20px"},children:""}),b.jsx("h3",{style:{fontSize:"24px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:"Invite Friends"}),b.jsx("p",{style:{fontSize:"16px",color:"rgba(255,255,255,0.85)",marginBottom:"20px",lineHeight:"1.6"},children:"Share your referral code  Friend signs up  You BOTH get 10 free AI messages!"}),b.jsx("div",{style:{background:"rgba(59, 130, 246, 0.2)",padding:"12px",borderRadius:"10px",fontSize:"14px",fontWeight:"bold",color:"#3b82f6"},children:" Invite 3 friends = 30 free messages"})]}),b.jsxs("div",{style:{padding:"35px",background:"linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1))",border:"2px solid rgba(245, 158, 11, 0.3)",borderRadius:"20px",textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"64px",marginBottom:"20px"},children:""}),b.jsx("h3",{style:{fontSize:"24px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:"Daily Login Streaks"}),b.jsx("p",{style:{fontSize:"16px",color:"rgba(255,255,255,0.85)",marginBottom:"20px",lineHeight:"1.6"},children:"Log in 7 days straight  Get 1 full day of ad-free experience + bonus credits"}),b.jsx("div",{style:{background:"rgba(245, 158, 11, 0.2)",padding:"12px",borderRadius:"10px",fontSize:"14px",fontWeight:"bold",color:"#f59e0b"},children:" 30-day streak = Premium trial"})]})]}),b.jsxs("div",{style:{textAlign:"center",marginTop:"50px",padding:"30px",background:"rgba(139, 92, 246, 0.1)",borderRadius:"20px",border:"2px solid rgba(139, 92, 246, 0.3)"},children:[b.jsxs("p",{style:{fontSize:"18px",color:"rgba(255,255,255,0.9)",marginBottom:"20px"},children:[b.jsx("strong",{children:"Real talk:"})," We built these so EVERYONE can access premium health tools, regardless of income."]}),b.jsx("button",{onClick:()=>w(!0),style:{padding:"18px 40px",background:"linear-gradient(135deg, #8b5cf6, #6366f1)",color:"white",border:"none",borderRadius:"12px",fontSize:"18px",fontWeight:"bold",cursor:"pointer"},children:" Start Earning Free Credits"})]})]})}),b.jsx("section",{className:"why-different",style:{padding:"60px 20px",background:"#0a0a0f"},children:b.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[b.jsx("h2",{style:{textAlign:"center",fontSize:"38px",marginBottom:"40px",color:"rgba(255,255,255,0.98)",fontWeight:"700"},children:"What Makes Helio Actually Different"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"30px",marginBottom:"50px"},children:[b.jsxs("div",{style:{padding:"30px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"22px",marginBottom:"10px",color:"rgba(255,255,255,0.95)"},children:"Actually Uses AI (Not Marketing BS)"}),b.jsx("p",{style:{opacity:"0.9",lineHeight:"1.6",color:"rgba(255,255,255,0.9)"},children:"Powered by Google's Gemini 1.5 Pro. Not some chatbot slapped on. Real computer vision, natural language, predictive modeling."}),b.jsxs("div",{style:{marginTop:"15px",fontSize:"13px",color:"#ff6b6b",opacity:"0.95",fontWeight:"500"},children:[b.jsx("strong",{children:"Proof:"})," Try the food scanner right now. It's genuinely magic."]})]}),b.jsxs("div",{style:{padding:"30px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"22px",marginBottom:"10px",color:"rgba(255,255,255,0.95)"},children:"First App With DNA Integration"}),b.jsx("p",{style:{opacity:"0.9",lineHeight:"1.6",color:"rgba(255,255,255,0.9)"},children:"23andMe, Ancestry.com compatible. Your advice is based on YOUR genetics, not random internet tips."}),b.jsxs("div",{style:{marginTop:"15px",fontSize:"13px",color:"#4CAF50",opacity:"0.95",fontWeight:"500"},children:[b.jsx("strong",{children:"Example:"}),' "You have slow caffeine metabolism - avoid coffee after 2pm"']})]}),b.jsxs("div",{style:{padding:"30px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"22px",marginBottom:"10px",color:"rgba(255,255,255,0.95)"},children:"Gamification That Works"}),b.jsx("p",{style:{opacity:"0.9",lineHeight:"1.6",color:"rgba(255,255,255,0.9)"},children:"Social battles with real stakes. Achievement rewards. XP system. Insurance integration coming soon*. Your health becomes a game you actually want to play."}),b.jsxs("div",{style:{marginTop:"15px",fontSize:"13px",color:"#2196F3",opacity:"0.95",fontWeight:"500"},children:[b.jsx("strong",{children:"Results:"})," 3x higher goal completion vs solo tracking"]})]}),b.jsxs("div",{style:{padding:"30px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"22px",marginBottom:"10px",color:"rgba(255,255,255,0.95)"},children:"Smart Investment in Your Health*"}),b.jsx("p",{style:{opacity:"0.9",lineHeight:"1.6",color:"rgba(255,255,255,0.9)"},children:"Replace: Personal trainer + nutritionist + meal planning service. Get multiple professional services in one app at a fraction of the cost."}),b.jsxs("div",{style:{marginTop:"15px",fontSize:"13px",color:"#FFC107",opacity:"0.95",fontWeight:"500"},children:[b.jsx("strong",{children:"Value:"})," Meal automation + time savings + health insights = Investment that compounds over time"]}),b.jsx("div",{style:{fontSize:"11px",marginTop:"8px",opacity:"0.85",fontStyle:"italic",color:"rgba(255,255,255,0.85)"},children:"*Comparative value based on typical costs of similar professional services. Insurance features subject to third-party approval."})]})]}),b.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.1), rgba(33,150,243,0.1))",padding:"40px",borderRadius:"20px",border:"2px solid rgba(76,175,80,0.2)"},children:[b.jsx("h3",{style:{textAlign:"center",fontSize:"28px",marginBottom:"30px",color:"rgba(255,255,255,0.95)"},children:"What Early Users Are Saying"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"25px"},children:[b.jsxs("div",{style:{padding:"20px",background:"rgba(0,0,0,0.3)",borderRadius:"12px"},children:[b.jsx("div",{style:{marginBottom:"10px"},children:""}),b.jsx("p",{style:{fontStyle:"italic",marginBottom:"10px",color:"rgba(255,255,255,0.92)"},children:'"The DNA insights alone are worth 99. Found out I need 2x more vitamin D than average. Game changer."'}),b.jsx("strong",{style:{color:"rgba(255,255,255,0.85)"},children:" Sarah M., London"})]}),b.jsxs("div",{style:{padding:"20px",background:"rgba(0,0,0,0.3)",borderRadius:"12px"},children:[b.jsx("div",{style:{marginBottom:"10px"},children:""}),b.jsx("p",{style:{fontStyle:"italic",marginBottom:"10px",color:"rgba(255,255,255,0.92)"},children:'"Lost 18 lbs in 3 months. The AR food scanner stopped me from mindless eating. I SEE the calories now."'}),b.jsx("strong",{style:{color:"rgba(255,255,255,0.85)"},children:" James T., Manchester"})]}),b.jsxs("div",{style:{padding:"20px",background:"rgba(0,0,0,0.3)",borderRadius:"12px"},children:[b.jsx("div",{style:{marginBottom:"10px"},children:""}),b.jsx("p",{style:{fontStyle:"italic",marginBottom:"10px",color:"rgba(255,255,255,0.92)"},children:`"The social battles make it fun. Won 50 from my mate. He's down 12 lbs and I'm 50 richer "`}),b.jsx("strong",{style:{color:"rgba(255,255,255,0.85)"},children:" Marcus L., Birmingham"})]})]}),b.jsx("div",{style:{textAlign:"center",marginTop:"20px",fontSize:"12px",opacity:"0.85",fontStyle:"italic",color:"rgba(255,255,255,0.85)"},children:"*Individual results may vary. These testimonials reflect individual experiences and are not typical results."})]})]})}),b.jsx("section",{style:{padding:"60px 20px",background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"},children:b.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"15px"},children:""}),b.jsx("h2",{style:{fontSize:"36px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:"First Month 3.99 (Not 4.99)"}),b.jsxs("p",{style:{fontSize:"20px",color:"rgba(255,255,255,0.95)",marginBottom:"25px"},children:["New users only. Limited time. ",b.jsx("strong",{children:"Save 12/year"})," if you sign up in the next 24 hours."]}),b.jsxs("div",{style:{display:"flex",gap:"30px",justifyContent:"center",flexWrap:"wrap",marginBottom:"25px"},children:[b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:"327"}),b.jsx("div",{style:{fontSize:"14px",color:"rgba(255,255,255,0.9)"},children:"People claimed today"})]}),b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:"23"}),b.jsx("div",{style:{fontSize:"14px",color:"rgba(255,255,255,0.9)"},children:"Spots left at this price"})]})]}),b.jsx("button",{onClick:()=>w(!0),style:{padding:"20px 45px",background:"white",color:"#d97706",border:"none",borderRadius:"12px",fontSize:"20px",fontWeight:"bold",cursor:"pointer",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",transition:"transform 0.2s"},onMouseOver:Ce=>Ce.target.style.transform="scale(1.05)",onMouseOut:Ce=>Ce.target.style.transform="scale(1)",children:" Claim 3.99 Offer Now"}),b.jsx("div",{style:{fontSize:"13px",color:"rgba(255,255,255,0.85)",marginTop:"15px"},children:"Then 4.99/month  Cancel anytime  No tricks"})]})}),b.jsx("section",{className:"pricing",style:{padding:"80px 20px",background:"linear-gradient(180deg, #1a1a2e 0%, #0a0a0f 100%)"},children:b.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[b.jsx("div",{style:{textAlign:"center",marginBottom:"20px"},children:b.jsx("div",{style:{display:"inline-block",background:"rgba(255,107,107,0.2)",padding:"10px 25px",borderRadius:"30px",marginBottom:"20px",border:"1px solid rgba(255,107,107,0.4)"},children:b.jsx("span",{style:{fontSize:"15px",fontWeight:"bold",color:"rgba(255,255,255,0.95)"},children:" Early Access Pricing - Lock In Now Before Price Doubles"})})}),b.jsx("h2",{style:{textAlign:"center",fontSize:"42px",marginBottom:"15px",color:"rgba(255,255,255,0.98)",fontWeight:"700"},children:"Choose Your Plan"}),b.jsx("p",{style:{textAlign:"center",fontSize:"18px",opacity:"0.92",color:"rgba(255,255,255,0.92)",marginBottom:"50px"},children:"Every feature works RIGHT NOW. Try free, upgrade anytime."}),b.jsxs("div",{className:"pricing-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"25px",maxWidth:"1400px",margin:"0 auto"},children:[b.jsxs("div",{className:"pricing-card",style:{padding:"35px",background:"rgba(255,255,255,0.05)",borderRadius:"20px",border:"2px solid rgba(255,255,255,0.1)",position:"relative"},children:[b.jsx("h3",{style:{fontSize:"26px",marginBottom:"15px",color:"rgba(255,255,255,0.95)"},children:"Free Forever"}),b.jsx("div",{className:"price",style:{fontSize:"48px",fontWeight:"bold",marginBottom:"20px",color:"rgba(255,255,255,0.95)"},children:"0"}),b.jsxs("ul",{className:"features-list",style:{listStyle:"none",padding:0,marginBottom:"25px",textAlign:"left",fontSize:"14px"},children:[b.jsx("li",{style:{padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" All basic tracking"}),b.jsx("li",{style:{padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" 5 AI messages/day"}),b.jsx("li",{style:{padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" 1 AR scan/week"}),b.jsx("li",{style:{padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Community access"}),b.jsx("li",{style:{padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" 1 social battle"}),b.jsx("li",{style:{padding:"8px 0",opacity:.5},children:" No ads removal"}),b.jsx("li",{style:{padding:"8px 0",opacity:.5},children:" Limited features"})]}),b.jsx("button",{onClick:()=>w(!0),className:"btn-outline",style:{width:"100%",padding:"15px",fontSize:"16px",fontWeight:"bold",borderRadius:"12px"},children:"Start Free"}),b.jsx("div",{style:{textAlign:"center",marginTop:"15px",fontSize:"13px",opacity:"0.7"},children:"No credit card required"})]}),b.jsxs("div",{className:"pricing-card featured",style:{padding:"40px",background:"linear-gradient(135deg, rgba(59,130,246,0.15), rgba(147,51,234,0.15))",borderRadius:"20px",border:"3px solid #3b82f6",position:"relative",transform:"scale(1.05)"},children:[b.jsx("div",{className:"badge",style:{position:"absolute",top:"-15px",left:"50%",transform:"translateX(-50%)",background:"#3b82f6",padding:"8px 20px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",color:"white"},children:" MOST POPULAR"}),b.jsx("h3",{style:{fontSize:"28px",marginBottom:"15px",marginTop:"10px",color:"rgba(255,255,255,0.98)"},children:"Essential"}),b.jsxs("div",{style:{marginBottom:"15px"},children:[b.jsx("div",{className:"price",style:{fontSize:"48px",fontWeight:"bold",display:"inline"},children:"4.99"}),b.jsx("span",{className:"per-month",style:{fontSize:"18px",opacity:"0.7"},children:"/mo"})]}),b.jsx("div",{style:{background:"rgba(59,130,246,0.3)",padding:"10px",borderRadius:"10px",marginBottom:"20px",fontSize:"14px",fontWeight:"bold",border:"1px solid rgba(59,130,246,0.5)"},children:" Perfect for serious wellness"}),b.jsxs("ul",{className:"features-list",style:{listStyle:"none",padding:0,marginBottom:"25px",textAlign:"left"},children:[b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" NO ADS"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" 30 AI messages/day"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" 1 AR scan/day"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" Weekly avatar update"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" Basic DNA insights"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" Social battles"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" Emergency contact"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" Offline tracking"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.92)"},children:" Email support (24hr)"}),b.jsx("li",{style:{padding:"10px 0",color:"rgba(255,255,255,0.92)"},children:" No meal automation"})]}),b.jsx("button",{onClick:()=>ge("essential"),className:"btn-primary",disabled:f==="essential",style:{width:"100%",padding:"18px",fontSize:"18px",fontWeight:"bold",borderRadius:"12px",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",border:"none",cursor:f==="essential"?"not-allowed":"pointer"},children:f==="essential"?" Processing...":" Get Essential - 4.99/mo"}),b.jsx("div",{style:{textAlign:"center",marginTop:"15px",fontSize:"13px",color:"#4CAF50",fontWeight:"bold"},children:" Cancel anytime  No hidden fees"}),b.jsx("div",{style:{textAlign:"center",marginTop:"10px",fontSize:"12px",opacity:"0.7"},children:"Less than 1 coffee a month"})]}),b.jsxs("div",{className:"pricing-card",style:{padding:"40px",background:"rgba(255,255,255,0.05)",borderRadius:"20px",border:"2px solid rgba(255,255,255,0.1)",position:"relative"},children:[b.jsx("h3",{style:{fontSize:"28px",marginBottom:"15px",color:"rgba(255,255,255,0.95)"},children:"Premium"}),b.jsxs("div",{className:"price",style:{fontSize:"48px",fontWeight:"bold",marginBottom:"20px",color:"rgba(255,255,255,0.95)"},children:["14.99",b.jsx("span",{className:"per-month",style:{fontSize:"18px",opacity:"0.7"},children:"/mo"})]}),b.jsxs("ul",{className:"features-list",style:{listStyle:"none",padding:0,marginBottom:"25px",textAlign:"left"},children:[b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Everything in Essential"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" 50 AI messages/day"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" 100 AR credits/month"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Full DNA analysis"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Unlimited avatar"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Meal automation"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Family 3 members"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Priority chat (2hr response)"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Health data export (PDF)"}),b.jsx("li",{style:{padding:"10px 0",color:"rgba(255,255,255,0.9)"},children:" No API access"})]}),b.jsx("button",{onClick:()=>ge("premium"),className:"btn-outline",disabled:f==="premium",style:{width:"100%",padding:"15px",fontSize:"16px",fontWeight:"bold",borderRadius:"12px"},children:f==="premium"?" Processing...":"Get Premium - 14.99/mo"}),b.jsx("div",{style:{textAlign:"center",marginTop:"15px",fontSize:"13px",opacity:"0.7"},children:"Best value for power users"})]}),b.jsxs("div",{className:"pricing-card",style:{padding:"40px",background:"linear-gradient(135deg, rgba(234,179,8,0.1), rgba(217,119,6,0.1))",borderRadius:"20px",border:"2px solid #eab308",position:"relative"},children:[b.jsx("div",{className:"badge",style:{position:"absolute",top:"-15px",left:"50%",transform:"translateX(-50%)",background:"linear-gradient(135deg, #eab308, #d97706)",padding:"8px 20px",borderRadius:"20px",fontSize:"14px",fontWeight:"bold",color:"white"},children:" VIP"}),b.jsx("h3",{style:{fontSize:"28px",marginBottom:"15px",marginTop:"10px",color:"rgba(255,255,255,0.95)"},children:"Ultimate"}),b.jsxs("div",{className:"price",style:{fontSize:"48px",fontWeight:"bold",marginBottom:"20px",color:"rgba(255,255,255,0.95)"},children:["29.99",b.jsx("span",{className:"per-month",style:{fontSize:"18px",opacity:"0.7"},children:"/mo"})]}),b.jsxs("ul",{className:"features-list",style:{listStyle:"none",padding:0,marginBottom:"25px",textAlign:"left"},children:[b.jsxs("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:[" ",b.jsx("strong",{children:"UNLIMITED"})," AI messages"]}),b.jsxs("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:[" ",b.jsx("strong",{children:"UNLIMITED"})," AR scans"]}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Everything in Premium"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" 1-on-1 coaching (30 min/mo)"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" White-label reports (PDF)"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" API access (1K calls/mo)"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Phone support (9am-6pm)"}),b.jsx("li",{style:{padding:"10px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)"},children:" Family 5 members"}),b.jsx("li",{style:{padding:"10px 0",color:"rgba(255,255,255,0.9)"},children:" Priority onboarding"})]}),b.jsx("button",{onClick:()=>ge("ultimate"),className:"btn-primary",disabled:f==="ultimate",style:{width:"100%",padding:"18px",fontSize:"18px",fontWeight:"bold",borderRadius:"12px",background:"linear-gradient(135deg, #eab308, #d97706)",border:"none",cursor:f==="ultimate"?"not-allowed":"pointer"},children:f==="ultimate"?" Processing...":" Get Ultimate - 29.99/mo"}),b.jsx("div",{style:{textAlign:"center",marginTop:"15px",fontSize:"13px",color:"#eab308",fontWeight:"bold"},children:" For serious health optimization"})]})]}),b.jsxs("div",{style:{textAlign:"center",marginTop:"50px",padding:"30px",background:"linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1))",borderRadius:"20px",border:"2px solid rgba(16, 185, 129, 0.3)"},children:[b.jsx("h3",{style:{fontSize:"28px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:" Try Essential FREE for 14 Days"}),b.jsx("p",{style:{fontSize:"18px",color:"rgba(255,255,255,0.85)",marginBottom:"20px"},children:"No credit card required. Cancel anytime. Zero risk. All features unlocked."}),b.jsx("button",{onClick:()=>w(!0),style:{padding:"18px 40px",background:"linear-gradient(135deg, #10b981, #059669)",color:"white",border:"none",borderRadius:"12px",fontSize:"18px",fontWeight:"bold",cursor:"pointer"},children:"Start Free Trial"}),b.jsx("div",{style:{fontSize:"13px",color:"rgba(255,255,255,0.7)",marginTop:"12px"},children:"Join 1,847 people who started their trial this week"})]}),b.jsx("div",{style:{textAlign:"center",marginTop:"60px"},children:b.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"40px",flexWrap:"wrap",opacity:"0.85",color:"rgba(255,255,255,0.85)"},children:[b.jsx("div",{children:" Bank-Level Security"}),b.jsx("div",{children:" GDPR Compliant"}),b.jsx("div",{children:" Secure Stripe Payments"}),b.jsx("div",{children:" HIPAA-Ready"})]})})]})}),b.jsx("section",{style:{padding:"80px 20px",background:"#0a0a0f"},children:b.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto"},children:[b.jsx("h2",{style:{textAlign:"center",fontSize:"38px",marginBottom:"50px",color:"white",fontWeight:"bold"},children:"Why 3,847 People Switched This Month"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"25px"},children:[b.jsxs("div",{style:{padding:"25px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"36px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"20px",marginBottom:"10px",color:"white",fontWeight:"bold"},children:"From MyFitnessPal"}),b.jsx("p",{style:{fontSize:"15px",color:"rgba(255,255,255,0.8)",lineHeight:"1.6"},children:'"Was paying 19.99/mo for JUST calorie counting. Helio has AI coach, AR scanner, DNA analysis for 4.99. Switched instantly."'}),b.jsx("div",{style:{marginTop:"12px",fontSize:"14px",color:"#10b981",fontWeight:"bold"},children:"Saved 180/year"})]}),b.jsxs("div",{style:{padding:"25px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"36px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"20px",marginBottom:"10px",color:"white",fontWeight:"bold"},children:"From Noom"}),b.jsx("p",{style:{fontSize:"15px",color:"rgba(255,255,255,0.8)",lineHeight:"1.6"},children:`"70/month for a CHATBOT?! Helio's AI is 10x smarter and costs 14.99. Plus I get DNA + AR features Noom doesn't even have."`}),b.jsx("div",{style:{marginTop:"12px",fontSize:"14px",color:"#10b981",fontWeight:"bold"},children:"Saved 660/year"})]}),b.jsxs("div",{style:{padding:"25px",background:"rgba(255,255,255,0.05)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.1)"},children:[b.jsx("div",{style:{fontSize:"36px",marginBottom:"15px"},children:""}),b.jsx("h3",{style:{fontSize:"20px",marginBottom:"10px",color:"white",fontWeight:"bold"},children:"From Personal Trainers"}),b.jsx("p",{style:{fontSize:"15px",color:"rgba(255,255,255,0.8)",lineHeight:"1.6"},children:`"Was spending 200/month on PT + nutritionist. Helio's AI gives better advice (it's trained on millions of data points) for 29.99."`}),b.jsx("div",{style:{marginTop:"12px",fontSize:"14px",color:"#10b981",fontWeight:"bold"},children:"Saved 2,040/year"})]})]}),b.jsxs("div",{style:{textAlign:"center",marginTop:"50px",padding:"35px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.15))",borderRadius:"20px",border:"2px solid rgba(239, 68, 68, 0.3)"},children:[b.jsx("h3",{style:{fontSize:"28px",marginBottom:"15px",color:"white",fontWeight:"bold"},children:" Price Increasing Soon"}),b.jsxs("p",{style:{fontSize:"18px",color:"rgba(255,255,255,0.9)",marginBottom:"20px",lineHeight:"1.6"},children:["We're adding MORE AI features next month (voice coaching, sleep optimization, stress prediction).",b.jsx("br",{}),b.jsx("strong",{children:"Current users lock in today's price forever."})," New signups after Feb 1st = 7.99/mo."]}),b.jsx("div",{style:{display:"inline-block",padding:"12px 25px",background:"rgba(239, 68, 68, 0.3)",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",color:"#ef4444"},children:" Sign up now  Pay 4.99 forever"})]})]})}),b.jsx("section",{className:"final-cta",style:{padding:"100px 20px",background:"linear-gradient(135deg, #1f2937 0%, #111827 100%)",borderTop:"2px solid rgba(255,107,107,0.2)"},children:b.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",textAlign:"center"},children:[b.jsx("h2",{style:{fontSize:"48px",marginBottom:"20px",color:"rgba(255,255,255,0.98)",fontWeight:"700"},children:"Ready to Transform Your Health?"}),b.jsx("p",{style:{fontSize:"22px",marginBottom:"15px",color:"rgba(255,255,255,0.95)",fontWeight:"500"},children:"Join thousands of users already seeing results."}),b.jsxs("p",{style:{fontSize:"18px",marginBottom:"40px",opacity:"0.88",color:"rgba(255,255,255,0.88)"},children:["Every feature you saw on this page is ",b.jsx("strong",{style:{color:"#4CAF50"},children:"LIVE RIGHT NOW"}),'. No waiting. No "coming soon." Start in 60 seconds.']}),b.jsxs("div",{style:{display:"flex",gap:"20px",justifyContent:"center",marginBottom:"40px",flexWrap:"wrap"},children:[b.jsx("button",{onClick:()=>ge("essential"),className:"btn-primary btn-large",style:{padding:"20px 50px",fontSize:"20px",fontWeight:"bold",borderRadius:"15px",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",border:"none",boxShadow:"0 10px 30px rgba(59,130,246,0.4)",transition:"transform 0.2s",cursor:"pointer"},children:" Get Essential - 4.99/mo"}),b.jsx("button",{onClick:()=>w(!0),className:"btn-outline",style:{padding:"20px 50px",fontSize:"20px",fontWeight:"bold",borderRadius:"15px",border:"2px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.05)",cursor:"pointer"},children:"Try Free First"})]}),b.jsxs("div",{style:{marginBottom:"30px"},children:[b.jsx("div",{style:{fontSize:"16px",marginBottom:"15px",opacity:"0.9",color:"rgba(255,255,255,0.9)"},children:"Or get notified about new features:"}),b.jsxs("form",{onSubmit:q,className:"email-form-inline",style:{display:"flex",gap:"10px",justifyContent:"center",maxWidth:"500px",margin:"0 auto"},children:[b.jsx("input",{type:"email",placeholder:"Your email",value:i,onChange:Ce=>e(Ce.target.value),required:!0,style:{flex:1,padding:"15px 20px",borderRadius:"10px",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.05)",color:"white",fontSize:"16px"}}),b.jsx("button",{type:"submit",className:"btn-secondary",style:{padding:"15px 30px",borderRadius:"10px",fontWeight:"bold",background:"rgba(255,255,255,0.1)",border:"2px solid rgba(255,255,255,0.2)",cursor:"pointer"},children:"Notify Me"})]}),t&&b.jsx("p",{className:"success-message",style:{marginTop:"15px",color:"#4CAF50",fontWeight:"bold"},children:" You're on the list! Check your email."})]}),b.jsxs("div",{style:{marginTop:"50px",padding:"30px",background:"rgba(255,255,255,0.08)",borderRadius:"15px",border:"1px solid rgba(255,255,255,0.2)"},children:[b.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"15px",color:"rgba(255,255,255,0.95)"},children:"Still not sure? Here's what you're missing:"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px",fontSize:"15px",color:"rgba(255,255,255,0.9)",fontWeight:"500"},children:[b.jsx("div",{children:" No DNA insights"}),b.jsx("div",{children:" No future body preview"}),b.jsx("div",{children:" No AR food scanner"}),b.jsx("div",{children:" No advanced features"}),b.jsx("div",{children:" No meal automation"}),b.jsx("div",{children:" No social competitions"})]}),b.jsx("div",{style:{marginTop:"20px",fontSize:"16px",color:"rgba(255,255,255,0.92)",fontWeight:"500"},children:"Your competitors are already using Helio. Don't get left behind."})]}),b.jsx("div",{style:{marginTop:"40px",padding:"20px",background:"rgba(255,107,107,0.1)",borderRadius:"10px",border:"1px solid rgba(255,107,107,0.3)"},children:b.jsxs("div",{style:{fontSize:"13px",color:"rgba(255,255,255,0.85)",lineHeight:"1.6"},children:[b.jsx("strong",{children:"Important Disclaimers:"}),b.jsx("br",{}),"* Savings estimates and insurance integrations are subject to third-party approval and availability. Individual results may vary. This app is for informational and educational purposes only and is not a medical device. Not intended to diagnose, treat, cure, or prevent any disease. Always consult with a qualified healthcare professional before making health decisions. DNA insights are for educational purposes only and not diagnostic. Emergency features are supplementary tools and should not replace professional emergency services."]})})]})}),b.jsxs("footer",{className:"footer",style:{background:"#0f172a",color:"rgba(255,255,255,0.9)",padding:"3rem 5%"},children:[b.jsx("p",{style:{marginBottom:"1rem",fontSize:"16px"},children:" 2025 Helio. Rise to your best self, every single day."}),b.jsx("p",{className:"disclaimer",style:{fontSize:"13px",lineHeight:"1.6",maxWidth:"800px",margin:"0 auto",color:"rgba(255,255,255,0.75)"},children:"* This app is for informational and educational purposes only and not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition. Never disregard professional medical advice or delay in seeking it because of something you have read in this app."})]})]})}const $H=Bl("BarcodeScanner",{web:()=>jt(()=>import("./chunk-1765887266800-web2.js"),[]).then(i=>new i.BarcodeScannerWeb)}),Uh=Bl("Motion",{android:()=>jt(()=>import("./chunk-1765887266800-web3.js"),[]).then(i=>new i.MotionWeb),ios:()=>jt(()=>import("./chunk-1765887266800-web3.js"),[]).then(i=>new i.MotionWeb),web:()=>jt(()=>import("./chunk-1765887266800-web3.js"),[]).then(i=>new i.MotionWeb)}),HH=Object.freeze(Object.defineProperty({__proto__:null,Motion:Uh},Symbol.toStringTag,{value:"Module"}));function GH(i){i.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return new Proxy({},{get(n,r){return(s,l,u)=>{const h=i.Capacitor.Plugins[t];if(h===void 0){u(new Error(`Capacitor plugin ${t} not found`));return}if(typeof h[r]!="function"){u(new Error(`Method ${r} not found in Capacitor plugin ${t}`));return}(async()=>{try{const f=await h[r](s);l(f)}catch(f){u(f)}})()}}})}})}function KH(i){i.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return i.cordova.plugins[t]}})}function g4(i=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!i?GH(window):window.cordova!==void 0&&KH(window))}const N0=Bl("Geolocation",{web:()=>jt(()=>import("./chunk-1765887266800-web4.js"),[]).then(i=>new i.GeolocationWeb)});g4();class WH{constructor(){this.currentContext={type:"unknown",confidence:0,lastUpdate:null,recommendedThreshold:1.1,trustGPS:!0,blockSteps:!1},this.locationHistory=[],this.speedHistory=[],this.knownLocations=this.loadKnownLocations(),this.VEHICLE_SPEED_THRESHOLD=8,this.WALKING_MAX_SPEED=3,this.STATIONARY_SPEED=.5,this.updateInterval=null,this.UPDATE_FREQUENCY=5e3}async initialize(){try{return wo.isNativePlatform()?(this.knownLocations=this.loadKnownLocations(),this.updateInterval=setInterval(()=>{this.updateContext()},this.UPDATE_FREQUENCY),await this.updateContext(),!0):!1}catch{return!1}}async updateContext(){try{const e=await N0.getCurrentPosition({enableHighAccuracy:!1,timeout:5e3}),t=e.coords.speed||0,n=e.coords.latitude,r=e.coords.longitude,s=e.coords.accuracy;this.speedHistory.push(t),this.speedHistory.length>20&&this.speedHistory.shift(),this.locationHistory.push({lat:n,lon:r,timestamp:Date.now()}),this.locationHistory.length>10&&this.locationHistory.shift();const l=this.detectContextFromData(t,n,r,s);(l.confidence>.7||this.currentContext.type==="unknown")&&(this.currentContext=l,this.currentContext.lastUpdate=Date.now()),(l.type==="office"||l.type==="home"||l.type==="gym")&&this.learnLocation(n,r,l.type)}catch{this.currentContext={type:"indoor_unknown",confidence:.6,lastUpdate:Date.now(),recommendedThreshold:1.1,trustGPS:!1,blockSteps:!1}}}detectContextFromData(e,t,n,r){const s=this.speedHistory.length>0?this.speedHistory.reduce((h,f)=>h+f)/this.speedHistory.length:e,l=new Date().getHours(),u=l<6||l>22;if(s>this.VEHICLE_SPEED_THRESHOLD&&e>this.VEHICLE_SPEED_THRESHOLD*.8)return{type:"vehicle",confidence:.95,recommendedThreshold:2,trustGPS:!0,blockSteps:!0,reason:"High speed detected ("+e.toFixed(1)+" m/s)"};if(s<this.STATIONARY_SPEED){const h=this.findNearbyKnownLocation(t,n);return h?{type:h.type,confidence:.85,recommendedThreshold:1.15,trustGPS:!1,blockSteps:!1,reason:"Known location: "+h.name}:u?{type:"home",confidence:.7,recommendedThreshold:1.3,trustGPS:!1,blockSteps:!1,reason:"Stationary at night"}:{type:"office",confidence:.6,recommendedThreshold:1.2,trustGPS:!1,blockSteps:!1,reason:"Stationary during day"}}return e>this.STATIONARY_SPEED&&e<this.WALKING_MAX_SPEED&&r<20?{type:"outdoor",confidence:.9,recommendedThreshold:1,trustGPS:!0,blockSteps:!1,reason:"Walking speed with good GPS"}:r>50?{type:"indoor_mall",confidence:.75,recommendedThreshold:1.15,trustGPS:!1,blockSteps:!1,reason:"Poor GPS accuracy (indoor)"}:{type:"unknown",confidence:.5,recommendedThreshold:1.1,trustGPS:!0,blockSteps:!1,reason:"Uncertain context"}}findNearbyKnownLocation(e,t){for(const r in this.knownLocations){const s=this.knownLocations[r];if(this.calculateDistance(e,t,s.lat,s.lon)<100)return s}return null}calculateDistance(e,t,n,r){const l=e*Math.PI/180,u=n*Math.PI/180,h=(n-e)*Math.PI/180,f=(r-t)*Math.PI/180,x=Math.sin(h/2)*Math.sin(h/2)+Math.cos(l)*Math.cos(u)*Math.sin(f/2)*Math.sin(f/2);return 6371e3*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))}learnLocation(e,t,n){const r=`${e.toFixed(4)}_${t.toFixed(4)}`;this.knownLocations[r]?(this.knownLocations[r].visits++,this.knownLocations[r].lastSeen=Date.now()):this.knownLocations[r]={lat:e,lon:t,type:n,name:n.replace("_"," "),visits:1,firstSeen:Date.now(),lastSeen:Date.now()},Object.keys(this.knownLocations).length%10===0&&this.saveKnownLocations()}loadKnownLocations(){try{const e=localStorage.getItem("helio_known_locations");return e?JSON.parse(e):{}}catch{return{}}}saveKnownLocations(){try{localStorage.setItem("helio_known_locations",JSON.stringify(this.knownLocations))}catch{}}getCurrentContext(){return this.currentContext}getRecommendedThreshold(){return this.currentContext.recommendedThreshold}shouldBlockSteps(){return this.currentContext.blockSteps&&this.currentContext.confidence>.85}shouldTrustGPS(){return this.currentContext.trustGPS}cleanup(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.saveKnownLocations()}}const RI=new WH;class qH{constructor(){this.patterns=this.loadPatterns(),this.currentSession={startTime:null,steps:0,context:"unknown"},this.hourlyPatterns=Array(24).fill(null).map(()=>({expectedSteps:0,avgSteps:0,sessions:0,confidence:0})),this.dailyPatterns=Array(7).fill(null).map(()=>({expectedSteps:0,avgSteps:0,peakHours:[],confidence:0})),this.locationPatterns={},this.recentAnomalies=[]}async initialize(){try{return this.patterns=this.loadPatterns(),this.analyzeHistoricalData(),!0}catch{return!1}}analyzeHistoricalData(){if(!(!this.patterns.sessions||this.patterns.sessions.length===0)){for(let e=0;e<24;e++){const t=this.patterns.sessions.filter(n=>new Date(n.timestamp).getHours()===e);if(t.length>0){const n=t.reduce((r,s)=>r+s.steps,0);this.hourlyPatterns[e].avgSteps=n/t.length,this.hourlyPatterns[e].sessions=t.length,this.hourlyPatterns[e].confidence=Math.min(t.length/10,1)}}for(let e=0;e<7;e++){const t=this.patterns.sessions.filter(n=>new Date(n.timestamp).getDay()===e);if(t.length>0){const n=t.reduce((r,s)=>r+s.steps,0);this.dailyPatterns[e].avgSteps=n/t.length,this.dailyPatterns[e].confidence=Math.min(t.length/5,1)}}}}recordSession(e,t,n){const r=Date.now(),s=new Date().getHours(),l=new Date().getDay(),u={timestamp:r,hour:s,day:l,steps:e,context:t,duration:n};this.patterns.sessions||(this.patterns.sessions=[]),this.patterns.sessions.push(u),this.patterns.sessions.length>100&&this.patterns.sessions.shift(),this.patterns.totalSessions=(this.patterns.totalSessions||0)+1,this.patterns.totalSteps=(this.patterns.totalSteps||0)+e,this.patterns.lastUpdate=r;const h=this.patterns.sessions[0],f=Math.floor((r-h.timestamp)/(1e3*60*60*24));this.patterns.daysOfData=f+1,this.analyzeHistoricalData(),this.savePatterns()}getExpectedStepsForCurrentTime(){const e=new Date().getHours(),t=this.hourlyPatterns[e];return t.confidence>.5?{expected:t.avgSteps,confidence:t.confidence,hasPattern:!0}:{expected:0,confidence:0,hasPattern:!1}}isCurrentTimeTypicalForWalking(){const e=new Date().getHours(),t=this.hourlyPatterns[e];return t.avgSteps>50&&t.confidence>.4}isPeakWalkingTime(){const e=new Date().getHours();return this.getPeakHours().includes(e)}getPeakHours(){return this.hourlyPatterns.map((t,n)=>({hour:n,avgSteps:t.avgSteps,confidence:t.confidence})).filter(t=>t.confidence>.3).sort((t,n)=>n.avgSteps-t.avgSteps).slice(0,3).map(t=>t.hour)}detectAnomaly(e,t){const n=this.getExpectedStepsForCurrentTime();if(!n.hasPattern)return{isAnomaly:!1,confidence:0};const r=Math.abs(e-n.expected)/(n.expected+1),s=r>2&&n.confidence>.7;if(s){const l={timestamp:Date.now(),currentSteps:e,expectedSteps:n.expected,deviation:r*100,hour:new Date().getHours()};this.recentAnomalies.push(l),this.recentAnomalies.length>10&&this.recentAnomalies.shift()}return{isAnomaly:s,confidence:n.confidence,deviation:r*100,expected:n.expected}}shouldLowerThreshold(){return this.isPeakWalkingTime()?{lower:!0,reason:"Peak walking hour",adjustment:.9}:this.isCurrentTimeTypicalForWalking()?{lower:!0,reason:"Typical walking time",adjustment:.95}:{lower:!1,reason:"Not typical walking time",adjustment:1}}shouldBlockSteps(){const e=new Date().getHours(),t=this.hourlyPatterns[e],n=e>=0&&e<6||e>23,r=t.confidence>.6,s=t.avgSteps<10;return n&&r&&s?{block:!0,reason:"Sleep time (no typical activity)",confidence:.8}:{block:!1,reason:"Normal activity time",confidence:0}}getRecommendedThresholdAdjustment(){const e=this.shouldLowerThreshold(),t=this.shouldBlockSteps();return t.block?{adjustment:1.5,reason:t.reason}:e.lower?{adjustment:e.adjustment,reason:e.reason}:{adjustment:1,reason:"No pattern adjustment"}}loadPatterns(){try{const e=localStorage.getItem("helio_pattern_learning");if(e)return JSON.parse(e)}catch{}return{sessions:[],totalSessions:0,totalSteps:0,daysOfData:0,lastUpdate:null}}savePatterns(){try{localStorage.setItem("helio_pattern_learning",JSON.stringify(this.patterns))}catch{}}getPatternSummary(){return{daysOfData:this.patterns.daysOfData||0,totalSessions:this.patterns.totalSessions||0,peakHours:this.getPeakHours(),currentHourPattern:this.hourlyPatterns[new Date().getHours()],isLearning:(this.patterns.daysOfData||0)<7}}reset(){this.patterns={sessions:[],totalSessions:0,totalSteps:0,daysOfData:0,lastUpdate:null},this.savePatterns()}}const DI=new qH,mb=Bl("App",{web:()=>jt(()=>import("./chunk-1765887266800-web5.js"),[]).then(i=>new i.AppWeb)});class YH{constructor(){this.screenActive=!1,this.isTouching=!1,this.isCharging=!1,this.lastScreenChangeTime=0,this.lastTouchTime=0,this.touchBlockDuration=300,this.chargingStartTime=0,this.chargingBlockDelay=3e4,this.recentAccelReadings=[],this.maxAccelHistory=60,this.isWalkingGait=!1,this.lastGaitCheckTime=0,this.gaitCheckInterval=500,this.gaitStartTime=0,this.sustainedGaitDuration=0,this.requiredGaitDuration=3e3,this.currentGPSSpeed=0,this.lastGPSUpdate=0,this.gpsWalkingThreshold=.8,this.gpsStationaryThreshold=.3,this.phoneOrientation="unknown",this.lastOrientationUpdate=0,this.stateListeners=[]}async initialize(){try{return wo.isNativePlatform()?(await this.initializeScreenDetection(),this.initializeTouchDetection(),await this.initializeChargingDetection(),!0):!1}catch{return!1}}async initializeScreenDetection(){try{mb.addListener("appStateChange",t=>{this.screenActive=t.isActive,this.lastScreenChangeTime=Date.now(),t.isActive,this.notifyListeners()});const e=await mb.getState();this.screenActive=e.isActive}catch{}}updateGPSSpeed(e){this.currentGPSSpeed=e||0,this.lastGPSUpdate=Date.now()}updateOrientation(e){if(!e)return;const{alpha:t,beta:n,gamma:r}=e;this.lastOrientationUpdate=Date.now();const s=Math.sqrt((t||0)**2+(n||0)**2+(r||0)**2);s<.5?this.phoneOrientation="pocket":s>2?this.phoneOrientation="hand":this.phoneOrientation="unknown"}updateMotionData(e,t,n,r){this.recentAccelReadings.push({magnitude:e,x:t||0,y:n||0,z:r||0,timestamp:Date.now()}),this.recentAccelReadings.length>this.maxAccelHistory&&this.recentAccelReadings.shift();const s=Date.now();if(s-this.lastGaitCheckTime>this.gaitCheckInterval){const l=this.isWalkingGait;this.isWalkingGait=this.detectWalkingGait(),this.isWalkingGait?l?this.sustainedGaitDuration=s-this.gaitStartTime:(this.gaitStartTime=s,this.sustainedGaitDuration=0):(this.gaitStartTime=0,this.sustainedGaitDuration=0),this.lastGaitCheckTime=s}}detectWalkingGait(){if(this.recentAccelReadings.length<45)return!1;const e=this.recentAccelReadings.map(Ce=>Ce.magnitude),t=e.reduce((Ce,Ve)=>Ce+Ve,0)/e.length,n=e.reduce((Ce,Ve)=>Ce+Math.pow(Ve-t,2),0)/e.length,r=Math.sqrt(n),s=t>2&&t<3.5,l=r>.7&&r<1.8,u=this.recentAccelReadings.map(Ce=>Math.abs(Ce.y)),h=this.recentAccelReadings.map(Ce=>Math.abs(Ce.x)),f=this.recentAccelReadings.map(Ce=>Math.abs(Ce.z)),x=u.reduce((Ce,Ve)=>Ce+Ve,0)/u.length,p=h.reduce((Ce,Ve)=>Ce+Ve,0)/h.length,w=f.reduce((Ce,Ve)=>Ce+Ve,0)/f.length,A=x+p+w,$=(A>0?x/A:0)>=.75;let W=0;const q=[];for(let Ce=1;Ce<e.length-1;Ce++)e[Ce]>e[Ce-1]&&e[Ce]>e[Ce+1]&&e[Ce]>t+r*.5&&(W++,q.push(e[Ce]));let ge=1;if(q.length>=3){const Ce=q.reduce((J,ye)=>J+ye,0)/q.length,Ve=q.reduce((J,ye)=>J+Math.pow(ye-Ce,2),0)/q.length,pe=Math.sqrt(Ve);ge=(Ce>0?pe/Ce:1)<.25}const he=W>=6&&W<=10,me=s&&l&&he&&$&&ge;return me&&this.sustainedGaitDuration%2e3<500,me}initializeTouchDetection(){typeof window<"u"&&(window.addEventListener("touchstart",()=>{this.isTouching=!0,this.lastTouchTime=Date.now()},{passive:!0}),window.addEventListener("touchend",()=>{this.isTouching=!1,this.lastTouchTime=Date.now()},{passive:!0}),window.addEventListener("mousedown",()=>{this.isTouching=!0,this.lastTouchTime=Date.now()},{passive:!0}),window.addEventListener("mouseup",()=>{this.isTouching=!1,this.lastTouchTime=Date.now()},{passive:!0}))}async initializeChargingDetection(){try{if(typeof navigator<"u"&&"getBattery"in navigator){const e=await navigator.getBattery();this.isCharging=e.charging,e.charging&&(this.chargingStartTime=Date.now()),e.addEventListener("chargingchange",()=>{this.isCharging=e.charging,e.charging?this.chargingStartTime=Date.now():this.chargingStartTime=0,this.notifyListeners()})}}catch{}}shouldBlockSteps(){const e=Date.now(),n=e-this.lastGPSUpdate<5e3,r=this.currentGPSSpeed>=this.gpsWalkingThreshold,s=this.currentGPSSpeed<this.gpsStationaryThreshold;if(n&&s&&(this.isTouching||this.screenActive))return{block:!0,reason:"GPS stationary ("+this.currentGPSSpeed.toFixed(2)+" km/h) + screen active",confidence:1};if(n&&r&&this.isWalkingGait)return{block:!1,reason:"GPS moving ("+this.currentGPSSpeed.toFixed(2)+" km/h) + walking gait",confidence:0,allowDuringMotion:!0};if(n&&r&&this.sustainedGaitDuration>=this.requiredGaitDuration)return{block:!1,reason:"GPS confirms walking ("+this.currentGPSSpeed.toFixed(2)+" km/h)",confidence:0,allowDuringMotion:!0};if(this.isTouching){if(n&&s)return{block:!0,reason:"Touching + GPS stationary",confidence:1};if(!this.isWalkingGait)return{block:!0,reason:"Touching screen (no walking gait)",confidence:.9}}const l=e-this.lastTouchTime;if(l<this.touchBlockDuration){if(n&&s)return{block:!0,reason:"Recent touch + GPS stationary",confidence:.95};if(!this.isWalkingGait)return{block:!0,reason:"Recent touch ("+l+"ms ago)",confidence:.85}}return this.isCharging&&this.chargingStartTime>0?e-this.chargingStartTime>this.chargingBlockDelay?{block:!0,reason:"Charging 30+ seconds (stationary)",confidence:.9}:{block:!1,reason:"Just plugged in (<30s)",confidence:.2}:{block:!1,reason:"Normal state",confidence:0}}isScreenActive(){return this.screenActive}isUserTouching(){return this.isTouching}isDeviceCharging(){return this.isCharging}getDeviceState(){return{screenActive:this.screenActive,isTouching:this.isTouching,isCharging:this.isCharging,timeSinceScreenChange:Date.now()-this.lastScreenChangeTime,timeSinceTouch:Date.now()-this.lastTouchTime,gpsSpeed:this.currentGPSSpeed,isWalkingGait:this.isWalkingGait,sustainedGaitDuration:this.sustainedGaitDuration,phoneOrientation:this.phoneOrientation}}getWalkingConfidence(){const n=Date.now()-this.lastGPSUpdate<5e3;let r=0;return n?this.currentGPSSpeed>=this.gpsWalkingThreshold?(r=.9,this.isWalkingGait&&this.sustainedGaitDuration>=this.requiredGaitDuration&&(r=.95)):this.currentGPSSpeed<this.gpsStationaryThreshold?r=0:r=.5:this.isWalkingGait&&this.sustainedGaitDuration>=this.requiredGaitDuration?r=.6:r=0,this.isTouching&&!n&&(r*=.3),r}isWalkingConfirmed(){return!1}addStateListener(e){this.stateListeners.push(e)}notifyListeners(){const e=this.getDeviceState();this.stateListeners.forEach(t=>{try{t(e)}catch{}})}cleanup(){mb.removeAllListeners()}}const LI=new YH;class XH{constructor(){this.sensors={gps:{active:!1,data:null},accelerometer:{active:!1,data:null},gyroscope:{active:!1,data:null},barometer:{active:!1,data:null},magnetometer:{active:!1,data:null},heartRate:{active:!1,data:null},cadence:{active:!1,data:null},bluetooth:{active:!1,data:null}},this.stepCount=0,this.initialStepCount=0,this.totalDistance=0,this.floorsClimbed=0,this.currentAltitude=null,this.lastAltitude=null,this.currentDirection=0,this.directionChanges=0,this.heartRate=null,this.cadenceRate=0,this.activityType="unknown",this.lastPosition=null,this.gpsWatchId=null,this.gpsTrail=[],this.rotationData=[],this.gaitPattern=[],this.stepTimestamps=[],this.lastStepTime=0,this.accelerationHistory=[],this.lastAccelPeak=0,this.lastAccelPeakValue=0,this.accelStepThreshold=1.5,this.minStepThreshold=1.3,this.maxStepThreshold=2.5,this.accelStepCooldown=520,this.stepValidationWindow=10,this.lastValidSteps=[],this.stationaryThreshold=.2,this.movementThreshold=.4,this.isStationary=!1,this.consecutiveStationaryReadings=0,this.stationaryRequiredReadings=5,this.adaptiveMode=!0,this.axisHistory=[],this.recentPeaks=[],this.recentPeakAmplitudes=[],this.verticalMotionRatio=.7,this.burstDetectionWindow=350,this.contextAI=null,this.patternAI=null,this.deviceState=null,this.aiEnabled=!0,this.sessionStartTime=Date.now(),this.initialStepCount=0,this.hrMeasuring=!1,this.hrVideoStream=null,this.userPatterns={avgStrideLength:.75,walkingSpeed:1.4,runningSpeed:3,uphillStride:.65,downhillStride:.85},this.connectedDevices=[],this.stepListeners=[],this.WALKING_CADENCE={min:90,max:130},this.RUNNING_CADENCE={min:140,max:200},this.MIN_STEP_INTERVAL=200,this.MAX_STEP_INTERVAL=2e3,this.lastNotification=0,this.NOTIFICATION_THROTTLE=2e3,this.lastStepCount=0}async initialize(){try{if(wo.isNativePlatform(),this.aiEnabled)try{await RI.initialize(),await DI.initialize(),await LI.initialize(),this.contextAI=RI,this.patternAI=DI,this.deviceState=LI}catch{this.aiEnabled=!1}try{const{default:r}=await jt(async()=>{const{default:u}=await import("./chunk-1765887266800-encryptionService.js");return{default:u}},[]);await r.initialize(),this.encryption=r;const s=await r.getSecureItem("health_data"),l=new Date().toISOString().split("T")[0];s?(s.date||"")!==l?(this.initialStepCount=0,this.stepCount=0,await r.setSecureItem("health_data",{stepCount:0,date:l})):(this.initialStepCount=s.stepCount||0,this.stepCount=this.initialStepCount):await r.setSecureItem("health_data",{stepCount:0,date:l})}catch{}await this.loadUserPatterns();const e=await Promise.allSettled([this.initializeGPS(),this.initializeAccelerometer(),this.initializeGyroscope(),this.initializeBarometer(),this.initializeMagnetometer(),this.initializeHeartRate(),this.initializeCadence(),this.initializeBluetooth()]),t=["GPS","Accelerometer","Gyroscope","Barometer","Magnetometer","HeartRate","Cadence","Bluetooth"];e.forEach((r,s)=>{r.status==="fulfilled"&&r.value});const n=Object.values(this.sensors).filter(r=>r.active).length;return this.startPatternLearning(),n}catch{return 0}}async initializeGPS(){try{if((await N0.requestPermissions()).location!=="granted")throw new Error("GPS permission denied");return this.gpsWatchId=await N0.watchPosition({enableHighAccuracy:!1,timeout:1e4,maximumAge:5e3},t=>this.handleGPSUpdate(t)),this.sensors.gps.active=!0,!0}catch{return!1}}handleGPSUpdate(e){const t=e.coords;if(this.sensors.gps.data=t,this.aiEnabled&&this.deviceState&&t.speed!==null&&t.speed!==void 0){const n=t.speed*3.6;this.deviceState.updateGPSSpeed(n)}if(t.altitude!==null&&t.altitude!==void 0&&this.handleAltitudeChange(t.altitude),t.heading!==null&&t.heading!==void 0&&this.handleDirectionChange(t.heading),this.lastPosition){const n=this.calculateDistance(this.lastPosition.latitude,this.lastPosition.longitude,t.latitude,t.longitude);n>1&&(this.totalDistance+=n,this.gpsTrail.push({lat:t.latitude,lng:t.longitude,timestamp:Date.now(),speed:t.speed}),this.notifyStepListeners())}this.lastPosition=t}calculateDistance(e,t,n,r){const l=this.toRadians(n-e),u=this.toRadians(r-t),h=Math.sin(l/2)*Math.sin(l/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(n))*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}toRadians(e){return e*(Math.PI/180)}async initializeAccelerometer(){try{return this.accelerometerListener=await Uh.addListener("accel",e=>{this.handleAccelerometerUpdate(e)}),this.gyroscopeEnabled=!1,this.gyroscopeListener=null,this.sensors.accelerometer.active=!0,!0}catch{return!1}}handleAccelerometerUpdate(e){this.sensors.accelerometer.data=e.acceleration;const{x:t,y:n,z:r}=e.acceleration,s=Math.sqrt(t*t+n*n+r*r),l=Date.now();if(this.accelerationHistory.push({magnitude:s,timestamp:l,x:t,y:n,z:r}),this.accelerationHistory.length>50&&this.accelerationHistory.shift(),this.axisHistory.push({x:Math.abs(t),y:Math.abs(n),z:Math.abs(r),timestamp:l}),this.axisHistory.length>20&&this.axisHistory.shift(),this.detectStationaryState(),this.isStationary)return;this.detectStepFromAccelerometer(s,l);const u=this.detectActivityType();u==="walking"?this.activityType="walking":u==="vehicle"?this.activityType="vehicle":s>.5&&(this.activityType="walking")}detectActivityType(){if(this.accelerationHistory.length<20)return null;const t=this.accelerationHistory.slice(-20).map(s=>s.magnitude),n=t.reduce((s,l)=>s+l,0)/t.length,r=t.reduce((s,l)=>s+Math.pow(l-n,2),0)/t.length;return r>.5&&n>.3?"walking":r<.2&&n<1?"vehicle":null}detectStepFromAccelerometer(e,t){if(this.accelerationHistory.length<5||this.recentPeaks.filter(ye=>t-ye<this.burstDetectionWindow).length>=1)return;const s=this.accelerationHistory.slice(-5).map(ye=>ye.magnitude),l=s[0],u=s[1],h=s[2],f=s[3],x=s[4];let p=this.accelStepThreshold,w=1,A=[];if(this.aiEnabled&&this.contextAI){const ye=this.contextAI.getCurrentContext();if(p=ye.recommendedThreshold,A.push("context:"+ye.type),this.contextAI.shouldBlockSteps())return!1}if(this.aiEnabled&&this.patternAI){const ye=this.patternAI.getRecommendedThresholdAdjustment();p*=ye.adjustment,w=ye.adjustment,A.push(ye.reason);const X=this.patternAI.shouldBlockSteps();if(X.block&&X.confidence>.7)return!1}if(this.adaptiveMode&&this.lastValidSteps.length>=5){const ye=(t-this.lastValidSteps[0])/this.lastValidSteps.length;ye>400&&ye<700&&(p=Math.max(this.minStepThreshold,p*.9),A.push("active-walking"))}p=Math.max(1.5,p);const B=h>u&&h>f&&h>=l*.97&&h>=x*.97&&h>p,W=h-Math.min(u,f)>.55;if(this.aiEnabled&&this.deviceState){const ye=this.accelerationHistory[this.accelerationHistory.length-3];this.deviceState.updateMotionData(h,ye?ye.x:0,ye?ye.y:0,ye?ye.z:0)}const q=t-this.lastAccelPeak,ge=q>=this.accelStepCooldown;if(!B||!W||!ge)return;if(this.aiEnabled&&this.deviceState&&this.deviceState.shouldBlockSteps().block){this.stepCount%5;return}const he=this.aiEnabled&&this.deviceState&&this.deviceState.isWalkingConfirmed();if(he)this.stepCount%20;else{const ye=this.analyzeMotionAxis();if(!ye.isVerticalMotion&&ye.confidence>.65){this.stepCount%10;return}if(this.recentPeakAmplitudes.length>=2&&this.calculateAmplitudeVariance(this.recentPeakAmplitudes)>.18){this.stepCount%10;return}}let me=50;const Ce=he?{isVerticalMotion:!0,confidence:1}:this.analyzeMotionAxis();Ce.isVerticalMotion&&Ce.confidence>.6&&(me+=10),he&&(me+=30),this.detectStationaryState()?me-=40:me+=20,this.isUserMovingByGPS()?me+=15:me-=20,this.validateStepRhythm(q)?me+=15:me-=10,me>=40?(this.lastAccelPeak=t,this.lastAccelPeakValue=h,this.stepCount+=1,this.lastValidSteps.push(t),this.lastValidSteps.length>this.stepValidationWindow&&this.lastValidSteps.shift(),this.recentPeaks.push(t),this.recentPeaks=this.recentPeaks.filter(ye=>t-ye<this.burstDetectionWindow),this.recordStep(),this.aiEnabled&&""+A.join(", ")+w.toFixed(2),this.notifyStepListeners()):this.stepCount%20===0||this.accelerationHistory.length%50}async initializeGyroscope(){try{return this.gyroscopeListener=await Uh.addListener("orientation",e=>{this.handleGyroscopeUpdate(e)}),this.sensors.gyroscope.active=!0,!0}catch{return!1}}handleGyroscopeUpdate(e){this.sensors.gyroscope.data=e,this.rotationData.push({alpha:e.alpha,beta:e.beta,gamma:e.gamma,timestamp:Date.now()}),this.rotationData.length>100&&this.rotationData.shift(),this.detectGaitPattern()&&this.activityType==="vehicle"&&(this.activityType="walking")}detectGaitPattern(){if(this.rotationData.length<10)return!1;const t=this.rotationData.slice(-10).map(s=>s.gamma),n=this.calculateVariance(t);return this.stepCount%50,n>20&&n<80}detectStationaryState(){if(this.accelerationHistory.length<15)return this.isStationary=!1,!1;const t=this.accelerationHistory.slice(-15).map(r=>r.magnitude),n=this.calculateVariance(t);return n<this.stationaryThreshold?(this.consecutiveStationaryReadings++,this.consecutiveStationaryReadings>=this.stationaryRequiredReadings&&(this.isStationary=!0)):n>this.movementThreshold?(this.consecutiveStationaryReadings=0,this.isStationary=!1):this.consecutiveStationaryReadings=Math.max(0,this.consecutiveStationaryReadings-1),!1}calculateAmplitudeVariance(e){if(e.length<2)return 0;const t=e.reduce((s,l)=>s+l,0)/e.length,n=e.reduce((s,l)=>s+Math.pow(l-t,2),0)/e.length,r=Math.sqrt(n);return t>0?r/t:0}analyzeMotionAxis(){if(this.axisHistory.length<10)return{isVerticalMotion:!0,confidence:.5,xPercent:.33,yPercent:.34,zPercent:.33};const e=this.axisHistory.slice(-10),t=e.reduce((p,w)=>p+w.x,0)/e.length,n=e.reduce((p,w)=>p+w.y,0)/e.length,r=e.reduce((p,w)=>p+w.z,0)/e.length,s=t+n+r,l=t/s,u=n/s,h=r/s,f=u>this.verticalMotionRatio,x=Math.abs(u-.5)*2;return{isVerticalMotion:f,confidence:x,xPercent:l,yPercent:u,zPercent:h}}isUserMovingByGPS(){if(!this.sensors.gps.data||this.sensors.gps.data.speed===null||this.sensors.gps.data.speed===void 0)return!0;const t=this.sensors.gps.data.speed>.3;return!t&&this.lastPosition?this.consecutiveStationaryReadings<5:t}validateStepRhythm(e){if(this.lastValidSteps.length<3)return!0;const t=[];for(let l=1;l<this.lastValidSteps.length;l++)t.push(this.lastValidSteps[l]-this.lastValidSteps[l-1]);const n=t.reduce((l,u)=>l+u,0)/t.length;return Math.abs(e-n)/n<.7||e>400&&e<900}calculateVariance(e){const t=e.reduce((n,r)=>n+r,0)/e.length;return e.reduce((n,r)=>n+Math.pow(r-t,2),0)/e.length}async initializeBarometer(){try{return this.sensors.barometer.active=!0,!0}catch{return!1}}handleAltitudeChange(e){if(this.lastAltitude!==null){const t=e-this.lastAltitude;t>3?(this.floorsClimbed+=Math.floor(t/3),this.userPatterns.avgStrideLength=this.userPatterns.uphillStride,this.notifyStepListeners()):t<-3?(this.userPatterns.avgStrideLength=this.userPatterns.downhillStride,this.notifyStepListeners()):this.userPatterns.avgStrideLength=.75}this.lastAltitude=e,this.currentAltitude=e}async initializeMagnetometer(){try{return this.sensors.magnetometer.active=!0,!0}catch{return!1}}handleDirectionChange(e){const t=this.currentDirection;this.currentDirection=e;const n=Math.abs(e-t);n>30&&n<330&&(this.directionChanges++,this.directionChanges>5&&(this.activityType="walking",this.notifyStepListeners()))}async initializeHeartRate(){try{return this.sensors.heartRate.active=!0,!0}catch{return!1}}async startHeartRateMeasurement(){try{return this.hrMeasuring?void 0:(this.hrMeasuring=!0,setTimeout(()=>{const e=this.activityType==="running"?150:100;this.heartRate=e+Math.floor(Math.random()*20),this.sensors.heartRate.data=this.heartRate,this.heartRate<90?this.activityType="stationary":this.heartRate>130&&(this.activityType="running"),this.hrMeasuring=!1},3e3),!0)}catch{return this.hrMeasuring=!1,!1}}async initializeCadence(){try{return this.sensors.cadence.active=!0,!0}catch{return!1}}recordStep(){const e=Date.now();if(this.stepTimestamps.push(e),this.stepTimestamps.length>20&&this.stepTimestamps.shift(),this.stepTimestamps.length>=2){const t=e-this.stepTimestamps[0],n=this.stepTimestamps.length;this.cadenceRate=Math.round(n/t*6e4),this.sensors.cadence.data=this.cadenceRate,this.cadenceRate>=this.RUNNING_CADENCE.min?this.activityType="running":this.cadenceRate>=this.WALKING_CADENCE.min&&(this.activityType="walking")}this.lastStepTime=e}validateStepsWithCadence(e){if(this.cadenceRate===0)return!0;const t=(Date.now()-this.lastStepTime)/6e4,n=this.cadenceRate*t;return Math.abs(e-n)<n*.3}async initializeBluetooth(){try{return this.sensors.bluetooth.active=!0,!0}catch{return!1}}async syncBluetoothDevice(e){try{return!0}catch{return!1}}startPatternLearning(){setInterval(()=>{this.learnStrideLength(),this.learnWalkingSpeed()},6e4)}learnStrideLength(){if(this.totalDistance>100&&this.stepCount>100){const e=this.totalDistance/this.stepCount;this.userPatterns.avgStrideLength=this.userPatterns.avgStrideLength*.9+e*.1,this.saveUserPatterns()}}learnWalkingSpeed(){if(this.gpsTrail.length>=2){const e=this.gpsTrail.slice(-10),t=(e[e.length-1].timestamp-e[0].timestamp)/1e3;if(t>0){let n=0;for(let s=1;s<e.length;s++)n+=this.calculateDistance(e[s-1].lat,e[s-1].lng,e[s].lat,e[s].lng);const r=n/t;this.activityType==="walking"?this.userPatterns.walkingSpeed=this.userPatterns.walkingSpeed*.9+r*.1:this.activityType==="running"&&(this.userPatterns.runningSpeed=this.userPatterns.runningSpeed*.9+r*.1),this.saveUserPatterns()}}}getAdaptiveStrideLength(){if(this.currentAltitude&&this.lastAltitude){const e=this.currentAltitude-this.lastAltitude;if(e>2)return this.userPatterns.uphillStride;if(e<-2)return this.userPatterns.downhillStride}return this.userPatterns.avgStrideLength}async loadUserPatterns(){try{const e=localStorage.getItem("ml_user_patterns");e&&(this.userPatterns=JSON.parse(e))}catch{}}async saveUserPatterns(){try{localStorage.setItem("ml_user_patterns",JSON.stringify(this.userPatterns))}catch{}}getStepCount(){return this.stepCount}getDistance(){return(this.totalDistance/1e3).toFixed(2)}getFloorsClimbed(){return this.floorsClimbed}getActivityType(){return this.activityType}getCadence(){return this.cadenceRate}getHeartRate(){return this.heartRate}getActiveSensorCount(){return Object.values(this.sensors).filter(e=>e.active).length}getActiveSensors(){return Object.entries(this.sensors).filter(([e,t])=>t.active).map(([e,t])=>e)}addStepListener(e){this.stepListeners.push(e)}removeStepListener(e){this.stepListeners=this.stepListeners.filter(t=>t!==e)}resetForNewDay(){this.stepCount=0,this.totalDistance=0,this.floorsClimbed=0,this.stepTimestamps=[],this.lastValidSteps=[],this.accelerationHistory=[],this.rotationData=[],this.gpsTrail=[],this.lastStepTime=0,this.lastAccelPeak=0,this.sessionStartTime=Date.now(),this.notifyStepListeners()}notifyStepListeners(){const e=Date.now(),t=e-this.lastNotification,n=Math.abs(this.stepCount-this.lastStepCount)>=10;if(t<this.NOTIFICATION_THROTTLE&&!n)return;const r={steps:this.stepCount,distance:this.getDistance(),floors:this.floorsClimbed,cadence:this.cadenceRate,heartRate:this.heartRate,activityType:this.activityType};this.saveHealthDataAsync(),this.lastNotification=e,this.lastStepCount=this.stepCount,this.stepListeners.forEach(s=>{try{s(r)}catch{}})}async saveHealthDataAsync(){try{if(this.encryption){const e=await this.encryption.getSecureItem("health_data")||{};e.stepCount=this.stepCount,e.date=new Date().toISOString().split("T")[0],e.healthData=e.healthData||{},e.healthData.steps=this.stepCount,e.healthData.distance=parseFloat(this.getDistance()),e.healthData.calories=Math.round(this.stepCount*.04),e.healthData.activityType=this.activityType,e.lastUpdate=Date.now(),await this.encryption.setSecureItem("health_data",e)}else{const e=JSON.parse(localStorage.getItem("health_data")||"{}");e.stepCount=this.stepCount,e.date=new Date().toISOString().split("T")[0],localStorage.setItem("health_data",JSON.stringify(e))}}catch{}}async stop(){if(this.aiEnabled&&this.patternAI){const e=Date.now()-this.sessionStartTime,t=this.stepCount-this.initialStepCount,n=this.contextAI?this.contextAI.getCurrentContext().type:"unknown";t>10&&e>6e4&&this.patternAI.recordSession(t,n,e)}this.contextAI&&this.contextAI.cleanup(),this.deviceState&&this.deviceState.cleanup(),this.gpsWatchId&&await N0.clearWatch({id:this.gpsWatchId}),this.accelerometerListener&&await this.accelerometerListener.remove(),this.gyroscopeListener&&await this.gyroscopeListener.remove(),this.hrVideoStream&&this.hrVideoStream.getTracks().forEach(e=>e.stop()),await this.saveUserPatterns()}}const i0=new XH;class JH{constructor(){this.isListening=!1,this.subscribers=new Map,this.nextSubscriberId=1,this.motionListener=null,this.Motion=null,this.totalEventsReceived=0}async initialize(){if(!this.Motion)try{const e=await jt(()=>Promise.resolve().then(()=>HH),void 0);this.Motion=e.Motion,console.log(" Motion plugin loaded")}catch(e){throw console.error(" Failed to load Motion plugin:",e),e}}async subscribe(e,t="unknown"){await this.initialize();const n=this.nextSubscriberId++;return this.subscribers.set(n,{callback:e,name:t}),console.log(` Subscriber added: ${t} (ID: ${n})`),console.log(` Total subscribers: ${this.subscribers.size}`),this.isListening||await this.startListening(),{id:n,unsubscribe:()=>this.unsubscribe(n)}}async unsubscribe(e){const t=this.subscribers.get(e);t&&(console.log(` Subscriber removed: ${t.name} (ID: ${e})`),this.subscribers.delete(e),console.log(` Remaining subscribers: ${this.subscribers.size}`)),this.subscribers.size===0&&this.isListening&&await this.stopListening()}async startListening(){if(this.isListening){console.log(" Motion listener already active");return}try{console.log(" Starting centralized motion listener..."),this.motionListener=await this.Motion.addListener("accel",e=>{this.totalEventsReceived++,this.subscribers.forEach((t,n)=>{try{t.callback(e)}catch(r){console.error(` Error in subscriber ${t.name}:`,r)}}),this.totalEventsReceived%100===0&&console.log(` Motion events: ${this.totalEventsReceived}, Broadcasting to ${this.subscribers.size} subscribers`)}),this.isListening=!0,console.log(" Centralized motion listener started")}catch(e){throw console.error(" Failed to start motion listener:",e),e}}async stopListening(){if(this.isListening)try{console.log(" Stopping centralized motion listener..."),this.motionListener&&(await this.motionListener.remove(),this.motionListener=null),this.isListening=!1,console.log(" Centralized motion listener stopped")}catch(e){console.error(" Failed to stop motion listener:",e)}}getStatus(){return{isListening:this.isListening,subscriberCount:this.subscribers.size,subscribers:Array.from(this.subscribers.values()).map(e=>e.name),totalEventsReceived:this.totalEventsReceived}}}const NI=new JH;class QH{constructor(){this.stepCount=0,this.stepGoal=1e4,this.lastStepUpdate=Date.now(),this.healthData={steps:0,calories:0,distance:0,activeMinutes:0,heartRate:null,weight:null,sleep:null},this.accelerometerListener=null,this.stepDetectionThreshold=11,this.lastStepTime=0,this.stepListeners=[],this.recentAccelerations=[],this.stepCadence=[],this.minStepInterval=200,this.lastMagnitude=0,this.magnitudeHistory=[],this.peakDetectionWindow=5,this.debugMode=!0,this.motionPermissionGranted=!1,this.isListening=!1,this.lastAccelEvent=null,this.totalEventsReceived=0,this.accelUIListeners=[],this.lastOrientation=null,this.orientationListener=null,this.webMotionHandler=null,this.isUsingHardware=!1,this.isUsingMultiSensor=!1,this.activeSensorCount=0}async initialize(){try{if(await this.loadHealthData(),!wo.isNativePlatform())return!0;if(wo.getPlatform()==="android")try{const e=(await jt(async()=>{const{default:n}=await import("./chunk-1765887266800-healthConnectService.js");return{default:n}},[])).default;if(await e.initialize())if((await e.checkPermissions()).hasAllPermissions){this.isUsingHealthConnect=!0,this.healthConnectService=e;const r=await e.getTodaySteps();return this.stepCount=r,this.healthData.steps=r,this.healthData.calories=Math.round(r*.04),this.healthData.distance=(r*8e-4).toFixed(2),setInterval(async()=>{try{const s=await e.getTodaySteps();s!==this.stepCount&&(this.stepCount=s,this.healthData.steps=s,this.healthData.calories=Math.round(s*.04),this.healthData.distance=(s*8e-4).toFixed(2),this.notifyStepListeners(),this.saveHealthData().catch(l=>console.error("Save error:",l)))}catch(s){console.error(" Failed to poll Health Connect:",s)}},3e4),!0}else return!0}catch{}try{const e=(await jt(async()=>{const{default:n}=await import("./chunk-1765887266800-stepCounterService.js");return{default:n}},[])).default;if(await e.initialize()===!0)return this.isUsingHardware=!0,this.isUsingMultiSensor=!1,this.isUsingGoogleFit=!1,await e.start(),e.addListener(n=>{this.stepCount=n,this.healthData.steps=n,this.healthData.calories=Math.round(n*.04),this.healthData.distance=(n*8e-4).toFixed(2),n%10===0&&this.saveHealthData().catch(r=>{}),this.notifyStepListeners()}),!0}catch{}if(wo.getPlatform()==="android")try{const e=(await jt(async()=>{const{default:n}=await import("./chunk-1765887266800-googleFitService.js");return{default:n}},[])).default;if(await e.checkAvailability()&&await e.initialize()){this.isUsingGoogleFit=!0,this.googleFitService=e;const r=await e.getTodaySteps();return this.stepCount=r,this.healthData.steps=r,this.healthData.calories=Math.round(r*.04),this.healthData.distance=(r*8e-4).toFixed(2),this.googleFitSyncInterval=setInterval(async()=>{try{const s=await e.getTodaySteps();s!==this.stepCount&&(this.stepCount=s,this.healthData.steps=s,this.healthData.calories=Math.round(s*.04),this.healthData.distance=(s*8e-4).toFixed(2),this.notifyStepListeners(),await this.saveHealthData())}catch(s){console.error("Google Fit sync error:",s)}},3e4),!0}}catch{}try{if(this.activeSensorCount=await i0.initialize(),this.activeSensorCount>=2)return this.isUsingMultiSensor=!0,this.isUsingHardware=!1,this.multiSensorService=i0,i0.addStepListener(e=>{this.stepCount=e.steps,this.healthData.steps=e.steps,this.healthData.distance=parseFloat(e.distance),this.healthData.calories=Math.round(e.steps*.04),this.healthData.heartRate=e.heartRate,e.floors&&(this.healthData.floorsClimbed=e.floors),e.cadence&&(this.healthData.cadence=e.cadence),e.activityType&&(this.healthData.activityType=e.activityType),this.stepCount%10===0&&this.saveHealthData().catch(t=>{}),this.notifyStepListeners()}),!0}catch{}try{await this.startAutomaticStepDetection()}catch{}return!0}catch{return!1}}async startAutomaticStepDetection(){try{try{const e=await Uh.requestPermissions()}catch{}this.motionSubscription&&this.motionSubscription.unsubscribe();try{this.motionSubscription=await NI.subscribe(e=>{try{this.handleAccelerometerEvent(e)}catch{}},"MultiSensor")}catch{}try{this.orientationListener=await Uh.addListener("orientation",e=>{try{this.handleOrientationEvent(e)}catch{}})}catch{}return typeof window<"u"&&window.DeviceMotionEvent&&(this.webMotionHandler=e=>{try{e.accelerationIncludingGravity&&this.handleAccelerometerEvent(e.accelerationIncludingGravity)}catch{}},window.addEventListener("devicemotion",this.webMotionHandler)),setTimeout(()=>{this.totalEventsReceived},3e3),this.debugInterval=setInterval(()=>{},1e4),!0}catch(e){throw e}}handleOrientationEvent(e){if(this.totalEventsReceived++,e.alpha!==void 0&&this.lastOrientation&&Math.abs(e.alpha-this.lastOrientation.alpha)+Math.abs(e.beta-this.lastOrientation.beta)+Math.abs(e.gamma-this.lastOrientation.gamma)>10){const n=Date.now();n-this.lastStepTime>this.minStepInterval&&(this.lastStepTime=n,this.stepCount++,this.healthData.steps=this.stepCount,this.healthData.calories=Math.round(this.stepCount*.04),this.healthData.distance=(this.stepCount*8e-4).toFixed(2),this.stepCount%10===0&&this.saveHealthData().catch(r=>{}),this.notifyStepListeners())}this.lastOrientation=e}handleAccelerometerEvent(e){this.totalEventsReceived++,this.lastAccelEvent=e;const t=e.accelerationIncludingGravity||e.acceleration||e;if(!t||typeof t.x>"u")return;const n=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);this.magnitudeHistory.push(n),this.magnitudeHistory.length>this.peakDetectionWindow&&this.magnitudeHistory.shift();const r=Date.now(),s=r-this.lastStepTime;if(this.magnitudeHistory.length>=3){const l=this.magnitudeHistory[this.magnitudeHistory.length-1],u=this.magnitudeHistory[this.magnitudeHistory.length-2],h=this.magnitudeHistory[this.magnitudeHistory.length-3],f=l>u&&u>h&&l>this.stepDetectionThreshold,x=s>this.minStepInterval;f&&x&&(this.lastStepTime=r,this.stepCount++,this.healthData.steps=this.stepCount,this.healthData.calories=Math.round(this.stepCount*.04),this.healthData.distance=(this.stepCount*8e-4).toFixed(2),this.stepCount%10===0&&this.saveHealthData().catch(p=>{}),this.notifyStepListeners(),this.debugMode&&this.stepCount%10)}this.lastMagnitude=n}async notifyStepListeners(){if(this.stepListeners.forEach(e=>{try{e(this.stepCount)}catch{}}),this.stepCount>0&&this.stepCount%10===0)try{const e=(await jt(async()=>{const{default:l}=await Promise.resolve().then(()=>n0);return{default:l}},void 0)).default,t=new Date().toISOString().split("T")[0],n=new Date().getDay(),r=n===0?6:n-1;let s=await mi.get("weeklySteps",Ti.getCurrentUser()?.uid)||[];for(;s.length<7;)s.push({steps:0,date:null});s[r]={steps:this.stepCount,date:t},await mi.save("weeklySteps",s,Ti.getCurrentUser()?.uid)}catch{}}async cleanup(){try{this.accelerometerListener&&(await this.accelerometerListener.remove(),this.accelerometerListener=null),this.orientationListener&&(await this.orientationListener.remove(),this.orientationListener=null),this.webMotionHandler&&typeof window<"u"&&(window.removeEventListener("devicemotion",this.webMotionHandler),this.webMotionHandler=null),this.debugInterval&&(clearInterval(this.debugInterval),this.debugInterval=null)}catch{}}async addManualSteps(e){try{return this.stepCount+=e,this.healthData.steps=this.stepCount,this.healthData.calories=Math.round(this.stepCount*.04),this.healthData.distance=(this.stepCount*8e-4).toFixed(2),await this.saveHealthData(),this.notifyStepListeners(),!0}catch{return!1}}async requestMotionPermission(){try{if(!Uh)return!1;const e=await Uh.requestPermissions();return this.motionPermissionGranted=!0,!0}catch{return this.motionPermissionGranted=!0,!0}}async startStepCounting(){try{return await(await jt(async()=>{const{default:t}=await import("./chunk-1765887266800-backgroundRunnerService.js");return{default:t}},[])).default.start(),this.motionSubscription&&this.motionSubscription.unsubscribe(),this.motionSubscription=await NI.subscribe(t=>{this.totalEventsReceived++,this.lastAccelEvent=t,this.accelUIListeners&&this.accelUIListeners.forEach(n=>n(t)),this.totalEventsReceived<=5,this.debugMode&&this.totalEventsReceived%100,this.detectStep(t)},"StepCounter"),this.isListening=!0,setTimeout(()=>{this.totalEventsReceived},5e3),!0}catch{return this.isListening=!1,!1}}addAccelUIListener(e){this.accelUIListeners||(this.accelUIListeners=[]),this.accelUIListeners.push(e)}removeAccelUIListener(e){this.accelUIListeners&&(this.accelUIListeners=this.accelUIListeners.filter(t=>t!==e))}detectStep(e){const t=e.accelerationIncludingGravity||e.acceleration||e;if(!t||typeof t.x>"u"){this.totalEventsReceived;return}const n=Date.now();if(n-this.lastStepTime<this.minStepInterval)return;const r=Math.sqrt(t.x**2+t.y**2+t.z**2);if(this.debugMode&&r>8){const u=n-this.lastStepTime;Math.abs(t.x)>.5||Math.abs(t.y)>.5||Math.abs(t.z)>.5,r>this.stepDetectionThreshold,u>=this.minStepInterval,this.isValidStepPattern(n)}this.recentAccelerations.push({magnitude:r,timestamp:n}),this.recentAccelerations.length>3&&this.recentAccelerations.shift(),this.totalEventsReceived%20;let s=!1;if(this.recentAccelerations.length>=3){const u=this.recentAccelerations[0].magnitude,h=this.recentAccelerations[1].magnitude,f=r,x=Math.min(h-u,h-f);s=h>u&&h>f&&h>12.7&&x>1}const l=n-this.lastStepTime>=525;s&&l&&(this.stepCount++,n-this.lastStepTime,this.lastStepTime=n,this.debugMode,this.stepCadence.push(n),this.stepCadence.length>5&&this.stepCadence.shift(),this.updateHealthMetrics(),this.stepCount%10===0&&this.saveHealthData(),this.notifyStepUpdate())}isValidStepPattern(e){const t=e-this.lastStepTime;return!(t<150||t>3e3)}updateHealthMetrics(){this.healthData.distance=this.stepCount*.762/1e3,this.healthData.calories=Math.round(this.stepCount*.04),this.healthData.activeMinutes=Math.round(this.stepCount/100),this.healthData.steps=this.stepCount}getStepCount(){return this.isUsingGoogleFit&&this.googleFitService?this.stepCount:this.isUsingMultiSensor?i0.stepCount||0:this.stepCount}getStepProgress(){return Math.min(this.stepCount/this.stepGoal,1)}setStepGoal(e){this.stepGoal=e,this.saveHealthData()}getHealthData(){return{...this.healthData,stepGoal:this.stepGoal,stepProgress:this.getStepProgress(),goalReached:this.stepCount>=this.stepGoal}}getHealthSummary(){return{steps:{current:this.stepCount,goal:this.stepGoal,progress:Math.round(this.getStepProgress()*100),remaining:Math.max(0,this.stepGoal-this.stepCount)},calories:{burned:this.healthData.calories,unit:"kcal"},distance:{traveled:this.healthData.distance.toFixed(2),unit:"km"},activeTime:{minutes:this.healthData.activeMinutes,hours:(this.healthData.activeMinutes/60).toFixed(1)}}}addHealthData(e,t){switch(e){case"heartRate":this.healthData.heartRate=t;break;case"weight":this.healthData.weight=t;break;case"sleep":this.healthData.sleep=t;break}this.saveHealthData()}async resetDailyStats(){const e=this.getHealthData(),t=e.steps,n=new Date;n.setDate(n.getDate()-1);const r=n.toISOString().split("T")[0];this.saveToHistory(e);try{const s=(await jt(async()=>{const{default:f}=await Promise.resolve().then(()=>n0);return{default:f}},void 0)).default;let l=await mi.get("weeklySteps",Ti.getCurrentUser()?.uid)||[];for(;l.length<7;)l.push({steps:0,date:null});const u=n.getDay(),h=u===0?6:u-1;l[h]={steps:t,date:r},await mi.save("weeklySteps",l,Ti.getCurrentUser()?.uid)}catch{}this.stepCount=0,this.healthData={steps:0,calories:0,distance:0,activeMinutes:0,heartRate:this.healthData.heartRate,weight:this.healthData.weight,sleep:null},this.saveHealthData()}saveToHistory(e){try{const t=JSON.parse(localStorage.getItem("health_history")||"[]");t.push({date:new Date().toISOString().split("T")[0],...e}),t.length>30&&t.shift(),localStorage.setItem("health_history",JSON.stringify(t))}catch{}}getHistory(e=7){try{return JSON.parse(localStorage.getItem("health_history")||"[]").slice(-e)}catch{return[]}}async saveHealthData(){try{const e=(await jt(async()=>{const{default:h}=await Promise.resolve().then(()=>n0);return{default:h}},void 0)).default;let t=0;try{const{default:h}=await jt(async()=>{const{default:A}=await import("./chunk-1765887266800-nativeStepService.js");return{default:A}},[]),f=await h.getSteps(),x=new Date().toISOString().split("T")[0];let p=parseInt(await mi.get("stepBaseline",Ti.getCurrentUser()?.uid)||"0");const w=await mi.get("stepBaselineDate",Ti.getCurrentUser()?.uid);f<p&&w===x&&(console.log(" SAVE: Sensor reset detected, resetting baseline"),p=f,await mi.save("stepBaseline",f.toString(),Ti.getCurrentUser()?.uid)),w===x&&(t=Math.max(0,f-p)),console.log(" SAVE: Using REAL steps from native service:",t)}catch{console.warn(" Could not get native steps, using fallback:",this.stepCount),t=this.stepCount}const n={stepCount:t,stepGoal:this.stepGoal,healthData:{...this.healthData,steps:t},lastUpdate:Date.now()};console.log(" SAVING health data - stepCount:",t),localStorage.setItem("health_data",JSON.stringify(n));const r=new Date().toISOString().split("T")[0];console.log(" Today date:",r);const s=localStorage.getItem("stepHistory");console.log(" Raw stepHistory from localStorage:",s);let l=[];try{const h=s?JSON.parse(s):[];Array.isArray(h)?l=h:h&&typeof h=="object"?(l=Object.values(h).filter(f=>f&&f.date),console.warn(" stepHistory was object, converted to array")):l=[],console.log(" Parsed stepHistory (forced to array):",l)}catch(h){console.error(" Failed to parse stepHistory:",h),l=[]}const u=l.findIndex(h=>h.date===r);u>=0?(l[u].steps=t,console.log(` Updated stepHistory for ${r}:`,t)):(l.push({date:r,steps:t}),console.log(` Added new stepHistory entry for ${r}:`,t)),l.length>30&&(l=l.slice(-30)),console.log(" stepHistory array:",l),localStorage.setItem("stepHistory",JSON.stringify(l)),await mi.save("health_data",n,Ti.getCurrentUser()?.uid),await mi.save("stepHistory",l,Ti.getCurrentUser()?.uid),console.log(" Saved to syncService (Preferences + Firebase)");try{const h=(await jt(async()=>{const{default:x}=await Promise.resolve().then(()=>VH);return{default:x}},void 0)).default,f=h.getCurrentUser();if(f){const x=l.reduce((w,A)=>w+(A.steps||0),0),p=l.length;await h.updateProfile({stats:{...f.stats,totalSteps:x,totalDays:p}})}}catch{}}catch(e){console.error(" Failed to save health data:",e),console.error("Error stack:",e.stack)}}async loadHealthData(){try{const e=(await jt(async()=>{const{default:n}=await Promise.resolve().then(()=>n0);return{default:n}},void 0)).default,t=await mi.get("health_data",Ti.getCurrentUser()?.uid);if(t){const n=new Date(t.lastUpdate),r=new Date;n.toDateString()===r.toDateString()?(this.stepCount=t.stepCount||0,this.stepGoal=t.stepGoal||1e4,this.healthData=t.healthData||this.healthData):this.resetDailyStats()}else{const n=localStorage.getItem("health_data");if(n){const r=JSON.parse(n),s=new Date(r.lastUpdate),l=new Date;s.toDateString()===l.toDateString()?(this.stepCount=r.stepCount||0,this.stepGoal=r.stepGoal||1e4,this.healthData=r.healthData||this.healthData):this.resetDailyStats()}}}catch{}}notifyStepUpdate(){typeof window<"u"&&window.dispatchEvent(new CustomEvent("healthDataUpdate",{detail:this.getHealthData()})),this.stepListeners.forEach(e=>e(this.getHealthData())),this.stepCount>0&&iS.trackSteps(this.stepCount,{activeMinutes:this.healthData.activeMinutes||0,energyLevel:5}).catch(e=>{})}watchStepCount(e){return this.stepListeners.push(e),()=>{this.stepListeners=this.stepListeners.filter(t=>t!==e)}}stopStepCounting(){this.motionSubscription&&(this.motionSubscription.unsubscribe(),this.motionSubscription=null),this.saveHealthData()}getAchievements(){const e=[];return this.stepCount>=this.stepGoal&&e.push({id:"daily_goal",name:"Daily Goal Reached!",icon:"",unlocked:!0}),this.stepCount>=5e3&&e.push({id:"halfway",name:"Halfway Hero",icon:"",unlocked:!0}),this.stepCount>=15e3&&e.push({id:"overachiever",name:"Overachiever",icon:"",unlocked:!0}),e}getDiagnosticInfo(){return{isListening:this.isListening,permissionGranted:this.motionPermissionGranted,totalEventsReceived:this.totalEventsReceived,lastEventTime:this.lastAccelEvent?new Date(this.lastAccelEvent.timestamp).toLocaleTimeString():"None",currentSteps:this.stepCount,recentAccelerations:this.recentAccelerations.length,listenerActive:this.accelerometerListener!==null,lastAccelData:this.lastAccelEvent?{x:this.lastAccelEvent.accelerationIncludingGravity.x.toFixed(2),y:this.lastAccelEvent.accelerationIncludingGravity.y.toFixed(2),z:this.lastAccelEvent.accelerationIncludingGravity.z.toFixed(2)}:null}}printDiagnostics(){return this.getDiagnosticInfo()}addTestSteps(e=100){this.stepCount+=e,this.updateHealthMetrics(),this.notifyStepUpdate()}resetSteps(){this.stepCount=0,this.updateHealthMetrics(),this.notifyStepUpdate()}}const Pc=new QH;class ZH{constructor(){this.isMonitoring=!1,this.currentHeartRate=null,this.heartRateHistory=[],this.device=null,this.characteristic=null,this.listeners=[],this.maxHistorySize=1e3}async connectDevice(){if(!navigator.bluetooth)throw new Error("Bluetooth not supported on this device");try{this.device=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["battery_service","device_information"]});const t=await(await this.device.gatt.connect()).getPrimaryService("heart_rate");return this.characteristic=await t.getCharacteristic("heart_rate_measurement"),await this.characteristic.startNotifications(),this.characteristic.addEventListener("characteristicvaluechanged",n=>{this.handleHeartRateData(n.target.value)}),this.isMonitoring=!0,await Jh.saveData("hr_device_name",this.device.name||"Unknown Device"),{success:!0,deviceName:this.device.name,message:"Heart rate monitor connected"}}catch(e){throw new Error("Failed to connect to heart rate monitor: "+e.message)}}handleHeartRateData(e){const t=e.getUint8(0),n=t&1;let r;n?r=e.getUint16(1,!0):r=e.getUint8(1);const s=t&8;let l=null;if(s){const h=n?3:2;l=e.getUint16(h,!0)}this.currentHeartRate=r;const u={bpm:r,timestamp:Date.now(),energyExpended:l};this.heartRateHistory.push(u),this.heartRateHistory.length>this.maxHistorySize&&this.heartRateHistory.shift(),this.heartRateHistory.length%10===0&&this.saveHistory(),this.notifyListeners(u)}async disconnect(){try{return this.characteristic&&await this.characteristic.stopNotifications(),this.device&&this.device.gatt.connected&&await this.device.gatt.disconnect(),this.isMonitoring=!1,this.device=null,this.characteristic=null,{success:!0,message:"Disconnected"}}catch(e){throw e}}getCurrentHeartRate(){return this.currentHeartRate}getHeartRateZone(e=30){if(!this.currentHeartRate)return null;const t=220-e,n=this.currentHeartRate/t*100;return n<50?{zone:"Resting",color:"#4CAF50",intensity:"Very Light"}:n<60?{zone:"Fat Burn",color:"#8BC34A",intensity:"Light"}:n<70?{zone:"Cardio",color:"#FFC107",intensity:"Moderate"}:n<80?{zone:"Peak",color:"#FF9800",intensity:"Hard"}:{zone:"Maximum",color:"#F44336",intensity:"Maximum"}}getAverageHeartRate(e=5){const t=Date.now()-e*60*1e3,n=this.heartRateHistory.filter(s=>s.timestamp>t);if(n.length===0)return null;const r=n.reduce((s,l)=>s+l.bpm,0);return Math.round(r/n.length)}getHeartRateVariability(){if(this.heartRateHistory.length<10)return null;const e=this.heartRateHistory.slice(-10),t=[];for(let l=1;l<e.length;l++)t.push(e[l].timestamp-e[l-1].timestamp);const n=t.reduce((l,u)=>l+u,0)/t.length,r=t.reduce((l,u)=>l+Math.pow(u-n,2),0)/t.length,s=Math.sqrt(r);return Math.round(s)}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch{}})}async saveHistory(){try{await Jh.saveData("heart_rate_history",this.heartRateHistory)}catch{}}loadHistory(){try{const e=localStorage.getItem("heart_rate_history");e&&(this.heartRateHistory=JSON.parse(e))}catch{}}isConnected(){return this.device&&this.device.gatt&&this.device.gatt.connected}getDeviceName(){return this.device?.name||localStorage.getItem("hr_device_name")||"No device"}}const Fd=new ZH;class eG{constructor(){this.isTracking=!1,this.sleepSession=null,this.motionData=[],this.lastMotionTime=null,this.motionListener=null,this.checkInterval=null}async startTracking(){if(!this.isTracking)try{return this.isTracking=!0,this.sleepSession={startTime:Date.now(),endTime:null,phases:[],movements:0,quality:null},wo.getPlatform()!=="web"&&(this.motionListener=await Uh.addListener("accel",e=>{this.handleMotionData(e)})),this.checkInterval=setInterval(()=>{this.analyzeSleepPhase()},3e4),this.saveSleepSession(),{success:!0,message:"Sleep tracking started"}}catch(e){throw this.isTracking=!1,e}}async stopTracking(){if(!this.isTracking)return null;try{this.isTracking=!1,this.motionListener&&(this.motionListener.remove(),this.motionListener=null),this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.sleepSession.endTime=Date.now(),this.sleepSession.quality=this.calculateSleepQuality();const t=((this.sleepSession.endTime-this.sleepSession.startTime)/(1e3*60*60)).toFixed(1);this.saveSleepToHistory();const n={...this.sleepSession};return this.sleepSession=null,this.motionData=[],{success:!0,session:n,duration:t,quality:n.quality}}catch(e){throw e}}handleMotionData(e){const{x:t,y:n,z:r}=e.acceleration,s=Math.sqrt(t*t+n*n+r*r);if(s>.5){this.lastMotionTime=Date.now(),this.sleepSession.movements++,this.motionData.push({magnitude:s,timestamp:Date.now()});const l=Date.now()-300*1e3;this.motionData=this.motionData.filter(u=>u.timestamp>l)}}analyzeSleepPhase(){if(!this.isTracking)return;const e=Date.now(),t=e-6e4,n=e-3e5,r=this.motionData.filter(u=>u.timestamp>t).length,s=this.motionData.filter(u=>u.timestamp>n).length;let l;r>10?l="awake":s>5?l="light":s>2?l="rem":l="deep",this.sleepSession.phases.push({phase:l,timestamp:e,duration:3e4})}calculateSleepQuality(){if(!this.sleepSession)return null;const t=(this.sleepSession.endTime-this.sleepSession.startTime)/(1e3*60*60),n={awake:0,light:0,rem:0,deep:0};this.sleepSession.phases.forEach(x=>{n[x.phase]++});const r=this.sleepSession.phases.length||1,s=n.deep/r*100,l=n.rem/r*100,u=n.awake/r*100;let h=100;t<6?h-=20:t<7?h-=10:t>9&&(h-=5),s<15?h-=15:s<20&&(h-=5),l<15?h-=15:l<20&&(h-=5),h-=u;const f=this.sleepSession.movements/t;return f>20?h-=10:f>10&&(h-=5),Math.max(0,Math.min(100,Math.round(h)))}getSleepStats(){if(!this.sleepSession)return null;const n=((Date.now()-this.sleepSession.startTime)/(1e3*60*60)).toFixed(1),r={awake:0,light:0,rem:0,deep:0};this.sleepSession.phases.forEach(l=>{r[l.phase]++});const s=this.sleepSession.phases.length||1;return{duration:n,movements:this.sleepSession.movements,phases:{deep:Math.round(r.deep/s*100),rem:Math.round(r.rem/s*100),light:Math.round(r.light/s*100),awake:Math.round(r.awake/s*100)},currentPhase:this.sleepSession.phases[this.sleepSession.phases.length-1]?.phase||"unknown"}}getSleepHistory(e=7){try{const t=localStorage.getItem("sleep_history");if(!t)return[];const n=JSON.parse(t),r=Date.now()-e*24*60*60*1e3;return n.filter(s=>s.startTime>r)}catch{return[]}}async saveSleepToHistory(){try{const e=this.sleepSession.endTime-this.sleepSession.startTime,t=Math.floor(e/(1e3*60*60)),n=Math.floor(e%(1e3*60*60)/(1e3*60)),s={date:new Date().toISOString().split("T")[0],hours:t,minutes:n,quality:this.sleepSession.quality,timestamp:this.sleepSession.endTime,phases:this.sleepSession.phases,movements:this.sleepSession.movements},l=JSON.parse(localStorage.getItem("sleepLog")||"[]");l.push(s),localStorage.setItem("sleepLog",JSON.stringify(l));try{await mi.save("sleepLog",l,Ti.getCurrentUser()?.uid)}catch(u){console.warn(" Could not sync sleep to Firebase:",u)}}catch{}}saveSleepSession(){try{this.sleepSession&&localStorage.setItem("current_sleep_session",JSON.stringify(this.sleepSession))}catch{}}restoreSleepSession(){try{const e=localStorage.getItem("current_sleep_session");return e?(this.sleepSession=JSON.parse(e),Date.now()-this.sleepSession.startTime>720*60*1e3?(localStorage.removeItem("current_sleep_session"),this.sleepSession=null,!1):!0):!1}catch{return!1}}}const ep=new eG;class tG{constructor(){this.dailyGoal=2e3,this.todayIntake=0,this.intakeHistory=[],this.reminders=[]}async initialize(){await this.loadSettings(),await this.loadTodayIntake(),await this.loadHistory(),await this.loadReminders()}async addIntake(e){const t={amount:e,timestamp:Date.now(),date:new Date().toISOString().split("T")[0]};this.todayIntake+=e,this.intakeHistory.push(t),this.saveTodayIntake(),this.saveHistory();const n=await mi.get("waterLog",Ti.getCurrentUser()?.uid)||[];n.push({cups:Math.round(e/250),timestamp:Date.now(),date:new Date().toISOString().split("T")[0]}),await mi.save("waterLog",n,Ti.getCurrentUser()?.uid);try{await iS.trackHydration(e,{exercised:!1,temperature:20,thirstLevel:3})}catch{}return this.todayIntake>=this.dailyGoal,{amount:e,total:this.todayIntake,remaining:Math.max(0,this.dailyGoal-this.todayIntake),percentage:Math.min(100,Math.round(this.todayIntake/this.dailyGoal*100)),intake:this.todayIntake,goal:this.dailyGoal,goalReached:this.todayIntake>=this.dailyGoal}}addGlass(){return this.addIntake(250)}addBottle(){return this.addIntake(500)}addLargeBottle(){return this.addIntake(1e3)}addCup(){return this.addIntake(200)}removeLastIntake(){if(this.intakeHistory.length===0)return null;const e=new Date().toISOString().split("T")[0],t=this.intakeHistory.filter(s=>s.date===e);if(t.length===0)return null;const n=t[t.length-1];this.todayIntake-=n.amount;const r=this.intakeHistory.indexOf(n);return this.intakeHistory.splice(r,1),this.saveTodayIntake(),this.saveHistory(),n}async setDailyGoal(e){this.dailyGoal=e,localStorage.setItem("water_daily_goal",e.toString()),await mi.save("water_daily_goal",e,Ti.getCurrentUser()?.uid)}getRecommendedGoal(e,t="moderate"){let n=e*33;return t==="low"?n*=.9:t==="high"?n*=1.2:t==="very_high"&&(n*=1.4),Math.round(n)}getTodayProgress(){return{intake:this.todayIntake,goal:this.dailyGoal,remaining:Math.max(0,this.dailyGoal-this.todayIntake),percentage:Math.min(100,Math.round(this.todayIntake/this.dailyGoal*100)),goalReached:this.todayIntake>=this.dailyGoal}}getIntakeForDate(e){const t=this.intakeHistory.filter(r=>r.date===e),n=t.reduce((r,s)=>r+s.amount,0);return{intakes:t,total:n,percentage:Math.min(100,Math.round(n/this.dailyGoal*100))}}getWeeklyStats(){const e=new Date,t=new Date(e);t.setDate(e.getDate()-6);const n=[];for(let u=0;u<7;u++){const h=new Date(t);h.setDate(t.getDate()+u);const f=h.toISOString().split("T")[0],p=this.intakeHistory.filter(w=>w.date===f).reduce((w,A)=>w+A.amount,0);n.push({date:f,dayName:h.toLocaleDateString("en-US",{weekday:"short"}),total:p,percentage:Math.min(100,Math.round(p/this.dailyGoal*100)),goalReached:p>=this.dailyGoal})}const r=n.reduce((u,h)=>u+h.total,0),s=Math.round(r/7),l=n.filter(u=>u.goalReached).length;return{days:n,weekTotal:r,weekAverage:s,daysGoalReached:l,consistency:Math.round(l/7*100)}}scheduleReminder(e,t,n="Time to drink water! "){const r={id:Date.now().toString(),hour:e,minute:t,message:n,enabled:!0};return this.reminders.push(r),this.saveReminders(),r}removeReminder(e){this.reminders=this.reminders.filter(t=>t.id!==e),this.saveReminders()}toggleReminder(e){const t=this.reminders.find(n=>n.id===e);t&&(t.enabled=!t.enabled,this.saveReminders())}resetDailyIntake(){this.todayIntake=0,this.saveTodayIntake()}saveTodayIntake(){const e=new Date().toISOString().split("T")[0];localStorage.setItem("water_today_intake",JSON.stringify({date:e,amount:this.todayIntake}))}async loadTodayIntake(){try{const e=await mi.get("water_today_intake",Ti.getCurrentUser()?.uid),t=new Date().toISOString().split("T")[0];if(e&&e.date===t)this.todayIntake=e.intake;else{const n=localStorage.getItem("water_today_intake");if(n){const r=JSON.parse(n);r.date===t?this.todayIntake=r.intake:this.todayIntake=0}else this.todayIntake=0}}catch{}}async saveHistory(){try{const e=Date.now()-2592e6,t=this.intakeHistory.filter(n=>n.timestamp>e);localStorage.setItem("water_intake_history",JSON.stringify(t)),await mi.save("water_intake_history",t,Ti.getCurrentUser()?.uid)}catch{}}async loadHistory(){try{const e=await mi.get("water_intake_history",Ti.getCurrentUser()?.uid);if(e)this.intakeHistory=e;else{const t=localStorage.getItem("water_intake_history");t&&(this.intakeHistory=JSON.parse(t))}}catch{}}async saveReminders(){try{localStorage.setItem("water_reminders",JSON.stringify(this.reminders)),await mi.save("water_reminders",this.reminders,Ti.getCurrentUser()?.uid)}catch{}}async loadReminders(){try{const e=await mi.get("water_reminders",Ti.getCurrentUser()?.uid);if(e)this.reminders=e;else{const t=localStorage.getItem("water_reminders");t&&(this.reminders=JSON.parse(t))}}catch{}}async loadSettings(){try{const e=await mi.get("water_daily_goal",Ti.getCurrentUser()?.uid);if(e)this.dailyGoal=typeof e=="number"?e:parseInt(e);else{const t=localStorage.getItem("water_daily_goal");t&&(this.dailyGoal=parseInt(t))}}catch{}}}const R1=new tG,RY=Object.freeze(Object.defineProperty({__proto__:null,default:R1},Symbol.toStringTag,{value:"Module"}));class nG{constructor(){this.isDarkMode=!1,this.isAutoMode=!0,this.listeners=[]}initialize(){const e=localStorage.getItem("dark_mode"),t=localStorage.getItem("dark_mode_auto");t!==null&&(this.isAutoMode=t==="true"),this.isAutoMode?(this.isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{this.isAutoMode&&this.setDarkMode(n.matches)})):e!==null&&(this.isDarkMode=e==="true"),this.applyTheme()}toggle(){this.isAutoMode=!1,this.setDarkMode(!this.isDarkMode),localStorage.setItem("dark_mode_auto","false")}setDarkMode(e){this.isDarkMode=e,this.applyTheme(),this.notifyListeners(),localStorage.setItem("dark_mode",e.toString())}setAutoMode(e){if(this.isAutoMode=e,localStorage.setItem("dark_mode_auto",e.toString()),e){const t=window.matchMedia("(prefers-color-scheme: dark)").matches;this.setDarkMode(t)}}applyTheme(){const e=document.documentElement;this.isDarkMode?(e.classList.add("dark-mode"),e.style.setProperty("--bg-primary","#121212"),e.style.setProperty("--bg-secondary","#1E1E1E"),e.style.setProperty("--bg-tertiary","#2D2D2D"),e.style.setProperty("--text-primary","#FFFFFF"),e.style.setProperty("--text-secondary","#B0B0B0"),e.style.setProperty("--text-tertiary","#808080"),e.style.setProperty("--border-color","#3D3D3D"),e.style.setProperty("--shadow","rgba(0, 0, 0, 0.5)")):(e.classList.remove("dark-mode"),e.style.setProperty("--bg-primary","#FFFFFF"),e.style.setProperty("--bg-secondary","#F5F7FA"),e.style.setProperty("--bg-tertiary","#E0E4E8"),e.style.setProperty("--text-primary","#000000"),e.style.setProperty("--text-secondary","#666666"),e.style.setProperty("--text-tertiary","#999999"),e.style.setProperty("--border-color","#E0E0E0"),e.style.setProperty("--shadow","rgba(0, 0, 0, 0.1)"))}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.isDarkMode)}catch{}})}getTheme(){return{isDark:this.isDarkMode,isAuto:this.isAutoMode,mode:this.isDarkMode?"dark":"light"}}}const iG=new nG;var Bx;(function(i){i[i.Flush=0]="Flush",i[i.Add=1]="Add"})(Bx||(Bx={}));const rS=Bl("TextToSpeech",{web:()=>jt(()=>import("./chunk-1765887266800-web6.js"),[]).then(i=>new i.TextToSpeechWeb)}),rG=Object.freeze(Object.defineProperty({__proto__:null,get QueueStrategy(){return Bx},TextToSpeech:rS},Symbol.toStringTag,{value:"Module"}));class sG{constructor(){this.audioContext=null,this.oscillators=[],this.gainNodes=[],this.isPlaying=!1,this.audioElement=null,this.useRealAudio=!0}initAudio(){return this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext}createBinauralBeat(e=6){const t=this.initAudio(),n=t.createOscillator(),r=t.createGain();n.type="sine",n.frequency.setValueAtTime(200,t.currentTime),r.gain.setValueAtTime(.08,t.currentTime);const s=t.createOscillator(),l=t.createGain();s.type="sine",s.frequency.setValueAtTime(200+e,t.currentTime),l.gain.setValueAtTime(.08,t.currentTime);const u=t.createStereoPanner(),h=t.createStereoPanner();return u.pan.setValueAtTime(-1,t.currentTime),h.pan.setValueAtTime(1,t.currentTime),n.connect(r),r.connect(u),u.connect(t.destination),s.connect(l),l.connect(h),h.connect(t.destination),{leftOsc:n,rightOsc:s,leftGain:r,rightGain:l}}createWhiteNoise(){const e=this.initAudio(),t=e.sampleRate*2,n=e.createBuffer(1,t,e.sampleRate),r=n.getChannelData(0);let s=0,l=0,u=0,h=0,f=0,x=0,p=0;for(let $=0;$<t;$++){const W=Math.random()*2-1;s=.99886*s+W*.0555179,l=.99332*l+W*.0750759,u=.969*u+W*.153852,h=.8665*h+W*.3104856,f=.55*f+W*.5329522,x=-.7616*x-W*.016898,r[$]=s+l+u+h+f+x+p+W*.5362,r[$]*=.11,p=W*.115926}const w=e.createBufferSource();w.buffer=n,w.loop=!0;const A=e.createBiquadFilter();A.type="lowpass",A.frequency.setValueAtTime(800,e.currentTime);const B=e.createGain();return B.gain.setValueAtTime(.05,e.currentTime),w.connect(A),A.connect(B),B.connect(e.destination),{source:w,gain:B}}createOceanWave(){const e=this.initAudio(),t=e.createOscillator(),n=e.createGain(),r=e.createBiquadFilter();t.type="sine",t.frequency.setValueAtTime(.3,e.currentTime),r.type="lowpass",r.frequency.setValueAtTime(400,e.currentTime),r.Q.setValueAtTime(.5,e.currentTime),n.gain.setValueAtTime(.06,e.currentTime);const s=e.createOscillator(),l=e.createGain();return s.frequency.setValueAtTime(.2,e.currentTime),l.gain.setValueAtTime(.03,e.currentTime),s.connect(l),l.connect(n.gain),t.connect(r),r.connect(n),n.connect(e.destination),{osc:t,lfo:s,gainNode:n}}async start(){if(!this.isPlaying)try{if(this.useRealAudio)try{this.audioElement=new Audio("/meditation-ambient.mp3"),this.audioElement.loop=!0,this.audioElement.volume=.3,this.audioElement.volume=0,await this.audioElement.play();const s=setInterval(()=>{this.audioElement.volume<.3?this.audioElement.volume=Math.min(.3,this.audioElement.volume+.03):clearInterval(s)},100);this.isPlaying=!0;return}catch{}const e=this.initAudio();e.state==="suspended"&&await e.resume();const t=this.createBinauralBeat(6);t.leftOsc.start(),t.rightOsc.start(),this.oscillators.push(t.leftOsc,t.rightOsc),this.gainNodes.push(t.leftGain,t.rightGain);const n=this.createWhiteNoise();n.source.start(),this.oscillators.push(n.source),this.gainNodes.push(n.gain);const r=this.createOceanWave();r.osc.start(),r.lfo.start(),this.oscillators.push(r.osc,r.lfo),this.gainNodes.push(r.gainNode),this.isPlaying=!0}catch{}}stop(){if(this.isPlaying)try{if(this.audioElement){const n=setInterval(()=>{this.audioElement&&this.audioElement.volume>.05?this.audioElement.volume=Math.max(0,this.audioElement.volume-.05):(clearInterval(n),this.audioElement&&(this.audioElement.pause(),this.audioElement.currentTime=0,this.audioElement=null))},100);this.isPlaying=!1;return}const e=2,t=this.audioContext;if(t&&this.gainNodes.length>0){const n=t.currentTime;this.gainNodes.forEach(r=>{r.gain.exponentialRampToValueAtTime(.001,n+e)}),setTimeout(()=>{this.oscillators.forEach(r=>{try{r.stop()}catch{}}),this.oscillators=[],this.gainNodes=[]},e*1e3)}this.isPlaying=!1}catch{}}getIsPlaying(){return this.isPlaying}}const aG=new sG;var yb={};var PI;function oG(){return PI||(PI=1,(function(i){(function(){var e=function(){this.init()};e.prototype={init:function(){var p=this||t;return p._counter=1e3,p._html5AudioPool=[],p.html5PoolSize=10,p._codecs={},p._howls=[],p._muted=!1,p._volume=1,p._canPlayEvent="canplaythrough",p._navigator=typeof window<"u"&&window.navigator?window.navigator:null,p.masterGain=null,p.noAudio=!1,p.usingWebAudio=!0,p.autoSuspend=!0,p.ctx=null,p.autoUnlock=!0,p._setup(),p},volume:function(p){var w=this||t;if(p=parseFloat(p),w.ctx||x(),typeof p<"u"&&p>=0&&p<=1){if(w._volume=p,w._muted)return w;w.usingWebAudio&&w.masterGain.gain.setValueAtTime(p,t.ctx.currentTime);for(var A=0;A<w._howls.length;A++)if(!w._howls[A]._webAudio)for(var B=w._howls[A]._getSoundIds(),$=0;$<B.length;$++){var W=w._howls[A]._soundById(B[$]);W&&W._node&&(W._node.volume=W._volume*p)}return w}return w._volume},mute:function(p){var w=this||t;w.ctx||x(),w._muted=p,w.usingWebAudio&&w.masterGain.gain.setValueAtTime(p?0:w._volume,t.ctx.currentTime);for(var A=0;A<w._howls.length;A++)if(!w._howls[A]._webAudio)for(var B=w._howls[A]._getSoundIds(),$=0;$<B.length;$++){var W=w._howls[A]._soundById(B[$]);W&&W._node&&(W._node.muted=p?!0:W._muted)}return w},stop:function(){for(var p=this||t,w=0;w<p._howls.length;w++)p._howls[w].stop();return p},unload:function(){for(var p=this||t,w=p._howls.length-1;w>=0;w--)p._howls[w].unload();return p.usingWebAudio&&p.ctx&&typeof p.ctx.close<"u"&&(p.ctx.close(),p.ctx=null,x()),p},codecs:function(p){return(this||t)._codecs[p.replace(/^x-/,"")]},_setup:function(){var p=this||t;if(p.state=p.ctx&&p.ctx.state||"suspended",p._autoSuspend(),!p.usingWebAudio)if(typeof Audio<"u")try{var w=new Audio;typeof w.oncanplaythrough>"u"&&(p._canPlayEvent="canplay")}catch{p.noAudio=!0}else p.noAudio=!0;try{var w=new Audio;w.muted&&(p.noAudio=!0)}catch{}return p.noAudio||p._setupCodecs(),p},_setupCodecs:function(){var p=this||t,w=null;try{w=typeof Audio<"u"?new Audio:null}catch{return p}if(!w||typeof w.canPlayType!="function")return p;var A=w.canPlayType("audio/mpeg;").replace(/^no$/,""),B=p._navigator?p._navigator.userAgent:"",$=B.match(/OPR\/(\d+)/g),W=$&&parseInt($[0].split("/")[1],10)<33,q=B.indexOf("Safari")!==-1&&B.indexOf("Chrome")===-1,ge=B.match(/Version\/(.*?) /),he=q&&ge&&parseInt(ge[1],10)<15;return p._codecs={mp3:!!(!W&&(A||w.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!A,opus:!!w.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!w.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!w.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(w.canPlayType('audio/wav; codecs="1"')||w.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!w.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!w.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(w.canPlayType("audio/x-m4a;")||w.canPlayType("audio/m4a;")||w.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(w.canPlayType("audio/x-m4b;")||w.canPlayType("audio/m4b;")||w.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(w.canPlayType("audio/x-mp4;")||w.canPlayType("audio/mp4;")||w.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!he&&w.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!he&&w.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!w.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(w.canPlayType("audio/x-flac;")||w.canPlayType("audio/flac;")).replace(/^no$/,"")},p},_unlockAudio:function(){var p=this||t;if(!(p._audioUnlocked||!p.ctx)){p._audioUnlocked=!1,p.autoUnlock=!1,!p._mobileUnloaded&&p.ctx.sampleRate!==44100&&(p._mobileUnloaded=!0,p.unload()),p._scratchBuffer=p.ctx.createBuffer(1,1,22050);var w=function(A){for(;p._html5AudioPool.length<p.html5PoolSize;)try{var B=new Audio;B._unlocked=!0,p._releaseHtml5Audio(B)}catch{p.noAudio=!0;break}for(var $=0;$<p._howls.length;$++)if(!p._howls[$]._webAudio)for(var W=p._howls[$]._getSoundIds(),q=0;q<W.length;q++){var ge=p._howls[$]._soundById(W[q]);ge&&ge._node&&!ge._node._unlocked&&(ge._node._unlocked=!0,ge._node.load())}p._autoResume();var he=p.ctx.createBufferSource();he.buffer=p._scratchBuffer,he.connect(p.ctx.destination),typeof he.start>"u"?he.noteOn(0):he.start(0),typeof p.ctx.resume=="function"&&p.ctx.resume(),he.onended=function(){he.disconnect(0),p._audioUnlocked=!0,document.removeEventListener("touchstart",w,!0),document.removeEventListener("touchend",w,!0),document.removeEventListener("click",w,!0),document.removeEventListener("keydown",w,!0);for(var me=0;me<p._howls.length;me++)p._howls[me]._emit("unlock")}};return document.addEventListener("touchstart",w,!0),document.addEventListener("touchend",w,!0),document.addEventListener("click",w,!0),document.addEventListener("keydown",w,!0),p}},_obtainHtml5Audio:function(){var p=this||t;if(p._html5AudioPool.length)return p._html5AudioPool.pop();var w=new Audio().play();return w&&typeof Promise<"u"&&(w instanceof Promise||typeof w.then=="function")&&w.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(p){var w=this||t;return p._unlocked&&w._html5AudioPool.push(p),w},_autoSuspend:function(){var p=this;if(!(!p.autoSuspend||!p.ctx||typeof p.ctx.suspend>"u"||!t.usingWebAudio)){for(var w=0;w<p._howls.length;w++)if(p._howls[w]._webAudio){for(var A=0;A<p._howls[w]._sounds.length;A++)if(!p._howls[w]._sounds[A]._paused)return p}return p._suspendTimer&&clearTimeout(p._suspendTimer),p._suspendTimer=setTimeout(function(){if(p.autoSuspend){p._suspendTimer=null,p.state="suspending";var B=function(){p.state="suspended",p._resumeAfterSuspend&&(delete p._resumeAfterSuspend,p._autoResume())};p.ctx.suspend().then(B,B)}},3e4),p}},_autoResume:function(){var p=this;if(!(!p.ctx||typeof p.ctx.resume>"u"||!t.usingWebAudio))return p.state==="running"&&p.ctx.state!=="interrupted"&&p._suspendTimer?(clearTimeout(p._suspendTimer),p._suspendTimer=null):p.state==="suspended"||p.state==="running"&&p.ctx.state==="interrupted"?(p.ctx.resume().then(function(){p.state="running";for(var w=0;w<p._howls.length;w++)p._howls[w]._emit("resume")}),p._suspendTimer&&(clearTimeout(p._suspendTimer),p._suspendTimer=null)):p.state==="suspending"&&(p._resumeAfterSuspend=!0),p}};var t=new e,n=function(p){var w=this;if(!p.src||p.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}w.init(p)};n.prototype={init:function(p){var w=this;return t.ctx||x(),w._autoplay=p.autoplay||!1,w._format=typeof p.format!="string"?p.format:[p.format],w._html5=p.html5||!1,w._muted=p.mute||!1,w._loop=p.loop||!1,w._pool=p.pool||5,w._preload=typeof p.preload=="boolean"||p.preload==="metadata"?p.preload:!0,w._rate=p.rate||1,w._sprite=p.sprite||{},w._src=typeof p.src!="string"?p.src:[p.src],w._volume=p.volume!==void 0?p.volume:1,w._xhr={method:p.xhr&&p.xhr.method?p.xhr.method:"GET",headers:p.xhr&&p.xhr.headers?p.xhr.headers:null,withCredentials:p.xhr&&p.xhr.withCredentials?p.xhr.withCredentials:!1},w._duration=0,w._state="unloaded",w._sounds=[],w._endTimers={},w._queue=[],w._playLock=!1,w._onend=p.onend?[{fn:p.onend}]:[],w._onfade=p.onfade?[{fn:p.onfade}]:[],w._onload=p.onload?[{fn:p.onload}]:[],w._onloaderror=p.onloaderror?[{fn:p.onloaderror}]:[],w._onplayerror=p.onplayerror?[{fn:p.onplayerror}]:[],w._onpause=p.onpause?[{fn:p.onpause}]:[],w._onplay=p.onplay?[{fn:p.onplay}]:[],w._onstop=p.onstop?[{fn:p.onstop}]:[],w._onmute=p.onmute?[{fn:p.onmute}]:[],w._onvolume=p.onvolume?[{fn:p.onvolume}]:[],w._onrate=p.onrate?[{fn:p.onrate}]:[],w._onseek=p.onseek?[{fn:p.onseek}]:[],w._onunlock=p.onunlock?[{fn:p.onunlock}]:[],w._onresume=[],w._webAudio=t.usingWebAudio&&!w._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(w),w._autoplay&&w._queue.push({event:"play",action:function(){w.play()}}),w._preload&&w._preload!=="none"&&w.load(),w},load:function(){var p=this,w=null;if(t.noAudio){p._emit("loaderror",null,"No audio support.");return}typeof p._src=="string"&&(p._src=[p._src]);for(var A=0;A<p._src.length;A++){var B,$;if(p._format&&p._format[A])B=p._format[A];else{if($=p._src[A],typeof $!="string"){p._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}B=/^data:audio\/([^;,]+);/i.exec($),B||(B=/\.([^.]+)$/.exec($.split("?",1)[0])),B&&(B=B[1].toLowerCase())}if(B||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),B&&t.codecs(B)){w=p._src[A];break}}if(!w){p._emit("loaderror",null,"No codec support for selected audio sources.");return}return p._src=w,p._state="loading",window.location.protocol==="https:"&&w.slice(0,5)==="http:"&&(p._html5=!0,p._webAudio=!1),new r(p),p._webAudio&&l(p),p},play:function(p,w){var A=this,B=null;if(typeof p=="number")B=p,p=null;else{if(typeof p=="string"&&A._state==="loaded"&&!A._sprite[p])return null;if(typeof p>"u"&&(p="__default",!A._playLock)){for(var $=0,W=0;W<A._sounds.length;W++)A._sounds[W]._paused&&!A._sounds[W]._ended&&($++,B=A._sounds[W]._id);$===1?p=null:B=null}}var q=B?A._soundById(B):A._inactiveSound();if(!q)return null;if(B&&!p&&(p=q._sprite||"__default"),A._state!=="loaded"){q._sprite=p,q._ended=!1;var ge=q._id;return A._queue.push({event:"play",action:function(){A.play(ge)}}),ge}if(B&&!q._paused)return w||A._loadQueue("play"),q._id;A._webAudio&&t._autoResume();var he=Math.max(0,q._seek>0?q._seek:A._sprite[p][0]/1e3),me=Math.max(0,(A._sprite[p][0]+A._sprite[p][1])/1e3-he),Ce=me*1e3/Math.abs(q._rate),Ve=A._sprite[p][0]/1e3,pe=(A._sprite[p][0]+A._sprite[p][1])/1e3;q._sprite=p,q._ended=!1;var ee=function(){q._paused=!1,q._seek=he,q._start=Ve,q._stop=pe,q._loop=!!(q._loop||A._sprite[p][2])};if(he>=pe){A._ended(q);return}var J=q._node;if(A._webAudio){var ye=function(){A._playLock=!1,ee(),A._refreshBuffer(q);var ze=q._muted||A._muted?0:q._volume;J.gain.setValueAtTime(ze,t.ctx.currentTime),q._playStart=t.ctx.currentTime,typeof J.bufferSource.start>"u"?q._loop?J.bufferSource.noteGrainOn(0,he,86400):J.bufferSource.noteGrainOn(0,he,me):q._loop?J.bufferSource.start(0,he,86400):J.bufferSource.start(0,he,me),Ce!==1/0&&(A._endTimers[q._id]=setTimeout(A._ended.bind(A,q),Ce)),w||setTimeout(function(){A._emit("play",q._id),A._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?ye():(A._playLock=!0,A.once("resume",ye),A._clearTimer(q._id))}else{var X=function(){J.currentTime=he,J.muted=q._muted||A._muted||t._muted||J.muted,J.volume=q._volume*t.volume(),J.playbackRate=q._rate;try{var ze=J.play();if(ze&&typeof Promise<"u"&&(ze instanceof Promise||typeof ze.then=="function")?(A._playLock=!0,ee(),ze.then(function(){A._playLock=!1,J._unlocked=!0,w?A._loadQueue():A._emit("play",q._id)}).catch(function(){A._playLock=!1,A._emit("playerror",q._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),q._ended=!0,q._paused=!0})):w||(A._playLock=!1,ee(),A._emit("play",q._id)),J.playbackRate=q._rate,J.paused){A._emit("playerror",q._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}p!=="__default"||q._loop?A._endTimers[q._id]=setTimeout(A._ended.bind(A,q),Ce):(A._endTimers[q._id]=function(){A._ended(q),J.removeEventListener("ended",A._endTimers[q._id],!1)},J.addEventListener("ended",A._endTimers[q._id],!1))}catch(nt){A._emit("playerror",q._id,nt)}};J.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(J.src=A._src,J.load());var ae=window&&window.ejecta||!J.readyState&&t._navigator.isCocoonJS;if(J.readyState>=3||ae)X();else{A._playLock=!0,A._state="loading";var le=function(){A._state="loaded",X(),J.removeEventListener(t._canPlayEvent,le,!1)};J.addEventListener(t._canPlayEvent,le,!1),A._clearTimer(q._id)}}return q._id},pause:function(p){var w=this;if(w._state!=="loaded"||w._playLock)return w._queue.push({event:"pause",action:function(){w.pause(p)}}),w;for(var A=w._getSoundIds(p),B=0;B<A.length;B++){w._clearTimer(A[B]);var $=w._soundById(A[B]);if($&&!$._paused&&($._seek=w.seek(A[B]),$._rateSeek=0,$._paused=!0,w._stopFade(A[B]),$._node))if(w._webAudio){if(!$._node.bufferSource)continue;typeof $._node.bufferSource.stop>"u"?$._node.bufferSource.noteOff(0):$._node.bufferSource.stop(0),w._cleanBuffer($._node)}else(!isNaN($._node.duration)||$._node.duration===1/0)&&$._node.pause();arguments[1]||w._emit("pause",$?$._id:null)}return w},stop:function(p,w){var A=this;if(A._state!=="loaded"||A._playLock)return A._queue.push({event:"stop",action:function(){A.stop(p)}}),A;for(var B=A._getSoundIds(p),$=0;$<B.length;$++){A._clearTimer(B[$]);var W=A._soundById(B[$]);W&&(W._seek=W._start||0,W._rateSeek=0,W._paused=!0,W._ended=!0,A._stopFade(B[$]),W._node&&(A._webAudio?W._node.bufferSource&&(typeof W._node.bufferSource.stop>"u"?W._node.bufferSource.noteOff(0):W._node.bufferSource.stop(0),A._cleanBuffer(W._node)):(!isNaN(W._node.duration)||W._node.duration===1/0)&&(W._node.currentTime=W._start||0,W._node.pause(),W._node.duration===1/0&&A._clearSound(W._node))),w||A._emit("stop",W._id))}return A},mute:function(p,w){var A=this;if(A._state!=="loaded"||A._playLock)return A._queue.push({event:"mute",action:function(){A.mute(p,w)}}),A;if(typeof w>"u")if(typeof p=="boolean")A._muted=p;else return A._muted;for(var B=A._getSoundIds(w),$=0;$<B.length;$++){var W=A._soundById(B[$]);W&&(W._muted=p,W._interval&&A._stopFade(W._id),A._webAudio&&W._node?W._node.gain.setValueAtTime(p?0:W._volume,t.ctx.currentTime):W._node&&(W._node.muted=t._muted?!0:p),A._emit("mute",W._id))}return A},volume:function(){var p=this,w=arguments,A,B;if(w.length===0)return p._volume;if(w.length===1||w.length===2&&typeof w[1]>"u"){var $=p._getSoundIds(),W=$.indexOf(w[0]);W>=0?B=parseInt(w[0],10):A=parseFloat(w[0])}else w.length>=2&&(A=parseFloat(w[0]),B=parseInt(w[1],10));var q;if(typeof A<"u"&&A>=0&&A<=1){if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"volume",action:function(){p.volume.apply(p,w)}}),p;typeof B>"u"&&(p._volume=A),B=p._getSoundIds(B);for(var ge=0;ge<B.length;ge++)q=p._soundById(B[ge]),q&&(q._volume=A,w[2]||p._stopFade(B[ge]),p._webAudio&&q._node&&!q._muted?q._node.gain.setValueAtTime(A,t.ctx.currentTime):q._node&&!q._muted&&(q._node.volume=A*t.volume()),p._emit("volume",q._id))}else return q=B?p._soundById(B):p._sounds[0],q?q._volume:0;return p},fade:function(p,w,A,B){var $=this;if($._state!=="loaded"||$._playLock)return $._queue.push({event:"fade",action:function(){$.fade(p,w,A,B)}}),$;p=Math.min(Math.max(0,parseFloat(p)),1),w=Math.min(Math.max(0,parseFloat(w)),1),A=parseFloat(A),$.volume(p,B);for(var W=$._getSoundIds(B),q=0;q<W.length;q++){var ge=$._soundById(W[q]);if(ge){if(B||$._stopFade(W[q]),$._webAudio&&!ge._muted){var he=t.ctx.currentTime,me=he+A/1e3;ge._volume=p,ge._node.gain.setValueAtTime(p,he),ge._node.gain.linearRampToValueAtTime(w,me)}$._startFadeInterval(ge,p,w,A,W[q],typeof B>"u")}}return $},_startFadeInterval:function(p,w,A,B,$,W){var q=this,ge=w,he=A-w,me=Math.abs(he/.01),Ce=Math.max(4,me>0?B/me:B),Ve=Date.now();p._fadeTo=A,p._interval=setInterval(function(){var pe=(Date.now()-Ve)/B;Ve=Date.now(),ge+=he*pe,ge=Math.round(ge*100)/100,he<0?ge=Math.max(A,ge):ge=Math.min(A,ge),q._webAudio?p._volume=ge:q.volume(ge,p._id,!0),W&&(q._volume=ge),(A<w&&ge<=A||A>w&&ge>=A)&&(clearInterval(p._interval),p._interval=null,p._fadeTo=null,q.volume(A,p._id),q._emit("fade",p._id))},Ce)},_stopFade:function(p){var w=this,A=w._soundById(p);return A&&A._interval&&(w._webAudio&&A._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(A._interval),A._interval=null,w.volume(A._fadeTo,p),A._fadeTo=null,w._emit("fade",p)),w},loop:function(){var p=this,w=arguments,A,B,$;if(w.length===0)return p._loop;if(w.length===1)if(typeof w[0]=="boolean")A=w[0],p._loop=A;else return $=p._soundById(parseInt(w[0],10)),$?$._loop:!1;else w.length===2&&(A=w[0],B=parseInt(w[1],10));for(var W=p._getSoundIds(B),q=0;q<W.length;q++)$=p._soundById(W[q]),$&&($._loop=A,p._webAudio&&$._node&&$._node.bufferSource&&($._node.bufferSource.loop=A,A&&($._node.bufferSource.loopStart=$._start||0,$._node.bufferSource.loopEnd=$._stop,p.playing(W[q])&&(p.pause(W[q],!0),p.play(W[q],!0)))));return p},rate:function(){var p=this,w=arguments,A,B;if(w.length===0)B=p._sounds[0]._id;else if(w.length===1){var $=p._getSoundIds(),W=$.indexOf(w[0]);W>=0?B=parseInt(w[0],10):A=parseFloat(w[0])}else w.length===2&&(A=parseFloat(w[0]),B=parseInt(w[1],10));var q;if(typeof A=="number"){if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"rate",action:function(){p.rate.apply(p,w)}}),p;typeof B>"u"&&(p._rate=A),B=p._getSoundIds(B);for(var ge=0;ge<B.length;ge++)if(q=p._soundById(B[ge]),q){p.playing(B[ge])&&(q._rateSeek=p.seek(B[ge]),q._playStart=p._webAudio?t.ctx.currentTime:q._playStart),q._rate=A,p._webAudio&&q._node&&q._node.bufferSource?q._node.bufferSource.playbackRate.setValueAtTime(A,t.ctx.currentTime):q._node&&(q._node.playbackRate=A);var he=p.seek(B[ge]),me=(p._sprite[q._sprite][0]+p._sprite[q._sprite][1])/1e3-he,Ce=me*1e3/Math.abs(q._rate);(p._endTimers[B[ge]]||!q._paused)&&(p._clearTimer(B[ge]),p._endTimers[B[ge]]=setTimeout(p._ended.bind(p,q),Ce)),p._emit("rate",q._id)}}else return q=p._soundById(B),q?q._rate:p._rate;return p},seek:function(){var p=this,w=arguments,A,B;if(w.length===0)p._sounds.length&&(B=p._sounds[0]._id);else if(w.length===1){var $=p._getSoundIds(),W=$.indexOf(w[0]);W>=0?B=parseInt(w[0],10):p._sounds.length&&(B=p._sounds[0]._id,A=parseFloat(w[0]))}else w.length===2&&(A=parseFloat(w[0]),B=parseInt(w[1],10));if(typeof B>"u")return 0;if(typeof A=="number"&&(p._state!=="loaded"||p._playLock))return p._queue.push({event:"seek",action:function(){p.seek.apply(p,w)}}),p;var q=p._soundById(B);if(q)if(typeof A=="number"&&A>=0){var ge=p.playing(B);ge&&p.pause(B,!0),q._seek=A,q._ended=!1,p._clearTimer(B),!p._webAudio&&q._node&&!isNaN(q._node.duration)&&(q._node.currentTime=A);var he=function(){ge&&p.play(B,!0),p._emit("seek",B)};if(ge&&!p._webAudio){var me=function(){p._playLock?setTimeout(me,0):he()};setTimeout(me,0)}else he()}else if(p._webAudio){var Ce=p.playing(B)?t.ctx.currentTime-q._playStart:0,Ve=q._rateSeek?q._rateSeek-q._seek:0;return q._seek+(Ve+Ce*Math.abs(q._rate))}else return q._node.currentTime;return p},playing:function(p){var w=this;if(typeof p=="number"){var A=w._soundById(p);return A?!A._paused:!1}for(var B=0;B<w._sounds.length;B++)if(!w._sounds[B]._paused)return!0;return!1},duration:function(p){var w=this,A=w._duration,B=w._soundById(p);return B&&(A=w._sprite[B._sprite][1]/1e3),A},state:function(){return this._state},unload:function(){for(var p=this,w=p._sounds,A=0;A<w.length;A++)w[A]._paused||p.stop(w[A]._id),p._webAudio||(p._clearSound(w[A]._node),w[A]._node.removeEventListener("error",w[A]._errorFn,!1),w[A]._node.removeEventListener(t._canPlayEvent,w[A]._loadFn,!1),w[A]._node.removeEventListener("ended",w[A]._endFn,!1),t._releaseHtml5Audio(w[A]._node)),delete w[A]._node,p._clearTimer(w[A]._id);var B=t._howls.indexOf(p);B>=0&&t._howls.splice(B,1);var $=!0;for(A=0;A<t._howls.length;A++)if(t._howls[A]._src===p._src||p._src.indexOf(t._howls[A]._src)>=0){$=!1;break}return s&&$&&delete s[p._src],t.noAudio=!1,p._state="unloaded",p._sounds=[],p=null,null},on:function(p,w,A,B){var $=this,W=$["_on"+p];return typeof w=="function"&&W.push(B?{id:A,fn:w,once:B}:{id:A,fn:w}),$},off:function(p,w,A){var B=this,$=B["_on"+p],W=0;if(typeof w=="number"&&(A=w,w=null),w||A)for(W=0;W<$.length;W++){var q=A===$[W].id;if(w===$[W].fn&&q||!w&&q){$.splice(W,1);break}}else if(p)B["_on"+p]=[];else{var ge=Object.keys(B);for(W=0;W<ge.length;W++)ge[W].indexOf("_on")===0&&Array.isArray(B[ge[W]])&&(B[ge[W]]=[])}return B},once:function(p,w,A){var B=this;return B.on(p,w,A,1),B},_emit:function(p,w,A){for(var B=this,$=B["_on"+p],W=$.length-1;W>=0;W--)(!$[W].id||$[W].id===w||p==="load")&&(setTimeout((function(q){q.call(this,w,A)}).bind(B,$[W].fn),0),$[W].once&&B.off(p,$[W].fn,$[W].id));return B._loadQueue(p),B},_loadQueue:function(p){var w=this;if(w._queue.length>0){var A=w._queue[0];A.event===p&&(w._queue.shift(),w._loadQueue()),p||A.action()}return w},_ended:function(p){var w=this,A=p._sprite;if(!w._webAudio&&p._node&&!p._node.paused&&!p._node.ended&&p._node.currentTime<p._stop)return setTimeout(w._ended.bind(w,p),100),w;var B=!!(p._loop||w._sprite[A][2]);if(w._emit("end",p._id),!w._webAudio&&B&&w.stop(p._id,!0).play(p._id),w._webAudio&&B){w._emit("play",p._id),p._seek=p._start||0,p._rateSeek=0,p._playStart=t.ctx.currentTime;var $=(p._stop-p._start)*1e3/Math.abs(p._rate);w._endTimers[p._id]=setTimeout(w._ended.bind(w,p),$)}return w._webAudio&&!B&&(p._paused=!0,p._ended=!0,p._seek=p._start||0,p._rateSeek=0,w._clearTimer(p._id),w._cleanBuffer(p._node),t._autoSuspend()),!w._webAudio&&!B&&w.stop(p._id,!0),w},_clearTimer:function(p){var w=this;if(w._endTimers[p]){if(typeof w._endTimers[p]!="function")clearTimeout(w._endTimers[p]);else{var A=w._soundById(p);A&&A._node&&A._node.removeEventListener("ended",w._endTimers[p],!1)}delete w._endTimers[p]}return w},_soundById:function(p){for(var w=this,A=0;A<w._sounds.length;A++)if(p===w._sounds[A]._id)return w._sounds[A];return null},_inactiveSound:function(){var p=this;p._drain();for(var w=0;w<p._sounds.length;w++)if(p._sounds[w]._ended)return p._sounds[w].reset();return new r(p)},_drain:function(){var p=this,w=p._pool,A=0,B=0;if(!(p._sounds.length<w)){for(B=0;B<p._sounds.length;B++)p._sounds[B]._ended&&A++;for(B=p._sounds.length-1;B>=0;B--){if(A<=w)return;p._sounds[B]._ended&&(p._webAudio&&p._sounds[B]._node&&p._sounds[B]._node.disconnect(0),p._sounds.splice(B,1),A--)}}},_getSoundIds:function(p){var w=this;if(typeof p>"u"){for(var A=[],B=0;B<w._sounds.length;B++)A.push(w._sounds[B]._id);return A}else return[p]},_refreshBuffer:function(p){var w=this;return p._node.bufferSource=t.ctx.createBufferSource(),p._node.bufferSource.buffer=s[w._src],p._panner?p._node.bufferSource.connect(p._panner):p._node.bufferSource.connect(p._node),p._node.bufferSource.loop=p._loop,p._loop&&(p._node.bufferSource.loopStart=p._start||0,p._node.bufferSource.loopEnd=p._stop||0),p._node.bufferSource.playbackRate.setValueAtTime(p._rate,t.ctx.currentTime),w},_cleanBuffer:function(p){var w=this,A=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!p.bufferSource)return w;if(t._scratchBuffer&&p.bufferSource&&(p.bufferSource.onended=null,p.bufferSource.disconnect(0),A))try{p.bufferSource.buffer=t._scratchBuffer}catch{}return p.bufferSource=null,w},_clearSound:function(p){var w=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);w||(p.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(p){this._parent=p,this.init()};r.prototype={init:function(){var p=this,w=p._parent;return p._muted=w._muted,p._loop=w._loop,p._volume=w._volume,p._rate=w._rate,p._seek=0,p._paused=!0,p._ended=!0,p._sprite="__default",p._id=++t._counter,w._sounds.push(p),p.create(),p},create:function(){var p=this,w=p._parent,A=t._muted||p._muted||p._parent._muted?0:p._volume;return w._webAudio?(p._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),p._node.gain.setValueAtTime(A,t.ctx.currentTime),p._node.paused=!0,p._node.connect(t.masterGain)):t.noAudio||(p._node=t._obtainHtml5Audio(),p._errorFn=p._errorListener.bind(p),p._node.addEventListener("error",p._errorFn,!1),p._loadFn=p._loadListener.bind(p),p._node.addEventListener(t._canPlayEvent,p._loadFn,!1),p._endFn=p._endListener.bind(p),p._node.addEventListener("ended",p._endFn,!1),p._node.src=w._src,p._node.preload=w._preload===!0?"auto":w._preload,p._node.volume=A*t.volume(),p._node.load()),p},reset:function(){var p=this,w=p._parent;return p._muted=w._muted,p._loop=w._loop,p._volume=w._volume,p._rate=w._rate,p._seek=0,p._rateSeek=0,p._paused=!0,p._ended=!0,p._sprite="__default",p._id=++t._counter,p},_errorListener:function(){var p=this;p._parent._emit("loaderror",p._id,p._node.error?p._node.error.code:0),p._node.removeEventListener("error",p._errorFn,!1)},_loadListener:function(){var p=this,w=p._parent;w._duration=Math.ceil(p._node.duration*10)/10,Object.keys(w._sprite).length===0&&(w._sprite={__default:[0,w._duration*1e3]}),w._state!=="loaded"&&(w._state="loaded",w._emit("load"),w._loadQueue()),p._node.removeEventListener(t._canPlayEvent,p._loadFn,!1)},_endListener:function(){var p=this,w=p._parent;w._duration===1/0&&(w._duration=Math.ceil(p._node.duration*10)/10,w._sprite.__default[1]===1/0&&(w._sprite.__default[1]=w._duration*1e3),w._ended(p)),p._node.removeEventListener("ended",p._endFn,!1)}};var s={},l=function(p){var w=p._src;if(s[w]){p._duration=s[w].duration,f(p);return}if(/^data:[^;]+;base64,/.test(w)){for(var A=atob(w.split(",")[1]),B=new Uint8Array(A.length),$=0;$<A.length;++$)B[$]=A.charCodeAt($);h(B.buffer,p)}else{var W=new XMLHttpRequest;W.open(p._xhr.method,w,!0),W.withCredentials=p._xhr.withCredentials,W.responseType="arraybuffer",p._xhr.headers&&Object.keys(p._xhr.headers).forEach(function(q){W.setRequestHeader(q,p._xhr.headers[q])}),W.onload=function(){var q=(W.status+"")[0];if(q!=="0"&&q!=="2"&&q!=="3"){p._emit("loaderror",null,"Failed loading audio file with status: "+W.status+".");return}h(W.response,p)},W.onerror=function(){p._webAudio&&(p._html5=!0,p._webAudio=!1,p._sounds=[],delete s[w],p.load())},u(W)}},u=function(p){try{p.send()}catch{p.onerror()}},h=function(p,w){var A=function(){w._emit("loaderror",null,"Decoding audio data failed.")},B=function($){$&&w._sounds.length>0?(s[w._src]=$,f(w,$)):A()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(p).then(B).catch(A):t.ctx.decodeAudioData(p,B,A)},f=function(p,w){w&&!p._duration&&(p._duration=w.duration),Object.keys(p._sprite).length===0&&(p._sprite={__default:[0,p._duration*1e3]}),p._state!=="loaded"&&(p._state="loaded",p._emit("load"),p._loadQueue())},x=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var p=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),w=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),A=w?parseInt(w[1],10):null;if(p&&A&&A<9){var B=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!B&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};i.Howler=t,i.Howl=n,typeof Ld<"u"?(Ld.HowlerGlobal=e,Ld.Howler=t,Ld.Howl=n,Ld.Sound=r):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)})();(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var r=n._howls.length-1;r>=0;r--)n._howls[r].stereo(t);return n},HowlerGlobal.prototype.pos=function(t,n,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(n=typeof n!="number"?s._pos[1]:n,r=typeof r!="number"?s._pos[2]:r,typeof t=="number")s._pos=[t,n,r],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(t,n,r,s,l,u){var h=this;if(!h.ctx||!h.ctx.listener)return h;var f=h._orientation;if(n=typeof n!="number"?f[1]:n,r=typeof r!="number"?f[2]:r,s=typeof s!="number"?f[3]:s,l=typeof l!="number"?f[4]:l,u=typeof u!="number"?f[5]:u,typeof t=="number")h._orientation=[t,n,r,s,l,u],typeof h.ctx.listener.forwardX<"u"?(h.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),h.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),h.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),h.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),h.ctx.listener.upY.setTargetAtTime(l,Howler.ctx.currentTime,.1),h.ctx.listener.upZ.setTargetAtTime(u,Howler.ctx.currentTime,.1)):h.ctx.listener.setOrientation(t,n,r,s,l,u);else return f;return h},Howl.prototype.init=(function(t){return function(n){var r=this;return r._orientation=n.orientation||[1,0,0],r._stereo=n.stereo||null,r._pos=n.pos||null,r._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},r._onstereo=n.onstereo?[{fn:n.onstereo}]:[],r._onpos=n.onpos?[{fn:n.onpos}]:[],r._onorientation=n.onorientation?[{fn:n.onorientation}]:[],t.call(this,n)}})(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(t,n)}}),r;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof t=="number")r._stereo=t,r._pos=[t,0,0];else return r._stereo;for(var l=r._getSoundIds(n),u=0;u<l.length;u++){var h=r._soundById(l[u]);if(h)if(typeof t=="number")h._stereo=t,h._pos=[t,0,0],h._node&&(h._pannerAttr.panningModel="equalpower",(!h._panner||!h._panner.pan)&&e(h,s),s==="spatial"?typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):h._panner.setPosition(t,0,0):h._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",h._id);else return h._stereo}return r},Howl.prototype.pos=function(t,n,r,s){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"pos",action:function(){l.pos(t,n,r,s)}}),l;if(n=typeof n!="number"?0:n,r=typeof r!="number"?-.5:r,typeof s>"u")if(typeof t=="number")l._pos=[t,n,r];else return l._pos;for(var u=l._getSoundIds(s),h=0;h<u.length;h++){var f=l._soundById(u[h]);if(f)if(typeof t=="number")f._pos=[t,n,r],f._node&&((!f._panner||f._panner.pan)&&e(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setPosition(t,n,r)),l._emit("pos",f._id);else return f._pos}return l},Howl.prototype.orientation=function(t,n,r,s){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"orientation",action:function(){l.orientation(t,n,r,s)}}),l;if(n=typeof n!="number"?l._orientation[1]:n,r=typeof r!="number"?l._orientation[2]:r,typeof s>"u")if(typeof t=="number")l._orientation=[t,n,r];else return l._orientation;for(var u=l._getSoundIds(s),h=0;h<u.length;h++){var f=l._soundById(u[h]);if(f)if(typeof t=="number")f._orientation=[t,n,r],f._node&&(f._panner||(f._pos||(f._pos=l._pos||[0,0,-.5]),e(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setOrientation(t,n,r)),l._emit("orientation",f._id);else return f._orientation}return l},Howl.prototype.pannerAttr=function(){var t=this,n=arguments,r,s,l;if(!t._webAudio)return t;if(n.length===0)return t._pannerAttr;if(n.length===1)if(typeof n[0]=="object")r=n[0],typeof s>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),t._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:t._panningModel});else return l=t._soundById(parseInt(n[0],10)),l?l._pannerAttr:t._pannerAttr;else n.length===2&&(r=n[0],s=parseInt(n[1],10));for(var u=t._getSoundIds(s),h=0;h<u.length;h++)if(l=t._soundById(u[h]),l){var f=l._pannerAttr;f={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:f.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:f.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:f.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:f.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:f.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:f.panningModel};var x=l._panner;x||(l._pos||(l._pos=t._pos||[0,0,-.5]),e(l,"spatial"),x=l._panner),x.coneInnerAngle=f.coneInnerAngle,x.coneOuterAngle=f.coneOuterAngle,x.coneOuterGain=f.coneOuterGain,x.distanceModel=f.distanceModel,x.maxDistance=f.maxDistance,x.refDistance=f.refDistance,x.rolloffFactor=f.rolloffFactor,x.panningModel=f.panningModel}return t},Sound.prototype.init=(function(t){return function(){var n=this,r=n._parent;n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,t.call(this),n._stereo?r.stereo(n._stereo):n._pos&&r.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}})(Sound.prototype.init),Sound.prototype.reset=(function(t){return function(){var n=this,r=n._parent;return n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,n._stereo?r.stereo(n._stereo):n._pos?r.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,r._refreshBuffer(n)),t.call(this)}})(Sound.prototype.reset);var e=function(t,n){n=n||"spatial",n==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(yb)),yb}var lG=oG(),up;(function(i){i.Documents="DOCUMENTS",i.Data="DATA",i.Library="LIBRARY",i.Cache="CACHE",i.External="EXTERNAL",i.ExternalStorage="EXTERNAL_STORAGE",i.ExternalCache="EXTERNAL_CACHE",i.LibraryNoCloud="LIBRARY_NO_CLOUD",i.Temporary="TEMPORARY"})(up||(up={}));var OI;(function(i){i.UTF8="utf8",i.ASCII="ascii",i.UTF16="utf16"})(OI||(OI={}));const P0=Bl("Filesystem",{web:()=>jt(()=>import("./chunk-1765887266800-web7.js"),[]).then(i=>new i.FilesystemWeb)});g4();class uG{constructor(){this.apiKey="sk_1d59e38548886708c7439a957aa38a7a5d5cbead7e840c4f",this.voiceId="EXAVITQu4vr4xnSDxMaL",this.baseUrl="https://api.elevenlabs.io/v1",this.audioCache=new Map,this.apiKey}setApiKey(e){this.apiKey=e}async generateSpeech(e){if(!this.apiKey)return null;if(this.audioCache.has(e))return this.audioCache.get(e);try{const t=await fetch(`${this.baseUrl}/text-to-speech/${this.voiceId}`,{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:e,model_id:"eleven_multilingual_v2",voice_settings:{stability:.5,similarity_boost:.75,style:0,use_speaker_boost:!0}})});if(!t.ok)throw new Error(`ElevenLabs API error: ${t.status} ${t.statusText}`);const n=await t.blob(),r=URL.createObjectURL(n);return this.audioCache.set(e,r),r}catch{return null}}async preGenerateBreathingPhrases(){const e=["ready","breathe in","hold","breathe out","rest","complete"],t=e.map(s=>this.generateSpeech(s));return(await Promise.all(t)).filter(s=>s!==null).length===e.length}async downloadAndSaveAudio(e,t){const n=await this.generateSpeech(e);if(!n)return null;try{const s=await(await fetch(n)).blob(),l=new FileReader;return new Promise((u,h)=>{l.onloadend=async()=>{const f=l.result.split(",")[1];try{const x=await P0.writeFile({path:`audio/${t}`,data:f,directory:up.Data});u(x.uri)}catch(x){h(x)}},l.onerror=h,l.readAsDataURL(s)})}catch{return null}}clearCache(){this.audioCache.forEach(e=>URL.revokeObjectURL(e)),this.audioCache.clear()}}const vb=new uG;class cG{constructor(){this.currentVoice="female",this.currentAudio=null,this.audioCache=new Map;const e="sk_1d59e38548886708c7439a957aa38a7a5d5cbead7e840c4f";this.useElevenLabs=!0,vb.setApiKey(e),this.voiceConfig={female:{voiceId:"en_us_002",name:"Aimee-like (Ultra Realistic)",rate:.05,volume:.4},male:{voiceId:"en_male_narration",name:"Deep Male (Meditation)",rate:.05,volume:.4}}}setVoice(e){this.currentVoice=e}generateVoiceURL(e){const t=this.currentVoice==="female"?"en_us_002":"en_male_narration",n=e.split(" ").map(s=>s.split("").join(" ")+"                                                  ").join("");return`https://api16-normal-c-useast1a.tiktokv.com/media/api/text/speech/invoke/?text_speaker=${t}&req_text=${encodeURIComponent(n)}&speaker_map_type=0&aid=1233`}enableElevenLabs(e){this.useElevenLabs=!0,vb.setApiKey(e)}async preGeneratePhrases(){return this.useElevenLabs?await vb.preGenerateBreathingPhrases():!1}async speak(e){this.stop();const n={ready:"/ready.mp3","breathe in":"/breathe-in.mp3",hold:"/hold.mp3","breathe out":"/breathe-out.mp3",rest:"/rest.mp3",complete:"/complete.mp3"}[e.toLowerCase()];if(n)try{await this.playAudioFile(n);return}catch{}await this.speakWithTTS(e)}async playAudioFile(e){return new Promise((t,n)=>{this.currentAudio=new lG.Howl({src:[e],html5:!0,volume:.8,onend:()=>{t()},onloaderror:(r,s)=>{n(s)},onplayerror:(r,s)=>{n(s)}}),this.currentAudio.play()})}async speakWithTTS(e){try{await rS.speak({text:e,lang:"en-US",rate:.85,pitch:1,volume:.7,category:"ambient"})}catch{}}stop(){this.currentAudio&&(this.currentAudio.stop(),this.currentAudio.unload(),this.currentAudio=null)}clearCache(){this.audioCache.clear()}}const Hc=new cG;class hG{constructor(){this.isActive=!1,this.currentPattern=null,this.currentCycle=0,this.totalCycles=0,this.voice="female",this.ambientSound=aG,this.tts=rS,this.audioService=Hc,this.useRealVoice=!0}patterns={box:{name:"Box Breathing",description:"Navy SEAL technique - Perfect for stress relief and focus",phases:[{type:"inhale",duration:4,text:"breathe in",audio:"/box-inhale.mp3"},{type:"hold",duration:4,text:"hold",audio:"/box-hold.mp3"},{type:"exhale",duration:4,text:"breathe out",audio:"/box-exhale.mp3"},{type:"hold",duration:4,text:"rest",audio:"/box-hold2.mp3"}],icon:"",benefits:["Reduces stress","Improves focus","Calms nervous system"],welcomeAudio:"/box-welcome.mp3",completeAudio:"/box-complete.mp3"},relaxing:{name:"4-7-8 Breathing",description:"Dr. Andrew Weil method - Induces natural sleep",phases:[{type:"inhale",duration:4,text:"breathe in",audio:"/box-inhale.mp3"},{type:"hold",duration:7,text:"hold",audio:"/box-hold.mp3"},{type:"exhale",duration:8,text:"breathe out slowly",audio:"/breathe-out-slowly.mp3"}],icon:"",benefits:["Promotes sleep","Reduces anxiety","Deep relaxation"],welcomeAudio:"/478-welcome.mp3",completeAudio:"/478-complete.mp3"},coherent:{name:"Coherent Breathing",description:"Heart Rate Variability optimization",phases:[{type:"inhale",duration:5,text:"breathe in",audio:"/box-inhale.mp3"},{type:"exhale",duration:5,text:"breathe out",audio:"/box-exhale.mp3"}],icon:"",benefits:["Heart health","Mental clarity","Emotional balance"],welcomeAudio:"/coherent-welcome.mp3",completeAudio:"/coherent-complete.mp3"},energizing:{name:"Energizing Breath",description:"Morning boost - Increases alertness",phases:[{type:"inhale",duration:4,text:"breathe in",audio:"/box-inhale.mp3"},{type:"hold",duration:2,text:"hold",audio:"/box-hold.mp3"},{type:"exhale",duration:4,text:"breathe out",audio:"/box-exhale.mp3"},{type:"hold",duration:2,text:"rest",audio:"/rest.mp3"}],icon:"",benefits:["Boosts energy","Improves alertness","Morning wake-up"],welcomeAudio:"/energizing-welcome.mp3",completeAudio:"/energizing-complete.mp3"},deepRelax:{name:"Deep Relaxation",description:"Extended exhale for maximum calm",phases:[{type:"inhale",duration:4,text:"breathe in",audio:"/box-inhale.mp3"},{type:"hold",duration:4,text:"hold",audio:"/box-hold.mp3"},{type:"exhale",duration:6,text:"breathe out slowly",audio:"/breathe-out-slowly.mp3"},{type:"hold",duration:2,text:"rest",audio:"/rest.mp3"}],icon:"",benefits:["Deep relaxation","Meditation support","Stress relief"],welcomeAudio:"/relaxation-welcome.mp3",completeAudio:"/relaxation-complete.mp3"}};getPatterns(){return Object.entries(this.patterns).map(([e,t])=>({id:e,...t}))}setVoice(e){this.voice=e,this.audioService.setVoice(e),localStorage.setItem("breathing_voice_preference",e)}getVoicePreference(){return localStorage.getItem("breathing_voice_preference")||"female"}async speak(e,t=.65,n=null){try{if(n)await this.audioService.playAudioFile(n);else if(this.useRealVoice)await this.audioService.speak(e);else{const r=this.voice==="female";await this.tts.speak({text:e,lang:"en-US",rate:r?.65:.6,pitch:r?1.3:.7,volume:1,category:"ambient"})}}catch{}}async startExercise(e,t=5,n,r,s){const l=this.patterns[e];if(!l)throw new Error("Invalid pattern");this.isActive=!0,this.currentPattern=l,this.currentCycle=0;const u=l.phases.reduce((f,x)=>f+x.duration,0);this.totalCycles=Math.floor(t*60/u),await this.ambientSound.start(),await this.sleep(1e3);const h=l.welcomeAudio||null;await this.speak("ready",.5,h),await this.sleep(2e3);for(let f=0;f<this.totalCycles&&this.isActive;f++){this.currentCycle=f+1;for(const x of l.phases){if(!this.isActive)break;n&&n({phase:x.type,text:x.text,duration:x.duration,cycle:this.currentCycle,totalCycles:this.totalCycles});const p=x.audio||null;this.speak(x.text,0,p);for(let w=0;w<x.duration&&this.isActive;w++)await this.sleep(1e3)}r&&this.isActive&&r(this.currentCycle,this.totalCycles)}if(this.isActive&&s){const f=l.completeAudio||null;await this.speak("complete",.5,f),await this.sleep(2e3),this.ambientSound.stop(),this.logSession(e,t),s({pattern:l.name,cycles:this.currentCycle,duration:t})}this.isActive=!1}async stopExercise(){this.isActive=!1,this.ambientSound.stop(),this.audioService.stop();try{await this.tts.stop()}catch{}}sleep(e){return new Promise(t=>setTimeout(t,e))}async logSession(e,t){const n=JSON.parse(localStorage.getItem("breathing_history")||"[]"),r={pattern:this.patterns[e].name,patternId:e,duration:t,cycles:this.currentCycle,timestamp:Date.now(),date:new Date().toISOString().split("T")[0]};n.push(r),localStorage.setItem("breathing_history",JSON.stringify(n));let s=[];try{s=await mi.get("meditationLog",Ti.getCurrentUser()?.uid)||[]}catch{s=JSON.parse(localStorage.getItem("meditationLog")||"[]")}s.push({type:"breathing",duration:t,timestamp:Date.now(),date:new Date().toISOString().split("T")[0]}),localStorage.setItem("meditationLog",JSON.stringify(s));try{await mi.save("meditationLog",s,Ti.getCurrentUser()?.uid)}catch{}}getHistory(e=30){const t=JSON.parse(localStorage.getItem("breathing_history")||"[]"),n=new Date;return n.setDate(n.getDate()-e),t.filter(r=>new Date(r.timestamp)>n)}getStats(){const e=this.getHistory(30),t=e.length,n=e.reduce((u,h)=>u+h.duration,0),r=e.reduce((u,h)=>u+h.cycles,0),s={};e.forEach(u=>{s[u.pattern]=(s[u.pattern]||0)+1});const l=Object.entries(s).sort((u,h)=>h[1]-u[1])[0];return{totalSessions:t,totalMinutes:n,totalCycles:r,averageMinutesPerSession:t>0?Math.round(n/t):0,favoritePattern:l?l[0]:null,streak:this.calculateStreak(e)}}calculateStreak(e){if(e.length===0)return 0;const t=[...new Set(e.map(l=>l.date))].sort().reverse();let n=0;const r=new Date().toISOString().split("T")[0];let s=new Date(r);for(const l of t){const u=new Date(l),h=Math.floor((s-u)/(1e3*60*60*24));if(h===n)n++;else if(h>n)break}return n}}const Rg=new hG,MI="wellnessai_gamification",r0={1:0,2:100,3:250,4:450,5:600,6:1e3,7:1500,8:2100,9:2800,10:3600,11:4500,12:5500,13:6600,14:7800,15:9100,16:10500,17:12e3,18:13600,19:15300,20:17100},Tu={FIRST_STEP:{id:"first_step",name:"First Step",description:"Log your first activity",icon:"",xp:10},FIRE_STARTER:{id:"fire_starter",name:"Fire Starter",description:"Reach a 3-day streak",icon:"",xp:25},WEEK_WARRIOR:{id:"week_warrior",name:"Week Warrior",description:"Maintain a 7-day streak",icon:"",xp:50},HYDRATION_HERO:{id:"hydration_hero",name:"Hydration Hero",description:"Drink 8 glasses of water in one day",icon:"",xp:20},NUTRITION_NINJA:{id:"nutrition_ninja",name:"Nutrition Ninja",description:"Log 7 days of healthy meals",icon:"",xp:40},STRENGTH_PRO:{id:"strength_pro",name:"Strength Pro",description:"Complete 10 workouts",icon:"",xp:50},MARATHON_MASTER:{id:"marathon_master",name:"Marathon Master",description:"Walk 100,000 steps total",icon:"",xp:100},SCANNER_SAVVY:{id:"scanner_savvy",name:"Scanner Savvy",description:"Scan 20 food items",icon:"",xp:30},ZEN_MASTER:{id:"zen_master",name:"Zen Master",description:"Complete 10 meditation sessions",icon:"",xp:40},PERFECT_DAY:{id:"perfect_day",name:"Perfect Day",description:"Complete all daily goals in one day",icon:"",xp:50}};class dG{constructor(){this.syncService=null,this.loadData()}setSyncService(e){this.syncService=e}async loadData(){if(this.syncService){const t=await mi.get("gamification_data",Ti.getCurrentUser()?.uid);if(t){this.data=t;return}}const e=localStorage.getItem(MI);if(e){this.data=JSON.parse(e),this.syncService&&await mi.save("gamification_data",this.data,Ti.getCurrentUser()?.uid);return}this.data={level:1,xp:0,totalXP:0,streak:0,longestStreak:0,lastCheckIn:null,achievements:[],stats:{totalSteps:0,totalWater:0,totalMeals:0,totalWorkouts:0,totalScans:0,totalMeditations:0,perfectDays:0}},await this.migrateOldData()}async migrateOldData(){try{const e=JSON.parse(localStorage.getItem("unlocked_achievements")||"[]"),t=parseInt(localStorage.getItem("user_level")||"0"),n=parseInt(localStorage.getItem("user_xp")||"0"),r=parseInt(localStorage.getItem("login_streak")||"0"),s=parseInt(localStorage.getItem("workout_count")||"0"),l=parseInt(localStorage.getItem("meals_logged")||"0"),h=JSON.parse(localStorage.getItem("foodLog")||"[]").length;if(e.length>0||t>0||n>0||r>0||s>0||l>0||h>0){t>this.data.level&&(this.data.level=t),n>this.data.totalXP&&(this.data.totalXP=n,this.data.xp=n),r>this.data.streak&&(this.data.streak=r,this.data.longestStreak=r),s>this.data.stats.totalWorkouts&&(this.data.stats.totalWorkouts=s);const x=Math.max(l,h);x>this.data.stats.totalMeals&&(this.data.stats.totalMeals=x),e.length>0&&e.forEach(p=>{this.hasAchievement(p)||this.data.achievements.push({id:p,unlockedAt:new Date().toISOString()})}),await this.saveData(),localStorage.removeItem("unlocked_achievements"),localStorage.removeItem("user_level"),localStorage.removeItem("user_xp"),localStorage.removeItem("login_streak"),localStorage.removeItem("workout_count"),localStorage.removeItem("meals_logged")}}catch(e){console.error(" [MIGRATION] Error migrating old data:",e)}}async saveData(){this.syncService?await mi.save("gamification_data",this.data,Ti.getCurrentUser()?.uid):localStorage.setItem(MI,JSON.stringify(this.data))}async addXP(e,t=""){this.data.xp+=e,this.data.totalXP+=e;const n=this.checkLevelUp();return await this.saveData(),{xpGained:e,currentXP:this.data.xp,currentLevel:this.data.level,leveledUp:n,reason:t}}checkLevelUp(){const e=this.data.level+1,t=r0[e];return t&&this.data.totalXP>=t?(this.data.level=e,this.data.xp=0,!0):!1}getXPToNextLevel(){const e=this.data.level+1,t=r0[e];return t?t-this.data.totalXP:0}getLevelInfo(){const e=this.data.level+1,t=r0[e],n=r0[this.data.level];return{level:this.data.level,xp:this.data.xp,totalXP:this.data.totalXP,xpToNext:t?t-this.data.totalXP:0,xpForCurrentLevel:t?t-n:0,progress:t?(this.data.totalXP-n)/(t-n)*100:100}}async checkIn(){const e=new Date().toDateString(),t=this.data.lastCheckIn?new Date(this.data.lastCheckIn).toDateString():null;if(t===e)return{alreadyCheckedIn:!0,streak:this.data.streak};const n=new Date;n.setDate(n.getDate()-1);const r=n.toDateString();t===r?this.data.streak+=1:t===null?this.data.streak=1:this.data.streak=1,this.data.lastCheckIn=new Date().toISOString(),this.data.streak>this.data.longestStreak&&(this.data.longestStreak=this.data.streak);const s=await this.addXP(10,"Daily check-in");return this.checkStreakAchievements(),await this.saveData(),{alreadyCheckedIn:!1,streak:this.data.streak,longestStreak:this.data.longestStreak,xpGained:s.xpGained,leveledUp:s.leveledUp}}checkStreakAchievements(){this.data.streak>=3&&!this.hasAchievement("fire_starter")&&this.unlockAchievement(Tu.FIRE_STARTER),this.data.streak>=7&&!this.hasAchievement("week_warrior")&&this.unlockAchievement(Tu.WEEK_WARRIOR)}async unlockAchievement(e){if(this.hasAchievement(e.id))return{alreadyUnlocked:!0};this.data.achievements.push({id:e.id,unlockedAt:new Date().toISOString()});const t=await this.addXP(e.xp,`Achievement: ${e.name}`);return await this.saveData(),{alreadyUnlocked:!1,achievement:e,xpGained:t.xpGained,leveledUp:t.leveledUp}}hasAchievement(e){return this.data.achievements.some(t=>t.id===e)}getAllAchievements(){return Object.values(Tu).map(e=>({...e,unlocked:this.hasAchievement(e.id),unlockedAt:this.data.achievements.find(t=>t.id===e.id)?.unlockedAt}))}logActivity(e,t={}){let n=0,r="";switch(e){case"steps":this.data.stats.totalSteps+=t.steps||0,n=Math.floor((t.steps||0)/1e3)*2,r=`${t.steps} steps logged`,this.data.stats.totalSteps>=1e5&&!this.hasAchievement("marathon_master")&&this.unlockAchievement(Tu.MARATHON_MASTER);break;case"water":this.data.stats.totalWater+=t.cups||0,n=(t.cups||0)*2,r=`${t.cups} cups of water logged`,t.dailyTotal>=8&&!this.hasAchievement("hydration_hero")&&this.unlockAchievement(Tu.HYDRATION_HERO);break;case"meal":this.data.stats.totalMeals+=1,n=10,r="Meal logged",this.data.stats.totalMeals>=21&&!this.hasAchievement("nutrition_ninja")&&this.unlockAchievement(Tu.NUTRITION_NINJA);break;case"workout":this.data.stats.totalWorkouts+=1,n=15,r="Workout completed",this.data.stats.totalWorkouts>=10&&!this.hasAchievement("strength_pro")&&this.unlockAchievement(Tu.STRENGTH_PRO);break;case"scan":this.data.stats.totalScans+=1,n=3,r="Food scanned",this.data.stats.totalScans>=20&&!this.hasAchievement("scanner_savvy")&&this.unlockAchievement(Tu.SCANNER_SAVVY);break;case"meditation":this.data.stats.totalMeditations+=1,n=12,r="Meditation completed",this.data.stats.totalMeditations>=10&&!this.hasAchievement("zen_master")&&this.unlockAchievement(Tu.ZEN_MASTER);break;case"perfect_day":this.data.stats.perfectDays+=1,n=50,r="Perfect Day!",this.hasAchievement("perfect_day")||this.unlockAchievement(Tu.PERFECT_DAY);break}return n>0?this.addXP(n,r):null}getStreakInfo(){const e=new Date().toDateString(),t=this.data.lastCheckIn?new Date(this.data.lastCheckIn).toDateString():null;return{streak:this.data.streak,longestStreak:this.data.longestStreak,checkedInToday:t===e,lastCheckIn:this.data.lastCheckIn}}getStats(){return{...this.data.stats,level:this.data.level,totalXP:this.data.totalXP,streak:this.data.streak,longestStreak:this.data.longestStreak,achievementsUnlocked:this.data.achievements.length,totalAchievements:Object.keys(Tu).length}}async reset(){this.data={level:1,xp:0,totalXP:0,streak:0,longestStreak:0,lastCheckIn:null,achievements:[],stats:{totalSteps:0,totalWater:0,totalMeals:0,totalWorkouts:0,totalScans:0,totalMeditations:0,perfectDays:0}},await this.saveData()}getGlobalLeaderboard(e="totalXP",t=50){const n=[];return n.push({userId:"You",username:"You",level:this.data.level,totalXP:this.data.totalXP,streak:this.data.streak,totalSteps:this.data.stats.totalSteps,profilePic:"",isCurrentUser:!0}),[{name:"FitnessFanatic",level:18,xp:12800,streak:45,steps:485e3},{name:"HealthHero22",level:15,xp:9500,streak:28,steps:32e4},{name:"WellnessWarrior",level:20,xp:17500,streak:67,steps:62e4},{name:"StepMaster",level:12,xp:5800,streak:15,steps:28e4},{name:"GymLegend",level:16,xp:11200,streak:32,steps:41e4},{name:"ZenQueen",level:14,xp:8100,streak:21,steps:195e3},{name:"CardioKing",level:19,xp:14900,streak:52,steps:55e4},{name:"NutritionNerd",level:13,xp:6900,streak:18,steps:245e3},{name:"MarathonMike",level:17,xp:12100,streak:38,steps:48e4},{name:"YogaYoda",level:11,xp:4900,streak:12,steps:165e3}].forEach((s,l)=>{n.push({userId:`user_${l}`,username:s.name,level:s.level,totalXP:s.xp,streak:s.streak,totalSteps:s.steps,profilePic:["","","","",""][l%5],isCurrentUser:!1})}),n.sort((s,l)=>{switch(e){case"totalXP":return l.totalXP-s.totalXP;case"level":return l.level-s.level;case"streak":return l.streak-s.streak;case"totalSteps":return l.totalSteps-s.totalSteps;default:return l.totalXP-s.totalXP}}),n.forEach((s,l)=>{s.rank=l+1}),n.slice(0,t)}getBattleRewards(){return{availableRewards:[{id:"xp_boost",name:"XP Boost (2x)",cost:500,icon:"",description:"2x XP for 24 hours"},{id:"streak_freeze",name:"Streak Freeze",cost:300,icon:"",description:"Protect streak for 1 day"},{id:"power_up",name:"Battle Power-Up",cost:400,icon:"",description:"+10% performance in battles"},{id:"legendary_badge",name:"Legendary Badge",cost:1e3,icon:"",description:"Exclusive profile badge"},{id:"custom_avatar",name:"Custom Avatar",cost:800,icon:"",description:"Unlock avatar customization"}],userCoins:this.data.totalXP/10,purchasedRewards:[]}}awardBattleVictory(e,t){const n={quick:50,weekly:100,monthly:250,tournament:500}[e]||50,r=t>=90?1.5:t>=75?1.25:1,s=Math.floor(n*r);return this.addXP(s),{xpAwarded:s,newLevel:this.data.level,totalXP:this.data.totalXP}}}const lf=new dG,fG=Object.freeze(Object.defineProperty({__proto__:null,default:lf},Symbol.toStringTag,{value:"Module"}));var FI;(function(i){i.Heavy="HEAVY",i.Medium="MEDIUM",i.Light="LIGHT"})(FI||(FI={}));var jI;(function(i){i.Success="SUCCESS",i.Warning="WARNING",i.Error="ERROR"})(jI||(jI={}));const DY=Bl("Haptics",{web:()=>jt(()=>import("./chunk-1765887266800-web8.js"),[]).then(i=>new i.HapticsWeb)});class pG{constructor(){this.plans={free:{id:"free",name:"Free",price:0,features:{basicTracking:!0,stepCounter:!0,foodScanner:"limited",meditation:!1,aiVoiceCoach:"limited",waterTracking:!0,dnaAnalysis:!1,socialBattles:"basic",insuranceRewards:!1,mealAutomation:!1,healthAvatar:!1,arScanner:!1,emergencyPanel:!1,appleHealthSync:!1,wearableSync:!1,exportReports:!1,heartRate:!1,sleepTracking:!1,workouts:!1,breathing:!1,pdfExport:!1},limits:{aiMessages:10,foodScans:3,arScans:0,workouts:0}},essential:{id:"essential",name:"Essential",price:4.99,billing:"monthly",features:{basicTracking:!0,stepCounter:!0,foodScanner:!0,meditation:!0,waterTracking:!0,aiVoiceCoach:!0,dnaAnalysis:"basic",socialBattles:!0,insuranceRewards:!1,mealAutomation:!1,healthAvatar:"weekly",arScanner:"limited",emergencyPanel:!0,appleHealthSync:!1,wearableSync:!1,exportReports:!1,heartRate:!0,sleepTracking:!0,workouts:!0,breathing:!0,pdfExport:!1},limits:{aiMessages:30,foodScans:999999,arScans:1,workouts:999999}},premium:{id:"premium",name:"Premium",price:14.99,billing:"monthly",features:{basicTracking:!0,stepCounter:!0,foodScanner:!0,meditation:!0,waterTracking:!0,aiVoiceCoach:!0,dnaAnalysis:!0,socialBattles:!0,insuranceRewards:!1,mealAutomation:!0,healthAvatar:"daily",arScanner:!0,emergencyPanel:!0,appleHealthSync:!1,wearableSync:!1,exportReports:!0,heartRate:!0,sleepTracking:!0,workouts:!0,breathing:!0,pdfExport:!0},limits:{aiMessages:50,foodScans:999999,arScans:100,workouts:999999}},vip:{id:"vip",name:"VIP",price:29.99,billing:"monthly",features:{basicTracking:!0,stepCounter:!0,foodScanner:!0,meditation:!0,waterTracking:!0,aiVoiceCoach:"unlimited",dnaAnalysis:!0,socialBattles:!0,insuranceRewards:!1,mealAutomation:!0,healthAvatar:"realtime",arScanner:"unlimited",emergencyPanel:!0,appleHealthSync:!1,wearableSync:!1,exportReports:!0,heartRate:!0,sleepTracking:!0,workouts:!0,breathing:!0,pdfExport:!0},limits:{aiMessages:999999,foodScans:999999,arScans:999999,workouts:999999}}}}getCurrentPlan(){const e=localStorage.getItem("subscription_plan")||"free";return this.plans[e]||this.plans.free}async verifySubscriptionWithServer(e){try{const t=localStorage.getItem("subscription_last_verified"),n=360*60*1e3;if(t&&Date.now()-parseInt(t)<n)return;const s=await fetch(`https://helio-wellness-app-production.up.railway.app/api/subscription/status/${e}`);if(!s.ok)throw new Error("Failed to verify subscription");const l=await s.json();l.isActive&&l.plan!=="free"?(localStorage.setItem("subscription_plan",l.plan),localStorage.setItem("subscription_status",l.status),localStorage.setItem("subscription_period_end",l.currentPeriodEnd)):(localStorage.setItem("subscription_plan","free"),localStorage.setItem("subscription_status","none")),localStorage.setItem("subscription_last_verified",Date.now().toString())}catch(t){console.error("Error verifying subscription:",t)}}hasAccess(e){try{if(localStorage.getItem("helio_dev_mode")==="true")return!0}catch{}const t=this.getCurrentPlan();return t.features[e]===!0||t.features[e]==="unlimited"}checkLimit(e){try{if(localStorage.getItem("helio_dev_mode")==="true")return{allowed:!0,remaining:999999,limit:999999}}catch{}const t=this.getCurrentPlan(),n=new Date().toISOString().split("T")[0],r=`${e}_usage_${n}`,s=parseInt(localStorage.getItem(r)||"0"),l=t.limits[e];return l?{allowed:s<l,remaining:Math.max(0,l-s),limit:l}:{allowed:!0,remaining:999999}}incrementUsage(e){const t=new Date().toISOString().split("T")[0],n=`${e}_usage_${t}`,r=parseInt(localStorage.getItem(n)||"0");localStorage.setItem(n,(r+1).toString())}getUpgradeMessage(e){return{dnaAnalysis:" DNA Analysis requires Essential plan or higher",socialBattles:" Social Battles requires Essential plan or higher",insuranceRewards:" Insurance Rewards - Coming Soon",mealAutomation:" Meal Automation requires Premium plan (14.99/mo)",healthAvatar:" Health Avatar requires Essential plan or higher",arScanner:" AR Scanner requires Essential plan or higher",emergencyPanel:" Emergency Panel requires Essential plan (4.99/mo)",appleHealthSync:" Apple Health Sync - Coming Soon",wearableSync:" Wearable Integration - Coming Soon",exportReports:" Export Reports requires Premium plan (14.99/mo)",meditation:" Meditation Library requires Essential plan (4.99/mo)",heartRate:" Heart Rate Tracking requires Essential plan (4.99/mo)",sleepTracking:" Sleep Tracking requires Essential plan (4.99/mo)",workouts:" Workout Library requires Essential plan (4.99/mo)",breathing:" Breathing Exercises requires Essential plan (4.99/mo)",pdfExport:" PDF Export requires Premium plan (14.99/mo)"}[e]||"This feature requires a paid plan"}getPlanBadge(){const e=this.getCurrentPlan(),t={free:" Free",essential:" Essential",premium:" Premium",vip:" VIP"};return t[e.id]||t.free}canUpgradeTo(e){const t=this.getCurrentPlan(),n={free:0,essential:1,premium:2,vip:3};return n[e]>n[t.id]}showPaywall(e,t){const n=this.getUpgradeMessage(e),r=this.getCurrentPlan(),s=["insuranceRewards","appleHealthSync","wearableSync","exportReports"];return{show:!0,message:n,currentPlan:r.id,requiredPlan:"premium",isComingSoon:s.includes(e),onUpgrade:t}}}const or=new pG;function zr(i){"@babel/helpers - typeof";return zr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zr(i)}var Nu=Uint8Array,zl=Uint16Array,sS=Int32Array,aS=new Nu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oS=new Nu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),VI=new Nu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m4=function(i,e){for(var t=new zl(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var r=new sS(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)r[s]=s-t[n]<<5|n;return{b:t,r}},y4=m4(aS,2),gG=y4.b,$x=y4.r;gG[28]=258,$x[258]=28;var mG=m4(oS,0),zI=mG.r,Hx=new zl(32768);for(var _s=0;_s<32768;++_s){var Rh=(_s&43690)>>1|(_s&21845)<<1;Rh=(Rh&52428)>>2|(Rh&13107)<<2,Rh=(Rh&61680)>>4|(Rh&3855)<<4,Hx[_s]=((Rh&65280)>>8|(Rh&255)<<8)>>1}var rm=(function(i,e,t){for(var n=i.length,r=0,s=new zl(e);r<n;++r)i[r]&&++s[i[r]-1];var l=new zl(e);for(r=1;r<e;++r)l[r]=l[r-1]+s[r-1]<<1;var u;if(t){u=new zl(1<<e);var h=15-e;for(r=0;r<n;++r)if(i[r])for(var f=r<<4|i[r],x=e-i[r],p=l[i[r]-1]++<<x,w=p|(1<<x)-1;p<=w;++p)u[Hx[p]>>h]=f}else for(u=new zl(n),r=0;r<n;++r)i[r]&&(u[r]=Hx[l[i[r]-1]++]>>15-i[r]);return u}),uf=new Nu(288);for(var _s=0;_s<144;++_s)uf[_s]=8;for(var _s=144;_s<256;++_s)uf[_s]=9;for(var _s=256;_s<280;++_s)uf[_s]=7;for(var _s=280;_s<288;++_s)uf[_s]=8;var D1=new Nu(32);for(var _s=0;_s<32;++_s)D1[_s]=5;var yG=rm(uf,9,0),vG=rm(D1,5,0),v4=function(i){return(i+7)/8|0},_G=function(i,e,t){return(t==null||t>i.length)&&(t=i.length),new Nu(i.subarray(e,t))},Oc=function(i,e,t){t<<=e&7;var n=e/8|0;i[n]|=t,i[n+1]|=t>>8},Dg=function(i,e,t){t<<=e&7;var n=e/8|0;i[n]|=t,i[n+1]|=t>>8,i[n+2]|=t>>16},_b=function(i,e){for(var t=[],n=0;n<i.length;++n)i[n]&&t.push({s:n,f:i[n]});var r=t.length,s=t.slice();if(!r)return{t:b4,l:0};if(r==1){var l=new Nu(t[0].s+1);return l[t[0].s]=1,{t:l,l:1}}t.sort(function(Ce,Ve){return Ce.f-Ve.f}),t.push({s:-1,f:25001});var u=t[0],h=t[1],f=0,x=1,p=2;for(t[0]={s:-1,f:u.f+h.f,l:u,r:h};x!=r-1;)u=t[t[f].f<t[p].f?f++:p++],h=t[f!=x&&t[f].f<t[p].f?f++:p++],t[x++]={s:-1,f:u.f+h.f,l:u,r:h};for(var w=s[0].s,n=1;n<r;++n)s[n].s>w&&(w=s[n].s);var A=new zl(w+1),B=Gx(t[x-1],A,0);if(B>e){var n=0,$=0,W=B-e,q=1<<W;for(s.sort(function(Ve,pe){return A[pe.s]-A[Ve.s]||Ve.f-pe.f});n<r;++n){var ge=s[n].s;if(A[ge]>e)$+=q-(1<<B-A[ge]),A[ge]=e;else break}for($>>=W;$>0;){var he=s[n].s;A[he]<e?$-=1<<e-A[he]++-1:++n}for(;n>=0&&$;--n){var me=s[n].s;A[me]==e&&(--A[me],++$)}B=e}return{t:new Nu(A),l:B}},Gx=function(i,e,t){return i.s==-1?Math.max(Gx(i.l,e,t+1),Gx(i.r,e,t+1)):e[i.s]=t},UI=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new zl(++e),n=0,r=i[0],s=1,l=function(h){t[n++]=h},u=1;u<=e;++u)if(i[u]==r&&u!=e)++s;else{if(!r&&s>2){for(;s>138;s-=138)l(32754);s>2&&(l(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(l(r),--s;s>6;s-=6)l(8304);s>2&&(l(s-3<<5|8208),s=0)}for(;s--;)l(r);s=1,r=i[u]}return{c:t.subarray(0,n),n:e}},Lg=function(i,e){for(var t=0,n=0;n<e.length;++n)t+=i[n]*e[n];return t},_4=function(i,e,t){var n=t.length,r=v4(e+2);i[r]=n&255,i[r+1]=n>>8,i[r+2]=i[r]^255,i[r+3]=i[r+1]^255;for(var s=0;s<n;++s)i[r+s+4]=t[s];return(r+4+n)*8},BI=function(i,e,t,n,r,s,l,u,h,f,x){Oc(e,x++,t),++r[256];for(var p=_b(r,15),w=p.t,A=p.l,B=_b(s,15),$=B.t,W=B.l,q=UI(w),ge=q.c,he=q.n,me=UI($),Ce=me.c,Ve=me.n,pe=new zl(19),ee=0;ee<ge.length;++ee)++pe[ge[ee]&31];for(var ee=0;ee<Ce.length;++ee)++pe[Ce[ee]&31];for(var J=_b(pe,7),ye=J.t,X=J.l,ae=19;ae>4&&!ye[VI[ae-1]];--ae);var le=f+5<<3,ze=Lg(r,uf)+Lg(s,D1)+l,nt=Lg(r,w)+Lg(s,$)+l+14+3*ae+Lg(pe,ye)+2*pe[16]+3*pe[17]+7*pe[18];if(h>=0&&le<=ze&&le<=nt)return _4(e,x,i.subarray(h,h+f));var je,Je,qe,lt;if(Oc(e,x,1+(nt<ze)),x+=2,nt<ze){je=rm(w,A,0),Je=w,qe=rm($,W,0),lt=$;var Tt=rm(ye,X,0);Oc(e,x,he-257),Oc(e,x+5,Ve-1),Oc(e,x+10,ae-4),x+=14;for(var ee=0;ee<ae;++ee)Oc(e,x+3*ee,ye[VI[ee]]);x+=3*ae;for(var Ne=[ge,Ce],se=0;se<2;++se)for(var Ee=Ne[se],ee=0;ee<Ee.length;++ee){var Le=Ee[ee]&31;Oc(e,x,Tt[Le]),x+=ye[Le],Le>15&&(Oc(e,x,Ee[ee]>>5&127),x+=Ee[ee]>>12)}}else je=yG,Je=uf,qe=vG,lt=D1;for(var ee=0;ee<u;++ee){var Be=n[ee];if(Be>255){var Le=Be>>18&31;Dg(e,x,je[Le+257]),x+=Je[Le+257],Le>7&&(Oc(e,x,Be>>23&31),x+=aS[Le]);var He=Be&31;Dg(e,x,qe[He]),x+=lt[He],He>3&&(Dg(e,x,Be>>5&8191),x+=oS[He])}else Dg(e,x,je[Be]),x+=Je[Be]}return Dg(e,x,je[256]),x+Je[256]},bG=new sS([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),b4=new Nu(0),xG=function(i,e,t,n,r,s){var l=s.z||i.length,u=new Nu(n+l+5*(1+Math.ceil(l/7e3))+r),h=u.subarray(n,u.length-r),f=s.l,x=(s.r||0)&7;if(e){x&&(h[0]=s.r>>3);for(var p=bG[e-1],w=p>>13,A=p&8191,B=(1<<t)-1,$=s.p||new zl(32768),W=s.h||new zl(B+1),q=Math.ceil(t/3),ge=2*q,he=function(kt){return(i[kt]^i[kt+1]<<q^i[kt+2]<<ge)&B},me=new sS(25e3),Ce=new zl(288),Ve=new zl(32),pe=0,ee=0,J=s.i||0,ye=0,X=s.w||0,ae=0;J+2<l;++J){var le=he(J),ze=J&32767,nt=W[le];if($[ze]=nt,W[le]=ze,X<=J){var je=l-J;if((pe>7e3||ye>24576)&&(je>423||!f)){x=BI(i,h,0,me,Ce,Ve,ee,ye,ae,J-ae,x),ye=pe=ee=0,ae=J;for(var Je=0;Je<286;++Je)Ce[Je]=0;for(var Je=0;Je<30;++Je)Ve[Je]=0}var qe=2,lt=0,Tt=A,Ne=ze-nt&32767;if(je>2&&le==he(J-Ne))for(var se=Math.min(w,je)-1,Ee=Math.min(32767,J),Le=Math.min(258,je);Ne<=Ee&&--Tt&&ze!=nt;){if(i[J+qe]==i[J+qe-Ne]){for(var Be=0;Be<Le&&i[J+Be]==i[J+Be-Ne];++Be);if(Be>qe){if(qe=Be,lt=Ne,Be>se)break;for(var He=Math.min(Ne,Be-2),Ye=0,Je=0;Je<He;++Je){var it=J-Ne+Je&32767,ct=$[it],Et=it-ct&32767;Et>Ye&&(Ye=Et,nt=it)}}}ze=nt,nt=$[ze],Ne+=ze-nt&32767}if(lt){me[ye++]=268435456|$x[qe]<<18|zI[lt];var Ft=$x[qe]&31,Wt=zI[lt]&31;ee+=aS[Ft]+oS[Wt],++Ce[257+Ft],++Ve[Wt],X=J+qe,++pe}else me[ye++]=i[J],++Ce[i[J]]}}for(J=Math.max(J,X);J<l;++J)me[ye++]=i[J],++Ce[i[J]];x=BI(i,h,f,me,Ce,Ve,ee,ye,ae,J-ae,x),f||(s.r=x&7|h[x/8|0]<<3,x-=7,s.h=W,s.p=$,s.i=J,s.w=X)}else{for(var J=s.w||0;J<l+f;J+=65535){var qt=J+65535;qt>=l&&(h[x/8|0]=f,qt=l),x=_4(h,x+1,i.subarray(J,qt))}s.i=l}return _G(u,0,n+v4(x)+r)},x4=function(){var i=1,e=0;return{p:function(t){for(var n=i,r=e,s=t.length|0,l=0;l!=s;){for(var u=Math.min(l+2655,s);l<u;++l)r+=n+=t[l];n=(n&65535)+15*(n>>16),r=(r&65535)+15*(r>>16)}i=n,e=r},d:function(){return i%=65521,e%=65521,(i&255)<<24|(i&65280)<<8|(e&255)<<8|e>>8}}},wG=function(i,e,t,n,r){if(!r&&(r={l:1},e.dictionary)){var s=e.dictionary.subarray(-32768),l=new Nu(s.length+i.length);l.set(s),l.set(i,s.length),i=l,r.w=s.length}return xG(i,e.level==null?6:e.level,e.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):20:12+e.mem,t,n,r)},w4=function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},SG=function(i,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;if(i[0]=120,i[1]=n<<6|(e.dictionary&&32),i[1]|=31-(i[0]<<8|i[1])%31,e.dictionary){var r=x4();r.p(e.dictionary),w4(i,2,r.d())}};function Kx(i,e){e||(e={});var t=x4();t.p(i);var n=wG(i,e,e.dictionary?6:2,4);return SG(n,e),w4(n,n.length-4,t.d()),n}var TG=typeof TextDecoder<"u"&&new TextDecoder,AG=0;try{TG.decode(b4,{stream:!0}),AG=1}catch{}function EG(i){if(Array.isArray(i))return i}function IG(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,l,u=[],h=!0,f=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(h=(n=s.call(t)).done)&&(u.push(n.value),u.length!==e);h=!0);}catch(x){f=!0,r=x}finally{try{if(!h&&t.return!=null&&(l=t.return(),Object(l)!==l))return}finally{if(f)throw r}}return u}}function $I(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function kG(i,e){if(i){if(typeof i=="string")return $I(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?$I(i,e):void 0}}function CG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HI(i,e){return EG(i)||IG(i,e)||kG(i,e)||CG()}function GI(i,e="utf8"){return new TextDecoder(e).decode(i)}const RG=new TextEncoder;function DG(i){return RG.encode(i)}const LG=1024*8,NG=(()=>{const i=new Uint8Array(4),e=new Uint32Array(i.buffer);return!((e[0]=1)&i[0])})(),bb={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class lS{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=LG,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,s=e.byteLength-r;let l=r;(ArrayBuffer.isView(e)||e instanceof lS)&&(e.byteLength!==e.buffer.byteLength&&(l=e.byteOffset+r),e=e.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=l,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,l,s),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,r=new Uint8Array(n);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=bb[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,s=this.buffer.slice(r,r+n);if(this.littleEndian===NG&&t!=="uint8"&&t!=="int8"){const u=new Uint8Array(this.buffer.slice(r,r+n));u.reverse();const h=new bb[t](u.buffer);return this.offset+=n,h.reverse(),h}const l=new bb[t](s);return this.offset+=n,l}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return GI(this.readBytes(e))}decodeText(e=1,t="utf8"){return GI(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(DG(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Wp(i){let e=i.length;for(;--e>=0;)i[e]=0}const PG=3,OG=258,S4=29,MG=256,FG=MG+1+S4,T4=30,jG=512,VG=new Array((FG+2)*2);Wp(VG);const zG=new Array(T4*2);Wp(zG);const UG=new Array(jG);Wp(UG);const BG=new Array(OG-PG+1);Wp(BG);const $G=new Array(S4);Wp($G);const HG=new Array(T4);Wp(HG);const GG=(i,e,t,n)=>{let r=i&65535|0,s=i>>>16&65535|0,l=0;for(;t!==0;){l=t>2e3?2e3:t,t-=l;do r=r+e[n++]|0,s=s+r|0;while(--l);r%=65521,s%=65521}return r|s<<16|0};var Wx=GG;const KG=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},WG=new Uint32Array(KG()),qG=(i,e,t,n)=>{const r=WG,s=n+t;i^=-1;for(let l=n;l<s;l++)i=i>>>8^r[(i^e[l])&255];return i^-1};var Wu=qG,qx={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},A4={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const YG=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var XG=function(i){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)YG(t,n)&&(i[n]=t[n])}}return i},JG=i=>{let e=0;for(let n=0,r=i.length;n<r;n++)e+=i[n].length;const t=new Uint8Array(e);for(let n=0,r=0,s=i.length;n<s;n++){let l=i[n];t.set(l,r),r+=l.length}return t},E4={assign:XG,flattenChunks:JG};let I4=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{I4=!1}const Lm=new Uint8Array(256);for(let i=0;i<256;i++)Lm[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Lm[254]=Lm[254]=1;var QG=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,n,r,s,l=i.length,u=0;for(r=0;r<l;r++)t=i.charCodeAt(r),(t&64512)===55296&&r+1<l&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),u+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(u),s=0,r=0;s<u;r++)t=i.charCodeAt(r),(t&64512)===55296&&r+1<l&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e};const ZG=(i,e)=>{if(e<65534&&i.subarray&&I4)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i[n]);return t};var eK=(i,e)=>{const t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let n,r;const s=new Array(t*2);for(r=0,n=0;n<t;){let l=i[n++];if(l<128){s[r++]=l;continue}let u=Lm[l];if(u>4){s[r++]=65533,n+=u-1;continue}for(l&=u===2?31:u===3?15:7;u>1&&n<t;)l=l<<6|i[n++]&63,u--;if(u>1){s[r++]=65533;continue}l<65536?s[r++]=l:(l-=65536,s[r++]=55296|l>>10&1023,s[r++]=56320|l&1023)}return ZG(s,r)},tK=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+Lm[i[t]]>e?t:e},Yx={string2buf:QG,buf2string:eK,utf8border:tK};function nK(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var iK=nK;const s0=16209,rK=16191;var sK=function(e,t){let n,r,s,l,u,h,f,x,p,w,A,B,$,W,q,ge,he,me,Ce,Ve,pe,ee,J,ye;const X=e.state;n=e.next_in,J=e.input,r=n+(e.avail_in-5),s=e.next_out,ye=e.output,l=s-(t-e.avail_out),u=s+(e.avail_out-257),h=X.dmax,f=X.wsize,x=X.whave,p=X.wnext,w=X.window,A=X.hold,B=X.bits,$=X.lencode,W=X.distcode,q=(1<<X.lenbits)-1,ge=(1<<X.distbits)-1;e:do{B<15&&(A+=J[n++]<<B,B+=8,A+=J[n++]<<B,B+=8),he=$[A&q];t:for(;;){if(me=he>>>24,A>>>=me,B-=me,me=he>>>16&255,me===0)ye[s++]=he&65535;else if(me&16){Ce=he&65535,me&=15,me&&(B<me&&(A+=J[n++]<<B,B+=8),Ce+=A&(1<<me)-1,A>>>=me,B-=me),B<15&&(A+=J[n++]<<B,B+=8,A+=J[n++]<<B,B+=8),he=W[A&ge];n:for(;;){if(me=he>>>24,A>>>=me,B-=me,me=he>>>16&255,me&16){if(Ve=he&65535,me&=15,B<me&&(A+=J[n++]<<B,B+=8,B<me&&(A+=J[n++]<<B,B+=8)),Ve+=A&(1<<me)-1,Ve>h){e.msg="invalid distance too far back",X.mode=s0;break e}if(A>>>=me,B-=me,me=s-l,Ve>me){if(me=Ve-me,me>x&&X.sane){e.msg="invalid distance too far back",X.mode=s0;break e}if(pe=0,ee=w,p===0){if(pe+=f-me,me<Ce){Ce-=me;do ye[s++]=w[pe++];while(--me);pe=s-Ve,ee=ye}}else if(p<me){if(pe+=f+p-me,me-=p,me<Ce){Ce-=me;do ye[s++]=w[pe++];while(--me);if(pe=0,p<Ce){me=p,Ce-=me;do ye[s++]=w[pe++];while(--me);pe=s-Ve,ee=ye}}}else if(pe+=p-me,me<Ce){Ce-=me;do ye[s++]=w[pe++];while(--me);pe=s-Ve,ee=ye}for(;Ce>2;)ye[s++]=ee[pe++],ye[s++]=ee[pe++],ye[s++]=ee[pe++],Ce-=3;Ce&&(ye[s++]=ee[pe++],Ce>1&&(ye[s++]=ee[pe++]))}else{pe=s-Ve;do ye[s++]=ye[pe++],ye[s++]=ye[pe++],ye[s++]=ye[pe++],Ce-=3;while(Ce>2);Ce&&(ye[s++]=ye[pe++],Ce>1&&(ye[s++]=ye[pe++]))}}else if((me&64)===0){he=W[(he&65535)+(A&(1<<me)-1)];continue n}else{e.msg="invalid distance code",X.mode=s0;break e}break}}else if((me&64)===0){he=$[(he&65535)+(A&(1<<me)-1)];continue t}else if(me&32){X.mode=rK;break e}else{e.msg="invalid literal/length code",X.mode=s0;break e}break}}while(n<r&&s<u);Ce=B>>3,n-=Ce,B-=Ce<<3,A&=(1<<B)-1,e.next_in=n,e.next_out=s,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=s<u?257+(u-s):257-(s-u),X.hold=A,X.bits=B};const zf=15,KI=852,WI=592,qI=0,xb=1,YI=2,aK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),oK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),lK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),cK=(i,e,t,n,r,s,l,u)=>{const h=u.bits;let f=0,x=0,p=0,w=0,A=0,B=0,$=0,W=0,q=0,ge=0,he,me,Ce,Ve,pe,ee=null,J;const ye=new Uint16Array(zf+1),X=new Uint16Array(zf+1);let ae=null,le,ze,nt;for(f=0;f<=zf;f++)ye[f]=0;for(x=0;x<n;x++)ye[e[t+x]]++;for(A=h,w=zf;w>=1&&ye[w]===0;w--);if(A>w&&(A=w),w===0)return r[s++]=1<<24|64<<16|0,r[s++]=1<<24|64<<16|0,u.bits=1,0;for(p=1;p<w&&ye[p]===0;p++);for(A<p&&(A=p),W=1,f=1;f<=zf;f++)if(W<<=1,W-=ye[f],W<0)return-1;if(W>0&&(i===qI||w!==1))return-1;for(X[1]=0,f=1;f<zf;f++)X[f+1]=X[f]+ye[f];for(x=0;x<n;x++)e[t+x]!==0&&(l[X[e[t+x]]++]=x);if(i===qI?(ee=ae=l,J=20):i===xb?(ee=aK,ae=oK,J=257):(ee=lK,ae=uK,J=0),ge=0,x=0,f=p,pe=s,B=A,$=0,Ce=-1,q=1<<A,Ve=q-1,i===xb&&q>KI||i===YI&&q>WI)return 1;for(;;){le=f-$,l[x]+1<J?(ze=0,nt=l[x]):l[x]>=J?(ze=ae[l[x]-J],nt=ee[l[x]-J]):(ze=96,nt=0),he=1<<f-$,me=1<<B,p=me;do me-=he,r[pe+(ge>>$)+me]=le<<24|ze<<16|nt|0;while(me!==0);for(he=1<<f-1;ge&he;)he>>=1;if(he!==0?(ge&=he-1,ge+=he):ge=0,x++,--ye[f]===0){if(f===w)break;f=e[t+l[x]]}if(f>A&&(ge&Ve)!==Ce){for($===0&&($=A),pe+=p,B=f-$,W=1<<B;B+$<w&&(W-=ye[B+$],!(W<=0));)B++,W<<=1;if(q+=1<<B,i===xb&&q>KI||i===YI&&q>WI)return 1;Ce=ge&Ve,r[Ce]=A<<24|B<<16|pe-s|0}}return ge!==0&&(r[pe+ge]=f-$<<24|64<<16|0),u.bits=A,0};var sm=cK;const hK=0,k4=1,C4=2,{Z_FINISH:XI,Z_BLOCK:dK,Z_TREES:a0,Z_OK:cf,Z_STREAM_END:fK,Z_NEED_DICT:pK,Z_STREAM_ERROR:du,Z_DATA_ERROR:R4,Z_MEM_ERROR:D4,Z_BUF_ERROR:gK,Z_DEFLATED:JI}=A4,Iv=16180,QI=16181,ZI=16182,ek=16183,tk=16184,nk=16185,ik=16186,rk=16187,sk=16188,ak=16189,L1=16190,Mc=16191,wb=16192,ok=16193,Sb=16194,lk=16195,uk=16196,ck=16197,hk=16198,o0=16199,l0=16200,dk=16201,fk=16202,pk=16203,gk=16204,mk=16205,Tb=16206,yk=16207,vk=16208,As=16209,L4=16210,N4=16211,mK=852,yK=592,vK=15,_K=vK,_k=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function bK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const mf=i=>{if(!i)return 1;const e=i.state;return!e||e.strm!==i||e.mode<Iv||e.mode>N4?1:0},P4=i=>{if(mf(i))return du;const e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=Iv,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(mK),e.distcode=e.distdyn=new Int32Array(yK),e.sane=1,e.back=-1,cf},O4=i=>{if(mf(i))return du;const e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,P4(i)},M4=(i,e)=>{let t;if(mf(i))return du;const n=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?du:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,O4(i))},F4=(i,e)=>{if(!i)return du;const t=new bK;i.state=t,t.strm=i,t.window=null,t.mode=Iv;const n=M4(i,e);return n!==cf&&(i.state=null),n},xK=i=>F4(i,_K);let bk=!0,Ab,Eb;const wK=i=>{if(bk){Ab=new Int32Array(512),Eb=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(sm(k4,i.lens,0,288,Ab,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;sm(C4,i.lens,0,32,Eb,0,i.work,{bits:5}),bk=!1}i.lencode=Ab,i.lenbits=9,i.distcode=Eb,i.distbits=5},j4=(i,e,t,n)=>{let r;const s=i.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(e.subarray(t-n,t-n+r),s.wnext),n-=r,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0},SK=(i,e)=>{let t,n,r,s,l,u,h,f,x,p,w,A,B,$,W=0,q,ge,he,me,Ce,Ve,pe,ee;const J=new Uint8Array(4);let ye,X;const ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(mf(i)||!i.output||!i.input&&i.avail_in!==0)return du;t=i.state,t.mode===Mc&&(t.mode=wb),l=i.next_out,r=i.output,h=i.avail_out,s=i.next_in,n=i.input,u=i.avail_in,f=t.hold,x=t.bits,p=u,w=h,ee=cf;e:for(;;)switch(t.mode){case Iv:if(t.wrap===0){t.mode=wb;break}for(;x<16;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(t.wrap&2&&f===35615){t.wbits===0&&(t.wbits=15),t.check=0,J[0]=f&255,J[1]=f>>>8&255,t.check=Wu(t.check,J,2,0),f=0,x=0,t.mode=QI;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((f&255)<<8)+(f>>8))%31){i.msg="incorrect header check",t.mode=As;break}if((f&15)!==JI){i.msg="unknown compression method",t.mode=As;break}if(f>>>=4,x-=4,pe=(f&15)+8,t.wbits===0&&(t.wbits=pe),pe>15||pe>t.wbits){i.msg="invalid window size",t.mode=As;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=f&512?ak:Mc,f=0,x=0;break;case QI:for(;x<16;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(t.flags=f,(t.flags&255)!==JI){i.msg="unknown compression method",t.mode=As;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=As;break}t.head&&(t.head.text=f>>8&1),t.flags&512&&t.wrap&4&&(J[0]=f&255,J[1]=f>>>8&255,t.check=Wu(t.check,J,2,0)),f=0,x=0,t.mode=ZI;case ZI:for(;x<32;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}t.head&&(t.head.time=f),t.flags&512&&t.wrap&4&&(J[0]=f&255,J[1]=f>>>8&255,J[2]=f>>>16&255,J[3]=f>>>24&255,t.check=Wu(t.check,J,4,0)),f=0,x=0,t.mode=ek;case ek:for(;x<16;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}t.head&&(t.head.xflags=f&255,t.head.os=f>>8),t.flags&512&&t.wrap&4&&(J[0]=f&255,J[1]=f>>>8&255,t.check=Wu(t.check,J,2,0)),f=0,x=0,t.mode=tk;case tk:if(t.flags&1024){for(;x<16;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}t.length=f,t.head&&(t.head.extra_len=f),t.flags&512&&t.wrap&4&&(J[0]=f&255,J[1]=f>>>8&255,t.check=Wu(t.check,J,2,0)),f=0,x=0}else t.head&&(t.head.extra=null);t.mode=nk;case nk:if(t.flags&1024&&(A=t.length,A>u&&(A=u),A&&(t.head&&(pe=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+A),pe)),t.flags&512&&t.wrap&4&&(t.check=Wu(t.check,n,A,s)),u-=A,s+=A,t.length-=A),t.length))break e;t.length=0,t.mode=ik;case ik:if(t.flags&2048){if(u===0)break e;A=0;do pe=n[s+A++],t.head&&pe&&t.length<65536&&(t.head.name+=String.fromCharCode(pe));while(pe&&A<u);if(t.flags&512&&t.wrap&4&&(t.check=Wu(t.check,n,A,s)),u-=A,s+=A,pe)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=rk;case rk:if(t.flags&4096){if(u===0)break e;A=0;do pe=n[s+A++],t.head&&pe&&t.length<65536&&(t.head.comment+=String.fromCharCode(pe));while(pe&&A<u);if(t.flags&512&&t.wrap&4&&(t.check=Wu(t.check,n,A,s)),u-=A,s+=A,pe)break e}else t.head&&(t.head.comment=null);t.mode=sk;case sk:if(t.flags&512){for(;x<16;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(t.wrap&4&&f!==(t.check&65535)){i.msg="header crc mismatch",t.mode=As;break}f=0,x=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=Mc;break;case ak:for(;x<32;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}i.adler=t.check=_k(f),f=0,x=0,t.mode=L1;case L1:if(t.havedict===0)return i.next_out=l,i.avail_out=h,i.next_in=s,i.avail_in=u,t.hold=f,t.bits=x,pK;i.adler=t.check=1,t.mode=Mc;case Mc:if(e===dK||e===a0)break e;case wb:if(t.last){f>>>=x&7,x-=x&7,t.mode=Tb;break}for(;x<3;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}switch(t.last=f&1,f>>>=1,x-=1,f&3){case 0:t.mode=ok;break;case 1:if(wK(t),t.mode=o0,e===a0){f>>>=2,x-=2;break e}break;case 2:t.mode=uk;break;case 3:i.msg="invalid block type",t.mode=As}f>>>=2,x-=2;break;case ok:for(f>>>=x&7,x-=x&7;x<32;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if((f&65535)!==(f>>>16^65535)){i.msg="invalid stored block lengths",t.mode=As;break}if(t.length=f&65535,f=0,x=0,t.mode=Sb,e===a0)break e;case Sb:t.mode=lk;case lk:if(A=t.length,A){if(A>u&&(A=u),A>h&&(A=h),A===0)break e;r.set(n.subarray(s,s+A),l),u-=A,s+=A,h-=A,l+=A,t.length-=A;break}t.mode=Mc;break;case uk:for(;x<14;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(t.nlen=(f&31)+257,f>>>=5,x-=5,t.ndist=(f&31)+1,f>>>=5,x-=5,t.ncode=(f&15)+4,f>>>=4,x-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=As;break}t.have=0,t.mode=ck;case ck:for(;t.have<t.ncode;){for(;x<3;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}t.lens[ae[t.have++]]=f&7,f>>>=3,x-=3}for(;t.have<19;)t.lens[ae[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,ye={bits:t.lenbits},ee=sm(hK,t.lens,0,19,t.lencode,0,t.work,ye),t.lenbits=ye.bits,ee){i.msg="invalid code lengths set",t.mode=As;break}t.have=0,t.mode=hk;case hk:for(;t.have<t.nlen+t.ndist;){for(;W=t.lencode[f&(1<<t.lenbits)-1],q=W>>>24,ge=W>>>16&255,he=W&65535,!(q<=x);){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(he<16)f>>>=q,x-=q,t.lens[t.have++]=he;else{if(he===16){for(X=q+2;x<X;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(f>>>=q,x-=q,t.have===0){i.msg="invalid bit length repeat",t.mode=As;break}pe=t.lens[t.have-1],A=3+(f&3),f>>>=2,x-=2}else if(he===17){for(X=q+3;x<X;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}f>>>=q,x-=q,pe=0,A=3+(f&7),f>>>=3,x-=3}else{for(X=q+7;x<X;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}f>>>=q,x-=q,pe=0,A=11+(f&127),f>>>=7,x-=7}if(t.have+A>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=As;break}for(;A--;)t.lens[t.have++]=pe}}if(t.mode===As)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=As;break}if(t.lenbits=9,ye={bits:t.lenbits},ee=sm(k4,t.lens,0,t.nlen,t.lencode,0,t.work,ye),t.lenbits=ye.bits,ee){i.msg="invalid literal/lengths set",t.mode=As;break}if(t.distbits=6,t.distcode=t.distdyn,ye={bits:t.distbits},ee=sm(C4,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,ye),t.distbits=ye.bits,ee){i.msg="invalid distances set",t.mode=As;break}if(t.mode=o0,e===a0)break e;case o0:t.mode=l0;case l0:if(u>=6&&h>=258){i.next_out=l,i.avail_out=h,i.next_in=s,i.avail_in=u,t.hold=f,t.bits=x,sK(i,w),l=i.next_out,r=i.output,h=i.avail_out,s=i.next_in,n=i.input,u=i.avail_in,f=t.hold,x=t.bits,t.mode===Mc&&(t.back=-1);break}for(t.back=0;W=t.lencode[f&(1<<t.lenbits)-1],q=W>>>24,ge=W>>>16&255,he=W&65535,!(q<=x);){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(ge&&(ge&240)===0){for(me=q,Ce=ge,Ve=he;W=t.lencode[Ve+((f&(1<<me+Ce)-1)>>me)],q=W>>>24,ge=W>>>16&255,he=W&65535,!(me+q<=x);){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}f>>>=me,x-=me,t.back+=me}if(f>>>=q,x-=q,t.back+=q,t.length=he,ge===0){t.mode=mk;break}if(ge&32){t.back=-1,t.mode=Mc;break}if(ge&64){i.msg="invalid literal/length code",t.mode=As;break}t.extra=ge&15,t.mode=dk;case dk:if(t.extra){for(X=t.extra;x<X;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}t.length+=f&(1<<t.extra)-1,f>>>=t.extra,x-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=fk;case fk:for(;W=t.distcode[f&(1<<t.distbits)-1],q=W>>>24,ge=W>>>16&255,he=W&65535,!(q<=x);){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if((ge&240)===0){for(me=q,Ce=ge,Ve=he;W=t.distcode[Ve+((f&(1<<me+Ce)-1)>>me)],q=W>>>24,ge=W>>>16&255,he=W&65535,!(me+q<=x);){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}f>>>=me,x-=me,t.back+=me}if(f>>>=q,x-=q,t.back+=q,ge&64){i.msg="invalid distance code",t.mode=As;break}t.offset=he,t.extra=ge&15,t.mode=pk;case pk:if(t.extra){for(X=t.extra;x<X;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}t.offset+=f&(1<<t.extra)-1,f>>>=t.extra,x-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=As;break}t.mode=gk;case gk:if(h===0)break e;if(A=w-h,t.offset>A){if(A=t.offset-A,A>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=As;break}A>t.wnext?(A-=t.wnext,B=t.wsize-A):B=t.wnext-A,A>t.length&&(A=t.length),$=t.window}else $=r,B=l-t.offset,A=t.length;A>h&&(A=h),h-=A,t.length-=A;do r[l++]=$[B++];while(--A);t.length===0&&(t.mode=l0);break;case mk:if(h===0)break e;r[l++]=t.length,h--,t.mode=l0;break;case Tb:if(t.wrap){for(;x<32;){if(u===0)break e;u--,f|=n[s++]<<x,x+=8}if(w-=h,i.total_out+=w,t.total+=w,t.wrap&4&&w&&(i.adler=t.check=t.flags?Wu(t.check,r,w,l-w):Wx(t.check,r,w,l-w)),w=h,t.wrap&4&&(t.flags?f:_k(f))!==t.check){i.msg="incorrect data check",t.mode=As;break}f=0,x=0}t.mode=yk;case yk:if(t.wrap&&t.flags){for(;x<32;){if(u===0)break e;u--,f+=n[s++]<<x,x+=8}if(t.wrap&4&&f!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=As;break}f=0,x=0}t.mode=vk;case vk:ee=fK;break e;case As:ee=R4;break e;case L4:return D4;case N4:default:return du}return i.next_out=l,i.avail_out=h,i.next_in=s,i.avail_in=u,t.hold=f,t.bits=x,(t.wsize||w!==i.avail_out&&t.mode<As&&(t.mode<Tb||e!==XI))&&j4(i,i.output,i.next_out,w-i.avail_out),p-=i.avail_in,w-=i.avail_out,i.total_in+=p,i.total_out+=w,t.total+=w,t.wrap&4&&w&&(i.adler=t.check=t.flags?Wu(t.check,r,w,i.next_out-w):Wx(t.check,r,w,i.next_out-w)),i.data_type=t.bits+(t.last?64:0)+(t.mode===Mc?128:0)+(t.mode===o0||t.mode===Sb?256:0),(p===0&&w===0||e===XI)&&ee===cf&&(ee=gK),ee},TK=i=>{if(mf(i))return du;let e=i.state;return e.window&&(e.window=null),i.state=null,cf},AK=(i,e)=>{if(mf(i))return du;const t=i.state;return(t.wrap&2)===0?du:(t.head=e,e.done=!1,cf)},EK=(i,e)=>{const t=e.length;let n,r,s;return mf(i)||(n=i.state,n.wrap!==0&&n.mode!==L1)?du:n.mode===L1&&(r=1,r=Wx(r,e,t,0),r!==n.check)?R4:(s=j4(i,e,t,t),s?(n.mode=L4,D4):(n.havedict=1,cf))};var IK=O4,kK=M4,CK=P4,RK=xK,DK=F4,LK=SK,NK=TK,PK=AK,OK=EK,MK="pako inflate (from Nodeca project)",jc={inflateReset:IK,inflateReset2:kK,inflateResetKeep:CK,inflateInit:RK,inflateInit2:DK,inflate:LK,inflateEnd:NK,inflateGetHeader:PK,inflateSetDictionary:OK,inflateInfo:MK};function FK(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var jK=FK;const V4=Object.prototype.toString,{Z_NO_FLUSH:VK,Z_FINISH:zK,Z_OK:Nm,Z_STREAM_END:Ib,Z_NEED_DICT:kb,Z_STREAM_ERROR:UK,Z_DATA_ERROR:xk,Z_MEM_ERROR:BK}=A4;function ay(i){this.options=E4.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iK,this.strm.avail_out=0;let t=jc.inflateInit2(this.strm,e.windowBits);if(t!==Nm)throw new Error(qx[t]);if(this.header=new jK,jc.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Yx.string2buf(e.dictionary):V4.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=jc.inflateSetDictionary(this.strm,e.dictionary),t!==Nm)))throw new Error(qx[t])}ay.prototype.push=function(i,e){const t=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let s,l,u;if(this.ended)return!1;for(e===~~e?l=e:l=e===!0?zK:VK,V4.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=jc.inflate(t,l),s===kb&&r&&(s=jc.inflateSetDictionary(t,r),s===Nm?s=jc.inflate(t,l):s===xk&&(s=kb));t.avail_in>0&&s===Ib&&t.state.wrap>0&&i[t.next_in]!==0;)jc.inflateReset(t),s=jc.inflate(t,l);switch(s){case UK:case xk:case kb:case BK:return this.onEnd(s),this.ended=!0,!1}if(u=t.avail_out,t.next_out&&(t.avail_out===0||s===Ib))if(this.options.to==="string"){let h=Yx.utf8border(t.output,t.next_out),f=t.next_out-h,x=Yx.buf2string(t.output,h);t.next_out=f,t.avail_out=n-f,f&&t.output.set(t.output.subarray(h,h+f),0),this.onData(x)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Nm&&u===0)){if(s===Ib)return s=jc.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};ay.prototype.onData=function(i){this.chunks.push(i)};ay.prototype.onEnd=function(i){i===Nm&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=E4.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function $K(i,e){const t=new ay(e);if(t.push(i),t.err)throw t.msg||qx[t.err];return t.result}var HK=ay,GK=$K,KK={Inflate:HK,inflate:GK};const{Inflate:WK,inflate:qK}=KK;var wk=WK,YK=qK;const z4=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;z4[i]=e}const Sk=4294967295;function XK(i,e,t){let n=i;for(let r=0;r<t;r++)n=z4[(n^e[r])&255]^n>>>8;return n}function JK(i,e){return(XK(Sk,i,e)^Sk)>>>0}function Tk(i,e,t){const n=i.readUint32(),r=JK(new Uint8Array(i.buffer,i.byteOffset+i.offset-e-4,e),e);if(r!==n)throw new Error(`CRC mismatch for chunk ${t}. Expected ${n}, found ${r}`)}function U4(i,e,t){for(let n=0;n<t;n++)e[n]=i[n]}function B4(i,e,t,n){let r=0;for(;r<n;r++)e[r]=i[r];for(;r<t;r++)e[r]=i[r]+e[r-n]&255}function $4(i,e,t,n){let r=0;if(t.length===0)for(;r<n;r++)e[r]=i[r];else for(;r<n;r++)e[r]=i[r]+t[r]&255}function H4(i,e,t,n,r){let s=0;if(t.length===0){for(;s<r;s++)e[s]=i[s];for(;s<n;s++)e[s]=i[s]+(e[s-r]>>1)&255}else{for(;s<r;s++)e[s]=i[s]+(t[s]>>1)&255;for(;s<n;s++)e[s]=i[s]+(e[s-r]+t[s]>>1)&255}}function G4(i,e,t,n,r){let s=0;if(t.length===0){for(;s<r;s++)e[s]=i[s];for(;s<n;s++)e[s]=i[s]+e[s-r]&255}else{for(;s<r;s++)e[s]=i[s]+t[s]&255;for(;s<n;s++)e[s]=i[s]+QK(e[s-r],t[s],t[s-r])&255}}function QK(i,e,t){const n=i+e-t,r=Math.abs(n-i),s=Math.abs(n-e),l=Math.abs(n-t);return r<=s&&r<=l?i:s<=l?e:t}function ZK(i,e,t,n,r,s){switch(i){case 0:U4(e,t,r);break;case 1:B4(e,t,r,s);break;case 2:$4(e,t,n,r);break;case 3:H4(e,t,n,r,s);break;case 4:G4(e,t,n,r,s);break;default:throw new Error(`Unsupported filter: ${i}`)}}const eW=new Uint16Array([255]),tW=new Uint8Array(eW.buffer),nW=tW[0]===255;function iW(i){const{data:e,width:t,height:n,channels:r,depth:s}=i,l=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],u=Math.ceil(s/8)*r,h=new Uint8Array(n*t*u);let f=0;for(let x=0;x<7;x++){const p=l[x],w=Math.ceil((t-p.x)/p.xStep),A=Math.ceil((n-p.y)/p.yStep);if(w<=0||A<=0)continue;const B=w*u,$=new Uint8Array(B);for(let W=0;W<A;W++){const q=e[f++],ge=e.subarray(f,f+B);f+=B;const he=new Uint8Array(B);ZK(q,ge,he,$,B,u),$.set(he);for(let me=0;me<w;me++){const Ce=p.x+me*p.xStep,Ve=p.y+W*p.yStep;if(!(Ce>=t||Ve>=n))for(let pe=0;pe<u;pe++)h[(Ve*t+Ce)*u+pe]=he[me*u+pe]}}}if(s===16){const x=new Uint16Array(h.buffer);if(nW)for(let p=0;p<x.length;p++)x[p]=rW(x[p]);return x}else return h}function rW(i){return(i&255)<<8|i>>8&255}const sW=new Uint16Array([255]),aW=new Uint8Array(sW.buffer),oW=aW[0]===255,lW=new Uint8Array(0);function Ak(i){const{data:e,width:t,height:n,channels:r,depth:s}=i,l=Math.ceil(s/8)*r,u=Math.ceil(s/8*r*t),h=new Uint8Array(n*u);let f=lW,x=0,p,w;for(let A=0;A<n;A++){switch(p=e.subarray(x+1,x+1+u),w=h.subarray(A*u,(A+1)*u),e[x]){case 0:U4(p,w,u);break;case 1:B4(p,w,u,l);break;case 2:$4(p,w,f,u);break;case 3:H4(p,w,f,u,l);break;case 4:G4(p,w,f,u,l);break;default:throw new Error(`Unsupported filter: ${e[x]}`)}f=w,x+=u+1}if(s===16){const A=new Uint16Array(h.buffer);if(oW)for(let B=0;B<A.length;B++)A[B]=uW(A[B]);return A}else return h}function uW(i){return(i&255)<<8|i>>8&255}const O0=Uint8Array.of(137,80,78,71,13,10,26,10);function Ek(i){if(!cW(i.readBytes(O0.length)))throw new Error("wrong PNG signature")}function cW(i){if(i.length<O0.length)return!1;for(let e=0;e<O0.length;e++)if(i[e]!==O0[e])return!1;return!0}const hW="tEXt",dW=0,K4=new TextDecoder("latin1");function fW(i){if(gW(i),i.length===0||i.length>79)throw new Error("keyword length must be between 1 and 79")}const pW=/^[\u0000-\u00FF]*$/;function gW(i){if(!pW.test(i))throw new Error("invalid latin1 text")}function mW(i,e,t){const n=W4(e);i[n]=yW(e,t-n.length-1)}function W4(i){for(i.mark();i.readByte()!==dW;);const e=i.offset;i.reset();const t=K4.decode(i.readBytes(e-i.offset-1));return i.skip(1),fW(t),t}function yW(i,e){return K4.decode(i.readBytes(e))}const Ol={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},Cb={UNKNOWN:-1,DEFLATE:0},Ik={UNKNOWN:-1,ADAPTIVE:0},Rb={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},u0={NONE:0,BACKGROUND:1,PREVIOUS:2},Db={SOURCE:0,OVER:1};class vW extends lS{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new wk,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=Cb.UNKNOWN,this._filterMethod=Ik.UNKNOWN,this._interlaceMethod=Rb.UNKNOWN,this._colorType=Ol.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Ek(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(Ek(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case hW:mW(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?Tk(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e;break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?Tk(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=_W(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case Ol.GREYSCALE:n=1;break;case Ol.TRUECOLOUR:n=3;break;case Ol.INDEXED_COLOUR:n=1;break;case Ol.GREYSCALE_ALPHA:n=2;break;case Ol.TRUECOLOUR_ALPHA:n=4;break;case Ol.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==Cb.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<t;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case Ol.GREYSCALE:case Ol.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case Ol.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case Ol.UNKNOWN:case Ol.GREYSCALE_ALPHA:case Ol.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=W4(this),n=this.readUint8();if(n!==Cb.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:YK(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=Ak({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||n.xOffset===0&&n.yOffset===0&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(n,r,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case u0.NONE:break;case u0.BACKGROUND:for(let r=0;r<this._png.height;r++)for(let s=0;s<this._png.width;s++){const l=(r*e.width+s)*this._png.channels;for(let u=0;u<this._png.channels;u++)n.data[l+u]=0}break;case u0.PREVIOUS:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,r=(s,l)=>{const u=((s+t.yOffset)*this._png.width+t.xOffset+l)*this._png.channels,h=(s*t.width+l)*this._png.channels;return{index:u,frameIndex:h}};switch(t.blendOp){case Db.SOURCE:for(let s=0;s<t.height;s++)for(let l=0;l<t.width;l++){const{index:u,frameIndex:h}=r(s,l);for(let f=0;f<this._png.channels;f++)e.data[u+f]=t.data[h+f]}break;case Db.OVER:for(let s=0;s<t.height;s++)for(let l=0;l<t.width;l++){const{index:u,frameIndex:h}=r(s,l);for(let f=0;f<this._png.channels;f++){const x=t.data[h+this._png.channels-1]/n,p=f%(this._png.channels-1)===0?1:t.data[h+f],w=Math.floor(x*p+(1-x)*e.data[u+f]);e.data[u+f]+=w}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==Ik.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===Rb.NO_INTERLACE)this._png.data=Ak({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===Rb.ADAM7)this._png.data=iW({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:u0.NONE,blendOp:Db.SOURCE,data:e}),this._inflator=new wk,this._writingDataChunks=!1}}function _W(i){if(i!==1&&i!==2&&i!==4&&i!==8&&i!==16)throw new Error(`invalid bit depth: ${i}`);return i}var kk;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.METRE=1]="METRE"})(kk||(kk={}));function bW(i,e){return new vW(i,e).decode()}var ai=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function Lb(){ai.console&&typeof ai.console.log=="function"&&ai.console.log.apply(ai.console,arguments)}var ts={log:Lb,warn:function(i){ai.console&&(typeof ai.console.warn=="function"?ai.console.warn.apply(ai.console,arguments):Lb.call(null,arguments))},error:function(i){ai.console&&(typeof ai.console.error=="function"?ai.console.error.apply(ai.console,arguments):Lb(i))}};function Nb(i,e,t){var n=new XMLHttpRequest;n.open("GET",i),n.responseType="blob",n.onload=function(){Dd(n.response,e,t)},n.onerror=function(){ts.error("could not download file")},n.send()}function Ck(i){var e=new XMLHttpRequest;e.open("HEAD",i,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function c0(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(e)}}var Dd=ai.saveAs||((typeof window>"u"?"undefined":zr(window))!=="object"||window!==ai?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,e,t){var n=ai.URL||ai.webkitURL,r=document.createElement("a");e=e||i.name||"download",r.download=e,r.rel="noopener",typeof i=="string"?(r.href=i,r.origin!==location.origin?Ck(r.href)?Nb(i,e,t):c0(r,r.target="_blank"):c0(r)):(r.href=n.createObjectURL(i),setTimeout(function(){n.revokeObjectURL(r.href)},4e4),setTimeout(function(){c0(r)},0))}:"msSaveOrOpenBlob"in navigator?function(i,e,t){if(e=e||i.name||"download",typeof i=="string")if(Ck(i))Nb(i,e,t);else{var n=document.createElement("a");n.href=i,n.target="_blank",setTimeout(function(){c0(n)})}else navigator.msSaveOrOpenBlob((function(r,s){return s===void 0?s={autoBom:!1}:zr(s)!=="object"&&(ts.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r})(i,t),e)}:function(i,e,t,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof i=="string")return Nb(i,e,t);var r=i.type==="application/octet-stream",s=/constructor/i.test(ai.HTMLElement)||ai.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||r&&s)&&(typeof FileReader>"u"?"undefined":zr(FileReader))==="object"){var u=new FileReader;u.onloadend=function(){var x=u.result;x=l?x:x.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=x:location=x,n=null},u.readAsDataURL(i)}else{var h=ai.URL||ai.webkitURL,f=h.createObjectURL(i);n?n.location=f:location.href=f,n=null,setTimeout(function(){h.revokeObjectURL(f)},4e4)}});function q4(i){var e;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}],n=0;n<t.length;n++){var r=t[n].re,s=t[n].process,l=r.exec(i);l&&(e=s(l),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var u=this.r.toString(16),h=this.g.toString(16),f=this.b.toString(16);return u.length==1&&(u="0"+u),h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),"#"+u+h+f}}var M0=ai.atob.bind(ai),Rk=ai.btoa.bind(ai);function Pb(i,e){var t=i[0],n=i[1],r=i[2],s=i[3];t=Do(t,n,r,s,e[0],7,-680876936),s=Do(s,t,n,r,e[1],12,-389564586),r=Do(r,s,t,n,e[2],17,606105819),n=Do(n,r,s,t,e[3],22,-1044525330),t=Do(t,n,r,s,e[4],7,-176418897),s=Do(s,t,n,r,e[5],12,1200080426),r=Do(r,s,t,n,e[6],17,-1473231341),n=Do(n,r,s,t,e[7],22,-45705983),t=Do(t,n,r,s,e[8],7,1770035416),s=Do(s,t,n,r,e[9],12,-1958414417),r=Do(r,s,t,n,e[10],17,-42063),n=Do(n,r,s,t,e[11],22,-1990404162),t=Do(t,n,r,s,e[12],7,1804603682),s=Do(s,t,n,r,e[13],12,-40341101),r=Do(r,s,t,n,e[14],17,-1502002290),t=Lo(t,n=Do(n,r,s,t,e[15],22,1236535329),r,s,e[1],5,-165796510),s=Lo(s,t,n,r,e[6],9,-1069501632),r=Lo(r,s,t,n,e[11],14,643717713),n=Lo(n,r,s,t,e[0],20,-373897302),t=Lo(t,n,r,s,e[5],5,-701558691),s=Lo(s,t,n,r,e[10],9,38016083),r=Lo(r,s,t,n,e[15],14,-660478335),n=Lo(n,r,s,t,e[4],20,-405537848),t=Lo(t,n,r,s,e[9],5,568446438),s=Lo(s,t,n,r,e[14],9,-1019803690),r=Lo(r,s,t,n,e[3],14,-187363961),n=Lo(n,r,s,t,e[8],20,1163531501),t=Lo(t,n,r,s,e[13],5,-1444681467),s=Lo(s,t,n,r,e[2],9,-51403784),r=Lo(r,s,t,n,e[7],14,1735328473),t=No(t,n=Lo(n,r,s,t,e[12],20,-1926607734),r,s,e[5],4,-378558),s=No(s,t,n,r,e[8],11,-2022574463),r=No(r,s,t,n,e[11],16,1839030562),n=No(n,r,s,t,e[14],23,-35309556),t=No(t,n,r,s,e[1],4,-1530992060),s=No(s,t,n,r,e[4],11,1272893353),r=No(r,s,t,n,e[7],16,-155497632),n=No(n,r,s,t,e[10],23,-1094730640),t=No(t,n,r,s,e[13],4,681279174),s=No(s,t,n,r,e[0],11,-358537222),r=No(r,s,t,n,e[3],16,-722521979),n=No(n,r,s,t,e[6],23,76029189),t=No(t,n,r,s,e[9],4,-640364487),s=No(s,t,n,r,e[12],11,-421815835),r=No(r,s,t,n,e[15],16,530742520),t=Po(t,n=No(n,r,s,t,e[2],23,-995338651),r,s,e[0],6,-198630844),s=Po(s,t,n,r,e[7],10,1126891415),r=Po(r,s,t,n,e[14],15,-1416354905),n=Po(n,r,s,t,e[5],21,-57434055),t=Po(t,n,r,s,e[12],6,1700485571),s=Po(s,t,n,r,e[3],10,-1894986606),r=Po(r,s,t,n,e[10],15,-1051523),n=Po(n,r,s,t,e[1],21,-2054922799),t=Po(t,n,r,s,e[8],6,1873313359),s=Po(s,t,n,r,e[15],10,-30611744),r=Po(r,s,t,n,e[6],15,-1560198380),n=Po(n,r,s,t,e[13],21,1309151649),t=Po(t,n,r,s,e[4],6,-145523070),s=Po(s,t,n,r,e[11],10,-1120210379),r=Po(r,s,t,n,e[2],15,718787259),n=Po(n,r,s,t,e[9],21,-343485551),i[0]=Bh(t,i[0]),i[1]=Bh(n,i[1]),i[2]=Bh(r,i[2]),i[3]=Bh(s,i[3])}function kv(i,e,t,n,r,s){return e=Bh(Bh(e,i),Bh(n,s)),Bh(e<<r|e>>>32-r,t)}function Do(i,e,t,n,r,s,l){return kv(e&t|~e&n,i,e,r,s,l)}function Lo(i,e,t,n,r,s,l){return kv(e&n|t&~n,i,e,r,s,l)}function No(i,e,t,n,r,s,l){return kv(e^t^n,i,e,r,s,l)}function Po(i,e,t,n,r,s,l){return kv(t^(e|~n),i,e,r,s,l)}function Y4(i){var e,t=i.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=i.length;e+=64)Pb(n,xW(i.substring(e-64,e)));i=i.substring(e-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i.length;e++)r[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(Pb(n,r),e=0;e<16;e++)r[e]=0;return r[14]=8*t,Pb(n,r),n}function xW(i){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=i.charCodeAt(e)+(i.charCodeAt(e+1)<<8)+(i.charCodeAt(e+2)<<16)+(i.charCodeAt(e+3)<<24);return t}var Dk="0123456789abcdef".split("");function wW(i){for(var e="",t=0;t<4;t++)e+=Dk[i>>8*t+4&15]+Dk[i>>8*t&15];return e}function SW(i){return String.fromCharCode(255&i,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function Xx(i){return Y4(i).map(SW).join("")}var TW=(function(i){for(var e=0;e<i.length;e++)i[e]=wW(i[e]);return i.join("")})(Y4("hello"))!="5d41402abc4b2a76b9719d911017c592";function Bh(i,e){if(TW){var t=(65535&i)+(65535&e);return(i>>16)+(e>>16)+(t>>16)<<16|65535&t}return i+e&4294967295}function Jx(i,e){var t,n,r,s;if(i!==t){for(var l=(r=i,s=1+(256/i.length|0),new Array(s+1).join(r)),u=[],h=0;h<256;h++)u[h]=h;var f=0;for(h=0;h<256;h++){var x=u[h];f=(f+x+l.charCodeAt(h))%256,u[h]=u[f],u[f]=x}t=i,n=u}else u=n;var p=e.length,w=0,A=0,B="";for(h=0;h<p;h++)A=(A+(x=u[w=(w+1)%256]))%256,u[w]=u[A],u[A]=x,l=u[(u[w]+u[A])%256],B+=String.fromCharCode(e.charCodeAt(h)^l);return B}var Lk={print:4,modify:8,copy:16,"annot-forms":32};function Xf(i,e,t,n){this.v=1,this.r=2;var r=192;i.forEach(function(u){if(Lk.perm!==void 0)throw new Error("Invalid permission: "+u);r+=Lk[u]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var s=(e+this.padding).substr(0,32),l=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,l),this.P=-(1+(255^r)),this.encryptionKey=Xx(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Jx(this.encryptionKey,this.padding)}function Jf(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var e="",t=i.length,n=0;n<t;n++){var r=i.charCodeAt(n);e+=r<33||r===35||r===37||r===40||r===41||r===47||r===60||r===62||r===91||r===93||r===123||r===125||r>126?"#"+("0"+r.toString(16)).slice(-2):i[n]}return e}function Nk(i){if(zr(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,r){if(r=r||!1,typeof t!="string"||typeof n!="function"||typeof r!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var s=Math.random().toString(35);return e[t][s]=[n,!!r],s},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var n=Array.prototype.slice.call(arguments,1),r=[];for(var s in e[t]){var l=e[t][s];try{l[0].apply(i,n)}catch(u){ai.console&&ts.error("jsPDF PubSub Error",u.message,u)}l[1]&&r.push(s)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function N1(i){if(!(this instanceof N1))return new N1(i);var e="opacity,stroke-opacity".split(",");for(var t in i)i.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=i[t]);this.id="",this.objectNumber=-1}function X4(i,e){this.gState=i,this.matrix=e,this.id="",this.objectNumber=-1}function jd(i,e,t,n,r){if(!(this instanceof jd))return new jd(i,e,t,n,r);this.type=i==="axial"?2:3,this.coords=e,this.colors=t,X4.call(this,n,r)}function tp(i,e,t,n,r){if(!(this instanceof tp))return new tp(i,e,t,n,r);this.boundingBox=i,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,X4.call(this,n,r)}function Cn(i){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],r=arguments[2],s=arguments[3],l=[],u=1,h=16,f="S",x=null;zr(i=i||{})==="object"&&(t=i.orientation,n=i.unit||n,r=i.format||r,s=i.compress||i.compressPdf||s,(x=i.encryption||null)!==null&&(x.userPassword=x.userPassword||"",x.ownerPassword=x.ownerPassword||"",x.userPermissions=x.userPermissions||[]),u=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(e=i.precision),i.floatPrecision!==void 0&&(h=i.floatPrecision),f=i.defaultPathOperation||"S"),l=i.filters||(s===!0?["FlateEncode"]:l),n=n||"mm",t=(""+(t||"P")).toLowerCase();var p=i.putOnlyUsedFonts||!1,w={},A={internal:{},__private__:{}};A.__private__.PubSub=Nk;var B="1.3",$=A.__private__.getPdfVersion=function(){return B};A.__private__.setPdfVersion=function(j){B=j};var W={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};A.__private__.getPageFormats=function(){return W};var q=A.__private__.getPageFormat=function(j){return W[j]};r=r||"a4";var ge="compat",he="advanced",me=ge;function Ce(){this.saveGraphicsState(),Pe(new pn($n,0,0,-$n,0,Cr()*$n).toString()+" cm"),this.setFontSize(this.getFontSize()/$n),f="n",me=he}function Ve(){this.restoreGraphicsState(),f="S",me=ge}var pe=A.__private__.combineFontStyleAndFontWeight=function(j,fe){if(j=="bold"&&fe=="normal"||j=="bold"&&fe==400||j=="normal"&&fe=="italic"||j=="bold"&&fe=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return fe&&(j=fe==400||fe==="normal"?j==="italic"?"italic":"normal":fe!=700&&fe!=="bold"||j!=="normal"?(fe==700?"bold":fe)+""+j:"bold"),j};A.advancedAPI=function(j){var fe=me===ge;return fe&&Ce.call(this),typeof j!="function"||(j(this),fe&&Ve.call(this)),this},A.compatAPI=function(j){var fe=me===he;return fe&&Ve.call(this),typeof j!="function"||(j(this),fe&&Ce.call(this)),this},A.isAdvancedAPI=function(){return me===he};var ee,J=function(j){if(me!==he)throw new Error(j+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},ye=A.roundToPrecision=A.__private__.roundToPrecision=function(j,fe){var Oe=e||fe;if(isNaN(j)||isNaN(Oe))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return j.toFixed(Oe).replace(/0+$/,"")};ee=A.hpf=A.__private__.hpf=typeof h=="number"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return ye(j,h)}:h==="smart"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return ye(j,j>-1&&j<1?16:5)}:function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return ye(j,16)};var X=A.f2=A.__private__.f2=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f2");return ye(j,2)},ae=A.__private__.f3=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f3");return ye(j,3)},le=A.scale=A.__private__.scale=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.scale");return me===ge?j*$n:me===he?j:void 0},ze=function(j){return le((function(fe){return me===ge?Cr()-fe:me===he?fe:void 0})(j))};A.__private__.setPrecision=A.setPrecision=function(j){typeof parseInt(j,10)=="number"&&(e=parseInt(j,10))};var nt,je="00000000000000000000000000000000",Je=A.__private__.getFileId=function(){return je},qe=A.__private__.setFileId=function(j){return je=j!==void 0&&/^[a-fA-F0-9]{32}$/.test(j)?j.toUpperCase():je.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),x!==null&&(dr=new Xf(x.userPermissions,x.userPassword,x.ownerPassword,je)),je};A.setFileId=function(j){return qe(j),this},A.getFileId=function(){return Je()};var lt=A.__private__.convertDateToPDFDate=function(j){var fe=j.getTimezoneOffset(),Oe=fe<0?"+":"-",We=Math.floor(Math.abs(fe/60)),tt=Math.abs(fe%60),It=[Oe,Le(We),"'",Le(tt),"'"].join("");return["D:",j.getFullYear(),Le(j.getMonth()+1),Le(j.getDate()),Le(j.getHours()),Le(j.getMinutes()),Le(j.getSeconds()),It].join("")},Tt=A.__private__.convertPDFDateToDate=function(j){var fe=parseInt(j.substr(2,4),10),Oe=parseInt(j.substr(6,2),10)-1,We=parseInt(j.substr(8,2),10),tt=parseInt(j.substr(10,2),10),It=parseInt(j.substr(12,2),10),Mt=parseInt(j.substr(14,2),10);return new Date(fe,Oe,We,tt,It,Mt,0)},Ne=A.__private__.setCreationDate=function(j){var fe;if(j===void 0&&(j=new Date),j instanceof Date)fe=lt(j);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(j))throw new Error("Invalid argument passed to jsPDF.setCreationDate");fe=j}return nt=fe},se=A.__private__.getCreationDate=function(j){var fe=nt;return j==="jsDate"&&(fe=Tt(nt)),fe};A.setCreationDate=function(j){return Ne(j),this},A.getCreationDate=function(j){return se(j)};var Ee,Le=A.__private__.padd2=function(j){return("0"+parseInt(j)).slice(-2)},Be=A.__private__.padd2Hex=function(j){return("00"+(j=j.toString())).substr(j.length)},He=0,Ye=[],it=[],ct=0,Et=[],Ft=[],Wt=!1,qt=it;A.__private__.setCustomOutputDestination=function(j){Wt=!0,qt=j};var kt=function(j){Wt||(qt=j)};A.__private__.resetCustomOutputDestination=function(){Wt=!1,qt=it};var Pe=A.__private__.out=function(j){return j=j.toString(),ct+=j.length+1,qt.push(j),qt},$t=A.__private__.write=function(j){return Pe(arguments.length===1?j.toString():Array.prototype.join.call(arguments," "))},Pt=A.__private__.getArrayBuffer=function(j){for(var fe=j.length,Oe=new ArrayBuffer(fe),We=new Uint8Array(Oe);fe--;)We[fe]=j.charCodeAt(fe);return Oe},Tn=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];A.__private__.getStandardFonts=function(){return Tn};var _t=i.fontSize||16;A.__private__.setFontSize=A.setFontSize=function(j){return _t=me===he?j/$n:j,this};var rn,Jt=A.__private__.getFontSize=A.getFontSize=function(){return me===ge?_t:_t*$n},En=i.R2L||!1;A.__private__.setR2L=A.setR2L=function(j){return En=j,this},A.__private__.getR2L=A.getR2L=function(){return En};var wn,Un=A.__private__.setZoomMode=function(j){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(j))rn=j;else if(isNaN(j)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(j)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+j+'" is not recognized.');rn=j}else rn=parseInt(j,10)};A.__private__.getZoomMode=function(){return rn};var ii,Bn=A.__private__.setPageMode=function(j){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(j)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+j+'" is not recognized.');wn=j};A.__private__.getPageMode=function(){return wn};var li=A.__private__.setLayoutMode=function(j){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(j)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+j+'" is not recognized.');ii=j};A.__private__.getLayoutMode=function(){return ii},A.__private__.setDisplayMode=A.setDisplayMode=function(j,fe,Oe){return Un(j),li(fe),Bn(Oe),this};var Xn={title:"",subject:"",author:"",keywords:"",creator:""};A.__private__.getDocumentProperty=function(j){if(Object.keys(Xn).indexOf(j)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Xn[j]},A.__private__.getDocumentProperties=function(){return Xn},A.__private__.setDocumentProperties=A.setProperties=A.setDocumentProperties=function(j){for(var fe in Xn)Xn.hasOwnProperty(fe)&&j[fe]&&(Xn[fe]=j[fe]);return this},A.__private__.setDocumentProperty=function(j,fe){if(Object.keys(Xn).indexOf(j)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Xn[j]=fe};var cn,$n,hn,nr,Jn,vn={},On={},qn=[],un={},Pi={},Mn={},Sn={},Qn=null,tn=0,Gt=[],Kn=new Nk(A),Nr=i.hotfixes||[],vr={},Pr={},Ri=[],pn=function j(fe,Oe,We,tt,It,Mt){if(!(this instanceof j))return new j(fe,Oe,We,tt,It,Mt);isNaN(fe)&&(fe=1),isNaN(Oe)&&(Oe=0),isNaN(We)&&(We=0),isNaN(tt)&&(tt=1),isNaN(It)&&(It=0),isNaN(Mt)&&(Mt=0),this._matrix=[fe,Oe,We,tt,It,Mt]};Object.defineProperty(pn.prototype,"sx",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(pn.prototype,"shy",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(pn.prototype,"shx",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(pn.prototype,"sy",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(pn.prototype,"tx",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(pn.prototype,"ty",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(pn.prototype,"a",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(pn.prototype,"b",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(pn.prototype,"c",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(pn.prototype,"d",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(pn.prototype,"e",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(pn.prototype,"f",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(pn.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(pn.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(pn.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(pn.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),pn.prototype.join=function(j){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(ee).join(j)},pn.prototype.multiply=function(j){var fe=j.sx*this.sx+j.shy*this.shx,Oe=j.sx*this.shy+j.shy*this.sy,We=j.shx*this.sx+j.sy*this.shx,tt=j.shx*this.shy+j.sy*this.sy,It=j.tx*this.sx+j.ty*this.shx+this.tx,Mt=j.tx*this.shy+j.ty*this.sy+this.ty;return new pn(fe,Oe,We,tt,It,Mt)},pn.prototype.decompose=function(){var j=this.sx,fe=this.shy,Oe=this.shx,We=this.sy,tt=this.tx,It=this.ty,Mt=Math.sqrt(j*j+fe*fe),ln=(j/=Mt)*Oe+(fe/=Mt)*We;Oe-=j*ln,We-=fe*ln;var mn=Math.sqrt(Oe*Oe+We*We);return ln/=mn,j*(We/=mn)<fe*(Oe/=mn)&&(j=-j,fe=-fe,ln=-ln,Mt=-Mt),{scale:new pn(Mt,0,0,mn,0,0),translate:new pn(1,0,0,1,tt,It),rotate:new pn(j,fe,-fe,j,0,0),skew:new pn(1,0,ln,1,0,0)}},pn.prototype.toString=function(j){return this.join(" ")},pn.prototype.inversed=function(){var j=this.sx,fe=this.shy,Oe=this.shx,We=this.sy,tt=this.tx,It=this.ty,Mt=1/(j*We-fe*Oe),ln=We*Mt,mn=-fe*Mt,Vn=-Oe*Mt,Rn=j*Mt;return new pn(ln,mn,Vn,Rn,-ln*tt-Vn*It,-mn*tt-Rn*It)},pn.prototype.applyToPoint=function(j){var fe=j.x*this.sx+j.y*this.shx+this.tx,Oe=j.x*this.shy+j.y*this.sy+this.ty;return new xr(fe,Oe)},pn.prototype.applyToRectangle=function(j){var fe=this.applyToPoint(j),Oe=this.applyToPoint(new xr(j.x+j.w,j.y+j.h));return new Gs(fe.x,fe.y,Oe.x-fe.x,Oe.y-fe.y)},pn.prototype.clone=function(){var j=this.sx,fe=this.shy,Oe=this.shx,We=this.sy,tt=this.tx,It=this.ty;return new pn(j,fe,Oe,We,tt,It)},A.Matrix=pn;var Ra=A.matrixMult=function(j,fe){return fe.multiply(j)},sa=new pn(1,0,0,1,0,0);A.unitMatrix=A.identityMatrix=sa;var Or=function(j,fe){if(!Pi[j]){var Oe=(fe instanceof jd?"Sh":"P")+(Object.keys(un).length+1).toString(10);fe.id=Oe,Pi[j]=Oe,un[Oe]=fe,Kn.publish("addPattern",fe)}};A.ShadingPattern=jd,A.TilingPattern=tp,A.addShadingPattern=function(j,fe){return J("addShadingPattern()"),Or(j,fe),this},A.beginTilingPattern=function(j){J("beginTilingPattern()"),Gr(j.boundingBox[0],j.boundingBox[1],j.boundingBox[2]-j.boundingBox[0],j.boundingBox[3]-j.boundingBox[1],j.matrix)},A.endTilingPattern=function(j,fe){J("endTilingPattern()"),fe.stream=Ft[Ee].join(`
`),Or(j,fe),Kn.publish("endTilingPattern",fe),Ri.pop().restore()};var bs,Oi=A.__private__.newObject=function(){var j=ir();return cr(j,!0),j},ir=A.__private__.newObjectDeferred=function(){return He++,Ye[He]=function(){return ct},He},cr=function(j,fe){return fe=typeof fe=="boolean"&&fe,Ye[j]=ct,fe&&Pe(j+" 0 obj"),j},cs=A.__private__.newAdditionalObject=function(){var j={objId:ir(),content:""};return Et.push(j),j},ns=ir(),qi=ir(),Yi=A.__private__.decodeColorString=function(j){var fe=j.split(" ");if(fe.length!==2||fe[1]!=="g"&&fe[1]!=="G")fe.length!==5||fe[4]!=="k"&&fe[4]!=="K"||(fe=[(1-fe[0])*(1-fe[3]),(1-fe[1])*(1-fe[3]),(1-fe[2])*(1-fe[3]),"r"]);else{var Oe=parseFloat(fe[0]);fe=[Oe,Oe,Oe,"r"]}for(var We="#",tt=0;tt<3;tt++)We+=("0"+Math.floor(255*parseFloat(fe[tt])).toString(16)).slice(-2);return We},Xr=A.__private__.encodeColorString=function(j){var fe;typeof j=="string"&&(j={ch1:j});var Oe=j.ch1,We=j.ch2,tt=j.ch3,It=j.ch4,Mt=j.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Oe=="string"&&Oe.charAt(0)!=="#"){var ln=new q4(Oe);if(ln.ok)Oe=ln.toHex();else if(!/^\d*\.?\d*$/.test(Oe))throw new Error('Invalid color "'+Oe+'" passed to jsPDF.encodeColorString.')}if(typeof Oe=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Oe)&&(Oe="#"+Oe[1]+Oe[1]+Oe[2]+Oe[2]+Oe[3]+Oe[3]),typeof Oe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Oe)){var mn=parseInt(Oe.substr(1),16);Oe=mn>>16&255,We=mn>>8&255,tt=255&mn}if(We===void 0||It===void 0&&Oe===We&&We===tt)fe=typeof Oe=="string"?Oe+" "+Mt[0]:j.precision===2?X(Oe/255)+" "+Mt[0]:ae(Oe/255)+" "+Mt[0];else if(It===void 0||zr(It)==="object"){if(It&&!isNaN(It.a)&&It.a===0)return["1.","1.","1.",Mt[1]].join(" ");fe=typeof Oe=="string"?[Oe,We,tt,Mt[1]].join(" "):j.precision===2?[X(Oe/255),X(We/255),X(tt/255),Mt[1]].join(" "):[ae(Oe/255),ae(We/255),ae(tt/255),Mt[1]].join(" ")}else fe=typeof Oe=="string"?[Oe,We,tt,It,Mt[2]].join(" "):j.precision===2?[X(Oe),X(We),X(tt),X(It),Mt[2]].join(" "):[ae(Oe),ae(We),ae(tt),ae(It),Mt[2]].join(" ");return fe},hs=A.__private__.getFilters=function(){return l},ya=A.__private__.putStream=function(j){var fe=(j=j||{}).data||"",Oe=j.filters||hs(),We=j.alreadyAppliedFilters||[],tt=j.addLength1||!1,It=fe.length,Mt=j.objectId,ln=function(K){return K};if(x!==null&&Mt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");x!==null&&(ln=dr.encryptor(Mt,0));var mn={};Oe===!0&&(Oe=["FlateEncode"]);var Vn=j.additionalKeyValues||[],Rn=(mn=Cn.API.processDataByFilters!==void 0?Cn.API.processDataByFilters(fe,Oe):{data:fe,reverseChain:[]}).reverseChain+(Array.isArray(We)?We.join(" "):We.toString());if(mn.data.length!==0&&(Vn.push({key:"Length",value:mn.data.length}),tt===!0&&Vn.push({key:"Length1",value:It})),Rn.length!=0)if(Rn.split("/").length-1==1)Vn.push({key:"Filter",value:Rn});else{Vn.push({key:"Filter",value:"["+Rn+"]"});for(var Ei=0;Ei<Vn.length;Ei+=1)if(Vn[Ei].key==="DecodeParms"){for(var Rr=[],fr=0;fr<mn.reverseChain.split("/").length-1;fr+=1)Rr.push("null");Rr.push(Vn[Ei].value),Vn[Ei].value="["+Rr.join(" ")+"]"}}Pe("<<");for(var E=0;E<Vn.length;E++)Pe("/"+Vn[E].key+" "+Vn[E].value);Pe(">>"),mn.data.length!==0&&(Pe("stream"),Pe(ln(mn.data)),Pe("endstream"))},Ba=A.__private__.putPage=function(j){var fe=j.number,Oe=j.data,We=j.objId,tt=j.contentsObjId;cr(We,!0),Pe("<</Type /Page"),Pe("/Parent "+j.rootDictionaryObjId+" 0 R"),Pe("/Resources "+j.resourceDictionaryObjId+" 0 R"),Pe("/MediaBox ["+parseFloat(ee(j.mediaBox.bottomLeftX))+" "+parseFloat(ee(j.mediaBox.bottomLeftY))+" "+ee(j.mediaBox.topRightX)+" "+ee(j.mediaBox.topRightY)+"]"),j.cropBox!==null&&Pe("/CropBox ["+ee(j.cropBox.bottomLeftX)+" "+ee(j.cropBox.bottomLeftY)+" "+ee(j.cropBox.topRightX)+" "+ee(j.cropBox.topRightY)+"]"),j.bleedBox!==null&&Pe("/BleedBox ["+ee(j.bleedBox.bottomLeftX)+" "+ee(j.bleedBox.bottomLeftY)+" "+ee(j.bleedBox.topRightX)+" "+ee(j.bleedBox.topRightY)+"]"),j.trimBox!==null&&Pe("/TrimBox ["+ee(j.trimBox.bottomLeftX)+" "+ee(j.trimBox.bottomLeftY)+" "+ee(j.trimBox.topRightX)+" "+ee(j.trimBox.topRightY)+"]"),j.artBox!==null&&Pe("/ArtBox ["+ee(j.artBox.bottomLeftX)+" "+ee(j.artBox.bottomLeftY)+" "+ee(j.artBox.topRightX)+" "+ee(j.artBox.topRightY)+"]"),typeof j.userUnit=="number"&&j.userUnit!==1&&Pe("/UserUnit "+j.userUnit),Kn.publish("putPage",{objId:We,pageContext:Gt[fe],pageNumber:fe,page:Oe}),Pe("/Contents "+tt+" 0 R"),Pe(">>"),Pe("endobj");var It=Oe.join(`
`);return me===he&&(It+=`
Q`),cr(tt,!0),ya({data:It,filters:hs(),objectId:tt}),Pe("endobj"),We},ds=A.__private__.putPages=function(){var j,fe,Oe=[];for(j=1;j<=tn;j++)Gt[j].objId=ir(),Gt[j].contentsObjId=ir();for(j=1;j<=tn;j++)Oe.push(Ba({number:j,data:Ft[j],objId:Gt[j].objId,contentsObjId:Gt[j].contentsObjId,mediaBox:Gt[j].mediaBox,cropBox:Gt[j].cropBox,bleedBox:Gt[j].bleedBox,trimBox:Gt[j].trimBox,artBox:Gt[j].artBox,userUnit:Gt[j].userUnit,rootDictionaryObjId:ns,resourceDictionaryObjId:qi}));cr(ns,!0),Pe("<</Type /Pages");var We="/Kids [";for(fe=0;fe<tn;fe++)We+=Oe[fe]+" 0 R ";Pe(We+"]"),Pe("/Count "+tn),Pe(">>"),Pe("endobj"),Kn.publish("postPutPages")},Jr=function(j){Kn.publish("putFont",{font:j,out:Pe,newObject:Oi,putStream:ya}),j.isAlreadyPutted!==!0&&(j.objectNumber=Oi(),Pe("<<"),Pe("/Type /Font"),Pe("/BaseFont /"+Jf(j.postScriptName)),Pe("/Subtype /Type1"),typeof j.encoding=="string"&&Pe("/Encoding /"+j.encoding),Pe("/FirstChar 32"),Pe("/LastChar 255"),Pe(">>"),Pe("endobj"))},ro=function(j){j.objectNumber=Oi();var fe=[];fe.push({key:"Type",value:"/XObject"}),fe.push({key:"Subtype",value:"/Form"}),fe.push({key:"BBox",value:"["+[ee(j.x),ee(j.y),ee(j.x+j.width),ee(j.y+j.height)].join(" ")+"]"}),fe.push({key:"Matrix",value:"["+j.matrix.toString()+"]"});var Oe=j.pages[1].join(`
`);ya({data:Oe,additionalKeyValues:fe,objectId:j.objectNumber}),Pe("endobj")},Ms=function(j,fe){fe||(fe=21);var Oe=Oi(),We=(function(Mt,ln){var mn,Vn=[],Rn=1/(ln-1);for(mn=0;mn<1;mn+=Rn)Vn.push(mn);if(Vn.push(1),Mt[0].offset!=0){var Ei={offset:0,color:Mt[0].color};Mt.unshift(Ei)}if(Mt[Mt.length-1].offset!=1){var Rr={offset:1,color:Mt[Mt.length-1].color};Mt.push(Rr)}for(var fr="",E=0,K=0;K<Vn.length;K++){for(mn=Vn[K];mn>Mt[E+1].offset;)E++;var ne=Mt[E].offset,Ie=(mn-ne)/(Mt[E+1].offset-ne),at=Mt[E].color,ft=Mt[E+1].color;fr+=Be(Math.round((1-Ie)*at[0]+Ie*ft[0]).toString(16))+Be(Math.round((1-Ie)*at[1]+Ie*ft[1]).toString(16))+Be(Math.round((1-Ie)*at[2]+Ie*ft[2]).toString(16))}return fr.trim()})(j.colors,fe),tt=[];tt.push({key:"FunctionType",value:"0"}),tt.push({key:"Domain",value:"[0.0 1.0]"}),tt.push({key:"Size",value:"["+fe+"]"}),tt.push({key:"BitsPerSample",value:"8"}),tt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),tt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ya({data:We,additionalKeyValues:tt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Oe}),Pe("endobj"),j.objectNumber=Oi(),Pe("<< /ShadingType "+j.type),Pe("/ColorSpace /DeviceRGB");var It="/Coords ["+ee(parseFloat(j.coords[0]))+" "+ee(parseFloat(j.coords[1]))+" ";j.type===2?It+=ee(parseFloat(j.coords[2]))+" "+ee(parseFloat(j.coords[3])):It+=ee(parseFloat(j.coords[2]))+" "+ee(parseFloat(j.coords[3]))+" "+ee(parseFloat(j.coords[4]))+" "+ee(parseFloat(j.coords[5])),Pe(It+="]"),j.matrix&&Pe("/Matrix ["+j.matrix.toString()+"]"),Pe("/Function "+Oe+" 0 R"),Pe("/Extend [true true]"),Pe(">>"),Pe("endobj")},Fs=function(j,fe){var Oe=ir(),We=Oi();fe.push({resourcesOid:Oe,objectOid:We}),j.objectNumber=We;var tt=[];tt.push({key:"Type",value:"/Pattern"}),tt.push({key:"PatternType",value:"1"}),tt.push({key:"PaintType",value:"1"}),tt.push({key:"TilingType",value:"1"}),tt.push({key:"BBox",value:"["+j.boundingBox.map(ee).join(" ")+"]"}),tt.push({key:"XStep",value:ee(j.xStep)}),tt.push({key:"YStep",value:ee(j.yStep)}),tt.push({key:"Resources",value:Oe+" 0 R"}),j.matrix&&tt.push({key:"Matrix",value:"["+j.matrix.toString()+"]"}),ya({data:j.stream,additionalKeyValues:tt,objectId:j.objectNumber}),Pe("endobj")},aa=function(j){for(var fe in j.objectNumber=Oi(),Pe("<<"),j)switch(fe){case"opacity":Pe("/ca "+X(j[fe]));break;case"stroke-opacity":Pe("/CA "+X(j[fe]))}Pe(">>"),Pe("endobj")},js=function(j){cr(j.resourcesOid,!0),Pe("<<"),Pe("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var fe in Pe("/Font <<"),vn)vn.hasOwnProperty(fe)&&(p===!1||p===!0&&w.hasOwnProperty(fe))&&Pe("/"+fe+" "+vn[fe].objectNumber+" 0 R");Pe(">>")})(),(function(){if(Object.keys(un).length>0){for(var fe in Pe("/Shading <<"),un)un.hasOwnProperty(fe)&&un[fe]instanceof jd&&un[fe].objectNumber>=0&&Pe("/"+fe+" "+un[fe].objectNumber+" 0 R");Kn.publish("putShadingPatternDict"),Pe(">>")}})(),(function(fe){if(Object.keys(un).length>0){for(var Oe in Pe("/Pattern <<"),un)un.hasOwnProperty(Oe)&&un[Oe]instanceof A.TilingPattern&&un[Oe].objectNumber>=0&&un[Oe].objectNumber<fe&&Pe("/"+Oe+" "+un[Oe].objectNumber+" 0 R");Kn.publish("putTilingPatternDict"),Pe(">>")}})(j.objectOid),(function(){if(Object.keys(Mn).length>0){var fe;for(fe in Pe("/ExtGState <<"),Mn)Mn.hasOwnProperty(fe)&&Mn[fe].objectNumber>=0&&Pe("/"+fe+" "+Mn[fe].objectNumber+" 0 R");Kn.publish("putGStateDict"),Pe(">>")}})(),(function(){for(var fe in Pe("/XObject <<"),vr)vr.hasOwnProperty(fe)&&vr[fe].objectNumber>=0&&Pe("/"+fe+" "+vr[fe].objectNumber+" 0 R");Kn.publish("putXobjectDict"),Pe(">>")})(),Pe(">>"),Pe("endobj")},hr=function(j){On[j.fontName]=On[j.fontName]||{},On[j.fontName][j.fontStyle]=j.id},vl=function(j,fe,Oe,We,tt){var It={id:"F"+(Object.keys(vn).length+1).toString(10),postScriptName:j,fontName:fe,fontStyle:Oe,encoding:We,isStandardFont:tt||!1,metadata:{}};return Kn.publish("addFont",{font:It,instance:this}),vn[It.id]=It,hr(It),It.id},Vs=A.__private__.pdfEscape=A.pdfEscape=function(j,fe){return(function(Oe,We){var tt,It,Mt,ln,mn,Vn,Rn,Ei,Rr;if(Mt=(We=We||{}).sourceEncoding||"Unicode",mn=We.outputEncoding,(We.autoencode||mn)&&vn[cn].metadata&&vn[cn].metadata[Mt]&&vn[cn].metadata[Mt].encoding&&(ln=vn[cn].metadata[Mt].encoding,!mn&&vn[cn].encoding&&(mn=vn[cn].encoding),!mn&&ln.codePages&&(mn=ln.codePages[0]),typeof mn=="string"&&(mn=ln[mn]),mn)){for(Rn=!1,Vn=[],tt=0,It=Oe.length;tt<It;tt++)(Ei=mn[Oe.charCodeAt(tt)])?Vn.push(String.fromCharCode(Ei)):Vn.push(Oe[tt]),Vn[tt].charCodeAt(0)>>8&&(Rn=!0);Oe=Vn.join("")}for(tt=Oe.length;Rn===void 0&&tt!==0;)Oe.charCodeAt(tt-1)>>8&&(Rn=!0),tt--;if(!Rn)return Oe;for(Vn=We.noBOM?[]:[254,255],tt=0,It=Oe.length;tt<It;tt++){if((Rr=(Ei=Oe.charCodeAt(tt))>>8)>>8)throw new Error("Character at position "+tt+" of string '"+Oe+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Vn.push(Rr),Vn.push(Ei-(Rr<<8))}return String.fromCharCode.apply(void 0,Vn)})(j,fe).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},va=A.__private__.beginPage=function(j){Ft[++tn]=[],Gt[tn]={objId:0,contentsObjId:0,userUnit:Number(u),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(j[0]),topRightY:Number(j[1])}},nl(tn),kt(Ft[Ee])},Is=function(j,fe){var Oe,We,tt;switch(t=fe||t,typeof j=="string"&&(Oe=q(j.toLowerCase()),Array.isArray(Oe)&&(We=Oe[0],tt=Oe[1])),Array.isArray(j)&&(We=j[0]*$n,tt=j[1]*$n),isNaN(We)&&(We=r[0],tt=r[1]),(We>14400||tt>14400)&&(ts.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),We=Math.min(14400,We),tt=Math.min(14400,tt)),r=[We,tt],t.substr(0,1)){case"l":tt>We&&(r=[tt,We]);break;case"p":We>tt&&(r=[tt,We])}va(r),Qt(Xi),Pe(Bs),Ir!==0&&Pe(Ir+" J"),kr!==0&&Pe(kr+" j"),Kn.publish("addPage",{pageNumber:tn})},jo=function(j){j>0&&j<=tn&&(Ft.splice(j,1),Gt.splice(j,1),tn--,Ee>tn&&(Ee=tn),this.setPage(Ee))},nl=function(j){j>0&&j<=tn&&(Ee=j)},il=A.__private__.getNumberOfPages=A.getNumberOfPages=function(){return Ft.length-1},Vo=function(j,fe,Oe){var We,tt=void 0;return Oe=Oe||{},j=j!==void 0?j:vn[cn].fontName,fe=fe!==void 0?fe:vn[cn].fontStyle,We=j.toLowerCase(),On[We]!==void 0&&On[We][fe]!==void 0?tt=On[We][fe]:On[j]!==void 0&&On[j][fe]!==void 0?tt=On[j][fe]:Oe.disableWarning===!1&&ts.warn("Unable to look up font label for font '"+j+"', '"+fe+"'. Refer to getFontList() for available fonts."),tt||Oe.noFallback||(tt=On.times[fe])==null&&(tt=On.times.normal),tt},oi=A.__private__.putInfo=function(){var j=Oi(),fe=function(We){return We};for(var Oe in x!==null&&(fe=dr.encryptor(j,0)),Pe("<<"),Pe("/Producer ("+Vs(fe("jsPDF "+Cn.version))+")"),Xn)Xn.hasOwnProperty(Oe)&&Xn[Oe]&&Pe("/"+Oe.substr(0,1).toUpperCase()+Oe.substr(1)+" ("+Vs(fe(Xn[Oe]))+")");Pe("/CreationDate ("+Vs(fe(nt))+")"),Pe(">>"),Pe("endobj")},Hr=A.__private__.putCatalog=function(j){var fe=(j=j||{}).rootDictionaryObjId||ns;switch(Oi(),Pe("<<"),Pe("/Type /Catalog"),Pe("/Pages "+fe+" 0 R"),rn||(rn="fullwidth"),rn){case"fullwidth":Pe("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Pe("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Pe("/OpenAction [3 0 R /Fit]");break;case"original":Pe("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Oe=""+rn;Oe.substr(Oe.length-1)==="%"&&(rn=parseInt(rn)/100),typeof rn=="number"&&Pe("/OpenAction [3 0 R /XYZ null null "+X(rn)+"]")}switch(ii||(ii="continuous"),ii){case"continuous":Pe("/PageLayout /OneColumn");break;case"single":Pe("/PageLayout /SinglePage");break;case"two":case"twoleft":Pe("/PageLayout /TwoColumnLeft");break;case"tworight":Pe("/PageLayout /TwoColumnRight")}wn&&Pe("/PageMode /"+wn),Kn.publish("putCatalog"),Pe(">>"),Pe("endobj")},_r=A.__private__.putTrailer=function(){Pe("trailer"),Pe("<<"),Pe("/Size "+(He+1)),Pe("/Root "+He+" 0 R"),Pe("/Info "+(He-1)+" 0 R"),x!==null&&Pe("/Encrypt "+dr.oid+" 0 R"),Pe("/ID [ <"+je+"> <"+je+"> ]"),Pe(">>")},dn=A.__private__.putHeader=function(){Pe("%PDF-"+B),Pe("%")},Da=A.__private__.putXRef=function(){var j="0000000000";Pe("xref"),Pe("0 "+(He+1)),Pe("0000000000 65535 f ");for(var fe=1;fe<=He;fe++)typeof Ye[fe]=="function"?Pe((j+Ye[fe]()).slice(-10)+" 00000 n "):Ye[fe]!==void 0?Pe((j+Ye[fe]).slice(-10)+" 00000 n "):Pe("0000000000 00000 n ")},zs=A.__private__.buildDocument=function(){var j;He=0,ct=0,it=[],Ye=[],Et=[],ns=ir(),qi=ir(),kt(it),Kn.publish("buildDocument"),dn(),ds(),(function(){Kn.publish("putAdditionalObjects");for(var Oe=0;Oe<Et.length;Oe++){var We=Et[Oe];cr(We.objId,!0),Pe(We.content),Pe("endobj")}Kn.publish("postPutAdditionalObjects")})(),j=[],(function(){for(var Oe in vn)vn.hasOwnProperty(Oe)&&(p===!1||p===!0&&w.hasOwnProperty(Oe))&&Jr(vn[Oe])})(),(function(){var Oe;for(Oe in Mn)Mn.hasOwnProperty(Oe)&&aa(Mn[Oe])})(),(function(){for(var Oe in vr)vr.hasOwnProperty(Oe)&&ro(vr[Oe])})(),(function(Oe){var We;for(We in un)un.hasOwnProperty(We)&&(un[We]instanceof jd?Ms(un[We]):un[We]instanceof tp&&Fs(un[We],Oe))})(j),Kn.publish("putResources"),j.forEach(js),js({resourcesOid:qi,objectOid:Number.MAX_SAFE_INTEGER}),Kn.publish("postPutResources"),x!==null&&(dr.oid=Oi(),Pe("<<"),Pe("/Filter /Standard"),Pe("/V "+dr.v),Pe("/R "+dr.r),Pe("/U <"+dr.toHexString(dr.U)+">"),Pe("/O <"+dr.toHexString(dr.O)+">"),Pe("/P "+dr.P),Pe(">>"),Pe("endobj")),oi(),Hr();var fe=ct;return Da(),_r(),Pe("startxref"),Pe(""+fe),Pe("%%EOF"),kt(Ft[Ee]),it.join(`
`)},yi=A.__private__.getBlob=function(j){return new Blob([Pt(j)],{type:"application/pdf"})},$a=A.output=A.__private__.output=(bs=function(j,fe){switch(typeof(fe=fe||{})=="string"?fe={filename:fe}:fe.filename=fe.filename||"generated.pdf",j){case void 0:return zs();case"save":A.save(fe.filename);break;case"arraybuffer":return Pt(zs());case"blob":return yi(zs());case"bloburi":case"bloburl":if(ai.URL!==void 0&&typeof ai.URL.createObjectURL=="function")return ai.URL&&ai.URL.createObjectURL(yi(zs()))||void 0;ts.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Oe="",We=zs();try{Oe=Rk(We)}catch{Oe=Rk(unescape(encodeURIComponent(We)))}return"data:application/pdf;filename="+fe.filename+";base64,"+Oe;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ai)==="[object Window]"){var tt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",It=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';fe.pdfObjectUrl&&(tt=fe.pdfObjectUrl,It="");var Mt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+tt+'"'+It+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(fe)+");<\/script></body></html>",ln=ai.open();return ln!==null&&ln.document.write(Mt),ln}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ai)==="[object Window]"){var mn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(fe.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+fe.filename+'" width="500px" height="400px" /></body></html>',Vn=ai.open();if(Vn!==null){Vn.document.write(mn);var Rn=this;Vn.document.documentElement.querySelector("#pdfViewer").onload=function(){Vn.document.title=fe.filename,Vn.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Rn.output("bloburl"))}}return Vn}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ai)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ei='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",fe)+'"></iframe></body></html>',Rr=ai.open();if(Rr!==null&&(Rr.document.write(Ei),Rr.document.title=fe.filename),Rr||typeof safari>"u")return Rr;break;case"datauri":case"dataurl":return ai.document.location.href=this.output("datauristring",fe);default:return null}},bs.foo=function(){try{return bs.apply(this,arguments)}catch(Oe){var j=Oe.stack||"";~j.indexOf(" at ")&&(j=j.split(" at ")[1]);var fe="Error in function "+j.split(`
`)[0].split("<")[0]+": "+Oe.message;if(!ai.console)throw new Error(fe);ai.console.error(fe,Oe),ai.alert&&alert(fe)}},bs.foo.bar=bs,bs.foo),ri=function(j){return Array.isArray(Nr)===!0&&Nr.indexOf(j)>-1};switch(n){case"pt":$n=1;break;case"mm":$n=72/25.4;break;case"cm":$n=72/2.54;break;case"in":$n=72;break;case"px":$n=ri("px_scaling")==1?.75:96/72;break;case"pc":case"em":$n=12;break;case"ex":$n=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);$n=n}var dr=null;Ne(),qe();var Mr=A.__private__.getPageInfo=A.getPageInfo=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Gt[j].objId,pageNumber:j,pageContext:Gt[j]}},zo=A.__private__.getPageInfoByObjId=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var fe in Gt)if(Gt[fe].objId===j)break;return Mr(fe)},$l=A.__private__.getCurrentPageInfo=A.getCurrentPageInfo=function(){return{objId:Gt[Ee].objId,pageNumber:Ee,pageContext:Gt[Ee]}};A.addPage=function(){return Is.apply(this,arguments),this},A.setPage=function(){return nl.apply(this,arguments),kt.call(this,Ft[Ee]),this},A.insertPage=function(j){return this.addPage(),this.movePage(Ee,j),this},A.movePage=function(j,fe){var Oe,We;if(j>fe){Oe=Ft[j],We=Gt[j];for(var tt=j;tt>fe;tt--)Ft[tt]=Ft[tt-1],Gt[tt]=Gt[tt-1];Ft[fe]=Oe,Gt[fe]=We,this.setPage(fe)}else if(j<fe){Oe=Ft[j],We=Gt[j];for(var It=j;It<fe;It++)Ft[It]=Ft[It+1],Gt[It]=Gt[It+1];Ft[fe]=Oe,Gt[fe]=We,this.setPage(fe)}return this},A.deletePage=function(){return jo.apply(this,arguments),this},A.__private__.text=A.text=function(j,fe,Oe,We,tt){var It,Mt,ln,mn,Vn,Rn,Ei,Rr,fr,E=(We=We||{}).scope||this;if(typeof j=="number"&&typeof fe=="number"&&(typeof Oe=="string"||Array.isArray(Oe))){var K=Oe;Oe=fe,fe=j,j=K}if(arguments[3]instanceof pn==0?(ln=arguments[4],mn=arguments[5],zr(Ei=arguments[3])==="object"&&Ei!==null||(typeof ln=="string"&&(mn=ln,ln=null),typeof Ei=="string"&&(mn=Ei,Ei=null),typeof Ei=="number"&&(ln=Ei,Ei=null),We={flags:Ei,angle:ln,align:mn})):(J("The transform parameter of text() with a Matrix value"),fr=tt),isNaN(fe)||isNaN(Oe)||j==null)throw new Error("Invalid arguments passed to jsPDF.text");if(j.length===0)return E;var ne,Ie="",at=typeof We.lineHeightFactor=="number"?We.lineHeightFactor:ui,ft=E.internal.scaleFactor;function Vt(Li){return Li=Li.split("	").join(Array(We.TabLen||9).join(" ")),Vs(Li,Ei)}function Zn(Li){for(var zi,Dr=Li.concat(),gs=[],ul=Dr.length;ul--;)typeof(zi=Dr.shift())=="string"?gs.push(zi):Array.isArray(Li)&&(zi.length===1||zi[1]===void 0&&zi[2]===void 0)?gs.push(zi[0]):gs.push([zi[0],zi[1],zi[2]]);return gs}function lr(Li,zi){var Dr;if(typeof Li=="string")Dr=zi(Li)[0];else if(Array.isArray(Li)){for(var gs,ul,qo=Li.concat(),pu=[],pc=qo.length;pc--;)typeof(gs=qo.shift())=="string"?pu.push(zi(gs)[0]):Array.isArray(gs)&&typeof gs[0]=="string"&&(ul=zi(gs[0],gs[1],gs[2]),pu.push([ul[0],ul[1],ul[2]]));Dr=pu}return Dr}var ci=!1,rr=!0;if(typeof j=="string")ci=!0;else if(Array.isArray(j)){var Ws=j.concat();Mt=[];for(var ua,wr=Ws.length;wr--;)(typeof(ua=Ws.shift())!="string"||Array.isArray(ua)&&typeof ua[0]!="string")&&(rr=!1);ci=rr}if(ci===!1)throw new Error('Type of text must be string or Array. "'+j+'" is not recognized.');typeof j=="string"&&(j=j.match(/[\r?\n]/)?j.split(/\r\n|\r|\n/g):[j]);var ca=_t/E.internal.scaleFactor,qa=ca*(at-1);switch(We.baseline){case"bottom":Oe-=qa;break;case"top":Oe+=ca-qa;break;case"hanging":Oe+=ca-2*qa;break;case"middle":Oe+=ca/2-qa}if((Rn=We.maxWidth||0)>0&&(typeof j=="string"?j=E.splitTextToSize(j,Rn):Object.prototype.toString.call(j)==="[object Array]"&&(j=j.reduce(function(Li,zi){return Li.concat(E.splitTextToSize(zi,Rn))},[]))),It={text:j,x:fe,y:Oe,options:We,mutex:{pdfEscape:Vs,activeFontKey:cn,fonts:vn,activeFontSize:_t}},Kn.publish("preProcessText",It),j=It.text,ln=(We=It.options).angle,fr instanceof pn==0&&ln&&typeof ln=="number"){ln*=Math.PI/180,We.rotationDirection===0&&(ln=-ln),me===he&&(ln=-ln);var $o=Math.cos(ln),rl=Math.sin(ln);fr=new pn($o,rl,-rl,$o,0,0)}else ln&&ln instanceof pn&&(fr=ln);me!==he||fr||(fr=sa),(Vn=We.charSpace||ks)!==void 0&&(Ie+=ee(le(Vn))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Rr=We.horizontalScale)!==void 0&&(Ie+=ee(100*Rr)+` Tz
`),We.lang;var xa=-1,wl=We.renderingMode!==void 0?We.renderingMode:We.stroke,Mu=E.internal.getCurrentPageInfo().pageContext;switch(wl){case 0:case!1:case"fill":xa=0;break;case 1:case!0:case"stroke":xa=1;break;case 2:case"fillThenStroke":xa=2;break;case 3:case"invisible":xa=3;break;case 4:case"fillAndAddForClipping":xa=4;break;case 5:case"strokeAndAddPathForClipping":xa=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":xa=6;break;case 7:case"addToPathForClipping":xa=7}var hc=Mu.usedRenderingMode!==void 0?Mu.usedRenderingMode:-1;xa!==-1?Ie+=xa+` Tr
`:hc!==-1&&(Ie+=`0 Tr
`),xa!==-1&&(Mu.usedRenderingMode=xa),mn=We.align||"left";var oo,Ho=_t*at,Sl=E.internal.pageSize.getWidth(),dc=vn[cn];Vn=We.charSpace||ks,Rn=We.maxWidth||0,Ei=Object.assign({autoencode:!0,noBOM:!0},We.flags);var Go=[],Hl=function(Li){return E.getStringUnitWidth(Li,{font:dc,charSpace:Vn,fontSize:_t,doKerning:!1})*_t/ft};if(Object.prototype.toString.call(j)==="[object Array]"){var Ya;Mt=Zn(j),mn!=="left"&&(oo=Mt.map(Hl));var Na,Ko=0;if(mn==="right"){fe-=oo[0],j=[],wr=Mt.length;for(var sl=0;sl<wr;sl++)sl===0?(Na=Er(fe),Ya=Ai(Oe)):(Na=le(Ko-oo[sl]),Ya=-Ho),j.push([Mt[sl],Na,Ya]),Ko=oo[sl]}else if(mn==="center"){fe-=oo[0]/2,j=[],wr=Mt.length;for(var al=0;al<wr;al++)al===0?(Na=Er(fe),Ya=Ai(Oe)):(Na=le((Ko-oo[al])/2),Ya=-Ho),j.push([Mt[al],Na,Ya]),Ko=oo[al]}else if(mn==="left"){j=[],wr=Mt.length;for(var Fu=0;Fu<wr;Fu++)j.push(Mt[Fu])}else if(mn==="justify"&&dc.encoding==="Identity-H"){j=[],wr=Mt.length,Rn=Rn!==0?Rn:Sl;for(var fu=0,ps=0;ps<wr;ps++)if(Ya=ps===0?Ai(Oe):-Ho,Na=ps===0?Er(fe):fu,ps<wr-1){var fc=le((Rn-oo[ps])/(Mt[ps].split(" ").length-1)),ol=Mt[ps].split(" ");j.push([ol[0]+" ",Na,Ya]),fu=0;for(var Cs=1;Cs<ol.length;Cs++){var Rs=(Hl(ol[Cs-1]+" "+ol[Cs])-Hl(ol[Cs]))*ft+fc;Cs==ol.length-1?j.push([ol[Cs],Rs,0]):j.push([ol[Cs]+" ",Rs,0]),fu-=Rs}}else j.push([Mt[ps],Na,Ya]);j.push(["",fu,0])}else{if(mn!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(j=[],wr=Mt.length,Rn=Rn!==0?Rn:Sl,ps=0;ps<wr;ps++){Ya=ps===0?Ai(Oe):-Ho,Na=ps===0?Er(fe):0;var Tl=Mt[ps].split(" ").length-1,lo=Tl>0?(Rn-oo[ps])/Tl:0;ps<wr-1?Go.push(ee(le(lo))):Go.push(0),j.push([Mt[ps],Na,Ya])}}}(typeof We.R2L=="boolean"?We.R2L:En)===!0&&(j=lr(j,function(Li,zi,Dr){return[Li.split("").reverse().join(""),zi,Dr]})),It={text:j,x:fe,y:Oe,options:We,mutex:{pdfEscape:Vs,activeFontKey:cn,fonts:vn,activeFontSize:_t}},Kn.publish("postProcessText",It),j=It.text,ne=It.mutex.isHex||!1;var ju=vn[cn].encoding;ju!=="WinAnsiEncoding"&&ju!=="StandardEncoding"||(j=lr(j,function(Li,zi,Dr){return[Vt(Li),zi,Dr]})),Mt=Zn(j),j=[];for(var Wo,uo,ll,Gl=Array.isArray(Mt[0])?1:0,Xa="",Wn=function(Li,zi,Dr){var gs="";return Dr instanceof pn?(Dr=typeof We.angle=="number"?Ra(Dr,new pn(1,0,0,1,Li,zi)):Ra(new pn(1,0,0,1,Li,zi),Dr),me===he&&(Dr=Ra(new pn(1,0,0,-1,0,0),Dr)),gs=Dr.join(" ")+` Tm
`):gs=ee(Li)+" "+ee(zi)+` Td
`,gs},Ii=0;Ii<Mt.length;Ii++){switch(Xa="",Gl){case 1:ll=(ne?"<":"(")+Mt[Ii][0]+(ne?">":")"),Wo=parseFloat(Mt[Ii][1]),uo=parseFloat(Mt[Ii][2]);break;case 0:ll=(ne?"<":"(")+Mt[Ii]+(ne?">":")"),Wo=Er(fe),uo=Ai(Oe)}Go!==void 0&&Go[Ii]!==void 0&&(Xa=Go[Ii]+` Tw
`),Ii===0?j.push(Xa+Wn(Wo,uo,fr)+ll):Gl===0?j.push(Xa+ll):Gl===1&&j.push(Xa+Wn(Wo,uo,fr)+ll)}j=Gl===0?j.join(` Tj
T* `):j.join(` Tj
`),j+=` Tj
`;var is=`BT
/`;return is+=cn+" "+_t+` Tf
`,is+=ee(_t*at)+` TL
`,is+=$s+`
`,is+=Ie,is+=j,Pe(is+="ET"),w[cn]=!0,E};var Uo=A.__private__.clip=A.clip=function(j){return Pe(j==="evenodd"?"W*":"W"),this};A.clipEvenOdd=function(){return Uo("evenodd")},A.__private__.discardPath=A.discardPath=function(){return Pe("n"),this};var br=A.__private__.isValidStyle=function(j){var fe=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(j)!==-1&&(fe=!0),fe};A.__private__.setDefaultPathOperation=A.setDefaultPathOperation=function(j){return br(j)&&(f=j),this};var _l=A.__private__.getStyle=A.getStyle=function(j){var fe=f;switch(j){case"D":case"S":fe="S";break;case"F":fe="f";break;case"FD":case"DF":fe="B";break;case"f":case"f*":case"B":case"B*":fe=j}return fe},oa=A.close=function(){return Pe("h"),this};A.stroke=function(){return Pe("S"),this},A.fill=function(j){return Mi("f",j),this},A.fillEvenOdd=function(j){return Mi("f*",j),this},A.fillStroke=function(j){return Mi("B",j),this},A.fillStrokeEvenOdd=function(j){return Mi("B*",j),this};var Mi=function(j,fe){zr(fe)==="object"?xl(fe,j):Pe(j)},so=function(j){j===null||me===he&&j===void 0||(j=_l(j),Pe(j))};function bl(j,fe,Oe,We,tt){var It=new tp(fe||this.boundingBox,Oe||this.xStep,We||this.yStep,this.gState,tt||this.matrix);It.stream=this.stream;var Mt=j+"$$"+this.cloneIndex+++"$$";return Or(Mt,It),It}var xl=function(j,fe){var Oe=Pi[j.key],We=un[Oe];if(We instanceof jd)Pe("q"),Pe(Bo(fe)),We.gState&&A.setGState(We.gState),Pe(j.matrix.toString()+" cm"),Pe("/"+Oe+" sh"),Pe("Q");else if(We instanceof tp){var tt=new pn(1,0,0,-1,0,Cr());j.matrix&&(tt=tt.multiply(j.matrix||sa),Oe=bl.call(We,j.key,j.boundingBox,j.xStep,j.yStep,tt).id),Pe("q"),Pe("/Pattern cs"),Pe("/"+Oe+" scn"),We.gState&&A.setGState(We.gState),Pe(fe),Pe("Q")}},Bo=function(j){switch(j){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Ha=A.moveTo=function(j,fe){return Pe(ee(le(j))+" "+ee(ze(fe))+" m"),this},At=A.lineTo=function(j,fe){return Pe(ee(le(j))+" "+ee(ze(fe))+" l"),this},St=A.curveTo=function(j,fe,Oe,We,tt,It){return Pe([ee(le(j)),ee(ze(fe)),ee(le(Oe)),ee(ze(We)),ee(le(tt)),ee(ze(It)),"c"].join(" ")),this};A.__private__.line=A.line=function(j,fe,Oe,We,tt){if(isNaN(j)||isNaN(fe)||isNaN(Oe)||isNaN(We)||!br(tt))throw new Error("Invalid arguments passed to jsPDF.line");return me===ge?this.lines([[Oe-j,We-fe]],j,fe,[1,1],tt||"S"):this.lines([[Oe-j,We-fe]],j,fe,[1,1]).stroke()},A.__private__.lines=A.lines=function(j,fe,Oe,We,tt,It){var Mt,ln,mn,Vn,Rn,Ei,Rr,fr,E,K,ne,Ie;if(typeof j=="number"&&(Ie=Oe,Oe=fe,fe=j,j=Ie),We=We||[1,1],It=It||!1,isNaN(fe)||isNaN(Oe)||!Array.isArray(j)||!Array.isArray(We)||!br(tt)||typeof It!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ha(fe,Oe),Mt=We[0],ln=We[1],Vn=j.length,K=fe,ne=Oe,mn=0;mn<Vn;mn++)(Rn=j[mn]).length===2?(K=Rn[0]*Mt+K,ne=Rn[1]*ln+ne,At(K,ne)):(Ei=Rn[0]*Mt+K,Rr=Rn[1]*ln+ne,fr=Rn[2]*Mt+K,E=Rn[3]*ln+ne,K=Rn[4]*Mt+K,ne=Rn[5]*ln+ne,St(Ei,Rr,fr,E,K,ne));return It&&oa(),so(tt),this},A.path=function(j){for(var fe=0;fe<j.length;fe++){var Oe=j[fe],We=Oe.c;switch(Oe.op){case"m":Ha(We[0],We[1]);break;case"l":At(We[0],We[1]);break;case"c":St.apply(this,We);break;case"h":oa()}}return this},A.__private__.rect=A.rect=function(j,fe,Oe,We,tt){if(isNaN(j)||isNaN(fe)||isNaN(Oe)||isNaN(We)||!br(tt))throw new Error("Invalid arguments passed to jsPDF.rect");return me===ge&&(We=-We),Pe([ee(le(j)),ee(ze(fe)),ee(le(Oe)),ee(le(We)),"re"].join(" ")),so(tt),this},A.__private__.triangle=A.triangle=function(j,fe,Oe,We,tt,It,Mt){if(isNaN(j)||isNaN(fe)||isNaN(Oe)||isNaN(We)||isNaN(tt)||isNaN(It)||!br(Mt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Oe-j,We-fe],[tt-Oe,It-We],[j-tt,fe-It]],j,fe,[1,1],Mt,!0),this},A.__private__.roundedRect=A.roundedRect=function(j,fe,Oe,We,tt,It,Mt){if(isNaN(j)||isNaN(fe)||isNaN(Oe)||isNaN(We)||isNaN(tt)||isNaN(It)||!br(Mt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ln=4/3*(Math.SQRT2-1);return tt=Math.min(tt,.5*Oe),It=Math.min(It,.5*We),this.lines([[Oe-2*tt,0],[tt*ln,0,tt,It-It*ln,tt,It],[0,We-2*It],[0,It*ln,-tt*ln,It,-tt,It],[2*tt-Oe,0],[-tt*ln,0,-tt,-It*ln,-tt,-It],[0,2*It-We],[0,-It*ln,tt*ln,-It,tt,-It]],j+tt,fe,[1,1],Mt,!0),this},A.__private__.ellipse=A.ellipse=function(j,fe,Oe,We,tt){if(isNaN(j)||isNaN(fe)||isNaN(Oe)||isNaN(We)||!br(tt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var It=4/3*(Math.SQRT2-1)*Oe,Mt=4/3*(Math.SQRT2-1)*We;return Ha(j+Oe,fe),St(j+Oe,fe-Mt,j+It,fe-We,j,fe-We),St(j-It,fe-We,j-Oe,fe-Mt,j-Oe,fe),St(j-Oe,fe+Mt,j-It,fe+We,j,fe+We),St(j+It,fe+We,j+Oe,fe+Mt,j+Oe,fe),so(tt),this},A.__private__.circle=A.circle=function(j,fe,Oe,We){if(isNaN(j)||isNaN(fe)||isNaN(Oe)||!br(We))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(j,fe,Oe,Oe,We)},A.setFont=function(j,fe,Oe){return Oe&&(fe=pe(fe,Oe)),cn=Vo(j,fe,{disableWarning:!1}),this};var fn=A.__private__.getFont=A.getFont=function(){return vn[Vo.apply(A,arguments)]};A.__private__.getFontList=A.getFontList=function(){var j,fe,Oe={};for(j in On)if(On.hasOwnProperty(j))for(fe in Oe[j]=[],On[j])On[j].hasOwnProperty(fe)&&Oe[j].push(fe);return Oe},A.addFont=function(j,fe,Oe,We,tt){var It=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&It.indexOf(arguments[3])!==-1?tt=arguments[3]:arguments[3]&&It.indexOf(arguments[3])==-1&&(Oe=pe(Oe,We)),vl.call(this,j,fe,Oe,tt=tt||"Identity-H")};var ui,Xi=i.lineWidth||.200025,vi=A.__private__.getLineWidth=A.getLineWidth=function(){return Xi},Qt=A.__private__.setLineWidth=A.setLineWidth=function(j){return Xi=j,Pe(ee(le(j))+" w"),this};A.__private__.setLineDash=Cn.API.setLineDash=Cn.API.setLineDashPattern=function(j,fe){if(j=j||[],fe=fe||0,isNaN(fe)||!Array.isArray(j))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return j=j.map(function(Oe){return ee(le(Oe))}).join(" "),fe=ee(le(fe)),Pe("["+j+"] "+fe+" d"),this};var xs=A.__private__.getLineHeight=A.getLineHeight=function(){return _t*ui};A.__private__.getLineHeight=A.getLineHeight=function(){return _t*ui};var _a=A.__private__.setLineHeightFactor=A.setLineHeightFactor=function(j){return typeof(j=j||1.15)=="number"&&(ui=j),this},Us=A.__private__.getLineHeightFactor=A.getLineHeightFactor=function(){return ui};_a(i.lineHeight);var Er=A.__private__.getHorizontalCoordinate=function(j){return le(j)},Ai=A.__private__.getVerticalCoordinate=function(j){return me===he?j:Gt[Ee].mediaBox.topRightY-Gt[Ee].mediaBox.bottomLeftY-le(j)},ba=A.__private__.getHorizontalCoordinateString=A.getHorizontalCoordinateString=function(j){return ee(Er(j))},Ci=A.__private__.getVerticalCoordinateString=A.getVerticalCoordinateString=function(j){return ee(Ai(j))},Bs=i.strokeColor||"0 G";A.__private__.getStrokeColor=A.getDrawColor=function(){return Yi(Bs)},A.__private__.setStrokeColor=A.setDrawColor=function(j,fe,Oe,We){return Bs=Xr({ch1:j,ch2:fe,ch3:Oe,ch4:We,pdfColorType:"draw",precision:2}),Pe(Bs),this};var Ga=i.fillColor||"0 g";A.__private__.getFillColor=A.getFillColor=function(){return Yi(Ga)},A.__private__.setFillColor=A.setFillColor=function(j,fe,Oe,We){return Ga=Xr({ch1:j,ch2:fe,ch3:Oe,ch4:We,pdfColorType:"fill",precision:2}),Pe(Ga),this};var $s=i.textColor||"0 g",gn=A.__private__.getTextColor=A.getTextColor=function(){return Yi($s)};A.__private__.setTextColor=A.setTextColor=function(j,fe,Oe,We){return $s=Xr({ch1:j,ch2:fe,ch3:Oe,ch4:We,pdfColorType:"text",precision:3}),this};var ks=i.charSpace,La=A.__private__.getCharSpace=A.getCharSpace=function(){return parseFloat(ks||0)};A.__private__.setCharSpace=A.setCharSpace=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ks=j,this};var Ir=0;A.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},A.__private__.setLineCap=A.setLineCap=function(j){var fe=A.CapJoinStyles[j];if(fe===void 0)throw new Error("Line cap style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ir=fe,Pe(fe+" J"),this};var kr=0;A.__private__.setLineJoin=A.setLineJoin=function(j){var fe=A.CapJoinStyles[j];if(fe===void 0)throw new Error("Line join style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return kr=fe,Pe(fe+" j"),this},A.__private__.setLineMiterLimit=A.__private__.setMiterLimit=A.setLineMiterLimit=A.setMiterLimit=function(j){if(j=j||0,isNaN(j))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Pe(ee(le(j))+" M"),this},A.GState=N1,A.setGState=function(j){(j=typeof j=="string"?Mn[Sn[j]]:Hs(null,j)).equals(Qn)||(Pe("/"+j.id+" gs"),Qn=j)};var Hs=function(j,fe){if(!j||!Sn[j]){var Oe=!1;for(var We in Mn)if(Mn.hasOwnProperty(We)&&Mn[We].equals(fe)){Oe=!0;break}if(Oe)fe=Mn[We];else{var tt="GS"+(Object.keys(Mn).length+1).toString(10);Mn[tt]=fe,fe.id=tt}return j&&(Sn[j]=fe.id),Kn.publish("addGState",fe),fe}};A.addGState=function(j,fe){return Hs(j,fe),this},A.saveGraphicsState=function(){return Pe("q"),qn.push({key:cn,size:_t,color:$s}),this},A.restoreGraphicsState=function(){Pe("Q");var j=qn.pop();return cn=j.key,_t=j.size,$s=j.color,Qn=null,this},A.setCurrentTransformationMatrix=function(j){return Pe(j.toString()+" cm"),this},A.comment=function(j){return Pe("#"+j),this};var xr=function(j,fe){var Oe=j||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Oe},set:function(It){isNaN(It)||(Oe=parseFloat(It))}});var We=fe||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return We},set:function(It){isNaN(It)||(We=parseFloat(It))}});var tt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return tt},set:function(It){tt=It.toString()}}),this},Gs=function(j,fe,Oe,We){xr.call(this,j,fe),this.type="rect";var tt=Oe||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return tt},set:function(Mt){isNaN(Mt)||(tt=parseFloat(Mt))}});var It=We||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return It},set:function(Mt){isNaN(Mt)||(It=parseFloat(Mt))}}),this},Ka=function(){this.page=tn,this.currentPage=Ee,this.pages=Ft.slice(0),this.pagesContext=Gt.slice(0),this.x=hn,this.y=nr,this.matrix=Jn,this.width=fs(Ee),this.height=To(Ee),this.outputDestination=qt,this.id="",this.objectNumber=-1};Ka.prototype.restore=function(){tn=this.page,Ee=this.currentPage,Gt=this.pagesContext,Ft=this.pages,hn=this.x,nr=this.y,Jn=this.matrix,ao(Ee,this.width),Ks(Ee,this.height),qt=this.outputDestination};var Gr=function(j,fe,Oe,We,tt){Ri.push(new Ka),tn=Ee=0,Ft=[],hn=j,nr=fe,Jn=tt,va([Oe,We])};for(var Wa in A.beginFormObject=function(j,fe,Oe,We,tt){return Gr(j,fe,Oe,We,tt),this},A.endFormObject=function(j){return(function(fe){if(Pr[fe])Ri.pop().restore();else{var Oe=new Ka,We="Xo"+(Object.keys(vr).length+1).toString(10);Oe.id=We,Pr[fe]=We,vr[We]=Oe,Kn.publish("addFormObject",Oe),Ri.pop().restore()}})(j),this},A.doFormObject=function(j,fe){var Oe=vr[Pr[j]];return Pe("q"),Pe(fe.toString()+" cm"),Pe("/"+Oe.id+" Do"),Pe("Q"),this},A.getFormObject=function(j){var fe=vr[Pr[j]];return{x:fe.x,y:fe.y,width:fe.width,height:fe.height,matrix:fe.matrix}},A.save=function(j,fe){return j=j||"generated.pdf",(fe=fe||{}).returnPromise=fe.returnPromise||!1,fe.returnPromise===!1?(Dd(yi(zs()),j),typeof Dd.unload=="function"&&ai.setTimeout&&setTimeout(Dd.unload,911),this):new Promise(function(Oe,We){try{var tt=Dd(yi(zs()),j);typeof Dd.unload=="function"&&ai.setTimeout&&setTimeout(Dd.unload,911),Oe(tt)}catch(It){We(It.message)}})},Cn.API)Cn.API.hasOwnProperty(Wa)&&(Wa==="events"&&Cn.API.events.length?(function(j,fe){var Oe,We,tt;for(tt=fe.length-1;tt!==-1;tt--)Oe=fe[tt][0],We=fe[tt][1],j.subscribe.apply(j,[Oe].concat(typeof We=="function"?[We]:We))})(Kn,Cn.API.events):A[Wa]=Cn.API[Wa]);function fs(j){return Gt[j].mediaBox.topRightX-Gt[j].mediaBox.bottomLeftX}function ao(j,fe){Gt[j].mediaBox.topRightX=fe+Gt[j].mediaBox.bottomLeftX}function To(j){return Gt[j].mediaBox.topRightY-Gt[j].mediaBox.bottomLeftY}function Ks(j,fe){Gt[j].mediaBox.topRightY=fe+Gt[j].mediaBox.bottomLeftY}var on=A.getPageWidth=function(j){return fs(j=j||Ee)/$n},Di=A.setPageWidth=function(j,fe){ao(j,fe*$n)},Cr=A.getPageHeight=function(j){return To(j=j||Ee)/$n},la=A.setPageHeight=function(j,fe){Ks(j,fe*$n)};return A.internal={pdfEscape:Vs,getStyle:_l,getFont:fn,getFontSize:Jt,getCharSpace:La,getTextColor:gn,getLineHeight:xs,getLineHeightFactor:Us,getLineWidth:vi,write:$t,getHorizontalCoordinate:Er,getVerticalCoordinate:Ai,getCoordinateString:ba,getVerticalCoordinateString:Ci,collections:{},newObject:Oi,newAdditionalObject:cs,newObjectDeferred:ir,newObjectDeferredBegin:cr,getFilters:hs,putStream:ya,events:Kn,scaleFactor:$n,pageSize:{getWidth:function(){return on(Ee)},setWidth:function(j){Di(Ee,j)},getHeight:function(){return Cr(Ee)},setHeight:function(j){la(Ee,j)}},encryptionOptions:x,encryption:dr,getEncryptor:function(j){return x!==null?dr.encryptor(j,0):function(fe){return fe}},output:$a,getNumberOfPages:il,get pages(){return Ft},out:Pe,f2:X,f3:ae,getPageInfo:Mr,getPageInfoByObjId:zo,getCurrentPageInfo:$l,getPDFVersion:$,Point:xr,Rectangle:Gs,Matrix:pn,hasHotfix:ri},Object.defineProperty(A.internal.pageSize,"width",{get:function(){return on(Ee)},set:function(j){Di(Ee,j)},enumerable:!0,configurable:!0}),Object.defineProperty(A.internal.pageSize,"height",{get:function(){return Cr(Ee)},set:function(j){la(Ee,j)},enumerable:!0,configurable:!0}),(function(j){for(var fe=0,Oe=Tn.length;fe<Oe;fe++){var We=vl.call(this,j[fe][0],j[fe][1],j[fe][2],Tn[fe][3],!0);p===!1&&(w[We]=!0);var tt=j[fe][0].split("-");hr({id:We,fontName:tt[0],fontStyle:tt[1]||""})}Kn.publish("addFonts",{fonts:vn,dictionary:On})}).call(A,Tn),cn="F1",Is(r,t),Kn.publish("initialized"),A}Xf.prototype.lsbFirstWord=function(i){return String.fromCharCode(255&i,i>>8&255,i>>16&255,i>>24&255)},Xf.prototype.toHexString=function(i){return i.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Xf.prototype.hexToBytes=function(i){for(var e=[],t=0;t<i.length;t+=2)e.push(String.fromCharCode(parseInt(i.substr(t,2),16)));return e.join("")},Xf.prototype.processOwnerPassword=function(i,e){return Jx(Xx(e).substr(0,5),i)},Xf.prototype.encryptor=function(i,e){var t=Xx(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return Jx(t,n)}},N1.prototype.equals=function(i){var e,t="id,objectNumber,equals";if(!i||zr(i)!==zr(this))return!1;var n=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!i.hasOwnProperty(e)||this[e]!==i[e])return!1;n++}for(e in i)i.hasOwnProperty(e)&&t.indexOf(e)<0&&n--;return n===0},Cn.API={events:[]},Cn.version="3.0.4";var Zs=Cn.API,uS=1,yf=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Uf=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},gi=function(i){return i.toFixed(2)},Dh=function(i){return i.toFixed(5)};Zs.__acroform__={};var yl=function(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i},Pk=function(i){return i*uS},qu=function(i){var e=new Q4,t=bn.internal.getHeight(i)||0,n=bn.internal.getWidth(i)||0;return e.BBox=[0,0,Number(gi(n)),Number(gi(t))],e},AW=Zs.__acroform__.setBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|1<<e},EW=Zs.__acroform__.clearBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&~(1<<e)},IW=Zs.__acroform__.getBit=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<e?1:0},fa=Zs.__acroform__.getBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return IW(i,e-1)},pa=Zs.__acroform__.setBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return AW(i,e-1)},ga=Zs.__acroform__.clearBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return EW(i,e-1)},kW=Zs.__acroform__.calculateCoordinates=function(i,e){var t=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,r=i[0],s=i[1],l=i[2],u=i[3],h={};return h.lowerLeft_X=t(r)||0,h.lowerLeft_Y=n(s+u)||0,h.upperRight_X=t(r+l)||0,h.upperRight_Y=n(s)||0,[Number(gi(h.lowerLeft_X)),Number(gi(h.lowerLeft_Y)),Number(gi(h.upperRight_X)),Number(gi(h.upperRight_Y))]},CW=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var e=[],t=i._V||i.DV,n=Qx(i,t),r=i.scope.internal.getFont(i.fontName,i.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(i.scope.__private__.encodeColorString(i.color)),e.push("/"+r+" "+gi(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var s=qu(i);return s.scope=i.scope,s.stream=e.join(`
`),s}},Qx=function(i,e){var t=i.fontSize===0?i.maxFontSize:i.fontSize,n={text:"",fontSize:""},r=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");r=i.multiline?r.map(function(X){return X.split(`
`)}):r.map(function(X){return[X]});var s=t,l=bn.internal.getHeight(i)||0;l=l<0?-l:l;var u=bn.internal.getWidth(i)||0;u=u<0?-u:u;var h=function(X,ae,le){if(X+1<r.length){var ze=ae+" "+r[X+1][0];return h0(ze,i,le).width<=u-4}return!1};s++;e:for(;s>0;){e="",s--;var f,x,p=h0("3",i,s).height,w=i.multiline?l-s:(l-p)/2,A=w+=2,B=0,$=0,W=0;if(s<=0){e=`(...) Tj
`,e+="% Width of Text: "+h0(e,i,s=12).width+", FieldWidth:"+u+`
`;break}for(var q="",ge=0,he=0;he<r.length;he++)if(r.hasOwnProperty(he)){var me=!1;if(r[he].length!==1&&W!==r[he].length-1){if((p+2)*(ge+2)+2>l)continue e;q+=r[he][W],me=!0,$=he,he--}else{q=(q+=r[he][W]+" ").substr(q.length-1)==" "?q.substr(0,q.length-1):q;var Ce=parseInt(he),Ve=h(Ce,q,s),pe=he>=r.length-1;if(Ve&&!pe){q+=" ",W=0;continue}if(Ve||pe){if(pe)$=Ce;else if(i.multiline&&(p+2)*(ge+2)+2>l)continue e}else{if(!i.multiline||(p+2)*(ge+2)+2>l)continue e;$=Ce}}for(var ee="",J=B;J<=$;J++){var ye=r[J];if(i.multiline){if(J===$){ee+=ye[W]+" ",W=(W+1)%ye.length;continue}if(J===B){ee+=ye[ye.length-1]+" ";continue}}ee+=ye[0]+" "}switch(ee=ee.substr(ee.length-1)==" "?ee.substr(0,ee.length-1):ee,x=h0(ee,i,s).width,i.textAlign){case"right":f=u-x-2;break;case"center":f=(u-x)/2;break;default:f=2}e+=gi(f)+" "+gi(A)+` Td
`,e+="("+yf(ee)+`) Tj
`,e+=-gi(f)+` 0 Td
`,A=-(s+2),x=0,B=me?$:$+1,ge++,q=""}break}return n.text=e,n.fontSize=s,n},h0=function(i,e,t){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),r=e.scope.getStringUnitWidth(i,{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:r}},RW={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},DW=function(i,e){var t={type:"reference",object:i};e.internal.getPageInfo(i.page).pageContext.annotations.find(function(n){return n.type===t.type&&n.object===t.object})===void 0&&e.internal.getPageInfo(i.page).pageContext.annotations.push(t)},LW=function(i,e){if(e.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(Pu.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(RW)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");uS=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new Z4,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in n)if(n.hasOwnProperty(r)){var s=n[r];s.objId=void 0,s.hasAnnotation&&DW(s,t)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(t){(function(n,r){var s=!n;for(var l in n||(r.internal.newObjectDeferredBegin(r.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),r.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||r.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(l)){var u=n[l],h=[],f=u.Rect;if(u.Rect&&(u.Rect=kW(u.Rect,r)),r.internal.newObjectDeferredBegin(u.objId,!0),u.DA=bn.createDefaultAppearanceStream(u),zr(u)==="object"&&typeof u.getKeyValueListForStream=="function"&&(h=u.getKeyValueListForStream()),u.Rect=f,u.hasAppearanceStream&&!u.appearanceStreamContent){var x=CW(u);h.push({key:"AP",value:"<</N "+x+">>"}),r.internal.acroformPlugin.xForms.push(x)}if(u.appearanceStreamContent){var p="";for(var w in u.appearanceStreamContent)if(u.appearanceStreamContent.hasOwnProperty(w)){var A=u.appearanceStreamContent[w];if(p+="/"+w+" ",p+="<<",Object.keys(A).length>=1||Array.isArray(A)){for(var l in A)if(A.hasOwnProperty(l)){var B=A[l];typeof B=="function"&&(B=B.call(r,u)),p+="/"+l+" "+B+" ",r.internal.acroformPlugin.xForms.indexOf(B)>=0||r.internal.acroformPlugin.xForms.push(B)}}else typeof(B=A)=="function"&&(B=B.call(r,u)),p+="/"+l+" "+B,r.internal.acroformPlugin.xForms.indexOf(B)>=0||r.internal.acroformPlugin.xForms.push(B);p+=">>"}h.push({key:"AP",value:`<<
`+p+">>"})}r.internal.putStream({additionalKeyValues:h,objectId:u.objId}),r.internal.out("endobj")}s&&(function($,W){for(var q in $)if($.hasOwnProperty(q)){var ge=q,he=$[q];W.internal.newObjectDeferredBegin(he.objId,!0),zr(he)==="object"&&typeof he.putStream=="function"&&he.putStream(),delete $[ge]}})(r.internal.acroformPlugin.xForms,r)})(t,i)}),i.internal.acroformPlugin.isInitialized=!0}},J4=Zs.__acroform__.arrayToPdfArray=function(i,e,t){var n=function(l){return l};if(Array.isArray(i)){for(var r="[",s=0;s<i.length;s++)switch(s!==0&&(r+=" "),zr(i[s])){case"boolean":case"number":case"object":r+=i[s].toString();break;case"string":i[s].substr(0,1)!=="/"?(e!==void 0&&t&&(n=t.internal.getEncryptor(e)),r+="("+yf(n(i[s].toString()))+")"):r+=i[s].toString()}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Ob=function(i,e,t){var n=function(r){return r};return e!==void 0&&t&&(n=t.internal.getEncryptor(e)),(i=i||"").toString(),"("+yf(n(i))+")"},Zu=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Zu.prototype.toString=function(){return this.objId+" 0 R"},Zu.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},Zu.prototype.getKeyValueListForStream=function(){var i=[],e=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var n=e[t],r=this[n];r&&(Array.isArray(r)?i.push({key:n,value:J4(r,this.objId,this.scope)}):r instanceof Zu?(r.scope=this.scope,i.push({key:n,value:r.objId+" 0 R"})):typeof r!="function"&&i.push({key:n,value:r}))}return i};var Q4=function(){Zu.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){i=t.trim()},get:function(){return i||null}})};yl(Q4,Zu);var Z4=function(){Zu.call(this);var i,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var t=function(n){return n};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+yf(t(i))+")"}},set:function(t){i=t}})};yl(Z4,Zu);var Pu=function i(){Zu.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(q){if(isNaN(q))throw new Error('Invalid value "'+q+'" for attribute F supplied.');e=q}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!fa(e,3)},set:function(q){q?this.F=pa(e,3):this.F=ga(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(q){if(isNaN(q))throw new Error('Invalid value "'+q+'" for attribute Ff supplied.');t=q}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(q){n=q!==void 0?q:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(q){n[0]=q}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(q){n[1]=q}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(q){n[2]=q}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(q){n[3]=q}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(q){switch(q){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=q;break;default:throw new Error('Invalid value "'+q+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof P1)return;s="FieldObject"+i.FieldNum++}var q=function(ge){return ge};return this.scope&&(q=this.scope.internal.getEncryptor(this.objId)),"("+yf(q(s))+")"},set:function(q){s=q.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(q){s=q}});var l="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return l},set:function(q){l=q}});var u="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return u},set:function(q){u=q}});var h=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return h},set:function(q){h=q}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/uS:f},set:function(q){f=q}});var x="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return x},set:function(q){x=q}});var p="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!p||this instanceof P1||this instanceof Wd))return Ob(p,this.objId,this.scope)},set:function(q){q=q.toString(),p=q}});var w=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(w)return this instanceof io==0?Ob(w,this.objId,this.scope):w},set:function(q){q=q.toString(),w=this instanceof io==0?q.substr(0,1)==="("?Uf(q.substr(1,q.length-2)):Uf(q):q}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof io==1?Uf(w.substr(1,w.length-1)):w},set:function(q){q=q.toString(),w=this instanceof io==1?"/"+q:q}});var A=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(A)return A},set:function(q){this.V=q}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(A)return this instanceof io==0?Ob(A,this.objId,this.scope):A},set:function(q){q=q.toString(),A=this instanceof io==0?q.substr(0,1)==="("?Uf(q.substr(1,q.length-2)):Uf(q):q}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof io==1?Uf(A.substr(1,A.length-1)):A},set:function(q){q=q.toString(),A=this instanceof io==1?"/"+q:q}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var B,$=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return $},set:function(q){q=!!q,$=q}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(B)return B},set:function(q){B=q}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,1)},set:function(q){q?this.Ff=pa(this.Ff,1):this.Ff=ga(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,2)},set:function(q){q?this.Ff=pa(this.Ff,2):this.Ff=ga(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,3)},set:function(q){q?this.Ff=pa(this.Ff,3):this.Ff=ga(this.Ff,3)}});var W=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(W!==null)return W},set:function(q){if([0,1,2].indexOf(q)===-1)throw new Error('Invalid value "'+q+'" for attribute Q supplied.');W=q}}),Object.defineProperty(this,"textAlign",{get:function(){var q;switch(W){case 0:default:q="left";break;case 1:q="center";break;case 2:q="right"}return q},configurable:!0,enumerable:!0,set:function(q){switch(q){case"right":case 2:W=2;break;case"center":case 1:W=1;break;default:W=0}}})};yl(Pu,Zu);var cp=function(){Pu.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){i=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return J4(e,this.objId,this.scope)},set:function(t){var n,r;r=[],typeof(n=t)=="string"&&(r=(function(s,l,u){u||(u=1);for(var h,f=[];h=l.exec(s);)f.push(h[u]);return f})(n,/\((.*?)\)/g)),e=r}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,18)},set:function(t){t?this.Ff=pa(this.Ff,18):this.Ff=ga(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=pa(this.Ff,19):this.Ff=ga(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,20)},set:function(t){t?(this.Ff=pa(this.Ff,20),e.sort()):this.Ff=ga(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,22)},set:function(t){t?this.Ff=pa(this.Ff,22):this.Ff=ga(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,23)},set:function(t){t?this.Ff=pa(this.Ff,23):this.Ff=ga(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,27)},set:function(t){t?this.Ff=pa(this.Ff,27):this.Ff=ga(this.Ff,27)}}),this.hasAppearanceStream=!1};yl(cp,Pu);var hp=function(){cp.call(this),this.fontName="helvetica",this.combo=!1};yl(hp,cp);var dp=function(){hp.call(this),this.combo=!0};yl(dp,hp);var F0=function(){dp.call(this),this.edit=!0};yl(F0,dp);var io=function(){Pu.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,15)},set:function(t){t?this.Ff=pa(this.Ff,15):this.Ff=ga(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,16)},set:function(t){t?this.Ff=pa(this.Ff,16):this.Ff=ga(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,17)},set:function(t){t?this.Ff=pa(this.Ff,17):this.Ff=ga(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,26)},set:function(t){t?this.Ff=pa(this.Ff,26):this.Ff=ga(this.Ff,26)}});var i,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(s){return s};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,r=[];for(n in r.push("<<"),e)r.push("/"+n+" ("+yf(t(e[n]))+")");return r.push(">>"),r.join(`
`)}},set:function(t){zr(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(t){i="/"+t}})};yl(io,Pu);var j0=function(){io.call(this),this.pushButton=!0};yl(j0,io);var fp=function(){io.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e!==void 0?e:[]}})};yl(fp,io);var P1=function(){var i,e;Pu.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(r){i=r}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(r){e=r}});var t,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(u){return u};this.scope&&(r=this.scope.internal.getEncryptor(this.objId));var s,l=[];for(s in l.push("<<"),n)l.push("/"+s+" ("+yf(r(n[s]))+")");return l.push(">>"),l.join(`
`)},set:function(r){zr(r)==="object"&&(n=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(r){typeof r=="string"&&(n.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(r){t="/"+r}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=bn.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};yl(P1,Pu),fp.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=i.createAppearanceStream(t.optionName),t.caption=i.getCA()}},fp.prototype.createOption=function(i){var e=new P1;return e.Parent=this,e.optionName=i,this.Kids.push(e),NW.call(this.scope,e),e};var V0=function(){io.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=bn.CheckBox.createAppearanceStream()};yl(V0,io);var Wd=function(){Pu.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,13)},set:function(e){e?this.Ff=pa(this.Ff,13):this.Ff=ga(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,21)},set:function(e){e?this.Ff=pa(this.Ff,21):this.Ff=ga(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,23)},set:function(e){e?this.Ff=pa(this.Ff,23):this.Ff=ga(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,24)},set:function(e){e?this.Ff=pa(this.Ff,24):this.Ff=ga(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,25)},set:function(e){e?this.Ff=pa(this.Ff,25):this.Ff=ga(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,26)},set:function(e){e?this.Ff=pa(this.Ff,26):this.Ff=ga(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){Number.isInteger(e)&&(i=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};yl(Wd,Pu);var z0=function(){Wd.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!fa(this.Ff,14)},set:function(i){i?this.Ff=pa(this.Ff,14):this.Ff=ga(this.Ff,14)}}),this.password=!0};yl(z0,Wd);var bn={CheckBox:{createAppearanceStream:function(){return{N:{On:bn.CheckBox.YesNormal},D:{On:bn.CheckBox.YesPushDown,Off:bn.CheckBox.OffPushDown}}},YesPushDown:function(i){var e=qu(i);e.scope=i.scope;var t=[],n=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),s=Qx(i,i.caption);return t.push("0.749023 g"),t.push("0 0 "+gi(bn.internal.getWidth(i))+" "+gi(bn.internal.getHeight(i))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+n+" "+gi(s.fontSize)+" Tf "+r),t.push("BT"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(i){var e=qu(i);e.scope=i.scope;var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,n=i.scope.__private__.encodeColorString(i.color),r=[],s=bn.internal.getHeight(i),l=bn.internal.getWidth(i),u=Qx(i,i.caption);return r.push("1 g"),r.push("0 0 "+gi(l)+" "+gi(s)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+gi(l-1)+" "+gi(s-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+t+" "+gi(u.fontSize)+" Tf "+n),r.push(u.text),r.push("ET"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(i){var e=qu(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+gi(bn.internal.getWidth(i))+" "+gi(bn.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(i){var e={D:{Off:bn.RadioButton.Circle.OffPushDown},N:{}};return e.N[i]=bn.RadioButton.Circle.YesNormal,e.D[i]=bn.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(i){var e=qu(i);e.scope=i.scope;var t=[],n=bn.internal.getWidth(i)<=bn.internal.getHeight(i)?bn.internal.getWidth(i)/4:bn.internal.getHeight(i)/4;n=Number((.9*n).toFixed(5));var r=bn.internal.Bezier_C,s=Number((n*r).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Dh(bn.internal.getWidth(i)/2)+" "+Dh(bn.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),t.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),t.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),t.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=qu(i);e.scope=i.scope;var t=[],n=bn.internal.getWidth(i)<=bn.internal.getHeight(i)?bn.internal.getWidth(i)/4:bn.internal.getHeight(i)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),s=Number((r*bn.internal.Bezier_C).toFixed(5)),l=Number((n*bn.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Dh(bn.internal.getWidth(i)/2)+" "+Dh(bn.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),t.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),t.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),t.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Dh(bn.internal.getWidth(i)/2)+" "+Dh(bn.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+l+" "+l+" "+n+" 0 "+n+" c"),t.push("-"+l+" "+n+" -"+n+" "+l+" -"+n+" 0 c"),t.push("-"+n+" -"+l+" -"+l+" -"+n+" 0 -"+n+" c"),t.push(l+" -"+n+" "+n+" -"+l+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(i){var e=qu(i);e.scope=i.scope;var t=[],n=bn.internal.getWidth(i)<=bn.internal.getHeight(i)?bn.internal.getWidth(i)/4:bn.internal.getHeight(i)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),s=Number((r*bn.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Dh(bn.internal.getWidth(i)/2)+" "+Dh(bn.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),t.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),t.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),t.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(i){var e={D:{Off:bn.RadioButton.Cross.OffPushDown},N:{}};return e.N[i]=bn.RadioButton.Cross.YesNormal,e.D[i]=bn.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(i){var e=qu(i);e.scope=i.scope;var t=[],n=bn.internal.calculateCross(i);return t.push("q"),t.push("1 1 "+gi(bn.internal.getWidth(i)-2)+" "+gi(bn.internal.getHeight(i)-2)+" re"),t.push("W"),t.push("n"),t.push(gi(n.x1.x)+" "+gi(n.x1.y)+" m"),t.push(gi(n.x2.x)+" "+gi(n.x2.y)+" l"),t.push(gi(n.x4.x)+" "+gi(n.x4.y)+" m"),t.push(gi(n.x3.x)+" "+gi(n.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=qu(i);e.scope=i.scope;var t=bn.internal.calculateCross(i),n=[];return n.push("0.749023 g"),n.push("0 0 "+gi(bn.internal.getWidth(i))+" "+gi(bn.internal.getHeight(i))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+gi(bn.internal.getWidth(i)-2)+" "+gi(bn.internal.getHeight(i)-2)+" re"),n.push("W"),n.push("n"),n.push(gi(t.x1.x)+" "+gi(t.x1.y)+" m"),n.push(gi(t.x2.x)+" "+gi(t.x2.y)+" l"),n.push(gi(t.x4.x)+" "+gi(t.x4.y)+" m"),n.push(gi(t.x3.x)+" "+gi(t.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(i){var e=qu(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+gi(bn.internal.getWidth(i))+" "+gi(bn.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(i){var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,t=i.scope.__private__.encodeColorString(i.color);return"/"+e+" "+i.fontSize+" Tf "+t}};bn.internal={Bezier_C:.551915024494,calculateCross:function(i){var e=bn.internal.getWidth(i),t=bn.internal.getHeight(i),n=Math.min(e,t);return{x1:{x:(e-n)/2,y:(t-n)/2+n},x2:{x:(e-n)/2+n,y:(t-n)/2},x3:{x:(e-n)/2,y:(t-n)/2},x4:{x:(e-n)/2+n,y:(t-n)/2+n}}}},bn.internal.getWidth=function(i){var e=0;return zr(i)==="object"&&(e=Pk(i.Rect[2])),e},bn.internal.getHeight=function(i){var e=0;return zr(i)==="object"&&(e=Pk(i.Rect[3])),e};var NW=Zs.addField=function(i){if(LW(this,i),!(i instanceof Pu))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=i).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Zs.AcroFormChoiceField=cp,Zs.AcroFormListBox=hp,Zs.AcroFormComboBox=dp,Zs.AcroFormEditBox=F0,Zs.AcroFormButton=io,Zs.AcroFormPushButton=j0,Zs.AcroFormRadioButton=fp,Zs.AcroFormCheckBox=V0,Zs.AcroFormTextField=Wd,Zs.AcroFormPasswordField=z0,Zs.AcroFormAppearance=bn,Zs.AcroForm={ChoiceField:cp,ListBox:hp,ComboBox:dp,EditBox:F0,Button:io,PushButton:j0,RadioButton:fp,CheckBox:V0,TextField:Wd,PasswordField:z0,Appearance:bn},Cn.AcroForm={ChoiceField:cp,ListBox:hp,ComboBox:dp,EditBox:F0,Button:io,PushButton:j0,RadioButton:fp,CheckBox:V0,TextField:Wd,PasswordField:z0,Appearance:bn};Cn.AcroForm;function eN(i){return i.reduce(function(e,t,n){return e[t]=n,e},{})}(function(i){var e="addImage_";i.__addimage__={};var t="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(X,ae){var le,ze,nt,je,Je,qe=t;if((ae=ae||t)==="RGBA"||X.data!==void 0&&X.data instanceof Uint8ClampedArray&&"height"in X&&"width"in X)return"RGBA";if(Ve(X))for(Je in n)for(nt=n[Je],le=0;le<nt.length;le+=1){for(je=!0,ze=0;ze<nt[le].length;ze+=1)if(nt[le][ze]!==void 0&&nt[le][ze]!==X[ze]){je=!1;break}if(je===!0){qe=Je;break}}else for(Je in n)for(nt=n[Je],le=0;le<nt.length;le+=1){for(je=!0,ze=0;ze<nt[le].length;ze+=1)if(nt[le][ze]!==void 0&&nt[le][ze]!==X.charCodeAt(ze)){je=!1;break}if(je===!0){qe=Je;break}}return qe===t&&ae!==t&&(qe=ae),qe},s=function X(ae){for(var le=this.internal.write,ze=this.internal.putStream,nt=(0,this.internal.getFilters)();nt.indexOf("FlateEncode")!==-1;)nt.splice(nt.indexOf("FlateEncode"),1);ae.objectId=this.internal.newObject();var je=[];if(je.push({key:"Type",value:"/XObject"}),je.push({key:"Subtype",value:"/Image"}),je.push({key:"Width",value:ae.width}),je.push({key:"Height",value:ae.height}),ae.colorSpace===q.INDEXED?je.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ae.palette.length/3-1)+" "+("sMask"in ae&&ae.sMask!==void 0?ae.objectId+2:ae.objectId+1)+" 0 R]"}):(je.push({key:"ColorSpace",value:"/"+ae.colorSpace}),ae.colorSpace===q.DEVICE_CMYK&&je.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),je.push({key:"BitsPerComponent",value:ae.bitsPerComponent}),"decodeParameters"in ae&&ae.decodeParameters!==void 0&&je.push({key:"DecodeParms",value:"<<"+ae.decodeParameters+">>"}),"transparency"in ae&&Array.isArray(ae.transparency)&&ae.transparency.length>0){for(var Je="",qe=0,lt=ae.transparency.length;qe<lt;qe++)Je+=ae.transparency[qe]+" "+ae.transparency[qe]+" ";je.push({key:"Mask",value:"["+Je+"]"})}ae.sMask!==void 0&&je.push({key:"SMask",value:ae.objectId+1+" 0 R"});var Tt=ae.filter!==void 0?["/"+ae.filter]:void 0;if(ze({data:ae.data,additionalKeyValues:je,alreadyAppliedFilters:Tt,objectId:ae.objectId}),le("endobj"),"sMask"in ae&&ae.sMask!==void 0){var Ne,se=(Ne=ae.sMaskBitsPerComponent)!==null&&Ne!==void 0?Ne:ae.bitsPerComponent,Ee={width:ae.width,height:ae.height,colorSpace:"DeviceGray",bitsPerComponent:se,data:ae.sMask};"filter"in ae&&(Ee.decodeParameters="/Predictor ".concat(ae.predictor," /Colors 1 /BitsPerComponent ").concat(se," /Columns ").concat(ae.width),Ee.filter=ae.filter),X.call(this,Ee)}if(ae.colorSpace===q.INDEXED){var Le=this.internal.newObject();ze({data:ee(new Uint8Array(ae.palette)),objectId:Le}),le("endobj")}},l=function(){var X=this.internal.collections[e+"images"];for(var ae in X)s.call(this,X[ae])},u=function(){var X,ae=this.internal.collections[e+"images"],le=this.internal.write;for(var ze in ae)le("/I"+(X=ae[ze]).index,X.objectId,"0","R")},h=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",l),this.internal.events.subscribe("putXobjectDict",u))},f=function(){var X=this.internal.collections[e+"images"];return h.call(this),X},x=function(){return Object.keys(this.internal.collections[e+"images"]).length},p=function(X){return typeof i["process"+X.toUpperCase()]=="function"},w=function(X){return zr(X)==="object"&&X.nodeType===1},A=function(X,ae){if(X.nodeName==="IMG"&&X.hasAttribute("src")){var le=""+X.getAttribute("src");if(le.indexOf("data:image/")===0)return M0(unescape(le).split("base64,").pop());var ze=i.loadFile(le,!0);if(ze!==void 0)return ze}if(X.nodeName==="CANVAS"){if(X.width===0||X.height===0)throw new Error("Given canvas must have data. Canvas width: "+X.width+", height: "+X.height);var nt;switch(ae){case"PNG":nt="image/png";break;case"WEBP":nt="image/webp";break;default:nt="image/jpeg"}return M0(X.toDataURL(nt,1).split("base64,").pop())}},B=function(X){var ae=this.internal.collections[e+"images"];if(ae){for(var le in ae)if(X===ae[le].alias)return ae[le]}},$=function(X,ae,le){return X||ae||(X=-96,ae=-96),X<0&&(X=-1*le.width*72/X/this.internal.scaleFactor),ae<0&&(ae=-1*le.height*72/ae/this.internal.scaleFactor),X===0&&(X=ae*le.width/le.height),ae===0&&(ae=X*le.height/le.width),[X,ae]},W=function(X,ae,le,ze,nt,je){var Je=$.call(this,le,ze,nt),qe=this.internal.getCoordinateString,lt=this.internal.getVerticalCoordinateString,Tt=f.call(this);if(le=Je[0],ze=Je[1],Tt[nt.index]=nt,je){je*=Math.PI/180;var Ne=Math.cos(je),se=Math.sin(je),Ee=function(Be){return Be.toFixed(4)},Le=[Ee(Ne),Ee(se),Ee(-1*se),Ee(Ne),0,0,"cm"]}this.internal.write("q"),je?(this.internal.write([1,"0","0",1,qe(X),lt(ae+ze),"cm"].join(" ")),this.internal.write(Le.join(" ")),this.internal.write([qe(le),"0","0",qe(ze),"0","0","cm"].join(" "))):this.internal.write([qe(le),"0","0",qe(ze),qe(X),lt(ae+ze),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+nt.index+" Do"),this.internal.write("Q")},q=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ge=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},he=i.__addimage__.sHashCode=function(X){var ae,le,ze=0;if(typeof X=="string")for(le=X.length,ae=0;ae<le;ae++)ze=(ze<<5)-ze+X.charCodeAt(ae),ze|=0;else if(Ve(X))for(le=X.byteLength/2,ae=0;ae<le;ae++)ze=(ze<<5)-ze+X[ae],ze|=0;return ze},me=i.__addimage__.validateStringAsBase64=function(X){(X=X||"").toString().trim();var ae=!0;return X.length===0&&(ae=!1),X.length%4!=0&&(ae=!1),/^[A-Za-z0-9+/]+$/.test(X.substr(0,X.length-2))===!1&&(ae=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(X.substr(-2))===!1&&(ae=!1),ae},Ce=i.__addimage__.extractImageFromDataUrl=function(X){if(X==null||!(X=X.trim()).startsWith("data:"))return null;var ae=X.indexOf(",");return ae<0?null:X.substring(0,ae).trim().endsWith("base64")?X.substring(ae+1):null};i.__addimage__.isArrayBuffer=function(X){return X instanceof ArrayBuffer};var Ve=i.__addimage__.isArrayBufferView=function(X){return X instanceof Int8Array||X instanceof Uint8Array||X instanceof Uint8ClampedArray||X instanceof Int16Array||X instanceof Uint16Array||X instanceof Int32Array||X instanceof Uint32Array||X instanceof Float32Array||X instanceof Float64Array},pe=i.__addimage__.binaryStringToUint8Array=function(X){for(var ae=X.length,le=new Uint8Array(ae),ze=0;ze<ae;ze++)le[ze]=X.charCodeAt(ze);return le},ee=i.__addimage__.arrayBufferToBinaryString=function(X){for(var ae="",le=Ve(X)?X:new Uint8Array(X),ze=0;ze<le.length;ze+=8192)ae+=String.fromCharCode.apply(null,le.subarray(ze,ze+8192));return ae};i.addImage=function(){var X,ae,le,ze,nt,je,Je,qe,lt;if(typeof arguments[1]=="number"?(ae=t,le=arguments[1],ze=arguments[2],nt=arguments[3],je=arguments[4],Je=arguments[5],qe=arguments[6],lt=arguments[7]):(ae=arguments[1],le=arguments[2],ze=arguments[3],nt=arguments[4],je=arguments[5],Je=arguments[6],qe=arguments[7],lt=arguments[8]),zr(X=arguments[0])==="object"&&!w(X)&&"imageData"in X){var Tt=X;X=Tt.imageData,ae=Tt.format||ae||t,le=Tt.x||le||0,ze=Tt.y||ze||0,nt=Tt.w||Tt.width||nt,je=Tt.h||Tt.height||je,Je=Tt.alias||Je,qe=Tt.compression||qe,lt=Tt.rotation||Tt.angle||lt}var Ne=this.internal.getFilters();if(qe===void 0&&Ne.indexOf("FlateEncode")!==-1&&(qe="SLOW"),isNaN(le)||isNaN(ze))throw new Error("Invalid coordinates passed to jsPDF.addImage");h.call(this);var se=J.call(this,X,ae,Je,qe);return W.call(this,le,ze,nt,je,se,lt),this};var J=function(X,ae,le,ze){var nt,je,Je;if(typeof X=="string"&&r(X)===t){X=unescape(X);var qe=ye(X,!1);(qe!==""||(qe=i.loadFile(X,!0))!==void 0)&&(X=qe)}if(w(X)&&(X=A(X,ae)),ae=r(X,ae),!p(ae))throw new Error("addImage does not support files of type '"+ae+"', please ensure that a plugin for '"+ae+"' support is added.");if(((Je=le)==null||Je.length===0)&&(le=(function(lt){return typeof lt=="string"||Ve(lt)?he(lt):Ve(lt.data)?he(lt.data):null})(X)),(nt=B.call(this,le))||(X instanceof Uint8Array||ae==="RGBA"||(je=X,X=pe(X)),nt=this["process"+ae.toUpperCase()](X,x.call(this),le,(function(lt){return lt&&typeof lt=="string"&&(lt=lt.toUpperCase()),lt in i.image_compression?lt:ge.NONE})(ze),je)),!nt)throw new Error("An unknown error occurred whilst processing the image.");return nt},ye=i.__addimage__.convertBase64ToBinaryString=function(X,ae){ae=typeof ae!="boolean"||ae;var le,ze="";if(typeof X=="string"){var nt;le=(nt=Ce(X))!==null&&nt!==void 0?nt:X;try{ze=M0(le)}catch(je){if(ae)throw me(le)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+je.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return ze};i.getImageProperties=function(X){var ae,le,ze="";if(w(X)&&(X=A(X)),typeof X=="string"&&r(X)===t&&((ze=ye(X,!1))===""&&(ze=i.loadFile(X)||""),X=ze),le=r(X),!p(le))throw new Error("addImage does not support files of type '"+le+"', please ensure that a plugin for '"+le+"' support is added.");if(X instanceof Uint8Array||(X=pe(X)),!(ae=this["process"+le.toUpperCase()](X)))throw new Error("An unknown error occurred whilst processing the image");return ae.fileType=le,ae}})(Cn.API),(function(i){var e=function(t){if(t!==void 0&&t!="")return!0};Cn.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(t){for(var n,r,s,l=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString,h=this.internal.getPageInfoByObjId(t.objId),f=t.pageContext.annotations,x=!1,p=0;p<f.length&&!x;p++)switch((n=f[p]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(x=!0);break;case"reference":case"text":case"freetext":x=!0}if(x!=0){this.internal.write("/Annots [");for(var w=0;w<f.length;w++){n=f[w];var A=this.internal.pdfEscape,B=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var $=this.internal.newAdditionalObject(),W=this.internal.newAdditionalObject(),q=this.internal.getEncryptor($.objId),ge=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(r="/Rect ["+l(n.bounds.x)+" "+u(n.bounds.y+n.bounds.h)+" "+l(n.bounds.x+n.bounds.w)+" "+u(n.bounds.y)+"] ")+"/Contents ("+A(q(n.contents))+")",s+=" /Popup "+W.objId+" 0 R",s+=" /P "+h.objId+" 0 R",s+=" /T ("+A(q(ge))+") >>",$.content=s;var he=$.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+l(n.bounds.x+30)+" "+u(n.bounds.y+n.bounds.h)+" "+l(n.bounds.x+n.bounds.w+30)+" "+u(n.bounds.y)+"] ")+" /Parent "+he,n.open&&(s+=" /Open true"),s+=" >>",W.content=s,this.internal.write($.objId,"0 R",W.objId,"0 R");break;case"freetext":r="/Rect ["+l(n.bounds.x)+" "+u(n.bounds.y)+" "+l(n.bounds.x+n.bounds.w)+" "+u(n.bounds.y+n.bounds.h)+"] ";var me=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+A(B(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+me+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var Ce=this.annotations._nameMap[n.options.name];n.options.pageNumber=Ce.page,n.options.top=Ce.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+A(B(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;default:var Ve=u(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+Ve+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),i.createAnnotation=function(t){var n=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":n.pageContext.annotations.push(t)}},i.link=function(t,n,r,s,l){var u=this.internal.getCurrentPageInfo(),h=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;u.pageContext.annotations.push({finalBounds:{x:h(t),y:f(n),w:h(t+r),h:f(n+s)},options:l,type:"link"})},i.textWithLink=function(t,n,r,s){var l,u,h=this.getTextWidth(t),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){u=s.maxWidth;var x=this.splitTextToSize(t,u).length;l=Math.ceil(f*x)}else u=h,l=f;return this.text(t,n,r,s),r+=.2*f,s.align==="center"&&(n-=h/2),s.align==="right"&&(n-=h),this.link(n,r-f,u,l,s),h},i.getTextWidth=function(t){var n=this.internal.getFontSize();return this.getStringUnitWidth(t)*n/this.internal.scaleFactor}})(Cn.API),(function(i){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];i.__arabicParser__={};var s=i.__arabicParser__.isInArabicSubstitutionA=function($){return e[$.charCodeAt(0)]!==void 0},l=i.__arabicParser__.isArabicLetter=function($){return typeof $=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test($)},u=i.__arabicParser__.isArabicEndLetter=function($){return l($)&&s($)&&e[$.charCodeAt(0)].length<=2},h=i.__arabicParser__.isArabicAlfLetter=function($){return l($)&&r.indexOf($.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function($){return l($)&&s($)&&e[$.charCodeAt(0)].length>=1};var f=i.__arabicParser__.arabicLetterHasFinalForm=function($){return l($)&&s($)&&e[$.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function($){return l($)&&s($)&&e[$.charCodeAt(0)].length>=3};var x=i.__arabicParser__.arabicLetterHasMedialForm=function($){return l($)&&s($)&&e[$.charCodeAt(0)].length==4},p=i.__arabicParser__.resolveLigatures=function($){var W=0,q=t,ge="",he=0;for(W=0;W<$.length;W+=1)q[$.charCodeAt(W)]!==void 0?(he++,typeof(q=q[$.charCodeAt(W)])=="number"&&(ge+=String.fromCharCode(q),q=t,he=0),W===$.length-1&&(q=t,ge+=$.charAt(W-(he-1)),W-=he-1,he=0)):(q=t,ge+=$.charAt(W-he),W-=he,he=0);return ge};i.__arabicParser__.isArabicDiacritic=function($){return $!==void 0&&n[$.charCodeAt(0)]!==void 0};var w=i.__arabicParser__.getCorrectForm=function($,W,q){return l($)?s($)===!1?-1:!f($)||!l(W)&&!l(q)||!l(q)&&u(W)||u($)&&!l(W)||u($)&&h(W)||u($)&&u(W)?0:x($)&&l(W)&&!u(W)&&l(q)&&f(q)?3:u($)||!l(q)?1:2:-1},A=function($){var W=0,q=0,ge=0,he="",me="",Ce="",Ve=($=$||"").split("\\s+"),pe=[];for(W=0;W<Ve.length;W+=1){for(pe.push(""),q=0;q<Ve[W].length;q+=1)he=Ve[W][q],me=Ve[W][q-1],Ce=Ve[W][q+1],l(he)?(ge=w(he,me,Ce),pe[W]+=ge!==-1?String.fromCharCode(e[he.charCodeAt(0)][ge]):he):pe[W]+=he;pe[W]=p(pe[W])}return pe.join(" ")},B=i.__arabicParser__.processArabic=i.processArabic=function(){var $,W=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,q=[];if(Array.isArray(W)){var ge=0;for(q=[],ge=0;ge<W.length;ge+=1)Array.isArray(W[ge])?q.push([A(W[ge][0]),W[ge][1],W[ge][2]]):q.push([A(W[ge])]);$=q}else $=A(W);return typeof arguments[0]=="string"?$:(arguments[0].text=$,arguments[0])};i.events.push(["preProcessText",B])})(Cn.API),Cn.API.autoPrint=function(i){var e;return(i=i||{}).variant=i.variant||"non-conform",i.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(i){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(u){t=u}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(u){n=isNaN(u)||Number.isInteger(u)===!1||u<0?150:u,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(u){r=isNaN(u)||Number.isInteger(u)===!1||u<0?300:u,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(u){s=u}});var l={};Object.defineProperty(this,"style",{get:function(){return l},set:function(u){l=u}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,n){var r;if((t=t||"2d")!=="2d")return null;for(r in n)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=n[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(Cn.API),(function(i){var e={left:0,top:0,bottom:0,right:0},t=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var h=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return h},set:function($){h=$}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function($){f=$}});var x=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return x},set:function($){x=$}});var p=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return p},set:function($){p=$}});var w=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return w},set:function($){w=$}});var A=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return A},set:function($){A=$}});var B=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return B},set:function($){B=$}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(h){return n.call(this),this.internal.__cell__.headerFunction=typeof h=="function"?h:void 0,this},i.getTextDimensions=function(h,f){n.call(this);var x=(f=f||{}).fontSize||this.getFontSize(),p=f.font||this.getFont(),w=f.scaleFactor||this.internal.scaleFactor,A=0,B=0,$=0,W=this;if(!Array.isArray(h)&&typeof h!="string"){if(typeof h!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");h=String(h)}var q=f.maxWidth;q>0?typeof h=="string"?h=this.splitTextToSize(h,q):Object.prototype.toString.call(h)==="[object Array]"&&(h=h.reduce(function(he,me){return he.concat(W.splitTextToSize(me,q))},[])):h=Array.isArray(h)?h:[h];for(var ge=0;ge<h.length;ge++)A<($=this.getStringUnitWidth(h[ge],{font:p})*x)&&(A=$);return A!==0&&(B=h.length),{w:A/=w,h:Math.max((B*x*this.getLineHeightFactor()-x*(this.getLineHeightFactor()-1))/w,0)}},i.cellAddPage=function(){n.call(this),this.addPage();var h=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(h.left,h.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var l=i.cell=function(){var h;h=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),n.call(this);var f=this.internal.__cell__.lastCell,x=this.internal.__cell__.padding,p=this.internal.__cell__.margins||e,w=this.internal.__cell__.tableHeaderRow,A=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===h.lineNumber?(h.x=(f.x||0)+(f.width||0),h.y=f.y||0):f.y+f.height+h.height+p.bottom>this.getPageHeight()?(this.cellAddPage(),h.y=p.top,A&&w&&(this.printHeaderRow(h.lineNumber,!0),h.y+=w[0].height)):h.y=f.y+f.height||h.y),h.text[0]!==void 0&&(this.rect(h.x,h.y,h.width,h.height,t===!0?"FD":void 0),h.align==="right"?this.text(h.text,h.x+h.width-x,h.y+x,{align:"right",baseline:"top"}):h.align==="center"?this.text(h.text,h.x+h.width/2,h.y+x,{align:"center",baseline:"top",maxWidth:h.width-x-x}):this.text(h.text,h.x+x,h.y+x,{align:"left",baseline:"top",maxWidth:h.width-x-x})),this.internal.__cell__.lastCell=h,this};i.table=function(h,f,x,p,w){if(n.call(this),!x)throw new Error("No data for PDF table.");var A,B,$,W,q=[],ge=[],he=[],me={},Ce={},Ve=[],pe=[],ee=(w=w||{}).autoSize||!1,J=w.printHeaders!==!1,ye=w.css&&w.css["font-size"]!==void 0?16*w.css["font-size"]:w.fontSize||12,X=w.margins||Object.assign({width:this.getPageWidth()},e),ae=typeof w.padding=="number"?w.padding:3,le=w.headerBackgroundColor||"#c8c8c8",ze=w.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=J,this.internal.__cell__.margins=X,this.internal.__cell__.table_font_size=ye,this.internal.__cell__.padding=ae,this.internal.__cell__.headerBackgroundColor=le,this.internal.__cell__.headerTextColor=ze,this.setFontSize(ye),p==null)ge=q=Object.keys(x[0]),he=q.map(function(){return"left"});else if(Array.isArray(p)&&zr(p[0])==="object")for(q=p.map(function(Tt){return Tt.name}),ge=p.map(function(Tt){return Tt.prompt||Tt.name||""}),he=p.map(function(Tt){return Tt.align||"left"}),A=0;A<p.length;A+=1)Ce[p[A].name]=.7499990551181103*p[A].width;else Array.isArray(p)&&typeof p[0]=="string"&&(ge=q=p,he=q.map(function(){return"left"}));if(ee||Array.isArray(p)&&typeof p[0]=="string")for(A=0;A<q.length;A+=1){for(me[W=q[A]]=x.map(function(Tt){return Tt[W]}),this.setFont(void 0,"bold"),Ve.push(this.getTextDimensions(ge[A],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),B=me[W],this.setFont(void 0,"normal"),$=0;$<B.length;$+=1)Ve.push(this.getTextDimensions(B[$],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Ce[W]=Math.max.apply(null,Ve)+ae+ae,Ve=[]}if(J){var nt={};for(A=0;A<q.length;A+=1)nt[q[A]]={},nt[q[A]].text=ge[A],nt[q[A]].align=he[A];var je=u.call(this,nt,Ce);pe=q.map(function(Tt){return new s(h,f,Ce[Tt],je,nt[Tt].text,void 0,nt[Tt].align)}),this.setTableHeaderRow(pe),this.printHeaderRow(1,!1)}var Je=p.reduce(function(Tt,Ne){return Tt[Ne.name]=Ne.align,Tt},{});for(A=0;A<x.length;A+=1){"rowStart"in w&&w.rowStart instanceof Function&&w.rowStart({row:A,data:x[A]},this);var qe=u.call(this,x[A],Ce);for($=0;$<q.length;$+=1){var lt=x[A][q[$]];"cellStart"in w&&w.cellStart instanceof Function&&w.cellStart({row:A,col:$,data:lt},this),l.call(this,new s(h,f,Ce[q[$]],qe,lt,A+2,Je[q[$]]))}}return this.internal.__cell__.table_x=h,this.internal.__cell__.table_y=f,this};var u=function(h,f){var x=this.internal.__cell__.padding,p=this.internal.__cell__.table_font_size,w=this.internal.scaleFactor;return Object.keys(h).map(function(A){var B=h[A];return this.splitTextToSize(B.hasOwnProperty("text")?B.text:B,f[A]-x-x)},this).map(function(A){return this.getLineHeightFactor()*A.length*p/w+x+x},this).reduce(function(A,B){return Math.max(A,B)},0)};i.setTableHeaderRow=function(h){n.call(this),this.internal.__cell__.tableHeaderRow=h},i.printHeaderRow=function(h,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var x;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var p=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(p[0],p[1],p[2],p[3],void 0,-1)}this.setFont(void 0,"bold");for(var w=[],A=0;A<this.internal.__cell__.tableHeaderRow.length;A+=1){x=this.internal.__cell__.tableHeaderRow[A].clone(),f&&(x.y=this.internal.__cell__.margins.top||0,w.push(x)),x.lineNumber=h;var B=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),l.call(this,x),this.setTextColor(B)}w.length>0&&this.setTableHeaderRow(w),this.setFont(void 0,"normal"),t=!1}})(Cn.API);var tN={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},nN=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Zx=eN(nN),iN=[100,200,300,400,500,600,700,800,900],PW=eN(iN);function Mb(i){var e=i.family.replace(/"|'/g,"").toLowerCase(),t=(function(s){return tN[s=s||"normal"]?s:"normal"})(i.style),n=(function(s){return s?typeof s=="number"?s>=100&&s<=900&&s%100==0?s:400:/^\d00$/.test(s)?parseInt(s):s==="bold"?700:400:400})(i.weight),r=(function(s){return typeof Zx[s=s||"normal"]=="number"?s:"normal"})(i.stretch);return{family:e,style:t,weight:n,stretch:r,src:i.src||[],ref:i.ref||{name:e,style:[r,t,n].join(" ")}}}function Ok(i,e,t,n){var r;for(r=t;r>=0&&r<e.length;r+=n)if(i[e[r]])return i[e[r]];for(r=t;r>=0&&r<e.length;r-=n)if(i[e[r]])return i[e[r]]}var OW={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Mk={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Fk(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function jk(i){return i.trimLeft()}function MW(i,e){for(var t=0;t<i.length;){if(i.charAt(t)===e)return[i.substring(0,t),i.substring(t+1)];t+=1}return null}function FW(i){var e=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],i.substring(e[0].length)]}var d0,Vk,zk,Bf,f0,Uk,Bk,$k,Fb=["times"];function Hk(i,e,t,n,r){var s=4,l=Kk;switch(r){case Cn.API.image_compression.FAST:s=1,l=Gk;break;case Cn.API.image_compression.MEDIUM:s=6,l=Wk;break;case Cn.API.image_compression.SLOW:s=9,l=qk}i=(function(h,f,x,p){for(var w,A=h.length/f,B=new Uint8Array(h.length+A),$=[jW,Gk,Kk,Wk,qk],W=0;W<A;W+=1){var q=W*f,ge=h.subarray(q,q+f);if(p)B.set(p(ge,x,w),q+W);else{for(var he=$.length,me=[],Ce=0;Ce<he;Ce+=1)me[Ce]=$[Ce](ge,x,w);var Ve=zW(me.concat());B.set(me[Ve],q+W)}w=ge}return B})(i,e,Math.ceil(t*n/8),l);var u=Kx(i,{level:s});return Cn.API.__addimage__.arrayBufferToBinaryString(u)}function jW(i){var e=Array.apply([],i);return e.unshift(0),e}function Gk(i,e){var t=i.length,n=[];n[0]=1;for(var r=0;r<t;r+=1){var s=i[r-e]||0;n[r+1]=i[r]-s+256&255}return n}function Kk(i,e,t){var n=i.length,r=[];r[0]=2;for(var s=0;s<n;s+=1){var l=t&&t[s]||0;r[s+1]=i[s]-l+256&255}return r}function Wk(i,e,t){var n=i.length,r=[];r[0]=3;for(var s=0;s<n;s+=1){var l=i[s-e]||0,u=t&&t[s]||0;r[s+1]=i[s]+256-(l+u>>>1)&255}return r}function qk(i,e,t){var n=i.length,r=[];r[0]=4;for(var s=0;s<n;s+=1){var l=VW(i[s-e]||0,t&&t[s]||0,t&&t[s-e]||0);r[s+1]=i[s]-l+256&255}return r}function VW(i,e,t){if(i===e&&e===t)return i;var n=Math.abs(e-t),r=Math.abs(i-t),s=Math.abs(i+e-t-t);return n<=r&&n<=s?i:r<=s?e:t}function zW(i){var e=i.map(function(t){return t.reduce(function(n,r){return n+Math.abs(r)},0)});return e.indexOf(Math.min.apply(null,e))}function jb(i,e,t){var n=e*t,r=Math.floor(n/8),s=16-(n-8*r+t),l=(1<<t)-1;return rN(i,r)>>s&l}function Yk(i,e,t,n){var r=t*n,s=Math.floor(r/8),l=16-(r-8*s+n),u=(1<<n)-1,h=(e&u)<<l;(function(f,x,p){if(x+1<f.byteLength)f.setUint16(x,p,!1);else{var w=p>>8&255;f.setUint8(x,w)}})(i,s,rN(i,s)&~(u<<l)&65535|h)}function rN(i,e){return e+1<i.byteLength?i.getUint16(e,!1):i.getUint8(e)<<8}function UW(i){var e=0;if(i[e++]!==71||i[e++]!==73||i[e++]!==70||i[e++]!==56||(i[e++]+1&253)!=56||i[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=i[e++]|i[e++]<<8,n=i[e++]|i[e++]<<8,r=i[e++],s=r>>7,l=1<<1+(7&r);i[e++],i[e++];var u=null,h=null;s&&(u=e,h=l,e+=3*l);var f=!0,x=[],p=0,w=null,A=0,B=null;for(this.width=t,this.height=n;f&&e<i.length;)switch(i[e++]){case 33:switch(i[e++]){case 255:if(i[e]!==11||i[e+1]==78&&i[e+2]==69&&i[e+3]==84&&i[e+4]==83&&i[e+5]==67&&i[e+6]==65&&i[e+7]==80&&i[e+8]==69&&i[e+9]==50&&i[e+10]==46&&i[e+11]==48&&i[e+12]==3&&i[e+13]==1&&i[e+16]==0)e+=14,B=i[e++]|i[e++]<<8,e++;else for(e+=12;;){if(!((X=i[e++])>=0))throw Error("Invalid block size");if(X===0)break;e+=X}break;case 249:if(i[e++]!==4||i[e+4]!==0)throw new Error("Invalid graphics extension block.");var $=i[e++];p=i[e++]|i[e++]<<8,w=i[e++],1&$||(w=null),A=$>>2&7,e++;break;case 254:for(;;){if(!((X=i[e++])>=0))throw Error("Invalid block size");if(X===0)break;e+=X}break;default:throw new Error("Unknown graphic control label: 0x"+i[e-1].toString(16))}break;case 44:var W=i[e++]|i[e++]<<8,q=i[e++]|i[e++]<<8,ge=i[e++]|i[e++]<<8,he=i[e++]|i[e++]<<8,me=i[e++],Ce=me>>6&1,Ve=1<<1+(7&me),pe=u,ee=h,J=!1;me>>7&&(J=!0,pe=e,ee=Ve,e+=3*Ve);var ye=e;for(e++;;){var X;if(!((X=i[e++])>=0))throw Error("Invalid block size");if(X===0)break;e+=X}x.push({x:W,y:q,width:ge,height:he,has_local_palette:J,palette_offset:pe,palette_size:ee,data_offset:ye,data_length:e-ye,transparent_index:w,interlaced:!!Ce,delay:p,disposal:A});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+i[e-1].toString(16))}this.numFrames=function(){return x.length},this.loopCount=function(){return B},this.frameInfo=function(ae){if(ae<0||ae>=x.length)throw new Error("Frame index out of range.");return x[ae]},this.decodeAndBlitFrameBGRA=function(ae,le){var ze=this.frameInfo(ae),nt=ze.width*ze.height,je=new Uint8Array(nt);Xk(i,ze.data_offset,je,nt);var Je=ze.palette_offset,qe=ze.transparent_index;qe===null&&(qe=256);var lt=ze.width,Tt=t-lt,Ne=lt,se=4*(ze.y*t+ze.x),Ee=4*((ze.y+ze.height)*t+ze.x),Le=se,Be=4*Tt;ze.interlaced===!0&&(Be+=4*t*7);for(var He=8,Ye=0,it=je.length;Ye<it;++Ye){var ct=je[Ye];if(Ne===0&&(Ne=lt,(Le+=Be)>=Ee&&(Be=4*Tt+4*t*(He-1),Le=se+(lt+Tt)*(He<<1),He>>=1)),ct===qe)Le+=4;else{var Et=i[Je+3*ct],Ft=i[Je+3*ct+1],Wt=i[Je+3*ct+2];le[Le++]=Wt,le[Le++]=Ft,le[Le++]=Et,le[Le++]=255}--Ne}},this.decodeAndBlitFrameRGBA=function(ae,le){var ze=this.frameInfo(ae),nt=ze.width*ze.height,je=new Uint8Array(nt);Xk(i,ze.data_offset,je,nt);var Je=ze.palette_offset,qe=ze.transparent_index;qe===null&&(qe=256);var lt=ze.width,Tt=t-lt,Ne=lt,se=4*(ze.y*t+ze.x),Ee=4*((ze.y+ze.height)*t+ze.x),Le=se,Be=4*Tt;ze.interlaced===!0&&(Be+=4*t*7);for(var He=8,Ye=0,it=je.length;Ye<it;++Ye){var ct=je[Ye];if(Ne===0&&(Ne=lt,(Le+=Be)>=Ee&&(Be=4*Tt+4*t*(He-1),Le=se+(lt+Tt)*(He<<1),He>>=1)),ct===qe)Le+=4;else{var Et=i[Je+3*ct],Ft=i[Je+3*ct+1],Wt=i[Je+3*ct+2];le[Le++]=Et,le[Le++]=Ft,le[Le++]=Wt,le[Le++]=255}--Ne}}}function Xk(i,e,t,n){for(var r=i[e++],s=1<<r,l=s+1,u=l+1,h=r+1,f=(1<<h)-1,x=0,p=0,w=0,A=i[e++],B=new Int32Array(4096),$=null;;){for(;x<16&&A!==0;)p|=i[e++]<<x,x+=8,A===1?A=i[e++]:--A;if(x<h)break;var W=p&f;if(p>>=h,x-=h,W!==s){if(W===l)break;for(var q=W<u?W:$,ge=0,he=q;he>s;)he=B[he]>>8,++ge;var me=he;if(w+ge+(q!==W?1:0)>n)return void ts.log("Warning, gif stream longer than expected.");t[w++]=me;var Ce=w+=ge;for(q!==W&&(t[w++]=me),he=q;ge--;)he=B[he],t[--Ce]=255&he,he>>=8;$!==null&&u<4096&&(B[u++]=$<<8|me,u>=f+1&&h<12&&(++h,f=f<<1|1)),$=W}else u=l+1,f=(1<<(h=r+1))-1,$=null}return w!==n&&ts.log("Warning, gif stream shorter than expected."),t}function Vb(i){var e,t,n,r,s,l=Math.floor,u=new Array(64),h=new Array(64),f=new Array(64),x=new Array(64),p=new Array(65535),w=new Array(65535),A=new Array(64),B=new Array(64),$=[],W=0,q=7,ge=new Array(64),he=new Array(64),me=new Array(64),Ce=new Array(256),Ve=new Array(2048),pe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ee=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],J=[0,1,2,3,4,5,6,7,8,9,10,11],ye=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],X=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ae=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],le=[0,1,2,3,4,5,6,7,8,9,10,11],ze=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],nt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function je(se,Ee){for(var Le=0,Be=0,He=new Array,Ye=1;Ye<=16;Ye++){for(var it=1;it<=se[Ye];it++)He[Ee[Be]]=[],He[Ee[Be]][0]=Le,He[Ee[Be]][1]=Ye,Be++,Le++;Le*=2}return He}function Je(se){for(var Ee=se[0],Le=se[1]-1;Le>=0;)Ee&1<<Le&&(W|=1<<q),Le--,--q<0&&(W==255?(qe(255),qe(0)):qe(W),q=7,W=0)}function qe(se){$.push(se)}function lt(se){qe(se>>8&255),qe(255&se)}function Tt(se,Ee,Le,Be,He){for(var Ye,it=He[0],ct=He[240],Et=(function(_t,rn){var Jt,En,wn,Un,ii,Bn,li,Xn,cn,$n,hn=0;for(cn=0;cn<8;++cn){Jt=_t[hn],En=_t[hn+1],wn=_t[hn+2],Un=_t[hn+3],ii=_t[hn+4],Bn=_t[hn+5],li=_t[hn+6];var nr=Jt+(Xn=_t[hn+7]),Jn=Jt-Xn,vn=En+li,On=En-li,qn=wn+Bn,un=wn-Bn,Pi=Un+ii,Mn=Un-ii,Sn=nr+Pi,Qn=nr-Pi,tn=vn+qn,Gt=vn-qn;_t[hn]=Sn+tn,_t[hn+4]=Sn-tn;var Kn=.707106781*(Gt+Qn);_t[hn+2]=Qn+Kn,_t[hn+6]=Qn-Kn;var Nr=.382683433*((Sn=Mn+un)-(Gt=On+Jn)),vr=.5411961*Sn+Nr,Pr=1.306562965*Gt+Nr,Ri=.707106781*(tn=un+On),pn=Jn+Ri,Ra=Jn-Ri;_t[hn+5]=Ra+vr,_t[hn+3]=Ra-vr,_t[hn+1]=pn+Pr,_t[hn+7]=pn-Pr,hn+=8}for(hn=0,cn=0;cn<8;++cn){Jt=_t[hn],En=_t[hn+8],wn=_t[hn+16],Un=_t[hn+24],ii=_t[hn+32],Bn=_t[hn+40],li=_t[hn+48];var sa=Jt+(Xn=_t[hn+56]),Or=Jt-Xn,bs=En+li,Oi=En-li,ir=wn+Bn,cr=wn-Bn,cs=Un+ii,ns=Un-ii,qi=sa+cs,Yi=sa-cs,Xr=bs+ir,hs=bs-ir;_t[hn]=qi+Xr,_t[hn+32]=qi-Xr;var ya=.707106781*(hs+Yi);_t[hn+16]=Yi+ya,_t[hn+48]=Yi-ya;var Ba=.382683433*((qi=ns+cr)-(hs=Oi+Or)),ds=.5411961*qi+Ba,Jr=1.306562965*hs+Ba,ro=.707106781*(Xr=cr+Oi),Ms=Or+ro,Fs=Or-ro;_t[hn+40]=Fs+ds,_t[hn+24]=Fs-ds,_t[hn+8]=Ms+Jr,_t[hn+56]=Ms-Jr,hn++}for(cn=0;cn<64;++cn)$n=_t[cn]*rn[cn],A[cn]=$n>0?$n+.5|0:$n-.5|0;return A})(se,Ee),Ft=0;Ft<64;++Ft)B[pe[Ft]]=Et[Ft];var Wt=B[0]-Le;Le=B[0],Wt==0?Je(Be[0]):(Je(Be[w[Ye=32767+Wt]]),Je(p[Ye]));for(var qt=63;qt>0&&B[qt]==0;)qt--;if(qt==0)return Je(it),Le;for(var kt,Pe=1;Pe<=qt;){for(var $t=Pe;B[Pe]==0&&Pe<=qt;)++Pe;var Pt=Pe-$t;if(Pt>=16){kt=Pt>>4;for(var Tn=1;Tn<=kt;++Tn)Je(ct);Pt&=15}Ye=32767+B[Pe],Je(He[(Pt<<4)+w[Ye]]),Je(p[Ye]),Pe++}return qt!=63&&Je(it),Le}function Ne(se){se=Math.min(Math.max(se,1),100),s!=se&&((function(Ee){for(var Le=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Be=0;Be<64;Be++){var He=l((Le[Be]*Ee+50)/100);He=Math.min(Math.max(He,1),255),u[pe[Be]]=He}for(var Ye=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],it=0;it<64;it++){var ct=l((Ye[it]*Ee+50)/100);ct=Math.min(Math.max(ct,1),255),h[pe[it]]=ct}for(var Et=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ft=0,Wt=0;Wt<8;Wt++)for(var qt=0;qt<8;qt++)f[Ft]=1/(u[pe[Ft]]*Et[Wt]*Et[qt]*8),x[Ft]=1/(h[pe[Ft]]*Et[Wt]*Et[qt]*8),Ft++})(se<50?Math.floor(5e3/se):Math.floor(200-2*se)),s=se)}this.encode=function(se,Ee){Ee&&Ne(Ee),$=new Array,W=0,q=7,lt(65496),lt(65504),lt(16),qe(74),qe(70),qe(73),qe(70),qe(0),qe(1),qe(1),qe(0),lt(1),lt(1),qe(0),qe(0),(function(){lt(65499),lt(132),qe(0);for(var En=0;En<64;En++)qe(u[En]);qe(1);for(var wn=0;wn<64;wn++)qe(h[wn])})(),(function(En,wn){lt(65472),lt(17),qe(8),lt(wn),lt(En),qe(3),qe(1),qe(17),qe(0),qe(2),qe(17),qe(1),qe(3),qe(17),qe(1)})(se.width,se.height),(function(){lt(65476),lt(418),qe(0);for(var En=0;En<16;En++)qe(ee[En+1]);for(var wn=0;wn<=11;wn++)qe(J[wn]);qe(16);for(var Un=0;Un<16;Un++)qe(ye[Un+1]);for(var ii=0;ii<=161;ii++)qe(X[ii]);qe(1);for(var Bn=0;Bn<16;Bn++)qe(ae[Bn+1]);for(var li=0;li<=11;li++)qe(le[li]);qe(17);for(var Xn=0;Xn<16;Xn++)qe(ze[Xn+1]);for(var cn=0;cn<=161;cn++)qe(nt[cn])})(),lt(65498),lt(12),qe(3),qe(1),qe(0),qe(2),qe(17),qe(3),qe(17),qe(0),qe(63),qe(0);var Le=0,Be=0,He=0;W=0,q=7,this.encode.displayName="_encode_";for(var Ye,it,ct,Et,Ft,Wt,qt,kt,Pe,$t=se.data,Pt=se.width,Tn=se.height,_t=4*Pt,rn=0;rn<Tn;){for(Ye=0;Ye<_t;){for(Ft=_t*rn+Ye,qt=-1,kt=0,Pe=0;Pe<64;Pe++)Wt=Ft+(kt=Pe>>3)*_t+(qt=4*(7&Pe)),rn+kt>=Tn&&(Wt-=_t*(rn+1+kt-Tn)),Ye+qt>=_t&&(Wt-=Ye+qt-_t+4),it=$t[Wt++],ct=$t[Wt++],Et=$t[Wt++],ge[Pe]=(Ve[it]+Ve[ct+256|0]+Ve[Et+512|0]>>16)-128,he[Pe]=(Ve[it+768|0]+Ve[ct+1024|0]+Ve[Et+1280|0]>>16)-128,me[Pe]=(Ve[it+1280|0]+Ve[ct+1536|0]+Ve[Et+1792|0]>>16)-128;Le=Tt(ge,f,Le,e,n),Be=Tt(he,x,Be,t,r),He=Tt(me,x,He,t,r),Ye+=32}rn+=8}if(q>=0){var Jt=[];Jt[1]=q+1,Jt[0]=(1<<q+1)-1,Je(Jt)}return lt(65497),new Uint8Array($)},i=i||50,(function(){for(var se=String.fromCharCode,Ee=0;Ee<256;Ee++)Ce[Ee]=se(Ee)})(),e=je(ee,J),t=je(ae,le),n=je(ye,X),r=je(ze,nt),(function(){for(var se=1,Ee=2,Le=1;Le<=15;Le++){for(var Be=se;Be<Ee;Be++)w[32767+Be]=Le,p[32767+Be]=[],p[32767+Be][1]=Le,p[32767+Be][0]=Be;for(var He=-(Ee-1);He<=-se;He++)w[32767+He]=Le,p[32767+He]=[],p[32767+He][1]=Le,p[32767+He][0]=Ee-1+He;se<<=1,Ee<<=1}})(),(function(){for(var se=0;se<256;se++)Ve[se]=19595*se,Ve[se+256|0]=38470*se,Ve[se+512|0]=7471*se+32768,Ve[se+768|0]=-11059*se,Ve[se+1024|0]=-21709*se,Ve[se+1280|0]=32768*se+8421375,Ve[se+1536|0]=-27439*se,Ve[se+1792|0]=-5329*se})(),Ne(i)}function Au(i,e){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Jk(i){function e(J){if(!J)throw Error("assert :P")}function t(J,ye,X){for(var ae=0;4>ae;ae++)if(J[ye+ae]!=X.charCodeAt(ae))return!0;return!1}function n(J,ye,X,ae,le){for(var ze=0;ze<le;ze++)J[ye+ze]=X[ae+ze]}function r(J,ye,X,ae){for(var le=0;le<ae;le++)J[ye+le]=X}function s(J){return new Int32Array(J)}function l(J,ye){for(var X=[],ae=0;ae<J;ae++)X.push(new ye);return X}function u(J,ye){var X=[];return(function ae(le,ze,nt){for(var je=nt[ze],Je=0;Je<je&&(le.push(nt.length>ze+1?[]:new ye),!(nt.length<ze+1));Je++)ae(le[Je],ze+1,nt)})(X,0,J),X}var h=function(){var J=this;function ye(v,I){for(var M=1<<I-1>>>0;v&M;)M>>>=1;return M?(v&M-1)+M:v}function X(v,I,M,H,oe){e(!(H%M));do v[I+(H-=M)]=oe;while(0<H)}function ae(v,I,M,H,oe){if(e(2328>=oe),512>=oe)var de=s(512);else if((de=s(oe))==null)return 0;return(function(ue,ve,xe,Re,Ue,Xe){var Ae,Ge,et=ve,ot=1<<xe,Ze=s(16),gt=s(16);for(e(Ue!=0),e(Re!=null),e(ue!=null),e(0<xe),Ge=0;Ge<Ue;++Ge){if(15<Re[Ge])return 0;++Ze[Re[Ge]]}if(Ze[0]==Ue)return 0;for(gt[1]=0,Ae=1;15>Ae;++Ae){if(Ze[Ae]>1<<Ae)return 0;gt[Ae+1]=gt[Ae]+Ze[Ae]}for(Ge=0;Ge<Ue;++Ge)Ae=Re[Ge],0<Re[Ge]&&(Xe[gt[Ae]++]=Ge);if(gt[15]==1)return(Re=new le).g=0,Re.value=Xe[0],X(ue,et,1,ot,Re),ot;var wt,Nt=-1,ht=ot-1,Ut=0,Bt=1,In=1,nn=1<<xe;for(Ge=0,Ae=1,Ue=2;Ae<=xe;++Ae,Ue<<=1){if(Bt+=In<<=1,0>(In-=Ze[Ae]))return 0;for(;0<Ze[Ae];--Ze[Ae])(Re=new le).g=Ae,Re.value=Xe[Ge++],X(ue,et+Ut,Ue,nn,Re),Ut=ye(Ut,Ae)}for(Ae=xe+1,Ue=2;15>=Ae;++Ae,Ue<<=1){if(Bt+=In<<=1,0>(In-=Ze[Ae]))return 0;for(;0<Ze[Ae];--Ze[Ae]){if(Re=new le,(Ut&ht)!=Nt){for(et+=nn,wt=1<<(Nt=Ae)-xe;15>Nt&&!(0>=(wt-=Ze[Nt]));)++Nt,wt<<=1;ot+=nn=1<<(wt=Nt-xe),ue[ve+(Nt=Ut&ht)].g=wt+xe,ue[ve+Nt].value=et-ve-Nt}Re.g=Ae-xe,Re.value=Xe[Ge++],X(ue,et+(Ut>>xe),Ue,nn,Re),Ut=ye(Ut,Ae)}}return Bt!=2*gt[15]-1?0:ot})(v,I,M,H,oe,de)}function le(){this.value=this.g=0}function ze(){this.value=this.g=0}function nt(){this.G=l(5,le),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=l(Hl,ze)}function je(v,I,M,H){e(v!=null),e(I!=null),e(2147483648>H),v.Ca=254,v.I=0,v.b=-8,v.Ka=0,v.oa=I,v.pa=M,v.Jd=I,v.Yc=M+H,v.Zc=4<=H?M+H-4+1:M,it(v)}function Je(v,I){for(var M=0;0<I--;)M|=Et(v,128)<<I;return M}function qe(v,I){var M=Je(v,I);return ct(v)?-M:M}function lt(v,I,M,H){var oe,de=0;for(e(v!=null),e(I!=null),e(4294967288>H),v.Sb=H,v.Ra=0,v.u=0,v.h=0,4<H&&(H=4),oe=0;oe<H;++oe)de+=I[M+oe]<<8*oe;v.Ra=de,v.bb=H,v.oa=I,v.pa=M}function Tt(v){for(;8<=v.u&&v.bb<v.Sb;)v.Ra>>>=8,v.Ra+=v.oa[v.pa+v.bb]<<Ko-8>>>0,++v.bb,v.u-=8;Be(v)&&(v.h=1,v.u=0)}function Ne(v,I){if(e(0<=I),!v.h&&I<=Na){var M=Le(v)&Ya[I];return v.u+=I,Tt(v),M}return v.h=1,v.u=0}function se(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Ee(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Le(v){return v.Ra>>>(v.u&Ko-1)>>>0}function Be(v){return e(v.bb<=v.Sb),v.h||v.bb==v.Sb&&v.u>Ko}function He(v,I){v.u=I,v.h=Be(v)}function Ye(v){v.u>=sl&&(e(v.u>=sl),Tt(v))}function it(v){e(v!=null&&v.oa!=null),v.pa<v.Zc?(v.I=(v.oa[v.pa++]|v.I<<8)>>>0,v.b+=8):(e(v!=null&&v.oa!=null),v.pa<v.Yc?(v.b+=8,v.I=v.oa[v.pa++]|v.I<<8):v.Ka?v.b=0:(v.I<<=8,v.b+=8,v.Ka=1))}function ct(v){return Je(v,1)}function Et(v,I){var M=v.Ca;0>v.b&&it(v);var H=v.b,oe=M*I>>>8,de=(v.I>>>H>oe)+0;for(de?(M-=oe,v.I-=oe+1<<H>>>0):M=oe+1,H=M,oe=0;256<=H;)oe+=8,H>>=8;return H=7^oe+al[H],v.b-=H,v.Ca=(M<<H)-1,de}function Ft(v,I,M){v[I+0]=M>>24&255,v[I+1]=M>>16&255,v[I+2]=M>>8&255,v[I+3]=255&M}function Wt(v,I){return v[I+0]|v[I+1]<<8}function qt(v,I){return Wt(v,I)|v[I+2]<<16}function kt(v,I){return Wt(v,I)|Wt(v,I+2)<<16}function Pe(v,I){var M=1<<I;return e(v!=null),e(0<I),v.X=s(M),v.X==null?0:(v.Mb=32-I,v.Xa=I,1)}function $t(v,I){e(v!=null),e(I!=null),e(v.Xa==I.Xa),n(I.X,0,v.X,0,1<<I.Xa)}function Pt(){this.X=[],this.Xa=this.Mb=0}function Tn(v,I,M,H){e(M!=null),e(H!=null);var oe=M[0],de=H[0];return oe==0&&(oe=(v*de+I/2)/I),de==0&&(de=(I*oe+v/2)/v),0>=oe||0>=de?0:(M[0]=oe,H[0]=de,1)}function _t(v,I){return v+(1<<I)-1>>>I}function rn(v,I){return((4278255360&v)+(4278255360&I)>>>0&4278255360)+((16711935&v)+(16711935&I)>>>0&16711935)>>>0}function Jt(v,I){J[I]=function(M,H,oe,de,ue,ve,xe){var Re;for(Re=0;Re<ue;++Re){var Ue=J[v](ve[xe+Re-1],oe,de+Re);ve[xe+Re]=rn(M[H+Re],Ue)}}}function En(){this.ud=this.hd=this.jd=0}function wn(v,I){return((4278124286&(v^I))>>>1)+(v&I)>>>0}function Un(v){return 0<=v&&256>v?v:0>v?0:255<v?255:void 0}function ii(v,I){return Un(v+(v-I+.5>>1))}function Bn(v,I,M){return Math.abs(I-M)-Math.abs(v-M)}function li(v,I,M,H,oe,de,ue){for(H=de[ue-1],M=0;M<oe;++M)de[ue+M]=H=rn(v[I+M],H)}function Xn(v,I,M,H,oe){var de;for(de=0;de<M;++de){var ue=v[I+de],ve=ue>>8&255,xe=16711935&(xe=(xe=16711935&ue)+((ve<<16)+ve));H[oe+de]=(4278255360&ue)+xe>>>0}}function cn(v,I){I.jd=255&v,I.hd=v>>8&255,I.ud=v>>16&255}function $n(v,I,M,H,oe,de){var ue;for(ue=0;ue<H;++ue){var ve=I[M+ue],xe=ve>>>8,Re=ve,Ue=255&(Ue=(Ue=ve>>>16)+((v.jd<<24>>24)*(xe<<24>>24)>>>5));Re=255&(Re=(Re+=(v.hd<<24>>24)*(xe<<24>>24)>>>5)+((v.ud<<24>>24)*(Ue<<24>>24)>>>5)),oe[de+ue]=(4278255360&ve)+(Ue<<16)+Re}}function hn(v,I,M,H,oe){J[I]=function(de,ue,ve,xe,Re,Ue,Xe,Ae,Ge){for(xe=Xe;xe<Ae;++xe)for(Xe=0;Xe<Ge;++Xe)Re[Ue++]=oe(ve[H(de[ue++])])},J[v]=function(de,ue,ve,xe,Re,Ue,Xe){var Ae=8>>de.b,Ge=de.Ea,et=de.K[0],ot=de.w;if(8>Ae)for(de=(1<<de.b)-1,ot=(1<<Ae)-1;ue<ve;++ue){var Ze,gt=0;for(Ze=0;Ze<Ge;++Ze)Ze&de||(gt=H(xe[Re++])),Ue[Xe++]=oe(et[gt&ot]),gt>>=Ae}else J["VP8LMapColor"+M](xe,Re,et,ot,Ue,Xe,ue,ve,Ge)}}function nr(v,I,M,H,oe){for(M=I+M;I<M;){var de=v[I++];H[oe++]=de>>16&255,H[oe++]=de>>8&255,H[oe++]=255&de}}function Jn(v,I,M,H,oe){for(M=I+M;I<M;){var de=v[I++];H[oe++]=de>>16&255,H[oe++]=de>>8&255,H[oe++]=255&de,H[oe++]=de>>24&255}}function vn(v,I,M,H,oe){for(M=I+M;I<M;){var de=(ue=v[I++])>>16&240|ue>>12&15,ue=240&ue|ue>>28&15;H[oe++]=de,H[oe++]=ue}}function On(v,I,M,H,oe){for(M=I+M;I<M;){var de=(ue=v[I++])>>16&248|ue>>13&7,ue=ue>>5&224|ue>>3&31;H[oe++]=de,H[oe++]=ue}}function qn(v,I,M,H,oe){for(M=I+M;I<M;){var de=v[I++];H[oe++]=255&de,H[oe++]=de>>8&255,H[oe++]=de>>16&255}}function un(v,I,M,H,oe,de){if(de==0)for(M=I+M;I<M;)Ft(H,((de=v[I++])[0]>>24|de[1]>>8&65280|de[2]<<8&16711680|de[3]<<24)>>>0),oe+=32;else n(H,oe,v,I,M)}function Pi(v,I){J[I][0]=J[v+"0"],J[I][1]=J[v+"1"],J[I][2]=J[v+"2"],J[I][3]=J[v+"3"],J[I][4]=J[v+"4"],J[I][5]=J[v+"5"],J[I][6]=J[v+"6"],J[I][7]=J[v+"7"],J[I][8]=J[v+"8"],J[I][9]=J[v+"9"],J[I][10]=J[v+"10"],J[I][11]=J[v+"11"],J[I][12]=J[v+"12"],J[I][13]=J[v+"13"],J[I][14]=J[v+"0"],J[I][15]=J[v+"0"]}function Mn(v){return v==zu||v==vc||v==_u||v==_c}function Sn(){this.eb=[],this.size=this.A=this.fb=0}function Qn(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function tn(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Sn,this.f.kb=new Qn,this.sd=null}function Gt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Kn(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Nr(v){return alert("todo:WebPSamplerProcessPlane"),v.T}function vr(v,I){var M=v.T,H=I.ba.f.RGBA,oe=H.eb,de=H.fb+v.ka*H.A,ue=N[I.ba.S],ve=v.y,xe=v.O,Re=v.f,Ue=v.N,Xe=v.ea,Ae=v.W,Ge=I.cc,et=I.dc,ot=I.Mc,Ze=I.Nc,gt=v.ka,wt=v.ka+v.T,Nt=v.U,ht=Nt+1>>1;for(gt==0?ue(ve,xe,null,null,Re,Ue,Xe,Ae,Re,Ue,Xe,Ae,oe,de,null,null,Nt):(ue(I.ec,I.fc,ve,xe,Ge,et,ot,Ze,Re,Ue,Xe,Ae,oe,de-H.A,oe,de,Nt),++M);gt+2<wt;gt+=2)Ge=Re,et=Ue,ot=Xe,Ze=Ae,Ue+=v.Rc,Ae+=v.Rc,de+=2*H.A,ue(ve,(xe+=2*v.fa)-v.fa,ve,xe,Ge,et,ot,Ze,Re,Ue,Xe,Ae,oe,de-H.A,oe,de,Nt);return xe+=v.fa,v.j+wt<v.o?(n(I.ec,I.fc,ve,xe,Nt),n(I.cc,I.dc,Re,Ue,ht),n(I.Mc,I.Nc,Xe,Ae,ht),M--):1&wt||ue(ve,xe,null,null,Re,Ue,Xe,Ae,Re,Ue,Xe,Ae,oe,de+H.A,null,null,Nt),M}function Pr(v,I,M){var H=v.F,oe=[v.J];if(H!=null){var de=v.U,ue=I.ba.S,ve=ue==Wl||ue==_u;I=I.ba.f.RGBA;var xe=[0],Re=v.ka;xe[0]=v.T,v.Kb&&(Re==0?--xe[0]:(--Re,oe[0]-=v.width),v.j+v.ka+v.T==v.o&&(xe[0]=v.o-v.j-Re));var Ue=I.eb;Re=I.fb+Re*I.A,v=Kl(H,oe[0],v.width,de,xe,Ue,Re+(ve?0:3),I.A),e(M==xe),v&&Mn(ue)&&gu(Ue,Re,ve,de,xe,I.A)}return 0}function Ri(v){var I=v.ma,M=I.ba.S,H=11>M,oe=M==ha||M==fo||M==Wl||M==Vu||M==12||Mn(M);if(I.memory=null,I.Ib=null,I.Jb=null,I.Nd=null,!Sl(I.Oa,v,oe?11:12))return 0;if(oe&&Mn(M)&&Zn(),v.da)alert("todo:use_scaling");else{if(H){if(I.Ib=Nr,v.Kb){if(M=v.U+1>>1,I.memory=s(v.U+2*M),I.memory==null)return 0;I.ec=I.memory,I.fc=0,I.cc=I.ec,I.dc=I.fc+v.U,I.Mc=I.cc,I.Nc=I.dc+M,I.Ib=vr,Zn()}}else alert("todo:EmitYUV");oe&&(I.Jb=Pr,H&&ft())}if(H&&!_e){for(v=0;256>v;++v)Y[v]=89858*(v-128)+G>>T,ke[v]=-22014*(v-128)+G,be[v]=-45773*(v-128),re[v]=113618*(v-128)+G>>T;for(v=te;v<Te;++v)I=76283*(v-16)+G>>T,rt[v-te]=oi(I,255),vt[v-te]=oi(I+8>>4,15);_e=1}return 1}function pn(v){var I=v.ma,M=v.U,H=v.T;return e(!(1&v.ka)),0>=M||0>=H?0:(M=I.Ib(v,I),I.Jb!=null&&I.Jb(v,I,M),I.Dc+=M,1)}function Ra(v){v.ma.memory=null}function sa(v,I,M,H){return Ne(v,8)!=47?0:(I[0]=Ne(v,14)+1,M[0]=Ne(v,14)+1,H[0]=Ne(v,1),Ne(v,3)!=0?0:!v.h)}function Or(v,I){if(4>v)return v+1;var M=v-2>>1;return(2+(1&v)<<M)+Ne(I,M)+1}function bs(v,I){return 120<I?I-120:1<=(M=((M=Io[I-1])>>4)*v+(8-(15&M)))?M:1;var M}function Oi(v,I,M){var H=Le(M),oe=v[I+=255&H].g-8;return 0<oe&&(He(M,M.u+8),H=Le(M),I+=v[I].value,I+=H&(1<<oe)-1),He(M,M.u+v[I].g),v[I].value}function ir(v,I,M){return M.g+=v.g,M.value+=v.value<<I>>>0,e(8>=M.g),v.g}function cr(v,I,M){var H=v.xc;return e((I=H==0?0:v.vc[v.md*(M>>H)+(I>>H)])<v.Wb),v.Ya[I]}function cs(v,I,M,H){var oe=v.ab,de=v.c*I,ue=v.C;I=ue+I;var ve=M,xe=H;for(H=v.Ta,M=v.Ua;0<oe--;){var Re=v.gc[oe],Ue=ue,Xe=I,Ae=ve,Ge=xe,et=(xe=H,ve=M,Re.Ea);switch(e(Ue<Xe),e(Xe<=Re.nc),Re.hc){case 2:ps(Ae,Ge,(Xe-Ue)*et,xe,ve);break;case 0:var ot=Ue,Ze=Xe,gt=xe,wt=ve,Nt=(nn=Re).Ea;ot==0&&(Fu(Ae,Ge,null,null,1,gt,wt),li(Ae,Ge+1,0,0,Nt-1,gt,wt+1),Ge+=Nt,wt+=Nt,++ot);for(var ht=1<<nn.b,Ut=ht-1,Bt=_t(Nt,nn.b),In=nn.K,nn=nn.w+(ot>>nn.b)*Bt;ot<Ze;){var xi=In,Ui=nn,si=1;for(fu(Ae,Ge,gt,wt-Nt,1,gt,wt);si<Nt;){var sn=(si&~Ut)+ht;sn>Nt&&(sn=Nt),(0,Tl[xi[Ui++]>>8&15])(Ae,Ge+ +si,gt,wt+si-Nt,sn-si,gt,wt+si),si=sn}Ge+=Nt,wt+=Nt,++ot&Ut||(nn+=Bt)}Xe!=Re.nc&&n(xe,ve-et,xe,ve+(Xe-Ue-1)*et,et);break;case 1:for(et=Ae,Ze=Ge,Nt=(Ae=Re.Ea)-(wt=Ae&~(gt=(Ge=1<<Re.b)-1)),ot=_t(Ae,Re.b),ht=Re.K,Re=Re.w+(Ue>>Re.b)*ot;Ue<Xe;){for(Ut=ht,Bt=Re,In=new En,nn=Ze+wt,xi=Ze+Ae;Ze<nn;)cn(Ut[Bt++],In),lo(In,et,Ze,Ge,xe,ve),Ze+=Ge,ve+=Ge;Ze<xi&&(cn(Ut[Bt++],In),lo(In,et,Ze,Nt,xe,ve),Ze+=Nt,ve+=Nt),++Ue&gt||(Re+=ot)}break;case 3:if(Ae==xe&&Ge==ve&&0<Re.b){for(Ze=xe,Ae=et=ve+(Xe-Ue)*et-(wt=(Xe-Ue)*_t(Re.Ea,Re.b)),Ge=xe,gt=ve,ot=[],wt=(Nt=wt)-1;0<=wt;--wt)ot[wt]=Ge[gt+wt];for(wt=Nt-1;0<=wt;--wt)Ze[Ae+wt]=ot[wt];fc(Re,Ue,Xe,xe,et,xe,ve)}else fc(Re,Ue,Xe,Ae,Ge,xe,ve)}ve=H,xe=M}xe!=M&&n(H,M,ve,xe,de)}function ns(v,I){var M=v.V,H=v.Ba+v.c*v.C,oe=I-v.C;if(e(I<=v.l.o),e(16>=oe),0<oe){var de=v.l,ue=v.Ta,ve=v.Ua,xe=de.width;if(cs(v,oe,M,H),oe=ve=[ve],e((M=v.C)<(H=I)),e(de.v<de.va),H>de.o&&(H=de.o),M<de.j){var Re=de.j-M;M=de.j,oe[0]+=Re*xe}if(M>=H?M=0:(oe[0]+=4*de.v,de.ka=M-de.j,de.U=de.va-de.v,de.T=H-M,M=1),M){if(ve=ve[0],11>(M=v.ca).S){var Ue=M.f.RGBA,Xe=(H=M.S,oe=de.U,de=de.T,Re=Ue.eb,Ue.A),Ae=de;for(Ue=Ue.fb+v.Ma*Ue.A;0<Ae--;){var Ge=ue,et=ve,ot=oe,Ze=Re,gt=Ue;switch(H){case mc:ju(Ge,et,ot,Ze,gt);break;case ha:Wo(Ge,et,ot,Ze,gt);break;case zu:Wo(Ge,et,ot,Ze,gt),gu(Ze,gt,0,ot,1,0);break;case yc:Gl(Ge,et,ot,Ze,gt);break;case fo:un(Ge,et,ot,Ze,gt,1);break;case vc:un(Ge,et,ot,Ze,gt,1),gu(Ze,gt,0,ot,1,0);break;case Wl:un(Ge,et,ot,Ze,gt,0);break;case _u:un(Ge,et,ot,Ze,gt,0),gu(Ze,gt,1,ot,1,0);break;case Vu:uo(Ge,et,ot,Ze,gt);break;case _c:uo(Ge,et,ot,Ze,gt),Ao(Ze,gt,ot,1,0);break;case Il:ll(Ge,et,ot,Ze,gt);break;default:e(0)}ve+=xe,Ue+=Xe}v.Ma+=de}else alert("todo:EmitRescaledRowsYUVA");e(v.Ma<=M.height)}}v.C=I,e(v.C<=v.i)}function qi(v){var I;if(0<v.ua)return 0;for(I=0;I<v.Wb;++I){var M=v.Ya[I].G,H=v.Ya[I].H;if(0<M[1][H[1]+0].g||0<M[2][H[2]+0].g||0<M[3][H[3]+0].g)return 0}return 1}function Yi(v,I,M,H,oe,de){if(v.Z!=0){var ue=v.qd,ve=v.rd;for(e(y[v.Z]!=null);I<M;++I)y[v.Z](ue,ve,H,oe,H,oe,de),ue=H,ve=oe,oe+=de;v.qd=ue,v.rd=ve}}function Xr(v,I){var M=v.l.ma,H=M.Z==0||M.Z==1?v.l.j:v.C;if(H=v.C<H?H:v.C,e(I<=v.l.o),I>H){var oe=v.l.width,de=M.ca,ue=M.tb+oe*H,ve=v.V,xe=v.Ba+v.c*H,Re=v.gc;e(v.ab==1),e(Re[0].hc==3),Cs(Re[0],H,I,ve,xe,de,ue),Yi(M,H,I,de,ue,oe)}v.C=v.Ma=I}function hs(v,I,M,H,oe,de,ue){var ve=v.$/H,xe=v.$%H,Re=v.m,Ue=v.s,Xe=M+v.$,Ae=Xe;oe=M+H*oe;var Ge=M+H*de,et=280+Ue.ua,ot=v.Pb?ve:16777216,Ze=0<Ue.ua?Ue.Wa:null,gt=Ue.wc,wt=Xe<Ge?cr(Ue,xe,ve):null;e(v.C<de),e(Ge<=oe);var Nt=!1;e:for(;;){for(;Nt||Xe<Ge;){var ht=0;if(ve>=ot){var Ut=Xe-M;e((ot=v).Pb),ot.wd=ot.m,ot.xd=Ut,0<ot.s.ua&&$t(ot.s.Wa,ot.s.vb),ot=ve+ql}if(xe&gt||(wt=cr(Ue,xe,ve)),e(wt!=null),wt.Qb&&(I[Xe]=wt.qb,Nt=!0),!Nt)if(Ye(Re),wt.jc){ht=Re,Ut=I;var Bt=Xe,In=wt.pd[Le(ht)&Hl-1];e(wt.jc),256>In.g?(He(ht,ht.u+In.g),Ut[Bt]=In.value,ht=0):(He(ht,ht.u+In.g-256),e(256<=In.value),ht=In.value),ht==0&&(Nt=!0)}else ht=Oi(wt.G[0],wt.H[0],Re);if(Re.h)break;if(Nt||256>ht){if(!Nt)if(wt.nd)I[Xe]=(wt.qb|ht<<8)>>>0;else{if(Ye(Re),Nt=Oi(wt.G[1],wt.H[1],Re),Ye(Re),Ut=Oi(wt.G[2],wt.H[2],Re),Bt=Oi(wt.G[3],wt.H[3],Re),Re.h)break;I[Xe]=(Bt<<24|Nt<<16|ht<<8|Ut)>>>0}if(Nt=!1,++Xe,++xe>=H&&(xe=0,++ve,ue!=null&&ve<=de&&!(ve%16)&&ue(v,ve),Ze!=null))for(;Ae<Xe;)ht=I[Ae++],Ze.X[(506832829*ht&4294967295)>>>Ze.Mb]=ht}else if(280>ht){if(ht=Or(ht-256,Re),Ut=Oi(wt.G[4],wt.H[4],Re),Ye(Re),Ut=bs(H,Ut=Or(Ut,Re)),Re.h)break;if(Xe-M<Ut||oe-Xe<ht)break e;for(Bt=0;Bt<ht;++Bt)I[Xe+Bt]=I[Xe+Bt-Ut];for(Xe+=ht,xe+=ht;xe>=H;)xe-=H,++ve,ue!=null&&ve<=de&&!(ve%16)&&ue(v,ve);if(e(Xe<=oe),xe&gt&&(wt=cr(Ue,xe,ve)),Ze!=null)for(;Ae<Xe;)ht=I[Ae++],Ze.X[(506832829*ht&4294967295)>>>Ze.Mb]=ht}else{if(!(ht<et))break e;for(Nt=ht-280,e(Ze!=null);Ae<Xe;)ht=I[Ae++],Ze.X[(506832829*ht&4294967295)>>>Ze.Mb]=ht;ht=Xe,e(!(Nt>>>(Ut=Ze).Xa)),I[ht]=Ut.X[Nt],Nt=!0}Nt||e(Re.h==Be(Re))}if(v.Pb&&Re.h&&Xe<oe)e(v.m.h),v.a=5,v.m=v.wd,v.$=v.xd,0<v.s.ua&&$t(v.s.vb,v.s.Wa);else{if(Re.h)break e;ue?.(v,ve>de?de:ve),v.a=0,v.$=Xe-M}return 1}return v.a=3,0}function ya(v){e(v!=null),v.vc=null,v.yc=null,v.Ya=null;var I=v.Wa;I!=null&&(I.X=null),v.vb=null,e(v!=null)}function Ba(){var v=new Vn;return v==null?null:(v.a=0,v.xb=g,Pi("Predictor","VP8LPredictors"),Pi("Predictor","VP8LPredictors_C"),Pi("PredictorAdd","VP8LPredictorsAdd"),Pi("PredictorAdd","VP8LPredictorsAdd_C"),ps=Xn,lo=$n,ju=nr,Wo=Jn,uo=vn,ll=On,Gl=qn,J.VP8LMapColor32b=ol,J.VP8LMapColor8b=Rs,v)}function ds(v,I,M,H,oe){var de=1,ue=[v],ve=[I],xe=H.m,Re=H.s,Ue=null,Xe=0;e:for(;;){if(M)for(;de&&Ne(xe,1);){var Ae=ue,Ge=ve,et=H,ot=1,Ze=et.m,gt=et.gc[et.ab],wt=Ne(Ze,2);if(et.Oc&1<<wt)de=0;else{switch(et.Oc|=1<<wt,gt.hc=wt,gt.Ea=Ae[0],gt.nc=Ge[0],gt.K=[null],++et.ab,e(4>=et.ab),wt){case 0:case 1:gt.b=Ne(Ze,3)+2,ot=ds(_t(gt.Ea,gt.b),_t(gt.nc,gt.b),0,et,gt.K),gt.K=gt.K[0];break;case 3:var Nt,ht=Ne(Ze,8)+1,Ut=16<ht?0:4<ht?1:2<ht?2:3;if(Ae[0]=_t(gt.Ea,Ut),gt.b=Ut,Nt=ot=ds(ht,1,0,et,gt.K)){var Bt,In=ht,nn=gt,xi=1<<(8>>nn.b),Ui=s(xi);if(Ui==null)Nt=0;else{var si=nn.K[0],sn=nn.w;for(Ui[0]=nn.K[0][0],Bt=1;Bt<1*In;++Bt)Ui[Bt]=rn(si[sn+Bt],Ui[Bt-1]);for(;Bt<4*xi;++Bt)Ui[Bt]=0;nn.K[0]=null,nn.K[0]=Ui,Nt=1}}ot=Nt;break;case 2:break;default:e(0)}de=ot}}if(ue=ue[0],ve=ve[0],de&&Ne(xe,1)&&!(de=1<=(Xe=Ne(xe,4))&&11>=Xe)){H.a=3;break e}var Ht;if(Ht=de)t:{var ei,Dn,Nn,ur=H,ss=ue,An=ve,pr=Xe,ws=M,wa=ur.m,Kr=ur.s,fi=[null],Bi=1,sr=0,an=Ja[pr];n:for(;;){if(ws&&Ne(wa,1)){var Ds=Ne(wa,3)+2,Lr=_t(ss,Ds),_i=_t(An,Ds),ms=Lr*_i;if(!ds(Lr,_i,0,ur,fi))break n;for(fi=fi[0],Kr.xc=Ds,ei=0;ei<ms;++ei){var Ji=fi[ei]>>8&65535;fi[ei]=Ji,Ji>=Bi&&(Bi=Ji+1)}}if(wa.h)break n;for(Dn=0;5>Dn;++Dn){var Qr=bu[Dn];!Dn&&0<pr&&(Qr+=1<<pr),sr<Qr&&(sr=Qr)}var ys=l(Bi*an,le),wi=Bi,Fn=l(wi,nt);if(Fn==null)var Ls=null;else e(65536>=wi),Ls=Fn;var Zr=s(sr);if(Ls==null||Zr==null||ys==null){ur.a=1;break n}var Pn=ys;for(ei=Nn=0;ei<Bi;++ei){var zn=Ls[ei],Qi=zn.G,Oa=zn.H,mo=0,Sa=1,Ss=0;for(Dn=0;5>Dn;++Dn){Qr=bu[Dn],Qi[Dn]=Pn,Oa[Dn]=Nn,!Dn&&0<pr&&(Qr+=1<<pr);r:{var Yl,kl=Qr,Bu=ur,Yt=Zr,Yo=Pn,$u=Nn,wc=0,Cl=Bu.m,qp=Ne(Cl,1);if(r(Yt,0,0,kl),qp){var oh=Ne(Cl,1)+1,bd=Ne(Cl,1),lh=Ne(Cl,bd==0?1:8);Yt[lh]=1,oh==2&&(Yt[lh=Ne(Cl,8)]=1);var Ns=1}else{var as=s(19),Xl=Ne(Cl,4)+4;if(19<Xl){Bu.a=3;var Rl=0;break r}for(Yl=0;Yl<Xl;++Yl)as[bc[Yl]]=Ne(Cl,3);var xu=void 0,Jl=void 0,yo=Bu,Si=as,Ql=kl,Sc=Yt,Tc=0,Dl=yo.m,xd=8,wd=l(128,le);i:for(;ae(wd,0,7,Si,19);){if(Ne(Dl,1)){var _=2+2*Ne(Dl,3);if((xu=2+Ne(Dl,_))>Ql)break i}else xu=Ql;for(Jl=0;Jl<Ql&&xu--;){Ye(Dl);var V=wd[0+(127&Le(Dl))];He(Dl,Dl.u+V.g);var ce=V.value;if(16>ce)Sc[Jl++]=ce,ce!=0&&(xd=ce);else{var De=ce==16,$e=ce-16,mt=Uu[$e],Dt=Ne(Dl,Eo[$e])+mt;if(Jl+Dt>Ql)break i;for(var Zt=De?xd:0;0<Dt--;)Sc[Jl++]=Zt}}Tc=1;break i}Tc||(yo.a=3),Ns=Tc}(Ns=Ns&&!Cl.h)&&(wc=ae(Yo,$u,8,Yt,kl)),Ns&&wc!=0?Rl=wc:(Bu.a=3,Rl=0)}if(Rl==0)break n;if(Sa&&sh[Dn]==1&&(Sa=Pn[Nn].g==0),mo+=Pn[Nn].g,Nn+=Rl,3>=Dn){var Ln,$i=Zr[0];for(Ln=1;Ln<Qr;++Ln)Zr[Ln]>$i&&($i=Zr[Ln]);Ss+=$i}}if(zn.nd=Sa,zn.Qb=0,Sa&&(zn.qb=(Qi[3][Oa[3]+0].value<<24|Qi[1][Oa[1]+0].value<<16|Qi[2][Oa[2]+0].value)>>>0,mo==0&&256>Qi[0][Oa[0]+0].value&&(zn.Qb=1,zn.qb+=Qi[0][Oa[0]+0].value<<8)),zn.jc=!zn.Qb&&6>Ss,zn.jc){var Xs,Js=zn;for(Xs=0;Xs<Hl;++Xs){var Qa=Xs,Ma=Js.pd[Qa],uh=Js.G[0][Js.H[0]+Qa];256<=uh.value?(Ma.g=uh.g+256,Ma.value=uh.value):(Ma.g=0,Ma.value=0,Qa>>=ir(uh,8,Ma),Qa>>=ir(Js.G[1][Js.H[1]+Qa],16,Ma),Qa>>=ir(Js.G[2][Js.H[2]+Qa],0,Ma),ir(Js.G[3][Js.H[3]+Qa],24,Ma))}}}Kr.vc=fi,Kr.Wb=Bi,Kr.Ya=Ls,Kr.yc=ys,Ht=1;break t}Ht=0}if(!(de=Ht)){H.a=3;break e}if(0<Xe){if(Re.ua=1<<Xe,!Pe(Re.Wa,Xe)){H.a=1,de=0;break e}}else Re.ua=0;var ch=H,Zl=ue,oy=ve,hh=ch.s,dh=hh.xc;if(ch.c=Zl,ch.i=oy,hh.md=_t(Zl,dh),hh.wc=dh==0?-1:(1<<dh)-1,M){H.xb=d;break e}if((Ue=s(ue*ve))==null){H.a=1,de=0;break e}de=(de=hs(H,Ue,0,ue,ve,ve,null))&&!xe.h;break e}return de?(oe!=null?oe[0]=Ue:(e(Ue==null),e(M)),H.$=0,M||ya(Re)):ya(Re),de}function Jr(v,I){var M=v.c*v.i,H=M+I+16*I;return e(v.c<=I),v.V=s(H),v.V==null?(v.Ta=null,v.Ua=0,v.a=1,0):(v.Ta=v.V,v.Ua=v.Ba+M+I,1)}function ro(v,I){var M=v.C,H=I-M,oe=v.V,de=v.Ba+v.c*M;for(e(I<=v.l.o);0<H;){var ue=16<H?16:H,ve=v.l.ma,xe=v.l.width,Re=xe*ue,Ue=ve.ca,Xe=ve.tb+xe*M,Ae=v.Ta,Ge=v.Ua;cs(v,ue,oe,de),co(Ae,Ge,Ue,Xe,Re),Yi(ve,M,M+ue,Ue,Xe,xe),H-=ue,oe+=ue*v.c,M+=ue}e(M==I),v.C=v.Ma=I}function Ms(){this.ub=this.yd=this.td=this.Rb=0}function Fs(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function aa(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function js(){this.Yb=(function(){var v=[];return(function I(M,H,oe){for(var de=oe[H],ue=0;ue<de&&(M.push(oe.length>H+1?[]:0),!(oe.length<H+1));ue++)I(M[ue],H+1,oe)})(v,0,[3,11]),v})()}function hr(){this.jb=s(3),this.Wc=u([4,8],js),this.Xc=u([4,17],js)}function vl(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function Vs(){this.ld=this.La=this.dd=this.tc=0}function va(){this.Na=this.la=0}function Is(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function jo(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function nl(){this.uc=this.M=this.Nb=0,this.wa=Array(new Vs),this.Y=0,this.ya=Array(new jo),this.aa=0,this.l=new Hr}function il(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Vo(){this.cb=this.a=0,this.sc="",this.m=new se,this.Od=new Ms,this.Kc=new Fs,this.ed=new vl,this.Qa=new aa,this.Ic=this.$c=this.Aa=0,this.D=new nl,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=l(8,se),this.ia=0,this.pb=l(4,Is),this.Pa=new hr,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new il),this.Hd=0,this.rb=Array(new va),this.sb=0,this.wa=Array(new Vs),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new jo),this.L=this.aa=0,this.gd=u([4,2],Vs),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function oi(v,I){return 0>v?0:v>I?I:v}function Hr(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function _r(){var v=new Vo;return v!=null&&(v.a=0,v.sc="OK",v.cb=0,v.Xb=0,go||(go=yi)),v}function dn(v,I,M){return v.a==0&&(v.a=I,v.sc=M,v.cb=0),0}function Da(v,I,M){return 3<=M&&v[I+0]==157&&v[I+1]==1&&v[I+2]==42}function zs(v,I){if(v==null)return 0;if(v.a=0,v.sc="OK",I==null)return dn(v,2,"null VP8Io passed to VP8GetHeaders()");var M=I.data,H=I.w,oe=I.ha;if(4>oe)return dn(v,7,"Truncated header.");var de=M[H+0]|M[H+1]<<8|M[H+2]<<16,ue=v.Od;if(ue.Rb=!(1&de),ue.td=de>>1&7,ue.yd=de>>4&1,ue.ub=de>>5,3<ue.td)return dn(v,3,"Incorrect keyframe parameters.");if(!ue.yd)return dn(v,4,"Frame not displayable.");H+=3,oe-=3;var ve=v.Kc;if(ue.Rb){if(7>oe)return dn(v,7,"cannot parse picture header");if(!Da(M,H,oe))return dn(v,3,"Bad code word");ve.c=16383&(M[H+4]<<8|M[H+3]),ve.Td=M[H+4]>>6,ve.i=16383&(M[H+6]<<8|M[H+5]),ve.Ud=M[H+6]>>6,H+=7,oe-=7,v.za=ve.c+15>>4,v.Ub=ve.i+15>>4,I.width=ve.c,I.height=ve.i,I.Da=0,I.j=0,I.v=0,I.va=I.width,I.o=I.height,I.da=0,I.ib=I.width,I.hb=I.height,I.U=I.width,I.T=I.height,r((de=v.Pa).jb,0,255,de.jb.length),e((de=v.Qa)!=null),de.Cb=0,de.Bb=0,de.Fb=1,r(de.Zb,0,0,de.Zb.length),r(de.Lb,0,0,de.Lb)}if(ue.ub>oe)return dn(v,7,"bad partition length");je(de=v.m,M,H,ue.ub),H+=ue.ub,oe-=ue.ub,ue.Rb&&(ve.Ld=ct(de),ve.Kd=ct(de)),ve=v.Qa;var xe,Re=v.Pa;if(e(de!=null),e(ve!=null),ve.Cb=ct(de),ve.Cb){if(ve.Bb=ct(de),ct(de)){for(ve.Fb=ct(de),xe=0;4>xe;++xe)ve.Zb[xe]=ct(de)?qe(de,7):0;for(xe=0;4>xe;++xe)ve.Lb[xe]=ct(de)?qe(de,6):0}if(ve.Bb)for(xe=0;3>xe;++xe)Re.jb[xe]=ct(de)?Je(de,8):255}else ve.Bb=0;if(de.Ka)return dn(v,3,"cannot parse segment header");if((ve=v.ed).zd=ct(de),ve.Tb=Je(de,6),ve.wb=Je(de,3),ve.Pc=ct(de),ve.Pc&&ct(de)){for(Re=0;4>Re;++Re)ct(de)&&(ve.vd[Re]=qe(de,6));for(Re=0;4>Re;++Re)ct(de)&&(ve.od[Re]=qe(de,6))}if(v.L=ve.Tb==0?0:ve.zd?1:2,de.Ka)return dn(v,3,"cannot parse filter header");var Ue=oe;if(oe=xe=H,H=xe+Ue,ve=Ue,v.Xb=(1<<Je(v.m,2))-1,Ue<3*(Re=v.Xb))M=7;else{for(xe+=3*Re,ve-=3*Re,Ue=0;Ue<Re;++Ue){var Xe=M[oe+0]|M[oe+1]<<8|M[oe+2]<<16;Xe>ve&&(Xe=ve),je(v.Jc[+Ue],M,xe,Xe),xe+=Xe,ve-=Xe,oe+=3}je(v.Jc[+Re],M,xe,ve),M=xe<H?0:5}if(M!=0)return dn(v,M,"cannot parse partitions");for(M=Je(xe=v.m,7),oe=ct(xe)?qe(xe,4):0,H=ct(xe)?qe(xe,4):0,ve=ct(xe)?qe(xe,4):0,Re=ct(xe)?qe(xe,4):0,xe=ct(xe)?qe(xe,4):0,Ue=v.Qa,Xe=0;4>Xe;++Xe){if(Ue.Cb){var Ae=Ue.Zb[Xe];Ue.Fb||(Ae+=M)}else{if(0<Xe){v.pb[Xe]=v.pb[0];continue}Ae=M}var Ge=v.pb[Xe];Ge.Sc[0]=po[oi(Ae+oe,127)],Ge.Sc[1]=ko[oi(Ae+0,127)],Ge.Eb[0]=2*po[oi(Ae+H,127)],Ge.Eb[1]=101581*ko[oi(Ae+ve,127)]>>16,8>Ge.Eb[1]&&(Ge.Eb[1]=8),Ge.Qc[0]=po[oi(Ae+Re,117)],Ge.Qc[1]=ko[oi(Ae+xe,127)],Ge.lc=Ae+xe}if(!ue.Rb)return dn(v,4,"Not a key frame.");for(ct(de),ue=v.Pa,M=0;4>M;++M){for(oe=0;8>oe;++oe)for(H=0;3>H;++H)for(ve=0;11>ve;++ve)Re=Et(de,Fr[M][oe][H][ve])?Je(de,8):_d[M][oe][H][ve],ue.Wc[M][oe].Yb[H][ve]=Re;for(oe=0;17>oe;++oe)ue.Xc[M][oe]=ue.Wc[M][bi[oe]]}return v.kc=ct(de),v.kc&&(v.Bd=Je(de,8)),v.cb=1}function yi(v,I,M,H,oe,de,ue){var ve=I[oe].Yb[M];for(M=0;16>oe;++oe){if(!Et(v,ve[M+0]))return oe;for(;!Et(v,ve[M+1]);)if(ve=I[++oe].Yb[0],M=0,oe==16)return 16;var xe=I[oe+1].Yb;if(Et(v,ve[M+2])){var Re=v,Ue=0;if(Et(Re,(Ae=ve)[(Xe=M)+3]))if(Et(Re,Ae[Xe+6])){for(ve=0,Xe=2*(Ue=Et(Re,Ae[Xe+8]))+(Ae=Et(Re,Ae[Xe+9+Ue])),Ue=0,Ae=xc[Xe];Ae[ve];++ve)Ue+=Ue+Et(Re,Ae[ve]);Ue+=3+(8<<Xe)}else Et(Re,Ae[Xe+7])?(Ue=7+2*Et(Re,165),Ue+=Et(Re,145)):Ue=5+Et(Re,159);else Ue=Et(Re,Ae[Xe+4])?3+Et(Re,Ae[Xe+5]):2;ve=xe[2]}else Ue=1,ve=xe[1];xe=ue+vd[oe],0>(Re=v).b&&it(Re);var Xe,Ae=Re.b,Ge=(Xe=Re.Ca>>1)-(Re.I>>Ae)>>31;--Re.b,Re.Ca+=Ge,Re.Ca|=1,Re.I-=(Xe+1&Ge)<<Ae,de[xe]=((Ue^Ge)-Ge)*H[(0<oe)+0]}return 16}function $a(v){var I=v.rb[v.sb-1];I.la=0,I.Na=0,r(v.zc,0,0,v.zc.length),v.ja=0}function ri(v,I,M,H,oe){oe=v[I+M+32*H]+(oe>>3),v[I+M+32*H]=-256&oe?0>oe?0:255:oe}function dr(v,I,M,H,oe,de){ri(v,I,0,M,H+oe),ri(v,I,1,M,H+de),ri(v,I,2,M,H-de),ri(v,I,3,M,H-oe)}function Mr(v){return(20091*v>>16)+v}function zo(v,I,M,H){var oe,de=0,ue=s(16);for(oe=0;4>oe;++oe){var ve=v[I+0]+v[I+8],xe=v[I+0]-v[I+8],Re=(35468*v[I+4]>>16)-Mr(v[I+12]),Ue=Mr(v[I+4])+(35468*v[I+12]>>16);ue[de+0]=ve+Ue,ue[de+1]=xe+Re,ue[de+2]=xe-Re,ue[de+3]=ve-Ue,de+=4,I++}for(oe=de=0;4>oe;++oe)ve=(v=ue[de+0]+4)+ue[de+8],xe=v-ue[de+8],Re=(35468*ue[de+4]>>16)-Mr(ue[de+12]),ri(M,H,0,0,ve+(Ue=Mr(ue[de+4])+(35468*ue[de+12]>>16))),ri(M,H,1,0,xe+Re),ri(M,H,2,0,xe-Re),ri(M,H,3,0,ve-Ue),de++,H+=32}function $l(v,I,M,H){var oe=v[I+0]+4,de=35468*v[I+4]>>16,ue=Mr(v[I+4]),ve=35468*v[I+1]>>16;dr(M,H,0,oe+ue,v=Mr(v[I+1]),ve),dr(M,H,1,oe+de,v,ve),dr(M,H,2,oe-de,v,ve),dr(M,H,3,oe-ue,v,ve)}function Uo(v,I,M,H,oe){zo(v,I,M,H),oe&&zo(v,I+16,M,H+4)}function br(v,I,M,H){Wn(v,I+0,M,H,1),Wn(v,I+32,M,H+128,1)}function _l(v,I,M,H){var oe;for(v=v[I+0]+4,oe=0;4>oe;++oe)for(I=0;4>I;++I)ri(M,H,I,oe,v)}function oa(v,I,M,H){v[I+0]&&Li(v,I+0,M,H),v[I+16]&&Li(v,I+16,M,H+4),v[I+32]&&Li(v,I+32,M,H+128),v[I+48]&&Li(v,I+48,M,H+128+4)}function Mi(v,I,M,H){var oe,de=s(16);for(oe=0;4>oe;++oe){var ue=v[I+0+oe]+v[I+12+oe],ve=v[I+4+oe]+v[I+8+oe],xe=v[I+4+oe]-v[I+8+oe],Re=v[I+0+oe]-v[I+12+oe];de[0+oe]=ue+ve,de[8+oe]=ue-ve,de[4+oe]=Re+xe,de[12+oe]=Re-xe}for(oe=0;4>oe;++oe)ue=(v=de[0+4*oe]+3)+de[3+4*oe],ve=de[1+4*oe]+de[2+4*oe],xe=de[1+4*oe]-de[2+4*oe],Re=v-de[3+4*oe],M[H+0]=ue+ve>>3,M[H+16]=Re+xe>>3,M[H+32]=ue-ve>>3,M[H+48]=Re-xe>>3,H+=64}function so(v,I,M){var H,oe=I-32,de=qs,ue=255-v[oe-1];for(H=0;H<M;++H){var ve,xe=de,Re=ue+v[I-1];for(ve=0;ve<M;++ve)v[I+ve]=xe[Re+v[oe+ve]];I+=32}}function bl(v,I){so(v,I,4)}function xl(v,I){so(v,I,8)}function Bo(v,I){so(v,I,16)}function Ha(v,I){var M;for(M=0;16>M;++M)n(v,I+32*M,v,I-32,16)}function At(v,I){var M;for(M=16;0<M;--M)r(v,I,v[I-1],16),I+=32}function St(v,I,M){var H;for(H=0;16>H;++H)r(I,M+32*H,v,16)}function fn(v,I){var M,H=16;for(M=0;16>M;++M)H+=v[I-1+32*M]+v[I+M-32];St(H>>5,v,I)}function ui(v,I){var M,H=8;for(M=0;16>M;++M)H+=v[I-1+32*M];St(H>>4,v,I)}function Xi(v,I){var M,H=8;for(M=0;16>M;++M)H+=v[I+M-32];St(H>>4,v,I)}function vi(v,I){St(128,v,I)}function Qt(v,I,M){return v+2*I+M+2>>2}function xs(v,I){var M,H=I-32;for(H=new Uint8Array([Qt(v[H-1],v[H+0],v[H+1]),Qt(v[H+0],v[H+1],v[H+2]),Qt(v[H+1],v[H+2],v[H+3]),Qt(v[H+2],v[H+3],v[H+4])]),M=0;4>M;++M)n(v,I+32*M,H,0,H.length)}function _a(v,I){var M=v[I-1],H=v[I-1+32],oe=v[I-1+64],de=v[I-1+96];Ft(v,I+0,16843009*Qt(v[I-1-32],M,H)),Ft(v,I+32,16843009*Qt(M,H,oe)),Ft(v,I+64,16843009*Qt(H,oe,de)),Ft(v,I+96,16843009*Qt(oe,de,de))}function Us(v,I){var M,H=4;for(M=0;4>M;++M)H+=v[I+M-32]+v[I-1+32*M];for(H>>=3,M=0;4>M;++M)r(v,I+32*M,H,4)}function Er(v,I){var M=v[I-1+0],H=v[I-1+32],oe=v[I-1+64],de=v[I-1-32],ue=v[I+0-32],ve=v[I+1-32],xe=v[I+2-32],Re=v[I+3-32];v[I+0+96]=Qt(H,oe,v[I-1+96]),v[I+1+96]=v[I+0+64]=Qt(M,H,oe),v[I+2+96]=v[I+1+64]=v[I+0+32]=Qt(de,M,H),v[I+3+96]=v[I+2+64]=v[I+1+32]=v[I+0+0]=Qt(ue,de,M),v[I+3+64]=v[I+2+32]=v[I+1+0]=Qt(ve,ue,de),v[I+3+32]=v[I+2+0]=Qt(xe,ve,ue),v[I+3+0]=Qt(Re,xe,ve)}function Ai(v,I){var M=v[I+1-32],H=v[I+2-32],oe=v[I+3-32],de=v[I+4-32],ue=v[I+5-32],ve=v[I+6-32],xe=v[I+7-32];v[I+0+0]=Qt(v[I+0-32],M,H),v[I+1+0]=v[I+0+32]=Qt(M,H,oe),v[I+2+0]=v[I+1+32]=v[I+0+64]=Qt(H,oe,de),v[I+3+0]=v[I+2+32]=v[I+1+64]=v[I+0+96]=Qt(oe,de,ue),v[I+3+32]=v[I+2+64]=v[I+1+96]=Qt(de,ue,ve),v[I+3+64]=v[I+2+96]=Qt(ue,ve,xe),v[I+3+96]=Qt(ve,xe,xe)}function ba(v,I){var M=v[I-1+0],H=v[I-1+32],oe=v[I-1+64],de=v[I-1-32],ue=v[I+0-32],ve=v[I+1-32],xe=v[I+2-32],Re=v[I+3-32];v[I+0+0]=v[I+1+64]=de+ue+1>>1,v[I+1+0]=v[I+2+64]=ue+ve+1>>1,v[I+2+0]=v[I+3+64]=ve+xe+1>>1,v[I+3+0]=xe+Re+1>>1,v[I+0+96]=Qt(oe,H,M),v[I+0+64]=Qt(H,M,de),v[I+0+32]=v[I+1+96]=Qt(M,de,ue),v[I+1+32]=v[I+2+96]=Qt(de,ue,ve),v[I+2+32]=v[I+3+96]=Qt(ue,ve,xe),v[I+3+32]=Qt(ve,xe,Re)}function Ci(v,I){var M=v[I+0-32],H=v[I+1-32],oe=v[I+2-32],de=v[I+3-32],ue=v[I+4-32],ve=v[I+5-32],xe=v[I+6-32],Re=v[I+7-32];v[I+0+0]=M+H+1>>1,v[I+1+0]=v[I+0+64]=H+oe+1>>1,v[I+2+0]=v[I+1+64]=oe+de+1>>1,v[I+3+0]=v[I+2+64]=de+ue+1>>1,v[I+0+32]=Qt(M,H,oe),v[I+1+32]=v[I+0+96]=Qt(H,oe,de),v[I+2+32]=v[I+1+96]=Qt(oe,de,ue),v[I+3+32]=v[I+2+96]=Qt(de,ue,ve),v[I+3+64]=Qt(ue,ve,xe),v[I+3+96]=Qt(ve,xe,Re)}function Bs(v,I){var M=v[I-1+0],H=v[I-1+32],oe=v[I-1+64],de=v[I-1+96];v[I+0+0]=M+H+1>>1,v[I+2+0]=v[I+0+32]=H+oe+1>>1,v[I+2+32]=v[I+0+64]=oe+de+1>>1,v[I+1+0]=Qt(M,H,oe),v[I+3+0]=v[I+1+32]=Qt(H,oe,de),v[I+3+32]=v[I+1+64]=Qt(oe,de,de),v[I+3+64]=v[I+2+64]=v[I+0+96]=v[I+1+96]=v[I+2+96]=v[I+3+96]=de}function Ga(v,I){var M=v[I-1+0],H=v[I-1+32],oe=v[I-1+64],de=v[I-1+96],ue=v[I-1-32],ve=v[I+0-32],xe=v[I+1-32],Re=v[I+2-32];v[I+0+0]=v[I+2+32]=M+ue+1>>1,v[I+0+32]=v[I+2+64]=H+M+1>>1,v[I+0+64]=v[I+2+96]=oe+H+1>>1,v[I+0+96]=de+oe+1>>1,v[I+3+0]=Qt(ve,xe,Re),v[I+2+0]=Qt(ue,ve,xe),v[I+1+0]=v[I+3+32]=Qt(M,ue,ve),v[I+1+32]=v[I+3+64]=Qt(H,M,ue),v[I+1+64]=v[I+3+96]=Qt(oe,H,M),v[I+1+96]=Qt(de,oe,H)}function $s(v,I){var M;for(M=0;8>M;++M)n(v,I+32*M,v,I-32,8)}function gn(v,I){var M;for(M=0;8>M;++M)r(v,I,v[I-1],8),I+=32}function ks(v,I,M){var H;for(H=0;8>H;++H)r(I,M+32*H,v,8)}function La(v,I){var M,H=8;for(M=0;8>M;++M)H+=v[I+M-32]+v[I-1+32*M];ks(H>>4,v,I)}function Ir(v,I){var M,H=4;for(M=0;8>M;++M)H+=v[I+M-32];ks(H>>3,v,I)}function kr(v,I){var M,H=4;for(M=0;8>M;++M)H+=v[I-1+32*M];ks(H>>3,v,I)}function Hs(v,I){ks(128,v,I)}function xr(v,I,M){var H=v[I-M],oe=v[I+0],de=3*(oe-H)+ho[1020+v[I-2*M]-v[I+M]],ue=El[112+(de+4>>3)];v[I-M]=qs[255+H+El[112+(de+3>>3)]],v[I+0]=qs[255+oe-ue]}function Gs(v,I,M,H){var oe=v[I+0],de=v[I+M];return Ys[255+v[I-2*M]-v[I-M]]>H||Ys[255+de-oe]>H}function Ka(v,I,M,H){return 4*Ys[255+v[I-M]-v[I+0]]+Ys[255+v[I-2*M]-v[I+M]]<=H}function Gr(v,I,M,H,oe){var de=v[I-3*M],ue=v[I-2*M],ve=v[I-M],xe=v[I+0],Re=v[I+M],Ue=v[I+2*M],Xe=v[I+3*M];return 4*Ys[255+ve-xe]+Ys[255+ue-Re]>H?0:Ys[255+v[I-4*M]-de]<=oe&&Ys[255+de-ue]<=oe&&Ys[255+ue-ve]<=oe&&Ys[255+Xe-Ue]<=oe&&Ys[255+Ue-Re]<=oe&&Ys[255+Re-xe]<=oe}function Wa(v,I,M,H){var oe=2*H+1;for(H=0;16>H;++H)Ka(v,I+H,M,oe)&&xr(v,I+H,M)}function fs(v,I,M,H){var oe=2*H+1;for(H=0;16>H;++H)Ka(v,I+H*M,1,oe)&&xr(v,I+H*M,1)}function ao(v,I,M,H){var oe;for(oe=3;0<oe;--oe)Wa(v,I+=4*M,M,H)}function To(v,I,M,H){var oe;for(oe=3;0<oe;--oe)fs(v,I+=4,M,H)}function Ks(v,I,M,H,oe,de,ue,ve){for(de=2*de+1;0<oe--;){if(Gr(v,I,M,de,ue))if(Gs(v,I,M,ve))xr(v,I,M);else{var xe=v,Re=I,Ue=M,Xe=xe[Re-2*Ue],Ae=xe[Re-Ue],Ge=xe[Re+0],et=xe[Re+Ue],ot=xe[Re+2*Ue],Ze=27*(wt=ho[1020+3*(Ge-Ae)+ho[1020+Xe-et]])+63>>7,gt=18*wt+63>>7,wt=9*wt+63>>7;xe[Re-3*Ue]=qs[255+xe[Re-3*Ue]+wt],xe[Re-2*Ue]=qs[255+Xe+gt],xe[Re-Ue]=qs[255+Ae+Ze],xe[Re+0]=qs[255+Ge-Ze],xe[Re+Ue]=qs[255+et-gt],xe[Re+2*Ue]=qs[255+ot-wt]}I+=H}}function on(v,I,M,H,oe,de,ue,ve){for(de=2*de+1;0<oe--;){if(Gr(v,I,M,de,ue))if(Gs(v,I,M,ve))xr(v,I,M);else{var xe=v,Re=I,Ue=M,Xe=xe[Re-Ue],Ae=xe[Re+0],Ge=xe[Re+Ue],et=El[112+(4+(ot=3*(Ae-Xe))>>3)],ot=El[112+(ot+3>>3)],Ze=et+1>>1;xe[Re-2*Ue]=qs[255+xe[Re-2*Ue]+Ze],xe[Re-Ue]=qs[255+Xe+ot],xe[Re+0]=qs[255+Ae-et],xe[Re+Ue]=qs[255+Ge-Ze]}I+=H}}function Di(v,I,M,H,oe,de){Ks(v,I,M,1,16,H,oe,de)}function Cr(v,I,M,H,oe,de){Ks(v,I,1,M,16,H,oe,de)}function la(v,I,M,H,oe,de){var ue;for(ue=3;0<ue;--ue)on(v,I+=4*M,M,1,16,H,oe,de)}function j(v,I,M,H,oe,de){var ue;for(ue=3;0<ue;--ue)on(v,I+=4,1,M,16,H,oe,de)}function fe(v,I,M,H,oe,de,ue,ve){Ks(v,I,oe,1,8,de,ue,ve),Ks(M,H,oe,1,8,de,ue,ve)}function Oe(v,I,M,H,oe,de,ue,ve){Ks(v,I,1,oe,8,de,ue,ve),Ks(M,H,1,oe,8,de,ue,ve)}function We(v,I,M,H,oe,de,ue,ve){on(v,I+4*oe,oe,1,8,de,ue,ve),on(M,H+4*oe,oe,1,8,de,ue,ve)}function tt(v,I,M,H,oe,de,ue,ve){on(v,I+4,1,oe,8,de,ue,ve),on(M,H+4,1,oe,8,de,ue,ve)}function It(){this.ba=new tn,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Kn,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Mt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ln(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function mn(){this.ua=0,this.Wa=new Pt,this.vb=new Pt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new nt,this.yc=new le}function Vn(){this.xb=this.a=0,this.l=new Hr,this.ca=new tn,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Ee,this.Pb=0,this.wd=new Ee,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new mn,this.ab=0,this.gc=l(4,ln),this.Oc=0}function Rn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Hr,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ei(v,I,M,H,oe,de,ue){for(v=v==null?0:v[I+0],I=0;I<ue;++I)oe[de+I]=v+M[H+I]&255,v=oe[de+I]}function Rr(v,I,M,H,oe,de,ue){var ve;if(v==null)Ei(null,null,M,H,oe,de,ue);else for(ve=0;ve<ue;++ve)oe[de+ve]=v[I+ve]+M[H+ve]&255}function fr(v,I,M,H,oe,de,ue){if(v==null)Ei(null,null,M,H,oe,de,ue);else{var ve,xe=v[I+0],Re=xe,Ue=xe;for(ve=0;ve<ue;++ve)Re=Ue+(xe=v[I+ve])-Re,Ue=M[H+ve]+(-256&Re?0>Re?0:255:Re)&255,Re=xe,oe[de+ve]=Ue}}function E(v,I,M,H){var oe=I.width,de=I.o;if(e(v!=null&&I!=null),0>M||0>=H||M+H>de)return null;if(!v.Cc){if(v.ga==null){var ue;if(v.ga=new Rn,(ue=v.ga==null)||(ue=I.width*I.o,e(v.Gb.length==0),v.Gb=s(ue),v.Uc=0,v.Gb==null?ue=0:(v.mb=v.Gb,v.nb=v.Uc,v.rc=null,ue=1),ue=!ue),!ue){ue=v.ga;var ve=v.Fa,xe=v.P,Re=v.qc,Ue=v.mb,Xe=v.nb,Ae=xe+1,Ge=Re-1,et=ue.l;if(e(ve!=null&&Ue!=null&&I!=null),y[0]=null,y[1]=Ei,y[2]=Rr,y[3]=fr,ue.ca=Ue,ue.tb=Xe,ue.c=I.width,ue.i=I.height,e(0<ue.c&&0<ue.i),1>=Re)I=0;else if(ue.$a=3&ve[xe+0],ue.Z=ve[xe+0]>>2&3,ue.Lc=ve[xe+0]>>4&3,xe=ve[xe+0]>>6&3,0>ue.$a||1<ue.$a||4<=ue.Z||1<ue.Lc||xe)I=0;else if(et.put=pn,et.ac=Ri,et.bc=Ra,et.ma=ue,et.width=I.width,et.height=I.height,et.Da=I.Da,et.v=I.v,et.va=I.va,et.j=I.j,et.o=I.o,ue.$a)e:{e(ue.$a==1),I=Ba();t:for(;;){if(I==null){I=0;break e}if(e(ue!=null),ue.mc=I,I.c=ue.c,I.i=ue.i,I.l=ue.l,I.l.ma=ue,I.l.width=ue.c,I.l.height=ue.i,I.a=0,lt(I.m,ve,Ae,Ge),!ds(ue.c,ue.i,1,I,null)||(I.ab==1&&I.gc[0].hc==3&&qi(I.s)?(ue.ic=1,ve=I.c*I.i,I.Ta=null,I.Ua=0,I.V=s(ve),I.Ba=0,I.V==null?(I.a=1,I=0):I=1):(ue.ic=0,I=Jr(I,ue.c)),!I))break t;I=1;break e}ue.mc=null,I=0}else I=Ge>=ue.c*ue.i;ue=!I}if(ue)return null;v.ga.Lc!=1?v.Ga=0:H=de-M}e(v.ga!=null),e(M+H<=de);e:{if(I=(ve=v.ga).c,de=ve.l.o,ve.$a==0){if(Ae=v.rc,Ge=v.Vc,et=v.Fa,xe=v.P+1+M*I,Re=v.mb,Ue=v.nb+M*I,e(xe<=v.P+v.qc),ve.Z!=0)for(e(y[ve.Z]!=null),ue=0;ue<H;++ue)y[ve.Z](Ae,Ge,et,xe,Re,Ue,I),Ae=Re,Ge=Ue,Ue+=I,xe+=I;else for(ue=0;ue<H;++ue)n(Re,Ue,et,xe,I),Ae=Re,Ge=Ue,Ue+=I,xe+=I;v.rc=Ae,v.Vc=Ge}else{if(e(ve.mc!=null),I=M+H,e((ue=ve.mc)!=null),e(I<=ue.i),ue.C>=I)I=1;else if(ve.ic||ft(),ve.ic){ve=ue.V,Ae=ue.Ba,Ge=ue.c;var ot=ue.i,Ze=(et=1,xe=ue.$/Ge,Re=ue.$%Ge,Ue=ue.m,Xe=ue.s,ue.$),gt=Ge*ot,wt=Ge*I,Nt=Xe.wc,ht=Ze<wt?cr(Xe,Re,xe):null;e(Ze<=gt),e(I<=ot),e(qi(Xe));t:for(;;){for(;!Ue.h&&Ze<wt;){if(Re&Nt||(ht=cr(Xe,Re,xe)),e(ht!=null),Ye(Ue),256>(ot=Oi(ht.G[0],ht.H[0],Ue)))ve[Ae+Ze]=ot,++Ze,++Re>=Ge&&(Re=0,++xe<=I&&!(xe%16)&&Xr(ue,xe));else{if(!(280>ot)){et=0;break t}ot=Or(ot-256,Ue);var Ut,Bt=Oi(ht.G[4],ht.H[4],Ue);if(Ye(Ue),!(Ze>=(Bt=bs(Ge,Bt=Or(Bt,Ue)))&&gt-Ze>=ot)){et=0;break t}for(Ut=0;Ut<ot;++Ut)ve[Ae+Ze+Ut]=ve[Ae+Ze+Ut-Bt];for(Ze+=ot,Re+=ot;Re>=Ge;)Re-=Ge,++xe<=I&&!(xe%16)&&Xr(ue,xe);Ze<wt&&Re&Nt&&(ht=cr(Xe,Re,xe))}e(Ue.h==Be(Ue))}Xr(ue,xe>I?I:xe);break t}!et||Ue.h&&Ze<gt?(et=0,ue.a=Ue.h?5:3):ue.$=Ze,I=et}else I=hs(ue,ue.V,ue.Ba,ue.c,ue.i,I,ro);if(!I){H=0;break e}}M+H>=de&&(v.Cc=1),H=1}if(!H)return null;if(v.Cc&&((H=v.ga)!=null&&(H.mc=null),v.ga=null,0<v.Ga))return alert("todo:WebPDequantizeLevels"),null}return v.nb+M*oe}function K(v,I,M,H,oe,de){for(;0<oe--;){var ue,ve=v,xe=I+(M?1:0),Re=v,Ue=I+(M?0:3);for(ue=0;ue<H;++ue){var Xe=Re[Ue+4*ue];Xe!=255&&(Xe*=32897,ve[xe+4*ue+0]=ve[xe+4*ue+0]*Xe>>23,ve[xe+4*ue+1]=ve[xe+4*ue+1]*Xe>>23,ve[xe+4*ue+2]=ve[xe+4*ue+2]*Xe>>23)}I+=de}}function ne(v,I,M,H,oe){for(;0<H--;){var de;for(de=0;de<M;++de){var ue=v[I+2*de+0],ve=15&(Re=v[I+2*de+1]),xe=4369*ve,Re=(240&Re|Re>>4)*xe>>16;v[I+2*de+0]=(240&ue|ue>>4)*xe>>16&240|(15&ue|ue<<4)*xe>>16>>4&15,v[I+2*de+1]=240&Re|ve}I+=oe}}function Ie(v,I,M,H,oe,de,ue,ve){var xe,Re,Ue=255;for(Re=0;Re<oe;++Re){for(xe=0;xe<H;++xe){var Xe=v[I+xe];de[ue+4*xe]=Xe,Ue&=Xe}I+=M,ue+=ve}return Ue!=255}function at(v,I,M,H,oe){var de;for(de=0;de<oe;++de)M[H+de]=v[I+de]>>8}function ft(){gu=K,Ao=ne,Kl=Ie,co=at}function Vt(v,I,M){J[v]=function(H,oe,de,ue,ve,xe,Re,Ue,Xe,Ae,Ge,et,ot,Ze,gt,wt,Nt){var ht,Ut=Nt-1>>1,Bt=ve[xe+0]|Re[Ue+0]<<16,In=Xe[Ae+0]|Ge[et+0]<<16;e(H!=null);var nn=3*Bt+In+131074>>2;for(I(H[oe+0],255&nn,nn>>16,ot,Ze),de!=null&&(nn=3*In+Bt+131074>>2,I(de[ue+0],255&nn,nn>>16,gt,wt)),ht=1;ht<=Ut;++ht){var xi=ve[xe+ht]|Re[Ue+ht]<<16,Ui=Xe[Ae+ht]|Ge[et+ht]<<16,si=Bt+xi+In+Ui+524296,sn=si+2*(xi+In)>>3;nn=sn+Bt>>1,Bt=(si=si+2*(Bt+Ui)>>3)+xi>>1,I(H[oe+2*ht-1],255&nn,nn>>16,ot,Ze+(2*ht-1)*M),I(H[oe+2*ht-0],255&Bt,Bt>>16,ot,Ze+(2*ht-0)*M),de!=null&&(nn=si+In>>1,Bt=sn+Ui>>1,I(de[ue+2*ht-1],255&nn,nn>>16,gt,wt+(2*ht-1)*M),I(de[ue+2*ht+0],255&Bt,Bt>>16,gt,wt+(2*ht+0)*M)),Bt=xi,In=Ui}1&Nt||(nn=3*Bt+In+131074>>2,I(H[oe+Nt-1],255&nn,nn>>16,ot,Ze+(Nt-1)*M),de!=null&&(nn=3*In+Bt+131074>>2,I(de[ue+Nt-1],255&nn,nn>>16,gt,wt+(Nt-1)*M)))}}function Zn(){N[mc]=D,N[ha]=z,N[yc]=F,N[fo]=P,N[Wl]=k,N[Vu]=R,N[Il]=S,N[zu]=z,N[vc]=P,N[_u]=k,N[_c]=R}function lr(v){return v&-16384?0>v?0:255:v>>ie}function ci(v,I){return lr((19077*v>>8)+(26149*I>>8)-14234)}function rr(v,I,M){return lr((19077*v>>8)-(6419*I>>8)-(13320*M>>8)+8708)}function Ws(v,I){return lr((19077*v>>8)+(33050*I>>8)-17685)}function ua(v,I,M,H,oe){H[oe+0]=ci(v,M),H[oe+1]=rr(v,I,M),H[oe+2]=Ws(v,I)}function wr(v,I,M,H,oe){H[oe+0]=Ws(v,I),H[oe+1]=rr(v,I,M),H[oe+2]=ci(v,M)}function ca(v,I,M,H,oe){var de=rr(v,I,M);I=de<<3&224|Ws(v,I)>>3,H[oe+0]=248&ci(v,M)|de>>5,H[oe+1]=I}function qa(v,I,M,H,oe){var de=240&Ws(v,I)|15;H[oe+0]=240&ci(v,M)|rr(v,I,M)>>4,H[oe+1]=de}function $o(v,I,M,H,oe){H[oe+0]=255,ua(v,I,M,H,oe+1)}function rl(v,I,M,H,oe){wr(v,I,M,H,oe),H[oe+3]=255}function xa(v,I,M,H,oe){ua(v,I,M,H,oe),H[oe+3]=255}function wl(v,I,M){J[v]=function(H,oe,de,ue,ve,xe,Re,Ue,Xe){for(var Ae=Ue+(-2&Xe)*M;Ue!=Ae;)I(H[oe+0],de[ue+0],ve[xe+0],Re,Ue),I(H[oe+1],de[ue+0],ve[xe+0],Re,Ue+M),oe+=2,++ue,++xe,Ue+=2*M;1&Xe&&I(H[oe+0],de[ue+0],ve[xe+0],Re,Ue)}}function Mu(v,I,M){return M==0?v==0?I==0?6:5:I==0?4:0:M}function hc(v,I,M,H,oe){switch(v>>>30){case 3:Wn(I,M,H,oe,0);break;case 2:Ii(I,M,H,oe);break;case 1:Li(I,M,H,oe)}}function oo(v,I){var M,H,oe=I.M,de=I.Nb,ue=v.oc,ve=v.pc+40,xe=v.oc,Re=v.pc+584,Ue=v.oc,Xe=v.pc+600;for(M=0;16>M;++M)ue[ve+32*M-1]=129;for(M=0;8>M;++M)xe[Re+32*M-1]=129,Ue[Xe+32*M-1]=129;for(0<oe?ue[ve-1-32]=xe[Re-1-32]=Ue[Xe-1-32]=129:(r(ue,ve-32-1,127,21),r(xe,Re-32-1,127,9),r(Ue,Xe-32-1,127,9)),H=0;H<v.za;++H){var Ae=I.ya[I.aa+H];if(0<H){for(M=-1;16>M;++M)n(ue,ve+32*M-4,ue,ve+32*M+12,4);for(M=-1;8>M;++M)n(xe,Re+32*M-4,xe,Re+32*M+4,4),n(Ue,Xe+32*M-4,Ue,Xe+32*M+4,4)}var Ge=v.Gd,et=v.Hd+H,ot=Ae.ad,Ze=Ae.Hc;if(0<oe&&(n(ue,ve-32,Ge[et].y,0,16),n(xe,Re-32,Ge[et].f,0,8),n(Ue,Xe-32,Ge[et].ea,0,8)),Ae.Za){var gt=ue,wt=ve-32+16;for(0<oe&&(H>=v.za-1?r(gt,wt,Ge[et].y[15],4):n(gt,wt,Ge[et+1].y,0,4)),M=0;4>M;M++)gt[wt+128+M]=gt[wt+256+M]=gt[wt+384+M]=gt[wt+0+M];for(M=0;16>M;++M,Ze<<=2)gt=ue,wt=ve+Q[M],rs[Ae.Ob[M]](gt,wt),hc(Ze,ot,16*+M,gt,wt)}else if(gt=Mu(H,oe,Ae.Ob[0]),Pa[gt](ue,ve),Ze!=0)for(M=0;16>M;++M,Ze<<=2)hc(Ze,ot,16*+M,ue,ve+Q[M]);for(M=Ae.Gc,gt=Mu(H,oe,Ae.Dd),O[gt](xe,Re),O[gt](Ue,Xe),Ze=ot,gt=xe,wt=Re,255&(Ae=0|M)&&(170&Ae?is(Ze,256,gt,wt):zi(Ze,256,gt,wt)),Ae=Ue,Ze=Xe,255&(M>>=8)&&(170&M?is(ot,320,Ae,Ze):zi(ot,320,Ae,Ze)),oe<v.Ub-1&&(n(Ge[et].y,0,ue,ve+480,16),n(Ge[et].f,0,xe,Re+224,8),n(Ge[et].ea,0,Ue,Xe+224,8)),M=8*de*v.B,Ge=v.sa,et=v.ta+16*H+16*de*v.R,ot=v.qa,Ae=v.ra+8*H+M,Ze=v.Ha,gt=v.Ia+8*H+M,M=0;16>M;++M)n(Ge,et+M*v.R,ue,ve+32*M,16);for(M=0;8>M;++M)n(ot,Ae+M*v.B,xe,Re+32*M,8),n(Ze,gt+M*v.B,Ue,Xe+32*M,8)}}function Ho(v,I,M,H,oe,de,ue,ve,xe){var Re=[0],Ue=[0],Xe=0,Ae=xe!=null?xe.kd:0,Ge=xe??new Mt;if(v==null||12>M)return 7;Ge.data=v,Ge.w=I,Ge.ha=M,I=[I],M=[M],Ge.gb=[Ge.gb];e:{var et=I,ot=M,Ze=Ge.gb;if(e(v!=null),e(ot!=null),e(Ze!=null),Ze[0]=0,12<=ot[0]&&!t(v,et[0],"RIFF")){if(t(v,et[0]+8,"WEBP")){Ze=3;break e}var gt=kt(v,et[0]+4);if(12>gt||4294967286<gt){Ze=3;break e}if(Ae&&gt>ot[0]-8){Ze=7;break e}Ze[0]=gt,et[0]+=12,ot[0]-=12}Ze=0}if(Ze!=0)return Ze;for(gt=0<Ge.gb[0],M=M[0];;){e:{var wt=v;ot=I,Ze=M;var Nt=Re,ht=Ue,Ut=et=[0];if((nn=Xe=[Xe])[0]=0,8>Ze[0])Ze=7;else{if(!t(wt,ot[0],"VP8X")){if(kt(wt,ot[0]+4)!=10){Ze=3;break e}if(18>Ze[0]){Ze=7;break e}var Bt=kt(wt,ot[0]+8),In=1+qt(wt,ot[0]+12);if(2147483648<=In*(wt=1+qt(wt,ot[0]+15))){Ze=3;break e}Ut!=null&&(Ut[0]=Bt),Nt!=null&&(Nt[0]=In),ht!=null&&(ht[0]=wt),ot[0]+=18,Ze[0]-=18,nn[0]=1}Ze=0}}if(Xe=Xe[0],et=et[0],Ze!=0)return Ze;if(ot=!!(2&et),!gt&&Xe)return 3;if(de!=null&&(de[0]=!!(16&et)),ue!=null&&(ue[0]=ot),ve!=null&&(ve[0]=0),ue=Re[0],et=Ue[0],Xe&&ot&&xe==null){Ze=0;break}if(4>M){Ze=7;break}if(gt&&Xe||!gt&&!Xe&&!t(v,I[0],"ALPH")){M=[M],Ge.na=[Ge.na],Ge.P=[Ge.P],Ge.Sa=[Ge.Sa];e:{Bt=v,Ze=I,gt=M;var nn=Ge.gb;Nt=Ge.na,ht=Ge.P,Ut=Ge.Sa,In=22,e(Bt!=null),e(gt!=null),wt=Ze[0];var xi=gt[0];for(e(Nt!=null),e(Ut!=null),Nt[0]=null,ht[0]=null,Ut[0]=0;;){if(Ze[0]=wt,gt[0]=xi,8>xi){Ze=7;break e}var Ui=kt(Bt,wt+4);if(4294967286<Ui){Ze=3;break e}var si=8+Ui+1&-2;if(In+=si,0<nn&&In>nn){Ze=3;break e}if(!t(Bt,wt,"VP8 ")||!t(Bt,wt,"VP8L")){Ze=0;break e}if(xi[0]<si){Ze=7;break e}t(Bt,wt,"ALPH")||(Nt[0]=Bt,ht[0]=wt+8,Ut[0]=Ui),wt+=si,xi-=si}}if(M=M[0],Ge.na=Ge.na[0],Ge.P=Ge.P[0],Ge.Sa=Ge.Sa[0],Ze!=0)break}M=[M],Ge.Ja=[Ge.Ja],Ge.xa=[Ge.xa];e:if(nn=v,Ze=I,gt=M,Nt=Ge.gb[0],ht=Ge.Ja,Ut=Ge.xa,Bt=Ze[0],wt=!t(nn,Bt,"VP8 "),In=!t(nn,Bt,"VP8L"),e(nn!=null),e(gt!=null),e(ht!=null),e(Ut!=null),8>gt[0])Ze=7;else{if(wt||In){if(nn=kt(nn,Bt+4),12<=Nt&&nn>Nt-12){Ze=3;break e}if(Ae&&nn>gt[0]-8){Ze=7;break e}ht[0]=nn,Ze[0]+=8,gt[0]-=8,Ut[0]=In}else Ut[0]=5<=gt[0]&&nn[Bt+0]==47&&!(nn[Bt+4]>>5),ht[0]=gt[0];Ze=0}if(M=M[0],Ge.Ja=Ge.Ja[0],Ge.xa=Ge.xa[0],I=I[0],Ze!=0)break;if(4294967286<Ge.Ja)return 3;if(ve==null||ot||(ve[0]=Ge.xa?2:1),ue=[ue],et=[et],Ge.xa){if(5>M){Ze=7;break}ve=ue,Ae=et,ot=de,v==null||5>M?v=0:5<=M&&v[I+0]==47&&!(v[I+4]>>5)?(gt=[0],nn=[0],Nt=[0],lt(ht=new Ee,v,I,M),sa(ht,gt,nn,Nt)?(ve!=null&&(ve[0]=gt[0]),Ae!=null&&(Ae[0]=nn[0]),ot!=null&&(ot[0]=Nt[0]),v=1):v=0):v=0}else{if(10>M){Ze=7;break}ve=et,v==null||10>M||!Da(v,I+3,M-3)?v=0:(Ae=v[I+0]|v[I+1]<<8|v[I+2]<<16,ot=16383&(v[I+7]<<8|v[I+6]),v=16383&(v[I+9]<<8|v[I+8]),1&Ae||3<(Ae>>1&7)||!(Ae>>4&1)||Ae>>5>=Ge.Ja||!ot||!v?v=0:(ue&&(ue[0]=ot),ve&&(ve[0]=v),v=1))}if(!v||(ue=ue[0],et=et[0],Xe&&(Re[0]!=ue||Ue[0]!=et)))return 3;xe!=null&&(xe[0]=Ge,xe.offset=I-xe.w,e(4294967286>I-xe.w),e(xe.offset==xe.ha-M));break}return Ze==0||Ze==7&&Xe&&xe==null?(de!=null&&(de[0]|=Ge.na!=null&&0<Ge.na.length),H!=null&&(H[0]=ue),oe!=null&&(oe[0]=et),0):Ze}function Sl(v,I,M){var H=I.width,oe=I.height,de=0,ue=0,ve=H,xe=oe;if(I.Da=v!=null&&0<v.Da,I.Da&&(ve=v.cd,xe=v.bd,de=v.v,ue=v.j,11>M||(de&=-2,ue&=-2),0>de||0>ue||0>=ve||0>=xe||de+ve>H||ue+xe>oe))return 0;if(I.v=de,I.j=ue,I.va=de+ve,I.o=ue+xe,I.U=ve,I.T=xe,I.da=v!=null&&0<v.da,I.da){if(!Tn(ve,xe,M=[v.ib],de=[v.hb]))return 0;I.ib=M[0],I.hb=de[0]}return I.ob=v!=null&&v.ob,I.Kb=v==null||!v.Sd,I.da&&(I.ob=I.ib<3*H/4&&I.hb<3*oe/4,I.Kb=0),1}function dc(v){if(v==null)return 2;if(11>v.S){var I=v.f.RGBA;I.fb+=(v.height-1)*I.A,I.A=-I.A}else I=v.f.kb,v=v.height,I.O+=(v-1)*I.fa,I.fa=-I.fa,I.N+=(v-1>>1)*I.Ab,I.Ab=-I.Ab,I.W+=(v-1>>1)*I.Db,I.Db=-I.Db,I.F!=null&&(I.J+=(v-1)*I.lb,I.lb=-I.lb);return 0}function Go(v,I,M,H){if(H==null||0>=v||0>=I)return 2;if(M!=null){if(M.Da){var oe=M.cd,de=M.bd,ue=-2&M.v,ve=-2&M.j;if(0>ue||0>ve||0>=oe||0>=de||ue+oe>v||ve+de>I)return 2;v=oe,I=de}if(M.da){if(!Tn(v,I,oe=[M.ib],de=[M.hb]))return 2;v=oe[0],I=de[0]}}H.width=v,H.height=I;e:{var xe=H.width,Re=H.height;if(v=H.S,0>=xe||0>=Re||!(v>=mc&&13>v))v=2;else{if(0>=H.Rd&&H.sd==null){ue=de=oe=I=0;var Ue=(ve=xe*bt[v])*Re;if(11>v||(de=(Re+1)/2*(I=(xe+1)/2),v==12&&(ue=(oe=xe)*Re)),(Re=s(Ue+2*de+ue))==null){v=1;break e}H.sd=Re,11>v?((xe=H.f.RGBA).eb=Re,xe.fb=0,xe.A=ve,xe.size=Ue):((xe=H.f.kb).y=Re,xe.O=0,xe.fa=ve,xe.Fd=Ue,xe.f=Re,xe.N=0+Ue,xe.Ab=I,xe.Cd=de,xe.ea=Re,xe.W=0+Ue+de,xe.Db=I,xe.Ed=de,v==12&&(xe.F=Re,xe.J=0+Ue+2*de),xe.Tc=ue,xe.lb=oe)}if(I=1,oe=H.S,de=H.width,ue=H.height,oe>=mc&&13>oe)if(11>oe)v=H.f.RGBA,I&=(ve=Math.abs(v.A))*(ue-1)+de<=v.size,I&=ve>=de*bt[oe],I&=v.eb!=null;else{v=H.f.kb,ve=(de+1)/2,Ue=(ue+1)/2,xe=Math.abs(v.fa),Re=Math.abs(v.Ab);var Xe=Math.abs(v.Db),Ae=Math.abs(v.lb),Ge=Ae*(ue-1)+de;I&=xe*(ue-1)+de<=v.Fd,I&=Re*(Ue-1)+ve<=v.Cd,I=(I&=Xe*(Ue-1)+ve<=v.Ed)&xe>=de&Re>=ve&Xe>=ve,I&=v.y!=null,I&=v.f!=null,I&=v.ea!=null,oe==12&&(I&=Ae>=de,I&=Ge<=v.Tc,I&=v.F!=null)}else I=0;v=I?0:2}}return v!=0||M!=null&&M.fd&&(v=dc(H)),v}var Hl=64,Ya=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Na=24,Ko=32,sl=8,al=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Jt("Predictor0","PredictorAdd0"),J.Predictor0=function(){return 4278190080},J.Predictor1=function(v){return v},J.Predictor2=function(v,I,M){return I[M+0]},J.Predictor3=function(v,I,M){return I[M+1]},J.Predictor4=function(v,I,M){return I[M-1]},J.Predictor5=function(v,I,M){return wn(wn(v,I[M+1]),I[M+0])},J.Predictor6=function(v,I,M){return wn(v,I[M-1])},J.Predictor7=function(v,I,M){return wn(v,I[M+0])},J.Predictor8=function(v,I,M){return wn(I[M-1],I[M+0])},J.Predictor9=function(v,I,M){return wn(I[M+0],I[M+1])},J.Predictor10=function(v,I,M){return wn(wn(v,I[M-1]),wn(I[M+0],I[M+1]))},J.Predictor11=function(v,I,M){var H=I[M+0];return 0>=Bn(H>>24&255,v>>24&255,(I=I[M-1])>>24&255)+Bn(H>>16&255,v>>16&255,I>>16&255)+Bn(H>>8&255,v>>8&255,I>>8&255)+Bn(255&H,255&v,255&I)?H:v},J.Predictor12=function(v,I,M){var H=I[M+0];return(Un((v>>24&255)+(H>>24&255)-((I=I[M-1])>>24&255))<<24|Un((v>>16&255)+(H>>16&255)-(I>>16&255))<<16|Un((v>>8&255)+(H>>8&255)-(I>>8&255))<<8|Un((255&v)+(255&H)-(255&I)))>>>0},J.Predictor13=function(v,I,M){var H=I[M-1];return(ii((v=wn(v,I[M+0]))>>24&255,H>>24&255)<<24|ii(v>>16&255,H>>16&255)<<16|ii(v>>8&255,H>>8&255)<<8|ii(255&v,255&H))>>>0};var Fu=J.PredictorAdd0;J.PredictorAdd1=li,Jt("Predictor2","PredictorAdd2"),Jt("Predictor3","PredictorAdd3"),Jt("Predictor4","PredictorAdd4"),Jt("Predictor5","PredictorAdd5"),Jt("Predictor6","PredictorAdd6"),Jt("Predictor7","PredictorAdd7"),Jt("Predictor8","PredictorAdd8"),Jt("Predictor9","PredictorAdd9"),Jt("Predictor10","PredictorAdd10"),Jt("Predictor11","PredictorAdd11"),Jt("Predictor12","PredictorAdd12"),Jt("Predictor13","PredictorAdd13");var fu=J.PredictorAdd2;hn("ColorIndexInverseTransform","MapARGB","32b",function(v){return v>>8&255},function(v){return v}),hn("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(v){return v},function(v){return v>>8&255});var ps,fc=J.ColorIndexInverseTransform,ol=J.MapARGB,Cs=J.VP8LColorIndexInverseTransformAlpha,Rs=J.MapAlpha,Tl=J.VP8LPredictorsAdd=[];Tl.length=16,(J.VP8LPredictors=[]).length=16,(J.VP8LPredictorsAdd_C=[]).length=16,(J.VP8LPredictors_C=[]).length=16;var lo,ju,Wo,uo,ll,Gl,Xa,Wn,Ii,is,Li,zi,Dr,gs,ul,qo,pu,pc,gd,vf,_f,bf,md,yd,gu,Ao,Kl,co,mu=s(511),gc=s(2041),yu=s(225),vu=s(767),Al=0,ho=gc,El=yu,qs=vu,Ys=mu,mc=0,ha=1,yc=2,fo=3,Wl=4,Vu=5,Il=6,zu=7,vc=8,_u=9,_c=10,Eo=[2,3,7],Uu=[3,3,11],bu=[280,256,256,256,40],sh=[0,1,1,1,0],bc=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Io=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Ja=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ql=8,po=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ko=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],go=null,xc=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],vd=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ah=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],_d=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],da=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Fr=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],bi=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Pa=[],rs=[],O=[],d=1,g=2,y=[],N=[];Vt("UpsampleRgbLinePair",ua,3),Vt("UpsampleBgrLinePair",wr,3),Vt("UpsampleRgbaLinePair",xa,4),Vt("UpsampleBgraLinePair",rl,4),Vt("UpsampleArgbLinePair",$o,4),Vt("UpsampleRgba4444LinePair",qa,2),Vt("UpsampleRgb565LinePair",ca,2);var D=J.UpsampleRgbLinePair,F=J.UpsampleBgrLinePair,z=J.UpsampleRgbaLinePair,P=J.UpsampleBgraLinePair,k=J.UpsampleArgbLinePair,R=J.UpsampleRgba4444LinePair,S=J.UpsampleRgb565LinePair,T=16,G=1<<T-1,te=-227,Te=482,ie=6,_e=0,Y=s(256),re=s(256),be=s(256),ke=s(256),rt=s(Te-te),vt=s(Te-te);wl("YuvToRgbRow",ua,3),wl("YuvToBgrRow",wr,3),wl("YuvToRgbaRow",xa,4),wl("YuvToBgraRow",rl,4),wl("YuvToArgbRow",$o,4),wl("YuvToRgba4444Row",qa,2),wl("YuvToRgb565Row",ca,2);var Q=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],U=[0,2,8],Me=[8,7,6,4,4,2,2,2,1,1,1,1],Fe=1;this.WebPDecodeRGBA=function(v,I,M,H,oe){var de=ha,ue=new It,ve=new tn;ue.ba=ve,ve.S=de,ve.width=[ve.width],ve.height=[ve.height];var xe=ve.width,Re=ve.height,Ue=new Gt;if(Ue==null||v==null)var Xe=2;else e(Ue!=null),Xe=Ho(v,I,M,Ue.width,Ue.height,Ue.Pd,Ue.Qd,Ue.format,null);if(Xe!=0?xe=0:(xe!=null&&(xe[0]=Ue.width[0]),Re!=null&&(Re[0]=Ue.height[0]),xe=1),xe){ve.width=ve.width[0],ve.height=ve.height[0],H!=null&&(H[0]=ve.width),oe!=null&&(oe[0]=ve.height);e:{if(H=new Hr,(oe=new Mt).data=v,oe.w=I,oe.ha=M,oe.kd=1,I=[0],e(oe!=null),((v=Ho(oe.data,oe.w,oe.ha,null,null,null,I,null,oe))==0||v==7)&&I[0]&&(v=4),(I=v)==0){if(e(ue!=null),H.data=oe.data,H.w=oe.w+oe.offset,H.ha=oe.ha-oe.offset,H.put=pn,H.ac=Ri,H.bc=Ra,H.ma=ue,oe.xa){if((v=Ba())==null){ue=1;break e}if((function(Ae,Ge){var et=[0],ot=[0],Ze=[0];t:for(;;){if(Ae==null)return 0;if(Ge==null)return Ae.a=2,0;if(Ae.l=Ge,Ae.a=0,lt(Ae.m,Ge.data,Ge.w,Ge.ha),!sa(Ae.m,et,ot,Ze)){Ae.a=3;break t}if(Ae.xb=g,Ge.width=et[0],Ge.height=ot[0],!ds(et[0],ot[0],1,Ae,null))break t;return 1}return e(Ae.a!=0),0})(v,H)){if(H=(I=Go(H.width,H.height,ue.Oa,ue.ba))==0){t:{H=v;n:for(;;){if(H==null){H=0;break t}if(e(H.s.yc!=null),e(H.s.Ya!=null),e(0<H.s.Wb),e((M=H.l)!=null),e((oe=M.ma)!=null),H.xb!=0){if(H.ca=oe.ba,H.tb=oe.tb,e(H.ca!=null),!Sl(oe.Oa,M,fo)){H.a=2;break n}if(!Jr(H,M.width)||M.da)break n;if((M.da||Mn(H.ca.S))&&ft(),11>H.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),H.ca.f.kb.F!=null&&ft()),H.Pb&&0<H.s.ua&&H.s.vb.X==null&&!Pe(H.s.vb,H.s.Wa.Xa)){H.a=1;break n}H.xb=0}if(!hs(H,H.V,H.Ba,H.c,H.i,M.o,ns))break n;oe.Dc=H.Ma,H=1;break t}e(H.a!=0),H=0}H=!H}H&&(I=v.a)}else I=v.a}else{if((v=new _r)==null){ue=1;break e}if(v.Fa=oe.na,v.P=oe.P,v.qc=oe.Sa,zs(v,H)){if((I=Go(H.width,H.height,ue.Oa,ue.ba))==0){if(v.Aa=0,M=ue.Oa,e((oe=v)!=null),M!=null){if(0<(xe=0>(xe=M.Md)?0:100<xe?255:255*xe/100)){for(Re=Ue=0;4>Re;++Re)12>(Xe=oe.pb[Re]).lc&&(Xe.ia=xe*Me[0>Xe.lc?0:Xe.lc]>>3),Ue|=Xe.ia;Ue&&(alert("todo:VP8InitRandom"),oe.ia=1)}oe.Ga=M.Id,100<oe.Ga?oe.Ga=100:0>oe.Ga&&(oe.Ga=0)}(function(Ae,Ge){if(Ae==null)return 0;if(Ge==null)return dn(Ae,2,"NULL VP8Io parameter in VP8Decode().");if(!Ae.cb&&!zs(Ae,Ge))return 0;if(e(Ae.cb),Ge.ac==null||Ge.ac(Ge)){Ge.ob&&(Ae.L=0);var et=U[Ae.L];if(Ae.L==2?(Ae.yb=0,Ae.zb=0):(Ae.yb=Ge.v-et>>4,Ae.zb=Ge.j-et>>4,0>Ae.yb&&(Ae.yb=0),0>Ae.zb&&(Ae.zb=0)),Ae.Va=Ge.o+15+et>>4,Ae.Hb=Ge.va+15+et>>4,Ae.Hb>Ae.za&&(Ae.Hb=Ae.za),Ae.Va>Ae.Ub&&(Ae.Va=Ae.Ub),0<Ae.L){var ot=Ae.ed;for(et=0;4>et;++et){var Ze;if(Ae.Qa.Cb){var gt=Ae.Qa.Lb[et];Ae.Qa.Fb||(gt+=ot.Tb)}else gt=ot.Tb;for(Ze=0;1>=Ze;++Ze){var wt=Ae.gd[et][Ze],Nt=gt;if(ot.Pc&&(Nt+=ot.vd[0],Ze&&(Nt+=ot.od[0])),0<(Nt=0>Nt?0:63<Nt?63:Nt)){var ht=Nt;0<ot.wb&&(ht=4<ot.wb?ht>>2:ht>>1)>9-ot.wb&&(ht=9-ot.wb),1>ht&&(ht=1),wt.dd=ht,wt.tc=2*Nt+ht,wt.ld=40<=Nt?2:15<=Nt?1:0}else wt.tc=0;wt.La=Ze}}}et=0}else dn(Ae,6,"Frame setup failed"),et=Ae.a;if(et=et==0){if(et){Ae.$c=0,0<Ae.Aa||(Ae.Ic=Fe);t:{et=Ae.Ic,ot=4*(ht=Ae.za);var Ut=32*ht,Bt=ht+1,In=0<Ae.L?ht*(0<Ae.Aa?2:1):0,nn=(Ae.Aa==2?2:1)*ht;if((wt=ot+832+(Ze=3*(16*et+U[Ae.L])/2*Ut)+(gt=Ae.Fa!=null&&0<Ae.Fa.length?Ae.Kc.c*Ae.Kc.i:0))!=wt)et=0;else{if(wt>Ae.Vb){if(Ae.Vb=0,Ae.Ec=s(wt),Ae.Fc=0,Ae.Ec==null){et=dn(Ae,1,"no memory during frame initialization.");break t}Ae.Vb=wt}wt=Ae.Ec,Nt=Ae.Fc,Ae.Ac=wt,Ae.Bc=Nt,Nt+=ot,Ae.Gd=l(Ut,il),Ae.Hd=0,Ae.rb=l(Bt+1,va),Ae.sb=1,Ae.wa=In?l(In,Vs):null,Ae.Y=0,Ae.D.Nb=0,Ae.D.wa=Ae.wa,Ae.D.Y=Ae.Y,0<Ae.Aa&&(Ae.D.Y+=ht),e(!0),Ae.oc=wt,Ae.pc=Nt,Nt+=832,Ae.ya=l(nn,jo),Ae.aa=0,Ae.D.ya=Ae.ya,Ae.D.aa=Ae.aa,Ae.Aa==2&&(Ae.D.aa+=ht),Ae.R=16*ht,Ae.B=8*ht,ht=(Ut=U[Ae.L])*Ae.R,Ut=Ut/2*Ae.B,Ae.sa=wt,Ae.ta=Nt+ht,Ae.qa=Ae.sa,Ae.ra=Ae.ta+16*et*Ae.R+Ut,Ae.Ha=Ae.qa,Ae.Ia=Ae.ra+8*et*Ae.B+Ut,Ae.$c=0,Nt+=Ze,Ae.mb=gt?wt:null,Ae.nb=gt?Nt:null,e(Nt+gt<=Ae.Fc+Ae.Vb),$a(Ae),r(Ae.Ac,Ae.Bc,0,ot),et=1}}if(et){if(Ge.ka=0,Ge.y=Ae.sa,Ge.O=Ae.ta,Ge.f=Ae.qa,Ge.N=Ae.ra,Ge.ea=Ae.Ha,Ge.Vd=Ae.Ia,Ge.fa=Ae.R,Ge.Rc=Ae.B,Ge.F=null,Ge.J=0,!Al){for(et=-255;255>=et;++et)mu[255+et]=0>et?-et:et;for(et=-1020;1020>=et;++et)gc[1020+et]=-128>et?-128:127<et?127:et;for(et=-112;112>=et;++et)yu[112+et]=-16>et?-16:15<et?15:et;for(et=-255;510>=et;++et)vu[255+et]=0>et?0:255<et?255:et;Al=1}Xa=Mi,Wn=Uo,is=br,Li=_l,zi=oa,Ii=$l,Dr=Di,gs=Cr,ul=fe,qo=Oe,pu=la,pc=j,gd=We,vf=tt,_f=Wa,bf=fs,md=ao,yd=To,rs[0]=Us,rs[1]=bl,rs[2]=xs,rs[3]=_a,rs[4]=Er,rs[5]=ba,rs[6]=Ai,rs[7]=Ci,rs[8]=Ga,rs[9]=Bs,Pa[0]=fn,Pa[1]=Bo,Pa[2]=Ha,Pa[3]=At,Pa[4]=ui,Pa[5]=Xi,Pa[6]=vi,O[0]=La,O[1]=xl,O[2]=$s,O[3]=gn,O[4]=kr,O[5]=Ir,O[6]=Hs,et=1}else et=0}et&&(et=(function(xi,Ui){for(xi.M=0;xi.M<xi.Va;++xi.M){var si,sn=xi.Jc[xi.M&xi.Xb],Ht=xi.m,ei=xi;for(si=0;si<ei.za;++si){var Dn=Ht,Nn=ei,ur=Nn.Ac,ss=Nn.Bc+4*si,An=Nn.zc,pr=Nn.ya[Nn.aa+si];if(Nn.Qa.Bb?pr.$b=Et(Dn,Nn.Pa.jb[0])?2+Et(Dn,Nn.Pa.jb[2]):Et(Dn,Nn.Pa.jb[1]):pr.$b=0,Nn.kc&&(pr.Ad=Et(Dn,Nn.Bd)),pr.Za=!Et(Dn,145)+0,pr.Za){var ws=pr.Ob,wa=0;for(Nn=0;4>Nn;++Nn){var Kr,fi=An[0+Nn];for(Kr=0;4>Kr;++Kr){fi=da[ur[ss+Kr]][fi];for(var Bi=ah[Et(Dn,fi[0])];0<Bi;)Bi=ah[2*Bi+Et(Dn,fi[Bi])];fi=-Bi,ur[ss+Kr]=fi}n(ws,wa,ur,ss,4),wa+=4,An[0+Nn]=fi}}else fi=Et(Dn,156)?Et(Dn,128)?1:3:Et(Dn,163)?2:0,pr.Ob[0]=fi,r(ur,ss,fi,4),r(An,0,fi,4);pr.Dd=Et(Dn,142)?Et(Dn,114)?Et(Dn,183)?1:3:2:0}if(ei.m.Ka)return dn(xi,7,"Premature end-of-partition0 encountered.");for(;xi.ja<xi.za;++xi.ja){if(ei=sn,Dn=(Ht=xi).rb[Ht.sb-1],ur=Ht.rb[Ht.sb+Ht.ja],si=Ht.ya[Ht.aa+Ht.ja],ss=Ht.kc?si.Ad:0)Dn.la=ur.la=0,si.Za||(Dn.Na=ur.Na=0),si.Hc=0,si.Gc=0,si.ia=0;else{var sr,an;if(Dn=ur,ur=ei,ss=Ht.Pa.Xc,An=Ht.ya[Ht.aa+Ht.ja],pr=Ht.pb[An.$b],Nn=An.ad,ws=0,wa=Ht.rb[Ht.sb-1],fi=Kr=0,r(Nn,ws,0,384),An.Za)var Ds=0,Lr=ss[3];else{Bi=s(16);var _i=Dn.Na+wa.Na;if(_i=go(ur,ss[1],_i,pr.Eb,0,Bi,0),Dn.Na=wa.Na=(0<_i)+0,1<_i)Xa(Bi,0,Nn,ws);else{var ms=Bi[0]+3>>3;for(Bi=0;256>Bi;Bi+=16)Nn[ws+Bi]=ms}Ds=1,Lr=ss[0]}var Ji=15&Dn.la,Qr=15&wa.la;for(Bi=0;4>Bi;++Bi){var ys=1&Qr;for(ms=an=0;4>ms;++ms)Ji=Ji>>1|(ys=(_i=go(ur,Lr,_i=ys+(1&Ji),pr.Sc,Ds,Nn,ws))>Ds)<<7,an=an<<2|(3<_i?3:1<_i?2:Nn[ws+0]!=0),ws+=16;Ji>>=4,Qr=Qr>>1|ys<<7,Kr=(Kr<<8|an)>>>0}for(Lr=Ji,Ds=Qr>>4,sr=0;4>sr;sr+=2){for(an=0,Ji=Dn.la>>4+sr,Qr=wa.la>>4+sr,Bi=0;2>Bi;++Bi){for(ys=1&Qr,ms=0;2>ms;++ms)_i=ys+(1&Ji),Ji=Ji>>1|(ys=0<(_i=go(ur,ss[2],_i,pr.Qc,0,Nn,ws)))<<3,an=an<<2|(3<_i?3:1<_i?2:Nn[ws+0]!=0),ws+=16;Ji>>=2,Qr=Qr>>1|ys<<5}fi|=an<<4*sr,Lr|=Ji<<4<<sr,Ds|=(240&Qr)<<sr}Dn.la=Lr,wa.la=Ds,An.Hc=Kr,An.Gc=fi,An.ia=43690&fi?0:pr.ia,ss=!(Kr|fi)}if(0<Ht.L&&(Ht.wa[Ht.Y+Ht.ja]=Ht.gd[si.$b][si.Za],Ht.wa[Ht.Y+Ht.ja].La|=!ss),ei.Ka)return dn(xi,7,"Premature end-of-file encountered.")}if($a(xi),Ht=Ui,ei=1,si=(sn=xi).D,Dn=0<sn.L&&sn.M>=sn.zb&&sn.M<=sn.Va,sn.Aa==0)t:{if(si.M=sn.M,si.uc=Dn,oo(sn,si),ei=1,si=(an=sn.D).Nb,Dn=(fi=U[sn.L])*sn.R,ur=fi/2*sn.B,Bi=16*si*sn.R,ms=8*si*sn.B,ss=sn.sa,An=sn.ta-Dn+Bi,pr=sn.qa,Nn=sn.ra-ur+ms,ws=sn.Ha,wa=sn.Ia-ur+ms,Qr=(Ji=an.M)==0,Kr=Ji>=sn.Va-1,sn.Aa==2&&oo(sn,an),an.uc)for(ys=(_i=sn).D.M,e(_i.D.uc),an=_i.yb;an<_i.Hb;++an){Ds=an,Lr=ys;var wi=(Fn=(Ss=_i).D).Nb;sr=Ss.R;var Fn=Fn.wa[Fn.Y+Ds],Ls=Ss.sa,Zr=Ss.ta+16*wi*sr+16*Ds,Pn=Fn.dd,zn=Fn.tc;if(zn!=0)if(e(3<=zn),Ss.L==1)0<Ds&&bf(Ls,Zr,sr,zn+4),Fn.La&&yd(Ls,Zr,sr,zn),0<Lr&&_f(Ls,Zr,sr,zn+4),Fn.La&&md(Ls,Zr,sr,zn);else{var Qi=Ss.B,Oa=Ss.qa,mo=Ss.ra+8*wi*Qi+8*Ds,Sa=Ss.Ha,Ss=Ss.Ia+8*wi*Qi+8*Ds;wi=Fn.ld,0<Ds&&(gs(Ls,Zr,sr,zn+4,Pn,wi),qo(Oa,mo,Sa,Ss,Qi,zn+4,Pn,wi)),Fn.La&&(pc(Ls,Zr,sr,zn,Pn,wi),vf(Oa,mo,Sa,Ss,Qi,zn,Pn,wi)),0<Lr&&(Dr(Ls,Zr,sr,zn+4,Pn,wi),ul(Oa,mo,Sa,Ss,Qi,zn+4,Pn,wi)),Fn.La&&(pu(Ls,Zr,sr,zn,Pn,wi),gd(Oa,mo,Sa,Ss,Qi,zn,Pn,wi))}}if(sn.ia&&alert("todo:DitherRow"),Ht.put!=null){if(an=16*Ji,Ji=16*(Ji+1),Qr?(Ht.y=sn.sa,Ht.O=sn.ta+Bi,Ht.f=sn.qa,Ht.N=sn.ra+ms,Ht.ea=sn.Ha,Ht.W=sn.Ia+ms):(an-=fi,Ht.y=ss,Ht.O=An,Ht.f=pr,Ht.N=Nn,Ht.ea=ws,Ht.W=wa),Kr||(Ji-=fi),Ji>Ht.o&&(Ji=Ht.o),Ht.F=null,Ht.J=null,sn.Fa!=null&&0<sn.Fa.length&&an<Ji&&(Ht.J=E(sn,Ht,an,Ji-an),Ht.F=sn.mb,Ht.F==null&&Ht.F.length==0)){ei=dn(sn,3,"Could not decode alpha data.");break t}an<Ht.j&&(fi=Ht.j-an,an=Ht.j,e(!(1&fi)),Ht.O+=sn.R*fi,Ht.N+=sn.B*(fi>>1),Ht.W+=sn.B*(fi>>1),Ht.F!=null&&(Ht.J+=Ht.width*fi)),an<Ji&&(Ht.O+=Ht.v,Ht.N+=Ht.v>>1,Ht.W+=Ht.v>>1,Ht.F!=null&&(Ht.J+=Ht.v),Ht.ka=an-Ht.j,Ht.U=Ht.va-Ht.v,Ht.T=Ji-an,ei=Ht.put(Ht))}si+1!=sn.Ic||Kr||(n(sn.sa,sn.ta-Dn,ss,An+16*sn.R,Dn),n(sn.qa,sn.ra-ur,pr,Nn+8*sn.B,ur),n(sn.Ha,sn.Ia-ur,ws,wa+8*sn.B,ur))}if(!ei)return dn(xi,6,"Output aborted.")}return 1})(Ae,Ge)),Ge.bc!=null&&Ge.bc(Ge),et&=1}return et?(Ae.cb=0,et):0})(v,H)||(I=v.a)}}else I=v.a}I==0&&ue.Oa!=null&&ue.Oa.fd&&(I=dc(ue.ba))}ue=I}de=ue!=0?null:11>de?ve.f.RGBA.eb:ve.f.kb.y}else de=null;return de};var bt=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(J,ye){for(var X="",ae=0;ae<4;ae++)X+=String.fromCharCode(J[ye++]);return X}function x(J,ye){return J[ye+0]|J[ye+1]<<8}function p(J,ye){return(J[ye+0]|J[ye+1]<<8|J[ye+2]<<16)>>>0}function w(J,ye){return(J[ye+0]|J[ye+1]<<8|J[ye+2]<<16|J[ye+3]<<24)>>>0}new h;var A=[0],B=[0],$=[],W=new h,q=i,ge=(function(J,ye){var X={},ae=0,le=!1,ze=0,nt=0;if(X.frames=[],!(function(se,Ee){for(var Le=0;Le<4;Le++)if(se[Ee+Le]!="RIFF".charCodeAt(Le))return!0;return!1})(J,ye)){for(w(J,ye+=4),ye+=8;ye<J.length;){var je=f(J,ye),Je=w(J,ye+=4);ye+=4;var qe=Je+(1&Je);switch(je){case"VP8 ":case"VP8L":X.frames[ae]===void 0&&(X.frames[ae]={}),(Ne=X.frames[ae]).src_off=le?nt:ye-8,Ne.src_size=ze+Je+8,ae++,le&&(le=!1,ze=0,nt=0);break;case"VP8X":(Ne=X.header={}).feature_flags=J[ye];var lt=ye+4;Ne.canvas_width=1+p(J,lt),lt+=3,Ne.canvas_height=1+p(J,lt),lt+=3;break;case"ALPH":le=!0,ze=qe+8,nt=ye-8;break;case"ANIM":(Ne=X.header).bgcolor=w(J,ye),lt=ye+4,Ne.loop_count=x(J,lt),lt+=2;break;case"ANMF":var Tt,Ne;(Ne=X.frames[ae]={}).offset_x=2*p(J,ye),ye+=3,Ne.offset_y=2*p(J,ye),ye+=3,Ne.width=1+p(J,ye),ye+=3,Ne.height=1+p(J,ye),ye+=3,Ne.duration=p(J,ye),ye+=3,Tt=J[ye++],Ne.dispose=1&Tt,Ne.blend=Tt>>1&1}je!="ANMF"&&(ye+=qe)}return X}})(q,0);ge.response=q,ge.rgbaoutput=!0,ge.dataurl=!1;var he=ge.header?ge.header:null,me=ge.frames?ge.frames:null;if(he){he.loop_counter=he.loop_count,A=[he.canvas_height],B=[he.canvas_width];for(var Ce=0;Ce<me.length&&me[Ce].blend!=0;Ce++);}var Ve=me[0],pe=W.WebPDecodeRGBA(q,Ve.src_off,Ve.src_size,B,A);Ve.rgba=pe,Ve.imgwidth=B[0],Ve.imgheight=A[0];for(var ee=0;ee<B[0]*A[0]*4;ee++)$[ee]=pe[ee];return this.width=B,this.height=A,this.data=$,this}(function(i){var e,t,n,r,s,l,u,h,f,x=function(se){return se=se||{},this.isStrokeTransparent=se.isStrokeTransparent||!1,this.strokeOpacity=se.strokeOpacity||1,this.strokeStyle=se.strokeStyle||"#000000",this.fillStyle=se.fillStyle||"#000000",this.isFillTransparent=se.isFillTransparent||!1,this.fillOpacity=se.fillOpacity||1,this.font=se.font||"10px sans-serif",this.textBaseline=se.textBaseline||"alphabetic",this.textAlign=se.textAlign||"left",this.lineWidth=se.lineWidth||1,this.lineJoin=se.lineJoin||"miter",this.lineCap=se.lineCap||"butt",this.path=se.path||[],this.transform=se.transform!==void 0?se.transform.clone():new h,this.globalCompositeOperation=se.globalCompositeOperation||"normal",this.globalAlpha=se.globalAlpha||1,this.clip_path=se.clip_path||[],this.currentPoint=se.currentPoint||new l,this.miterLimit=se.miterLimit||10,this.lastPoint=se.lastPoint||new l,this.lineDashOffset=se.lineDashOffset||0,this.lineDash=se.lineDash||[],this.margin=se.margin||[0,0,0,0],this.prevPageLastElemOffset=se.prevPageLastElemOffset||0,this.ignoreClearRect=typeof se.ignoreClearRect!="boolean"||se.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new p(this),e=this.internal.f2,t=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,l=this.internal.Point,u=this.internal.Rectangle,h=this.internal.Matrix,f=new x}]);var p=function(se){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ee=se;Object.defineProperty(this,"pdf",{get:function(){return Ee}});var Le=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Le},set:function(Pe){Le=!!Pe}});var Be=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Be},set:function(Pe){Be=!!Pe}});var He=0;Object.defineProperty(this,"posX",{get:function(){return He},set:function(Pe){isNaN(Pe)||(He=Pe)}});var Ye=0;Object.defineProperty(this,"posY",{get:function(){return Ye},set:function(Pe){isNaN(Pe)||(Ye=Pe)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(Pe){var $t;typeof Pe=="number"?$t=[Pe,Pe,Pe,Pe]:(($t=new Array(4))[0]=Pe[0],$t[1]=Pe.length>=2?Pe[1]:$t[0],$t[2]=Pe.length>=3?Pe[2]:$t[0],$t[3]=Pe.length>=4?Pe[3]:$t[1]),f.margin=$t}});var it=!1;Object.defineProperty(this,"autoPaging",{get:function(){return it},set:function(Pe){it=Pe}});var ct=0;Object.defineProperty(this,"lastBreak",{get:function(){return ct},set:function(Pe){ct=Pe}});var Et=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Et},set:function(Pe){Et=Pe}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(Pe){Pe instanceof x&&(f=Pe)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(Pe){f.path=Pe}});var Ft=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ft},set:function(Pe){Ft=Pe}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Pe){var $t;$t=w(Pe),this.ctx.fillStyle=$t.style,this.ctx.isFillTransparent=$t.a===0,this.ctx.fillOpacity=$t.a,this.pdf.setFillColor($t.r,$t.g,$t.b,{a:$t.a}),this.pdf.setTextColor($t.r,$t.g,$t.b,{a:$t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Pe){var $t=w(Pe);this.ctx.strokeStyle=$t.style,this.ctx.isStrokeTransparent=$t.a===0,this.ctx.strokeOpacity=$t.a,$t.a===0?this.pdf.setDrawColor(255,255,255):($t.a,this.pdf.setDrawColor($t.r,$t.g,$t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Pe){["butt","round","square"].indexOf(Pe)!==-1&&(this.ctx.lineCap=Pe,this.pdf.setLineCap(Pe))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Pe){isNaN(Pe)||(this.ctx.lineWidth=Pe,this.pdf.setLineWidth(Pe))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Pe){["bevel","round","miter"].indexOf(Pe)!==-1&&(this.ctx.lineJoin=Pe,this.pdf.setLineJoin(Pe))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Pe){isNaN(Pe)||(this.ctx.miterLimit=Pe,this.pdf.setMiterLimit(Pe))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Pe){this.ctx.textBaseline=Pe}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Pe){["right","end","center","left","start"].indexOf(Pe)!==-1&&(this.ctx.textAlign=Pe)}});var Wt=null,qt=null,kt=null;Object.defineProperty(this,"fontFaces",{get:function(){return kt},set:function(Pe){Wt=null,qt=null,kt=Pe}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Pe){var $t;if(this.ctx.font=Pe,($t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(Pe))!==null){var Pt=$t[1];$t[2];var Tn=$t[3],_t=$t[4];$t[5];var rn=$t[6],Jt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(_t)[2];_t=Math.floor(Jt==="px"?parseFloat(_t)*this.pdf.internal.scaleFactor:Jt==="em"?parseFloat(_t)*this.pdf.getFontSize():parseFloat(_t)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(_t);var En=(function(hn){var nr,Jn,vn=[],On=hn.trim();if(On==="")return Fb;if(On in Mk)return[Mk[On]];for(;On!=="";){switch(Jn=null,nr=(On=jk(On)).charAt(0)){case'"':case"'":Jn=MW(On.substring(1),nr);break;default:Jn=FW(On)}if(Jn===null||(vn.push(Jn[0]),(On=jk(Jn[1]))!==""&&On.charAt(0)!==","))return Fb;On=On.replace(/^,/,"")}return vn})(rn);if(this.fontFaces){var wn=(function(hn,nr){var Jn=hn.getFontList(),vn=JSON.stringify(Jn);if(Wt===null||qt!==vn){var On=(function(qn){var un=[];return Object.keys(qn).forEach(function(Pi){qn[Pi].forEach(function(Mn){var Sn=null;switch(Mn){case"bold":Sn={family:Pi,weight:"bold"};break;case"italic":Sn={family:Pi,style:"italic"};break;case"bolditalic":Sn={family:Pi,weight:"bold",style:"italic"};break;case"":case"normal":Sn={family:Pi}}Sn!==null&&(Sn.ref={name:Pi,style:Mn},un.push(Sn))})}),un})(Jn);Wt=(function(qn){for(var un={},Pi=0;Pi<qn.length;++Pi){var Mn=Mb(qn[Pi]),Sn=Mn.family,Qn=Mn.stretch,tn=Mn.style,Gt=Mn.weight;un[Sn]=un[Sn]||{},un[Sn][Qn]=un[Sn][Qn]||{},un[Sn][Qn][tn]=un[Sn][Qn][tn]||{},un[Sn][Qn][tn][Gt]=Mn}return un})(On.concat(nr)),qt=vn}return Wt})(this.pdf,this.fontFaces),Un=En.map(function(hn){return{family:hn,stretch:"normal",weight:Tn,style:Pt}}),ii=(function(hn,nr,Jn){for(var vn=(Jn=Jn||{}).defaultFontFamily||"times",On=Object.assign({},OW,Jn.genericFontFamilies||{}),qn=null,un=null,Pi=0;Pi<nr.length;++Pi)if(On[(qn=Mb(nr[Pi])).family]&&(qn.family=On[qn.family]),hn.hasOwnProperty(qn.family)){un=hn[qn.family];break}if(!(un=un||hn[vn]))throw new Error("Could not find a font-family for the rule '"+Fk(qn)+"' and default family '"+vn+"'.");if(un=(function(Mn,Sn){if(Sn[Mn])return Sn[Mn];var Qn=Zx[Mn],tn=Qn<=Zx.normal?-1:1,Gt=Ok(Sn,nN,Qn,tn);if(!Gt)throw new Error("Could not find a matching font-stretch value for "+Mn);return Gt})(qn.stretch,un),un=(function(Mn,Sn){if(Sn[Mn])return Sn[Mn];for(var Qn=tN[Mn],tn=0;tn<Qn.length;++tn)if(Sn[Qn[tn]])return Sn[Qn[tn]];throw new Error("Could not find a matching font-style for "+Mn)})(qn.style,un),!(un=(function(Mn,Sn){if(Sn[Mn])return Sn[Mn];if(Mn===400&&Sn[500])return Sn[500];if(Mn===500&&Sn[400])return Sn[400];var Qn=PW[Mn],tn=Ok(Sn,iN,Qn,Mn<400?-1:1);if(!tn)throw new Error("Could not find a matching font-weight for value "+Mn);return tn})(qn.weight,un)))throw new Error("Failed to resolve a font for the rule '"+Fk(qn)+"'.");return un})(wn,Un);this.pdf.setFont(ii.ref.name,ii.ref.style)}else{var Bn="";(Tn==="bold"||parseInt(Tn,10)>=700||Pt==="bold")&&(Bn="bold"),Pt==="italic"&&(Bn+="italic"),Bn.length===0&&(Bn="normal");for(var li="",Xn={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},cn=0;cn<En.length;cn++){if(this.pdf.internal.getFont(En[cn],Bn,{noFallback:!0,disableWarning:!0})!==void 0){li=En[cn];break}if(Bn==="bolditalic"&&this.pdf.internal.getFont(En[cn],"bold",{noFallback:!0,disableWarning:!0})!==void 0)li=En[cn],Bn="bold";else if(this.pdf.internal.getFont(En[cn],"normal",{noFallback:!0,disableWarning:!0})!==void 0){li=En[cn],Bn="normal";break}}if(li===""){for(var $n=0;$n<En.length;$n++)if(Xn[En[$n]]){li=Xn[En[$n]];break}}li=li===""?"Times":li,this.pdf.setFont(li,Bn)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Pe){this.ctx.globalCompositeOperation=Pe}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Pe){this.ctx.globalAlpha=Pe}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Pe){this.ctx.lineDashOffset=Pe,Ne.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Pe){this.ctx.lineDash=Pe,Ne.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Pe){this.ctx.ignoreClearRect=!!Pe}})};p.prototype.setLineDash=function(se){this.lineDash=se},p.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},p.prototype.fill=function(){me.call(this,"fill",!1)},p.prototype.stroke=function(){me.call(this,"stroke",!1)},p.prototype.beginPath=function(){this.path=[{type:"begin"}]},p.prototype.moveTo=function(se,Ee){if(isNaN(se)||isNaN(Ee))throw ts.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Le=this.ctx.transform.applyToPoint(new l(se,Ee));this.path.push({type:"mt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new l(se,Ee)},p.prototype.closePath=function(){var se=new l(0,0),Ee=0;for(Ee=this.path.length-1;Ee!==-1;Ee--)if(this.path[Ee].type==="begin"&&zr(this.path[Ee+1])==="object"&&typeof this.path[Ee+1].x=="number"){se=new l(this.path[Ee+1].x,this.path[Ee+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new l(se.x,se.y)},p.prototype.lineTo=function(se,Ee){if(isNaN(se)||isNaN(Ee))throw ts.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Le=this.ctx.transform.applyToPoint(new l(se,Ee));this.path.push({type:"lt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new l(Le.x,Le.y)},p.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),me.call(this,null,!0)},p.prototype.quadraticCurveTo=function(se,Ee,Le,Be){if(isNaN(Le)||isNaN(Be)||isNaN(se)||isNaN(Ee))throw ts.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var He=this.ctx.transform.applyToPoint(new l(Le,Be)),Ye=this.ctx.transform.applyToPoint(new l(se,Ee));this.path.push({type:"qct",x1:Ye.x,y1:Ye.y,x:He.x,y:He.y}),this.ctx.lastPoint=new l(He.x,He.y)},p.prototype.bezierCurveTo=function(se,Ee,Le,Be,He,Ye){if(isNaN(He)||isNaN(Ye)||isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be))throw ts.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var it=this.ctx.transform.applyToPoint(new l(He,Ye)),ct=this.ctx.transform.applyToPoint(new l(se,Ee)),Et=this.ctx.transform.applyToPoint(new l(Le,Be));this.path.push({type:"bct",x1:ct.x,y1:ct.y,x2:Et.x,y2:Et.y,x:it.x,y:it.y}),this.ctx.lastPoint=new l(it.x,it.y)},p.prototype.arc=function(se,Ee,Le,Be,He,Ye){if(isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be)||isNaN(He))throw ts.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Ye=!!Ye,!this.ctx.transform.isIdentity){var it=this.ctx.transform.applyToPoint(new l(se,Ee));se=it.x,Ee=it.y;var ct=this.ctx.transform.applyToPoint(new l(0,Le)),Et=this.ctx.transform.applyToPoint(new l(0,0));Le=Math.sqrt(Math.pow(ct.x-Et.x,2)+Math.pow(ct.y-Et.y,2))}Math.abs(He-Be)>=2*Math.PI&&(Be=0,He=2*Math.PI),this.path.push({type:"arc",x:se,y:Ee,radius:Le,startAngle:Be,endAngle:He,counterclockwise:Ye})},p.prototype.arcTo=function(se,Ee,Le,Be,He){throw new Error("arcTo not implemented.")},p.prototype.rect=function(se,Ee,Le,Be){if(isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be))throw ts.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(se,Ee),this.lineTo(se+Le,Ee),this.lineTo(se+Le,Ee+Be),this.lineTo(se,Ee+Be),this.lineTo(se,Ee),this.lineTo(se+Le,Ee),this.lineTo(se,Ee)},p.prototype.fillRect=function(se,Ee,Le,Be){if(isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be))throw ts.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!A.call(this)){var He={};this.lineCap!=="butt"&&(He.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(He.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(se,Ee,Le,Be),this.fill(),He.hasOwnProperty("lineCap")&&(this.lineCap=He.lineCap),He.hasOwnProperty("lineJoin")&&(this.lineJoin=He.lineJoin)}},p.prototype.strokeRect=function(se,Ee,Le,Be){if(isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be))throw ts.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");B.call(this)||(this.beginPath(),this.rect(se,Ee,Le,Be),this.stroke())},p.prototype.clearRect=function(se,Ee,Le,Be){if(isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be))throw ts.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(se,Ee,Le,Be))},p.prototype.save=function(se){se=typeof se!="boolean"||se;for(var Ee=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ee),se){this.ctx.fontSize=this.pdf.internal.getFontSize();var Be=new x(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Be}},p.prototype.restore=function(se){se=typeof se!="boolean"||se;for(var Ee=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("Q");this.pdf.setPage(Ee),se&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},p.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var w=function(se){var Ee,Le,Be,He;if(se.isCanvasGradient===!0&&(se=se.getColor()),!se)return{r:0,g:0,b:0,a:0,style:se};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(se))Ee=0,Le=0,Be=0,He=0;else{var Ye=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(se);if(Ye!==null)Ee=parseInt(Ye[1]),Le=parseInt(Ye[2]),Be=parseInt(Ye[3]),He=1;else if((Ye=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(se))!==null)Ee=parseInt(Ye[1]),Le=parseInt(Ye[2]),Be=parseInt(Ye[3]),He=parseFloat(Ye[4]);else{if(He=1,typeof se=="string"&&se.charAt(0)!=="#"){var it=new q4(se);se=it.ok?it.toHex():"#000000"}se.length===4?(Ee=se.substring(1,2),Ee+=Ee,Le=se.substring(2,3),Le+=Le,Be=se.substring(3,4),Be+=Be):(Ee=se.substring(1,3),Le=se.substring(3,5),Be=se.substring(5,7)),Ee=parseInt(Ee,16),Le=parseInt(Le,16),Be=parseInt(Be,16)}}return{r:Ee,g:Le,b:Be,a:He,style:se}},A=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},B=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};p.prototype.fillText=function(se,Ee,Le,Be){if(isNaN(Ee)||isNaN(Le)||typeof se!="string")throw ts.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Be=isNaN(Be)?void 0:Be,!A.call(this)){var He=qe(this.ctx.transform.rotation),Ye=this.ctx.transform.scaleX;ae.call(this,{text:se,x:Ee,y:Le,scale:Ye,angle:He,align:this.textAlign,maxWidth:Be})}},p.prototype.strokeText=function(se,Ee,Le,Be){if(isNaN(Ee)||isNaN(Le)||typeof se!="string")throw ts.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!B.call(this)){Be=isNaN(Be)?void 0:Be;var He=qe(this.ctx.transform.rotation),Ye=this.ctx.transform.scaleX;ae.call(this,{text:se,x:Ee,y:Le,scale:Ye,renderingMode:"stroke",angle:He,align:this.textAlign,maxWidth:Be})}},p.prototype.measureText=function(se){if(typeof se!="string")throw ts.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ee=this.pdf,Le=this.pdf.internal.scaleFactor,Be=Ee.internal.getFontSize(),He=Ee.getStringUnitWidth(se)*Be/Ee.internal.scaleFactor;return new function(Ye){var it=(Ye=Ye||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return it}}),this}({width:He*=Math.round(96*Le/72*1e4)/1e4})},p.prototype.scale=function(se,Ee){if(isNaN(se)||isNaN(Ee))throw ts.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Le=new h(se,0,0,Ee,0,0);this.ctx.transform=this.ctx.transform.multiply(Le)},p.prototype.rotate=function(se){if(isNaN(se))throw ts.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ee=new h(Math.cos(se),Math.sin(se),-Math.sin(se),Math.cos(se),0,0);this.ctx.transform=this.ctx.transform.multiply(Ee)},p.prototype.translate=function(se,Ee){if(isNaN(se)||isNaN(Ee))throw ts.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Le=new h(1,0,0,1,se,Ee);this.ctx.transform=this.ctx.transform.multiply(Le)},p.prototype.transform=function(se,Ee,Le,Be,He,Ye){if(isNaN(se)||isNaN(Ee)||isNaN(Le)||isNaN(Be)||isNaN(He)||isNaN(Ye))throw ts.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var it=new h(se,Ee,Le,Be,He,Ye);this.ctx.transform=this.ctx.transform.multiply(it)},p.prototype.setTransform=function(se,Ee,Le,Be,He,Ye){se=isNaN(se)?1:se,Ee=isNaN(Ee)?0:Ee,Le=isNaN(Le)?0:Le,Be=isNaN(Be)?1:Be,He=isNaN(He)?0:He,Ye=isNaN(Ye)?0:Ye,this.ctx.transform=new h(se,Ee,Le,Be,He,Ye)};var $=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};p.prototype.drawImage=function(se,Ee,Le,Be,He,Ye,it,ct,Et){var Ft=this.pdf.getImageProperties(se),Wt=1,qt=1,kt=1,Pe=1;Be!==void 0&&ct!==void 0&&(kt=ct/Be,Pe=Et/He,Wt=Ft.width/Be*ct/Be,qt=Ft.height/He*Et/He),Ye===void 0&&(Ye=Ee,it=Le,Ee=0,Le=0),Be!==void 0&&ct===void 0&&(ct=Be,Et=He),Be===void 0&&ct===void 0&&(ct=Ft.width,Et=Ft.height);var $t=this.ctx.transform.decompose(),Pt=qe($t.rotate.shx),Tn=new h,_t=(Tn=(Tn=(Tn=Tn.multiply($t.translate)).multiply($t.skew)).multiply($t.scale)).applyToRectangle(new u(Ye-Ee*kt,it-Le*Pe,Be*Wt,He*qt));if(this.autoPaging){for(var rn,Jt=W.call(this,_t),En=[],wn=0;wn<Jt.length;wn+=1)En.indexOf(Jt[wn])===-1&&En.push(Jt[wn]);he(En);for(var Un=En[0],ii=En[En.length-1],Bn=Un;Bn<ii+1;Bn++){this.pdf.setPage(Bn);var li=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Xn=Bn===1?this.posY+this.margin[0]:this.margin[0],cn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],$n=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],hn=Bn===1?0:cn+(Bn-2)*$n;if(this.ctx.clip_path.length!==0){var nr=this.path;rn=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ge(rn,this.posX+this.margin[3],-hn+Xn+this.ctx.prevPageLastElemOffset),Ce.call(this,"fill",!0),this.path=nr}var Jn=JSON.parse(JSON.stringify(_t));Jn=ge([Jn],this.posX+this.margin[3],-hn+Xn+this.ctx.prevPageLastElemOffset)[0];var vn=(Bn>Un||Bn<ii)&&$.call(this);vn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],li,$n,null).clip().discardPath()),this.pdf.addImage(se,"JPEG",Jn.x,Jn.y,Jn.w,Jn.h,null,null,Pt),vn&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(se,"JPEG",_t.x,_t.y,_t.w,_t.h,null,null,Pt)};var W=function(se,Ee,Le){var Be=[];Ee=Ee||this.pdf.internal.pageSize.width,Le=Le||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var He=this.posY+this.ctx.prevPageLastElemOffset;switch(se.type){default:case"mt":case"lt":Be.push(Math.floor((se.y+He)/Le)+1);break;case"arc":Be.push(Math.floor((se.y+He-se.radius)/Le)+1),Be.push(Math.floor((se.y+He+se.radius)/Le)+1);break;case"qct":var Ye=lt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,se.x1,se.y1,se.x,se.y);Be.push(Math.floor((Ye.y+He)/Le)+1),Be.push(Math.floor((Ye.y+Ye.h+He)/Le)+1);break;case"bct":var it=Tt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,se.x1,se.y1,se.x2,se.y2,se.x,se.y);Be.push(Math.floor((it.y+He)/Le)+1),Be.push(Math.floor((it.y+it.h+He)/Le)+1);break;case"rect":Be.push(Math.floor((se.y+He)/Le)+1),Be.push(Math.floor((se.y+se.h+He)/Le)+1)}for(var ct=0;ct<Be.length;ct+=1)for(;this.pdf.internal.getNumberOfPages()<Be[ct];)q.call(this);return Be},q=function(){var se=this.fillStyle,Ee=this.strokeStyle,Le=this.font,Be=this.lineCap,He=this.lineWidth,Ye=this.lineJoin;this.pdf.addPage(),this.fillStyle=se,this.strokeStyle=Ee,this.font=Le,this.lineCap=Be,this.lineWidth=He,this.lineJoin=Ye},ge=function(se,Ee,Le){for(var Be=0;Be<se.length;Be++)switch(se[Be].type){case"bct":se[Be].x2+=Ee,se[Be].y2+=Le;case"qct":se[Be].x1+=Ee,se[Be].y1+=Le;default:se[Be].x+=Ee,se[Be].y+=Le}return se},he=function(se){return se.sort(function(Ee,Le){return Ee-Le})},me=function(se,Ee){var Le=this.fillStyle,Be=this.strokeStyle,He=this.lineCap,Ye=this.lineWidth,it=Math.abs(Ye*this.ctx.transform.scaleX),ct=this.lineJoin;if(this.autoPaging){for(var Et,Ft,Wt=JSON.parse(JSON.stringify(this.path)),qt=JSON.parse(JSON.stringify(this.path)),kt=[],Pe=0;Pe<qt.length;Pe++)if(qt[Pe].x!==void 0)for(var $t=W.call(this,qt[Pe]),Pt=0;Pt<$t.length;Pt+=1)kt.indexOf($t[Pt])===-1&&kt.push($t[Pt]);for(var Tn=0;Tn<kt.length;Tn++)for(;this.pdf.internal.getNumberOfPages()<kt[Tn];)q.call(this);he(kt);for(var _t=kt[0],rn=kt[kt.length-1],Jt=_t;Jt<rn+1;Jt++){this.pdf.setPage(Jt),this.fillStyle=Le,this.strokeStyle=Be,this.lineCap=He,this.lineWidth=it,this.lineJoin=ct;var En=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],wn=Jt===1?this.posY+this.margin[0]:this.margin[0],Un=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ii=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Bn=Jt===1?0:Un+(Jt-2)*ii;if(this.ctx.clip_path.length!==0){var li=this.path;Et=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ge(Et,this.posX+this.margin[3],-Bn+wn+this.ctx.prevPageLastElemOffset),Ce.call(this,se,!0),this.path=li}if(Ft=JSON.parse(JSON.stringify(Wt)),this.path=ge(Ft,this.posX+this.margin[3],-Bn+wn+this.ctx.prevPageLastElemOffset),Ee===!1||Jt===0){var Xn=(Jt>_t||Jt<rn)&&$.call(this);Xn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],En,ii,null).clip().discardPath()),Ce.call(this,se,Ee),Xn&&this.pdf.restoreGraphicsState()}this.lineWidth=Ye}this.path=Wt}else this.lineWidth=it,Ce.call(this,se,Ee),this.lineWidth=Ye},Ce=function(se,Ee){if((se!=="stroke"||Ee||!B.call(this))&&(se==="stroke"||Ee||!A.call(this))){for(var Le,Be,He=[],Ye=this.path,it=0;it<Ye.length;it++){var ct=Ye[it];switch(ct.type){case"begin":He.push({begin:!0});break;case"close":He.push({close:!0});break;case"mt":He.push({start:ct,deltas:[],abs:[]});break;case"lt":var Et=He.length;if(Ye[it-1]&&!isNaN(Ye[it-1].x)&&(Le=[ct.x-Ye[it-1].x,ct.y-Ye[it-1].y],Et>0)){for(;Et>=0;Et--)if(He[Et-1].close!==!0&&He[Et-1].begin!==!0){He[Et-1].deltas.push(Le),He[Et-1].abs.push(ct);break}}break;case"bct":Le=[ct.x1-Ye[it-1].x,ct.y1-Ye[it-1].y,ct.x2-Ye[it-1].x,ct.y2-Ye[it-1].y,ct.x-Ye[it-1].x,ct.y-Ye[it-1].y],He[He.length-1].deltas.push(Le);break;case"qct":var Ft=Ye[it-1].x+2/3*(ct.x1-Ye[it-1].x),Wt=Ye[it-1].y+2/3*(ct.y1-Ye[it-1].y),qt=ct.x+2/3*(ct.x1-ct.x),kt=ct.y+2/3*(ct.y1-ct.y),Pe=ct.x,$t=ct.y;Le=[Ft-Ye[it-1].x,Wt-Ye[it-1].y,qt-Ye[it-1].x,kt-Ye[it-1].y,Pe-Ye[it-1].x,$t-Ye[it-1].y],He[He.length-1].deltas.push(Le);break;case"arc":He.push({deltas:[],abs:[],arc:!0}),Array.isArray(He[He.length-1].abs)&&He[He.length-1].abs.push(ct)}}Be=Ee?null:se==="stroke"?"stroke":"fill";for(var Pt=!1,Tn=0;Tn<He.length;Tn++)if(He[Tn].arc)for(var _t=He[Tn].abs,rn=0;rn<_t.length;rn++){var Jt=_t[rn];Jt.type==="arc"?ee.call(this,Jt.x,Jt.y,Jt.radius,Jt.startAngle,Jt.endAngle,Jt.counterclockwise,void 0,Ee,!Pt):le.call(this,Jt.x,Jt.y),Pt=!0}else if(He[Tn].close===!0)this.pdf.internal.out("h"),Pt=!1;else if(He[Tn].begin!==!0){var En=He[Tn].start.x,wn=He[Tn].start.y;ze.call(this,He[Tn].deltas,En,wn),Pt=!0}Be&&J.call(this,Be),Ee&&ye.call(this)}},Ve=function(se){var Ee=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Le=Ee*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return se-Le;case"top":return se+Ee-Le;case"hanging":return se+Ee-2*Le;case"middle":return se+Ee/2-Le;default:return se}},pe=function(se){return se+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};p.prototype.createLinearGradient=function(){var se=function(){};return se.colorStops=[],se.addColorStop=function(Ee,Le){this.colorStops.push([Ee,Le])},se.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},se.isCanvasGradient=!0,se},p.prototype.createPattern=function(){return this.createLinearGradient()},p.prototype.createRadialGradient=function(){return this.createLinearGradient()};var ee=function(se,Ee,Le,Be,He,Ye,it,ct,Et){for(var Ft=je.call(this,Le,Be,He,Ye),Wt=0;Wt<Ft.length;Wt++){var qt=Ft[Wt];Wt===0&&(Et?X.call(this,qt.x1+se,qt.y1+Ee):le.call(this,qt.x1+se,qt.y1+Ee)),nt.call(this,se,Ee,qt.x2,qt.y2,qt.x3,qt.y3,qt.x4,qt.y4)}ct?ye.call(this):J.call(this,it)},J=function(se){switch(se){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},ye=function(){this.pdf.clip(),this.pdf.discardPath()},X=function(se,Ee){this.pdf.internal.out(t(se)+" "+n(Ee)+" m")},ae=function(se){var Ee;switch(se.align){case"right":case"end":Ee="right";break;case"center":Ee="center";break;default:Ee="left"}var Le,Be,He,Ye=this.pdf.getTextDimensions(se.text),it=Ve.call(this,se.y),ct=pe.call(this,it)-Ye.h,Et=this.ctx.transform.applyToPoint(new l(se.x,it));if(this.autoPaging){var Ft=this.ctx.transform.decompose(),Wt=new h;Wt=(Wt=(Wt=Wt.multiply(Ft.translate)).multiply(Ft.skew)).multiply(Ft.scale);for(var qt=this.ctx.transform.applyToRectangle(new u(se.x,it,Ye.w,Ye.h)),kt=Wt.applyToRectangle(new u(se.x,ct,Ye.w,Ye.h)),Pe=W.call(this,kt),$t=[],Pt=0;Pt<Pe.length;Pt+=1)$t.indexOf(Pe[Pt])===-1&&$t.push(Pe[Pt]);he($t);for(var Tn=$t[0],_t=$t[$t.length-1],rn=Tn;rn<_t+1;rn++){this.pdf.setPage(rn);var Jt=rn===1?this.posY+this.margin[0]:this.margin[0],En=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],wn=this.pdf.internal.pageSize.height-this.margin[2],Un=wn-this.margin[0],ii=this.pdf.internal.pageSize.width-this.margin[1],Bn=ii-this.margin[3],li=rn===1?0:En+(rn-2)*Un;if(this.ctx.clip_path.length!==0){var Xn=this.path;Le=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=ge(Le,this.posX+this.margin[3],-1*li+Jt),Ce.call(this,"fill",!0),this.path=Xn}var cn=ge([JSON.parse(JSON.stringify(kt))],this.posX+this.margin[3],-li+Jt+this.ctx.prevPageLastElemOffset)[0];se.scale>=.01&&(Be=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Be*se.scale),He=this.lineWidth,this.lineWidth=He*se.scale);var $n=this.autoPaging!=="text";if($n||cn.y+cn.h<=wn){if($n||cn.y>=Jt&&cn.x<=ii){var hn=$n?se.text:this.pdf.splitTextToSize(se.text,se.maxWidth||ii-cn.x)[0],nr=ge([JSON.parse(JSON.stringify(qt))],this.posX+this.margin[3],-li+Jt+this.ctx.prevPageLastElemOffset)[0],Jn=$n&&(rn>Tn||rn<_t)&&$.call(this);Jn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Bn,Un,null).clip().discardPath()),this.pdf.text(hn,nr.x,nr.y,{angle:se.angle,align:Ee,renderingMode:se.renderingMode}),Jn&&this.pdf.restoreGraphicsState()}}else cn.y<wn&&(this.ctx.prevPageLastElemOffset+=wn-cn.y);se.scale>=.01&&(this.pdf.setFontSize(Be),this.lineWidth=He)}}else se.scale>=.01&&(Be=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Be*se.scale),He=this.lineWidth,this.lineWidth=He*se.scale),this.pdf.text(se.text,Et.x+this.posX,Et.y+this.posY,{angle:se.angle,align:Ee,renderingMode:se.renderingMode,maxWidth:se.maxWidth}),se.scale>=.01&&(this.pdf.setFontSize(Be),this.lineWidth=He)},le=function(se,Ee,Le,Be){Le=Le||0,Be=Be||0,this.pdf.internal.out(t(se+Le)+" "+n(Ee+Be)+" l")},ze=function(se,Ee,Le){return this.pdf.lines(se,Ee,Le,null,null)},nt=function(se,Ee,Le,Be,He,Ye,it,ct){this.pdf.internal.out([e(r(Le+se)),e(s(Be+Ee)),e(r(He+se)),e(s(Ye+Ee)),e(r(it+se)),e(s(ct+Ee)),"c"].join(" "))},je=function(se,Ee,Le,Be){for(var He=2*Math.PI,Ye=Math.PI/2;Ee>Le;)Ee-=He;var it=Math.abs(Le-Ee);it<He&&Be&&(it=He-it);for(var ct=[],Et=Be?-1:1,Ft=Ee;it>1e-5;){var Wt=Ft+Et*Math.min(it,Ye);ct.push(Je.call(this,se,Ft,Wt)),it-=Math.abs(Wt-Ft),Ft=Wt}return ct},Je=function(se,Ee,Le){var Be=(Le-Ee)/2,He=se*Math.cos(Be),Ye=se*Math.sin(Be),it=He,ct=-Ye,Et=it*it+ct*ct,Ft=Et+it*He+ct*Ye,Wt=4/3*(Math.sqrt(2*Et*Ft)-Ft)/(it*Ye-ct*He),qt=it-Wt*ct,kt=ct+Wt*it,Pe=qt,$t=-kt,Pt=Be+Ee,Tn=Math.cos(Pt),_t=Math.sin(Pt);return{x1:se*Math.cos(Ee),y1:se*Math.sin(Ee),x2:qt*Tn-kt*_t,y2:qt*_t+kt*Tn,x3:Pe*Tn-$t*_t,y3:Pe*_t+$t*Tn,x4:se*Math.cos(Le),y4:se*Math.sin(Le)}},qe=function(se){return 180*se/Math.PI},lt=function(se,Ee,Le,Be,He,Ye){var it=se+.5*(Le-se),ct=Ee+.5*(Be-Ee),Et=He+.5*(Le-He),Ft=Ye+.5*(Be-Ye),Wt=Math.min(se,He,it,Et),qt=Math.max(se,He,it,Et),kt=Math.min(Ee,Ye,ct,Ft),Pe=Math.max(Ee,Ye,ct,Ft);return new u(Wt,kt,qt-Wt,Pe-kt)},Tt=function(se,Ee,Le,Be,He,Ye,it,ct){var Et,Ft,Wt,qt,kt,Pe,$t,Pt,Tn,_t,rn,Jt,En,wn,Un=Le-se,ii=Be-Ee,Bn=He-Le,li=Ye-Be,Xn=it-He,cn=ct-Ye;for(Ft=0;Ft<41;Ft++)Tn=($t=(Wt=se+(Et=Ft/40)*Un)+Et*((kt=Le+Et*Bn)-Wt))+Et*(kt+Et*(He+Et*Xn-kt)-$t),_t=(Pt=(qt=Ee+Et*ii)+Et*((Pe=Be+Et*li)-qt))+Et*(Pe+Et*(Ye+Et*cn-Pe)-Pt),Ft==0?(rn=Tn,Jt=_t,En=Tn,wn=_t):(rn=Math.min(rn,Tn),Jt=Math.min(Jt,_t),En=Math.max(En,Tn),wn=Math.max(wn,_t));return new u(Math.round(rn),Math.round(Jt),Math.round(En-rn),Math.round(wn-Jt))},Ne=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var se,Ee,Le=(se=this.ctx.lineDash,Ee=this.ctx.lineDashOffset,JSON.stringify({lineDash:se,lineDashOffset:Ee}));this.prevLineDash!==Le&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Le)}}})(Cn.API),(function(i){var e=function(l){var u,h,f,x,p,w,A,B,$,W;for(h=[],f=0,x=(l+=u="\0\0\0\0".slice(l.length%4||4)).length;x>f;f+=4)(p=(l.charCodeAt(f)<<24)+(l.charCodeAt(f+1)<<16)+(l.charCodeAt(f+2)<<8)+l.charCodeAt(f+3))!==0?(w=(p=((p=((p=((p=(p-(W=p%85))/85)-($=p%85))/85)-(B=p%85))/85)-(A=p%85))/85)%85,h.push(w+33,A+33,B+33,$+33,W+33)):h.push(122);return(function(q,ge){for(var he=ge;he>0;he--)q.pop()})(h,u.length),String.fromCharCode.apply(String,h)+"~>"},t=function(l){var u,h,f,x,p,w=String,A="length",B=255,$="charCodeAt",W="slice",q="replace";for(l[W](-2),l=l[W](0,-2)[q](/\s/g,"")[q]("z","!!!!!"),f=[],x=0,p=(l+=u="uuuuu"[W](l[A]%5||5))[A];p>x;x+=5)h=52200625*(l[$](x)-33)+614125*(l[$](x+1)-33)+7225*(l[$](x+2)-33)+85*(l[$](x+3)-33)+(l[$](x+4)-33),f.push(B&h>>24,B&h>>16,B&h>>8,B&h);return(function(ge,he){for(var me=he;me>0;me--)ge.pop()})(f,u[A]),w.fromCharCode.apply(w,f)},n=function(l){return l.split("").map(function(u){return("0"+u.charCodeAt().toString(16)).slice(-2)}).join("")+">"},r=function(l){var u=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((l=l.replace(/\s/g,"")).indexOf(">")!==-1&&(l=l.substr(0,l.indexOf(">"))),l.length%2&&(l+="0"),u.test(l)===!1)return"";for(var h="",f=0;f<l.length;f+=2)h+=String.fromCharCode("0x"+(l[f]+l[f+1]));return h},s=function(l){for(var u=new Uint8Array(l.length),h=l.length;h--;)u[h]=l.charCodeAt(h);return(u=Kx(u)).reduce(function(f,x){return f+String.fromCharCode(x)},"")};i.processDataByFilters=function(l,u){var h=0,f=l||"",x=[];for(typeof(u=u||[])=="string"&&(u=[u]),h=0;h<u.length;h+=1)switch(u[h]){case"ASCII85Decode":case"/ASCII85Decode":f=t(f),x.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":f=e(f),x.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":f=r(f),x.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":f=n(f),x.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":f=s(f),x.push("/FlateDecode");break;default:throw new Error('The filter: "'+u[h]+'" is not implemented')}return{data:f,reverseChain:x.reverse().join(" ")}}})(Cn.API),(function(i){i.loadFile=function(e,t,n){return(function(r,s,l){s=s!==!1,l=typeof l=="function"?l:function(){};var u=void 0;try{u=(function(h,f,x){var p=new XMLHttpRequest,w=0,A=function(B){var $=B.length,W=[],q=String.fromCharCode;for(w=0;w<$;w+=1)W.push(q(255&B.charCodeAt(w)));return W.join("")};if(p.open("GET",h,!f),p.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(p.onload=function(){p.status===200?x(A(this.responseText)):x(void 0)}),p.send(null),f&&p.status===200)return A(p.responseText)})(r,s,l)}catch{}return u})(e,t,n)},i.loadImageFile=i.loadFile})(Cn.API),(function(i){function e(){return(ai.html2canvas?Promise.resolve(ai.html2canvas):jt(()=>import("./chunk-1765887266800-html2canvas.esm.js"),[])).catch(function(u){return Promise.reject(new Error("Could not load html2canvas: "+u))}).then(function(u){return u.default?u.default:u})}function t(){return(ai.DOMPurify?Promise.resolve(ai.DOMPurify):jt(()=>import("./chunk-1765887266800-purify.es.js"),[])).catch(function(u){return Promise.reject(new Error("Could not load dompurify: "+u))}).then(function(u){return u.default?u.default:u})}var n=function(u){var h=zr(u);return h==="undefined"?"undefined":h==="string"||u instanceof String?"string":h==="number"||u instanceof Number?"number":h==="function"||u instanceof Function?"function":u&&u.constructor===Array?"array":u&&u.nodeType===1?"element":h==="object"?"object":"unknown"},r=function(u,h){var f=document.createElement(u);for(var x in h.className&&(f.className=h.className),h.innerHTML&&h.dompurify&&(f.innerHTML=h.dompurify.sanitize(h.innerHTML)),h.style)f.style[x]=h.style[x];return f},s=function u(h,f){for(var x=h.nodeType===3?document.createTextNode(h.nodeValue):h.cloneNode(!1),p=h.firstChild;p;p=p.nextSibling)f!==!0&&p.nodeType===1&&p.nodeName==="SCRIPT"||x.appendChild(u(p,f));return h.nodeType===1&&(h.nodeName==="CANVAS"?(x.width=h.width,x.height=h.height,x.getContext("2d").drawImage(h,0,0)):h.nodeName!=="TEXTAREA"&&h.nodeName!=="SELECT"||(x.value=h.value),x.addEventListener("load",function(){x.scrollTop=h.scrollTop,x.scrollLeft=h.scrollLeft},!0)),x},l=function u(h){var f=Object.assign(u.convert(Promise.resolve()),JSON.parse(JSON.stringify(u.template))),x=u.convert(Promise.resolve(),f);return(x=x.setProgress(1,u,1,[u])).set(h)};(l.prototype=Object.create(Promise.prototype)).constructor=l,l.convert=function(u,h){return u.__proto__=h||l.prototype,u},l.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},l.prototype.from=function(u,h){return this.then(function(){switch(h=h||(function(f){switch(n(f)){case"string":return"string";case"element":return f.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(u),h){case"string":return this.then(t).then(function(f){return this.set({src:r("div",{innerHTML:u,dompurify:f})})});case"element":return this.set({src:u});case"canvas":return this.set({canvas:u});case"img":return this.set({img:u});default:return this.error("Unknown source type.")}})},l.prototype.to=function(u){switch(u){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},l.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var u={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},h=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);h.tagName==="BODY"&&(u.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=r("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=r("div",{className:"html2pdf__container",style:u}),this.prop.container.appendChild(h),this.prop.container.firstChild.appendChild(r("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},l.prototype.toCanvas=function(){var u=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(u).then(e).then(function(h){var f=Object.assign({},this.opt.html2canvas);return delete f.onrendered,h(this.prop.container,f)}).then(function(h){(this.opt.html2canvas.onrendered||function(){})(h),this.prop.canvas=h,document.body.removeChild(this.prop.overlay)})},l.prototype.toContext2d=function(){var u=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(u).then(e).then(function(h){var f=this.opt.jsPDF,x=this.opt.fontFaces,p=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,w=Object.assign({async:!0,allowTaint:!0,scale:p,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete w.onrendered,f.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,f.context2d.posX=this.opt.x,f.context2d.posY=this.opt.y,f.context2d.margin=this.opt.margin,f.context2d.fontFaces=x,x)for(var A=0;A<x.length;++A){var B=x[A],$=B.src.find(function(W){return W.format==="truetype"});$&&f.addFont($.url,B.ref.name,B.ref.style)}return w.windowHeight=w.windowHeight||0,w.windowHeight=w.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):w.windowHeight,f.context2d.save(!0),h(this.prop.container,w)}).then(function(h){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(h),this.prop.canvas=h,document.body.removeChild(this.prop.overlay)})},l.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var u=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=u})},l.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},l.prototype.output=function(u,h,f){return(f=f||"pdf").toLowerCase()==="img"||f.toLowerCase()==="image"?this.outputImg(u,h):this.outputPdf(u,h)},l.prototype.outputPdf=function(u,h){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(u,h)})},l.prototype.outputImg=function(u){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(u){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+u+'" is not supported.'}})},l.prototype.save=function(u){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(u?{filename:u}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},l.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},l.prototype.set=function(u){if(n(u)!=="object")return this;var h=Object.keys(u||{}).map(function(f){if(f in l.template.prop)return function(){this.prop[f]=u[f]};switch(f){case"margin":return this.setMargin.bind(this,u.margin);case"jsPDF":return function(){return this.opt.jsPDF=u.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,u.pageSize);default:return function(){this.opt[f]=u[f]}}},this);return this.then(function(){return this.thenList(h)})},l.prototype.get=function(u,h){return this.then(function(){var f=u in l.template.prop?this.prop[u]:this.opt[u];return h?h(f):f})},l.prototype.setMargin=function(u){return this.then(function(){switch(n(u)){case"number":u=[u,u,u,u];case"array":if(u.length===2&&(u=[u[0],u[1],u[0],u[1]]),u.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=u}).then(this.setPageSize)},l.prototype.setPageSize=function(u){function h(f,x){return Math.floor(f*x/72*96)}return this.then(function(){(u=u||Cn.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(u.inner={width:u.width-this.opt.margin[1]-this.opt.margin[3],height:u.height-this.opt.margin[0]-this.opt.margin[2]},u.inner.px={width:h(u.inner.width,u.k),height:h(u.inner.height,u.k)},u.inner.ratio=u.inner.height/u.inner.width),this.prop.pageSize=u})},l.prototype.setProgress=function(u,h,f,x){return u!=null&&(this.progress.val=u),h!=null&&(this.progress.state=h),f!=null&&(this.progress.n=f),x!=null&&(this.progress.stack=x),this.progress.ratio=this.progress.val/this.progress.state,this},l.prototype.updateProgress=function(u,h,f,x){return this.setProgress(u?this.progress.val+u:null,h||null,f?this.progress.n+f:null,x?this.progress.stack.concat(x):null)},l.prototype.then=function(u,h){var f=this;return this.thenCore(u,h,function(x,p){return f.updateProgress(null,null,1,[x]),Promise.prototype.then.call(this,function(w){return f.updateProgress(null,x),w}).then(x,p).then(function(w){return f.updateProgress(1),w})})},l.prototype.thenCore=function(u,h,f){f=f||Promise.prototype.then;var x=this;u&&(u=u.bind(x)),h&&(h=h.bind(x));var p=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?x:l.convert(Object.assign({},x),Promise.prototype),w=f.call(p,u,h);return l.convert(w,x.__proto__)},l.prototype.thenExternal=function(u,h){return Promise.prototype.then.call(this,u,h)},l.prototype.thenList=function(u){var h=this;return u.forEach(function(f){h=h.thenCore(f)}),h},l.prototype.catch=function(u){u&&(u=u.bind(this));var h=Promise.prototype.catch.call(this,u);return l.convert(h,this)},l.prototype.catchExternal=function(u){return Promise.prototype.catch.call(this,u)},l.prototype.error=function(u){return this.then(function(){throw new Error(u)})},l.prototype.using=l.prototype.set,l.prototype.saveAs=l.prototype.save,l.prototype.export=l.prototype.output,l.prototype.run=l.prototype.then,Cn.getPageSize=function(u,h,f){if(zr(u)==="object"){var x=u;u=x.orientation,h=x.unit||h,f=x.format||f}h=h||"mm",f=f||"a4",u=(""+(u||"P")).toLowerCase();var p,w=(""+f).toLowerCase(),A={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(h){case"pt":p=1;break;case"mm":p=72/25.4;break;case"cm":p=72/2.54;break;case"in":p=72;break;case"px":p=.75;break;case"pc":case"em":p=12;break;case"ex":p=6;break;default:throw"Invalid unit: "+h}var B,$=0,W=0;if(A.hasOwnProperty(w))$=A[w][1]/p,W=A[w][0]/p;else try{$=f[1],W=f[0]}catch{throw new Error("Invalid format: "+f)}if(u==="p"||u==="portrait")u="p",W>$&&(B=W,W=$,$=B);else{if(u!=="l"&&u!=="landscape")throw"Invalid orientation: "+u;u="l",$>W&&(B=W,W=$,$=B)}return{width:W,height:$,unit:h,k:p,orientation:u}},i.html=function(u,h){(h=h||{}).callback=h.callback||function(){},h.html2canvas=h.html2canvas||{},h.html2canvas.canvas=h.html2canvas.canvas||this.canvas,h.jsPDF=h.jsPDF||this,h.fontFaces=h.fontFaces?h.fontFaces.map(Mb):null;var f=new l(h);return h.worker?f:f.from(u).doCallback()}})(Cn.API),Cn.API.addJS=function(i){return zk=i,this.internal.events.subscribe("postPutResources",function(){d0=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(d0+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Vk=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+zk+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){d0!==void 0&&Vk!==void 0&&this.internal.out("/Names <</JavaScript "+d0+" 0 R>>")}),this},(function(i){var e;i.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=t.outline.render().split(/\r\n/),s=0;s<r.length;s++){var l=r[s],u=n.exec(l);if(u!=null){var h=u[1];t.internal.newObjectDeferredBegin(h,!1)}t.internal.write(l)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,x=[];for(s=0;s<f;s++){var p=t.internal.newObject();x.push(p);var w=t.internal.getPageInfo(s+1);t.internal.write("<< /D["+w.objId+" 0 R /XYZ null null null]>> endobj")}var A=t.internal.newObject();for(t.internal.write("<< /Names [ "),s=0;s<x.length;s++)t.internal.write("(page_"+(s+1)+")"+x[s]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+A+" 0 R"),t.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),i.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(n,r,s){var l={title:r,options:s,children:[]};return n==null&&(n=this.root),n.children.push(l),l},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(n){n.id=t.internal.newObjectDeferred();for(var r=0;r<n.children.length;r++)this.genIds_r(n.children[r])},t.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},t.outline.renderItems=function(n){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var l=n.children[s];this.objStart(l),this.line("/Title "+this.makeString(l.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),l.children.length>0&&(this.line("/First "+this.makeRef(l.children[0])),this.line("/Last "+this.makeRef(l.children[l.children.length-1])));var u=this.count=this.count_r({count:0},l);if(u>0&&this.line("/Count "+u),l.options&&l.options.pageNumber){var h=t.internal.getPageInfo(l.options.pageNumber);this.line("/Dest ["+h.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},t.outline.line=function(n){this.ctx.val+=n+`\r
`},t.outline.makeRef=function(n){return n.id+" 0 R"},t.outline.makeString=function(n){return"("+t.internal.pdfEscape(n)+")"},t.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(n,r){for(var s=0;s<r.children.length;s++)n.count++,this.count_r(n,r.children[s]);return n.count}}])})(Cn.API),(function(i){var e=[192,193,194,195,196,197,198,199];i.processJPEG=function(t,n,r,s,l,u){var h,f=this.decode.DCT_DECODE,x=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=l||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,h=(function(p){for(var w,A=256*p.charCodeAt(4)+p.charCodeAt(5),B=p.length,$={width:0,height:0,numcomponents:1},W=4;W<B;W+=2){if(W+=A,e.indexOf(p.charCodeAt(W+1))!==-1){w=256*p.charCodeAt(W+5)+p.charCodeAt(W+6),$={width:256*p.charCodeAt(W+7)+p.charCodeAt(W+8),height:w,numcomponents:p.charCodeAt(W+9)};break}A=256*p.charCodeAt(W+2)+p.charCodeAt(W+3)}return $})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),h.numcomponents){case 1:u=this.color_spaces.DEVICE_GRAY;break;case 4:u=this.color_spaces.DEVICE_CMYK;break;case 3:u=this.color_spaces.DEVICE_RGB}x={data:t,width:h.width,height:h.height,colorSpace:u,bitsPerComponent:8,filter:f,index:n,alias:r}}return x}})(Cn.API),Cn.API.processPNG=function(i,e,t,n){if(this.__addimage__.isArrayBuffer(i)&&(i=new Uint8Array(i)),this.__addimage__.isArrayBufferView(i)){var r,s=bW(i,{checkCrc:!0}),l=s.width,u=s.height,h=s.channels,f=s.palette,x=s.depth;r=f&&h===1?(function(ee){for(var J=ee.width,ye=ee.height,X=ee.data,ae=ee.palette,le=ee.depth,ze=!1,nt=[],je=[],Je=void 0,qe=!1,lt=0,Tt=0;Tt<ae.length;Tt++){var Ne=HI(ae[Tt],4),se=Ne[0],Ee=Ne[1],Le=Ne[2],Be=Ne[3];nt.push(se,Ee,Le),Be!=null&&(Be===0?(lt++,je.length<1&&je.push(Tt)):Be<255&&(qe=!0))}if(qe||lt>1){ze=!0,je=void 0;var He=J*ye;Je=new Uint8Array(He);for(var Ye=new DataView(X.buffer),it=0;it<He;it++){var ct=jb(Ye,it,le),Et=HI(ae[ct],4)[3];Je[it]=Et}}else lt===0&&(je=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:ze?8:void 0,colorBytes:X,alphaBytes:Je,needSMask:ze,palette:nt,mask:je}})(s):h===2||h===4?(function(ee){for(var J=ee.data,ye=ee.width,X=ee.height,ae=ee.channels,le=ee.depth,ze=ae===2?"DeviceGray":"DeviceRGB",nt=ae-1,je=ye*X,Je=nt,qe=je*Je,lt=1*je,Tt=Math.ceil(qe*le/8),Ne=Math.ceil(lt*le/8),se=new Uint8Array(Tt),Ee=new Uint8Array(Ne),Le=new DataView(J.buffer),Be=new DataView(se.buffer),He=new DataView(Ee.buffer),Ye=!1,it=0;it<je;it++){for(var ct=it*ae,Et=0;Et<Je;Et++)Yk(Be,jb(Le,ct+Et,le),it*Je+Et,le);var Ft=jb(Le,ct+Je,le);Ft<(1<<le)-1&&(Ye=!0),Yk(He,Ft,1*it,le)}return{colorSpace:ze,colorsPerPixel:nt,sMaskBitsPerComponent:Ye?le:void 0,colorBytes:se,alphaBytes:Ee,needSMask:Ye}})(s):(function(ee){var J=ee.data,ye=ee.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:ye,colorsPerPixel:ye==="DeviceGray"?1:3,colorBytes:J instanceof Uint16Array?(function(X){for(var ae=X.length,le=new Uint8Array(2*ae),ze=new DataView(le.buffer,le.byteOffset,le.byteLength),nt=0;nt<ae;nt++)ze.setUint16(2*nt,X[nt],!1);return le})(J):J,needSMask:!1}})(s);var p,w,A,B=r,$=B.colorSpace,W=B.colorsPerPixel,q=B.sMaskBitsPerComponent,ge=B.colorBytes,he=B.alphaBytes,me=B.needSMask,Ce=B.palette,Ve=B.mask,pe=null;return n!==Cn.API.image_compression.NONE&&typeof Kx=="function"?(pe=(function(ee){var J;switch(ee){case Cn.API.image_compression.FAST:J=11;break;case Cn.API.image_compression.MEDIUM:J=13;break;case Cn.API.image_compression.SLOW:J=14;break;default:J=12}return J})(n),p=this.decode.FLATE_DECODE,w="/Predictor ".concat(pe," /Colors ").concat(W," /BitsPerComponent ").concat(x," /Columns ").concat(l),i=Hk(ge,Math.ceil(l*W*x/8),W,x,n),me&&(A=Hk(he,Math.ceil(l*q/8),1,q,n))):(p=void 0,w=void 0,i=ge,me&&(A=he)),(this.__addimage__.isArrayBuffer(i)||this.__addimage__.isArrayBufferView(i))&&(i=this.__addimage__.arrayBufferToBinaryString(i)),(A&&this.__addimage__.isArrayBuffer(A)||this.__addimage__.isArrayBufferView(A))&&(A=this.__addimage__.arrayBufferToBinaryString(A)),{alias:t,data:i,index:e,filter:p,decodeParameters:w,transparency:Ve,palette:Ce,sMask:A,predictor:pe,width:l,height:u,bitsPerComponent:x,sMaskBitsPerComponent:q,colorSpace:$}}},(function(i){i.processGIF89A=function(e,t,n,r){var s=new UW(e),l=s.width,u=s.height,h=[];s.decodeAndBlitFrameRGBA(0,h);var f={data:h,width:l,height:u},x=new Vb(100).encode(f,100);return i.processJPEG.call(this,x,t,n,r)},i.processGIF87A=i.processGIF89A})(Cn.API),Au.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var e=0;e<i;e++){var t=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:r,green:n,blue:t,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Au.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[i]()}catch(t){ts.log("bit decode error:"+t)}},Au.prototype.bit1=function(){var i,e=Math.ceil(this.width/8),t=e%4;for(i=this.height-1;i>=0;i--){for(var n=this.bottom_up?i:this.height-1-i,r=0;r<e;r++)for(var s=this.datav.getUint8(this.pos++,!0),l=n*this.width*4+8*r*4,u=0;u<8&&8*r+u<this.width;u++){var h=this.palette[s>>7-u&1];this.data[l+4*u]=h.blue,this.data[l+4*u+1]=h.green,this.data[l+4*u+2]=h.red,this.data[l+4*u+3]=255}t!==0&&(this.pos+=4-t)}},Au.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),e=i%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<i;r++){var s=this.datav.getUint8(this.pos++,!0),l=n*this.width*4+2*r*4,u=s>>4,h=15&s,f=this.palette[u];if(this.data[l]=f.blue,this.data[l+1]=f.green,this.data[l+2]=f.red,this.data[l+3]=255,2*r+1>=this.width)break;f=this.palette[h],this.data[l+4]=f.blue,this.data[l+4+1]=f.green,this.data[l+4+2]=f.red,this.data[l+4+3]=255}e!==0&&(this.pos+=4-e)}},Au.prototype.bit8=function(){for(var i=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;if(r<this.palette.length){var l=this.palette[r];this.data[s]=l.red,this.data[s+1]=l.green,this.data[s+2]=l.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}i!==0&&(this.pos+=4-i)}},Au.prototype.bit15=function(){for(var i=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(s&e)/e*255|0,u=(s>>5&e)/e*255|0,h=(s>>10&e)/e*255|0,f=s>>15?255:0,x=n*this.width*4+4*r;this.data[x]=h,this.data[x+1]=u,this.data[x+2]=l,this.data[x+3]=f}this.pos+=i}},Au.prototype.bit16=function(){for(var i=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var u=(l&e)/e*255|0,h=(l>>5&t)/t*255|0,f=(l>>11)/e*255|0,x=r*this.width*4+4*s;this.data[x]=f,this.data[x+1]=h,this.data[x+2]=u,this.data[x+3]=255}this.pos+=i}},Au.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*t;this.data[l]=s,this.data[l+1]=r,this.data[l+2]=n,this.data[l+3]=255}this.pos+=this.width%4}},Au.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),u=e*this.width*4+4*t;this.data[u]=s,this.data[u+1]=r,this.data[u+2]=n,this.data[u+3]=l}},Au.prototype.getData=function(){return this.data},(function(i){i.processBMP=function(e,t,n,r){var s=new Au(e,!1),l=s.width,u=s.height,h={data:s.getData(),width:l,height:u},f=new Vb(100).encode(h,100);return i.processJPEG.call(this,f,t,n,r)}})(Cn.API),Jk.prototype.getData=function(){return this.data},(function(i){i.processWEBP=function(e,t,n,r){var s=new Jk(e),l=s.width,u=s.height,h={data:s.getData(),width:l,height:u},f=new Vb(100).encode(h,100);return i.processJPEG.call(this,f,t,n,r)}})(Cn.API),Cn.API.processRGBA=function(i,e,t){for(var n=i.data,r=n.length,s=new Uint8Array(r/4*3),l=new Uint8Array(r/4),u=0,h=0,f=0;f<r;f+=4){var x=n[f],p=n[f+1],w=n[f+2],A=n[f+3];s[u++]=x,s[u++]=p,s[u++]=w,l[h++]=A}var B=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(l),data:B,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},Cn.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Bf=Cn.API,f0=Bf.getCharWidthsArray=function(i,e){var t,n,r=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),l=e.charSpace||this.internal.getCharSpace(),u=e.widths?e.widths:r.metadata.Unicode.widths,h=u.fof?u.fof:1,f=e.kerning?e.kerning:r.metadata.Unicode.kerning,x=f.fof?f.fof:1,p=e.doKerning!==!1,w=0,A=i.length,B=0,$=u[0]||h,W=[];for(t=0;t<A;t++)n=i.charCodeAt(t),typeof r.metadata.widthOfString=="function"?W.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(n))+l*(1e3/s)||0)/1e3):(w=p&&zr(f[n])==="object"&&!isNaN(parseInt(f[n][B],10))?f[n][B]/x:0,W.push((u[n]||$)/h+w)),B=n;return W},Uk=Bf.getStringUnitWidth=function(i,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),r=e.charSpace||this.internal.getCharSpace();return Bf.processArabic&&(i=Bf.processArabic(i)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(i,t,r)/t:f0.apply(this,arguments).reduce(function(s,l){return s+l},0)},Bk=function(i,e,t,n){for(var r=[],s=0,l=i.length,u=0;s!==l&&u+e[s]<t;)u+=e[s],s++;r.push(i.slice(0,s));var h=s;for(u=0;s!==l;)u+e[s]>n&&(r.push(i.slice(h,s)),u=0,h=s),u+=e[s],s++;return h!==s&&r.push(i.slice(h,s)),r},$k=function(i,e,t){t||(t={});var n,r,s,l,u,h,f,x=[],p=[x],w=t.textIndent||0,A=0,B=0,$=i.split(" "),W=f0.apply(this,[" ",t])[0];if(h=t.lineIndent===-1?$[0].length+2:t.lineIndent||0){var q=Array(h).join(" "),ge=[];$.map(function(me){(me=me.split(/\s*\n/)).length>1?ge=ge.concat(me.map(function(Ce,Ve){return(Ve&&Ce.length?`
`:"")+Ce})):ge.push(me[0])}),$=ge,h=Uk.apply(this,[q,t])}for(s=0,l=$.length;s<l;s++){var he=0;if(n=$[s],h&&n[0]==`
`&&(n=n.substr(1),he=1),w+A+(B=(r=f0.apply(this,[n,t])).reduce(function(me,Ce){return me+Ce},0))>e||he){if(B>e){for(u=Bk.apply(this,[n,r,e-(w+A),e]),x.push(u.shift()),x=[u.pop()];u.length;)p.push([u.shift()]);B=r.slice(n.length-(x[0]?x[0].length:0)).reduce(function(me,Ce){return me+Ce},0)}else x=[n];p.push(x),w=B+h,A=W}else x.push(n),w+=A+B,A=W}return f=h?function(me,Ce){return(Ce?q:"")+me.join(" ")}:function(me){return me.join(" ")},p.map(f)},Bf.splitTextToSize=function(i,e,t){var n,r=(t=t||{}).fontSize||this.internal.getFontSize(),s=(function(x){if(x.widths&&x.kerning)return{widths:x.widths,kerning:x.kerning};var p=this.internal.getFont(x.fontName,x.fontStyle),w="Unicode";return p.metadata[w]?{widths:p.metadata[w].widths||{0:1},kerning:p.metadata[w].kerning||{}}:{font:p.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);n=Array.isArray(i)?i:String(i).split(/\r?\n/);var l=1*this.internal.scaleFactor*e/r;s.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/r:0,s.lineIndent=t.lineIndent;var u,h,f=[];for(u=0,h=n.length;u<h;u++)f=f.concat($k.apply(this,[n[u],l,s]));return f},(function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",n={},r={},s=0;s<16;s++)n[t[s]]=e[s],r[e[s]]=t[s];var l=function(w){return"0x"+parseInt(w,10).toString(16)},u=i.__fontmetrics__.compress=function(w){var A,B,$,W,q=["{"];for(var ge in w){if(A=w[ge],isNaN(parseInt(ge,10))?B="'"+ge+"'":(ge=parseInt(ge,10),B=(B=l(ge).slice(2)).slice(0,-1)+r[B.slice(-1)]),typeof A=="number")A<0?($=l(A).slice(3),W="-"):($=l(A).slice(2),W=""),$=W+$.slice(0,-1)+r[$.slice(-1)];else{if(zr(A)!=="object")throw new Error("Don't know what to do with value type "+zr(A)+".");$=u(A)}q.push(B+$)}return q.push("}"),q.join("")},h=i.__fontmetrics__.uncompress=function(w){if(typeof w!="string")throw new Error("Invalid argument passed to uncompress.");for(var A,B,$,W,q={},ge=1,he=q,me=[],Ce="",Ve="",pe=w.length-1,ee=1;ee<pe;ee+=1)(W=w[ee])=="'"?A?($=A.join(""),A=void 0):A=[]:A?A.push(W):W=="{"?(me.push([he,$]),he={},$=void 0):W=="}"?((B=me.pop())[0][B[1]]=he,$=void 0,he=B[0]):W=="-"?ge=-1:$===void 0?n.hasOwnProperty(W)?(Ce+=n[W],$=parseInt(Ce,16)*ge,ge=1,Ce=""):Ce+=W:n.hasOwnProperty(W)?(Ve+=n[W],he[$]=parseInt(Ve,16)*ge,ge=1,$=void 0,Ve=""):Ve+=W;return q},f={codePages:["WinAnsiEncoding"],WinAnsiEncoding:h("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},x={Unicode:{Courier:f,"Courier-Bold":f,"Courier-BoldOblique":f,"Courier-Oblique":f,Helvetica:f,"Helvetica-Bold":f,"Helvetica-BoldOblique":f,"Helvetica-Oblique":f,"Times-Roman":f,"Times-Bold":f,"Times-BoldItalic":f,"Times-Italic":f}},p={Unicode:{"Courier-Oblique":h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":h("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":h("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":h("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:h("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:h("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":h("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:h("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":h("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":h("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":h("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(w){var A=w.font,B=p.Unicode[A.postScriptName];B&&(A.metadata.Unicode={},A.metadata.Unicode.widths=B.widths,A.metadata.Unicode.kerning=B.kerning);var $=x.Unicode[A.postScriptName];$&&(A.metadata.Unicode.encoding=$,A.encoding=$.codePages[0])}])})(Cn.API),(function(i){var e=function(t){for(var n=t.length,r=new Uint8Array(n),s=0;s<n;s++)r[s]=t.charCodeAt(s);return r};i.API.events.push(["addFont",function(t){var n=void 0,r=t.font,s=t.instance;if(!r.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if(typeof(n=s.existsFileInVFS(r.postScriptName)===!1?s.loadFile(r.postScriptName):s.getFileFromVFS(r.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");(function(l,u){u=/^\x00\x01\x00\x00/.test(u)?e(u):e(M0(u)),l.metadata=i.API.TTFFont.open(u),l.metadata.Unicode=l.metadata.Unicode||{encoding:{},kerning:{},widths:[]},l.metadata.glyIdsUsed=[0]})(r,n)}}])})(Cn),Cn.API.addSvgAsImage=function(i,e,t,n,r,s,l,u){if(isNaN(e)||isNaN(t))throw ts.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(r))throw ts.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var h=document.createElement("canvas");h.width=n,h.height=r;var f=h.getContext("2d");f.fillStyle="#fff",f.fillRect(0,0,h.width,h.height);var x={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},p=this;return(ai.canvg?Promise.resolve(ai.canvg):jt(()=>import("./chunk-1765887266800-index.es.js"),[])).catch(function(w){return Promise.reject(new Error("Could not load canvg: "+w))}).then(function(w){return w.default?w.default:w}).then(function(w){return w.fromString(f,i,x)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(w){return w.render(x)}).then(function(){p.addImage(h.toDataURL("image/jpeg",1),e,t,n,r,l,u)})},Cn.API.putTotalPages=function(i){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(i,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var r=0;r<this.internal.pages[n].length;r++)this.internal.pages[n][r]=this.internal.pages[n][r].replace(e,t);return this},Cn.API.viewerPreferences=function(i,e){var t;i=i||{},e=e||!1;var n,r,s,l={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},u=Object.keys(l),h=[],f=0,x=0,p=0;function w(B,$){var W,q=!1;for(W=0;W<B.length;W+=1)B[W]===$&&(q=!0);return q}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(l)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,i==="reset"||e===!0){var A=u.length;for(p=0;p<A;p+=1)t[u[p]].value=t[u[p]].defaultValue,t[u[p]].explicitSet=!1}if(zr(i)==="object"){for(r in i)if(s=i[r],w(u,r)&&s!==void 0){if(t[r].type==="boolean"&&typeof s=="boolean")t[r].value=s;else if(t[r].type==="name"&&w(t[r].valueSet,s))t[r].value=s;else if(t[r].type==="integer"&&Number.isInteger(s))t[r].value=s;else if(t[r].type==="array"){for(f=0;f<s.length;f+=1)if(n=!0,s[f].length===1&&typeof s[f][0]=="number")h.push(String(s[f]-1));else if(s[f].length>1){for(x=0;x<s[f].length;x+=1)typeof s[f][x]!="number"&&(n=!1);n===!0&&h.push([s[f][0]-1,s[f][1]-1].join(" "))}t[r].value="["+h.join(" ")+"]"}else t[r].value=t[r].defaultValue;t[r].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var B,$=[];for(B in t)t[B].explicitSet===!0&&(t[B].type==="name"?$.push("/"+B+" /"+t[B].value):$.push("/"+B+" "+t[B].value));$.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+$.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(i){var e=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',r=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),l=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),u=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),h=unescape(encodeURIComponent("</x:xmpmeta>")),f=s.length+l.length+u.length+r.length+h.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(r+s+l+u+h),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(n,r){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(Cn.API),(function(i){var e=i.API,t=e.pdfEscape16=function(s,l){for(var u,h=l.metadata.Unicode.widths,f=["","0","00","000","0000"],x=[""],p=0,w=s.length;p<w;++p){if(u=l.metadata.characterToGlyph(s.charCodeAt(p)),l.metadata.glyIdsUsed.push(u),l.metadata.toUnicode[u]=s.charCodeAt(p),h.indexOf(u)==-1&&(h.push(u),h.push([parseInt(l.metadata.widthOfGlyph(u),10)])),u=="0")return x.join("");u=u.toString(16),x.push(f[4-u.length],u)}return x.join("")},n=function(s){var l,u,h,f,x,p,w;for(x=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,h=[],p=0,w=(u=Object.keys(s).sort(function(A,B){return A-B})).length;p<w;p++)l=u[p],h.length>=100&&(x+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar`,h=[]),s[l]!==void 0&&s[l]!==null&&typeof s[l].toString=="function"&&(f=("0000"+s[l].toString(16)).slice(-4),l=("0000"+(+l).toString(16)).slice(-4),h.push("<"+l+"><"+f+">"));return h.length&&(x+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar
`),x+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(s){(function(l){var u=l.font,h=l.out,f=l.newObject,x=l.putStream;if(u.metadata instanceof i.API.TTFFont&&u.encoding==="Identity-H"){for(var p=u.metadata.Unicode.widths,w=u.metadata.subset.encode(u.metadata.glyIdsUsed,1),A="",B=0;B<w.length;B++)A+=String.fromCharCode(w[B]);var $=f();x({data:A,addLength1:!0,objectId:$}),h("endobj");var W=f();x({data:n(u.metadata.toUnicode),addLength1:!0,objectId:W}),h("endobj");var q=f();h("<<"),h("/Type /FontDescriptor"),h("/FontName /"+Jf(u.fontName)),h("/FontFile2 "+$+" 0 R"),h("/FontBBox "+i.API.PDFObject.convert(u.metadata.bbox)),h("/Flags "+u.metadata.flags),h("/StemV "+u.metadata.stemV),h("/ItalicAngle "+u.metadata.italicAngle),h("/Ascent "+u.metadata.ascender),h("/Descent "+u.metadata.decender),h("/CapHeight "+u.metadata.capHeight),h(">>"),h("endobj");var ge=f();h("<<"),h("/Type /Font"),h("/BaseFont /"+Jf(u.fontName)),h("/FontDescriptor "+q+" 0 R"),h("/W "+i.API.PDFObject.convert(p)),h("/CIDToGIDMap /Identity"),h("/DW 1000"),h("/Subtype /CIDFontType2"),h("/CIDSystemInfo"),h("<<"),h("/Supplement 0"),h("/Registry (Adobe)"),h("/Ordering ("+u.encoding+")"),h(">>"),h(">>"),h("endobj"),u.objectNumber=f(),h("<<"),h("/Type /Font"),h("/Subtype /Type0"),h("/ToUnicode "+W+" 0 R"),h("/BaseFont /"+Jf(u.fontName)),h("/Encoding /"+u.encoding),h("/DescendantFonts ["+ge+" 0 R]"),h(">>"),h("endobj"),u.isAlreadyPutted=!0}})(s)}]),e.events.push(["putFont",function(s){(function(l){var u=l.font,h=l.out,f=l.newObject,x=l.putStream;if(u.metadata instanceof i.API.TTFFont&&u.encoding==="WinAnsiEncoding"){for(var p=u.metadata.rawData,w="",A=0;A<p.length;A++)w+=String.fromCharCode(p[A]);var B=f();x({data:w,addLength1:!0,objectId:B}),h("endobj");var $=f();x({data:n(u.metadata.toUnicode),addLength1:!0,objectId:$}),h("endobj");var W=f();h("<<"),h("/Descent "+u.metadata.decender),h("/CapHeight "+u.metadata.capHeight),h("/StemV "+u.metadata.stemV),h("/Type /FontDescriptor"),h("/FontFile2 "+B+" 0 R"),h("/Flags 96"),h("/FontBBox "+i.API.PDFObject.convert(u.metadata.bbox)),h("/FontName /"+Jf(u.fontName)),h("/ItalicAngle "+u.metadata.italicAngle),h("/Ascent "+u.metadata.ascender),h(">>"),h("endobj"),u.objectNumber=f();for(var q=0;q<u.metadata.hmtx.widths.length;q++)u.metadata.hmtx.widths[q]=parseInt(u.metadata.hmtx.widths[q]*(1e3/u.metadata.head.unitsPerEm));h("<</Subtype/TrueType/Type/Font/ToUnicode "+$+" 0 R/BaseFont/"+Jf(u.fontName)+"/FontDescriptor "+W+" 0 R/Encoding/"+u.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(u.metadata.hmtx.widths)+">>"),h("endobj"),u.isAlreadyPutted=!0}})(s)}]);var r=function(s){var l,u=s.text||"",h=s.x,f=s.y,x=s.options||{},p=s.mutex||{},w=p.pdfEscape,A=p.activeFontKey,B=p.fonts,$=A,W="",q=0,ge="",he=B[$].encoding;if(B[$].encoding!=="Identity-H")return{text:u,x:h,y:f,options:x,mutex:p};for(ge=u,$=A,Array.isArray(u)&&(ge=u[0]),q=0;q<ge.length;q+=1)B[$].metadata.hasOwnProperty("cmap")&&(l=B[$].metadata.cmap.unicode.codeMap[ge[q].charCodeAt(0)]),l||ge[q].charCodeAt(0)<256&&B[$].metadata.hasOwnProperty("Unicode")?W+=ge[q]:W+="";var me="";return parseInt($.slice(1))<14||he==="WinAnsiEncoding"?me=w(W,$).split("").map(function(Ce){return Ce.charCodeAt(0).toString(16)}).join(""):he==="Identity-H"&&(me=t(W,B[$])),p.isHex=!0,{text:me,x:h,y:f,options:x,mutex:p}};e.events.push(["postProcessText",function(s){var l=s.text||"",u=[],h={text:l,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(l)){var f=0;for(f=0;f<l.length;f+=1)Array.isArray(l[f])&&l[f].length===3?u.push([r(Object.assign({},h,{text:l[f][0]})).text,l[f][1],l[f][2]]):u.push(r(Object.assign({},h,{text:l[f]})).text);s.text=u}else s.text=r(Object.assign({},h,{text:l})).text}])})(Cn),(function(i){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},i.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},i.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(Cn.API),(function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(n){var r,s,l,u,h,f,x,p=e,w=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],A=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],B={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},$={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},W=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],q=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),ge=!1,he=0;this.__bidiEngine__={};var me=function(X){var ae=X.charCodeAt(),le=ae>>8,ze=$[le];return ze!==void 0?p[256*ze+(255&ae)]:le===252||le===253?"AL":q.test(le)?"L":le===8?"R":"N"},Ce=function(X){for(var ae,le=0;le<X.length;le++){if((ae=me(X.charAt(le)))==="L")return!1;if(ae==="R")return!0}return!1},Ve=function(X,ae,le,ze){var nt,je,Je,qe,lt=ae[ze];switch(lt){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":ge=!1;break;case"N":case"AN":break;case"EN":ge&&(lt="AN");break;case"AL":ge=!0,lt="R";break;case"WS":case"BN":lt="N";break;case"CS":ze<1||ze+1>=ae.length||(nt=le[ze-1])!=="EN"&&nt!=="AN"||(je=ae[ze+1])!=="EN"&&je!=="AN"?lt="N":ge&&(je="AN"),lt=je===nt?je:"N";break;case"ES":lt=(nt=ze>0?le[ze-1]:"B")==="EN"&&ze+1<ae.length&&ae[ze+1]==="EN"?"EN":"N";break;case"ET":if(ze>0&&le[ze-1]==="EN"){lt="EN";break}if(ge){lt="N";break}for(Je=ze+1,qe=ae.length;Je<qe&&ae[Je]==="ET";)Je++;lt=Je<qe&&ae[Je]==="EN"?"EN":"N";break;case"NSM":if(l&&!u){for(qe=ae.length,Je=ze+1;Je<qe&&ae[Je]==="NSM";)Je++;if(Je<qe){var Tt=X[ze],Ne=Tt>=1425&&Tt<=2303||Tt===64286;if(nt=ae[Je],Ne&&(nt==="R"||nt==="AL")){lt="R";break}}}lt=ze<1||(nt=ae[ze-1])==="B"?"N":le[ze-1];break;case"B":ge=!1,r=!0,lt=he;break;case"S":s=!0,lt="N"}return lt},pe=function(X,ae,le){var ze=X.split("");return le&&ee(ze,le,{hiLevel:he}),ze.reverse(),ae&&ae.reverse(),ze.join("")},ee=function(X,ae,le){var ze,nt,je,Je,qe,lt=-1,Tt=X.length,Ne=0,se=[],Ee=he?A:w,Le=[];for(ge=!1,r=!1,s=!1,nt=0;nt<Tt;nt++)Le[nt]=me(X[nt]);for(je=0;je<Tt;je++){if(qe=Ne,se[je]=Ve(X,Le,se,je),ze=240&(Ne=Ee[qe][B[se[je]]]),Ne&=15,ae[je]=Je=Ee[Ne][5],ze>0)if(ze===16){for(nt=lt;nt<je;nt++)ae[nt]=1;lt=-1}else lt=-1;if(Ee[Ne][6])lt===-1&&(lt=je);else if(lt>-1){for(nt=lt;nt<je;nt++)ae[nt]=Je;lt=-1}Le[je]==="B"&&(ae[je]=0),le.hiLevel|=Je}s&&(function(Be,He,Ye){for(var it=0;it<Ye;it++)if(Be[it]==="S"){He[it]=he;for(var ct=it-1;ct>=0&&Be[ct]==="WS";ct--)He[ct]=he}})(Le,ae,Tt)},J=function(X,ae,le,ze,nt){if(!(nt.hiLevel<X)){if(X===1&&he===1&&!r)return ae.reverse(),void(le&&le.reverse());for(var je,Je,qe,lt,Tt=ae.length,Ne=0;Ne<Tt;){if(ze[Ne]>=X){for(qe=Ne+1;qe<Tt&&ze[qe]>=X;)qe++;for(lt=Ne,Je=qe-1;lt<Je;lt++,Je--)je=ae[lt],ae[lt]=ae[Je],ae[Je]=je,le&&(je=le[lt],le[lt]=le[Je],le[Je]=je);Ne=qe}Ne++}}},ye=function(X,ae,le){var ze=X.split(""),nt={hiLevel:he};return le||(le=[]),ee(ze,le,nt),(function(je,Je,qe){if(qe.hiLevel!==0&&x)for(var lt,Tt=0;Tt<je.length;Tt++)Je[Tt]===1&&(lt=W.indexOf(je[Tt]))>=0&&(je[Tt]=W[lt+1])})(ze,le,nt),J(2,ze,ae,le,nt),J(1,ze,ae,le,nt),ze.join("")};return this.__bidiEngine__.doBidiReorder=function(X,ae,le){if((function(nt,je){if(je)for(var Je=0;Je<nt.length;Je++)je[Je]=Je;u===void 0&&(u=Ce(nt)),f===void 0&&(f=Ce(nt))})(X,ae),l||!h||f)if(l&&h&&u^f)he=u?1:0,X=pe(X,ae,le);else if(!l&&h&&f)he=u?1:0,X=ye(X,ae,le),X=pe(X,ae);else if(!l||u||h||f){if(l&&!h&&u^f)X=pe(X,ae),u?(he=0,X=ye(X,ae,le)):(he=1,X=ye(X,ae,le),X=pe(X,ae));else if(l&&u&&!h&&f)he=1,X=ye(X,ae,le),X=pe(X,ae);else if(!l&&!h&&u^f){var ze=x;u?(he=1,X=ye(X,ae,le),he=0,x=!1,X=ye(X,ae,le),x=ze):(he=0,X=ye(X,ae,le),X=pe(X,ae),he=1,x=!1,X=ye(X,ae,le),x=ze,X=pe(X,ae))}}else he=0,X=ye(X,ae,le);else he=u?1:0,X=ye(X,ae,le);return X},this.__bidiEngine__.setOptions=function(X){X&&(l=X.isInputVisual,h=X.isOutputVisual,u=X.isInputRtl,f=X.isOutputRtl,x=X.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(n){var r=n.text;n.x,n.y;var s=n.options||{};n.mutex,s.lang;var l=[];if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,t.setOptions(s),Object.prototype.toString.call(r)==="[object Array]"){var u=0;for(l=[],u=0;u<r.length;u+=1)Object.prototype.toString.call(r[u])==="[object Array]"?l.push([t.doBidiReorder(r[u][0]),r[u][1],r[u][2]]):l.push([t.doBidiReorder(r[u])]);n.text=l}else n.text=t.doBidiReorder(r);t.setOptions({isInputVisual:!0})}])})(Cn),Cn.API.TTFFont=(function(){function i(e){var t;if(this.rawData=e,t=this.contents=new ld(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new nq(this),this.registerTTF()}return i.open=function(e){return new i(e)},i.prototype.parse=function(){return this.directory=new BW(this.contents),this.head=new HW(this),this.name=new YW(this),this.cmap=new sN(this),this.toUnicode={},this.hhea=new GW(this),this.maxp=new XW(this),this.hmtx=new JW(this),this.post=new WW(this),this.os2=new KW(this),this.loca=new tq(this),this.glyf=new QW(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var e,t,n,r,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var l,u,h,f;for(f=[],l=0,u=(h=this.bbox).length;l<u;l++)e=h[l],f.push(Math.round(e*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},i.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},i.prototype.widthOfString=function(e,t,n){var r,s,l,u;for(l=0,s=0,u=(e=""+e).length;0<=u?s<u:s>u;s=0<=u?++s:--s)r=e.charCodeAt(s),l+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return l*(t/1e3)},i.prototype.lineHeight=function(e,t){var n;return t==null&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},i})();var Ou,ld=(function(){function i(e){this.data=e??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(e){return this.data[this.pos++]=e},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},i.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},i.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},i.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},i.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(e){return this.writeInt16(e)},i.prototype.readLongLong=function(){var e,t,n,r,s,l,u,h;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),s=this.readByte(),l=this.readByte(),u=this.readByte(),h=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^s)+65536*(255^l)+256*(255^u)+(255^h)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*s+65536*l+256*u+h},i.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(e){return this.writeInt32(e)},i.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},i.prototype.write=function(e){var t,n,r,s;for(s=[],n=0,r=e.length;n<r;n++)t=e[n],s.push(this.writeByte(t));return s},i})(),BW=(function(){var i;function e(t){var n,r,s;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},r=0,s=this.tableCount;0<=s?r<s:r>s;r=0<=s?++r:--r)n={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(t){var n,r,s,l,u,h,f,x,p,w,A,B,$;for($ in A=Object.keys(t).length,h=Math.log(2),p=16*Math.floor(Math.log(A)/h),l=Math.floor(p/h),x=16*A-p,(r=new ld).writeInt(this.scalarType),r.writeShort(A),r.writeShort(p),r.writeShort(l),r.writeShort(x),s=16*A,f=r.pos+s,u=null,B=[],t)for(w=t[$],r.writeString($),r.writeInt(i(w)),r.writeInt(f),r.writeInt(w.length),B=B.concat(w),$==="head"&&(u=f),f+=w.length;f%4;)B.push(0),f++;return r.write(B),n=2981146554-i(r.data),r.pos=u+8,r.writeUInt32(n),r.data},i=function(t){var n,r,s,l;for(t=aN.call(t);t.length%4;)t.push(0);for(s=new ld(t),r=0,n=0,l=t.length;n<l;n=n+=4)r+=s.readUInt32();return 4294967295&r},e})(),$W={}.hasOwnProperty,cc=function(i,e){for(var t in e)$W.call(e,t)&&(i[t]=e[t]);function n(){this.constructor=i}return n.prototype=e.prototype,i.prototype=new n,i.__super__=e.prototype,i};Ou=(function(){function i(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i})();var HW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="head",i.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},i.prototype.encode=function(e){var t;return(t=new ld).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},i})(),Qk=(function(){function i(e,t){var n,r,s,l,u,h,f,x,p,w,A,B,$,W,q,ge,he;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),p=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(h=0;h<256;++h)this.codeMap[h]=e.readByte();break;case 4:for(A=e.readUInt16(),w=A/2,e.pos+=6,s=(function(){var me,Ce;for(Ce=[],h=me=0;0<=w?me<w:me>w;h=0<=w?++me:--me)Ce.push(e.readUInt16());return Ce})(),e.pos+=2,$=(function(){var me,Ce;for(Ce=[],h=me=0;0<=w?me<w:me>w;h=0<=w?++me:--me)Ce.push(e.readUInt16());return Ce})(),f=(function(){var me,Ce;for(Ce=[],h=me=0;0<=w?me<w:me>w;h=0<=w?++me:--me)Ce.push(e.readUInt16());return Ce})(),x=(function(){var me,Ce;for(Ce=[],h=me=0;0<=w?me<w:me>w;h=0<=w?++me:--me)Ce.push(e.readUInt16());return Ce})(),r=(this.length-e.pos+this.offset)/2,u=(function(){var me,Ce;for(Ce=[],h=me=0;0<=r?me<r:me>r;h=0<=r?++me:--me)Ce.push(e.readUInt16());return Ce})(),h=q=0,he=s.length;q<he;h=++q)for(W=s[h],n=ge=B=$[h];B<=W?ge<=W:ge>=W;n=B<=W?++ge:--ge)x[h]===0?l=n+f[h]:(l=u[x[h]/2+(n-B)-(w-h)]||0)!==0&&(l+=f[h]),this.codeMap[n]=65535&l}e.pos=p}return i.encode=function(e,t){var n,r,s,l,u,h,f,x,p,w,A,B,$,W,q,ge,he,me,Ce,Ve,pe,ee,J,ye,X,ae,le,ze,nt,je,Je,qe,lt,Tt,Ne,se,Ee,Le,Be,He,Ye,it,ct,Et,Ft,Wt;switch(ze=new ld,l=Object.keys(e).sort(function(qt,kt){return qt-kt}),t){case"macroman":for($=0,W=(function(){var qt=[];for(B=0;B<256;++B)qt.push(0);return qt})(),ge={0:0},s={},nt=0,lt=l.length;nt<lt;nt++)ge[ct=e[r=l[nt]]]==null&&(ge[ct]=++$),s[r]={old:e[r],new:ge[e[r]]},W[r]=ge[e[r]];return ze.writeUInt16(1),ze.writeUInt16(0),ze.writeUInt32(12),ze.writeUInt16(0),ze.writeUInt16(262),ze.writeUInt16(0),ze.write(W),{charMap:s,subtable:ze.data,maxGlyphID:$+1};case"unicode":for(ae=[],p=[],he=0,ge={},n={},q=f=null,je=0,Tt=l.length;je<Tt;je++)ge[Ce=e[r=l[je]]]==null&&(ge[Ce]=++he),n[r]={old:Ce,new:ge[Ce]},u=ge[Ce]-r,q!=null&&u===f||(q&&p.push(q),ae.push(r),f=u),q=r;for(q&&p.push(q),p.push(65535),ae.push(65535),ye=2*(J=ae.length),ee=2*Math.pow(Math.log(J)/Math.LN2,2),w=Math.log(ee/2)/Math.LN2,pe=2*J-ee,h=[],Ve=[],A=[],B=Je=0,Ne=ae.length;Je<Ne;B=++Je){if(X=ae[B],x=p[B],X===65535){h.push(0),Ve.push(0);break}if(X-(le=n[X].new)>=32768)for(h.push(0),Ve.push(2*(A.length+J-B)),r=qe=X;X<=x?qe<=x:qe>=x;r=X<=x?++qe:--qe)A.push(n[r].new);else h.push(le-X),Ve.push(0)}for(ze.writeUInt16(3),ze.writeUInt16(1),ze.writeUInt32(12),ze.writeUInt16(4),ze.writeUInt16(16+8*J+2*A.length),ze.writeUInt16(0),ze.writeUInt16(ye),ze.writeUInt16(ee),ze.writeUInt16(w),ze.writeUInt16(pe),Ye=0,se=p.length;Ye<se;Ye++)r=p[Ye],ze.writeUInt16(r);for(ze.writeUInt16(0),it=0,Ee=ae.length;it<Ee;it++)r=ae[it],ze.writeUInt16(r);for(Et=0,Le=h.length;Et<Le;Et++)u=h[Et],ze.writeUInt16(u);for(Ft=0,Be=Ve.length;Ft<Be;Ft++)me=Ve[Ft],ze.writeUInt16(me);for(Wt=0,He=A.length;Wt<He;Wt++)$=A[Wt],ze.writeUInt16($);return{charMap:n,subtable:ze.data,maxGlyphID:he+1}}},i})(),sN=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="cmap",i.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new Qk(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},i.encode=function(e,t){var n,r;return t==null&&(t="macroman"),n=Qk.encode(e,t),(r=new ld).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},i})(),GW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="hhea",i.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},i})(),KW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="OS/2",i.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n})(),this.charRange=(function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},i})(),WW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="post",i.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(n=e.readUInt16(),this.glyphNameIndex=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=(function(){var l,u,h;for(h=[],s=l=0,u=this.file.maxp.numGlyphs;0<=u?l<u:l>u;s=0<=u?++l:--l)h.push(e.readUInt32());return h}).call(this)}},i})(),qW=function(i,e){this.raw=i,this.length=i.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},YW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="name",i.prototype.parse=function(e){var t,n,r,s,l,u,h,f,x,p,w;for(e.pos=this.offset,e.readShort(),t=e.readShort(),u=e.readShort(),n=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+u+e.readShort()});for(h={},s=x=0,p=n.length;x<p;s=++x)r=n[s],e.pos=r.offset,f=e.readString(r.length),l=new qW(f,r),h[w=r.nameID]==null&&(h[w]=[]),h[r.nameID].push(l);this.strings=h,this.copyright=h[0],this.fontFamily=h[1],this.fontSubfamily=h[2],this.uniqueSubfamily=h[3],this.fontName=h[4],this.version=h[5];try{this.postscriptName=h[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=h[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=h[7],this.manufacturer=h[8],this.designer=h[9],this.description=h[10],this.vendorUrl=h[11],this.designerUrl=h[12],this.license=h[13],this.licenseUrl=h[14],this.preferredFamily=h[15],this.preferredSubfamily=h[17],this.compatibleFull=h[18],this.sampleText=h[19]},i})(),XW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="maxp",i.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},i})(),JW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="hmtx",i.prototype.parse=function(e){var t,n,r,s,l,u,h;for(e.pos=this.offset,this.metrics=[],t=0,u=this.file.hhea.numberOfMetrics;0<=u?t<u:t>u;t=0<=u?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var f,x;for(x=[],t=f=0;0<=r?f<r:f>r;t=0<=r?++f:--f)x.push(e.readInt16());return x})(),this.widths=(function(){var f,x,p,w;for(w=[],f=0,x=(p=this.metrics).length;f<x;f++)s=p[f],w.push(s.advance);return w}).call(this),n=this.widths[this.widths.length-1],h=[],t=l=0;0<=r?l<r:l>r;t=0<=r?++l:--l)h.push(this.widths.push(n));return h},i.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},i})(),aN=[].slice,QW=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="glyf",i.prototype.parse=function(){return this.cache={}},i.prototype.glyphFor=function(e){var t,n,r,s,l,u,h,f,x,p;return e in this.cache?this.cache[e]:(s=this.file.loca,t=this.file.contents,n=s.indexOf(e),(r=s.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+n,l=(u=new ld(t.read(r))).readShort(),f=u.readShort(),p=u.readShort(),h=u.readShort(),x=u.readShort(),this.cache[e]=l===-1?new eq(u,f,p,h,x):new ZW(u,l,f,p,h,x),this.cache[e]))},i.prototype.encode=function(e,t,n){var r,s,l,u,h;for(l=[],s=[],u=0,h=t.length;u<h;u++)r=e[t[u]],s.push(l.length),r&&(l=l.concat(r.encode(n)));return s.push(l.length),{table:l,offsets:s}},i})(),ZW=(function(){function i(e,t,n,r,s,l){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=s,this.yMax=l,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i})(),eq=(function(){function i(e,t,n,r,s){var l,u;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],l=this.raw;u=l.readShort(),this.glyphOffsets.push(l.pos),this.glyphIDs.push(l.readUInt16()),32&u;)l.pos+=1&u?4:2,128&u?l.pos+=8:64&u?l.pos+=4:8&u&&(l.pos+=2)}return i.prototype.encode=function(){var e,t,n;for(t=new ld(aN.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},i})(),tq=(function(){function i(){return i.__super__.constructor.apply(this,arguments)}return cc(i,Ou),i.prototype.tag="loca",i.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var r,s;for(s=[],n=0,r=this.length;n<r;n+=2)s.push(2*e.readUInt16());return s}).call(this):(function(){var r,s;for(s=[],n=0,r=this.length;n<r;n+=4)s.push(e.readUInt32());return s}).call(this)},i.prototype.indexOf=function(e){return this.offsets[e]},i.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},i.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,s=0,l=0;l<n.length;++l)if(n[l]=r,s<t.length&&t[s]==l){++s,n[l]=r;var u=this.offsets[l],h=this.offsets[l+1]-u;h>0&&(r+=h)}for(var f=new Array(4*n.length),x=0;x<n.length;++x)f[4*x+3]=255&n[x],f[4*x+2]=(65280&n[x])>>8,f[4*x+1]=(16711680&n[x])>>16,f[4*x]=(4278190080&n[x])>>24;return f},i})(),nq=(function(){function i(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var e,t,n,r,s;for(t in r=this.font.cmap.tables[0].codeMap,e={},s=this.subset)n=s[t],e[t]=r[n];return e},i.prototype.glyphsFor=function(e){var t,n,r,s,l,u,h;for(r={},l=0,u=e.length;l<u;l++)r[s=e[l]]=this.font.glyf.glyphFor(s);for(s in t=[],r)(n=r[s])!=null&&n.compound&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(s in h=this.glyphsFor(t))n=h[s],r[s]=n;return r},i.prototype.encode=function(e,t){var n,r,s,l,u,h,f,x,p,w,A,B,$,W,q;for(r in n=sN.encode(this.generateCmap(),"unicode"),l=this.glyphsFor(e),A={0:0},q=n.charMap)A[(h=q[r]).old]=h.new;for(B in w=n.maxGlyphID,l)B in A||(A[B]=w++);return x=(function(ge){var he,me;for(he in me={},ge)me[ge[he]]=he;return me})(A),p=Object.keys(x).sort(function(ge,he){return ge-he}),$=(function(){var ge,he,me;for(me=[],ge=0,he=p.length;ge<he;ge++)u=p[ge],me.push(x[u]);return me})(),s=this.font.glyf.encode(l,$,A),f=this.font.loca.encode(s.offsets,$),W={cmap:this.font.cmap.raw(),glyf:s.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(W["OS/2"]=this.font.os2.raw()),this.font.directory.encode(W)},i})();Cn.API.PDFObject=(function(){var i;function e(){}return i=function(t,n){return(Array(n+1).join("0")+t).slice(-n)},e.convert=function(t){var n,r,s,l;if(Array.isArray(t))return"["+(function(){var u,h,f;for(f=[],u=0,h=t.length;u<h;u++)n=t[u],f.push(e.convert(n));return f})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+i(t.getUTCFullYear(),4)+i(t.getUTCMonth(),2)+i(t.getUTCDate(),2)+i(t.getUTCHours(),2)+i(t.getUTCMinutes(),2)+i(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(r in s=["<<"],t)l=t[r],s.push("/"+r+" "+e.convert(l));return s.push(">>"),s.join(`
`)}return""+t},e})();const U0=Bl("Share",{web:()=>jt(()=>import("./chunk-1765887266800-web9.js"),[]).then(i=>new i.ShareWeb)}),LY=Object.freeze(Object.defineProperty({__proto__:null,Share:U0},Symbol.toStringTag,{value:"Module"}));class iq{async savePDFMobile(e,t){try{if(wo.isNativePlatform()){const n=e.output("datauristring").split(",")[1],r=await P0.writeFile({path:t,data:n,directory:up.Cache});await U0.share({title:"Helio Health Report",text:"Your health report from Helio",url:r.uri,dialogTitle:"Share your report"}),alert(" PDF ready to share!")}else e.save(t)}catch(n){alert("Failed to save PDF: "+n.message)}}async exportDailyStats(e){const t=new Cn,n=new Date().toLocaleDateString();t.setFontSize(20),t.text("Helio Daily Health Report",20,20),t.setFontSize(12),t.text(`Date: ${n}`,20,30),t.setFontSize(14),t.text("Daily Activity Summary",20,45),t.setFontSize(11);let r=55;t.text(`Steps: ${e.todaySteps} / ${e.goalSteps}`,25,r),r+=8,t.text(`Water: ${e.waterCups} / 8 cups`,25,r),r+=8,t.text(`Meals Logged: ${e.mealsLogged}`,25,r),r+=8,t.text(`Streak: ${e.streak} days`,25,r),r+=8,t.text(`Level: ${e.level} | XP: ${e.xp}`,25,r),r+=8,t.text(`Wellness Score: ${e.wellnessScore}/100`,25,r),r+=15,t.setFontSize(14),t.text("Weekly Steps Summary",20,r),r+=10,t.setFontSize(10);const s=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];e.weeklySteps?.forEach((l,u)=>{t.text(`${s[u]}: ${l.steps||0} steps`,25,r),r+=7}),t.setFontSize(8),t.text("Generated by Helio/WellnessAI",20,280),t.text("This report is for informational purposes only",20,285),await this.savePDFMobile(t,`helio-daily-report-${n.replace(/\//g,"-")}.pdf`)}async exportWorkoutHistory(){const e=new Cn,t=JSON.parse(localStorage.getItem("workoutHistory")||"[]"),n=new Date().toLocaleDateString();e.setFontSize(20),e.text("Workout History",20,20),e.setFontSize(12),e.text(`Total Workouts: ${t.length}`,20,30),e.text(`Exported: ${n}`,20,37),e.setFontSize(11);let r=50;t.length===0?e.text("No workouts logged yet",25,r):t.slice(0,30).forEach((s,l)=>{r>270&&(e.addPage(),r=20);const u=new Date(s.date).toLocaleDateString();e.text(`${l+1}. ${s.name}`,25,r),r+=6,e.setFontSize(9),e.text(`   Date: ${u} | Duration: ${s.duration||"N/A"} | Calories: ${s.calories||"N/A"}`,25,r),r+=8,e.setFontSize(11)}),e.setFontSize(8),e.text("Generated by Helio/WellnessAI",20,285),await this.savePDFMobile(e,`helio-workout-history-${n.replace(/\//g,"-")}.pdf`)}async exportFoodLog(){const e=new Cn,t=JSON.parse(localStorage.getItem("foodLog")||"[]"),n=new Date().toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()-30);const s=t.filter(W=>new Date(W.timestamp||W.date)>=r).sort((W,q)=>new Date(q.timestamp||q.date)-new Date(W.timestamp||W.date));e.setFontSize(20),e.text("Complete Nutrition History",20,20),e.setFontSize(12),e.text("Period: Last 30 Days",20,30),e.text(`Total Meals: ${s.length}`,20,37);let l=0,u=0,h=0,f=0;s.forEach(W=>{l+=W.calories||0,u+=W.protein||0,h+=W.carbs||0,f+=W.fat||0});const x=Math.max(1,s.length>0?30:1),p=Math.round(l/x),w=Math.round(u/x),A=Math.round(h/x),B=Math.round(f/x);e.setFontSize(14),e.text("30-Day Totals & Averages",20,50),e.setFontSize(11),e.text(`Total Calories: ${l} kcal (Avg: ${p}/day)`,25,58),e.text(`Total Protein: ${u}g (Avg: ${w}g/day)`,25,65),e.text(`Total Carbs: ${h}g (Avg: ${A}g/day)`,25,72),e.text(`Total Fat: ${f}g (Avg: ${B}g/day)`,25,79),e.setFontSize(14),e.text("Recent Meals (Last 30 Days)",20,95),e.setFontSize(10);let $=105;s.length===0?e.text("No foods logged in last 30 days",25,$):s.slice(0,100).forEach((W,q)=>{$>270&&(e.addPage(),$=20);const ge=new Date(W.timestamp||W.date),he=ge.toLocaleDateString(),me=ge.toLocaleTimeString();e.text(`${q+1}. ${W.name}`,25,$),$+=5,e.setFontSize(8),e.text(`   ${he} ${me} | ${W.calories}cal | P:${W.protein}g C:${W.carbs}g F:${W.fat}g`,25,$),$+=8,e.setFontSize(10)}),e.setFontSize(8),e.text("Generated by Helio/WellnessAI",20,285),await this.savePDFMobile(e,`helio-nutrition-${n}.pdf`)}async exportFullReport(e){const t=new Cn,n=new Date().toLocaleDateString();t.setFontSize(24),t.text("Helio Health Report",20,30),t.setFontSize(14),t.text("Complete Wellness Summary",20,45),t.setFontSize(12),t.text(`Generated: ${n}`,20,55),t.text(`User: ${localStorage.getItem("userName")||"User"}`,20,62),t.addPage(),t.setFontSize(18),t.text("Activity & Fitness",20,20),t.setFontSize(11);let r=35;t.text(`Steps Today: ${e.todaySteps}`,25,r),r+=8,t.text(`Goal: ${e.goalSteps} steps`,25,r),r+=8,t.text(`Completion: ${Math.round(e.todaySteps/e.goalSteps*100)}%`,25,r),r+=8,t.text(`Active Streak: ${e.streak} days`,25,r),r+=8,t.text(`Level: ${e.level} (${e.xp} XP)`,25,r),r+=15,t.setFontSize(14),t.text("Weekly Steps",25,r),r+=10,t.setFontSize(10);const s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];e.weeklySteps?.forEach((x,p)=>{t.text(`${s[p]}: ${x.steps||0} steps`,30,r),r+=7}),t.addPage(),t.setFontSize(18),t.text("Workouts & Nutrition",20,20),t.setFontSize(14),r=35;const l=JSON.parse(localStorage.getItem("workoutHistory")||"[]"),u=l.length,h=l.reduce((x,p)=>x+(p.calories||0),0),f=l.filter(x=>{const p=new Date(x.date),w=new Date;return w.setDate(w.getDate()-7),p>=w}).length;t.text("Workout Summary",25,r),r+=10,t.setFontSize(11),t.text(`Total Workouts: ${u}`,30,r),r+=7,t.text(`Workouts Last 7 Days: ${f}`,30,r),r+=7,t.text(`Total Calories Burned: ${h}`,30,r),r+=15,t.setFontSize(14),t.text("Nutrition & Hydration",25,r),r+=10,t.setFontSize(11),t.text(`Water Intake Today: ${e.waterCups} / 8 cups`,30,r),r+=7,t.text(`Meals Logged Today: ${e.mealsLogged}`,30,r),r+=7,t.text(`Hydration Level: ${Math.round(e.waterCups/8*100)}%`,30,r),r+=15,t.addPage(),t.setFontSize(18),t.text("Health Monitoring & Wellness",20,20),t.setFontSize(14),r=35,t.text("24/7 Health Monitoring",25,r),r+=10,t.setFontSize(11),t.text(`Heart Rate: ${e.heartRate?e.heartRate+" bpm":"Not monitored"}`,30,r),r+=7,t.text(`Sleep Last Night: ${e.sleepHours?e.sleepHours+" hours":"Not tracked"}`,30,r),r+=7,t.text("Fall Detection: Active",30,r),r+=7,t.text("Emergency Features: Enabled",30,r),r+=15,t.setFontSize(14),t.text("Wellness Analysis",25,r),r+=10,t.setFontSize(11),t.text(`Overall Wellness Score: ${e.wellnessScore}/100`,25,r),r+=10,t.setFontSize(10),t.text("This score is calculated based on:",25,r),r+=7,t.text(" Daily activity and steps",30,r),r+=6,t.text(" Nutrition and hydration",30,r),r+=6,t.text(" Sleep quality",30,r),r+=6,t.text(" Consistency and streaks",30,r),r+=6,t.text(" Mental wellness activities",30,r),t.setFontSize(8),t.text("Generated by Helio/WellnessAI",20,280),t.text("This report is for informational purposes only and not medical advice",20,285),await this.savePDFMobile(t,`helio-full-report-${n.replace(/\//g,"-")}.pdf`)}async exportWorkoutHistoryCSV(){try{const e=JSON.parse(localStorage.getItem("workoutHistory")||"[]"),t=new Date().toLocaleDateString().replace(/\//g,"-");if(e.length===0){alert("No workout data to export");return}let n=`Date,Workout Name,Type,Duration (min),Calories,Sets,Reps,Notes
`;if(e.forEach(r=>{const s=new Date(r.date).toLocaleDateString(),l=(r.name||"Workout").replace(/,/g,";"),u=r.type||"General",h=r.duration||"N/A",f=r.calories||0,x=r.sets||"N/A",p=r.reps||"N/A",w=(r.notes||"").replace(/,/g,";").replace(/\n/g," ");n+=`${s},${l},${u},${h},${f},${x},${p},${w}
`}),wo.isNativePlatform()){const r=btoa(unescape(encodeURIComponent(n))),s=await P0.writeFile({path:`helio-workouts-${t}.csv`,data:r,directory:up.Cache});await U0.share({title:"Helio Workout History",text:"Your workout history CSV",url:s.uri,dialogTitle:"Share workout data"}),alert(" CSV ready to share!")}else{const r=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(r),s.download=`helio-workouts-${t}.csv`,s.click()}}catch(e){console.error(" CSV export error:",e),alert("Failed to export CSV: "+e.message)}}async exportFoodLogCSV(){try{const e=JSON.parse(localStorage.getItem("foodLog")||"[]"),t=new Date().toLocaleDateString().replace(/\//g,"-"),n=new Date;n.setDate(n.getDate()-30);const r=e.filter(l=>new Date(l.timestamp||l.date)>=n).sort((l,u)=>new Date(u.timestamp||u.date)-new Date(l.timestamp||l.date));if(r.length===0){alert("No food data to export");return}let s=`Date,Time,Food Name,Calories,Protein (g),Carbs (g),Fat (g),Meal Type
`;if(r.forEach(l=>{const u=new Date(l.timestamp||l.date),h=u.toLocaleDateString(),f=u.toLocaleTimeString(),x=(l.name||"Food").replace(/,/g,";"),p=l.calories||0,w=l.protein||0,A=l.carbs||0,B=l.fat||0,$=l.mealType||"Snack";s+=`${h},${f},${x},${p},${w},${A},${B},${$}
`}),wo.isNativePlatform()){const l=btoa(unescape(encodeURIComponent(s))),u=await P0.writeFile({path:`helio-nutrition-${t}.csv`,data:l,directory:up.Cache});await U0.share({title:"Helio Nutrition History",text:"Your nutrition history CSV",url:u.uri,dialogTitle:"Share nutrition data"}),alert(" CSV ready to share!")}else{const l=new Blob([s],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a");u.href=URL.createObjectURL(l),u.download=`helio-nutrition-${t}.csv`,u.click()}}catch(e){console.error(" CSV export error:",e),alert("Failed to export CSV: "+e.message)}}}const Lh=new iq;class rq{constructor(){this.authorizedDeviceIds=["85e89dbedd0cda70","a8f5d227622e766f","CPH2551","OPPO CPH2551","cph2551","oppo cph2551"],this.devPassword="helio2025dev",this.isDevMode=!1,this.storageKey="helio_dev_mode"}async initialize(){try{if(!wo.isNativePlatform())return this.isDevMode=!1,!1;const t=(await qf.getId()).identifier;return this.authorizedDeviceIds.some(s=>t.includes(s)||s.includes(t))?(localStorage.getItem(this.storageKey)==="true"&&(this.isDevMode=!0),!0):(this.isDevMode=!1,!1)}catch{return!1}}async isAuthorizedDevice(){try{if(!wo.isNativePlatform())return!1;const e=await qf.getId(),n=(e.identifier||e.uuid||"").toLowerCase(),r=this.authorizedDeviceIds.some(s=>{const l=s.toLowerCase(),u=n.includes(l)||l.includes(n);return u});return r}catch{return!1}}async unlockDevMode(e){try{if(wo.isNativePlatform()){const n=await qf.getId()}return await this.isAuthorizedDevice()?e===this.devPassword?(this.isDevMode=!0,localStorage.setItem(this.storageKey,"true"),{success:!0,message:"Developer mode enabled"}):{success:!1,message:"Incorrect password"}:{success:!1,message:"Unauthorized device - Check console for device ID"}}catch{return{success:!1,message:"Authentication failed"}}}lockDevMode(){this.isDevMode=!1,localStorage.removeItem(this.storageKey)}isDevModeActive(){return this.isDevMode}async getDeviceInfo(){try{const e=await qf.getInfo(),t=await qf.getId();return{...e,identifier:t.identifier,isAuthorized:await this.isAuthorizedDevice()}}catch{return null}}changePassword(e,t){return e===this.devPassword?(this.devPassword=t,!0):!1}resetAuthorization(){localStorage.removeItem("authorized_device_id"),localStorage.removeItem(this.storageKey),this.authorizedDeviceId=null,this.isDevMode=!1}}const zb=new rq,Zk="G-N7GR8ES3GW";class sq{constructor(){this.events=[],this.sessionStart=Date.now(),this.sessionId=this.generateSessionId(),this.maxEvents=1e3,this.analyticsInitialized=!1}initGoogleAnalytics(){if(this.analyticsInitialized)return;const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${Zk}`,document.head.appendChild(e),window.dataLayer=window.dataLayer||[];function t(){window.dataLayer.push(arguments)}window.gtag=t,t("js",new Date),t("config",Zk,{send_page_view:!1,app_name:"Helio WellnessAI",app_version:"1.0.0"}),this.analyticsInitialized=!0}generateSessionId(){return`analytics_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}trackPageView(e){this.trackEvent("page_view",{page:e,url:window.location.href}),window.gtag&&window.gtag("event","screen_view",{screen_name:e,app_name:"Helio WellnessAI"})}trackFeatureUse(e,t={}){this.trackEvent("feature_use",{feature:e,...t}),window.gtag&&window.gtag("event","feature_use",{feature_name:e,...t})}trackAction(e,t={}){this.trackEvent("user_action",{action:e,...t}),window.gtag&&window.gtag("event",e,{event_category:"engagement",...t})}trackConversion(e,t=0){this.trackEvent("conversion",{type:e,value:t}),window.gtag&&window.gtag("event","conversion",{conversion_type:e,value:t,currency:"GBP"})}trackPerformance(e,t){this.trackEvent("performance",{metric:e,duration:t})}trackEvent(e,t={}){const n={type:e,data:t,timestamp:new Date().toISOString(),sessionId:this.sessionId,sessionDuration:Date.now()-this.sessionStart};this.events.push(n),this.events.length>this.maxEvents&&this.events.shift(),this.saveEvents()}saveEvents(){try{localStorage.setItem("analytics_events",JSON.stringify(this.events))}catch{this.events=this.events.slice(-500),localStorage.setItem("analytics_events",JSON.stringify(this.events))}}loadEvents(){try{const e=localStorage.getItem("analytics_events");e&&(this.events=JSON.parse(e))}catch{}}getStats(){const e={totalEvents:this.events.length,sessionDuration:Date.now()-this.sessionStart,eventsByType:{},mostUsedFeatures:[],pageViews:[]};this.events.forEach(n=>{e.eventsByType[n.type]=(e.eventsByType[n.type]||0)+1});const t={};return this.events.filter(n=>n.type==="feature_use").forEach(n=>{const r=n.data.feature;t[r]=(t[r]||0)+1}),e.mostUsedFeatures=Object.entries(t).sort((n,r)=>r[1]-n[1]).slice(0,10).map(([n,r])=>({name:n,count:r})),e.pageViews=this.events.filter(n=>n.type==="page_view").map(n=>({page:n.data.page,timestamp:n.timestamp})),e}getEngagementMetrics(){const e=Date.now(),t=e-1440*60*1e3,n=e-10080*60*1e3,r=this.events.filter(l=>new Date(l.timestamp).getTime()>t),s=this.events.filter(l=>new Date(l.timestamp).getTime()>n);return{dailyActiveUse:r.length>0,eventsLast24h:r.length,eventsLast7days:s.length,averageSessionLength:(Date.now()-this.sessionStart)/1e3,totalSessions:1}}clearAnalytics(){this.events=[],localStorage.removeItem("analytics_events")}exportAnalytics(){return{sessionId:this.sessionId,events:this.events,stats:this.getStats(),engagement:this.getEngagementMetrics(),exportDate:new Date().toISOString()}}}const oN=new sq;oN.loadEvents();const Tr=oN;class aq{constructor(){this.conversationHistory=[],this.userPreferences={},this.userContext={},this.maxHistoryLength=50}async initialize(){try{const{value:e}=await yn.get({key:"ai_conversation_history"});e&&(this.conversationHistory=JSON.parse(e));const{value:t}=await yn.get({key:"ai_user_preferences"});t&&(this.userPreferences=JSON.parse(t));const{value:n}=await yn.get({key:"ai_user_context"});return n&&(this.userContext=JSON.parse(n)),!0}catch{return!1}}async addConversation(e,t,n="general"){const r={id:Date.now(),timestamp:new Date().toISOString(),userMessage:e,aiResponse:t,topic:n,date:new Date().toLocaleDateString()};return this.conversationHistory.push(r),this.conversationHistory.length>this.maxHistoryLength&&(this.conversationHistory=this.conversationHistory.slice(-this.maxHistoryLength)),await this.extractPreferences(e,t),await this.saveConversationHistory(),r}async extractPreferences(e,t){const n=e.toLowerCase();(n.includes("like")||n.includes("love")||n.includes("favorite"))&&(n.includes("chicken")&&(this.userPreferences.likesChicken=!0),n.includes("fish")&&(this.userPreferences.likesFish=!0),n.includes("vegetable")&&(this.userPreferences.likesVegetables=!0),n.includes("fruit")&&(this.userPreferences.likesFruits=!0),n.includes("salad")&&(this.userPreferences.likesSalads=!0)),(n.includes("hate")||n.includes("dislike")||n.includes("don't like"))&&(n.includes("broccoli")&&(this.userPreferences.dislikesBroccoli=!0),n.includes("spinach")&&(this.userPreferences.dislikesSpinach=!0)),n.includes("vegetarian")&&(this.userPreferences.vegetarian=!0),n.includes("vegan")&&(this.userPreferences.vegan=!0),n.includes("keto")&&(this.userPreferences.keto=!0),n.includes("paleo")&&(this.userPreferences.paleo=!0),(n.includes("gluten free")||n.includes("gluten-free"))&&(this.userPreferences.glutenFree=!0),n.includes("gym")&&(this.userPreferences.likesGym=!0),(n.includes("running")||n.includes("run"))&&(this.userPreferences.likesRunning=!0),n.includes("yoga")&&(this.userPreferences.likesYoga=!0),n.includes("cardio")&&(this.userPreferences.likesCardio=!0),(n.includes("weights")||n.includes("lifting"))&&(this.userPreferences.likesWeightlifting=!0),(n.includes("lose weight")||n.includes("weight loss"))&&(this.userPreferences.goalWeightLoss=!0),(n.includes("build muscle")||n.includes("gain muscle"))&&(this.userPreferences.goalMuscleGain=!0),(n.includes("get fit")||n.includes("fitness"))&&(this.userPreferences.goalFitness=!0),await this.savePreferences()}getConversationContext(e=10){return this.conversationHistory.slice(-e).map(n=>({user:n.userMessage,ai:n.aiResponse,topic:n.topic}))}getPreferencesSummary(){const e=[];return this.userPreferences.likesChicken&&e.push("likes chicken"),this.userPreferences.likesFish&&e.push("likes fish"),this.userPreferences.likesVegetables&&e.push("likes vegetables"),this.userPreferences.dislikesBroccoli&&e.push("dislikes broccoli"),this.userPreferences.vegetarian&&e.push("vegetarian"),this.userPreferences.vegan&&e.push("vegan"),this.userPreferences.keto&&e.push("follows keto diet"),this.userPreferences.glutenFree&&e.push("gluten-free"),this.userPreferences.likesGym&&e.push("enjoys gym workouts"),this.userPreferences.likesRunning&&e.push("enjoys running"),this.userPreferences.likesYoga&&e.push("practices yoga"),this.userPreferences.goalWeightLoss&&e.push("goal: lose weight"),this.userPreferences.goalMuscleGain&&e.push("goal: build muscle"),this.userPreferences.goalFitness&&e.push("goal: improve fitness"),e.join(", ")}buildContextualPrompt(e){const t=[],n=this.getPreferencesSummary();n&&t.push(`User preferences: ${n}`);const r=this.getConversationContext(5);return r.length>0&&(t.push("Previous conversations:"),r.forEach((l,u)=>{t.push(`${u+1}. User: "${l.user}" AI: "${l.ai.substring(0,100)}..."`)})),Object.keys(this.userContext).length>0&&t.push(`User context: ${JSON.stringify(this.userContext)}`),t.length>0?`CONTEXT (remember this about the user):
${t.join(`
`)}

USER MESSAGE: ${e}`:e}async updateUserContext(e){this.userContext={...this.userContext,...e,lastUpdated:new Date().toISOString()},await yn.set({key:"ai_user_context",value:JSON.stringify(this.userContext)})}getConversationsByTopic(e){return this.conversationHistory.filter(t=>t.topic===e)}searchConversations(e){const t=e.toLowerCase();return this.conversationHistory.filter(n=>n.userMessage.toLowerCase().includes(t)||n.aiResponse.toLowerCase().includes(t))}async clearOldConversations(){const e=Date.now()-2592e6;this.conversationHistory=this.conversationHistory.filter(t=>new Date(t.timestamp).getTime()>e),await this.saveConversationHistory()}async saveConversationHistory(){try{await yn.set({key:"ai_conversation_history",value:JSON.stringify(this.conversationHistory)})}catch{}}async savePreferences(){try{await yn.set({key:"ai_user_preferences",value:JSON.stringify(this.userPreferences)})}catch{}}getMemoryStats(){return{totalConversations:this.conversationHistory.length,preferencesLearned:Object.keys(this.userPreferences).length,contextData:Object.keys(this.userContext).length,oldestConversation:this.conversationHistory[0]?.date||"None",newestConversation:this.conversationHistory[this.conversationHistory.length-1]?.date||"None"}}async resetMemory(){this.conversationHistory=[],this.userPreferences={},this.userContext={},await yn.remove({key:"ai_conversation_history"}),await yn.remove({key:"ai_user_preferences"}),await yn.remove({key:"ai_user_context"})}}const e2=new aq,t2=async(i,e={})=>{try{const t=e2.buildContextualPrompt(i),n=await fetch("https://helio-wellness-app-production.up.railway.app/api/chat",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:t}),mode:"cors"});if(!n.ok){const s=await n.text();throw new Error(`API request failed: ${n.status}`)}const r=await n.json();return await e2.addConversation(i,r.response,e.topic||"general"),r.response}catch(t){throw t}},lN=async i=>{try{const e=getGeminiVisionModel(),t=await pN(i);return(await(await e.generateContent([`Analyze this progress photo for fitness tracking. Provide:
1. Observable physical changes or current state
2. Areas of visible progress (if comparing to baseline)
3. Encouraging feedback
4. One specific tip for improvement

Keep it positive and motivating!`,t])).response).text()}catch{return"Photo uploaded! I'll analyze your progress. Keep taking regular photos to track changes!"}},uN=async i=>{try{const e=getGeminiVisionModel(),t=await pN(i);return(await(await e.generateContent([`Analyze this food photo. Provide:
1. Food items identified
2. Estimated portion sizes
3. Total calories (estimate)
4. Protein, carbs, and fat breakdown (in grams)
5. Brief nutritional assessment

Format response as:
 MEAL: [meal name]
 CALORIES: [number] kcal
 PROTEIN: [number]g | CARBS: [number]g | FAT: [number]g
 TIP: [one healthy tip]`,t])).response).text()}catch{return"Meal logged! For accurate tracking, try to include variety and watch portion sizes."}},cN=async i=>{try{const e=`Create a personalized workout plan for:
- Fitness Level: ${i.fitnessLevel||"Beginner"}
- Goal: ${i.goal||"General fitness"}
- Available Time: ${i.timeAvailable||"30 minutes"}
- Equipment: ${i.equipment||"Bodyweight only"}

Provide:
1. Warm-up (5 min)
2. Main workout (3-5 exercises with sets/reps)
3. Cool-down (5 min)

Make it practical and achievable!`;return(await(await model.generateContent(e)).response).text()}catch{return"Start with: 10 squats, 10 push-ups (or knee push-ups), 30 sec plank, 20 jumping jacks. Repeat 3 times!"}},hN=async i=>{try{const e=`Create a daily meal plan for:
- Goal: ${i.goal||"Balanced nutrition"}
- Calories: ${i.targetCalories||"2000"} kcal/day
- Dietary Preferences: ${i.dietPreference||"None"}
- Meals: Breakfast, Lunch, Dinner, 1 Snack

For each meal provide:
- Meal name
- Key ingredients
- Approximate calories
- Quick prep tip

Keep meals simple and realistic!`;return(await(await model.generateContent(e)).response).text()}catch{return"Focus on: Lean protein, whole grains, lots of vegetables, healthy fats, and stay hydrated!"}},dN=async i=>{try{const e=`Analyze this user's wellness habits and provide insights:

Habit Data:
- Workouts completed: ${i.workouts||0}
- Meals logged: ${i.meals||0}
- Current streak: ${i.streak||0} days
- Skipped days pattern: ${i.skippedDays||"None"}
- Best time for activity: ${i.bestTime||"Not identified"}

Provide:
1. One major pattern noticed
2. One specific recommendation to improve consistency
3. One motivational insight

Keep it brief and actionable!`;return(await(await model.generateContent(e)).response).text()}catch{return"You're building great habits! Consistency is key. Try setting a specific time each day for your wellness routine."}},fN=async i=>{try{const e=`Generate a motivational message for a wellness app user:
- Current streak: ${i.streak||0} days
- Progress: ${i.progress||"Starting journey"}
- Recent challenge: ${i.challenge||"None"}

Create a short, encouraging message (2-3 sentences). Be specific to their situation and inspiring!`;return(await(await model.generateContent(e)).response).text()}catch{return"You're doing amazing! Every small step counts toward your bigger goal. Keep showing up! "}};async function pN(i){return new Promise((e,t)=>{const n=new FileReader;n.onloadend=()=>{const r=n.result.split(",")[1];e({inlineData:{data:r,mimeType:i.type}})},n.onerror=t,n.readAsDataURL(i)})}const n2={chat:t2,chatWithAI:t2,analyzeProgressPhoto:lN,analyzeFoodPhoto:uN,generateWorkoutPlan:cN,generateMealPlan:hN,getHabitInsights:dN,getMotivationalMessage:fN},eC=Object.freeze(Object.defineProperty({__proto__:null,analyzeFoodPhoto:uN,analyzeProgressPhoto:lN,chatWithAI:t2,default:n2,generateMealPlan:hN,generateWorkoutPlan:cN,getHabitInsights:dN,getMotivationalMessage:fN},Symbol.toStringTag,{value:"Module"}));class oq{constructor(){this.geneticData=null,this.analysisComplete=!1,this.dailyTipHistory=[]}async loadSavedData(){try{const{value:e}=await yn.get({key:"dna_genetic_data"}),{value:t}=await yn.get({key:"dna_analysis"}),{value:n}=await yn.get({key:"dna_analysis_complete"});if(e){this.geneticData=JSON.parse(e);try{const{default:r}=await jt(async()=>{const{default:l}=await import("./chunk-1765887266800-encryptionService.js");return{default:l}},[]),s=await r.encrypt(e);localStorage.setItem("dnaAnalysis",s)}catch{}}return t&&(this.analysis=JSON.parse(t)),n==="true"&&(this.analysisComplete=!0),this.geneticData!==null}catch{return!1}}async generateDailyTip(){try{const e=new Date().toISOString().split("T")[0],{value:t}=await yn.get({key:"dna_last_tip_date"}),{value:n}=await yn.get({key:"dna_last_tip"});if(t===e&&n)return JSON.parse(n);if(!this.geneticData){const{value:u}=await yn.get({key:"dna_genetic_data"});if(u)this.geneticData=JSON.parse(u);else return null}const r=this.geneticData.traits||[];if(r.length===0)return null;const s=r[Math.floor(Math.random()*r.length)],l=await this.generateTipForTrait(s);return await yn.set({key:"dna_last_tip_date",value:e}),await yn.set({key:"dna_last_tip",value:JSON.stringify(l)}),l}catch{return null}}async generateTipForTrait(e){const n={metabolism:{slow:[{icon:"",title:"Portion Control",tip:"Your FTO gene means slower metabolism. Try smaller portions and track calories more carefully."},{icon:"",title:"Boost Activity",tip:"Your genetics favor fat storage. Aim for 150+ mins of cardio weekly to counteract this."},{icon:"",title:"Timing Matters",tip:"With your metabolism, eat larger meals earlier in the day when metabolism is naturally higher."}],fast:[{icon:"",title:"Fuel Up",tip:"Your fast metabolism burns calories quickly. Don't forget to eat enough to maintain energy!"},{icon:"",title:"Protein Power",tip:"Your metabolism needs fuel. Aim for 1g protein per lb body weight to maintain muscle."}]},caffeine:{slow:[{icon:"",title:"Cut the Coffee",tip:"Your CYP1A2 gene makes you a slow caffeine metabolizer. Stop coffee after 2 PM for better sleep."},{icon:"",title:"Switch to Green Tea",tip:"Your body processes caffeine slowly. Try green tea (less caffeine) instead of coffee."}],fast:[{icon:"",title:"Coffee Champion",tip:"Your CYP1A2 gene means you process caffeine quickly. You can enjoy that afternoon coffee!"}]},lactose:{intolerant:[{icon:"",title:"Dairy Alternative",tip:"Your LCT gene means lactose intolerance. Try lactose-free milk, almond milk, or take lactase pills."},{icon:"",title:"Aged Cheese OK",tip:"With your genetics, aged cheeses (cheddar, parmesan) have less lactose and may be tolerable."}],tolerant:[{icon:"",title:"Dairy Friendly",tip:"Your genetics allow lactose digestion. Dairy is a great protein source for you!"}]},carbs:{sensitive:[{icon:"",title:"Low-Carb Works",tip:"Your TCF7L2 gene means carb sensitivity. Consider lower carb diet (<150g/day) for better weight control."},{icon:"",title:"Veggies First",tip:"Your genetics favor low-carb. Fill up on non-starchy veggies before eating carbs."}],tolerant:[{icon:"",title:"Carb Friendly",tip:"Your genetics handle carbs well. Sweet potatoes, rice, and oats are great fuel for you!"}]},vitamin_d:{deficiency:[{icon:"",title:"Sunshine Vitamin",tip:"Your VDR gene means vitamin D deficiency risk. Get 15 mins sun daily or take 2000 IU supplement."},{icon:"",title:"Fatty Fish",tip:"Your genetics need more vitamin D. Eat salmon, mackerel, or sardines 2-3x per week."}],sufficient:[{icon:"",title:"D is Good",tip:"Your VDR gene processes vitamin D well. Keep up the sunshine and salmon!"}]},exercise:{power:[{icon:"",title:"Built for Strength",tip:"Your ACTN3 gene means you're built for power! Focus on weightlifting and sprints."},{icon:"",title:"HIIT Perfect",tip:"Your genetics favor explosive movements. HIIT and plyometrics will give you best results."}],endurance:[{icon:"",title:"Endurance King",tip:"Your ACE gene means endurance is your strength. Long runs, cycling, and swimming suit you best."},{icon:"",title:"Go Long",tip:"Your genetics favor sustained effort. Train for marathons or long-distance cycling!"}]},salt:{sensitive:[{icon:"",title:"Watch the Salt",tip:"Your AGT gene means salt sensitivity. Keep sodium under 2000mg/day to control blood pressure."},{icon:"",title:"Cook at Home",tip:"With your genetics, restaurant food is too salty. Cook at home to control sodium better."}]}}[e.trait];if(!n)return{icon:"",title:"DNA Insight",tip:`Your ${e.gene} gene (${e.trait}) - ${e.value}. Check your full DNA report for details.`};const r=n[e.value];return!r||r.length===0?{icon:"",title:"DNA Insight",tip:`Your ${e.gene} gene shows ${e.value} ${e.trait}. This affects how your body responds.`}:{...r[Math.floor(Math.random()*r.length)],gene:e.gene,trait:e.trait,value:e.value}}async getDailyTipHistory(){try{const{value:e}=await yn.get({key:"dna_tip_history"});return e?JSON.parse(e):[]}catch{return[]}}async saveTipToHistory(e){try{const t=await this.getDailyTipHistory();t.push({...e,date:new Date().toISOString()});const n=t.slice(-30);await yn.set({key:"dna_tip_history",value:JSON.stringify(n)})}catch{}}async uploadDNAData(e,t){try{const n=await this.parseDNAFile(e,t);return n.success?(this.geneticData=n.data,await this.analyzeGenetics(),{success:!0,message:"DNA data uploaded successfully",traitsFound:this.geneticData.traits.length}):{success:!1,error:"Failed to parse DNA data"}}catch(n){return{success:!1,error:n.message}}}getSnpDatabase(){return{rs9939609:{gene:"FTO",trait:"metabolism",interpretations:{AA:{value:"slow",risk:"high",description:"30% higher obesity risk, need fewer calories"},AT:{value:"moderate",risk:"medium",description:"20% higher obesity risk"},TT:{value:"fast",risk:"low",description:"Normal metabolism"}}},rs4988235:{gene:"LCT",trait:"lactoseIntolerance",interpretations:{AA:{value:"unlikely",risk:"low",description:"Can digest dairy normally"},AG:{value:"possible",risk:"medium",description:"May have mild lactose sensitivity"},GG:{value:"likely",risk:"high",description:"Likely lactose intolerant - avoid dairy"}}},rs762551:{gene:"CYP1A2",trait:"caffeineMetabolism",interpretations:{AA:{value:"fast",risk:"low",description:"Can handle 3+ cups/day"},AC:{value:"moderate",risk:"medium",description:"Limit to 2 cups/day"},CC:{value:"slow",risk:"high",description:"Slow metabolizer - limit to 1 cup, increased heart risk"}}},rs1815739:{gene:"ACTN3",trait:"muscleType",interpretations:{CC:{value:"power-oriented",risk:"low",description:"Fast-twitch dominant - better at sprints/strength"},CT:{value:"balanced",risk:"low",description:"Mixed muscle fibers - good all-around"},TT:{value:"endurance-oriented",risk:"low",description:"Slow-twitch dominant - better at marathons"}}},rs1799983:{gene:"NOS3",trait:"enduranceCapacity",interpretations:{GG:{value:"high",risk:"low",description:"Elite endurance potential"},GT:{value:"moderate",risk:"low",description:"Good endurance capacity"},TT:{value:"low",risk:"medium",description:"Lower endurance - focus on shorter workouts"}}},rs2228570:{gene:"VDR",trait:"vitaminDAbsorption",interpretations:{AA:{value:"low",risk:"high",description:"Poor vitamin D absorption - need 2000+ IU daily"},AG:{value:"moderate",risk:"medium",description:"Moderate absorption - need 1000 IU daily"},GG:{value:"high",risk:"low",description:"Good vitamin D absorption"}}},rs174537:{gene:"FADS1",trait:"omega3Conversion",interpretations:{GG:{value:"efficient",risk:"low",description:"Good omega-3 metabolism"},GT:{value:"moderate",risk:"medium",description:"Moderate conversion - eat more fish"},TT:{value:"inefficient",risk:"high",description:"Poor conversion - need fish oil supplements"}}},rs2187668:{gene:"HLA-DQA1",trait:"glutenSensitivity",interpretations:{CC:{value:"high-risk",risk:"high",description:"High celiac risk - consider gluten-free diet"},CT:{value:"moderate-risk",risk:"medium",description:"Moderate gluten sensitivity"},TT:{value:"low-risk",risk:"low",description:"Can tolerate gluten normally"}}},rs671:{gene:"ALDH2",trait:"alcoholMetabolism",interpretations:{GG:{value:"normal",risk:"low",description:"Normal alcohol tolerance"},GA:{value:"slow",risk:"medium",description:"Slower metabolism - limit alcohol intake"},AA:{value:"very-slow",risk:"high",description:"Asian flush variant - avoid alcohol"}}},rs5068:{gene:"NPPA",trait:"saltSensitivity",interpretations:{GG:{value:"high",risk:"high",description:"Very salt sensitive - limit sodium to <1500mg/day"},AG:{value:"moderate",risk:"medium",description:"Moderately salt sensitive"},AA:{value:"low",risk:"low",description:"Not salt sensitive"}}},rs1801282:{gene:"PPARG",trait:"carbohydrateSensitivity",interpretations:{CC:{value:"high",risk:"high",description:"Carb sensitive - better on low-carb diet"},CG:{value:"moderate",risk:"medium",description:"Moderate carb tolerance"},GG:{value:"low",risk:"low",description:"Good carb tolerance"}}},rs429358:{gene:"APOE",trait:"saturatedFatResponse",interpretations:{CC:{value:"increased-risk",risk:"high",description:"APOE4 carrier - limit saturated fat, higher Alzheimer's risk"},CT:{value:"moderate-risk",risk:"medium",description:"APOE3/4 - moderate fat sensitivity"},TT:{value:"normal",risk:"low",description:"APOE3/3 - normal fat metabolism"}}},rs1801133:{gene:"MTHFR",trait:"folateMetabolism",interpretations:{AA:{value:"impaired",risk:"high",description:"MTHFR mutation - need 40% more folate (leafy greens, supplements)"},AG:{value:"reduced",risk:"medium",description:"Slightly reduced folate processing"},GG:{value:"normal",risk:"low",description:"Normal folate metabolism"}}}}}async parseDNAFile(e,t){try{const n=this.getSnpDatabase(),r=e.split(`
`),s={};let l="unknown";for(let f of r){if(f=f.trim(),!f||f.startsWith("#")){(f.includes("23andMe")||f.includes("23andme"))&&(l="23andMe"),(f.includes("AncestryDNA")||f.includes("Ancestry"))&&(l="AncestryDNA");continue}const x=f.split(/\s+/);if(x.length>=4){const p=x[0],w=x[3];n[p]&&(s[p]=w)}}const u=[],h=Object.keys(s).length;if(h===0)return this.getDemoGeneticData(t);for(const[f,x]of Object.entries(s)){const p=n[f],w=p.interpretations[x];w&&u.push({rsid:f,gene:p.gene,genotype:x,trait:p.trait,value:w.value,risk:w.risk,description:w.description})}return{success:!0,data:{source:l!=="unknown"?l:t,uploadDate:new Date().toISOString(),traits:u,snpsAnalyzed:h,raw:null}}}catch{return this.getDemoGeneticData(t)}}getDemoGeneticData(e){const t=[{rsid:"demo",gene:"FTO",trait:"metabolism",value:"moderate",risk:"medium",description:"Demo: Moderate metabolism"},{rsid:"demo",gene:"LCT",trait:"lactoseIntolerance",value:"possible",risk:"medium",description:"Demo: May have mild lactose sensitivity"},{rsid:"demo",gene:"CYP1A2",trait:"caffeineMetabolism",value:"slow",risk:"high",description:"Demo: Slow caffeine metabolizer"},{rsid:"demo",gene:"ACTN3",trait:"muscleType",value:"balanced",risk:"low",description:"Demo: Mixed muscle fibers"},{rsid:"demo",gene:"NOS3",trait:"enduranceCapacity",value:"moderate",risk:"low",description:"Demo: Good endurance capacity"}];return{success:!0,data:{source:e+" (Demo Mode)",uploadDate:new Date().toISOString(),traits:t,snpsAnalyzed:0,raw:null}}}async analyzeGenetics(){if(!this.geneticData)return;const n=`Based on these genetic traits: ${this.geneticData.traits.map(s=>`${s.trait}: ${s.value}`).join(", ")}

Generate personalized health recommendations in JSON format:
{
  "dietRecommendations": ["rec1", "rec2"],
  "exerciseRecommendations": ["rec1", "rec2"],
  "supplementAdvice": ["sup1", "sup2"],
  "foodsToAvoid": ["food1", "food2"],
  "foodsToEmphasize": ["food1", "food2"],
  "healthRisks": ["risk1", "risk2"],
  "preventionStrategies": ["strategy1", "strategy2"]
}`;try{const h=(await(await n2.getGeminiModel()).generateContent(n)).response.text().match(/\{[\s\S]*\}/);h&&(this.analysis=JSON.parse(h[0]),this.analysisComplete=!0)}catch{this.analysis={dietRecommendations:["Follow Mediterranean diet","Eat 5-6 small meals daily"],exerciseRecommendations:["Mix cardio and strength training","Exercise 150 min/week"],supplementAdvice:["Vitamin D3 1000 IU","Omega-3 fish oil","Multivitamin"],foodsToAvoid:["Processed foods","Excess saturated fats","High sodium foods"],foodsToEmphasize:["Leafy greens","Fatty fish","Whole grains","Nuts and seeds"],healthRisks:["Moderate obesity risk","Possible lactose sensitivity"],preventionStrategies:["Maintain healthy weight","Regular exercise","Balanced nutrition"]},this.analysisComplete=!0}const r={...this.geneticData,analysis:this.analysis,analysisComplete:!0};await yn.set({key:"dna_genetic_data",value:JSON.stringify(r)}),await yn.set({key:"dna_analysis",value:JSON.stringify(this.analysis)}),await yn.set({key:"dna_analysis_complete",value:"true"}),localStorage.setItem("dnaAnalysis",JSON.stringify(r));try{const s=Ti.getCurrentUser()?.uid;await mi.save("dnaAnalysis",r,s)}catch{}}async getGeneticMealPlan(e=7){if(!this.geneticData||!this.analysisComplete)return{success:!1,message:"Upload DNA data first"};const t=this.geneticData.traits,n=this.analysis,r=`Create a ${e}-day meal plan optimized for someone with these genetic traits:
${t.map(h=>`- ${h.trait}: ${h.value}`).join(`
`)}

Foods to emphasize: ${n.foodsToEmphasize?.join(", ")}
Foods to avoid: ${n.foodsToAvoid?.join(", ")}

Return JSON:
{
  "days": [
    {
      "day": 1,
      "breakfast": {"meal": "name", "calories": 400, "why": "genetic reason"},
      "lunch": {"meal": "name", "calories": 600, "why": "genetic reason"},
      "dinner": {"meal": "name", "calories": 600, "why": "genetic reason"},
      "snacks": [{"snack": "name", "calories": 150, "why": "genetic reason"}]
    }
  ]
}`,u=(await n2.getGeminiModel().generateContent(r)).response.text();try{const h=u.match(/\{[\s\S]*\}/);if(h)return{success:!0,mealPlan:JSON.parse(h[0])}}catch{}return{success:!1,message:"Failed to generate meal plan"}}async getGeneticExercisePlan(){if(!this.geneticData)return{success:!1,message:"Upload DNA data first"};const e=this.geneticData.traits.find(r=>r.trait==="muscleType")?.value,t=this.geneticData.traits.find(r=>r.trait==="enduranceCapacity")?.value;let n=[];return e==="power-oriented"?n.push({type:"Strength Training",frequency:"4x/week",exercises:["Squats","Deadlifts","Bench Press","Overhead Press"],sets:"3-5 sets",reps:"4-6 reps",reason:"Your genetics favor power development"}):n.push({type:"Endurance Training",frequency:"5x/week",exercises:["Running","Cycling","Swimming","Rowing"],duration:"45-60 min",reason:"Your genetics favor endurance activities"}),t==="high"&&n.push({type:"HIIT",frequency:"2x/week",duration:"20-30 min",reason:"Your high endurance capacity allows for intense intervals"}),{success:!0,plan:n}}getPredictedHealthRisks(){return this.analysis?this.analysis.healthRisks||[]:[]}getSupplementAdvice(){return this.analysis?this.analysis.supplementAdvice||[]:[]}getFullDNAReport(){return!this.geneticData||!this.analysisComplete?null:{geneticTraits:this.geneticData.traits,analysis:this.analysis,uploadDate:this.geneticData.uploadDate,source:this.geneticData.source,ancestryBreakdown:this.getAncestryBreakdown(),pharmacogenomics:this.getPharmacogenomics(),athleticProfile:this.getAthleticProfile(),nutritionGenetics:this.getNutritionGenetics(),healthRiskScores:this.getHealthRiskScores()}}getAncestryBreakdown(){const e=[{region:"Northern European",percentage:42.3,countries:["UK","Ireland","Scandinavia"]},{region:"Southern European",percentage:28.7,countries:["Italy","Greece","Spain"]},{region:"Eastern European",percentage:18.5,countries:["Poland","Russia","Ukraine"]},{region:"Middle Eastern",percentage:7.2,countries:["Turkey","Lebanon"]},{region:"Other",percentage:3.3,countries:["Various"]}];return{breakdown:e,mainRegion:e[0].region,diversityScore:68}}getPharmacogenomics(){return[{drug:"Warfarin",gene:"CYP2C9",recommendation:"Normal Dose",description:"Standard blood thinner dosing recommended",riskLevel:"low"},{drug:"Clopidogrel (Plavix)",gene:"CYP2C19",recommendation:"Consider Alternative",description:"May be less effective - discuss with doctor",riskLevel:"medium"},{drug:"Codeine",gene:"CYP2D6",recommendation:"Use with Caution",description:"May be ultra-metabolizer - higher side effect risk",riskLevel:"high"},{drug:"Statins",gene:"SLCO1B1",recommendation:"Normal Response",description:"Standard cholesterol medication dosing",riskLevel:"low"},{drug:"SSRIs (Antidepressants)",gene:"CYP2D6",recommendation:"May Need Higher Dose",description:"Fast metabolizer - may require dose adjustment",riskLevel:"low"}]}getAthleticProfile(){return{powerScore:72,enduranceScore:58,recoverySpeed:"Fast",injuryRisk:"Low",optimalTrainingType:"Mixed - Slightly power-biased",genes:[{gene:"ACTN3",result:"CT",trait:"Power potential - Sprint ability",score:75},{gene:"ACE",result:"ID",trait:"Endurance capacity",score:60},{gene:"COL1A1",result:"GG",trait:"Injury resistance - Strong tendons",score:85},{gene:"IL6",result:"GG",trait:"Recovery speed - Fast inflammation response",score:80}],recommendations:["Focus on explosive movements: sprints, plyometrics, Olympic lifts","Include endurance work but don't overdo long slow cardio","Your injury risk is low - can train frequently","Recovery is fast - can handle 5-6 training days per week"]}}getNutritionGenetics(){return{macronutrients:{carbs:{tolerance:"Medium",recommendation:"40-45% of calories"},fats:{tolerance:"High",recommendation:"30-35% of calories"},protein:{needs:"Standard",recommendation:"1.6g per kg bodyweight"}},intolerances:[{food:"Lactose",gene:"LCT",likelihood:"Low",canConsume:!0},{food:"Gluten",gene:"HLA-DQ",likelihood:"Very Low",canConsume:!0},{food:"Caffeine",gene:"CYP1A2",metabolism:"Fast",safeAmount:"400mg/day"},{food:"Alcohol",gene:"ALDH2",metabolism:"Normal",safeAmount:"Moderate"}],vitamins:[{vitamin:"Vitamin D",gene:"VDR",absorption:"Low",recommendedIU:2e3},{vitamin:"Vitamin B12",gene:"FUT2",absorption:"Normal",recommendedMCG:2.4},{vitamin:"Folate",gene:"MTHFR",conversion:"Reduced",recommendation:"Methylfolate supplement"},{vitamin:"Omega-3",gene:"FADS1",conversion:"Low",recommendation:"Eat fish or supplement EPA/DHA"}],dietType:"Mediterranean",reason:"Your genetics respond well to moderate carbs, healthy fats, and lean proteins"}}getHealthRiskScores(){return[{condition:"Type 2 Diabetes",yourRisk:18,populationAverage:15,riskLevel:"Slightly Elevated",genes:["TCF7L2","FTO"],preventionTips:["Maintain healthy weight","Regular exercise","Low glycemic diet"]},{condition:"Heart Disease",yourRisk:22,populationAverage:25,riskLevel:"Lower Than Average",genes:["APOE","PCSK9"],preventionTips:["Mediterranean diet","Cardio exercise","Manage stress"]},{condition:"Obesity",yourRisk:35,populationAverage:30,riskLevel:"Elevated",genes:["FTO","MC4R"],preventionTips:["Calorie tracking","Strength training","Protein-rich diet"]},{condition:"Alzheimer's Disease",yourRisk:12,populationAverage:10,riskLevel:"Average",genes:["APOE"],preventionTips:["Brain exercises","Social engagement","Mediterranean diet"]},{condition:"Osteoporosis",yourRisk:8,populationAverage:12,riskLevel:"Lower Than Average",genes:["VDR","COL1A1"],preventionTips:["Calcium intake","Weight-bearing exercise","Vitamin D"]}]}hasDNAData(){return this.geneticData!==null}}const lq=new oq;var i2;(function(i){i[i.Sunday=1]="Sunday",i[i.Monday=2]="Monday",i[i.Tuesday=3]="Tuesday",i[i.Wednesday=4]="Wednesday",i[i.Thursday=5]="Thursday",i[i.Friday=6]="Friday",i[i.Saturday=7]="Saturday"})(i2||(i2={}));const Eu=Bl("LocalNotifications",{web:()=>jt(()=>import("./chunk-1765887266800-web10.js"),[]).then(i=>new i.LocalNotificationsWeb)}),O1=Object.freeze(Object.defineProperty({__proto__:null,LocalNotifications:Eu,get Weekday(){return i2}},Symbol.toStringTag,{value:"Module"}));class uq{constructor(){this.settings=this.getDefaultSettings(),this.scheduledIds={dailyReminders:[1001,1002,1003],streakReminders:[2001],healthTips:[3001,3002,3003],goalAlerts:[4001,4002,4003,4004]},this.initialized=!1,this.goalCheckInterval=null}getDefaultSettings(){return{dailyReminders:!1,goalAlerts:!1,streakReminders:!1,healthTips:!1,emergencyAlerts:!0}}async initialize(){if(!this.initialized)try{if(!Eu){console.warn("LocalNotifications not available");return}if((await Eu.requestPermissions()).display!=="granted"){console.warn("Notification permission not granted");return}this.loadSettings(),await this.scheduleAllNotifications(),this.settings.goalAlerts&&this.startGoalMonitoring(),this.initialized=!0}catch(e){console.warn("Failed to initialize notifications:",e)}}loadSettings(){try{const e=localStorage.getItem("notificationSettings");e&&(this.settings={...this.getDefaultSettings(),...JSON.parse(e)})}catch(e){console.warn("Failed to load notification settings:",e),this.settings=this.getDefaultSettings()}}async updateSettings(e){this.settings={...this.settings,...e};try{await this.cancelAllNotifications(),await this.scheduleAllNotifications(),this.settings.goalAlerts&&!this.goalCheckInterval?this.startGoalMonitoring():!this.settings.goalAlerts&&this.goalCheckInterval&&this.stopGoalMonitoring()}catch(t){console.warn("Failed to update notifications:",t)}}async scheduleAllNotifications(){try{this.settings.dailyReminders&&await this.scheduleDailyReminders(),this.settings.streakReminders&&await this.scheduleStreakReminders(),this.settings.healthTips&&await this.scheduleHealthTips()}catch(e){console.warn("Failed to schedule notifications:",e)}}async cancelAllNotifications(){try{const e=[...this.scheduledIds.dailyReminders,...this.scheduledIds.streakReminders,...this.scheduledIds.healthTips,...this.scheduledIds.goalAlerts];await Eu.cancel({notifications:e.map(t=>({id:t}))})}catch(e){console.warn("Failed to cancel notifications:",e)}}async scheduleDailyReminders(){try{const e=[],t=new Date,n=new Date;n.setHours(9,0,0,0),n<=t&&n.setDate(n.getDate()+1),e.push({id:this.scheduledIds.dailyReminders[0],title:" Good Morning!",body:"Start your day right! Log your breakfast and water intake.",schedule:{at:n,repeats:!0,every:"day"}});const r=new Date;r.setHours(12,0,0,0),r<=t&&r.setDate(r.getDate()+1),e.push({id:this.scheduledIds.dailyReminders[1],title:" Lunch Time!",body:"Don't forget to log your lunch and stay hydrated.",schedule:{at:r,repeats:!0,every:"day"}});const s=new Date;s.setHours(18,0,0,0),s<=t&&s.setDate(s.getDate()+1),e.push({id:this.scheduledIds.dailyReminders[2],title:" Evening Check-in",body:"Log your dinner and check your daily progress!",schedule:{at:s,repeats:!0,every:"day"}}),await Eu.schedule({notifications:e})}catch(e){console.warn("Failed to schedule daily reminders:",e)}}startGoalMonitoring(){this.goalCheckInterval=setInterval(()=>{this.checkGoalCompletion()},300*1e3),this.checkGoalCompletion()}stopGoalMonitoring(){this.goalCheckInterval&&(clearInterval(this.goalCheckInterval),this.goalCheckInterval=null)}async checkGoalCompletion(){try{await this.checkStepGoal(),await this.checkWaterGoal(),await this.checkCalorieGoal()}catch(e){console.warn("Failed to check goals:",e)}}async checkStepGoal(){try{if(window.AndroidStepCounter){const e=await new Promise(r=>{try{const s=parseInt(window.AndroidStepCounter.getTodaySteps()||"0");r(s)}catch{r(0)}}),t=1e4,n=`stepGoalNotified_${new Date().toDateString()}`;e>=t&&!localStorage.getItem(n)&&(await Eu.schedule({notifications:[{id:this.scheduledIds.goalAlerts[0],title:" Step Goal Achieved!",body:`Awesome! You've reached ${e.toLocaleString()} steps today!`,schedule:{at:new Date(Date.now()+1e3)}}]}),localStorage.setItem(n,"true"))}}catch(e){console.warn("Failed to check step goal:",e)}}async checkWaterGoal(){try{const e=localStorage.getItem("waterIntake");if(e){const t=JSON.parse(e),n=new Date().toDateString(),r=t[n]||0,s=2e3,l=`waterGoalNotified_${n}`;r>=s&&!localStorage.getItem(l)&&(await Eu.schedule({notifications:[{id:this.scheduledIds.goalAlerts[1],title:" Hydration Goal Achieved!",body:`Great job! You've reached your water intake goal of ${s}ml!`,schedule:{at:new Date(Date.now()+1e3)}}]}),localStorage.setItem(l,"true"))}}catch(e){console.warn("Failed to check water goal:",e)}}async checkCalorieGoal(){try{const e=localStorage.getItem("meals");if(e){const t=JSON.parse(e),n=new Date().toDateString(),s=t.filter(h=>new Date(h.date).toDateString()===n).reduce((h,f)=>h+(f.calories||0),0),l=2e3,u=`calorieGoalNotified_${n}`;s>=l&&!localStorage.getItem(u)&&(await Eu.schedule({notifications:[{id:this.scheduledIds.goalAlerts[2],title:" Calorie Goal Reached!",body:`You've logged ${s} calories today. Great tracking!`,schedule:{at:new Date(Date.now()+1e3)}}]}),localStorage.setItem(u,"true"))}}catch(e){console.warn("Failed to check calorie goal:",e)}}async scheduleStreakReminders(){try{const e=new Date,t=new Date;t.setHours(20,0,0,0),t<=e&&t.setDate(t.getDate()+1),await Eu.schedule({notifications:[{id:this.scheduledIds.streakReminders[0],title:" Keep Your Streak Alive!",body:"Complete your daily goal to maintain your winning streak!",schedule:{at:t,repeats:!0,every:"day"}}]})}catch(e){console.warn("Failed to schedule streak reminders:",e)}}async scheduleHealthTips(){try{const e=this.getHealthTips(),t=[],n=new Date,r=new Date;r.setHours(10,0,0,0),r<=n&&r.setDate(r.getDate()+1),t.push({id:this.scheduledIds.healthTips[0],title:" Health Tip",body:e[Math.floor(Math.random()*e.length)],schedule:{at:r,repeats:!0,every:"day"}});const s=new Date;s.setHours(15,0,0,0),s<=n&&s.setDate(s.getDate()+1),t.push({id:this.scheduledIds.healthTips[1],title:" Wellness Advice",body:e[Math.floor(Math.random()*e.length)],schedule:{at:s,repeats:!0,every:"day"}});const l=new Date;l.setHours(19,0,0,0),l<=n&&l.setDate(l.getDate()+1),t.push({id:this.scheduledIds.healthTips[2],title:" Health Reminder",body:e[Math.floor(Math.random()*e.length)],schedule:{at:l,repeats:!0,every:"day"}}),await Eu.schedule({notifications:t})}catch(e){console.warn("Failed to schedule health tips:",e)}}getHealthTips(){return[" Drink water regularly throughout the day to stay hydrated!"," Take a 5-minute walk every hour to boost circulation."," Practice deep breathing for 2 minutes to reduce stress."," Include more vegetables in your meals for better nutrition."," Aim for 7-8 hours of quality sleep each night."," Regular exercise strengthens your immune system."," Choose whole fruits over fruit juice for more fiber."," Take breaks from screens to reduce eye strain."," Stretch your muscles daily to improve flexibility."," Get some sunlight daily for vitamin D."," Limit sugary drinks and opt for water or tea."," Eat slowly and mindfully to improve digestion."," Strength training helps maintain bone density."," Challenge your brain with puzzles or learning new skills."," Practice gratitude daily for better mental health."," Avoid smoking and limit alcohol for better health."," Include healthy fats like nuts and avocados in your diet."," Find physical activities you enjoy for sustainable fitness."," Stay connected with friends and family for emotional wellbeing."," Green tea is rich in antioxidants and supports metabolism."]}async testNotification(e){try{const t={dailyReminders:{title:" Test: Daily Reminder",body:"This is what your daily reminders will look like!"},goalAlerts:{title:" Test: Goal Alert",body:"This is what goal completion alerts will look like!"},streakReminders:{title:" Test: Streak Reminder",body:"This is what streak reminders will look like!"},healthTips:{title:" Test: Health Tip",body:"This is what health tips will look like!"}},n=t[e]||t.dailyReminders;await Eu.schedule({notifications:[{id:9999,title:n.title,body:n.body,schedule:{at:new Date(Date.now()+2e3)}}]})}catch(t){console.warn("Failed to send test notification:",t)}}getStatus(){return{initialized:this.initialized,settings:this.settings,goalMonitoring:!!this.goalCheckInterval}}}const r2=new uq;class cq{constructor(){this.errors=[],this.maxErrors=100,this.sessionId=this.generateSessionId(),this.setupGlobalErrorHandlers()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{this.logError({type:"unhandled_error",message:e.message,filename:e.filename,line:e.lineno,column:e.colno,stack:e.error?.stack,timestamp:new Date().toISOString()})}),window.addEventListener("unhandledrejection",e=>{this.logError({type:"unhandled_promise_rejection",message:e.reason?.message||String(e.reason),stack:e.reason?.stack,timestamp:new Date().toISOString()})})}logError(e){const t={...e,sessionId:this.sessionId,userAgent:navigator.userAgent,url:window.location.href,timestamp:e.timestamp||new Date().toISOString()};this.errors.push(t),this.errors.length>this.maxErrors&&this.errors.shift(),this.saveErrors()}logAPIError(e,t,n){this.logError({type:"api_error",endpoint:e,status:t,message:n,timestamp:new Date().toISOString()})}logUserActionError(e,t){this.logError({type:"user_action_error",action:e,message:t.message,stack:t.stack,timestamp:new Date().toISOString()})}saveErrors(){try{localStorage.setItem("error_logs",JSON.stringify(this.errors))}catch{this.errors=this.errors.slice(-50),localStorage.setItem("error_logs",JSON.stringify(this.errors))}}loadErrors(){try{const e=localStorage.getItem("error_logs");e&&(this.errors=JSON.parse(e))}catch{}}getAllErrors(){return[...this.errors]}getErrorsByType(e){return this.errors.filter(t=>t.type===e)}clearErrors(){this.errors=[],localStorage.removeItem("error_logs")}getErrorReport(){return{sessionId:this.sessionId,totalErrors:this.errors.length,errors:this.errors,userAgent:navigator.userAgent,platform:navigator.platform,timestamp:new Date().toISOString()}}exportErrors(){const e=this.getErrorReport(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`error_report_${Date.now()}.json`,r.click(),URL.revokeObjectURL(n)}}const gN=new cq;gN.loadErrors();class nu extends IP.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){gN.logError({type:"component_crash",message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:new Date().toISOString()}),this.setState({error:e,errorInfo:t})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()};render(){return this.state.hasError?b.jsx("div",{className:"error-boundary-container",children:b.jsxs("div",{className:"error-boundary-content",children:[b.jsx("div",{className:"error-icon",children:""}),b.jsx("h2",{children:"Oops! Something went wrong"}),b.jsx("p",{children:this.props.fallbackMessage||"We're sorry, but this feature encountered an error. Don't worry, your data is safe."}),b.jsxs("div",{className:"error-actions",children:[b.jsx("button",{className:"error-btn-primary",onClick:this.handleReset,children:"Try Again"}),b.jsx("button",{className:"error-btn-secondary",onClick:()=>window.location.href="/",children:"Go to Home"})]}),!1]})}):this.props.children}}lf.setSyncService(Jh);const hq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-FoodScanner.js"),__vite__mapDeps([0,1,2,3,4]))),dq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-ProfileSetup.js"),__vite__mapDeps([5,2,6,7]))),fq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-HealthAvatar.js"),__vite__mapDeps([8,6,9]))),pq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-ARScanner.js"),__vite__mapDeps([10,2,1,11,4,12]))),gq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-EmergencyPanel.js"),__vite__mapDeps([13,14,15]))),mq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-InsuranceRewards.js"),__vite__mapDeps([16,6,17]))),yq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-DNAUpload.js"),__vite__mapDeps([18,11,4,19]))),vq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-SocialBattles.js"),__vite__mapDeps([20,21,6,22]))),_q=we.lazy(()=>jt(()=>import("./chunk-1765887266800-MealAutomation.js"),__vite__mapDeps([23,11,4,24]))),bq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-GratitudeJournal.js"),[])),xq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-LegalModal.js"),__vite__mapDeps([25,26]))),wq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-StripePayment.js"),__vite__mapDeps([27,28]))),Sq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-AppleHealthSync.js"),__vite__mapDeps([29,30]))),Tq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-WearableSync.js"),__vite__mapDeps([31,32]))),Aq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-PaywallModal.js"),__vite__mapDeps([11,4]))),Eq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-Onboarding.js"),__vite__mapDeps([33,34]))),Iq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-DevUnlock.js"),__vite__mapDeps([35,36]))),kq=we.lazy(()=>jt(()=>import("./chunk-1765887266800-DataRecovery.js"),__vite__mapDeps([37,38]))),Cq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-BarcodeScanner.js"),__vite__mapDeps([39,40,2,41]))),Rq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-RepCounter.js"),__vite__mapDeps([42,43]))),Dq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-GlobalFallAlert.js"),__vite__mapDeps([44,14]))),Lq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-BrainInsightsDashboard.js"),__vite__mapDeps([45,46]))),Nq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-TodayOverview.js"),__vite__mapDeps([47,48]))),Pq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-HomeActionButton.js"),__vite__mapDeps([49,50]))),Oq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-StatsModal.js"),__vite__mapDeps([51,52]))),Mq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-PremiumModal.js"),__vite__mapDeps([53,11,4,54]))),Fq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-BattlesModal.js"),__vite__mapDeps([55,20,21,6,22,56]))),jq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-FoodModal.js"),__vite__mapDeps([57,0,1,2,3,4,58]))),Vq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-DNAModal.js"),__vite__mapDeps([59,18,11,4,19,60]))),mN=we.lazy(()=>jt(()=>import("./chunk-1765887266801-WorkoutsModalNew.js"),__vite__mapDeps([61,62]))),zq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-HealthModal.js"),__vite__mapDeps([63,8,6,9,64]))),Uq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-GoalsModal.js"),__vite__mapDeps([65,66]))),Bq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-ProgressModal.js"),__vite__mapDeps([67,68]))),$q=we.lazy(()=>jt(()=>import("./chunk-1765887266801-CommunityRecipes.js"),__vite__mapDeps([69,70]))),Hq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-StreakCounter.js"),__vite__mapDeps([71,72]))),Gq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-LevelProgressBar.js"),__vite__mapDeps([73,74]))),Kq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-DailyChallenges.js"),__vite__mapDeps([75,76]))),Wq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-AchievementUnlock.js"),__vite__mapDeps([77,78]))),qq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-VoiceTabRedesign.js"),__vite__mapDeps([79,80,81,82]))),Yq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-ZenTabRedesign.js"),__vite__mapDeps([83,80,81,84]))),Xq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-ScanTabRedesign.js"),__vite__mapDeps([85,80,81,86]))),Jq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-ProfileTabRedesign.js"),__vite__mapDeps([87,88]))),Qq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-AIAssistantModal.js"),__vite__mapDeps([89,90]))),Zq=we.lazy(()=>jt(()=>import("./chunk-1765887266801-HealthToolsModal.js"),__vite__mapDeps([91,92]))),eY=we.lazy(()=>jt(()=>import("./chunk-1765887266801-DataManagementModal.js"),__vite__mapDeps([93,94]))),tY=we.lazy(()=>jt(()=>import("./chunk-1765887266801-SocialFeaturesModal.js"),__vite__mapDeps([95,96]))),nY=we.lazy(()=>jt(()=>import("./chunk-1765887266801-SettingsHubModal.js"),__vite__mapDeps([97,98]))),iY=we.lazy(()=>jt(()=>import("./chunk-1765887266801-QuickLogModal.js"),__vite__mapDeps([99,100])));function rY(){const i=Mp(),[e,t]=we.useState("home"),[n,r]=we.useState(null),[s,l]=we.useState(!1),[u,h]=we.useState(!1),[f,x]=we.useState(!1),[p,w]=we.useState([]),[A,B]=we.useState(0),[$,W]=we.useState(!1),[q,ge]=we.useState(!1),[he,me]=we.useState(!1),[Ce,Ve]=we.useState(!1),[pe,ee]=we.useState(!1),[J,ye]=we.useState(!1),[X,ae]=we.useState(!1),[le,ze]=we.useState(!1),[nt,je]=we.useState(!1),[Je,qe]=we.useState(!1),[lt,Tt]=we.useState(null),[Ne,se]=we.useState(!1),[Ee,Le]=we.useState(!1),[Be,He]=we.useState(!1),[Ye,it]=we.useState(!1),[ct,Et]=we.useState(!1),[Ft,Wt]=we.useState(!1),[qt,kt]=we.useState(!1),[Pe,$t]=we.useState(!1),[Pt,Tn]=we.useState(null),[_t,rn]=we.useState(!0),[Jt,En]=we.useState(!1),[wn,Un]=we.useState(!1),[ii,Bn]=we.useState(!1),[li,Xn]=we.useState(!1),[cn,$n]=we.useState(!1),[hn,nr]=we.useState(!1),[Jn,vn]=we.useState(!1);we.useEffect(()=>{const At=St=>{const{level:fn}=St.detail;Tn({id:"level_up",icon:"",name:`Level ${fn} Reached!`,description:`You've reached level ${fn}! Keep going!`,xp:fn*100})};return window.addEventListener("levelUp",At),()=>window.removeEventListener("levelUp",At)},[]);const[On,qn]=we.useState(!1),[un,Pi]=we.useState(!1),[Mn,Sn]=we.useState(null),[Qn,tn]=we.useState(!1),[Gt,Kn]=we.useState(!1),[Nr,vr]=we.useState(!1),[Pr,Ri]=we.useState({show:!1,featureName:"",message:"",currentPlan:"",requiredPlan:"",onUpgrade:null}),[pn,Ra]=we.useState(!1),[sa,Or]=we.useState(!1),[bs,Oi]=we.useState(()=>localStorage.getItem("helio_dev_mode")==="true"),[ir,cr]=we.useState(!0),[cs,ns]=we.useState(!1),[qi,Yi]=we.useState("detecting"),[Xr,hs]=we.useState(!1),[ya,Ba]=we.useState(!1),[ds,Jr]=we.useState({streak:7,todaySteps:0,goalSteps:1e4,waterCups:0,waterGoal:8,mealsLogged:0,mealsGoal:3,wellnessScore:78,level:5,xp:450,xpToNext:600,weeklySteps:Array.from({length:7},()=>({steps:0,date:null})),heartRate:null,sleepHours:0,sleepQuality:null}),[ro,Ms]=we.useState(!1),[Fs,aa]=we.useState(!1),[js,hr]=we.useState(!1),[vl,Vs]=we.useState(!1),[va,Is]=we.useState(!1),[jo,nl]=we.useState(!1),[il,Vo]=we.useState(!1),oi=()=>{if(!or.hasAccess("meditation")){const At=or.showPaywall("meditation",()=>tn(!0));Ri(At);return}kt(!0)},Hr=()=>{if(!or.hasAccess("breathing")){const At=or.showPaywall("breathing",()=>tn(!0));Ri(At);return}Et(!0)},_r=()=>{if(!or.hasAccess("workouts")){const At=or.showPaywall("workouts",()=>tn(!0));Ri(At);return}Vo(!0)},dn=()=>{if(!or.hasAccess("heartRate")){const At=or.showPaywall("heartRate",()=>tn(!0));Ri(At);return}hr(!0)},Da=()=>{if(!or.hasAccess("sleepTracking")){const At=or.showPaywall("sleepTracking",()=>tn(!0));Ri(At);return}Vs(!0)};we.useCallback(()=>{console.log(" REP COUNTER HANDLER CALLED"),qe(!0)},[]);function zs(){if(!or.checkLimit("foodScans").allowed){const St=or.showPaywall("foodScanner",()=>tn(!0));Ri(St);return}me(!0)}const yi=(At,...St)=>{if(!or.hasAccess("pdfExport")){const fn=or.showPaywall("pdfExport",()=>tn(!0));Ri(fn);return}At(...St)},$a=async()=>{await Mi(),yi(Lh.exportDailyStats.bind(Lh),ds)},ri=async()=>{await Mi(),yi(Lh.exportWorkoutHistory.bind(Lh))},dr=async()=>{await Mi(),yi(Lh.exportFoodLog.bind(Lh))},Mr=async()=>{await Mi(),yi(Lh.exportFullReport.bind(Lh),ds)};we.useEffect(()=>{jt(async()=>{const{default:At}=await import("./chunk-1765887266801-emergencyService.js");return{default:At}},[]).then(({default:At})=>{At.setGlobalFallAlertCallback(St=>{Sn(St),Pi(!0)}),setTimeout(async()=>{try{if((await At.loadEmergencyData())?.fallDetection)if(console.log(" [AUTO-START] Fall detection was enabled, resuming..."),window.AndroidFallDetection){console.log(" [AUTO-START] Starting native fall detection service (24/7)...");const fn=await jt(()=>import("./chunk-1765887266801-nativeFallDetectionService.js"),[]),{default:ui}=fn;await ui.start(),console.log(" [AUTO-START] Native fall detection resumed - works 24/7 even when app closed!")}else console.log(" [AUTO-START] Starting JS fall detection (only works when app open)..."),await At.startFallDetection(At.globalFallAlertCallback),console.log(" [AUTO-START] JS fall detection resumed - only works while app is open");else console.log(" [AUTO-START] Fall detection was not previously enabled, skipping auto-resume")}catch(St){console.error(" [AUTO-START] Fall detection auto-resume failed:",St)}},2e3)})},[]),we.useEffect(()=>{(async()=>{await r2.initialize()})()},[]),we.useEffect(()=>{const At=localStorage.getItem("themeSettings");if(At)try{const{theme:St,accentColor:fn}=JSON.parse(At);document.documentElement.setAttribute("data-theme",St||"dark"),document.body.setAttribute("data-theme",St||"dark"),document.documentElement.style.setProperty("--theme-accent-color",fn||"#8B5FE8"),console.log(" Theme loaded on startup:",St,fn),console.log(" HTML data-theme:",document.documentElement.getAttribute("data-theme")),console.log(" Body data-theme:",document.body.getAttribute("data-theme")),console.log(" Accent color:",document.documentElement.style.getPropertyValue("--theme-accent-color")),setTimeout(()=>{document.body.style.display="none",document.body.offsetHeight,document.body.style.display=""},50)}catch(St){console.warn("Failed to load theme:",St)}else console.log(" No saved theme found, using default dark theme"),document.documentElement.setAttribute("data-theme","dark"),document.body.setAttribute("data-theme","dark")},[]),we.useEffect(()=>{localStorage.getItem("onboardingCompleted")||Ra(!0)},[]);const zo=async()=>{if(console.log(" CLEARING ALL CACHES..."),"caches"in window){const At=await caches.keys();await Promise.all(At.map(St=>caches.delete(St))),console.log(" Service worker caches cleared")}if("serviceWorker"in navigator){const At=await navigator.serviceWorker.getRegistrations();await Promise.all(At.map(St=>St.unregister())),console.log(" Service workers unregistered")}console.log(" RELOADING APP..."),window.location.reload(!0)};we.useEffect(()=>{window.clearCache=zo,console.log(" Emergency function available: window.clearCache()")},[]),we.useEffect(()=>{(async()=>{await zb.initialize()})(),localStorage.getItem("helio_dev_mode")==="true"&&Oi(!0)},[]),we.useEffect(()=>{(async()=>{await e2.initialize();const St=await lq.generateDailyTip();St&&(Tt(St),window.dnaDailyTip=St)})()},[]),we.useEffect(()=>{document.body.classList.remove("barcode-scanning-active"),document.querySelector("html")?.classList.remove("barcode-scanning-active"),document.body.offsetHeight},[]),we.useEffect(()=>{if(e==="home"){try{$H.showBackground()}catch{}document.body.classList.remove("barcode-scanning-active"),document.querySelector("html")?.classList.remove("barcode-scanning-active"),document.body.offsetHeight,requestAnimationFrame(()=>{document.body.offsetHeight})}},[e]);const $l=async At=>{try{const St=await zb.unlockDevMode(At);return St.success?(Oi(!0),Or(!1),alert(` Developer Mode Activated!

All premium features unlocked for testing.`),{success:!0}):{success:!1,message:St.message}}catch{return{success:!1,message:"Authentication failed"}}},Uo=()=>{confirm(` Disable Developer Mode?

This will lock all premium features and require password to re-enable.`)&&(localStorage.removeItem("helio_dev_mode"),zb.isDevMode=!1,Oi(!1),alert(" Developer mode disabled. App will reload."),window.location.reload())},br=async()=>{try{const At=Pc.getStepCount(),St=new Date().toISOString().split("T")[0],fn=Ti.getCurrentUser()?.uid;await yn.set({key:"stepBaseline",value:At.toString()}),await yn.set({key:"stepBaselineDate",value:St}),await mi.save("stepBaseline",At.toString(),fn),await mi.save("stepBaselineDate",St,fn);const ui=new Date().getDay(),Xi=ui===0?6:ui-1,vi=await mi.get("weeklySteps",fn)||[];for(;vi.length<7;)vi.push({steps:0,date:null});vi[Xi]={steps:0,date:St},await mi.save("weeklySteps",vi,fn),Jr(Qt=>({...Qt,todaySteps:0,weeklySteps:vi})),alert(` Step Counter Reset!

Baseline: ${At}
Date: ${St}

Today's steps will now start from 0.`),window.location.reload()}catch(At){alert(" Reset failed: "+At.message)}},_l=async()=>{console.log(" User requested background step tracking"),Ba(!0);try{console.log(" Step 1: Requesting notification permission...");const{LocalNotifications:At}=await jt(async()=>{const{LocalNotifications:vi}=await Promise.resolve().then(()=>O1);return{LocalNotifications:vi}},void 0),St=await At.checkPermissions();if(console.log("Current notification permission:",St),St.display!=="granted"){console.log("Requesting notification permission...");const vi=await At.requestPermissions();if(console.log("Notification permission result:",vi),vi.display!=="granted"){alert(` Notification Permission Required

Foreground services need notification permission to run 24/7.

Please grant notification permission in the next dialog.`),Ba(!1);return}}console.log(" Notification permission granted"),console.log(" Step 2: Starting native step counter service...");const fn=await jt(()=>import("./chunk-1765887266800-nativeStepService.js"),[]).catch(vi=>{throw console.error(" Failed to import nativeStepService:",vi),new Error("Service module not available")}),{default:ui}=fn;if(await ui.start()){hs(!0),console.log(" Service started successfully!");let vi=!1;const Qt=setInterval(async()=>{if(vi){console.log(" Polling: Skipping - previous save still in progress");return}try{vi=!0,console.log(" [POLLING] Refreshing dashboard stats..."),await oa(),Ha(),console.log(" [POLLING] Dashboard updated successfully")}catch(xs){console.error(" [POLLING] Error:",xs)}finally{vi=!1}},3e4);window.__stepPollingInterval=Qt,setTimeout(async()=>{console.log(" [STARTUP] Loading initial data..."),await oa(),Ha(),console.log(" [STARTUP] Initial data loaded"),alert(` 24/7 Step Tracking Enabled!

 Persistent notification showing
 Steps count even when app is closed
 Dashboard syncs every 30 seconds

Walk around and watch both notification and dashboard update!`)},500)}else alert(` Failed to Start Service

Possible reasons:
 No step counter sensor on device
 Permission denied
 Service already running

Check notification area for " Helio Active"`)}catch(At){console.error(" Failed to start background tracking:",At),alert(` Error Starting Service

`+At.message+`

Try restarting the app or checking app permissions in settings.`)}finally{Ba(!1)}};we.useEffect(()=>{(async()=>{const St=Ti.getCurrentUser()?.uid;if(!St)return;const fn=await mi.get("weeklySteps",St);if(fn&&fn.length>0){console.log(" [FIRST-LAUNCH] Cloud data exists, skipping restore");return}console.log(" [FIRST-LAUNCH] No cloud data - restoring from Preferences...");try{const{Preferences:ui}=await jt(async()=>{const{Preferences:vi}=await Promise.resolve().then(()=>Ex);return{Preferences:vi}},void 0),Xi=await ui.get({key:"wellnessai_todaySteps"});if(Xi.value){const vi=Xi.value;let Qt=0;try{Qt=parseInt(JSON.parse(vi))}catch{Qt=parseInt(vi)}console.log(" [FIRST-LAUNCH] Restored",Qt,"steps from Preferences");const xs=new Date().toISOString().split("T")[0],_a=new Date().getDay(),Us=_a===0?6:_a-1,Er=Array(7).fill(null).map(()=>({steps:0,date:null,timestamp:0}));Er[Us]={steps:Qt,date:xs,timestamp:Date.now()},await mi.save("weeklySteps",Er,St),console.log(" [FIRST-LAUNCH] Saved to cloud with timestamp")}else console.log(" [FIRST-LAUNCH] No Preferences data to restore")}catch(ui){console.error(" [FIRST-LAUNCH] Restore failed:",ui)}})()},[]);const oa=async()=>{if(f){console.log(" loadRealData: Skipping - already in progress");return}x(!0);const At=new Date().toISOString().split("T")[0];try{let St=0;try{const{Preferences:on}=await jt(async()=>{const{Preferences:Di}=await Promise.resolve().then(()=>Ex);return{Preferences:Di}},void 0);try{const Cr=(await on.get({key:"wellnessai_todaySteps"})).value||"0";try{St=parseInt(JSON.parse(Cr))}catch{St=parseInt(Cr)}console.log(" [DASHBOARD] Today steps from notification service:",St)}catch(Di){console.warn(" Could not read today steps:",Di),St=0}console.log(" [DASHBOARD] Using today steps:",St)}catch(on){console.error(" Error reading steps:",on),St=0}const fn=Ti.getCurrentUser()?.uid,vi=(await mi.get("waterLog",fn)||[]).filter(on=>on.date===At).reduce((on,Di)=>on+(Di.cups||1),0),Us=(Ti.getCurrentUser()?.profile?.foodLog||[]).filter(on=>on.date===At||on.timestamp&&new Date(on.timestamp).toISOString().split("T")[0]===At).length,Er=await mi.get("workoutHistory",fn)||[],Ai=JSON.parse(localStorage.getItem("workoutHistory")||"[]"),ba=new Map;Ai.forEach(on=>ba.set(on.timestamp,on)),Er.forEach(on=>ba.set(on.timestamp,on));const Ci=Array.from(ba.values()).sort((on,Di)=>(Di.timestamp||0)-(on.timestamp||0));localStorage.setItem("workoutHistory",JSON.stringify(Ci)),await mi.save("workoutHistory",Ci,fn);const Bs=await mi.get("sleepLog",fn)||[],Ga=JSON.parse(localStorage.getItem("sleepLog")||"[]"),$s=new Map;Ga.forEach(on=>$s.set(on.timestamp,on)),Bs.forEach(on=>$s.set(on.timestamp,on));const gn=Array.from($s.values()).sort((on,Di)=>(Di.timestamp||0)-(on.timestamp||0));localStorage.setItem("sleepLog",JSON.stringify(gn)),await mi.save("sleepLog",gn,fn);try{const{default:on}=await jt(async()=>{const{default:Di}=await import("./chunk-1765887266801-socialBattlesService.js");return{default:Di}},__vite__mapDeps([21,6]));await on.init()}catch(on){console.warn("Failed to sync battle data:",on)}const ks=await mi.get("loginHistory",fn)||[];let La=0;if(ks.length>0){const on=ks.sort((Cr,la)=>new Date(la.date)-new Date(Cr.date));let Di=new Date;La=1;for(let Cr=1;Cr<on.length;Cr++){const la=new Date(on[Cr].date),j=Math.floor((Di-la)/(1e3*60*60*24));if(j===1)La++,Di=la;else if(j>1)break}}const Ir=await mi.get("weeklySteps",fn)||[],kr=new Date().getDay(),Hs=kr===0?6:kr-1,xr=new Date().toISOString().split("T")[0];for(;Ir.length<7;)Ir.push({steps:0,date:null});if(kr===1){const on=Ir[0]?.date;if(on&&on!==xr)for(let Di=0;Di<7;Di++)Ir[Di]={steps:0,date:null}}const Gs=Ir[Hs],Ka=JSON.parse(localStorage.getItem("stepHistory")||"[]"),Gr=Array.isArray(Ka)?Ka:[],fs=Gr.find(on=>on.date===xr)?.steps||0;if(Gs?.date===xr){const on=Gs.steps||0,Di=St||0,Cr=Gs.timestamp||0,la=Date.now();if(on>1e3&&Di<500&&on>Di*10){console.log(" CORRUPTION DETECTED: Cloud="+on+" vs Live="+Di+" - using live sensor!"),St=Di,Ir[Hs]={steps:St,date:xr,timestamp:Date.now()},await mi.save("weeklySteps",Ir,fn),localStorage.setItem("stepHistory",JSON.stringify([])),console.log(" CORRUPTION FIXED: Reset to "+St+" steps"),console.log(" [DASHBOARD] Setting stats.todaySteps to:",St),console.log(" [DASHBOARD] Stats updated! Should now show:",St,"steps"),Jr({...ds,todaySteps:St});return}const fe=Cr>0&&la-Cr>6e5;fe?(console.log(" Cloud data is stale ("+Math.round((la-Cr)/6e4)+" min old) - ignoring and using live sensor"),St=Math.max(fs,Di)):St=Math.max(on,fs,Di),console.log(" Step merge: cloud="+on+" (stale="+fe+") history="+fs+" live="+Di+"  using="+St)}else{const on=Math.max(fs,St);St=on,console.log(" Cloud steps are from",Gs?.date,"- using max(history="+fs+", live="+St+") =",on)}const ao=Gs.steps!==St,To=ao?Date.now():cloudTimestamp||Date.now();Ir[Hs]={steps:St,date:xr,timestamp:To},console.log(" Weekly array updated: index",Hs,"steps",St,"timestamp",To,"changed=",ao),await mi.save("weeklySteps",Ir,fn);const Ks=Gr.findIndex(on=>on.date===xr);Ks>=0?Gr[Ks]={steps:St,date:xr,timestamp:Date.now()}:Gr.push({steps:St,date:xr,timestamp:Date.now()}),localStorage.setItem("stepHistory",JSON.stringify(Gr)),console.log(" [DASHBOARD] Setting stats.todaySteps to:",St),Jr(on=>({...on,todaySteps:St,waterCups:vi,mealsLogged:Us,streak:La||on.streak,weeklySteps:Ir})),console.log(" [DASHBOARD] Stats updated! Should now show:",St,"steps")}catch{}finally{x(!1)}};we.useEffect(()=>((async()=>{console.log(" [MOUNT] Loading dashboard data immediately..."),await oa(),Ha(),console.log(" [MOUNT] Initial data loaded");try{const St=await lf.checkIn();St.alreadyCheckedIn||St.leveledUp}catch(St){console.error(" [GAMIFICATION] Check-in failed:",St)}try{console.log(" [AUTO-START] Checking if foreground service is running...");const St=await jt(()=>import("./chunk-1765887266800-nativeStepService.js"),[]).catch(Xi=>(console.error(" Failed to import nativeStepService:",Xi),null));if(!St){console.warn(" [AUTO-START] Service module not available");return}const{default:fn}=St,ui=fn.isRunning;if(console.log(" [AUTO-START] Service running status:",ui),ui)console.log(" [AUTO-START] Foreground service already running"),hs(!0);else{console.log(" [AUTO-START] Foreground service not running - starting automatically...");const{LocalNotifications:Xi}=await jt(async()=>{const{LocalNotifications:Qt}=await Promise.resolve().then(()=>O1);return{LocalNotifications:Qt}},void 0),vi=await Xi.checkPermissions();if(console.log(" [AUTO-START] Notification permission:",vi.display),vi.display==="granted"){console.log(" [AUTO-START] Permission granted, starting service...");const Qt=await fn.start();if(console.log(" [AUTO-START] Service start result:",Qt),Qt){hs(!0),console.log(" [AUTO-START] Foreground service started successfully!");const xs=setInterval(async()=>{console.log(" [POLLING] Refreshing dashboard stats..."),await oa()},3e4);window._stepPollInterval=xs}}else console.log(" [AUTO-START] Notification permission not granted - service needs manual start")}}catch(St){console.error(" [AUTO-START] Failed to auto-start service:",St)}})(),()=>{window._stepPollInterval&&(console.log(" Cleaning up polling interval"),clearInterval(window._stepPollInterval))}),[]),we.useEffect(()=>{Tr.trackPageView("Dashboard_Home"),window.subscriptionService=or,(async()=>{await Ti.initialize(),await Jh.initialize();const ui=Ti.getCurrentUser();ui&&(r(ui),!ui.profile?.allergens&&!ui.profile?.age&&l(!0))})();let St=null;return(async()=>{try{await Pc.initialize(),await new Promise(ui=>setTimeout(ui,100)),Pc.isUsingMultiSensor?(Yi("multisensor"),window.stepMethod="multisensor",window.activeSensorCount=Pc.activeSensorCount):Pc.isUsingHardware?(Yi("hardware"),window.stepMethod="hardware"):(Yi("software"),window.stepMethod="software"),St=()=>{const ui=Pc.stepListeners.indexOf(stepListener);ui>-1&&Pc.stepListeners.splice(ui,1),Pc.cleanup()}}catch{}})(),()=>{St&&St()}},[]);const Mi=async()=>{const At=new Date().toISOString().split("T")[0],St=Pc.getStepCount(),Xi=JSON.parse(localStorage.getItem("waterLog")||"[]").filter(Ai=>Ai.date===At).reduce((Ai,ba)=>Ai+(ba.cups||1),0),_a=(Ti.getCurrentUser()?.profile?.foodLog||[]).filter(Ai=>Ai.date===At||Ai.timestamp&&new Date(Ai.timestamp).toISOString().split("T")[0]===At).length;JSON.parse(localStorage.getItem("workoutHistory")||"[]").filter(Ai=>Ai.date===At).length,Jr(Ai=>({...Ai,todaySteps:St,waterCups:Xi,mealsLogged:_a})),await Ha()};we.useEffect(()=>{R1.initialize(),iG.initialize(),Fd.isConnected()&&(Ms(!0),Fd.subscribe(St=>{Jr(fn=>({...fn,heartRate:St.bpm}))})),ep.isTracking&&aa(!0),ep.restoreSleepSession();const At=()=>{Is(!0)};return window.addEventListener("openHeartRate",dn),window.addEventListener("openSleep",Da),window.addEventListener("openWaterModal",At),window.addEventListener("openWorkouts",_r),window.addEventListener("openFoodScanner",zs),window.addEventListener("openBreathing",Hr),window.addEventListener("openGuidedMeditation",oi),()=>{window.removeEventListener("openHeartRate",dn),window.removeEventListener("openSleep",Da),window.removeEventListener("openWaterModal",At),window.removeEventListener("openWorkouts",_r),window.removeEventListener("openFoodScanner",zs),window.removeEventListener("openBreathing",Hr),window.removeEventListener("openGuidedMeditation",oi)}},[]);const so=()=>{const At=new Date().getHours(),St=n?.profile?.fullName||n?.displayName||n?.name||n?.profile?.name||"Champion";return At<12?`Good morning, ${St}! `:At<18?`Good afternoon, ${St}! `:`Good evening, ${St}! `},bl=()=>{const At=["You're absolutely crushing it today! ","Keep going, you're unstoppable! ","Your future self will thank you! ","Every step counts. You got this! ","Small wins lead to big victories! "];return At[Math.floor(Math.random()*At.length)]},xl=()=>{h(!0),setTimeout(()=>h(!1),3e3)},Bo=async()=>{const At=[],St=new Date().toISOString().split("T")[0];try{const fn=JSON.parse(localStorage.getItem("stepHistory")||"[]");(Array.isArray(fn)?fn:[]).filter(gn=>gn.date===St).forEach(gn=>{At.push({type:"steps",icon:"",text:`${gn.steps} steps`,time:new Date(gn.timestamp||Date.now()).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.timestamp||Date.now(),calories:Math.floor(gn.steps*.04)})});const Xi=JSON.parse(localStorage.getItem("workoutHistory")||"[]");(Array.isArray(Xi)?Xi:[]).filter(gn=>gn.date===St).forEach(gn=>{At.push({type:"workout",icon:"",text:`${gn.type||"Workout"} - ${gn.duration||0} min`,time:new Date(gn.timestamp||Date.now()).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.timestamp||Date.now(),calories:gn.calories||0})});const{value:Qt}=await yn.get({key:"foodLog"}),xs=Qt?JSON.parse(Qt):[];(Array.isArray(xs)?xs:[]).filter(gn=>gn.date===St||new Date(gn.timestamp).toISOString().split("T")[0]===St).forEach(gn=>{At.push({type:"meal",icon:"",text:gn.name||"Meal logged",time:new Date(gn.timestamp||Date.now()).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.timestamp||Date.now(),calories:gn.calories||0})});const Us=JSON.parse(localStorage.getItem("sleepLog")||"[]");(Array.isArray(Us)?Us:[]).filter(gn=>gn.date===St).forEach(gn=>{At.push({type:"sleep",icon:"",text:`${gn.hours||0}h ${gn.minutes||0}m sleep`,time:new Date(gn.timestamp||Date.now()).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.timestamp||Date.now()})});const Ai=JSON.parse(localStorage.getItem("waterLog")||"[]");(Array.isArray(Ai)?Ai:[]).filter(gn=>gn.date===St).forEach(gn=>{At.push({type:"water",icon:"",text:`${gn.cups||1} cup water`,time:new Date(gn.timestamp||Date.now()).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.timestamp||Date.now()})});const Ci=JSON.parse(localStorage.getItem("meditationLog")||"[]");(Array.isArray(Ci)?Ci:[]).filter(gn=>gn.date===St).forEach(gn=>{At.push({type:"meditation",icon:"",text:`${gn.duration||0} min meditation`,time:new Date(gn.timestamp||Date.now()).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.timestamp||Date.now()})});const Ga=JSON.parse(localStorage.getItem("activityLog")||"[]");(Array.isArray(Ga)?Ga:[]).filter(gn=>new Date(gn.startTime).toISOString().split("T")[0]===St).forEach(gn=>{gn.activity&&gn.activity!=="stationary"&&At.push({type:"activity",icon:gn.activity==="running"?"":gn.activity==="walking"?"":"",text:`${gn.activity} detected`,time:new Date(gn.startTime).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),timestamp:gn.startTime})})}catch{}return At.sort((fn,ui)=>(ui.timestamp||0)-(fn.timestamp||0))},Ha=async()=>{const At=await Bo();w(At.slice(0,10)),B(At.length)};return we.useEffect(()=>{e==="home"&&Ha()},[e]),b.jsxs("div",{className:"new-dashboard",children:[b.jsx(we.Suspense,{fallback:null,children:b.jsx(Hq,{})}),Pt&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(Wq,{achievement:Pt,onClose:()=>Tn(null)})}),Jt&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(Qq,{userName:n?.name||n?.profile?.name||"Friend",onClose:()=>En(!1)})}),li&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(Lq,{onClose:()=>Xn(!1)})}),wn&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(Zq,{onClose:()=>Un(!1),onOpenHealthAvatar:()=>{Un(!1),Tr.trackFeatureUse("Health_Avatar"),W(!0)},onOpenARScanner:()=>{Un(!1),Tr.trackFeatureUse("AR_Scanner"),ge(!0)},onOpenEmergency:()=>{Un(!1),Tr.trackFeatureUse("Emergency_Panel"),Ve(!0)},onOpenInsurance:()=>{Un(!1),Tr.trackFeatureUse("Insurance_Rewards"),ee(!0)}})}),ii&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(eY,{onClose:()=>Bn(!1),onOpenDNA:()=>{Bn(!1),Tr.trackFeatureUse("DNA_Analysis"),ye(!0)},onExportDailyStats:$a,onExportWorkoutHistory:ri,onExportFoodLog:dr,onExportFullReport:Mr,checkFeatureAccess:(At,St)=>{if(or.hasAccess(At))St();else{Bn(!1);const fn=or.showPaywall(At,()=>tn(!0));Ri(fn)}}})}),cn&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(tY,{onClose:()=>$n(!1),onOpenBattles:()=>{$n(!1),Tr.trackFeatureUse("Social_Battles"),ae(!0)},onOpenMeals:()=>{$n(!1),Tr.trackFeatureUse("Meal_Automation"),ze(!0)},checkFeatureAccess:(At,St)=>{if(or.hasAccess(At))St();else{$n(!1);const fn=or.showPaywall(At,()=>tn(!0));Ri(fn)}}})}),hn&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(nY,{onClose:()=>nr(!1),onOpenNotifications:()=>{nr(!1),Le(!0)},onOpenTheme:()=>{nr(!1),He(!0)},onOpenDevUnlock:()=>{nr(!1),Or(!0)},onLogout:()=>{nr(!1),Ti.signOut(),i("/")},showDevButton:ir,isDevMode:bs,onDisableDevMode:Uo,onResetStepCounter:br,user:{...n,onOpenStripePayment:()=>tn(!0),onOpenAppleHealth:()=>Kn(!0),onOpenWearables:()=>vr(!0),onOpenDataRecovery:()=>ns(!0)}})}),Jn&&b.jsx(we.Suspense,{fallback:null,children:b.jsx(iY,{isOpen:Jn,onClose:()=>vn(!1)})}),u&&b.jsx("div",{className:"confetti-container",children:[...Array(50)].map((At,St)=>b.jsx("div",{className:"confetti",style:{left:`${Math.random()*100}%`,animationDelay:`${Math.random()*.5}s`,background:["#FF6B35","#FFB84D","#44FF44","#00C8FF","#FF00FF"][Math.floor(Math.random()*5)]}},St))}),b.jsxs("div",{className:"dashboard-content",children:[e==="home"&&b.jsxs(b.Fragment,{children:[b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Gq,{})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Kq,{onChallengeComplete:At=>{}})}),b.jsx(sY,{stats:ds,greeting:so(),motivation:bl(),onGoalComplete:xl,recentActivities:p,activityCount:A,onOpenActivityPulse:()=>it(!0),stepMethod:qi,handleOpenWorkouts:_r,handleOpenFoodScanner:zs,handleOpenHeartRate:dn,handleOpenSleep:Da,onOpenBarcodeScanner:()=>{Tr.trackFeatureUse("Barcode_Scanner"),je(!0)},onOpenRecipeCreator:()=>{Tr.trackFeatureUse("Recipe_Creator"),ze(!0)},onOpenRestaurants:()=>{Tr.trackFeatureUse("Restaurants"),je(!0)},onOpenSocial:()=>{Tr.trackFeatureUse("Social_Battles"),ae(!0)},onOpenRepCounter:()=>{Tr.trackFeatureUse("Rep_Counter"),qe(!0)},onOpenBrainInsights:()=>{Tr.trackFeatureUse("Brain_Insights"),Xn(!0)},nativeServiceRunning:Xr,nativeServiceStarting:ya,onStartNativeService:_l,setNativeServiceRunning:hs,onOpenQuickLog:()=>vn(!0)})]}),e==="voice"&&_t&&b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(qq,{userName:n?.name||n?.profile?.name||"Friend",onOpenVoiceChat:At=>{},onOpenAIAssistant:()=>En(!0)})}),e==="voice"&&!_t&&b.jsx(aY,{userName:n?.name||n?.profile?.name||"Friend"}),e==="scan"&&_t&&b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Xq,{onOpenFoodScanner:()=>{Tr.trackFeatureUse("Food_Scanner"),me(!0)},onOpenARScanner:()=>{Tr.trackFeatureUse("AR_Scanner"),ge(!0)},onOpenBarcodeScanner:()=>{Tr.trackFeatureUse("Barcode_Scanner"),je(!0)},onOpenRepCounter:()=>{Tr.trackFeatureUse("Rep_Counter"),qe(!0)}})}),e==="scan"&&!_t&&b.jsx(oY,{onOpenFoodScanner:()=>{Tr.trackFeatureUse("Food_Scanner"),me(!0)},onOpenARScanner:()=>{Tr.trackFeatureUse("AR_Scanner"),ge(!0)},onOpenBarcodeScanner:()=>{Tr.trackFeatureUse("Barcode_Scanner"),je(!0)},onOpenRepCounter:()=>{Tr.trackFeatureUse("Rep_Counter"),qe(!0)}}),e==="zen"&&_t&&b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Yq,{onOpenBreathing:Hr,onOpenMeditation:oi})}),e==="zen"&&!_t&&b.jsx(lY,{onOpenBreathing:Hr,onOpenStressRelief:Hr,onOpenGuidedMeditation:oi,onOpenGratitudeJournal:()=>$t(!0)}),e==="me"&&_t&&b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Jq,{user:n,onOpenSettings:At=>{},onOpenPremium:()=>tn(!0),onOpenHealthTools:()=>Un(!0),onOpenDataManagement:()=>Bn(!0),onOpenSocialFeatures:()=>$n(!0),onOpenSettingsHub:()=>nr(!0),onEditProfile:()=>l(!0),onOpenFullStats:()=>se(!0)})}),e==="me"&&!_t&&b.jsx(uY,{user:{...n,onOpenStripePayment:()=>tn(!0),onOpenAppleHealth:()=>Kn(!0),onOpenWearables:()=>vr(!0),onOpenDataRecovery:()=>ns(!0)},stats:ds,onOpenHealthAvatar:()=>{Tr.trackFeatureUse("Health_Avatar"),W(!0)},onOpenARScanner:()=>{Tr.trackFeatureUse("AR_Scanner"),ge(!0)},onOpenEmergency:()=>{Tr.trackFeatureUse("Emergency_Panel"),Ve(!0)},onOpenInsurance:()=>{Tr.trackFeatureUse("Insurance_Rewards"),ee(!0)},onOpenDNA:()=>{Tr.trackFeatureUse("DNA_Analysis"),ye(!0)},onOpenBattles:()=>{Tr.trackFeatureUse("Social_Battles"),ae(!0)},onOpenMeals:()=>{Tr.trackFeatureUse("Meal_Automation"),ze(!0)},onEditProfile:()=>l(!0),onOpenFullStats:async()=>{await Mi(),se(!0)},onOpenNotifications:()=>Le(!0),onOpenTheme:()=>He(!0),onLogout:()=>{Ti.signOut(),i("/")},checkFeatureAccess:(At,St)=>{if(or.hasAccess(At))St();else{const fn=or.showPaywall(At,()=>tn(!0));Ri(fn)}},onExportDailyStats:$a,onExportWorkoutHistory:ri,onExportFoodLog:dr,onExportFullReport:Mr,showDevButton:ir,isDevMode:bs,onOpenDevUnlock:()=>Or(!0),onResetStepCounter:br,onDisableDevMode:Uo})]}),b.jsxs("nav",{className:"bottom-nav",children:[b.jsxs("button",{className:`nav-item ${e==="home"?"active":""}`,onClick:()=>t("home"),children:[b.jsx("span",{className:"nav-icon",children:""}),b.jsx("span",{className:"nav-label",children:"Home"})]}),b.jsxs("button",{className:`nav-item ${e==="voice"?"active":""}`,onClick:()=>t("voice"),children:[b.jsx("span",{className:"nav-icon",children:""}),b.jsx("span",{className:"nav-label",children:"Voice"})]}),b.jsx("button",{className:`nav-item center ${e==="scan"?"active":""}`,onClick:()=>t("scan"),children:b.jsx("span",{className:"nav-icon-center",children:""})}),b.jsxs("button",{className:`nav-item ${e==="zen"?"active":""}`,onClick:()=>t("zen"),children:[b.jsx("span",{className:"nav-icon",children:""}),b.jsx("span",{className:"nav-label",children:"Zen"})]}),b.jsxs("button",{className:`nav-item ${e==="me"?"active":""}`,onClick:()=>t("me"),children:[b.jsx("span",{className:"nav-icon",children:""}),b.jsx("span",{className:"nav-label",children:"Me"})]})]}),b.jsxs(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:[s&&b.jsx(nu,{fallbackMessage:"Profile setup encountered an error. Please try again.",children:b.jsx(dq,{onComplete:()=>{l(!1);const At=Ti.getCurrentUser();r(At)}})}),$&&b.jsx(nu,{fallbackMessage:"Health avatar encountered an error. Please try again.",onReset:()=>W(!1),children:b.jsx(fq,{onClose:()=>W(!1)})}),q&&b.jsx(nu,{fallbackMessage:"AR scanner encountered an error. Please try again.",onReset:()=>ge(!1),children:b.jsx(pq,{onClose:()=>ge(!1)})}),he&&b.jsx(nu,{fallbackMessage:"Food scanner encountered an error. Please try again.",onReset:()=>me(!1),children:b.jsx(hq,{onClose:()=>{me(!1),Mi()}})}),Ce&&b.jsx(nu,{fallbackMessage:"Emergency panel encountered an error. Please try again.",onReset:()=>Ve(!1),children:b.jsx(gq,{onClose:()=>Ve(!1)})}),pe&&b.jsx(nu,{fallbackMessage:"Insurance rewards encountered an error. Please try again.",onReset:()=>ee(!1),children:b.jsx(mq,{onClose:()=>ee(!1)})}),J&&b.jsx(nu,{fallbackMessage:"DNA upload encountered an error. Please try again.",onReset:()=>ye(!1),children:b.jsx(yq,{onClose:()=>ye(!1)})}),X&&b.jsx(nu,{fallbackMessage:"Social battles encountered an error. Please try again.",onReset:()=>ae(!1),children:b.jsx(vq,{onClose:async()=>{ae(!1),await Mi();const{default:At}=await jt(async()=>{const{default:St}=await import("./chunk-1765887266801-socialBattlesService.js");return{default:St}},__vite__mapDeps([21,6]));await At.init()}})}),le&&b.jsx(nu,{fallbackMessage:"Meal automation encountered an error. Please try again.",onReset:()=>ze(!1),children:b.jsx(_q,{onClose:()=>ze(!1)})}),nt&&b.jsx(nu,{fallbackMessage:"Barcode scanner encountered an error. Please try again.",onReset:()=>je(!1),children:b.jsx(Cq,{onClose:()=>je(!1),onFoodScanned:At=>{}})}),Je&&b.jsx(nu,{fallbackMessage:"Rep counter encountered an error. Please try again.",onReset:()=>qe(!1),children:b.jsx(Rq,{onClose:()=>qe(!1),onWorkoutComplete:At=>{lf.addXP(At.reps*2),qe(!1),Mi()}})})]}),Ee&&b.jsx(hY,{user:n,onClose:()=>Le(!1)}),Be&&b.jsx(dY,{onClose:()=>He(!1)}),Ne&&b.jsx(cY,{user:n,stats:ds,onClose:()=>se(!1)}),Ye&&b.jsx(fY,{activitiesPromise:Bo(),onClose:()=>it(!1)}),Ft&&b.jsx(vY,{onClose:()=>Wt(!1)}),qt&&b.jsx(_Y,{onClose:()=>kt(!1)}),js&&b.jsx(pY,{onClose:()=>{hr(!1),Mi()}}),vl&&b.jsx(gY,{onClose:async()=>{Vs(!1),await Mi();try{const{default:At}=await jt(async()=>{const{default:St}=await import("./chunk-1765887266801-healthAvatarService.js");return{default:St}},[]);At.cachedState=null,At.cacheTimestamp=0}catch(At){console.warn("Could not clear avatar cache:",At)}}}),va&&b.jsx(mY,{onClose:()=>{Is(!1),Mi()}}),il&&b.jsx(mN,{onClose:async()=>{Vo(!1),await Mi();try{const{default:At}=await jt(async()=>{const{default:St}=await import("./chunk-1765887266801-healthAvatarService.js");return{default:St}},[]);At.cachedState=null,At.cacheTimestamp=0}catch(At){console.warn("Could not clear avatar cache:",At)}}}),ct&&b.jsx(yY,{onClose:()=>{Et(!1),Mi()}}),b.jsx(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:On&&b.jsx(xq,{isOpen:On,onClose:()=>qn(!1)})}),b.jsx(we.Suspense,{fallback:null,children:un&&b.jsx(Dq,{fallData:Mn,onDismiss:()=>{Pi(!1),Sn(null)}})}),b.jsxs(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:[Qn&&b.jsx(wq,{isOpen:Qn,onClose:()=>tn(!1)}),Gt&&b.jsx(Sq,{isOpen:Gt,onClose:()=>Kn(!1)}),Nr&&b.jsx(Tq,{isOpen:Nr,onClose:()=>vr(!1)})]}),b.jsx(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:Pr.show&&b.jsx(Aq,{isOpen:Pr.show,onClose:()=>Ri({...Pr,show:!1}),featureName:Pr.featureName,message:Pr.message,currentPlan:Pr.currentPlan,requiredPlan:Pr.requiredPlan,onUpgrade:Pr.onUpgrade})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:pn&&b.jsx(Eq,{onComplete:()=>Ra(!1),onSkip:()=>Ra(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:sa&&b.jsx(Iq,{onUnlock:$l,onCancel:()=>Or(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:cs&&b.jsx(kq,{onClose:()=>ns(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{className:"modal-loading",children:"Loading..."}),children:Pe&&b.jsx(bq,{onClose:()=>$t(!1)})}),b.jsxs("button",{className:"floating-help-btn",onClick:()=>qn(!0),title:"Legal Information & Help",children:[b.jsx("span",{className:"help-icon",children:""}),b.jsx("span",{className:"help-text",children:"Legal"})]})]})}function sY({stats:i,greeting:e,motivation:t,onGoalComplete:n,recentActivities:r,activityCount:s,onOpenActivityPulse:l,stepMethod:u,handleOpenWorkouts:h,handleOpenFoodScanner:f,handleOpenHeartRate:x,handleOpenSleep:p,onOpenBarcodeScanner:w,onOpenRecipeCreator:A,onOpenRestaurants:B,onOpenSocial:$,onOpenRepCounter:W,onOpenBrainInsights:q,nativeServiceRunning:ge,nativeServiceStarting:he,onStartNativeService:me,setNativeServiceRunning:Ce,onOpenQuickLog:Ve}){const[pe,ee]=we.useState(!1),[J,ye]=we.useState(!1),[X,ae]=we.useState(!1),[le,ze]=we.useState(!1),[nt,je]=we.useState(!1),[Je,qe]=we.useState(!1),[lt,Tt]=we.useState(!1),[Ne,se]=we.useState(!1),[Ee,Le]=we.useState(!1),[Be,He]=we.useState(!1),Ye=[{icon:"",label:"AI INSIGHTS",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",onClick:q},{icon:"",label:"MY STATS",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",onClick:()=>ee(!0)},{icon:"",label:"BATTLES",gradient:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",onClick:()=>ae(!0)},{icon:"",label:"FOOD",gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",onClick:()=>ze(!0)},{icon:"",label:"DNA",gradient:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",onClick:()=>je(!0)},{icon:"",label:"WORKOUTS",gradient:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",onClick:()=>qe(!0)},{icon:"",label:"HEALTH",gradient:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)",onClick:()=>Tt(!0)},{icon:"",label:"GOALS",gradient:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",onClick:()=>se(!0)},{icon:"",label:"PROGRESS",gradient:"linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)",onClick:()=>Le(!0)},{icon:"",label:"PREMIUM",gradient:"linear-gradient(135deg, #ffd700 0%, #ffed4e 100%)",onClick:()=>ye(!0)},{icon:"",label:"RECIPES",gradient:"linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)",onClick:()=>He(!0)}];return b.jsxs("div",{className:"home-tab",style:{paddingBottom:"100px",overflowY:"auto",height:"100%"},children:[b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Nq,{todaySteps:i.todaySteps})}),!ge&&b.jsxs("button",{onClick:me,disabled:he,style:{width:"100%",padding:"12px 16px",background:"linear-gradient(135deg, #00C8FF 0%, #0088FF 100%)",border:"none",borderRadius:"12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:he?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"12px",boxShadow:"0 2px 8px rgba(0, 136, 255, 0.3)",transition:"all 0.3s ease",opacity:he?.7:1},onMouseOver:it=>{he||(it.currentTarget.style.transform="translateY(-1px)"),it.currentTarget.style.boxShadow="0 4px 12px rgba(0, 136, 255, 0.4)"},onMouseOut:it=>{it.currentTarget.style.transform="translateY(0)",it.currentTarget.style.boxShadow="0 2px 8px rgba(0, 136, 255, 0.3)"},children:[b.jsx("span",{style:{fontSize:"18px"},children:he?"":""}),b.jsx("span",{children:he?"Starting...":"Enable 24/7 Step Tracking"})]}),ge&&b.jsxs("button",{onClick:async()=>{try{const{default:it}=await jt(async()=>{const{default:ct}=await import("./chunk-1765887266800-nativeStepService.js");return{default:ct}},[]);await it.stop(),Ce(!1),window.__stepPollingInterval&&clearInterval(window.__stepPollingInterval)}catch(it){console.error("Failed to stop native service:",it),alert("Failed to stop tracking service")}},style:{width:"100%",padding:"12px 16px",background:"linear-gradient(135deg, #44FF44 0%, #00FF88 100%)",border:"none",borderRadius:"12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",boxShadow:"0 2px 8px rgba(68, 255, 68, 0.3)",transition:"all 0.3s ease"},children:[b.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[b.jsx("span",{style:{fontSize:"18px"},children:""}),b.jsx("span",{children:"24/7 Tracking Active"})]}),b.jsx("span",{style:{fontSize:"12px",opacity:.9},children:"Tap to stop"})]}),window.dnaDailyTip&&b.jsxs("div",{className:"dna-tip-banner",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"16px",borderRadius:"16px",margin:"16px 0",display:"flex",alignItems:"center",gap:"12px",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)",cursor:"pointer"},onClick:()=>alert(`${window.dnaDailyTip.tip}

Based on your ${window.dnaDailyTip.gene} gene (${window.dnaDailyTip.trait}: ${window.dnaDailyTip.value})`),children:[b.jsx("span",{style:{fontSize:"32px"},children:window.dnaDailyTip.icon}),b.jsxs("div",{style:{flex:1},children:[b.jsx("div",{style:{color:"white",fontWeight:"bold",fontSize:"14px",marginBottom:"4px"},children:" DNA Daily Tip"}),b.jsx("div",{style:{color:"rgba(255,255,255,0.9)",fontSize:"13px"},children:window.dnaDailyTip.title}),b.jsxs("div",{style:{color:"rgba(255,255,255,0.7)",fontSize:"12px",marginTop:"4px"},children:[window.dnaDailyTip.tip.substring(0,80),"..."]})]}),b.jsx("span",{style:{color:"white",fontSize:"20px"},children:""})]}),b.jsxs("button",{onClick:Ve,style:{width:"100%",padding:"12px 16px",background:"linear-gradient(135deg, #8B5FE8 0%, #C084FC 100%)",border:"none",borderRadius:"12px",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"12px",boxShadow:"0 2px 8px rgba(139, 95, 232, 0.3)",transition:"all 0.3s ease"},onMouseOver:it=>{it.currentTarget.style.transform="translateY(-1px)",it.currentTarget.style.boxShadow="0 4px 12px rgba(139, 95, 232, 0.4)"},onMouseOut:it=>{it.currentTarget.style.transform="translateY(0)",it.currentTarget.style.boxShadow="0 2px 8px rgba(139, 95, 232, 0.3)"},children:[b.jsx("span",{style:{fontSize:"18px"},children:""}),b.jsx("span",{children:"Quick Log - Water/Sleep/Workout"})]}),b.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",padding:"0 4px",marginBottom:"20px"},children:Ye.map((it,ct)=>b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Pq,{icon:it.icon,label:it.label,gradient:it.gradient,onClick:it.onClick})},ct))}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Oq,{isOpen:pe,onClose:()=>ee(!1),todaySteps:i.todaySteps})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Mq,{isOpen:J,onClose:()=>ye(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Fq,{isOpen:X,onClose:()=>ae(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(jq,{isOpen:le,onClose:()=>ze(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Vq,{isOpen:nt,onClose:()=>je(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(mN,{isOpen:Je,onClose:()=>qe(!1),onOpenRepCounter:W,onOpenWorkouts:h})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(zq,{isOpen:lt,onClose:()=>Tt(!1)})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Uq,{isOpen:Ne,onClose:()=>se(!1),todaySteps:i.todaySteps})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx(Bq,{isOpen:Ee,onClose:()=>Le(!1),todaySteps:i.todaySteps})}),b.jsx(we.Suspense,{fallback:b.jsx("div",{children:"Loading..."}),children:b.jsx($q,{isOpen:Be,onClose:()=>He(!1)})}),b.jsx("div",{style:{height:"20px",flexShrink:0}})]})}function aY({userName:i}){const[e,t]=we.useState(!1),[n,r]=we.useState(!1),[s,l]=we.useState(!1),[u,h]=we.useState(""),[f,x]=we.useState(!1),[p,w]=we.useState([{type:"ai",text:`Hey ${i}! I'm here to help. What's on your mind?`}]),A=async()=>{t(!0);try{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const Ce=window.SpeechRecognition||window.webkitSpeechRecognition,Ve=new Ce;Ve.continuous=!1,Ve.interimResults=!1,Ve.lang="en-US",Ve.onresult=pe=>{const ee=pe.results[0][0].transcript;t(!1),W(ee)},Ve.onerror=pe=>{t(!1),w(ee=>[...ee,{type:"ai",text:"I couldn't hear you. Try typing instead!"}])},Ve.onend=()=>{t(!1)},Ve.start();return}const{SpeechRecognition:he}=await jt(async()=>{const{SpeechRecognition:Ce}=await import("./chunk-1765887266801-index.js");return{SpeechRecognition:Ce}},[]);try{if(!(await he.available()).available)throw new Error("Speech recognition not available")}catch{throw new Error("Speech not supported")}try{if((await he.requestPermissions()).speechRecognition!=="granted"){alert("Please allow microphone access in your phone settings"),t(!1);return}}catch{alert("Microphone permission required. Please enable it in Settings."),t(!1);return}try{await he.removeAllListeners()}catch{}let me=!1;he.addListener("error",Ce=>{me||(w(Ve=>[...Ve,{type:"ai",text:"I couldn't hear you clearly. Please try again or use the suggestion buttons below!"}]),t(!1))}),he.addListener("result",async Ce=>{if(me=!0,Ce.matches&&Ce.matches.length>0){const Ve=Ce.matches[0];w(pe=>[...pe,{type:"user",text:Ve}]),t(!1),r(!0);try{await he.stop()}catch{}x(!1);try{const pe=(await jt(async()=>{const{default:ye}=await Promise.resolve().then(()=>eC);return{default:ye}},void 0)).default,ee=JSON.parse(localStorage.getItem("wellnessai_user")||"{}"),J=await pe.chat(Ve,{allergens:ee.profile?.allergens||[],dietaryPreferences:ee.profile?.dietaryPreferences||[],healthGoals:ee.profile?.healthGoals||[]});w(ye=>[...ye,{type:"ai",text:J}]),await $(J)}catch{w(ee=>[...ee,{type:"ai",text:"Oops! I had trouble with that. Can you try asking in a different way?"}])}r(!1)}else t(!1)}),await he.start({language:"en-US",maxResults:5,prompt:"Speak now",partialResults:!1,popup:!0}),setTimeout(async()=>{if(!me){try{await he.stop(),w(Ce=>[...Ce,{type:"ai",text:"I didn't catch that. Try speaking again or use the suggestion buttons!"}])}catch{}t(!1)}},1e4)}catch{w(me=>[...me,{type:"ai",text:"Voice input not available right now  But I can still help! Try clicking the suggestion buttons below or typing your question."}]),t(!1)}},B=async()=>{try{const{SpeechRecognition:he}=await jt(async()=>{const{SpeechRecognition:me}=await import("./chunk-1765887266801-index.js");return{SpeechRecognition:me}},[]);await he.stop(),await he.removeAllListeners()}catch{}t(!1)},$=async he=>{try{const{TextToSpeech:me}=await jt(async()=>{const{TextToSpeech:Ce}=await Promise.resolve().then(()=>rG);return{TextToSpeech:Ce}},void 0);l(!0),await me.speak({text:he,lang:"en-US",rate:1,pitch:1,volume:1,category:"ambient"}),l(!1)}catch{l(!1)}},W=async(he,me=!1)=>{const Ce=localStorage.getItem("helio_dev_mode")==="true";if(!Ce){const Ve=or.checkLimit("aiMessages");if(!Ve.allowed){w(pe=>[...pe,{type:"user",text:he},{type:"ai",text:` You've reached your daily limit of ${Ve.limit} AI messages.

Upgrade for more:
 Essential 4.99/mo - 30 messages/day
 Premium 14.99/mo - 50 messages/day
 Ultimate 29.99/mo - UNLIMITED messages`}]),setPaywallData(or.showPaywall("aiVoiceCoach",()=>setShowStripePayment(!0)));return}}w(Ve=>[...Ve,{type:"user",text:he}]),r(!0);try{const Ve=(await jt(async()=>{const{default:J}=await Promise.resolve().then(()=>eC);return{default:J}},void 0)).default,pe=JSON.parse(localStorage.getItem("wellnessai_user")||"{}"),ee=await Ve.chat(he,{allergens:pe.profile?.allergens||[],dietaryPreferences:pe.profile?.dietaryPreferences||[],healthGoals:pe.profile?.healthGoals||[]});if(w(J=>[...J,{type:"ai",text:ee}]),!Ce){or.incrementUsage("aiMessages");const J=or.checkLimit("aiMessages")}me||await $(ee)}catch(Ve){const pe=`Error: ${Ve.message}. Check console for details.`;w(ee=>[...ee,{type:"ai",text:pe}]),await $("There was an error. Please check your internet connection and try again.")}r(!1)},q=he=>{x(!1),W(he,!1)},ge=he=>{he.preventDefault(),u.trim()&&(x(!0),W(u,!0),h(""))};return b.jsxs("div",{className:"voice-tab",children:[b.jsxs("div",{className:"voice-header",children:[b.jsx("h1",{children:"AI Voice Coach "}),b.jsx("p",{children:"Just talk to me like a friend"}),(()=>{if(localStorage.getItem("helio_dev_mode")==="true")return null;const me=window.subscriptionService?.checkLimit("aiMessages");return me&&!window.subscriptionService?.hasAccess("aiVoiceCoach")?b.jsx("div",{style:{marginTop:"10px",padding:"8px 16px",background:me.remaining<=1?"rgba(255, 68, 68, 0.2)":"rgba(139, 95, 232, 0.2)",borderRadius:"20px",fontSize:"13px",color:me.remaining<=1?"#FF4444":"#C084FC",fontWeight:"bold",border:`2px solid ${me.remaining<=1?"#FF4444":"rgba(139, 95, 232, 0.4)"}`},children:me.remaining>0?b.jsxs(b.Fragment,{children:[" ",me.remaining,"/",me.limit," messages left today"]}):b.jsx(b.Fragment,{children:" Daily limit reached - Upgrade for unlimited!"})}):null})()]}),b.jsxs("div",{className:"voice-messages",children:[p.map((he,me)=>b.jsxs("div",{className:`voice-message ${he.type}`,onClick:()=>he.type==="ai"&&$(he.text),title:he.type==="ai"?"Click to hear again":"",children:[b.jsx("span",{className:"message-icon",children:he.type==="ai"?"":""}),b.jsx("p",{children:he.text})]},me)),n&&b.jsxs("div",{className:"voice-message ai loading-message",children:[b.jsx("span",{className:"message-icon",children:""}),b.jsxs("p",{children:[b.jsxs("span",{className:"typing-indicator",children:[b.jsx("span",{}),b.jsx("span",{}),b.jsx("span",{})]}),"Thinking..."]})]})]}),b.jsx("button",{className:`voice-button ${e?"listening":""}`,onClick:e?B:A,disabled:n,children:e?b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"pulse-ring"}),b.jsx("span",{className:"voice-icon",children:""}),b.jsx("p",{children:"I'm listening..."})]}):n?b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"voice-icon",children:""}),b.jsx("p",{children:"Processing..."})]}):b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"voice-icon",children:""}),b.jsx("p",{children:"Tap to talk"})]})}),b.jsxs("form",{className:"voice-text-input",onSubmit:ge,children:[b.jsx("input",{type:"text",value:u,onChange:he=>h(he.target.value),placeholder:"Or type your message...",disabled:n||e,className:"text-input-field"}),b.jsx("button",{type:"submit",className:"text-send-btn",disabled:!u.trim()||n||e,children:"Send "})]}),b.jsxs("div",{className:"voice-suggestions",children:[b.jsx("p",{className:"suggestions-label",children:"Or try these quick questions:"}),b.jsx("button",{className:"suggestion-chip",onClick:()=>q("What should I eat for lunch?"),disabled:e||n,children:'"What should I eat for lunch?"'}),b.jsx("button",{className:"suggestion-chip",onClick:()=>q("How am I doing today?"),disabled:e||n,children:'"How am I doing today?"'}),b.jsx("button",{className:"suggestion-chip",onClick:()=>q("Show me my progress"),disabled:e||n,children:'"Show me my progress"'})]}),s&&b.jsxs("div",{className:"speaking-indicator",children:[b.jsx("span",{className:"speaker-icon",children:""}),b.jsx("p",{children:"AI is speaking..."})]})]})}function oY({onOpenFoodScanner:i,onOpenARScanner:e,onOpenBarcodeScanner:t,onOpenRepCounter:n}){return b.jsxs("div",{className:"scan-tab",children:[b.jsxs("div",{className:"scan-header",children:[b.jsx("h1",{children:"Scan Anything "}),b.jsx("p",{children:"I'll tell you everything about it"})]}),b.jsxs("div",{className:"scan-options",children:[b.jsxs("button",{className:"scan-option-card new-feature",onClick:()=>{t()},style:{border:"3px solid #11998e",transform:"scale(1.02)"},children:[b.jsx("span",{className:"scan-option-icon",children:""}),b.jsx("h3",{children:"Barcode Scanner "}),b.jsx("p",{children:"Scan product barcodes instantly"}),b.jsx("span",{className:"scan-badge",style:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",fontSize:"16px",fontWeight:"bold"},children:"NEW!"})]}),b.jsxs("button",{className:"scan-option-card",onClick:i,children:[b.jsx("span",{className:"scan-option-icon",children:""}),b.jsx("h3",{children:"Food Scanner"}),b.jsx("p",{children:"See if it's safe for you"}),b.jsx("span",{className:"scan-badge",children:"AI Powered"})]}),b.jsxs("button",{className:"scan-option-card",onClick:e,children:[b.jsx("span",{className:"scan-option-icon",children:""}),b.jsx("h3",{children:"AR Scanner"}),b.jsx("p",{children:"See calories & nutrition in real-time"}),b.jsx("span",{className:"scan-badge",children:"Augmented Reality"})]}),b.jsxs("button",{className:"scan-option-card new-feature",onClick:()=>{n()},style:{border:"3px solid #ff6b6b",transform:"scale(1.02)"},children:[b.jsx("span",{className:"scan-option-icon",children:""}),b.jsx("h3",{children:"Rep Counter "}),b.jsx("p",{children:"AI-powered workout tracking"}),b.jsx("span",{className:"scan-badge",style:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)",fontSize:"16px",fontWeight:"bold"},children:"NEW!"})]})]}),b.jsxs("div",{className:"scan-features",children:[b.jsx("h3",{children:"What I can detect:"}),b.jsxs("div",{className:"feature-list",children:[b.jsx("div",{className:"feature-item",children:" Hidden allergens"}),b.jsx("div",{className:"feature-item",children:" Calories & macros"}),b.jsx("div",{className:"feature-item",children:" Ingredient analysis"}),b.jsx("div",{className:"feature-item",children:" Healthy alternatives"}),b.jsx("div",{className:"feature-item",children:" Product barcodes (NEW!)"}),b.jsx("div",{className:"feature-item",children:" Exercise reps (NEW!)"})]})]})]})}function lY({onOpenBreathing:i,onOpenStressRelief:e,onOpenGuidedMeditation:t,onOpenGratitudeJournal:n}){return b.jsxs("div",{className:"zen-tab",children:[b.jsxs("div",{className:"zen-header",children:[b.jsx("h1",{children:"Zen Mode "}),b.jsx("p",{children:"Take a moment for yourself"})]}),b.jsxs("div",{className:"breathing-exercise",children:[b.jsx("div",{className:"breath-circle",children:b.jsx("p",{className:"breath-text",children:"Tap to start"})}),b.jsxs("button",{className:"breath-button",onClick:i,style:{position:"relative"},children:["Start Breathing Exercise",!window.subscriptionService?.hasAccess("breathing")&&b.jsx("span",{style:{position:"absolute",top:"10px",right:"10px",fontSize:"16px"},children:""})]})]}),b.jsxs("div",{className:"zen-activities",children:[b.jsx("h3",{children:"Mental Wellness Activities"}),b.jsxs("button",{className:"zen-card",onClick:t,style:{position:"relative"},children:[b.jsx("span",{className:"zen-icon",children:""}),b.jsxs("div",{children:[b.jsxs("h4",{children:["Guided Meditation ",!window.subscriptionService?.hasAccess("meditation")&&""]}),b.jsx("p",{children:"Powerful & energizing sessions"})]})]}),b.jsxs("button",{className:"zen-card",onClick:n,children:[b.jsx("span",{className:"zen-icon",children:""}),b.jsxs("div",{children:[b.jsx("h4",{children:"Gratitude Journal"}),b.jsx("p",{children:"Write what you're thankful for"})]})]}),b.jsxs("button",{className:"zen-card",onClick:e,style:{position:"relative"},children:[b.jsx("span",{className:"zen-icon",children:""}),b.jsxs("div",{children:[b.jsxs("h4",{children:["Stress Relief ",!window.subscriptionService?.hasAccess("breathing")&&""]}),b.jsx("p",{children:"Quick relaxation techniques"})]})]})]})]})}function uY({user:i,stats:e,onOpenHealthAvatar:t,onOpenARScanner:n,onOpenEmergency:r,onOpenInsurance:s,onOpenDNA:l,onOpenBattles:u,onOpenMeals:h,onEditProfile:f,onOpenFullStats:x,onOpenNotifications:p,onOpenTheme:w,onLogout:A,checkFeatureAccess:B,onExportDailyStats:$,onExportWorkoutHistory:W,onExportFoodLog:q,onExportFullReport:ge,showDevButton:he,isDevMode:me,onOpenDevUnlock:Ce,onResetStepCounter:Ve,onDisableDevMode:pe}){const ee=i?.profile?.height?i.profile.height/100:null,J=ee&&i?.profile?.weight?(i.profile.weight/(ee*ee)).toFixed(1):i?.profile?.bmi||null;return b.jsxs("div",{className:"me-tab-grid",children:[b.jsxs("div",{className:"profile-compact",children:[b.jsx("div",{className:"profile-compact-avatar",children:i?.profile?.photo?b.jsx("img",{src:i.profile.photo,alt:"Profile"}):b.jsx("span",{children:i?.profile?.avatar||""})}),b.jsxs("div",{className:"profile-compact-info",children:[b.jsx("h2",{className:"profile-compact-name",children:i?.profile?.fullName||i?.profile?.name||"Wellness Warrior"}),b.jsxs("p",{className:"profile-compact-level",children:[" Level ",e.level,"   ",e.streak," Day Streak"]}),b.jsxs("div",{className:"profile-compact-stats",children:[i?.profile?.age&&b.jsxs("span",{className:"profile-stat-mini",children:[" ",i.profile.age,"y"]}),i?.profile?.height&&b.jsxs("span",{className:"profile-stat-mini",children:[" ",i.profile.height,"cm"]}),i?.profile?.weight&&b.jsxs("span",{className:"profile-stat-mini",children:[" ",i.profile.weight,"kg"]}),J&&b.jsxs("span",{className:"profile-stat-mini",style:{color:J<18.5?"#FFA500":J<25?"#44FF44":J<30?"#FFA500":"#FF4444"},children:["BMI ",J]})]})]}),b.jsx("button",{className:"edit-profile-mini-btn",onClick:f,children:" Edit"})]}),me&&b.jsxs("div",{className:"dev-mode-card",children:[b.jsx("div",{className:"dev-mode-title",children:" DEVELOPER MODE ACTIVE"}),b.jsx("div",{className:"dev-mode-subtitle",children:"All Premium Features Unlocked "}),b.jsx("button",{onClick:Ve,className:"dev-mode-btn reset",children:" Reset Step Counter"}),b.jsx("button",{onClick:pe,className:"dev-mode-btn disable",children:" Disable Developer Mode"})]}),b.jsxs("div",{className:"me-icon-grid",children:[b.jsxs("button",{className:"me-icon-btn",onClick:t,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Health Avatar"})]}),b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:n,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"AR Scanner"}),b.jsx("span",{className:"premium-tag",children:""})]}),b.jsxs("button",{className:"me-icon-btn",onClick:r,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Emergency"})]}),b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:()=>B("dnaAnalysis",l),children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"DNA Analysis"}),!or.hasAccess("dnaAnalysis")&&b.jsx("span",{className:"premium-tag",children:""})]}),b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:()=>B("socialBattles",u),children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Battles"}),!or.hasAccess("socialBattles")&&b.jsx("span",{className:"premium-tag",children:""})]}),b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:()=>B("mealAutomation",h),children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Meal Auto"}),!or.hasAccess("mealAutomation")&&b.jsx("span",{className:"premium-tag",children:""})]}),b.jsxs("button",{className:"me-icon-btn",onClick:f,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Profile"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:x,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Full Stats"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:p,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Notifications"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:w,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Theme"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:$,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Daily PDF"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:W,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Workouts PDF"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:q,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Food PDF"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:ge,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Full Report"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:()=>i.onOpenDataRecovery(),children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Backup/Restore"})]}),b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:()=>B("appleHealthSync",i.onOpenAppleHealth),children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Apple Health"}),!or.hasAccess("appleHealthSync")&&b.jsx("span",{className:"premium-tag",children:""})]}),b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:()=>B("wearableSync",i.onOpenWearables),children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Wearables"}),!or.hasAccess("wearableSync")&&b.jsx("span",{className:"premium-tag",children:""})]}),he&&!me&&b.jsxs("button",{className:"me-icon-btn premium-feature",onClick:Ce,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Dev Mode"})]}),b.jsxs("button",{className:"me-icon-btn",onClick:A,children:[b.jsx("div",{className:"icon-circle",children:b.jsx("span",{children:""})}),b.jsx("span",{className:"icon-label",children:"Sign Out"})]})]}),b.jsxs("div",{className:"upgrade-cta-card",onClick:()=>i.onOpenStripePayment(),children:[b.jsx("div",{className:"upgrade-cta-icon",children:""}),b.jsxs("h3",{className:"upgrade-cta-title",children:["Upgrade to ",or.getPlanBadge()===" FREE"?"Premium":"VIP"]}),b.jsx("p",{className:"upgrade-cta-text",children:"Join 50,000+ users unlocking DNA, Battles & AI!"}),b.jsx("button",{className:"upgrade-cta-btn",children:"See Plans "})]}),b.jsx("div",{style:{height:"120px",flexShrink:0}})]})}function cY({user:i,stats:e,onClose:t}){const[n,r]=we.useState([]),[s,l]=we.useState(!1);we.useEffect(()=>{(async()=>{try{console.log(" [FullStatsModal] Loading data from localStorage...");const Ve=JSON.parse(localStorage.getItem("foodLog")||"[]");console.log(" [FullStatsModal] localStorage foodLog:",Ve.length,"meals"),r(Ve)}catch{}l(!0)})()},[]);let u=[],h=[],f=[];console.log(" [FullStatsModal] Loading data sources..."),console.log(" [FullStatsModal] Live stats from parent:",{todaySteps:e?.todaySteps,waterCups:e?.waterCups,mealsLogged:e?.mealsLogged,streak:e?.streak,wellnessScore:e?.wellnessScore});try{const Ce=localStorage.getItem("stepHistory");u=JSON.parse(Ce||"[]"),console.log(" [FullStatsModal] stepHistory length:",u.length),console.log(" [FullStatsModal] Last 3 entries:",u.slice(-3))}catch{}try{const Ce=localStorage.getItem("workoutHistory");console.log(" [FullStatsModal] Raw workoutHistory:",Ce),h=JSON.parse(Ce||"[]"),console.log(" [FullStatsModal] Parsed workoutHistory length:",h.length),console.log(" [FullStatsModal] Workout entries:",h)}catch{}try{f=JSON.parse(localStorage.getItem("sleepLog")||"[]")}catch{}console.log(" [FullStatsModal] Calculating stats...");const x=Array.isArray(u)?u.reduce((Ce,Ve)=>Ce+(Number(Ve?.steps)||0),0):0,p=x+(e?.todaySteps||0);console.log(" [FullStatsModal] Historical:",x,"Today:",e?.todaySteps,"Total:",p);const w=u.length+1,A=w>0?Math.round(p/w):0,B=Array.isArray(n)?n.length:0,$=Array.isArray(h)?h.length:0,W=Array.isArray(f)?f.reduce((Ce,Ve)=>Ce+(Number(Ve?.hours)||0),0):0,q=f.length>0?(W/f.length).toFixed(1):0,ge=e?.streak||0,he=u.filter(Ce=>Ce?.date).length+1;console.log(" [FullStatsModal] FINAL STATS:",{totalSteps:p,avgSteps:A,totalFoodScans:B,totalWorkouts:$,totalSleepHours:W,avgSleepHours:q,activeDays:he,currentStreak:ge});const me={background:"linear-gradient(135deg, rgba(139, 95, 232, 0.2), rgba(139, 95, 232, 0.05))",border:"1px solid rgba(139, 95, 232, 0.3)",borderRadius:"15px",padding:"20px",textAlign:"center"};return b.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:999999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:b.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:"20px",padding:"30px",maxWidth:"600px",width:"100%",maxHeight:"90vh",overflowY:"auto",position:"relative",color:"white"},children:[b.jsx("button",{onClick:t,style:{position:"absolute",top:"15px",right:"15px",background:"#8B5FE8",border:"none",color:"white",fontSize:"28px",width:"40px",height:"40px",borderRadius:"50%",cursor:"pointer",zIndex:1},children:""}),b.jsx("h2",{style:{fontSize:"28px",marginBottom:"5px",color:"white"},children:" Your Full Stats"}),b.jsx("p",{style:{fontSize:"14px",color:"#888",marginBottom:"25px"},children:"Complete health overview"}),b.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(139, 95, 232, 0.3), rgba(139, 95, 232, 0.1))",border:"2px solid rgba(139, 95, 232, 0.5)",borderRadius:"15px",padding:"20px",marginBottom:"20px"},children:[b.jsx("h3",{style:{fontSize:"18px",marginBottom:"15px",color:"white"},children:" Today's Progress"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"15px"},children:[b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"24px"},children:""}),b.jsx("p",{style:{color:"white",fontSize:"20px",margin:"5px 0"},children:(e?.todaySteps||0).toLocaleString()}),b.jsx("small",{style:{color:"#aaa",fontSize:"12px"},children:"Steps"})]}),b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"24px"},children:""}),b.jsxs("p",{style:{color:"white",fontSize:"20px",margin:"5px 0"},children:[e?.waterCups||0,"/8"]}),b.jsx("small",{style:{color:"#aaa",fontSize:"12px"},children:"Water"})]}),b.jsxs("div",{style:{textAlign:"center"},children:[b.jsx("div",{style:{fontSize:"24px"},children:""}),b.jsx("p",{style:{color:"white",fontSize:"20px",margin:"5px 0"},children:e?.mealsLogged||0}),b.jsx("small",{style:{color:"#aaa",fontSize:"12px"},children:"Meals"})]})]})]}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px",marginBottom:"30px"},children:[b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:p.toLocaleString()}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Total Steps"}),b.jsxs("small",{style:{color:"#888",fontSize:"12px"},children:["Avg: ",A.toLocaleString(),"/day"]})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:e?.wellnessScore||0}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Wellness Score"}),b.jsx("small",{style:{color:"#888",fontSize:"12px"},children:"Out of 100"})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:B}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Food Scans"}),b.jsx("small",{style:{color:"#888",fontSize:"12px"},children:"Meals logged"})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:$}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Workouts"}),b.jsx("small",{style:{color:"#888",fontSize:"12px"},children:"Total sessions"})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:e?.waterCups||0}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Water Today"}),b.jsx("small",{style:{color:"#888",fontSize:"12px"},children:"Goal: 8 cups"})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsxs("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:[q,"h"]}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Avg Sleep"}),b.jsxs("small",{style:{color:"#888",fontSize:"12px"},children:[f.length," nights"]})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsxs("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:["Level ",e?.level||1]}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Progress"}),b.jsxs("small",{style:{color:"#888",fontSize:"12px"},children:[e?.xp||0," XP"]})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:ge}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Day Streak"}),b.jsxs("small",{style:{color:"#888",fontSize:"12px"},children:[he," active days"]})]}),b.jsxs("div",{style:me,children:[b.jsx("div",{style:{fontSize:"32px",marginBottom:"10px"},children:""}),b.jsx("h3",{style:{color:"white",fontSize:"24px",margin:"5px 0"},children:he}),b.jsx("p",{style:{color:"#8B5FE8",margin:"5px 0",fontSize:"14px"},children:"Active Days"}),b.jsx("small",{style:{color:"#888",fontSize:"12px"},children:"Total logins"})]})]}),b.jsxs("div",{style:{background:"rgba(139, 95, 232, 0.1)",border:"1px solid rgba(139, 95, 232, 0.3)",borderRadius:"15px",padding:"20px",marginBottom:"20px"},children:[b.jsx("h3",{style:{fontSize:"18px",marginBottom:"15px",color:"white"},children:" 7-Day Step Activity"}),b.jsx("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",height:"120px",gap:"8px"},children:[0,1,2,3,4,5,6].map(Ce=>{const pe=(e?.weeklySteps?.[Ce]||{steps:0}).steps||0,ee=Math.max(pe/1e4*100,5);return b.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[b.jsx("small",{style:{color:"#8B5FE8",fontSize:"10px",marginBottom:"3px"},children:pe>0?(pe/1e3).toFixed(1)+"k":"0"}),b.jsx("div",{style:{width:"100%",height:`${ee}%`,background:pe>0?"linear-gradient(to top, #8B5FE8, #B794F6)":"rgba(139, 95, 232, 0.2)",borderRadius:"6px 6px 0 0",minHeight:"5px"}}),b.jsx("small",{style:{color:"#666",fontSize:"11px",marginTop:"5px"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][Ce]})]},Ce)})})]}),b.jsxs("div",{style:{background:"rgba(139, 95, 232, 0.1)",border:"1px solid rgba(139, 95, 232, 0.3)",borderRadius:"15px",padding:"20px"},children:[b.jsx("h3",{style:{fontSize:"18px",marginBottom:"10px",color:"white"},children:" Health Summary"}),b.jsxs("p",{style:{color:"#aaa",fontSize:"14px",marginBottom:"5px"},children:[" ",i?.name||i?.profile?.fullName||"Champion"]}),b.jsxs("p",{style:{color:"#aaa",fontSize:"14px",marginBottom:"5px"},children:[" Level ",e?.level||1," | ",e?.xp||0," XP"]}),b.jsxs("p",{style:{color:"#aaa",fontSize:"14px",marginBottom:"5px"},children:[" ",ge," day streak | ",he," active days"]}),b.jsxs("p",{style:{color:"#aaa",fontSize:"14px",marginBottom:"10px"},children:[" Wellness Score: ",e?.wellnessScore||0,"/100"]}),b.jsx("p",{style:{color:"#8B5FE8",fontSize:"14px",fontWeight:"bold"},children:"Keep crushing your goals! "})]})]})})}function hY({user:i,onClose:e}){const[t,n]=we.useState(!0),[r,s]=we.useState(!0),[l,u]=we.useState(!0),[h,f]=we.useState(!0),[x,p]=we.useState(!0),[w,A]=we.useState(!0),[B,$]=we.useState(!1),[W,q]=we.useState(!1);we.useEffect(()=>{ge()},[]);const ge=async()=>{try{const{LocalNotifications:Ve}=await jt(async()=>{const{LocalNotifications:ee}=await Promise.resolve().then(()=>O1);return{LocalNotifications:ee}},void 0),pe=await Ve.checkPermissions();$(pe.display==="granted")}catch(Ve){console.warn("Failed to check notification permission:",Ve)}},he=async()=>{try{const{LocalNotifications:Ve}=await jt(async()=>{const{LocalNotifications:ee}=await Promise.resolve().then(()=>O1);return{LocalNotifications:ee}},void 0);(await Ve.requestPermissions()).display==="granted"?($(!0),alert(" Notification permission granted!")):alert(" Please enable notifications in your device settings.")}catch(Ve){console.error("Failed to request permission:",Ve),alert(" Failed to request notification permission")}},me=async()=>{if(!B){alert(" Please grant notification permission first");return}try{await r2.testNotification("dailyReminders"),q(!0),setTimeout(()=>q(!1),3e3),alert(" Test notification sent! Check your notification bar in 2 seconds.")}catch(Ve){console.error("Failed to send test notification:",Ve),alert(" Failed to send test notification")}},Ce=async()=>{if(!B){alert(" Please grant notification permission first to enable notifications.");return}const Ve={notificationsEnabled:t,dailyReminders:r,goalAlerts:l,streakReminders:h,healthTips:x,emergencyAlerts:w};localStorage.setItem("notificationSettings",JSON.stringify(Ve)),await r2.updateSettings(Ve);const pe=[];r&&pe.push("Daily Reminders (9 AM, 12 PM, 6 PM)"),l&&pe.push("Goal Alerts (Real-time)"),h&&pe.push("Streak Reminders (8 PM)"),x&&pe.push("Health Tips (10 AM, 3 PM, 7 PM)");const ee=pe.length>0?` Scheduled:

${pe.join(`
`)}`:" All notifications disabled";alert(ee),e()};return we.useEffect(()=>{const Ve=localStorage.getItem("notificationSettings");if(Ve){const pe=JSON.parse(Ve);n(pe.notificationsEnabled??!0),s(pe.dailyReminders??!0),u(pe.goalAlerts??!0),f(pe.streakReminders??!0),p(pe.healthTips??!0),A(pe.emergencyAlerts??!0)}},[]),b.jsx("div",{className:"modal-overlay",onClick:e,children:b.jsxs("div",{className:"modal-content notifications-modal",onClick:Ve=>Ve.stopPropagation(),children:[b.jsx("button",{className:"modal-close",onClick:e,children:""}),b.jsxs("div",{className:"modal-header",children:[b.jsx("h2",{children:" Notification Settings"}),b.jsx("p",{children:"Manage how we keep you informed"}),!B&&b.jsxs("div",{style:{background:"rgba(255, 165, 0, 0.1)",border:"1px solid rgba(255, 165, 0, 0.3)",borderRadius:"8px",padding:"12px",marginTop:"10px",textAlign:"center"},children:[b.jsx("p",{style:{color:"#FFB84D",margin:"0 0 8px 0",fontSize:"14px"},children:" Notification permission required"}),b.jsx("button",{onClick:he,style:{background:"#FFB84D",color:"black",border:"none",borderRadius:"8px",padding:"8px 16px",fontWeight:"bold",cursor:"pointer"},children:"Enable Notifications"})]}),B&&b.jsxs("div",{style:{background:"rgba(68, 255, 68, 0.1)",border:"1px solid rgba(68, 255, 68, 0.3)",borderRadius:"8px",padding:"12px",marginTop:"10px",textAlign:"center"},children:[b.jsx("p",{style:{color:"#44FF44",margin:"0 0 8px 0",fontSize:"14px"},children:" Notifications enabled"}),b.jsx("button",{onClick:me,disabled:W,style:{background:W?"#666":"#44FF44",color:"black",border:"none",borderRadius:"8px",padding:"8px 16px",fontWeight:"bold",cursor:W?"not-allowed":"pointer",opacity:W?.6:1},children:W?" Sent!":" Send Test Notification"})]})]}),b.jsxs("div",{className:"notification-settings",children:[b.jsxs("div",{className:"setting-item",children:[b.jsxs("div",{className:"setting-info",children:[b.jsx("h3",{children:" Enable Notifications"}),b.jsx("p",{children:"Master switch for all notifications"})]}),b.jsxs("label",{className:"toggle",children:[b.jsx("input",{type:"checkbox",checked:t,onChange:Ve=>n(Ve.target.checked)}),b.jsx("span",{className:"toggle-slider"})]})]}),b.jsxs("div",{className:"setting-item",children:[b.jsxs("div",{className:"setting-info",children:[b.jsx("h3",{children:" Daily Reminders"}),b.jsx("p",{children:"Log your meals, steps, and water"})]}),b.jsxs("label",{className:"toggle",children:[b.jsx("input",{type:"checkbox",checked:r,onChange:Ve=>s(Ve.target.checked),disabled:!t}),b.jsx("span",{className:"toggle-slider"})]})]}),b.jsxs("div",{className:"setting-item",children:[b.jsxs("div",{className:"setting-info",children:[b.jsx("h3",{children:" Goal Alerts"}),b.jsx("p",{children:"Get notified when you hit your goals"})]}),b.jsxs("label",{className:"toggle",children:[b.jsx("input",{type:"checkbox",checked:l,onChange:Ve=>u(Ve.target.checked),disabled:!t}),b.jsx("span",{className:"toggle-slider"})]})]}),b.jsxs("div",{className:"setting-item",children:[b.jsxs("div",{className:"setting-info",children:[b.jsx("h3",{children:" Streak Reminders"}),b.jsx("p",{children:"Don't break your streak!"})]}),b.jsxs("label",{className:"toggle",children:[b.jsx("input",{type:"checkbox",checked:h,onChange:Ve=>f(Ve.target.checked),disabled:!t}),b.jsx("span",{className:"toggle-slider"})]})]}),b.jsxs("div",{className:"setting-item",children:[b.jsxs("div",{className:"setting-info",children:[b.jsx("h3",{children:" Health Tips"}),b.jsx("p",{children:"Personalized wellness advice"})]}),b.jsxs("label",{className:"toggle",children:[b.jsx("input",{type:"checkbox",checked:x,onChange:Ve=>p(Ve.target.checked),disabled:!t}),b.jsx("span",{className:"toggle-slider"})]})]}),b.jsxs("div",{className:"setting-item",children:[b.jsxs("div",{className:"setting-info",children:[b.jsx("h3",{children:" Emergency Alerts"}),b.jsx("p",{children:"Critical health notifications (Always On)"})]}),b.jsxs("label",{className:"toggle",children:[b.jsx("input",{type:"checkbox",checked:w,disabled:!0}),b.jsx("span",{className:"toggle-slider"})]})]})]}),b.jsxs("div",{className:"modal-actions",children:[b.jsx("button",{className:"secondary-button",onClick:e,children:"Cancel"}),b.jsx("button",{className:"primary-button",onClick:Ce,children:"Save Settings"})]})]})})}function dY({onClose:i}){const[e,t]=we.useState("dark"),[n,r]=we.useState("#8B5FE8"),s=[{id:"dark",name:"Dark Mode",icon:"",colors:{bg:"#0F0F23",card:"#1A1A2E"}},{id:"light",name:"Light Mode",icon:"",colors:{bg:"#FFFFFF",card:"#F5F5F5"}},{id:"midnight",name:"Midnight",icon:"",colors:{bg:"#000000",card:"#1A1A1A"}},{id:"ocean",name:"Ocean",icon:"",colors:{bg:"#001F3F",card:"#003D5C"}}],l=[{name:"Purple",color:"#8B5FE8"},{name:"Blue",color:"#00C8FF"},{name:"Green",color:"#44FF44"},{name:"Pink",color:"#FF00FF"},{name:"Orange",color:"#FFB84D"},{name:"Red",color:"#FF6B35"}],u=()=>{const h={theme:e,accentColor:n};localStorage.setItem("themeSettings",JSON.stringify(h)),document.documentElement.setAttribute("data-theme",e),document.documentElement.style.setProperty("--theme-accent-color",n),document.body.setAttribute("data-theme",e);const f=document.styleSheets;for(let x=0;x<f.length;x++)try{f[x].disabled=!0,f[x].disabled=!1}catch{}console.log(" Theme applied:",e,n),console.log(" HTML data-theme:",document.documentElement.getAttribute("data-theme")),console.log(" Body data-theme:",document.body.getAttribute("data-theme")),i(),setTimeout(()=>{window.dispatchEvent(new Event("resize")),document.body.style.display="none",document.body.offsetHeight,document.body.style.display=""},100)};return we.useEffect(()=>{const h=localStorage.getItem("themeSettings");if(h){const f=JSON.parse(h);t(f.theme||"dark"),r(f.accentColor||"#8B5FE8")}},[]),b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content theme-modal",onClick:h=>h.stopPropagation(),children:[b.jsx("button",{className:"modal-close",onClick:i,children:""}),b.jsxs("div",{className:"modal-header",children:[b.jsx("h2",{children:" Customize Theme"}),b.jsx("p",{children:"Make the app your own"})]}),b.jsxs("div",{className:"theme-section",children:[b.jsx("h3",{children:"Theme Style"}),b.jsx("div",{className:"theme-grid",children:s.map(h=>b.jsxs("button",{className:`theme-card ${e===h.id?"selected":""}`,onClick:()=>t(h.id),style:{background:h.colors.bg,border:e===h.id?`2px solid ${n}`:"2px solid #333"},children:[b.jsx("span",{className:"theme-icon",style:{fontSize:"40px"},children:h.icon}),b.jsx("h4",{style:{color:h.id==="light"?"#000":"#fff"},children:h.name}),e===h.id&&b.jsx("span",{className:"selected-check",children:""})]},h.id))})]}),b.jsxs("div",{className:"theme-section",children:[b.jsx("h3",{children:"Accent Color"}),b.jsx("div",{className:"color-grid",children:l.map(h=>b.jsx("button",{className:`color-option ${n===h.color?"selected":""}`,onClick:()=>r(h.color),style:{background:h.color,border:n===h.color?"3px solid #fff":"3px solid transparent"},children:n===h.color&&b.jsx("span",{className:"color-check",children:""})},h.color))})]}),b.jsxs("div",{className:"theme-preview",children:[b.jsx("h3",{children:"Preview"}),b.jsxs("div",{className:"preview-card",style:{background:s.find(h=>h.id===e)?.colors.card},children:[b.jsx("div",{className:"preview-button",style:{background:n},children:"Button"}),b.jsx("div",{className:"preview-text",children:"Sample Text"}),b.jsx("div",{className:"preview-icon",style:{color:n},children:""})]})]}),b.jsxs("div",{className:"modal-actions",children:[b.jsx("button",{className:"secondary-button",onClick:i,children:"Cancel"}),b.jsx("button",{className:"primary-button",style:{background:n},onClick:u,children:"Apply Theme"})]})]})})}function fY({activitiesPromise:i,onClose:e}){const[t,n]=we.useState([]),[r,s]=we.useState(!0),[l,u]=we.useState("all");we.useEffect(()=>{i.then(p=>{n(p),s(!1)})},[i]);const h=()=>l==="all"?t:t.filter(p=>p.type===l),f=()=>t.reduce((p,w)=>p+(w.calories||0),0),x=p=>t.filter(w=>w.type===p).length;return b.jsx("div",{className:"modal-overlay",onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,padding:"20px"},children:b.jsxs("div",{className:"activity-pulse-modal",onClick:p=>p.stopPropagation(),style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:"25px",padding:"30px",maxWidth:"500px",width:"100%",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"2px solid rgba(139, 95, 232, 0.3)"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px"},children:[b.jsxs("div",{children:[b.jsx("h2",{style:{color:"white",fontSize:"28px",margin:"0 0 5px 0"},children:" Activity Pulse"}),b.jsxs("p",{style:{color:"#888",fontSize:"14px",margin:0},children:[t.length," activities  ",f()," calories"]})]}),b.jsx("button",{onClick:e,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"28px",width:"40px",height:"40px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),b.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"20px",flexWrap:"wrap"},children:[{id:"all",label:"All",icon:""},{id:"steps",label:"Steps",icon:""},{id:"workout",label:"Workouts",icon:""},{id:"meal",label:"Meals",icon:""},{id:"water",label:"Water",icon:""},{id:"meditation",label:"Zen",icon:""},{id:"sleep",label:"Sleep",icon:""}].map(p=>b.jsxs("button",{onClick:()=>u(p.id),style:{background:l===p.id?"rgba(139, 95, 232, 0.3)":"rgba(255, 255, 255, 0.05)",border:l===p.id?"2px solid #8B5FE8":"2px solid transparent",borderRadius:"20px",padding:"8px 16px",color:"white",fontSize:"13px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[b.jsx("span",{children:p.icon}),b.jsx("span",{children:p.label}),b.jsx("span",{style:{background:"rgba(255, 255, 255, 0.15)",borderRadius:"10px",padding:"2px 8px",fontSize:"11px",fontWeight:"bold"},children:p.id==="all"?t.length:x(p.id)})]},p.id))}),b.jsx("div",{className:"activity-timeline",style:{display:"flex",flexDirection:"column",gap:"12px"},children:h().length===0?b.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"10px"},children:""}),b.jsxs("p",{children:["No ",l!=="all"?l:""," activities yet today"]}),b.jsx("p",{style:{fontSize:"14px"},children:"Start moving to see your pulse!"})]}):h().map((p,w)=>b.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"2px solid rgba(255, 255, 255, 0.1)",borderRadius:"15px",padding:"15px",display:"flex",alignItems:"center",gap:"15px",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:A=>A.currentTarget.style.background="rgba(139, 95, 232, 0.15)",onMouseLeave:A=>A.currentTarget.style.background="rgba(255, 255, 255, 0.05)",children:[b.jsx("div",{style:{background:p.type==="steps"?"rgba(0, 200, 255, 0.2)":p.type==="workout"?"rgba(255, 68, 68, 0.2)":p.type==="meal"?"rgba(68, 255, 68, 0.2)":p.type==="water"?"rgba(0, 150, 255, 0.2)":p.type==="meditation"?"rgba(160, 82, 255, 0.2)":p.type==="sleep"?"rgba(255, 184, 77, 0.2)":"rgba(255, 255, 255, 0.1)",width:"50px",height:"50px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",flexShrink:0},children:p.icon}),b.jsxs("div",{style:{flex:1},children:[b.jsx("div",{style:{color:"white",fontSize:"16px",fontWeight:"bold",marginBottom:"4px"},children:p.text}),b.jsxs("div",{style:{color:"#888",fontSize:"13px"},children:[p.time,p.calories>0&&b.jsxs("span",{style:{marginLeft:"10px",color:"#FFB84D"},children:[" ",p.calories," cal"]})]})]}),b.jsx("div",{style:{background:p.type==="steps"?"linear-gradient(135deg, #00C8FF, #0088FF)":p.type==="workout"?"linear-gradient(135deg, #FF4444, #FF6B6B)":p.type==="meal"?"linear-gradient(135deg, #44FF44, #00FF88)":p.type==="water"?"linear-gradient(135deg, #0096FF, #00C8FF)":p.type==="meditation"?"linear-gradient(135deg, #A052FF, #C084FC)":p.type==="sleep"?"linear-gradient(135deg, #FFB84D, #FFA500)":"linear-gradient(135deg, #8B5FE8, #B794F6)",color:"white",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"bold",textTransform:"capitalize"},children:p.type})]},w))}),(()=>{const p=lf.getLevelInfo(),w=lf.data.achievements.length,A=p.level+1,B=p.progress,$=t.reduce((W,q)=>{let ge=0;return q.type==="steps"&&(ge=10),q.type==="workout"&&(ge=15),q.type==="meal"&&(ge=15),q.type==="water"&&(ge=5),q.type==="meditation"&&(ge=10),q.type==="sleep"&&(ge=10),W+ge},0);return b.jsxs("div",{style:{marginTop:"25px",padding:"25px",background:"linear-gradient(135deg, rgba(139, 95, 232, 0.2), rgba(160, 82, 255, 0.15))",borderRadius:"20px",border:"2px solid rgba(139, 95, 232, 0.4)",boxShadow:"0 10px 30px rgba(139, 95, 232, 0.2)"},children:[b.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[b.jsx("div",{style:{color:"#8B5FE8",fontSize:"14px",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"10px"},children:" Today's XP Progress"}),b.jsxs("div",{style:{color:"white",fontSize:"48px",fontWeight:"bold",textShadow:"0 0 20px rgba(139, 95, 232, 0.5)"},children:["+",$," XP"]}),b.jsxs("div",{style:{color:"#888",fontSize:"13px",marginTop:"5px"},children:["Earned from ",t.length," ",t.length===1?"activity":"activities"]})]}),b.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"15px",padding:"20px",marginBottom:"15px"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[b.jsxs("div",{style:{color:"white",fontSize:"16px",fontWeight:"bold"},children:["Level ",p.level]}),b.jsxs("div",{style:{color:"#8B5FE8",fontSize:"16px",fontWeight:"bold"},children:["Level ",A]})]}),b.jsx("div",{style:{width:"100%",height:"12px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"10px",overflow:"hidden",position:"relative",marginBottom:"8px"},children:b.jsx("div",{style:{width:`${Math.min(B,100)}%`,height:"100%",background:"linear-gradient(90deg, #8B5FE8, #C084FC, #8B5FE8)",backgroundSize:"200% 100%",animation:"shimmer 2s infinite",borderRadius:"10px",transition:"width 0.5s ease"}})}),b.jsxs("div",{style:{color:"#888",fontSize:"13px",textAlign:"center"},children:[p.totalXP.toLocaleString()," / ",(p.totalXP+p.xpToNext).toLocaleString()," XP",b.jsxs("span",{style:{color:"#8B5FE8",marginLeft:"8px"},children:["(",p.xpToNext," XP to next level)"]})]})]}),b.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",padding:"15px",background:"rgba(255, 184, 77, 0.1)",borderRadius:"12px",border:"1px solid rgba(255, 184, 77, 0.3)"},children:[b.jsx("span",{style:{fontSize:"24px"},children:""}),b.jsxs("div",{children:[b.jsxs("div",{style:{color:"white",fontSize:"18px",fontWeight:"bold"},children:[w," Achievement",w!==1?"s":""]}),b.jsx("div",{style:{color:"#888",fontSize:"12px"},children:"Unlocked"})]})]})]})})(),t.length>0&&b.jsxs("div",{style:{marginTop:"25px",padding:"20px",background:"rgba(139, 95, 232, 0.1)",borderRadius:"15px",border:"2px solid rgba(139, 95, 232, 0.3)"},children:[b.jsx("div",{style:{color:"white",fontSize:"16px",fontWeight:"bold",marginBottom:"10px"},children:" Today's Impact"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px"},children:[b.jsxs("div",{children:[b.jsx("div",{style:{color:"#888",fontSize:"12px"},children:"Total Activities"}),b.jsx("div",{style:{color:"white",fontSize:"24px",fontWeight:"bold"},children:t.length})]}),b.jsxs("div",{children:[b.jsx("div",{style:{color:"#888",fontSize:"12px"},children:"Calories Burned"}),b.jsx("div",{style:{color:"#FFB84D",fontSize:"24px",fontWeight:"bold"},children:f()})]})]})]})]})})}function pY({onClose:i}){const[e,t]=we.useState(null),[n,r]=we.useState(!1),[s,l]=we.useState(!1);we.useEffect(()=>{if(Fd.isConnected())return r(!0),t(Fd.getCurrentHeartRate()),Fd.subscribe(x=>{t(x.bpm)})},[]);const u=async()=>{l(!0);try{const f=await Fd.connectDevice();r(!0),alert(` Connected to ${f.deviceName}!`)}catch(f){alert(` Connection failed: ${f.message}`)}finally{l(!1)}},h=async()=>{await Fd.disconnect(),r(!1),t(null)};return b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{maxWidth:"400px"},children:[b.jsx("h2",{children:" Heart Rate Monitor"}),n?b.jsxs("div",{style:{textAlign:"center",padding:"30px"},children:[b.jsx("div",{style:{fontSize:"72px",fontWeight:"bold",color:"#FF4D6A",marginBottom:"10px"},children:e||"--"}),b.jsx("div",{style:{fontSize:"18px",color:"#888",marginBottom:"20px"},children:"BPM"}),b.jsx("div",{style:{fontSize:"24px",marginBottom:"30px"},children:""}),b.jsx("button",{onClick:h,style:{padding:"10px 25px",background:"#333",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Disconnect"})]}):b.jsxs("div",{style:{textAlign:"center",padding:"30px"},children:[b.jsx("div",{style:{fontSize:"64px",marginBottom:"20px"},children:""}),b.jsx("p",{children:"Connect a Bluetooth heart rate monitor to track your heart rate in real-time."}),b.jsx("button",{onClick:u,disabled:s,style:{marginTop:"20px",padding:"12px 30px",background:"linear-gradient(135deg, #FF4D6A, #FF758C)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:s?"Connecting...":"Connect Device"})]}),b.jsx("button",{onClick:i,className:"close-button",children:""})]})})}function gY({onClose:i}){const[e,t]=we.useState(ep.isTracking),[n,r]=we.useState(null);we.useEffect(()=>{if(e){const u=setInterval(()=>{r(ep.getSleepStats())},5e3);return()=>clearInterval(u)}},[e]);const s=async()=>{await ep.startTracking(),t(!0),alert(" Sleep tracking started! Leave your phone on the nightstand.")},l=async()=>{const u=await ep.stopTracking();t(!1),u&&alert(` Slept for ${u.duration} hours! Quality: ${u.quality}/100`)};return b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content",onClick:u=>u.stopPropagation(),style:{maxWidth:"400px"},children:[b.jsx("h2",{children:" Sleep Tracking"}),e?b.jsxs("div",{style:{padding:"20px"},children:[b.jsxs("div",{style:{textAlign:"center",marginBottom:"30px"},children:[b.jsx("div",{style:{fontSize:"48px",marginBottom:"10px"},children:""}),b.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[n?.duration||"0.0","h"]}),b.jsx("div",{style:{color:"#888"},children:"Sleep Duration"})]}),n&&b.jsxs("div",{style:{marginBottom:"20px"},children:[b.jsxs("div",{style:{marginBottom:"15px"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[b.jsx("span",{children:"Deep Sleep"}),b.jsxs("span",{children:[n.phases.deep,"%"]})]}),b.jsx("div",{style:{background:"#333",height:"8px",borderRadius:"4px",overflow:"hidden"},children:b.jsx("div",{style:{background:"#A052FF",width:`${n.phases.deep}%`,height:"100%"}})})]}),b.jsxs("div",{style:{marginBottom:"15px"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[b.jsx("span",{children:"REM Sleep"}),b.jsxs("span",{children:[n.phases.rem,"%"]})]}),b.jsx("div",{style:{background:"#333",height:"8px",borderRadius:"4px",overflow:"hidden"},children:b.jsx("div",{style:{background:"#FF758C",width:`${n.phases.rem}%`,height:"100%"}})})]}),b.jsxs("div",{style:{marginBottom:"15px"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[b.jsx("span",{children:"Light Sleep"}),b.jsxs("span",{children:[n.phases.light,"%"]})]}),b.jsx("div",{style:{background:"#333",height:"8px",borderRadius:"4px",overflow:"hidden"},children:b.jsx("div",{style:{background:"#00C8FF",width:`${n.phases.light}%`,height:"100%"}})})]})]}),b.jsx("button",{onClick:l,style:{width:"100%",padding:"12px",background:"#FF4D6A",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:"Stop & Save"})]}):b.jsxs("div",{style:{textAlign:"center",padding:"30px"},children:[b.jsx("div",{style:{fontSize:"64px",marginBottom:"20px"},children:""}),b.jsx("p",{children:"Track your sleep quality using your phone's motion sensors."}),b.jsx("button",{onClick:s,style:{marginTop:"20px",padding:"12px 30px",background:"linear-gradient(135deg, #A052FF, #C084FC)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:"Start Tracking"})]}),b.jsx("button",{onClick:i,className:"close-button",children:""})]})})}function mY({onClose:i}){const[e,t]=we.useState(R1.getTodayProgress()),n=r=>{const s=R1.addIntake(r);t(s),s.goalReached&&alert(" Daily water goal reached!")};return b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),style:{maxWidth:"400px"},children:[b.jsx("h2",{children:" Water Intake"}),b.jsxs("div",{style:{textAlign:"center",padding:"30px 20px"},children:[b.jsxs("div",{style:{fontSize:"48px",fontWeight:"bold",marginBottom:"10px"},children:[e.intake,"ml"]}),b.jsxs("div",{style:{color:"#888",marginBottom:"20px"},children:["of ",e.goal,"ml (",e.percentage,"%)"]}),b.jsx("div",{style:{background:"#333",height:"20px",borderRadius:"10px",overflow:"hidden",marginBottom:"30px"},children:b.jsx("div",{style:{background:"linear-gradient(90deg, #0096FF, #00C8FF)",width:`${Math.min(e.percentage,100)}%`,height:"100%",transition:"width 0.3s ease"}})}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px"},children:[b.jsxs("button",{onClick:()=>n(250),style:{padding:"20px",background:"linear-gradient(135deg, #0096FF, #00C8FF)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:[" Glass",b.jsx("br",{}),"(250ml)"]}),b.jsxs("button",{onClick:()=>n(500),style:{padding:"20px",background:"linear-gradient(135deg, #00C8FF, #00E5FF)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:[" Bottle",b.jsx("br",{}),"(500ml)"]}),b.jsxs("button",{onClick:()=>n(1e3),style:{padding:"20px",background:"linear-gradient(135deg, #00E5FF, #00FFD1)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:[" Large",b.jsx("br",{}),"(1000ml)"]}),b.jsxs("button",{onClick:()=>n(200),style:{padding:"20px",background:"linear-gradient(135deg, #0096FF, #00A8FF)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:[" Cup",b.jsx("br",{}),"(200ml)"]})]})]}),b.jsx("button",{onClick:i,className:"close-button",children:""})]})})}function yY({onClose:i}){const[e,t]=we.useState("select"),[n,r]=we.useState(null),[s]=we.useState("female"),[l,u]=we.useState(5),[h,f]=we.useState(null),[x,p]=we.useState(!1),w=Rg.getPatterns(),A=()=>{t("active"),p(!0),Rg.setVoice(s),Rg.startExercise(n,l,$=>{f($)},($,W)=>{},$=>{p(!1),t("complete")})},B=()=>{Rg.stopExercise(),p(!1),t("select"),f(null)};if(e==="select")return b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content",onClick:$=>$.stopPropagation(),style:{maxWidth:"500px"},children:[b.jsx("h2",{children:" Choose Breathing Pattern"}),b.jsx("div",{style:{display:"grid",gap:"15px",marginTop:"20px"},children:w.map($=>b.jsxs("button",{onClick:()=>{r($.id),t("settings")},style:{padding:"20px",background:"#1a1a1a",border:"2px solid #333",borderRadius:"15px",textAlign:"left",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:W=>W.currentTarget.style.borderColor="#8B5FE8",onMouseLeave:W=>W.currentTarget.style.borderColor="#333",children:[b.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginBottom:"10px"},children:[b.jsx("span",{style:{fontSize:"32px"},children:$.icon}),b.jsxs("div",{style:{flex:1},children:[b.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"white",marginBottom:"5px"},children:$.name}),b.jsx("div",{style:{fontSize:"14px",color:"#888"},children:$.description})]})]}),b.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:$.benefits.map((W,q)=>b.jsx("span",{style:{background:"#8B5FE8",padding:"4px 10px",borderRadius:"12px",fontSize:"12px",color:"white"},children:W},q))})]},$.id))}),b.jsx("button",{onClick:i,style:{marginTop:"20px",width:"100%",padding:"12px",background:"#333",border:"none",borderRadius:"10px",color:"white",fontSize:"16px",cursor:"pointer"},children:"Cancel"})]})});if(e==="settings")return b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content",onClick:$=>$.stopPropagation(),style:{maxWidth:"450px"},children:[b.jsx("h2",{children:" Exercise Settings"}),b.jsxs("div",{style:{marginTop:"30px"},children:[b.jsxs("div",{style:{marginBottom:"30px"},children:[b.jsx("label",{style:{display:"block",fontSize:"16px",fontWeight:"bold",color:"white",marginBottom:"15px"},children:" Duration"}),b.jsx("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[1,3,5,10,15].map($=>b.jsxs("button",{onClick:()=>u($),style:{padding:"12px 20px",background:l===$?"linear-gradient(135deg, #8B5FE8, #B794F6)":"#333",border:l===$?"2px solid #B794F6":"1px solid #555",borderRadius:"12px",color:"white",fontSize:"15px",cursor:"pointer",flex:"1",minWidth:"60px"},children:[$," min"]},$))})]}),b.jsx("button",{onClick:A,style:{width:"100%",padding:"16px",background:"linear-gradient(135deg, #44FF44, #00FF88)",border:"none",borderRadius:"12px",color:"white",fontSize:"18px",fontWeight:"bold",cursor:"pointer",marginBottom:"10px",boxShadow:"0 4px 20px rgba(68, 255, 68, 0.4)"},children:" Begin Exercise"}),b.jsx("button",{onClick:()=>t("select"),style:{width:"100%",padding:"12px",background:"#333",border:"none",borderRadius:"10px",color:"white",fontSize:"16px",cursor:"pointer"},children:" Back"})]})]})});if(e==="active"){const $=h?h.cycle/h.totalCycles*100:0;return b.jsx("div",{className:"modal-overlay",style:{background:"rgba(0, 0, 0, 0.95)"},children:b.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px"},children:[b.jsx("div",{style:{position:"absolute",top:"40px",color:"white",fontSize:"16px",opacity:.7},children:h&&`${h.cycle} / ${h.totalCycles} cycles`}),b.jsx("div",{style:{width:"min(300px, 70vw)",height:"min(300px, 70vw)",borderRadius:"50%",background:"linear-gradient(135deg, #8B5FE8, #00C8FF)",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"40px",transform:h?.phase==="inhale"?"scale(1.3)":h?.phase==="exhale"?"scale(0.8)":"scale(1)",transition:"transform 1s ease-in-out",boxShadow:"0 0 60px rgba(139, 95, 232, 0.6)"},children:b.jsx("div",{style:{fontSize:"clamp(24px, 6vw, 32px)",fontWeight:"bold",color:"white",textAlign:"center"},children:h?.text||"Prepare..."})}),b.jsx("div",{style:{width:"min(300px, 80%)",height:"8px",background:"#333",borderRadius:"10px",overflow:"hidden",marginBottom:"40px"},children:b.jsx("div",{style:{width:`${$}%`,height:"100%",background:"linear-gradient(90deg, #44FF44, #00FF88)",transition:"width 1s ease"}})}),b.jsx("button",{onClick:B,style:{padding:"15px 40px",background:"rgba(255, 68, 68, 0.2)",border:"2px solid #FF4444",borderRadius:"25px",color:"#FF4444",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:" Stop Exercise"})]})})}if(e==="complete"){const $=Rg.getStats();return b.jsx("div",{className:"modal-overlay",onClick:i,children:b.jsxs("div",{className:"modal-content",onClick:W=>W.stopPropagation(),style:{maxWidth:"400px",textAlign:"center"},children:[b.jsx("h2",{style:{fontSize:"48px",margin:"20px 0"},children:""}),b.jsx("h2",{children:"Exercise Complete!"}),b.jsx("p",{style:{fontSize:"16px",color:"#888",margin:"20px 0"},children:"Well done! You've completed your breathing exercise."}),b.jsxs("div",{style:{background:"#1a1a1a",padding:"20px",borderRadius:"15px",marginTop:"20px"},children:[b.jsx("div",{style:{fontSize:"14px",color:"#888",marginBottom:"15px"},children:"Your Stats"}),b.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[b.jsxs("div",{children:[b.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"white"},children:$.totalSessions}),b.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Total Sessions"})]}),b.jsxs("div",{children:[b.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"white"},children:$.totalMinutes}),b.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Minutes"})]}),b.jsxs("div",{children:[b.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#44FF44"},children:$.streak}),b.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Day Streak"})]}),b.jsxs("div",{children:[b.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#8B5FE8"},children:$.totalCycles}),b.jsx("div",{style:{fontSize:"12px",color:"#888"},children:"Total Cycles"})]})]})]}),b.jsx("button",{onClick:i,style:{marginTop:"30px",width:"100%",padding:"15px",background:"linear-gradient(135deg, #8B5FE8, #B794F6)",border:"none",borderRadius:"12px",color:"white",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:"Close"})]})})}return null}function vY({onClose:i}){const[e,t]=we.useState(null),[n,r]=we.useState(!1),[s,l]=we.useState(0),u={pmr:{name:"Progressive Muscle Relaxation",icon:"",duration:"10-15 min",benefits:["Reduces physical tension","Improves sleep","Decreases anxiety"],when:"When you feel physically tense or before sleep",steps:["Find a comfortable position, sitting or lying down.","Take 3 deep breaths to center yourself.","Tense your right fist as tightly as you can for 5 seconds.","Release and feel the tension flowing out. Notice the difference.","Tense your right bicep for 5 seconds, then release.","Repeat with your left arm: fist, then bicep.","Raise your shoulders to your ears, hold 5 seconds, release.","Scrunch your face muscles tightly, hold, then release.","Press your tongue to the roof of your mouth, hold, release.","Arch your back gently, hold 5 seconds, release.","Tighten your stomach muscles, hold, release.","Squeeze your buttocks together, hold, release.","Tense your right thigh, hold, release. Then left thigh.","Point your right toes away from you, hold, release. Repeat left.","Curl your toes tightly, hold, release.","Take 3 deep breaths and scan your body for any remaining tension.","Rest for a moment and enjoy the feeling of complete relaxation."],audioScript:"Welcome to Progressive Muscle Relaxation. Find a comfortable position and close your eyes. We will tense and release each muscle group to help you deeply relax."},breathing478:{name:"4-7-8 Breathing",icon:"",duration:"5 min",benefits:["Calms nervous system","Reduces stress instantly","Helps with sleep"],when:"When feeling anxious or unable to sleep",steps:["Sit comfortably with your back straight.","Place the tip of your tongue behind your upper front teeth.","Exhale completely through your mouth, making a whoosh sound.","Close your mouth and inhale quietly through your nose for 4 counts.","Hold your breath for 7 counts.","Exhale completely through your mouth for 8 counts, making a whoosh sound.","This completes one breath cycle.","Repeat for 4 complete cycles (about 1 minute).","Breathe normally and notice how calm you feel.","You can repeat this 3-4 times throughout the day."],audioScript:"Four seven eight breathing. This ancient technique activates your relaxation response. Let us begin."},bodyscan:{name:"Body Scan Meditation",icon:"",duration:"10 min",benefits:["Releases unconscious tension","Improves body awareness","Promotes deep relaxation"],when:"Anytime you need to reset and reconnect with your body",steps:["Lie down or sit comfortably. Close your eyes.","Take 3 deep breaths, letting go of tension with each exhale.","Bring awareness to the top of your head. Notice any sensations.","Slowly move attention to your forehead. Release any tension.","Notice your eyes, cheeks, jaw. Let them soften.","Move to your neck and shoulders. Feel them relax and drop.","Scan down your right arm to your fingertips. Feel the weight.","Repeat with your left arm.","Bring awareness to your chest. Feel it rise and fall with your breath.","Notice your stomach and lower back. Let them soften.","Scan your hips and pelvis. Release any holding.","Move down your right leg to your toes. Notice temperature and sensation.","Repeat with your left leg.","Take a moment to feel your whole body at once.","Notice the support beneath you.","Take 3 deep breaths and slowly open your eyes when ready."],audioScript:"Body scan meditation. We will journey through your body, releasing tension and finding peace."},autogenic:{name:"Autogenic Training",icon:"",duration:"8 min",benefits:["Self-hypnosis for deep calm","Lowers blood pressure","Reduces stress hormones"],when:"For deep relaxation or before important events",steps:["Lie down comfortably. Close your eyes.","Take 3 deep, calming breaths.",'Silently repeat: "My right arm is heavy." Feel the weight.','Repeat: "My left arm is heavy."','Repeat: "Both arms are heavy."','Now say: "My right arm is warm." Feel warmth spreading.','Repeat: "My left arm is warm."','Say: "My heartbeat is calm and regular." Listen to your heart.','Say: "My breathing is calm and effortless." Notice your breath.','Say: "My stomach is soft and warm." Feel warmth in your belly.','Say: "My forehead is cool and clear." Feel a cooling sensation.',"Rest in this state of deep relaxation for 2-3 minutes.","To finish, take a deep breath, stretch gently, and open your eyes."],audioScript:"Autogenic training. Through self-suggestion, we will guide your body into deep relaxation."},grounding:{name:"5-4-3-2-1 Grounding",icon:"",duration:"3-5 min",benefits:["Stops panic attacks","Grounds you in the present","Reduces anxiety quickly"],when:"During anxiety, panic, or when feeling overwhelmed",steps:["Pause and take a deep breath.","Look around and name 5 things you can SEE.","Really look at them - colors, shapes, details.","Now notice 4 things you can TOUCH or FEEL.","The texture of your clothes, the chair beneath you, the air on your skin.","Listen carefully for 3 things you can HEAR.","Distant sounds, nearby sounds, subtle sounds.","Identify 2 things you can SMELL.","If you can not smell anything, think of 2 favorite scents.","Finally, notice 1 thing you can TASTE.","Or think of your favorite flavor.","Take another deep breath.","Notice how you feel more present and grounded."],audioScript:"Five four three two one grounding. This technique brings you back to the present moment when anxiety tries to pull you away."},mindful:{name:"Mindful Breathing",icon:"",duration:"5 min",benefits:["Calms the mind","Reduces rumination","Increases focus"],when:"Anytime you need mental clarity or calm",steps:["Sit comfortably with your spine straight.","Close your eyes or lower your gaze.","Bring attention to your natural breath.","Notice the sensation of air entering your nostrils.","Feel your chest and belly rise with each inhale.","Notice the natural pause at the top of the inhale.","Feel the air leaving as you exhale.","Notice your belly and chest falling.","When your mind wanders (it will), gently bring it back to your breath.","Count your breaths if it helps: Inhale one, exhale one. Inhale two, exhale two.","Continue for 5 minutes.","Slowly open your eyes and notice how you feel."],audioScript:"Mindful breathing meditation. Simply observe your breath without trying to change it."},visualization:{name:"Safe Place Visualization",icon:"",duration:"10 min",benefits:["Creates instant calm","Reduces stress hormones","Provides mental escape"],when:"When overwhelmed or needing mental peace",steps:["Close your eyes and take 3 deep breaths.","Imagine a place where you feel completely safe and calm.","It could be a beach, forest, mountain, or imaginary place.","See it clearly: What colors do you see?","What time of day is it? What is the light like?","What sounds do you hear? Birds, waves, wind?","What do you smell? Ocean air, pine trees, flowers?","What do you feel on your skin? Warmth, breeze, softness?","Notice how your body feels in this safe place.","Stay here as long as you need.","Know you can return to this place anytime.","When ready, take a deep breath and slowly open your eyes.","Bring that feeling of calm with you."],audioScript:"Safe place visualization. We will journey to a place of complete peace and safety that exists within your imagination."}},h=async()=>{if(!e)return;r(!0),l(0);const p=u[e];await Hc.speak(p.audioScript);for(let w=0;w<p.steps.length;w++)l(w),await Hc.speak(p.steps[w]),await new Promise(A=>setTimeout(A,1e3));await Hc.speak("You have completed this relaxation technique. Take a moment to notice how you feel."),r(!1),l(0)},f=()=>{Hc.stop(),r(!1),l(0)};if(!e)return b.jsx("div",{className:"modal-overlay",onClick:i,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,padding:"20px"},children:b.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:"25px",padding:"30px",maxWidth:"500px",width:"100%",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"2px solid rgba(139, 95, 232, 0.3)"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[b.jsx("h2",{style:{color:"white",fontSize:"28px",margin:0},children:" Stress Relief"}),b.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"28px",width:"40px",height:"40px",borderRadius:"50%",cursor:"pointer"},children:""})]}),b.jsx("p",{style:{color:"#888",marginBottom:"25px",fontSize:"14px"},children:"Choose a scientifically-proven relaxation technique. Each includes audio guidance and written instructions."}),b.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Object.entries(u).map(([p,w])=>b.jsx("button",{onClick:()=>t(p),style:{background:"rgba(255, 255, 255, 0.05)",border:"2px solid rgba(255, 255, 255, 0.1)",borderRadius:"15px",padding:"20px",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease"},onMouseEnter:A=>{A.currentTarget.style.background="rgba(139, 95, 232, 0.15)",A.currentTarget.style.borderColor="#8B5FE8"},onMouseLeave:A=>{A.currentTarget.style.background="rgba(255, 255, 255, 0.05)",A.currentTarget.style.borderColor="rgba(255, 255, 255, 0.1)"},children:b.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"15px"},children:[b.jsx("span",{style:{fontSize:"36px"},children:w.icon}),b.jsxs("div",{style:{flex:1},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[b.jsx("h3",{style:{color:"white",fontSize:"18px",margin:0},children:w.name}),b.jsx("span",{style:{color:"#8B5FE8",fontSize:"12px",fontWeight:"bold"},children:w.duration})]}),b.jsx("p",{style:{color:"#888",fontSize:"13px",margin:"0 0 10px 0"},children:w.when}),b.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:w.benefits.map((A,B)=>b.jsx("span",{style:{background:"rgba(139, 95, 232, 0.2)",color:"#C084FC",fontSize:"11px",padding:"4px 8px",borderRadius:"8px"},children:A},B))})]})]})},p))})]})});const x=u[e];return b.jsx("div",{className:"modal-overlay",onClick:i,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,padding:"20px"},children:b.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:"25px",padding:"30px",maxWidth:"500px",width:"100%",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"2px solid rgba(139, 95, 232, 0.3)"},children:[b.jsx("button",{onClick:()=>t(null),style:{background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"14px",padding:"8px 16px",borderRadius:"20px",cursor:"pointer",marginBottom:"20px"},children:" Back"}),b.jsxs("div",{style:{textAlign:"center",marginBottom:"25px"},children:[b.jsx("span",{style:{fontSize:"60px"},children:x.icon}),b.jsx("h2",{style:{color:"white",fontSize:"24px",margin:"10px 0"},children:x.name}),b.jsx("p",{style:{color:"#8B5FE8",fontSize:"14px",fontWeight:"bold"},children:x.duration})]}),b.jsxs("div",{style:{marginBottom:"25px"},children:[b.jsx("h4",{style:{color:"white",fontSize:"16px",marginBottom:"10px"},children:"Benefits:"}),x.benefits.map((p,w)=>b.jsxs("div",{style:{color:"#888",fontSize:"14px",marginBottom:"5px",paddingLeft:"10px"},children:[" ",p]},w))]}),n?b.jsx("button",{onClick:f,style:{width:"100%",padding:"18px",background:"linear-gradient(135deg, #FF4444, #FF6B6B)",border:"none",borderRadius:"15px",color:"white",fontSize:"18px",fontWeight:"bold",cursor:"pointer",marginBottom:"20px"},children:" Stop"}):b.jsx("button",{onClick:h,style:{width:"100%",padding:"18px",background:"linear-gradient(135deg, #8B5FE8, #B794F6)",border:"none",borderRadius:"15px",color:"white",fontSize:"18px",fontWeight:"bold",cursor:"pointer",marginBottom:"20px",boxShadow:"0 5px 20px rgba(139, 95, 232, 0.4)"},children:" Start Audio Guide"}),b.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:"15px",padding:"20px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[b.jsx("h4",{style:{color:"white",fontSize:"16px",marginBottom:"15px"},children:" Step-by-Step Instructions:"}),x.steps.map((p,w)=>b.jsxs("div",{style:{color:n&&w===s?"#FFB84D":w<s?"#888":"white",fontSize:"14px",marginBottom:"12px",paddingLeft:"25px",position:"relative",transition:"color 0.3s ease"},children:[b.jsxs("span",{style:{position:"absolute",left:0,color:n&&w===s?"#FFB84D":"#8B5FE8",fontWeight:"bold"},children:[w+1,"."]}),p]},w))]}),b.jsx("button",{onClick:i,style:{width:"100%",padding:"15px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px",color:"white",fontSize:"16px",cursor:"pointer",marginTop:"20px"},children:"Close"})]})})}function _Y({onClose:i}){const[e,t]=we.useState(null),[n,r]=we.useState(!1),[s,l]=we.useState(0),u={morning:{name:"Morning Energy Activation",icon:"",duration:"10 min",benefits:["Energizes your day","Boosts motivation","Clears mental fog"],when:"First thing in the morning",steps:["Sit comfortably with your spine straight. Feel powerful and alert.","Take a deep breath in through your nose, filling your lungs completely.","Exhale fully, releasing any sleepiness or doubt.","Visualize golden sunlight pouring down from above.","See it entering through the top of your head, filling your entire body with energy.","Feel this warm, powerful light awakening every cell.","Say to yourself: I am fully awake. I am powerful. I am ready.","Breathe in confidence. Breathe out hesitation.","Visualize your day ahead going perfectly.","See yourself handling challenges with ease and grace.","Feel the energy building in your core, like a fire growing stronger.","Stand up slowly, feeling tall, strong, and unstoppable.","Take one final deep breath and smile.","You are ready to conquer this day."],audioScript:"Morning energy activation. Rise like the sun and feel your power awaken. Let us begin."},innerPower:{name:"Inner Power Meditation",icon:"",duration:"12 min",benefits:["Unlocks inner strength","Builds resilience","Increases self-confidence"],when:"When you need to feel strong",steps:["Sit in a powerful posture. Shoulders back, head high.","Close your eyes and take three powerful breaths.","Imagine a diamond at the center of your chest.","This diamond represents your unbreakable inner strength.","With each breath, the diamond glows brighter.","Feel its energy radiating through your entire body.","Remember a time when you were strong, when you overcame something difficult.","Feel that strength now, in this moment.","Say to yourself: I am strong. I am capable. I am unstoppable.","Visualize challenges before you crumbling like dust.","Nothing can break you. You are solid as diamond.","Feel this power in your bones, in your blood.","Let it fill every cell until you vibrate with strength.","Open your eyes. You are power itself."],audioScript:"Inner power meditation. Deep within you lies unbreakable strength. We will awaken it now."},confidence:{name:"Confidence Boost",icon:"",duration:"8 min",benefits:["Builds unshakeable confidence","Eliminates self-doubt","Radiates charisma"],when:"Before important events or presentations",steps:["Stand tall with your feet shoulder-width apart.","Place your hands on your hips in a power pose.","Breathe deeply and feel your presence expanding.","You are not small. You are magnificent.","Say out loud: I am confident. I am worthy. I am enough.","Visualize yourself succeeding brilliantly at your goal.","See people responding positively to you.","Feel what it feels like to be completely confident.","Your voice is strong. Your presence commands respect.","Doubt has no place here. Only certainty.","You were born for this moment.","Breathe in power. Breathe out fear.","Smile confidently. You already know you will succeed.","Now go and show the world who you are."],audioScript:"Confidence boost. You are about to remember who you truly are. Powerful. Confident. Unstoppable."},quickEnergy:{name:"Quick Energy Reset",icon:"",duration:"5 min",benefits:["Instant energy surge","Clears mental fatigue","Sharpens focus"],when:"Afternoon slump or when tired",steps:["Stand up and shake out your body vigorously for 10 seconds.","Take a huge breath in and hold it for 5 seconds.","Exhale forcefully through your mouth with a HA sound.","Repeat this power breath 3 times.","Jump in place 10 times, feeling energy surge with each jump.","Rub your palms together rapidly until they are hot.","Place your warm palms over your closed eyes.","Feel energy transferring from your hands to your brain.","Tap your chest firmly with your fist, like a drum.","Say loudly: I am awake! I am alive! I am energized!","Do 10 arm circles forward, then 10 backward.","Take one final deep breath and feel completely refreshed.","You are recharged and ready."],audioScript:"Quick energy reset. In just five minutes, you will feel completely recharged. Let us activate your energy now."},warrior:{name:"Warrior Mindset",icon:"",duration:"10 min",benefits:["Builds mental toughness","Conquers fear","Prepares for challenges"],when:"Before facing difficult situations",steps:["Stand in warrior pose: feet wide, arms extended.","Feel your connection to the ground beneath you.","You are immovable. You are a warrior.","Breathe like a warrior: strong, powerful breaths.","Visualize yourself as a lion, king of the jungle.","No challenge is too great. No obstacle too high.","Remember: warriors are not born, they are forged.","Every challenge you have faced has made you stronger.","You have survived 100% of your worst days.","Today will be no different. You will prevail.","Say: I am a warrior. I face fear with courage.","Feel strength flowing through your veins.","Your spirit is unbreakable. Your will is iron.","Open your eyes. You are ready for battle."],audioScript:"Warrior mindset meditation. The warrior within you is awakening. Feel your courage rising."},chakra:{name:"Chakra Energy Activation",icon:"",duration:"15 min",benefits:["Activates all energy centers","Balances life force","Awakens kundalini"],when:"For deep energy work",steps:["Sit comfortably with your spine perfectly straight.","Close your eyes and breathe naturally.","Bring awareness to the base of your spine. See a red glowing light.","As you breathe, this red light grows brighter. Root chakra activated.","Move to your lower belly. See an orange light glowing. Sacral chakra awakening.","Feel creativity and passion flowing through you.","Move to your solar plexus. A yellow sun burns bright. Power chakra activated.","Feel confidence and personal power radiating.","Move to your heart center. A green light expands. Heart chakra opening.","Feel love and compassion flowing infinitely.","Move to your throat. A blue light glows. Throat chakra activated.","Your voice carries truth and power.","Move to your third eye, between your brows. Indigo light shines. Intuition awakens.","Move to the crown of your head. Violet light explodes outward. Connection to universe.","Feel all seven chakras spinning and glowing in harmony.","You are pure energy. You are infinite."],audioScript:"Chakra energy activation. We will awaken each energy center from root to crown. Feel your power multiply."},affirmation:{name:"Positive Affirmation Power",icon:"",duration:"8 min",benefits:["Reprograms subconscious","Builds positive beliefs","Manifests success"],when:"Daily practice for transformation",steps:["Sit comfortably and place your hand over your heart.","Take a deep breath and feel your heartbeat.","Say each affirmation with total conviction.","I am powerful beyond measure.","I am worthy of all good things.","I am capable of achieving anything I set my mind to.","I radiate confidence and positive energy.","Opportunities flow to me effortlessly.","I am healthy, wealthy, and wise.","I am loved, supported, and appreciated.","I trust myself completely.","I am exactly where I need to be.","Every day I am becoming better and stronger.","I am grateful for my incredible life.","I am unstoppable.","Feel these truths settling into your bones.","They are not wishes. They are facts.","You are all of these things right now."],audioScript:"Positive affirmation meditation. Words have power. These affirmations will reprogram your mind for success."},mountain:{name:"Mountain Strength",icon:"",duration:"10 min",benefits:["Unshakeable stability","Emotional resilience","Grounded power"],when:"When feeling unstable or anxious",steps:["Sit in a solid, grounded position.","Feel the weight of your body pressing down.","You are not fragile. You are a mountain.","Visualize yourself as a massive mountain peak.","Your base is deep in the earth, immovable.","Storms come. Winds blow. You do not move.","Rain falls. Snow covers you. You remain.","Centuries pass. You stand eternal.","Feel this mountain strength in your body.","Nothing can shake you. Nothing can move you.","Emotions are like weather passing over the mountain.","They come. They go. The mountain remains.","You are solid. You are stable. You are strong.","Breathe with the patience of mountains.","You have all the time in the world.","You are unshakeable."],audioScript:"Mountain strength visualization. You are about to become as solid and unshakeable as an ancient mountain."}},h=async()=>{if(!e)return;r(!0),l(0);const p=u[e];await Hc.speak(p.audioScript),await new Promise(w=>setTimeout(w,1500));for(let w=0;w<p.steps.length;w++)l(w),await Hc.speak(p.steps[w]),await new Promise(A=>setTimeout(A,2e3));await Hc.speak("You have completed this powerful meditation. Notice how strong and energized you feel.");try{await lf.logActivity("meditation")}catch(w){console.error(" [GAMIFICATION] Failed to log meditation activity:",w)}r(!1),l(0)},f=()=>{Hc.stop(),r(!1),l(0)};if(!e)return b.jsx("div",{className:"modal-overlay",onClick:i,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,padding:"20px"},children:b.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:"25px",padding:"30px",maxWidth:"500px",width:"100%",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"2px solid rgba(255, 184, 77, 0.3)"},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[b.jsx("h2",{style:{color:"white",fontSize:"28px",margin:0},children:" Guided Meditation"}),b.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"28px",width:"40px",height:"40px",borderRadius:"50%",cursor:"pointer"},children:""})]}),b.jsx("p",{style:{color:"#888",marginBottom:"25px",fontSize:"14px"},children:"Choose an energizing meditation to feel powerful, confident, and unstoppable. Each includes audio guidance."}),b.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Object.entries(u).map(([p,w])=>b.jsx("button",{onClick:()=>t(p),style:{background:"rgba(255, 255, 255, 0.05)",border:"2px solid rgba(255, 255, 255, 0.1)",borderRadius:"15px",padding:"20px",cursor:"pointer",textAlign:"left",transition:"all 0.3s ease"},onMouseEnter:A=>{A.currentTarget.style.background="rgba(255, 184, 77, 0.15)",A.currentTarget.style.borderColor="#FFB84D"},onMouseLeave:A=>{A.currentTarget.style.background="rgba(255, 255, 255, 0.05)",A.currentTarget.style.borderColor="rgba(255, 255, 255, 0.1)"},children:b.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"15px"},children:[b.jsx("span",{style:{fontSize:"36px"},children:w.icon}),b.jsxs("div",{style:{flex:1},children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[b.jsx("h3",{style:{color:"white",fontSize:"18px",margin:0},children:w.name}),b.jsx("span",{style:{color:"#FFB84D",fontSize:"12px",fontWeight:"bold"},children:w.duration})]}),b.jsx("p",{style:{color:"#888",fontSize:"13px",margin:"0 0 10px 0"},children:w.when}),b.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:w.benefits.map((A,B)=>b.jsx("span",{style:{background:"rgba(255, 184, 77, 0.2)",color:"#FFD700",fontSize:"11px",padding:"4px 8px",borderRadius:"8px"},children:A},B))})]})]})},p))})]})});const x=u[e];return b.jsx("div",{className:"modal-overlay",onClick:i,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,padding:"20px"},children:b.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:"25px",padding:"30px",maxWidth:"500px",width:"100%",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"2px solid rgba(255, 184, 77, 0.3)"},children:[b.jsx("button",{onClick:()=>t(null),style:{background:"rgba(255, 255, 255, 0.1)",border:"none",color:"white",fontSize:"14px",padding:"8px 16px",borderRadius:"20px",cursor:"pointer",marginBottom:"20px"},children:" Back"}),b.jsxs("div",{style:{textAlign:"center",marginBottom:"25px"},children:[b.jsx("span",{style:{fontSize:"60px"},children:x.icon}),b.jsx("h2",{style:{color:"white",fontSize:"24px",margin:"10px 0"},children:x.name}),b.jsx("p",{style:{color:"#FFB84D",fontSize:"14px",fontWeight:"bold"},children:x.duration})]}),b.jsxs("div",{style:{marginBottom:"25px"},children:[b.jsx("h4",{style:{color:"white",fontSize:"16px",marginBottom:"10px"},children:" Benefits:"}),x.benefits.map((p,w)=>b.jsxs("div",{style:{color:"#888",fontSize:"14px",marginBottom:"5px",paddingLeft:"10px"},children:[" ",p]},w))]}),n?b.jsx("button",{onClick:f,style:{width:"100%",padding:"18px",background:"linear-gradient(135deg, #FF4444, #FF6B6B)",border:"none",borderRadius:"15px",color:"white",fontSize:"18px",fontWeight:"bold",cursor:"pointer",marginBottom:"20px"},children:" Stop"}):b.jsx("button",{onClick:h,style:{width:"100%",padding:"18px",background:"linear-gradient(135deg, #FFB84D, #FF9500)",border:"none",borderRadius:"15px",color:"white",fontSize:"18px",fontWeight:"bold",cursor:"pointer",marginBottom:"20px",boxShadow:"0 5px 20px rgba(255, 184, 77, 0.4)"},children:" Start Guided Meditation"}),b.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.05)",borderRadius:"15px",padding:"20px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[b.jsx("h4",{style:{color:"white",fontSize:"16px",marginBottom:"15px"},children:" Meditation Guide:"}),x.steps.map((p,w)=>b.jsxs("div",{style:{color:n&&w===s?"#FFD700":w<s?"#888":"white",fontSize:"14px",marginBottom:"12px",paddingLeft:"25px",position:"relative",transition:"color 0.3s ease",fontWeight:n&&w===s?"bold":"normal"},children:[b.jsxs("span",{style:{position:"absolute",left:0,color:n&&w===s?"#FFD700":"#FFB84D",fontWeight:"bold"},children:[w+1,"."]}),p]},w))]}),b.jsx("button",{onClick:i,style:{width:"100%",padding:"15px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px",color:"white",fontSize:"16px",cursor:"pointer",marginTop:"20px"},children:"Close"})]})})}function bY(){const i=Mp(),[e]=_C(),[t,n]=we.useState("verifying");e.get("session_id"),we.useEffect(()=>{r()},[]);const r=async()=>{try{const s=mw.currentUser;if(!s){n("error");return}localStorage.removeItem("subscription_last_verified"),await or.verifySubscriptionWithServer(s.uid),or.getCurrentPlan().id!=="free"?(n("success"),setTimeout(()=>i("/dashboard"),3e3)):n("pending")}catch(s){console.error("Error verifying payment:",s),n("error")}};return b.jsx("div",{className:"payment-success-container",children:b.jsxs("div",{className:"payment-success-card",children:[t==="verifying"&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"spinner"}),b.jsx("h2",{children:"Verifying Payment..."}),b.jsx("p",{children:"Please wait while we confirm your subscription."})]}),t==="success"&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"success-icon",children:""}),b.jsx("h2",{children:"Payment Successful!"}),b.jsx("p",{children:"Your subscription is now active."}),b.jsx("p",{children:"Redirecting to dashboard..."})]}),t==="pending"&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"pending-icon",children:""}),b.jsx("h2",{children:"Payment Processing"}),b.jsx("p",{children:"Your payment is being processed. This may take a few minutes."}),b.jsx("button",{onClick:()=>i("/dashboard"),className:"return-button",children:"Return to Dashboard"})]}),t==="error"&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"error-icon",children:""}),b.jsx("h2",{children:"Verification Failed"}),b.jsx("p",{children:"We couldn't verify your payment. Please contact support."}),b.jsx("button",{onClick:()=>i("/dashboard"),className:"return-button",children:"Return to Dashboard"})]})]})})}function xY(){const i=Mp();return b.jsx("div",{className:"payment-canceled-container",children:b.jsxs("div",{className:"payment-canceled-card",children:[b.jsx("div",{className:"canceled-icon",children:""}),b.jsx("h2",{children:"Payment Canceled"}),b.jsx("p",{children:"Your payment was canceled. No charges were made."}),b.jsx("p",{children:"You can try again anytime you're ready."}),b.jsxs("div",{className:"action-buttons",children:[b.jsx("button",{onClick:()=>i("/dashboard"),className:"secondary-button",children:"Return to Dashboard"}),b.jsx("button",{onClick:()=>i("/pricing"),className:"primary-button",children:"View Plans"})]})]})})}let s2=[],M1=null;const NY=(i,e="info",t=3e3)=>{const n={id:Date.now()+Math.random(),message:i,type:e,duration:t};s2.push(n),M1&&M1()};function wY(){const[i,e]=we.useState([]);we.useEffect(()=>(M1=()=>{if(s2.length>0){const r=s2.shift();e(s=>[...s,r]),setTimeout(()=>{e(s=>s.filter(l=>l.id!==r.id))},r.duration)}},()=>{M1=null}),[]);const t=r=>{e(s=>s.filter(l=>l.id!==r))},n=r=>{switch(r){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return b.jsx("div",{className:"toast-container",children:i.map(r=>b.jsxs("div",{className:`toast toast-${r.type}`,onClick:()=>t(r.id),children:[b.jsx("span",{className:"toast-icon",children:n(r.type)}),b.jsx("span",{className:"toast-message",children:r.message}),b.jsx("button",{className:"toast-close",onClick:()=>t(r.id),children:""})]},r.id))})}function SY(){const[i,e]=we.useState(!1);we.useEffect(()=>{localStorage.getItem("cookieConsent")||setTimeout(()=>e(!0),2e3)},[]);const t=()=>{localStorage.setItem("cookieConsent","accepted"),localStorage.setItem("cookieConsentDate",new Date().toISOString()),e(!1)},n=()=>{localStorage.setItem("cookieConsent","declined"),localStorage.setItem("cookieConsentDate",new Date().toISOString()),e(!1)};return i?b.jsx("div",{className:"cookie-consent-overlay",children:b.jsxs("div",{className:"cookie-consent-banner",children:[b.jsxs("div",{className:"cookie-content",children:[b.jsx("div",{className:"cookie-icon",children:""}),b.jsxs("div",{className:"cookie-text",children:[b.jsx("h3",{children:"We Value Your Privacy"}),b.jsxs("p",{children:["We use essential cookies for app functionality and anonymous analytics to improve your experience. We do NOT use advertising or tracking cookies. ",b.jsx("a",{href:"/legal/privacy.html",target:"_blank",rel:"noopener noreferrer",style:{color:"#00FFFF",textDecoration:"underline"},children:"Learn more"})]})]})]}),b.jsxs("div",{className:"cookie-buttons",children:[b.jsx("button",{className:"cookie-btn decline",onClick:n,children:"Essential Only"}),b.jsx("button",{className:"cookie-btn accept",onClick:t,children:"Accept All"})]})]})}):null}function TY(){return we.useEffect(()=>{Tr.initGoogleAnalytics(),Tr.trackPageView("App_Start");const i=mw.onAuthStateChanged(e=>{e&&or.verifySubscriptionWithServer(e.uid).catch(t=>{console.error("Failed to verify subscription on app start:",t)})});return()=>i()},[]),b.jsx(nu,{children:b.jsxs(YO,{children:[b.jsxs(AO,{children:[b.jsx(Ng,{path:"/",element:b.jsx(BH,{})}),b.jsx(Ng,{path:"/dashboard",element:b.jsx(rY,{})}),b.jsx(Ng,{path:"/payment-success",element:b.jsx(bY,{})}),b.jsx(Ng,{path:"/payment-canceled",element:b.jsx(xY,{})})]}),b.jsx(wY,{}),b.jsx(SY,{})]})})}const B0="1.0.8",AY="__BUILD_TIMESTAMP__";"serviceWorker"in navigator&&(navigator.serviceWorker.getRegistrations().then(i=>{i.forEach(e=>{console.log(" Unregistering service worker:",e),e.unregister()})}),"caches"in window&&caches.keys().then(i=>{i.forEach(e=>{console.log(" Deleting cache:",e),caches.delete(e)})}));try{const i=localStorage.getItem("app_version");i!==B0&&(console.log(` Version upgrade detected: ${i}  ${B0}`),localStorage.setItem("app_version",B0),localStorage.setItem("last_cache_clear",new Date().toISOString()),i&&i!=="null"&&(console.log(" Forcing hard reload for version update..."),window.location.reload(!0)))}catch(i){console.warn("localStorage check failed:",i)}console.log(" APP VERSION:",B0);console.log(" BUILD TIME:",AY);console.log(" CACHE BUSTED - Fresh load!");PP.createRoot(document.getElementById("root")).render(b.jsx(we.StrictMode,{children:b.jsx(TY,{})}));export{RY as A,$H as B,wo as C,rG as D,OI as E,fG as F,N0 as G,DY as H,FI as I,LY as J,eC as K,Eu as L,Uh as M,jI as N,yn as P,IP as R,U0 as S,jD as W,jt as _,Ti as a,NY as b,Jh as c,tC as d,EY as e,mi as f,lf as g,iS as h,rb as i,b as j,Bl as k,lq as l,U9 as m,B9 as n,$9 as o,NI as p,Ld as q,we as r,or as s,zr as t,J9 as u,Ex as v,n0 as w,CY as x,VH as y,HH as z};
