const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-1765892656375-smartFoodSearch.js","assets/chunk-1765892656551-usdaService.js","assets/chunk-1765892656551-restaurantService.js","assets/chunk-1765892656404-barcodeScannerService.js","assets/entry-1765892656001-index.js","assets/asset-1765892656785-index.css","assets/chunk-1765892656375-index.js"])))=>i.map(i=>d[i]);
import{r as l,a as F,j as e,s as j,_ as m,b as M}from"./entry-1765892656001-index.js";import{a as N}from"./chunk-1765892656377-aiVisionService.js";/* empty css                                */import"./chunk-1765892656375-index.js";function B({onClose:w,initialMode:C=null,lockMode:u=!1,initialTab:y="usda"}){const[r,d]=l.useState(C||"food"),[i,g]=l.useState(!1),[a,x]=l.useState(null),[h,p]=l.useState(""),[o,S]=l.useState(null),[_,k]=l.useState(!1);l.useEffect(()=>{const t=F.getUserAllergenProfile();S(t||{allergens:[],intolerances:[],dietaryPreferences:[],allergenSeverity:{}})},[]);const f=async()=>{if(!j.checkLimit("foodScans").allowed){k(!0);return}p(""),x(null),g(!0);try{const s=await N.captureFoodPhoto();if(!s.success)throw new Error(s.error||"Failed to capture photo");if(r==="halal"){const b=await N.analyzeHalalStatus(s.imageData);if(!b.success)throw new Error(b.error||"Halal analysis failed");x({...b.analysis,imageData:s.imageData,scanMode:"halal"}),j.incrementUsage("foodScans");const P=j.checkLimit("foodScans");g(!1);return}const n=r==="food"?await N.analyzeFoodImage(s.imageData):await N.analyzeIngredientLabel(s.imageData);if(!n.success)throw new Error(n.error||"Analysis failed");const c=n.analysis.foodName||n.analysis.food,I=await(await m(async()=>{const{default:b}=await import("./chunk-1765892656375-smartFoodSearch.js");return{default:b}},__vite__mapDeps([0,1,2,3,4,5,6]))).default.searchAllDatabases(c);x({...n.analysis,imageData:s.imageData,databaseMatches:I,bestMatch:I.length>0?I[0]:null}),j.incrementUsage("foodScans");const E=j.checkLimit("foodScans");n.analysis.safetyLevel!=="danger"&&await F.logFood({name:n.analysis.foodName,ingredients:n.analysis.ingredients,allergens:n.analysis.detectedAllergens,safety:n.analysis.safetyLevel})}catch(s){let n=s.message||"Scanner error";n.includes("Server Error: 413")?n="âŒ Image too large. Try again with better lighting.":n.includes("API Error: 400")||n.includes("Server Error: 400")?n="âŒ Image format error. Please try again.":n.includes("API Error: 401")||n.includes("Server Error: 401")?n="âŒ Your API key was reported as leaked. Please use another API key.":n.includes("API Error: 429")||n.includes("Server Error: 429")?n="âŒ Too many requests. Please wait a moment.":n.includes("Invalid API response")?n="âŒ AI service error. Please try again.":n.includes("Empty response")?n="âŒ No analysis returned. Try a clearer photo.":n.includes("Failed to fetch")||n.includes("Network")?n="âŒ Network error. Check your internet connection.":n=`âŒ ${n}`,p(n)}finally{g(!1)}},A=async()=>{if(!a)return;const t={relatedFood:a.foodName,timestamp:new Date().toISOString(),severity:"mild"};await F.logSymptom(t),M("Symptom logged for AI learning","success")};return e.jsx("div",{className:"food-scanner-overlay",children:e.jsxs("div",{className:"food-scanner",children:[e.jsx("button",{className:"scanner-close",onClick:w,children:"âœ•"}),e.jsx("h2",{className:"scanner-title",children:"ğŸ” AI Food Scanner"}),(()=>{const t=window.subscriptionService;if(t){const s=t.checkLimit("foodScans");if(!t.hasAccess("foodScanner"))return e.jsx("div",{style:{marginBottom:"15px",padding:"10px 16px",background:s.remaining<=0?"rgba(255, 68, 68, 0.2)":"rgba(76, 175, 80, 0.2)",borderRadius:"20px",fontSize:"14px",color:s.remaining<=0?"#FF4444":"#4CAF50",fontWeight:"bold",border:`2px solid ${s.remaining<=0?"#FF4444":"rgba(76, 175, 80, 0.4)"}`,textAlign:"center"},children:s.remaining>0?e.jsxs(e.Fragment,{children:["ğŸ“¸ ",s.remaining,"/",s.limit," scans left today"]}):e.jsx(e.Fragment,{children:"ğŸ”’ Daily scans used - Upgrade for unlimited!"})})}return null})(),!u&&e.jsxs("div",{className:"scan-mode-toggle",children:[e.jsx("button",{className:`mode-btn ${r==="food"?"active":""}`,onClick:()=>d("food"),children:"ğŸ“¸ Scan Food"}),e.jsx("button",{className:`mode-btn ${r==="label"?"active":""}`,onClick:()=>d("label"),children:"ğŸ·ï¸ Scan Label"}),e.jsx("button",{className:`mode-btn ${r==="halal"?"active":""}`,onClick:()=>d("halal"),children:"ğŸ•Œ Halal Check"}),e.jsx("button",{className:`mode-btn ${r==="search"?"active":""}`,onClick:()=>d("search"),children:"ğŸ” Search 6M Foods"})]}),o&&o.allergens?.length>0&&e.jsxs("div",{className:"allergen-summary",children:[e.jsx("h3",{children:"Your Allergens:"}),e.jsx("div",{className:"allergen-badges",children:o.allergens.map((t,s)=>{const n=o.allergenSeverity?.[t]||"moderate";return e.jsx("span",{className:`allergen-badge ${n}`,children:t},s)})})]}),r==="search"&&!a&&e.jsx(R,{onClose:w,initialTab:y}),!a&&r!=="search"&&e.jsx("button",{className:"scan-button",onClick:f,disabled:i,"aria-label":"Start camera to scan food",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner",children:"â³"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:["ğŸ“· ",r==="food"?"Scan Food":r==="halal"?"Check Halal Status":"Scan Ingredient Label"]})}),h&&e.jsxs("div",{className:"scanner-error",children:["âŒ ",h]}),a&&r==="halal"&&a.halalStatus&&e.jsxs("div",{className:"halal-results",children:[e.jsx("div",{className:"result-image",children:e.jsx("img",{src:`data:image/jpeg;base64,${a.imageData}`,alt:"Scanned product"})}),e.jsxs("div",{className:`halal-verdict ${a.halalStatus}`,children:[a.halalStatus==="halal"&&"âœ… HALAL",a.halalStatus==="haram"&&"âŒ HARAM",a.halalStatus==="doubtful"&&"âš ï¸ DOUBTFUL (MUSHBOOH)",a.halalStatus==="uncertain"&&"â“ UNCERTAIN"]}),e.jsxs("div",{className:"halal-confidence",children:["Confidence: ",a.confidence,"%"]}),a.certifications&&a.certifications.length>0&&e.jsxs("div",{className:"halal-section",children:[e.jsx("h4",{children:"ğŸ… Certifications Found:"}),e.jsx("ul",{children:a.certifications.map((t,s)=>e.jsx("li",{className:"cert-item",children:t},s))})]}),a.haramIngredients&&a.haramIngredients.length>0&&e.jsxs("div",{className:"halal-section danger",children:[e.jsx("h4",{children:"ğŸš« Haram Ingredients:"}),e.jsx("ul",{children:a.haramIngredients.map((t,s)=>e.jsx("li",{className:"haram-item",children:t},s))})]}),a.doubtfulIngredients&&a.doubtfulIngredients.length>0&&e.jsxs("div",{className:"halal-section warning",children:[e.jsx("h4",{children:"âš ï¸ Doubtful Ingredients:"}),e.jsx("ul",{children:a.doubtfulIngredients.map((t,s)=>e.jsx("li",{className:"doubtful-item",children:t},s))})]}),a.eCodes&&a.eCodes.length>0&&e.jsxs("div",{className:"halal-section",children:[e.jsx("h4",{children:"ğŸ”¢ E-Codes Found:"}),e.jsx("ul",{children:a.eCodes.map((t,s)=>e.jsx("li",{className:"ecode-item",children:t},s))})]}),a.crossContamination&&e.jsxs("div",{className:"halal-section",children:[e.jsx("h4",{children:"âš—ï¸ Cross-Contamination:"}),e.jsx("p",{children:a.crossContamination})]}),a.recommendation&&e.jsxs("div",{className:"halal-section recommendation",children:[e.jsx("h4",{children:"ğŸ’¡ Recommendation:"}),e.jsx("p",{children:a.recommendation})]}),a.details&&e.jsxs("div",{className:"halal-section details",children:[e.jsx("h4",{children:"ğŸ“‹ Detailed Analysis:"}),e.jsx("p",{children:a.details})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("button",{className:"action-btn",onClick:f,children:"ğŸ“· Scan Another Product"}),e.jsx("button",{className:"action-btn secondary",onClick:()=>x(null),children:"â† Back"})]})]}),a&&r!=="halal"&&e.jsxs("div",{className:"scan-results",children:[e.jsx("div",{className:"result-image",children:e.jsx("img",{src:`data:image/jpeg;base64,${a.imageData}`,alt:"Scanned food"})}),e.jsxs("div",{className:`safety-banner ${a.safetyLevel}`,style:{backgroundColor:a.safetyColor},children:[e.jsx("span",{className:"safety-icon",children:a.safetyIcon}),e.jsx("span",{className:"safety-text",children:a.safetyMessage})]}),e.jsx("h3",{className:"food-name",children:a.foodName}),a.databaseMatches&&a.databaseMatches.length>0&&e.jsxs("div",{style:{background:"#f0f9ff",padding:"15px",borderRadius:"12px",marginBottom:"15px"},children:[e.jsxs("h4",{style:{margin:"0 0 10px 0",fontSize:"14px",color:"#0284c7"},children:["ğŸ” Found ",a.databaseMatches.length," matches in databases"]}),a.bestMatch&&e.jsxs("div",{style:{background:"white",padding:"12px",borderRadius:"8px",marginBottom:"10px",border:"2px solid #0284c7"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:a.bestMatch.sourceBadge}),e.jsx("strong",{style:{fontSize:"15px"},children:a.bestMatch.name}),e.jsx("span",{style:{marginLeft:"auto",fontSize:"11px",padding:"3px 8px",background:"#dcfce7",color:"#166534",borderRadius:"12px",fontWeight:"bold"},children:"BEST MATCH"})]}),e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:[e.jsx("strong",{children:a.bestMatch.calories})," cal |",e.jsx("strong",{children:" P:"})," ",a.bestMatch.protein,"g |",e.jsx("strong",{children:" C:"})," ",a.bestMatch.carbs||a.bestMatch.carbohydrates,"g |",e.jsx("strong",{children:" F:"})," ",a.bestMatch.fat||a.bestMatch.fats,"g"]}),e.jsx("div",{style:{fontSize:"11px",color:"#999",marginTop:"4px"},children:a.bestMatch.brand||a.bestMatch.restaurantName||a.bestMatch.source})]}),a.databaseMatches.length>1&&e.jsxs("details",{style:{fontSize:"13px"},children:[e.jsxs("summary",{style:{cursor:"pointer",color:"#0284c7",fontWeight:"bold"},children:["View all ",a.databaseMatches.length," options â†’"]}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",marginTop:"10px"},children:a.databaseMatches.slice(1,6).map((t,s)=>e.jsxs("div",{style:{background:"white",padding:"8px",marginBottom:"6px",borderRadius:"6px",fontSize:"12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:t.sourceBadge}),e.jsx("strong",{children:t.name})]}),e.jsxs("div",{style:{color:"#666",fontSize:"11px",marginTop:"2px"},children:[t.calories," cal | P: ",t.protein,"g | C: ",t.carbs||t.carbohydrates,"g | F: ",t.fat||t.fats,"g"]})]},s))})]})]}),a.detectedAllergens&&a.detectedAllergens.length>0&&e.jsxs("div",{className:"detected-allergens",children:[e.jsx("h4",{children:"âš ï¸ Detected Allergens:"}),e.jsx("ul",{children:a.detectedAllergens.map((t,s)=>e.jsxs("li",{className:"allergen-item",children:[e.jsx("strong",{children:t.name}),t.location&&` - Found in: ${t.location}`,e.jsxs("span",{className:`confidence ${t.confidence}`,children:[t.confidence," confidence"]})]},s))})]}),a.ingredients&&a.ingredients.length>0&&e.jsxs("div",{className:"ingredients-list",children:[e.jsx("h4",{children:"ğŸ“‹ Ingredients:"}),e.jsx("div",{className:"ingredient-chips",children:a.ingredients.map((t,s)=>e.jsx("span",{className:"ingredient-chip",children:t},s))})]}),a.hiddenIngredients&&a.hiddenIngredients.length>0&&e.jsxs("div",{className:"hidden-ingredients",children:[e.jsx("h4",{children:"ğŸ” Likely Hidden Ingredients:"}),e.jsx("ul",{children:a.hiddenIngredients.map((t,s)=>e.jsx("li",{children:t},s))})]}),a.alternatives&&a.alternatives.length>0&&e.jsxs("div",{className:"alternatives",children:[e.jsx("h4",{children:"ğŸ’¡ Make It Safe:"}),e.jsx("ul",{children:a.alternatives.map((t,s)=>e.jsx("li",{children:t},s))})]}),e.jsxs("div",{className:"confidence-bar",children:[e.jsx("span",{children:"AI Confidence:"}),e.jsx("div",{className:"bar",children:e.jsx("div",{className:"fill",style:{width:`${a.confidence}%`}})}),e.jsxs("span",{children:[a.confidence,"%"]})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("button",{className:"action-btn",onClick:f,children:"ğŸ“· Scan Again"}),e.jsx("button",{className:"action-btn secondary",onClick:A,children:"ğŸ“ Log Reaction"}),e.jsx("button",{className:"action-btn secondary",onClick:()=>x(null),children:"â† Back"})]})]}),r!=="search"&&e.jsx("div",{className:"scanner-info",children:e.jsx("p",{children:r==="food"?"ğŸ“¸ Point camera at any food to identify ingredients and check allergens":r==="halal"?"ğŸ•Œ Scan product labels for comprehensive Islamic dietary compliance verification":"ğŸ·ï¸ Scan ingredient labels to extract and analyze all contents"})})]})})}function R({onClose:w,initialTab:C="usda"}){const[u,y]=l.useState(""),[r,d]=l.useState([]),[i,g]=l.useState(C),[a,x]=l.useState(!1),[h,p]=l.useState(!1),[o,S]=l.useState(""),[_,k]=l.useState([]);l.useEffect(()=>{(async()=>{const{restaurantService:n}=await m(async()=>{const{restaurantService:v}=await import("./chunk-1765892656551-restaurantService.js");return{restaurantService:v}},[]),c=n.getAllCuisines();k(c)})()},[]);const f=async()=>{if(!(!u.trim()&&!h&&!o)){x(!0),d([]);try{if(i==="usda"){const n=await(await m(async()=>{const{default:c}=await import("./chunk-1765892656551-usdaService.js");return{default:c}},[])).default.searchFoods(u,30);n.success&&d(n.foods)}else if(i==="foods"){const{barcodeScannerService:s}=await m(async()=>{const{barcodeScannerService:c}=await import("./chunk-1765892656404-barcodeScannerService.js");return{barcodeScannerService:c}},__vite__mapDeps([3,4,5,6])),n=await s.searchOpenFoodFactsByText(u,1);n.success&&d(n.foods)}else{const{restaurantService:s}=await m(async()=>{const{restaurantService:v}=await import("./chunk-1765892656551-restaurantService.js");return{restaurantService:v}},[]),n={};h&&(n.halalOnly=!0),o&&(n.cuisine=o);const c=s.searchMenuItems(u,null,n);d(c)}}catch{}finally{x(!1)}}},A=()=>{p(!1),S(""),y(""),d([])},t=async s=>{await(await m(()=>import("./entry-1765892656001-index.js").then(c=>c.y),__vite__mapDeps([4,5]))).default.logFood({name:s.name,calories:s.calories,protein:s.protein,carbs:s.carbs||s.carbohydrates,fat:s.fats||s.fat}),M("âœ… Food logged!","success")};return e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"15px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>g("usda"),style:{flex:"1 1 140px",padding:"12px",background:i==="usda"?"linear-gradient(135deg, #00c853 0%, #00e676 100%)":"#f0f0f0",color:i==="usda"?"white":"#333",border:"none",borderRadius:"8px",fontWeight:"bold",fontSize:"13px"},children:"ğŸ‡ºğŸ‡¸ USDA Official"}),e.jsx("button",{onClick:()=>g("foods"),style:{flex:"1 1 140px",padding:"12px",background:i==="foods"?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f0f0f0",color:i==="foods"?"white":"#333",border:"none",borderRadius:"8px",fontWeight:"bold",fontSize:"13px"},children:"ğŸŒ 6M Foods"}),e.jsx("button",{onClick:()=>g("restaurants"),style:{flex:"1 1 140px",padding:"12px",background:i==="restaurants"?"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)":"#f0f0f0",color:i==="restaurants"?"white":"#333",border:"none",borderRadius:"8px",fontWeight:"bold",fontSize:"13px"},children:"ğŸ” Restaurants"})]}),i==="restaurants"&&e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",flexWrap:"wrap"},children:[e.jsxs("button",{onClick:()=>p(!h),style:{padding:"8px 16px",background:h?"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)":"#f0f0f0",color:h?"white":"#333",border:"none",borderRadius:"6px",fontWeight:"bold",fontSize:"14px",cursor:"pointer"},children:["ğŸ•Œ Halal ",h?"âœ“":""]}),e.jsxs("select",{value:o,onChange:s=>S(s.target.value),style:{padding:"8px 12px",border:o?"2px solid #667eea":"2px solid #e0e0e0",borderRadius:"6px",fontSize:"14px",fontWeight:o?"bold":"normal",background:o?"linear-gradient(135deg, #fa709a 0%, #fee140 100%)":"white",color:o?"white":"#333",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"ğŸŒ All Cuisines"}),_.map(s=>e.jsx("option",{value:s,children:s},s))]}),(h||o)&&e.jsx("button",{onClick:A,style:{padding:"8px 16px",background:"#ff6b6b",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"bold",cursor:"pointer"},children:"âœ• Clear"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px"},children:[e.jsx("input",{type:"text",value:u,onChange:s=>y(s.target.value),onKeyPress:s=>s.key==="Enter"&&f(),placeholder:i==="usda"?"Search USDA database...":i==="foods"?"Search 6M+ foods...":"Search restaurants...",style:{flex:1,padding:"12px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px"}}),e.jsx("button",{onClick:f,disabled:a,style:{padding:"12px 24px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:a?"not-allowed":"pointer"},children:a?"â³":"ğŸ”"})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:r.length>0?e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:"14px",color:"#666",marginBottom:"10px"},children:["Found ",r.length," results"]}),r.map((s,n)=>e.jsxs("div",{style:{background:"white",padding:"12px",marginBottom:"10px",borderRadius:"8px",border:"2px solid #e0e0e0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 5px 0",color:"#333"},children:[i==="restaurants"&&`${s.restaurantLogo} `,s.name]}),i==="restaurants"&&e.jsx("p",{style:{margin:"0 0 5px 0",fontSize:"12px",color:"#888"},children:s.restaurantName}),s.brand&&e.jsx("p",{style:{margin:"0 0 5px 0",fontSize:"12px",color:"#888"},children:s.brand}),e.jsxs("p",{style:{margin:0,fontSize:"14px",color:"#666"},children:[s.calories," cal â€¢ ",s.protein,"g protein â€¢ ",s.carbs||s.carbohydrates||0,"g carbs â€¢ ",s.fats||s.fat||0,"g fat"]})]}),e.jsx("button",{onClick:()=>t(s),style:{padding:"8px 16px",background:"#4CAF50",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:"+ Log"})]},n))]}):u&&!a?e.jsx("p",{style:{textAlign:"center",color:"#888",padding:"20px"},children:"No results found. Try a different search."}):u?null:e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#888"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"10px"},children:i==="usda"?"ğŸ‡ºğŸ‡¸":i==="foods"?"ğŸ”":"ğŸ”"}),e.jsx("p",{children:i==="usda"?"Search 400K+ USDA verified foods":i==="foods"?"Search 6 million foods from OpenFoodFacts":"Search 50+ restaurants with 2,700+ items"})]})})]})}export{R as SearchFoods,B as default};
