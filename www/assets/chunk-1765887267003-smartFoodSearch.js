import h from"./chunk-1765887267147-usdaService.js";import{restaurantService as d}from"./chunk-1765887267147-restaurantService.js";import{barcodeScannerService as u}from"./chunk-1765887267018-barcodeScannerService.js";import"./entry-1765887266798-index.js";import"./chunk-1765887267003-index.js";class f{async searchAllDatabases(e,s={}){if(!e||e.trim().length<2)return[];const a=e.trim().toLowerCase(),r=[];try{const[t,o,i]=await Promise.all([this.searchUSDA(a),this.searchRestaurants(a,s),this.searchOpenFoodFacts(a,s)]);r.push(...t),r.push(...o),r.push(...i);const n=r.map(c=>({...c,relevanceScore:this.calculateRelevanceScore(c,a,s)}));return n.sort((c,l)=>l.relevanceScore-c.relevanceScore),n}catch{return r}}async searchUSDA(e){try{const s=await h.searchFoods(e,20);if(s.success&&s.foods)return s.foods.map(a=>({...a,source:"USDA",sourceBadge:"ðŸ‡ºðŸ‡¸",sourceColor:"#00c853"}))}catch{}return[]}async searchRestaurants(e,s={}){try{const a={};return s.halalOnly&&(a.halalOnly=!0),s.cuisine&&(a.cuisine=s.cuisine),d.searchMenuItems(e,null,a).map(t=>({...t,source:"Restaurant",sourceBadge:"ðŸ”",sourceColor:"#f093fb",restaurantInfo:{name:t.restaurantName,logo:t.restaurantLogo,cuisine:t.restaurantCuisine,isHalal:t.restaurantIsHalal}}))}catch{}return[]}async searchOpenFoodFacts(e,s={}){try{if(s.barcode){const r=await u.lookupFoodByBarcode(s.barcode);if(r.success&&r.food)return[{...r.food,source:"OpenFoodFacts",sourceBadge:"ðŸŒ",sourceColor:"#667eea",exactBarcodeMatch:!0}]}const a=await u.searchOpenFoodFactsByText(e,1);if(a.success&&a.foods)return a.foods.map(r=>({...r,source:"OpenFoodFacts",sourceBadge:"ðŸŒ",sourceColor:"#667eea"}))}catch{}return[]}calculateRelevanceScore(e,s,a={}){let r=0;const t=(e.name||"").toLowerCase(),o=s.split(" ").filter(c=>c.length>2);if(e.exactBarcodeMatch)return 200;if(t===s&&(r+=100),o.every(c=>t.includes(c)))r+=80;else{const c=o.filter(l=>t.includes(l));r+=c.length*15}const n=(e.brand||e.restaurantName||"").toLowerCase();return n&&o.some(c=>n.includes(c))&&(r+=20),e.source==="USDA"&&(r+=5),e.calories&&e.protein&&e.carbs&&e.fats&&(r+=10),a.halalOnly&&e.isHalal&&(r+=15),a.cuisine&&e.cuisine===a.cuisine&&(r+=12),t.startsWith(s)&&(r+=25),r}async getTopResults(e,s=10,a={}){return(await this.searchAllDatabases(e,a)).slice(0,s)}async searchByBarcode(e){const s=await u.lookupFoodByBarcode(e);if(s.success&&s.food){const a=s.food.name;return await this.searchAllDatabases(a,{barcode:e})}return[]}formatResults(e){return!e||e.length===0?{bestMatch:null,otherMatches:[],totalCount:0}:{bestMatch:e[0],otherMatches:e.slice(1),totalCount:e.length,sources:{usda:e.filter(s=>s.source==="USDA").length,restaurants:e.filter(s=>s.source==="Restaurant").length,openFoodFacts:e.filter(s=>s.source==="OpenFoodFacts").length}}}}const y=new f;export{y as default};
