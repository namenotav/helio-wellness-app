const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-1765759384482-smartFoodSearch.js","assets/chunk-1765759384710-usdaService.js","assets/chunk-1765759384710-restaurantService.js","assets/chunk-1765759384500-barcodeScannerService.js","assets/entry-1765759384261-index.js","assets/asset-1765759384970-index.css","assets/chunk-1765759384482-index.js"])))=>i.map(i=>d[i]);
import{r as o,a as I,j as e,s as S,_ as p,b as F}from"./entry-1765759384261-index.js";import{a as C}from"./chunk-1765759384484-aiVisionService.js";/* empty css                                */import"./chunk-1765759384482-index.js";function L({onClose:k}){const[r,g]=o.useState("food"),[f,x]=o.useState(!1),[a,u]=o.useState(null),[m,b]=o.useState(""),[d,v]=o.useState(null),[h,N]=o.useState(!1);o.useEffect(()=>{const s=I.getUserAllergenProfile();v(s||{allergens:[],intolerances:[],dietaryPreferences:[],allergenSeverity:{}})},[]);const j=async()=>{if(!S.checkLimit("foodScans").allowed){N(!0);return}b(""),u(null),x(!0);try{const t=await C.captureFoodPhoto();if(!t.success)throw new Error(t.error||"Failed to capture photo");if(r==="halal"){const y=await C.analyzeHalalStatus(t.imageData);if(!y.success)throw new Error(y.error||"Halal analysis failed");u({...y.analysis,imageData:t.imageData,scanMode:"halal"}),S.incrementUsage("foodScans");const M=S.checkLimit("foodScans");x(!1);return}const i=r==="food"?await C.analyzeFoodImage(t.imageData):await C.analyzeIngredientLabel(t.imageData);if(!i.success)throw new Error(i.error||"Analysis failed");const n=i.analysis.foodName||i.analysis.food,c=await(await p(async()=>{const{default:y}=await import("./chunk-1765759384482-smartFoodSearch.js");return{default:y}},__vite__mapDeps([0,1,2,3,4,5,6]))).default.searchAllDatabases(n);u({...i.analysis,imageData:t.imageData,databaseMatches:c,bestMatch:c.length>0?c[0]:null}),S.incrementUsage("foodScans");const w=S.checkLimit("foodScans");i.analysis.safetyLevel!=="danger"&&await I.logFood({name:i.analysis.foodName,ingredients:i.analysis.ingredients,allergens:i.analysis.detectedAllergens,safety:i.analysis.safetyLevel})}catch(t){let i=t.message||"Scanner error";i.includes("Server Error: 413")?i="âŒ Image too large. Try again with better lighting.":i.includes("API Error: 400")||i.includes("Server Error: 400")?i="âŒ Image format error. Please try again.":i.includes("API Error: 401")||i.includes("Server Error: 401")?i="âŒ Your API key was reported as leaked. Please use another API key.":i.includes("API Error: 429")||i.includes("Server Error: 429")?i="âŒ Too many requests. Please wait a moment.":i.includes("Invalid API response")?i="âŒ AI service error. Please try again.":i.includes("Empty response")?i="âŒ No analysis returned. Try a clearer photo.":i.includes("Failed to fetch")||i.includes("Network")?i="âŒ Network error. Check your internet connection.":i=`âŒ ${i}`,b(i)}finally{x(!1)}},A=async()=>{if(!a)return;const s={relatedFood:a.foodName,timestamp:new Date().toISOString(),severity:"mild"};await I.logSymptom(s),F("Symptom logged for AI learning","success")};return e.jsx("div",{className:"food-scanner-overlay",children:e.jsxs("div",{className:"food-scanner",children:[e.jsx("button",{className:"scanner-close",onClick:k,children:"âœ•"}),e.jsx("h2",{className:"scanner-title",children:"ğŸ” AI Food Scanner"}),(()=>{const s=window.subscriptionService;if(s){const t=s.checkLimit("foodScans");if(!s.hasAccess("foodScanner"))return e.jsx("div",{style:{marginBottom:"15px",padding:"10px 16px",background:t.remaining<=0?"rgba(255, 68, 68, 0.2)":"rgba(76, 175, 80, 0.2)",borderRadius:"20px",fontSize:"14px",color:t.remaining<=0?"#FF4444":"#4CAF50",fontWeight:"bold",border:`2px solid ${t.remaining<=0?"#FF4444":"rgba(76, 175, 80, 0.4)"}`,textAlign:"center"},children:t.remaining>0?e.jsxs(e.Fragment,{children:["ğŸ“¸ ",t.remaining,"/",t.limit," scans left today"]}):e.jsx(e.Fragment,{children:"ğŸ”’ Daily scans used - Upgrade for unlimited!"})})}return null})(),e.jsxs("div",{className:"scan-mode-toggle",children:[e.jsx("button",{className:`mode-btn ${r==="food"?"active":""}`,onClick:()=>g("food"),children:"ğŸ“¸ Scan Food"}),e.jsx("button",{className:`mode-btn ${r==="label"?"active":""}`,onClick:()=>g("label"),children:"ğŸ·ï¸ Scan Label"}),e.jsx("button",{className:`mode-btn ${r==="halal"?"active":""}`,onClick:()=>g("halal"),children:"ğŸ•Œ Halal Check"}),e.jsx("button",{className:`mode-btn ${r==="search"?"active":""}`,onClick:()=>g("search"),children:"ğŸ” Search 6M Foods"})]}),d&&d.allergens?.length>0&&e.jsxs("div",{className:"allergen-summary",children:[e.jsx("h3",{children:"Your Allergens:"}),e.jsx("div",{className:"allergen-badges",children:d.allergens.map((s,t)=>{const i=d.allergenSeverity?.[s]||"moderate";return e.jsx("span",{className:`allergen-badge ${i}`,children:s},t)})})]}),r==="search"&&!a&&e.jsx(_,{onClose:k}),!a&&r!=="search"&&e.jsx("button",{className:"scan-btn",onClick:j,disabled:f,"aria-label":"Start camera to scan food",children:f?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner",children:"â³"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:["ğŸ“· ",r==="food"?"Scan Food":r==="halal"?"Check Halal Status":"Scan Ingredient Label"]})}),m&&e.jsxs("div",{className:"scanner-error",children:["âŒ ",m]}),a&&r==="halal"&&a.halalStatus&&e.jsxs("div",{className:"halal-results",children:[e.jsx("div",{className:"result-image",children:e.jsx("img",{src:`data:image/jpeg;base64,${a.imageData}`,alt:"Scanned product"})}),e.jsxs("div",{className:`halal-verdict ${a.halalStatus}`,children:[a.halalStatus==="halal"&&"âœ… HALAL",a.halalStatus==="haram"&&"âŒ HARAM",a.halalStatus==="doubtful"&&"âš ï¸ DOUBTFUL (MUSHBOOH)",a.halalStatus==="uncertain"&&"â“ UNCERTAIN"]}),e.jsxs("div",{className:"halal-confidence",children:["Confidence: ",a.confidence,"%"]}),a.certifications&&a.certifications.length>0&&e.jsxs("div",{className:"halal-section",children:[e.jsx("h4",{children:"ğŸ… Certifications Found:"}),e.jsx("ul",{children:a.certifications.map((s,t)=>e.jsx("li",{className:"cert-item",children:s},t))})]}),a.haramIngredients&&a.haramIngredients.length>0&&e.jsxs("div",{className:"halal-section danger",children:[e.jsx("h4",{children:"ğŸš« Haram Ingredients:"}),e.jsx("ul",{children:a.haramIngredients.map((s,t)=>e.jsx("li",{className:"haram-item",children:s},t))})]}),a.doubtfulIngredients&&a.doubtfulIngredients.length>0&&e.jsxs("div",{className:"halal-section warning",children:[e.jsx("h4",{children:"âš ï¸ Doubtful Ingredients:"}),e.jsx("ul",{children:a.doubtfulIngredients.map((s,t)=>e.jsx("li",{className:"doubtful-item",children:s},t))})]}),a.eCodes&&a.eCodes.length>0&&e.jsxs("div",{className:"halal-section",children:[e.jsx("h4",{children:"ğŸ”¢ E-Codes Found:"}),e.jsx("ul",{children:a.eCodes.map((s,t)=>e.jsx("li",{className:"ecode-item",children:s},t))})]}),a.crossContamination&&e.jsxs("div",{className:"halal-section",children:[e.jsx("h4",{children:"âš—ï¸ Cross-Contamination:"}),e.jsx("p",{children:a.crossContamination})]}),a.recommendation&&e.jsxs("div",{className:"halal-section recommendation",children:[e.jsx("h4",{children:"ğŸ’¡ Recommendation:"}),e.jsx("p",{children:a.recommendation})]}),a.details&&e.jsxs("div",{className:"halal-section details",children:[e.jsx("h4",{children:"ğŸ“‹ Detailed Analysis:"}),e.jsx("p",{children:a.details})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("button",{className:"action-btn",onClick:j,children:"ğŸ“· Scan Another Product"}),e.jsx("button",{className:"action-btn secondary",onClick:()=>u(null),children:"â† Back"})]})]}),a&&r!=="halal"&&e.jsxs("div",{className:"scan-results",children:[e.jsx("div",{className:"result-image",children:e.jsx("img",{src:`data:image/jpeg;base64,${a.imageData}`,alt:"Scanned food"})}),e.jsxs("div",{className:`safety-banner ${a.safetyLevel}`,style:{backgroundColor:a.safetyColor},children:[e.jsx("span",{className:"safety-icon",children:a.safetyIcon}),e.jsx("span",{className:"safety-text",children:a.safetyMessage})]}),e.jsx("h3",{className:"food-name",children:a.foodName}),a.databaseMatches&&a.databaseMatches.length>0&&e.jsxs("div",{style:{background:"#f0f9ff",padding:"15px",borderRadius:"12px",marginBottom:"15px"},children:[e.jsxs("h4",{style:{margin:"0 0 10px 0",fontSize:"14px",color:"#0284c7"},children:["ğŸ” Found ",a.databaseMatches.length," matches in databases"]}),a.bestMatch&&e.jsxs("div",{style:{background:"white",padding:"12px",borderRadius:"8px",marginBottom:"10px",border:"2px solid #0284c7"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:a.bestMatch.sourceBadge}),e.jsx("strong",{style:{fontSize:"15px"},children:a.bestMatch.name}),e.jsx("span",{style:{marginLeft:"auto",fontSize:"11px",padding:"3px 8px",background:"#dcfce7",color:"#166534",borderRadius:"12px",fontWeight:"bold"},children:"BEST MATCH"})]}),e.jsxs("div",{style:{fontSize:"13px",color:"#666"},children:[e.jsx("strong",{children:a.bestMatch.calories})," cal |",e.jsx("strong",{children:" P:"})," ",a.bestMatch.protein,"g |",e.jsx("strong",{children:" C:"})," ",a.bestMatch.carbs||a.bestMatch.carbohydrates,"g |",e.jsx("strong",{children:" F:"})," ",a.bestMatch.fat||a.bestMatch.fats,"g"]}),e.jsx("div",{style:{fontSize:"11px",color:"#999",marginTop:"4px"},children:a.bestMatch.brand||a.bestMatch.restaurantName||a.bestMatch.source})]}),a.databaseMatches.length>1&&e.jsxs("details",{style:{fontSize:"13px"},children:[e.jsxs("summary",{style:{cursor:"pointer",color:"#0284c7",fontWeight:"bold"},children:["View all ",a.databaseMatches.length," options â†’"]}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",marginTop:"10px"},children:a.databaseMatches.slice(1,6).map((s,t)=>e.jsxs("div",{style:{background:"white",padding:"8px",marginBottom:"6px",borderRadius:"6px",fontSize:"12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:s.sourceBadge}),e.jsx("strong",{children:s.name})]}),e.jsxs("div",{style:{color:"#666",fontSize:"11px",marginTop:"2px"},children:[s.calories," cal | P: ",s.protein,"g | C: ",s.carbs||s.carbohydrates,"g | F: ",s.fat||s.fats,"g"]})]},t))})]})]}),a.detectedAllergens&&a.detectedAllergens.length>0&&e.jsxs("div",{className:"detected-allergens",children:[e.jsx("h4",{children:"âš ï¸ Detected Allergens:"}),e.jsx("ul",{children:a.detectedAllergens.map((s,t)=>e.jsxs("li",{className:"allergen-item",children:[e.jsx("strong",{children:s.name}),s.location&&` - Found in: ${s.location}`,e.jsxs("span",{className:`confidence ${s.confidence}`,children:[s.confidence," confidence"]})]},t))})]}),a.ingredients&&a.ingredients.length>0&&e.jsxs("div",{className:"ingredients-list",children:[e.jsx("h4",{children:"ğŸ“‹ Ingredients:"}),e.jsx("div",{className:"ingredient-chips",children:a.ingredients.map((s,t)=>e.jsx("span",{className:"ingredient-chip",children:s},t))})]}),a.hiddenIngredients&&a.hiddenIngredients.length>0&&e.jsxs("div",{className:"hidden-ingredients",children:[e.jsx("h4",{children:"ğŸ” Likely Hidden Ingredients:"}),e.jsx("ul",{children:a.hiddenIngredients.map((s,t)=>e.jsx("li",{children:s},t))})]}),a.alternatives&&a.alternatives.length>0&&e.jsxs("div",{className:"alternatives",children:[e.jsx("h4",{children:"ğŸ’¡ Make It Safe:"}),e.jsx("ul",{children:a.alternatives.map((s,t)=>e.jsx("li",{children:s},t))})]}),e.jsxs("div",{className:"confidence-bar",children:[e.jsx("span",{children:"AI Confidence:"}),e.jsx("div",{className:"bar",children:e.jsx("div",{className:"fill",style:{width:`${a.confidence}%`}})}),e.jsxs("span",{children:[a.confidence,"%"]})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("button",{className:"action-btn",onClick:j,children:"ğŸ“· Scan Again"}),e.jsx("button",{className:"action-btn secondary",onClick:A,children:"ğŸ“ Log Reaction"}),e.jsx("button",{className:"action-btn secondary",onClick:()=>u(null),children:"â† Back"})]})]}),r!=="search"&&e.jsx("div",{className:"scanner-info",children:e.jsx("p",{children:r==="food"?"ğŸ“¸ Point camera at any food to identify ingredients and check allergens":r==="halal"?"ğŸ•Œ Scan product labels for comprehensive Islamic dietary compliance verification":"ğŸ·ï¸ Scan ingredient labels to extract and analyze all contents"})})]})})}function _({onClose:k}){const[r,g]=o.useState(""),[f,x]=o.useState([]),[a,u]=o.useState("usda"),[m,b]=o.useState(!1),[d,v]=o.useState(!1),[h,N]=o.useState(""),[j,A]=o.useState([]);o.useEffect(()=>{(async()=>{const{restaurantService:l}=await p(async()=>{const{restaurantService:w}=await import("./chunk-1765759384710-restaurantService.js");return{restaurantService:w}},[]),c=l.getAllCuisines();A(c)})()},[]);const s=async()=>{if(!(!r.trim()&&!d&&!h)){b(!0),x([]);try{if(a==="usda"){const l=await(await p(async()=>{const{default:c}=await import("./chunk-1765759384710-usdaService.js");return{default:c}},[])).default.searchFoods(r,30);l.success&&x(l.foods)}else if(a==="foods"){const{barcodeScannerService:n}=await p(async()=>{const{barcodeScannerService:c}=await import("./chunk-1765759384500-barcodeScannerService.js");return{barcodeScannerService:c}},__vite__mapDeps([3,4,5,6])),l=await n.searchOpenFoodFactsByText(r,1);l.success&&x(l.foods)}else{const{restaurantService:n}=await p(async()=>{const{restaurantService:w}=await import("./chunk-1765759384710-restaurantService.js");return{restaurantService:w}},[]),l={};d&&(l.halalOnly=!0),h&&(l.cuisine=h);const c=n.searchMenuItems(r,null,l);x(c)}}catch{}finally{b(!1)}}},t=()=>{v(!1),N(""),g(""),x([])},i=async n=>{await(await p(()=>import("./entry-1765759384261-index.js").then(c=>c.y),__vite__mapDeps([4,5]))).default.logFood({name:n.name,calories:n.calories,protein:n.protein,carbs:n.carbs||n.carbohydrates,fat:n.fats||n.fat}),F("âœ… Food logged!","success")};return e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"15px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>u("usda"),style:{flex:"1 1 140px",padding:"12px",background:a==="usda"?"linear-gradient(135deg, #00c853 0%, #00e676 100%)":"#f0f0f0",color:a==="usda"?"white":"#333",border:"none",borderRadius:"8px",fontWeight:"bold",fontSize:"13px"},children:"ğŸ‡ºğŸ‡¸ USDA Official"}),e.jsx("button",{onClick:()=>u("foods"),style:{flex:"1 1 140px",padding:"12px",background:a==="foods"?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#f0f0f0",color:a==="foods"?"white":"#333",border:"none",borderRadius:"8px",fontWeight:"bold",fontSize:"13px"},children:"ğŸŒ 6M Foods"}),e.jsx("button",{onClick:()=>u("restaurants"),style:{flex:"1 1 140px",padding:"12px",background:a==="restaurants"?"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)":"#f0f0f0",color:a==="restaurants"?"white":"#333",border:"none",borderRadius:"8px",fontWeight:"bold",fontSize:"13px"},children:"ğŸ” Restaurants"})]}),a==="restaurants"&&e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",flexWrap:"wrap"},children:[e.jsxs("button",{onClick:()=>v(!d),style:{padding:"8px 16px",background:d?"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)":"#f0f0f0",color:d?"white":"#333",border:"none",borderRadius:"6px",fontWeight:"bold",fontSize:"14px",cursor:"pointer"},children:["ğŸ•Œ Halal ",d?"âœ“":""]}),e.jsxs("select",{value:h,onChange:n=>N(n.target.value),style:{padding:"8px 12px",border:h?"2px solid #667eea":"2px solid #e0e0e0",borderRadius:"6px",fontSize:"14px",fontWeight:h?"bold":"normal",background:h?"linear-gradient(135deg, #fa709a 0%, #fee140 100%)":"white",color:h?"white":"#333",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"ğŸŒ All Cuisines"}),j.map(n=>e.jsx("option",{value:n,children:n},n))]}),(d||h)&&e.jsx("button",{onClick:t,style:{padding:"8px 16px",background:"#ff6b6b",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"bold",cursor:"pointer"},children:"âœ• Clear"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px"},children:[e.jsx("input",{type:"text",value:r,onChange:n=>g(n.target.value),onKeyPress:n=>n.key==="Enter"&&s(),placeholder:a==="usda"?"Search USDA database...":a==="foods"?"Search 6M+ foods...":"Search restaurants...",style:{flex:1,padding:"12px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px"}}),e.jsx("button",{onClick:s,disabled:m,style:{padding:"12px 24px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",fontWeight:"bold",cursor:m?"not-allowed":"pointer"},children:m?"â³":"ğŸ”"})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:f.length>0?e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:"14px",color:"#666",marginBottom:"10px"},children:["Found ",f.length," results"]}),f.map((n,l)=>e.jsxs("div",{style:{background:"white",padding:"12px",marginBottom:"10px",borderRadius:"8px",border:"2px solid #e0e0e0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 5px 0",color:"#333"},children:[a==="restaurants"&&`${n.restaurantLogo} `,n.name]}),a==="restaurants"&&e.jsx("p",{style:{margin:"0 0 5px 0",fontSize:"12px",color:"#888"},children:n.restaurantName}),n.brand&&e.jsx("p",{style:{margin:"0 0 5px 0",fontSize:"12px",color:"#888"},children:n.brand}),e.jsxs("p",{style:{margin:0,fontSize:"14px",color:"#666"},children:[n.calories," cal â€¢ ",n.protein,"g protein â€¢ ",n.carbs||n.carbohydrates||0,"g carbs â€¢ ",n.fats||n.fat||0,"g fat"]})]}),e.jsx("button",{onClick:()=>i(n),style:{padding:"8px 16px",background:"#4CAF50",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:"+ Log"})]},l))]}):r&&!m?e.jsx("p",{style:{textAlign:"center",color:"#888",padding:"20px"},children:"No results found. Try a different search."}):r?null:e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#888"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"10px"},children:a==="usda"?"ğŸ‡ºğŸ‡¸":a==="foods"?"ğŸ”":"ğŸ”"}),e.jsx("p",{children:a==="usda"?"Search 400K+ USDA verified foods":a==="foods"?"Search 6 million foods from OpenFoodFacts":"Search 50+ restaurants with 2,700+ items"})]})})]})}export{_ as SearchFoods,L as default};
