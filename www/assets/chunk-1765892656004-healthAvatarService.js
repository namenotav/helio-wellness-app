const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/entry-1765892656001-index.js","assets/asset-1765892656785-index.css"])))=>i.map(i=>d[i]);
import{_ as H,f as D,a as u}from"./entry-1765892656001-index.js";class q{constructor(){this.avatarState=null,this.cachedState=null,this.cacheTimestamp=0,this.cacheValidDuration=0}async calculateHealthScore(s,c={}){const{age:n,weight:g,height:h,goalSteps:I}=s||{},{totalSteps:j=0,totalDays:J=0}=c;let a=100;const i=[],r=[];if(h&&g&&h>=100&&h<=250&&g>=30&&g<=300){const t=h/100,e=g/(t*t);isNaN(e)||!isFinite(e)?i.push("âš ï¸ BMI calculation error - check profile data"):e<18.5?(a-=15,i.push("âš ï¸ BMI too low"),r.push({factor:"BMI (Underweight)",points:-15,icon:"âš ï¸"})):e>25&&e<30?(a-=10,i.push("âš ï¸ Overweight BMI"),r.push({factor:"BMI (Overweight)",points:-10,icon:"âš ï¸"})):e>=30?(a-=25,i.push("ğŸš¨ Obese BMI"),r.push({factor:"BMI (Obese)",points:-25,icon:"ğŸš¨"})):(i.push("âœ… Healthy BMI"),r.push({factor:"BMI (Healthy)",points:0,icon:"âœ…"}))}else i.push("âš ï¸ BMI unavailable - complete profile");(await H(async()=>{const{default:t}=await import("./entry-1765892656001-index.js").then(e=>e.w);return{default:t}},__vite__mapDeps([0,1]))).default;let L=0;try{const{Preferences:t}=await H(async()=>{const{Preferences:o}=await import("./entry-1765892656001-index.js").then(l=>l.v);return{Preferences:o}},__vite__mapDeps([0,1])),{value:e}=await t.get({key:"wellnessai_stepHistory"});if(e){const o=JSON.parse(e),l=new Date().toISOString().split("T")[0];L=o.find(x=>x.date===l)?.steps||0,console.log("ğŸ§¬ Health Avatar: Today steps from Android storage:",L)}}catch(t){console.warn("âš ï¸ Could not read today steps from Android storage:",t)}let p=await D.get("stepHistory",u.getCurrentUser()?.uid);if(!p||typeof p=="string")try{p=JSON.parse(localStorage.getItem("stepHistory")||"[]")}catch(t){console.warn("âš ï¸ Could not parse stepHistory from localStorage:",t),p=[]}const R=[...Array.isArray(p)?p:[]];if(L>0){const t=new Date().toISOString().split("T")[0],e=R.findIndex(o=>o.date===t);e>=0?R[e]={date:t,steps:L}:R.push({date:t,steps:L})}const _=R.slice(-30),b=_.reduce((t,e)=>t+(e?.steps||e||0),0),d=_.length>0?b/_.length:0,M=I||1e4,E=_.filter(t=>(t?.steps||t||0)>4e4).length;E>0&&i.push(`âš ï¸ ${E} days with suspicious step counts (>40k)`),d<M*.5?(a-=20,i.push("ğŸš¨ Very low activity"),r.push({factor:"Daily Steps",points:-20,icon:"ğŸš¨"})):d<M*.8?(a-=10,i.push("âš ï¸ Below step goal"),r.push({factor:"Daily Steps",points:-10,icon:"âš ï¸"})):d>=M?(a+=5,i.push("âœ… Meeting step goal"),r.push({factor:"Daily Steps",points:5,icon:"âœ…"})):r.push({factor:"Daily Steps",points:0,icon:"ğŸ“Š"});let m=[];try{let t=await D.get("foodLog",u.getCurrentUser()?.uid);if(!t||typeof t=="string"){const e=localStorage.getItem("foodLog");t=e?JSON.parse(e):[]}m=Array.isArray(t)?t:[]}catch{m=[]}const T=720*60*60*1e3,C=m.filter(t=>{try{return new Date(t.timestamp||t.date).getTime()>=Date.now()-T}catch{return!1}});C.filter(t=>t&&t.safety==="danger").length;const O=C.filter(t=>t&&t.safety==="warning").length,F=C.filter(t=>t&&t.safety==="safe").length,w=s.allergies||[],U=C.filter(t=>!t||t.safety!=="danger"||w.length===0?!1:t.allergens?.some(e=>w.includes(e))).length,N=U*5+O*2;a-=N,U>5&&i.push("ğŸš¨ Too many allergen exposures"),F>30?(a+=5,i.push("âœ… Good diet choices"),r.push({factor:"Food Quality",points:5-N,icon:"ğŸ½ï¸"})):N>0?r.push({factor:"Food Quality",points:-N,icon:"âš ï¸"}):r.push({factor:"Food Quality",points:0,icon:"ğŸ½ï¸"});let k=[];try{let t=await D.get("workoutHistory",u.getCurrentUser()?.uid);if(!t||typeof t=="string"){const e=localStorage.getItem("workoutHistory");t=e?JSON.parse(e):[]}k=Array.isArray(t)?t:[]}catch{k=[]}const f=k.filter(t=>new Date(t.timestamp||t.date).getTime()>=Date.now()-T);f.length>=12?(a+=10,i.push("âœ… Excellent workout routine"),r.push({factor:"Workouts",points:10,icon:"ğŸ’ª"})):f.length>=8?(a+=5,i.push("âœ… Good workout consistency"),r.push({factor:"Workouts",points:5,icon:"ğŸ’ª"})):f.length<4?(a-=10,i.push("âš ï¸ Low workout frequency"),r.push({factor:"Workouts",points:-10,icon:"âš ï¸"})):r.push({factor:"Workouts",points:0,icon:"ğŸ’ª"});let y=[];try{let t=await D.get("loginHistory",u.getCurrentUser()?.uid);if(!t||typeof t=="string"){const e=localStorage.getItem("loginHistory");t=e?JSON.parse(e):[]}y=Array.isArray(t)?t:[]}catch{y=[]}const V=y.filter(t=>new Date(t.timestamp||t.date).getTime()>=Date.now()-T),$=new Set(V.map(t=>new Date(t.timestamp||t.date).toDateString())).size;$>=20?(a+=5,i.push("âœ… Very engaged with health tracking"),r.push({factor:"Engagement",points:5,icon:"ğŸ“±"})):$<10?(a-=5,i.push("âš ï¸ Low engagement"),r.push({factor:"Engagement",points:-5,icon:"âš ï¸"})):r.push({factor:"Engagement",points:0,icon:"ğŸ“±"});let B=null;try{let t=await D.get("dnaAnalysis",u.getCurrentUser()?.uid);if(!t||typeof t=="string"||!t.traits){try{const{value:e}=await(await H(async()=>{const{Preferences:o}=await import("./entry-1765892656001-index.js").then(l=>l.v);return{Preferences:o}},__vite__mapDeps([0,1]))).Preferences.get({key:"dna_genetic_data"});e&&(t=JSON.parse(e))}catch{}if(!t||typeof t=="string"){const e=localStorage.getItem("dnaAnalysis");if(e)try{t=JSON.parse(e)}catch{try{const{default:l}=await H(async()=>{const{default:x}=await import("./chunk-1765892656003-encryptionService.js");return{default:x}},[]),S=await l.decrypt(e);t=JSON.parse(S)}catch{t=null}}}}B=t}catch{B=null}if(B){const t=B.traits||[];if(t.length>0){const e=t.filter(l=>l.risk==="high").length,o=t.filter(l=>l.risk==="medium").length;a-=e*3,a-=o*1,e>0&&i.push(`ğŸ§¬ ${e} high genetic risks`)}}let Y=[];try{let t=await D.get("sleepLog",u.getCurrentUser()?.uid);if(!t||typeof t=="string"){const e=localStorage.getItem("sleepLog");t=e?JSON.parse(e):[]}Y=Array.isArray(t)?t:[]}catch{Y=[]}const v=Y.filter(t=>new Date(t.date).getTime()>=Date.now()-T);let A=null;if(v.length>0&&(A=v.reduce((t,e)=>t+e.hours,0)/v.length),A===null?(a-=10,i.push("âš ï¸ No sleep data tracked")):A<6?(a-=15,i.push("ğŸš¨ Severe sleep deprivation")):A<7?(a-=8,i.push("âš ï¸ Insufficient sleep")):A>=7&&A<=9&&(a+=5,i.push("âœ… Good sleep duration")),s.medicalConditions&&s.medicalConditions.length>0){const t=["diabetes","heart-disease","hypertension"];s.medicalConditions.some(o=>t.includes(o))?(a-=15,i.push("ğŸš¨ Severe medical condition")):(a-=s.medicalConditions.length*3,i.push(`âš ï¸ ${s.medicalConditions.length} medical conditions`))}return s.smoker&&(a-=20,i.push("ğŸš¨ Smoker")),(s.alcoholFrequency==="daily"||s.alcoholFrequency==="regular")&&(a-=10,i.push("âš ï¸ Regular alcohol consumption")),s.stressLevel==="very-high"?(a-=12,i.push("ğŸš¨ Very high stress")):s.stressLevel==="high"&&(a-=6,i.push("âš ï¸ High stress")),s.waterIntake==="low"?(a-=5,i.push("âš ï¸ Low water intake")):s.waterIntake==="excellent"&&(a+=3,i.push("âœ… Excellent hydration")),s.familyHistory&&s.familyHistory.length>0&&(a-=s.familyHistory.length*2,i.push(`ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ${s.familyHistory.length} family history risks`)),s.fitnessLevel==="athlete"||s.fitnessLevel==="very-active"?(a+=10,i.push("âœ… Excellent fitness level")):s.fitnessLevel==="sedentary"&&(a-=8,i.push("âš ï¸ Sedentary lifestyle")),{score:Math.max(0,Math.min(100,a)),breakdown:r,factors:i}}projectFutureHealth(s,c){let n=0;s>=80?n=2:s>=60?n=5:n=10;const g=Math.max(0,s-n*c);return{score:g,ageAppearance:this.calculateAgeAppearance(g,c),warnings:this.generateWarnings(g),improvements:this.generateImprovements(s,g)}}calculateAgeAppearance(s,c){const g=(u.getCurrentUser()?.profile?.age||30)+c;let h=0;return s<40?h=15:s<60?h=8:s>85&&(h=-5),g+h}generateWarnings(s){const c=[];return s<30?(c.push("ğŸš¨ Critical: High risk of chronic disease"),c.push("âš ï¸ Energy levels will be severely impacted"),c.push("ğŸ’” Heart health at serious risk")):s<50?(c.push("âš ï¸ Moderate health decline expected"),c.push("ğŸ˜“ Energy and mood will decrease"),c.push("ğŸ“‰ Fitness levels declining")):s<70&&(c.push("âš¡ Room for improvement"),c.push("ğŸ¯ Could optimize health further")),c}generateImprovements(s,c){const n=[];return c<s&&(n.push("ğŸ’ª Increase daily activity by 3000 steps"),n.push("ğŸ¥— Add 2 more servings of vegetables daily"),n.push("ğŸ’¤ Get 30 minutes more sleep each night"),n.push("ğŸ§˜ Practice 10 minutes of meditation")),n}getAvatarVisuals(s){return{skinTone:s>70?"#FFD4A3":s>50?"#E8C4A0":"#D4B898",energyLevel:s>70?"high":s>50?"medium":"low",muscleTone:s>75?"toned":s>50?"average":"low",posture:s>70?"upright":s>50?"slight-slouch":"slouched",eyeBrightness:s>75?"bright":s>50?"average":"dull",hairQuality:s>70?"shiny":s>50?"average":"dull",glowEffect:s>80?"strong":s>60?"subtle":"none",overallMood:s>75?"ğŸ˜Š":s>50?"ğŸ˜":"ğŸ˜”"}}async getAvatarState(s=!1){const c=Date.now();if(!s&&this.cachedState&&c-this.cacheTimestamp<this.cacheValidDuration)return this.cachedState;const n=u.getCurrentUser();if(!n)return null;const g=new Date,h=g.getMonth(),I=g.getFullYear(),j=g.toLocaleString("en-US",{month:"long"}),J=await this.calculateHealthScore(n.profile,n.stats),a=J.score,i=J.breakdown;J.factors,(await H(async()=>{const{default:e}=await import("./entry-1765892656001-index.js").then(o=>o.w);return{default:e}},__vite__mapDeps([0,1]))).default;let r=0;const L=new Date().toISOString().split("T")[0];let p=null;try{const{Preferences:e}=await H(async()=>{const{Preferences:l}=await import("./entry-1765892656001-index.js").then(S=>S.v);return{Preferences:l}},__vite__mapDeps([0,1])),{value:o}=await e.get({key:"wellnessai_stepHistory"});o&&(p=JSON.parse(o),console.log("ğŸ§¬ Health Avatar loaded from Android CapacitorStorage:",p?.length,"entries"))}catch(e){console.warn("âš ï¸ Could not read from Android CapacitorStorage:",e)}if(p||(p=await D.get("stepHistory",u.getCurrentUser()?.uid),p&&console.log("ğŸ§¬ Fallback to Firestore stepHistory:",p?.length,"entries")),!p||typeof p=="string")try{p=JSON.parse(localStorage.getItem("stepHistory")||"[]"),console.log("ğŸ§¬ Fallback to localStorage stepHistory:",p?.length,"entries")}catch(e){console.warn("âš ï¸ Could not parse stepHistory from localStorage:",e),p=[]}const W=Array.isArray(p)?p:[];r=W.find(e=>e.date===L)?.steps||0,console.log("ğŸ§¬ Health Avatar: Today steps from history:",r);let _=[];try{let e=n.profile?.foodLog||await D.get("foodLog",u.getCurrentUser()?.uid);if(!e||typeof e=="string"){const o=localStorage.getItem("foodLog");e=o?JSON.parse(o):[]}_=Array.isArray(e)?e:[]}catch(e){console.warn("âš ï¸ Could not load foodLog:",e),_=[]}let b=[];try{let e=await D.get("workoutHistory",u.getCurrentUser()?.uid);if(!e||typeof e=="string"){const o=localStorage.getItem("workoutHistory");e=o?JSON.parse(o):[]}b=Array.isArray(e)?e:[]}catch(e){console.warn("âš ï¸ Could not load workoutHistory:",e),b=[]}let d=null;try{let e=await D.get("dnaAnalysis",u.getCurrentUser()?.uid);if(!e||typeof e=="string"||!e.traits){try{const{value:o}=await(await H(async()=>{const{Preferences:l}=await import("./entry-1765892656001-index.js").then(S=>S.v);return{Preferences:l}},__vite__mapDeps([0,1]))).Preferences.get({key:"dna_genetic_data"});o&&(e=JSON.parse(o))}catch{}if(!e||typeof e=="string"){const o=localStorage.getItem("dnaAnalysis");if(o)try{e=JSON.parse(o)}catch{try{const{default:S}=await H(async()=>{const{default:Q}=await import("./chunk-1765892656003-encryptionService.js");return{default:Q}},[]),x=await S.decrypt(o);e=JSON.parse(x)}catch{e=null}}}}d=e}catch(e){console.warn("âš ï¸ Could not load dnaAnalysis:",e),d=null}let M=[];try{let e=await D.get("sleepLog",u.getCurrentUser()?.uid);if(!e||typeof e=="string"){const o=localStorage.getItem("sleepLog");e=o?JSON.parse(o):[]}M=Array.isArray(e)?e:[]}catch(e){console.warn("âš ï¸ Could not load sleepLog:",e),M=[]}const E=M.filter(e=>{const o=new Date(e.timestamp||e.date);return o.getMonth()===h&&o.getFullYear()===I}),m=W.filter(e=>{const o=new Date(e.date);return o.getMonth()===h&&o.getFullYear()===I});console.log("ğŸ§¬ Current month steps ("+j+"):",m);const T=m.reduce((e,o)=>{const l=typeof o=="object"?o?.steps:o,S=typeof l=="number"&&!isNaN(l)?l:0;return e+S},0),C=m.length>0?T/m.length:0,O=_.filter(e=>{const o=new Date(e.timestamp||e.date);return o.getMonth()===h&&o.getFullYear()===I}),F=b.filter(e=>{const o=new Date(e.timestamp||e.date);return o.getMonth()===h&&o.getFullYear()===I});let w=0,U=7;n.profile.height&&n.profile.weight&&n.profile.height>=100&&n.profile.weight>=30&&w++,m.length>=5&&w++,O.length>=5&&w++,F.length>=2&&w++,E.length>=5&&w++,d&&(d.traits||d.analysis)&&w++,(n.profile.medicalConditions||n.profile.fitnessLevel)&&w++;const N=Math.round(w/U*100),k=[],{height:f,weight:y}=n.profile;if(f&&y&&f>=100&&f<=250&&y>=30&&y<=300){const e=y/(f/100)**2;e<16?k.push({severity:"critical",icon:"ğŸš¨",title:"Severely Underweight BMI",message:"Your BMI is dangerously low. Consult a doctor immediately.",action:"See healthcare provider urgently"}):e>40&&k.push({severity:"critical",icon:"ğŸš¨",title:"Severely Obese BMI",message:"Your BMI is at a dangerous level. Medical consultation recommended.",action:"Consult doctor for weight management"})}const V=W.slice(-7),$=V.reduce((e,o)=>e+(o?.steps||o||0),0);if(V.length>=7&&$===0&&k.push({severity:"warning",icon:"âš ï¸",title:"No Activity Detected",message:"No steps recorded for 7 days. Are you okay?",action:"Check in with support or start light activity"}),E.slice(-7).filter(e=>e.hours<3).length>=5&&k.push({severity:"critical",icon:"ğŸš¨",title:"Severe Sleep Deprivation",message:"Less than 3 hours sleep for multiple nights is a health emergency.",action:"Seek medical help immediately"}),n.profile.lastWeightCheck&&n.profile.weight){const e=Math.abs(n.profile.weight-n.profile.lastWeightCheck);e>9&&k.push({severity:"warning",icon:"âš ï¸",title:"Suspicious Weight Change",message:`Weight changed by ${e.toFixed(1)} kg recently. Please verify measurement.`,action:"Re-check weight or consult doctor if accurate"})}const v=[];if(E.length<5&&v.push({icon:"ğŸ˜´",action:"Track sleep for 5 nights",impact:"+10 points",reason:"Currently missing sleep data"}),O.length<30){const e=Math.min(30-O.length,10);v.push({icon:"ğŸ½ï¸",action:`Log ${e} more healthy meals`,impact:`+${Math.min(e*2,10)} points`,reason:"Good diet boosts health score"})}if(F.length<8){const e=8-F.length;v.push({icon:"ğŸ’ª",action:`Add ${e} more workouts this month`,impact:"+5 to +10 points",reason:"Consistency is key to fitness"})}if(f&&y&&f>=100&&y>=30){const e=y/(f/100)**2;if(e>25&&e<30){const o=25*(f/100)**2,l=y-o;v.push({icon:"âš–ï¸",action:`Lose ${l.toFixed(1)} kg to reach healthy BMI`,impact:"+10 points",reason:`Current BMI: ${e.toFixed(1)} (overweight)`})}else e>=30&&v.push({icon:"âš–ï¸",action:"Work on weight management with doctor",impact:"+25 points",reason:`Current BMI: ${e.toFixed(1)} (obese)`})}const A=n.profile?.goalSteps||1e4;if(C<A){const e=Math.round(A-C);v.push({icon:"ğŸ‘Ÿ",action:`Increase daily steps by ${e.toLocaleString()}`,impact:"+5 to +20 points",reason:"Currently below step goal"})}const G=v.slice(0,3),t={current:{score:a,scoreBreakdown:i,emergencyWarnings:k,suggestions:G,visuals:this.getAvatarVisuals(a),age:n.profile.age||30,dataCompleteness:N,dataBreakdown:{monthName:j,currentYear:I,stepsDays:m.length,todaySteps:r,avgDailySteps:Math.round(C),totalMonthlySteps:Math.round(T),stepHistory:m,foodLogsCount:O.length,workoutsCount:F.length,hasDNAAnalysis:!!(d&&(d.traits||d.analysis)),sleepLogsCount:E.length}},future1Year:this.projectFutureHealth(a,1),future5Years:this.projectFutureHealth(a,5),future10Years:this.projectFutureHealth(a,10)};return this.cachedState=t,this.cacheTimestamp=g,t}getCachedState(){const s=Date.now();return this.cachedState&&s-this.cacheTimestamp<this.cacheValidDuration?this.cachedState:null}clearCache(){this.cachedState=null,this.cacheTimestamp=0}simulateChoice(s,c){return{"fast-food":{score:-5,message:"Avatar looks tired, skin duller"},"healthy-meal":{score:3,message:"Avatar glows, more energetic"},exercise:{score:5,message:"Avatar becomes more toned"},"skipped-workout":{score:-3,message:"Avatar loses muscle tone"},"good-sleep":{score:4,message:"Avatar looks refreshed"},"poor-sleep":{score:-4,message:"Avatar has dark circles"}}[s]||{score:0,message:"No change"}}}const P=new q;export{P as default,P as healthAvatarService};
