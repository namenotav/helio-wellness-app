const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/entry-1765759384261-index.js","assets/asset-1765759384970-index.css","assets/chunk-1765759384708-battleNotificationsService.js"])))=>i.map(i=>d[i]);
import{r as l,g as D,j as e,_ as F}from"./entry-1765759384261-index.js";import{socialBattlesService as c}from"./chunk-1765759384264-socialBattlesService.js";import"./chunk-1765759384264-healthAvatarService.js";function se({onClose:L}){const[n,o]=l.useState("list"),[j,S]=l.useState([]),[m,k]=l.useState(null),[C,P]=l.useState(null),[b,R]=l.useState(null),[I,f]=l.useState([]),[i,g]=l.useState("totalXP"),[_,B]=l.useState([]),[d,N]=l.useState(null),[$,y]=l.useState([]),[w,A]=l.useState({current:0,multiplier:1}),[Y,E]=l.useState([]),[r,x]=l.useState({duration:30,goal:"steps",target:3e5,stakes:"bragging-rights",stakeAmount:0,battleType:"solo"});l.useEffect(()=>{try{p(),T(),v(),W(),H(),U(),M();const s=setInterval(async()=>{try{await c.autoSyncAllBattles(),p()}catch{}},6e4);return()=>clearInterval(s)}catch{}},[]);const p=async()=>{try{const s=await c.getActiveBattles();S(s||[])}catch{S([])}},T=async()=>{try{const s=await c.getBattleStats();k(s||{wins:0,losses:0,winRate:0})}catch{k({wins:0,losses:0,winRate:0})}},v=()=>{try{const s=D.getGlobalLeaderboard(i,50);f(s)}catch{f([])}},W=async()=>{try{const a=(await c.getBattleHistory()||[]).filter(t=>t&&t.config).map(t=>{const h={id:"current-user"},u=t.results?.winner?.userId===h.id,q=u?t.results?.loser?.userName||"Opponent":t.results?.winner?.userName||"Opponent";return{id:t.id||"unknown",type:`${(t.config?.goal||"Unknown").replace(/-/g," ")} Challenge`,opponent:q,result:u?"won":"lost",date:t.results?.completedAt?new Date(t.results.completedAt).toLocaleDateString():"Unknown",xpEarned:u?75:25}}).reverse();B(a)}catch{B([])}},H=()=>{try{const s=D.getBattleRewards();N(s)}catch{N(null)}},U=()=>{try{const s=localStorage.getItem("daily_battle_challenges"),a=new Date().toDateString();if(s){const h=JSON.parse(s);if(h.date===a){y(h.challenges);return}}const t=[{id:"daily_steps",name:"Daily Step Sprint",description:"10,000 steps in 24 hours",target:1e4,xpReward:100,icon:"üèÉ",progress:0,completed:!1},{id:"quick_battle",name:"Quick Battle Victory",description:"Win any battle today",xpReward:75,icon:"‚öîÔ∏è",progress:0,completed:!1}];localStorage.setItem("daily_battle_challenges",JSON.stringify({date:a,challenges:t})),y(t)}catch{y([])}},M=()=>{try{const s=localStorage.getItem("battle_streak");if(s){const a=JSON.parse(s),t=1+a.current*.1;A({current:a.current||0,multiplier:t})}}catch{}},O=async()=>{try{const s=await c.createBattle(r);if(s.success){const a={battleId:s.battleId,shareCode:s.shareCode},t=confirm(`‚úÖ Battle Created!

Battle ID: ${a.battleId}
Share Code: ${a.shareCode}

Press OK to share with friends, or Cancel to continue.`);await p(),t&&await X(a),o("list")}else throw new Error(s.error||"Failed to create battle")}catch(s){alert("Failed to create battle: "+s.message)}},X=async s=>{try{const{Share:a}=await F(async()=>{const{Share:t}=await import("./entry-1765759384261-index.js").then(h=>h.F);return{Share:t}},__vite__mapDeps([0,1]));await a.share({title:"‚öîÔ∏è Join My Health Battle!",text:`I challenge you to a health battle in WellnessAI!

Share Code: ${s.shareCode}

Download the app and enter this code to join!`,dialogTitle:"Share Battle Code"})}catch{try{await navigator.clipboard.writeText(s.shareCode),alert(`üìã Share Code Copied!

${s.shareCode}

Paste this code to your friends via WhatsApp, SMS, or any messaging app!`)}catch{alert(`Share Code: ${s.shareCode}

Send this to your friends manually!`)}}},J=async()=>{const s=prompt("Enter Battle Share Code:");if(s)try{const a=await c.joinByShareCode(s.toUpperCase());if(a.success)alert(`‚úÖ Joined Battle!

The battle will start when all participants are ready.

Good luck! üî•`),p();else throw new Error(a.error||"Failed to join battle")}catch(a){alert("Failed to join battle: "+a.message)}},z=async s=>{try{const a=await c.syncBattleProgress(s);a.success&&(alert(`üìä Progress Updated!

Current Steps: ${(a.currentSteps||0).toLocaleString()}
Progress: +${(a.progress||0).toLocaleString()}
Rank: #${a.rank||"-"}

Keep moving! üí™`),p())}catch(a){alert("Failed to sync: "+a.message)}},Q=async s=>{const a=await c.getLiveLeaderboard(s);R(a),P(j.find(t=>t.id===s)),o("leaderboard")},V=async()=>{try{const s={duration:1,goal:"steps",target:1e4,stakes:"bragging-rights",stakeAmount:0,battleType:"quick"},a=await c.createBattle(s);a.success&&(alert(`‚ö° Quick Match Created!

Finding opponents...

Battle starts when 2+ players join!`),F(async()=>{const{default:t}=await import("./chunk-1765759384708-battleNotificationsService.js");return{default:t}},__vite__mapDeps([2,0,1])).then(({default:t})=>{t.sendBattleInvite({creatorName:"You",goal:"Quick Step Battle",battleId:a.battleId})}),await p())}catch(s){alert("Quick Match failed: "+s.message)}},G=async s=>{try{if(d.userCoins<s.cost){alert(`‚ùå Not enough coins!

You need ${s.cost-d.userCoins} more coins.`);return}const a=d.userCoins-s.cost,t={id:s.id,name:s.name,activatedAt:Date.now(),expiresAt:Date.now()+1440*60*1e3},h=localStorage.getItem("active_powerups")||"[]",u=JSON.parse(h);u.push(t),localStorage.setItem("active_powerups",JSON.stringify(u)),E(u),N({...d,userCoins:a}),alert(`‚úÖ ${s.name} activated!

${s.description}

Expires in 24 hours.`)}catch(a){alert("Failed to claim reward: "+a.message)}};return e.jsx("div",{className:"battles-overlay",children:e.jsxs("div",{className:"battles-modal",children:[e.jsx("button",{className:"battles-close",onClick:L,children:"‚úï"}),e.jsx("h2",{className:"battles-title",children:"‚öîÔ∏è Social Health Battles"}),e.jsxs("div",{className:"battles-nav",children:[e.jsx("button",{className:`nav-btn ${n==="list"?"active":""}`,onClick:()=>o("list"),children:"üìã Battles"}),e.jsx("button",{className:`nav-btn ${n==="create"?"active":""}`,onClick:()=>o("create"),children:"‚ûï Create"}),e.jsx("button",{className:`nav-btn ${n==="global"?"active":""}`,onClick:()=>o("global"),children:"üåç Leaderboard"}),e.jsx("button",{className:`nav-btn ${n==="history"?"active":""}`,onClick:()=>o("history"),children:"üìú History"}),e.jsx("button",{className:`nav-btn ${n==="rewards"?"active":""}`,onClick:()=>o("rewards"),children:"üèÜ Rewards"}),e.jsx("button",{className:"nav-btn join-btn",onClick:J,children:"üîó Join"}),e.jsx("button",{className:"nav-btn quick-match-btn",onClick:V,style:{background:"linear-gradient(135deg, #FF4500, #FFD700)",fontWeight:"bold"},children:"‚ö° Quick Match"})]}),m&&e.jsxs("div",{className:"stats-banner",children:[e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-value",children:m.wins}),e.jsx("span",{className:"stat-label",children:"Wins"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-value",children:m.losses}),e.jsx("span",{className:"stat-label",children:"Losses"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsxs("span",{className:"stat-value",children:[m.winRate,"%"]}),e.jsx("span",{className:"stat-label",children:"Win Rate"})]}),e.jsxs("div",{className:"stat-box",style:{borderColor:"#FFD700"},children:[e.jsxs("span",{className:"stat-value",style:{color:"#FFD700"},children:["üî• ",w.current]}),e.jsx("span",{className:"stat-label",children:"Win Streak"}),w.current>0&&e.jsxs("span",{style:{fontSize:"11px",color:"#FFD700"},children:[w.multiplier,"x XP"]})]})]}),$.length>0&&n==="list"&&e.jsxs("div",{className:"daily-challenges",style:{margin:"15px 0",padding:"15px",background:"rgba(255, 215, 0, 0.1)",border:"2px solid rgba(255, 215, 0, 0.3)",borderRadius:"15px"},children:[e.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px",color:"#FFD700"},children:"‚è∞ Daily Challenges (Expires Midnight)"}),$.map(s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"10px",marginBottom:"10px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"white"},children:[s.icon," ",s.name]}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(255, 255, 255, 0.7)"},children:s.description})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#FFD700"},children:["+",s.xpReward," XP"]}),s.completed?e.jsx("div",{style:{fontSize:"12px",color:"#4CAF50"},children:"‚úÖ Done"}):e.jsxs("div",{style:{fontSize:"12px",color:"#FF4500"},children:["‚è∞ ",new Date().getHours()<12?24-new Date().getHours():24-new Date().getHours()," hrs left"]})]})]},s.id))]}),n==="list"&&e.jsx("div",{className:"battles-list",children:j.length===0?e.jsxs("div",{className:"no-battles",children:[e.jsx("p",{children:"üèÜ No active battles"}),e.jsx("p",{className:"help-text",children:"Create a battle to challenge your friends!"})]}):j.map(s=>e.jsxs("div",{className:"battle-card",children:[e.jsxs("div",{className:"battle-header",children:[e.jsx("span",{className:"battle-goal",children:s.goal||"Unknown"}),e.jsx("span",{className:`battle-status ${s.status||"unknown"}`,children:s.status||"unknown"})]}),e.jsxs("div",{className:"battle-target",children:["Target: ",(s.target||0).toLocaleString()]}),e.jsxs("div",{className:"battle-stakes",children:["üí∞ Stakes: ",(s.stakes||"none").replace(/-/g," "),(s.stakeAmount||0)>0&&` ($${s.stakeAmount})`]}),e.jsxs("div",{className:"battle-participants",children:["üë• ",s.participants?.length||0," participants"]}),e.jsxs("div",{className:"battle-actions",children:[e.jsx("button",{className:"view-leaderboard-btn",onClick:()=>Q(s.id),children:"üìä Leaderboard"}),s.status==="active"&&e.jsx("button",{className:"sync-btn",onClick:()=>z(s.id),children:"üîÑ Sync Progress"})]})]},s.id||Math.random()))}),n==="create"&&e.jsxs("div",{className:"create-battle",children:[e.jsx("h3",{children:"Create New Battle"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Goal Type:"}),e.jsxs("select",{value:r.goal,onChange:s=>x({...r,goal:s.target.value}),className:"form-select",children:[e.jsx("option",{value:"steps",children:"Steps Challenge"}),e.jsx("option",{value:"weight-loss",children:"Weight Loss"}),e.jsx("option",{value:"health-score",children:"Health Score"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Target:"}),e.jsx("input",{type:"number",value:r.target,onChange:s=>x({...r,target:parseInt(s.target.value)}),className:"form-input"}),e.jsxs("span",{className:"input-hint",children:[r.goal==="steps"&&"Total steps in 30 days",r.goal==="weight-loss"&&"Pounds to lose",r.goal==="health-score"&&"Target health score"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Duration (days):"}),e.jsx("input",{type:"number",value:r.duration,onChange:s=>x({...r,duration:parseInt(s.target.value)}),className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stakes:"}),e.jsxs("select",{value:r.stakes,onChange:s=>x({...r,stakes:s.target.value}),className:"form-select",children:[e.jsx("option",{value:"bragging-rights",children:"Bragging Rights"}),e.jsx("option",{value:"money",children:"Money"}),e.jsx("option",{value:"subscription",children:"Subscription Payment"})]})]}),(r.stakes==="money"||r.stakes==="subscription")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount ($):"}),e.jsx("input",{type:"number",value:r.stakeAmount,onChange:s=>x({...r,stakeAmount:parseInt(s.target.value)}),className:"form-input"})]}),e.jsx("button",{className:"create-battle-btn",onClick:O,children:"‚öîÔ∏è Create Battle"})]}),n==="leaderboard"&&b&&C&&e.jsxs("div",{className:"leaderboard-view",children:[e.jsx("button",{className:"back-btn",onClick:()=>o("list"),children:"‚Üê Back"}),e.jsxs("h3",{children:[(C.goal||"Unknown").replace(/-/g," ").toUpperCase()," Challenge"]}),e.jsxs("div",{className:"days-remaining",children:["‚è±Ô∏è ",b.daysRemaining," days remaining"]}),e.jsx("div",{className:"leaderboard-list",children:b.leaderboard.map((s,a)=>e.jsxs("div",{className:`leaderboard-item rank-${s.rank}`,children:[e.jsxs("div",{className:"rank-badge",children:[s.rank===1&&"ü•á",s.rank===2&&"ü•à",s.rank===3&&"ü•â",s.rank>3&&`#${s.rank}`]}),e.jsxs("div",{className:"participant-info",children:[e.jsx("div",{className:"participant-name",children:s.userId}),e.jsxs("div",{className:"participant-progress",children:["Progress: ",s.progress,"%"]})]}),e.jsx("div",{className:"participant-score",children:(s.currentScore||0).toLocaleString()})]},a))})]}),n==="global"&&e.jsxs("div",{className:"global-leaderboard-view",children:[e.jsxs("div",{className:"metric-selector",children:[e.jsx("button",{className:i==="totalXP"?"active":"",onClick:()=>{g("totalXP"),v()},children:"‚ö° XP"}),e.jsx("button",{className:i==="level"?"active":"",onClick:()=>{g("level"),v()},children:"üèÖ Level"}),e.jsx("button",{className:i==="streak"?"active":"",onClick:()=>{g("streak"),v()},children:"üî• Streak"}),e.jsx("button",{className:i==="totalSteps"?"active":"",onClick:()=>{g("totalSteps"),v()},children:"üëü Steps"})]}),e.jsx("div",{className:"global-leaderboard-list",children:I.map(s=>e.jsxs("div",{className:`global-leaderboard-item ${s.isCurrentUser?"current-user":""} ${s.rank<=3?"top-three":""}`,children:[e.jsxs("div",{className:"rank-badge-global",children:[s.rank===1&&"ü•á",s.rank===2&&"ü•à",s.rank===3&&"ü•â",s.rank>3&&`#${s.rank}`]}),e.jsx("div",{className:"user-avatar",children:s.profilePic}),e.jsxs("div",{className:"user-details",children:[e.jsx("div",{className:"user-name",children:s.username}),e.jsxs("div",{className:"user-level",children:["Level ",s.level]})]}),e.jsxs("div",{className:"user-stat",children:[i==="totalXP"&&`${(s.totalXP||0).toLocaleString()} XP`,i==="level"&&`Level ${s.level||1}`,i==="streak"&&`${s.streak||0} days üî•`,i==="totalSteps"&&`${(s.totalSteps||0).toLocaleString()} steps`]})]},s.userId))})]}),n==="history"&&e.jsxs("div",{className:"history-view",children:[e.jsx("h3",{children:"‚öîÔ∏è Battle History"}),e.jsxs("div",{className:"history-stats",children:[e.jsxs("div",{className:"history-stat",children:[e.jsx("div",{className:"stat-value",children:m?.wins||0}),e.jsx("div",{className:"stat-label",children:"Wins"})]}),e.jsxs("div",{className:"history-stat",children:[e.jsx("div",{className:"stat-value",children:m?.losses||0}),e.jsx("div",{className:"stat-label",children:"Losses"})]}),e.jsxs("div",{className:"history-stat",children:[e.jsxs("div",{className:"stat-value",children:[m?.winRate||0,"%"]}),e.jsx("div",{className:"stat-label",children:"Win Rate"})]})]}),e.jsx("div",{className:"history-list",children:_.map(s=>e.jsxs("div",{className:`history-item ${s.result}`,children:[e.jsx("div",{className:"history-icon",children:s.result==="won"?"üèÜ":"üíÄ"}),e.jsxs("div",{className:"history-details",children:[e.jsx("div",{className:"history-type",children:s.type}),e.jsxs("div",{className:"history-opponent",children:["vs ",s.opponent]}),e.jsx("div",{className:"history-date",children:s.date})]}),e.jsxs("div",{className:"history-reward",children:[e.jsxs("div",{className:"xp-earned",children:["+",s.xpEarned," XP"]}),e.jsx("div",{className:`result-badge ${s.result}`,children:s.result==="won"?"VICTORY":"DEFEAT"})]})]},s.id))})]}),n==="rewards"&&d&&e.jsxs("div",{className:"rewards-view",children:[e.jsx("h3",{children:"üèÜ Battle Rewards"}),e.jsxs("div",{className:"user-coins",children:["üí∞ Your Coins: ",e.jsx("strong",{children:d.userCoins})]}),e.jsx("div",{className:"rewards-list",children:d.availableRewards.map(s=>e.jsxs("div",{className:"reward-card",children:[e.jsx("div",{className:"reward-icon",children:s.icon}),e.jsxs("div",{className:"reward-info",children:[e.jsx("div",{className:"reward-name",children:s.name}),e.jsx("div",{className:"reward-description",children:s.description})]}),e.jsxs("div",{className:"reward-action",children:[e.jsxs("div",{className:"reward-cost",children:[s.cost," coins"]}),e.jsx("button",{className:"claim-btn",onClick:()=>G(s),disabled:d.userCoins<s.cost,children:"Claim"})]})]},s.id))})]})]})})}export{se as default};
