import{C as t}from"./entry-1765887266798-index.js";class n{constructor(){this.isRunning=!1,this.listeners=[],this.currentSteps=0}async start(){try{if(console.log("ðŸš€ Starting native foreground service via WebView bridge..."),!t.isNativePlatform()||t.getPlatform()!=="android")throw new Error("Step counter only works on Android");if(!window.AndroidStepCounter)throw console.error("âŒ AndroidStepCounter WebView bridge not found"),new Error("AndroidStepCounter bridge not available. App may need restart.");console.log("âœ… AndroidStepCounter bridge found, starting service...");const r=window.AndroidStepCounter.startService(),e=JSON.parse(r);if(console.log("ðŸ“± startService result:",e),e&&e.started)return this.isRunning=!0,console.log("âœ… NATIVE FOREGROUND SERVICE STARTED!"),console.log("   â†’ Persistent notification will appear"),console.log("   â†’ Steps count even when app is CLOSED"),console.log("   â†’ Service runs 24/7"),this.startPolling(),!0;throw console.warn("âš ï¸ Service start failed:",e.error||"Unknown error"),new Error(e.error||"Failed to start service")}catch(r){throw console.error("âŒ Failed to start native service:",r),r}}async stop(){try{if(window.AndroidStepCounter){const r=window.AndroidStepCounter.stopService(),e=JSON.parse(r);return this.isRunning=!1,this.stopPolling(),console.log("Service stopped"),e.stopped}return!1}catch(r){return console.error("Error stopping service:",r),!1}}async getSteps(){try{if(window.AndroidStepCounter){const r=window.AndroidStepCounter.getSteps(),e=JSON.parse(r);return this.currentSteps=e.steps||0,this.currentSteps}return 0}catch(r){return console.error("Error getting steps:",r),0}}async getStepCount(){try{return window.AndroidStepCounter?parseInt(window.AndroidStepCounter.getTodaySteps()||"0"):0}catch(r){return console.error("Error getting today steps:",r),0}}startPolling(){this.pollInterval||(this.pollInterval=setInterval(async()=>{const r=await this.getSteps();r!==this.currentSteps&&(this.currentSteps=r,this.notifyListeners(r))},5e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}addListener(r){this.listeners.push(r)}notifyListeners(r){this.listeners.forEach(e=>{try{e(r)}catch(o){console.error("Error in step listener:",o)}})}isActive(){return this.isRunning}}const l=new n;export{l as default};
