const n="DEMO_KEY",i="https://api.nal.usda.gov/fdc/v1";class l{async searchFoods(s,e=20){if(!s||s.trim().length<2)return{success:!1,error:"Query too short"};try{const o=new URLSearchParams({query:s.trim(),pageSize:Math.min(e,50),dataType:"Branded,Foundation,SR Legacy",api_key:n}),a=await fetch(`${i}/foods/search?${o}`);if(!a.ok)throw new Error(`USDA API error: ${a.status}`);const r=await a.json();return!r.foods||r.foods.length===0?{success:!0,foods:[],totalResults:0}:{success:!0,foods:r.foods.map(c=>this.transformUSDAFood(c)),totalResults:r.totalHits||r.foods.length,source:"USDA"}}catch(o){return{success:!1,error:o.message||"USDA search failed",foods:[]}}}async getFoodDetails(s){try{const e=await fetch(`${i}/food/${s}?api_key=${n}`);if(!e.ok)throw new Error(`USDA API error: ${e.status}`);const o=await e.json();return{success:!0,food:this.transformUSDAFood(o)}}catch(e){return{success:!1,error:e.message||"Failed to get food details"}}}transformUSDAFood(s){const e={};s.foodNutrients&&s.foodNutrients.forEach(a=>{const r=a.nutrientName?.toLowerCase()||"",t=a.value||0;r.includes("energy")&&r.includes("kcal")?e.calories=t:r.includes("protein")?e.protein=t:r.includes("carbohydrate")?(e.carbohydrates=t,e.carbs=t):r.includes("total lipid")||r.includes("fat, total")?(e.fat=t,e.fats=t):r.includes("fiber")?e.fiber=t:r.includes("sugars, total")?e.sugars=t:r.includes("sodium")?e.sodium=t:r.includes("cholesterol")?e.cholesterol=t:r.includes("saturated")&&(e.saturatedFat=t)});let o="100g";return s.servingSize&&s.servingSizeUnit?o=`${s.servingSize}${s.servingSizeUnit}`:s.householdServingFullText&&(o=s.householdServingFullText),{name:s.description||s.lowercaseDescription||"Unknown Food",brand:s.brandOwner||s.brandName||"USDA",calories:e.calories||0,protein:e.protein||0,carbs:e.carbs||0,carbohydrates:e.carbohydrates||0,fat:e.fat||0,fats:e.fats||0,fiber:e.fiber||0,sugars:e.sugars||0,sodium:e.sodium||0,saturatedFat:e.saturatedFat||0,cholesterol:e.cholesterol||0,servingSize:o,dataType:s.dataType||"USDA",fdcId:s.fdcId,source:"USDA FoodData Central",category:s.foodCategory||s.brandedFoodCategory||"",ingredients:s.ingredients||"",allNutrients:e}}async searchByCategory(s){return this.searchFoods(s,30)}async getBatchFoods(s){if(!s||s.length===0)return{success:!1,error:"No IDs provided"};try{const e=await fetch(`${i}/foods?api_key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fdcIds:s.slice(0,20)})});if(!e.ok)throw new Error(`USDA API error: ${e.status}`);return{success:!0,foods:(await e.json()).map(r=>this.transformUSDAFood(r))}}catch(e){return{success:!1,error:e.message||"Batch request failed",foods:[]}}}}const d=new l;export{d as default};
