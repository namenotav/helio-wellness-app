const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-1765887266801-index.js","assets/entry-1765887266798-index.js","assets/asset-1765887267361-index.css"])))=>i.map(i=>d[i]);
import{r as u,j as e,_ as g}from"./entry-1765887266798-index.js";function C({userName:_,onClose:b}){const[c,r]=u.useState(!1),[d,f]=u.useState(!1),[k,x]=u.useState(!1),[m,j]=u.useState(""),[E,w]=u.useState(!1),[I,l]=u.useState([{type:"ai",text:`Hey ${_}! I'm here to help. What's on your mind?`}]),N=async()=>{r(!0);try{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition,t=new i;t.continuous=!1,t.interimResults=!1,t.lang="en-US",t.onresult=n=>{const o=n.results[0][0].transcript;r(!1),v(o)},t.onerror=n=>{r(!1),l(o=>[...o,{type:"ai",text:"I couldn't hear you. Try typing instead!"}])},t.onend=()=>{r(!1)},t.start();return}const{SpeechRecognition:s}=await g(async()=>{const{SpeechRecognition:i}=await import("./chunk-1765887266801-index.js");return{SpeechRecognition:i}},__vite__mapDeps([0,1,2]));try{if(!(await s.available()).available)throw new Error("Speech recognition not available")}catch{throw new Error("Speech not supported")}try{if((await s.requestPermissions()).speechRecognition!=="granted"){alert("Please allow microphone access in your phone settings"),r(!1);return}}catch{alert("Microphone permission required. Please enable it in Settings."),r(!1);return}try{await s.removeAllListeners()}catch{}let a=!1;s.addListener("error",i=>{a||(l(t=>[...t,{type:"ai",text:"I couldn't hear you clearly. Please try again or use the suggestion buttons below!"}]),r(!1))}),s.addListener("result",async i=>{if(a=!0,i.matches&&i.matches.length>0){const t=i.matches[0];l(n=>[...n,{type:"user",text:t}]),r(!1),f(!0);try{await s.stop()}catch{}w(!1);try{const n=(await g(async()=>{const{default:h}=await import("./entry-1765887266798-index.js").then(P=>P.K);return{default:h}},__vite__mapDeps([1,2]))).default,o=JSON.parse(localStorage.getItem("wellnessai_user")||"{}"),p=await n.chat(t,{allergens:o.profile?.allergens||[],dietaryPreferences:o.profile?.dietaryPreferences||[],healthGoals:o.profile?.healthGoals||[]});l(h=>[...h,{type:"ai",text:p}]),await y(p)}catch{l(o=>[...o,{type:"ai",text:"Oops! I had trouble with that. Can you try asking in a different way?"}])}f(!1)}else r(!1)}),await s.start({language:"en-US",maxResults:5,prompt:"Speak now",partialResults:!1,popup:!0}),setTimeout(async()=>{if(!a){try{await s.stop(),l(i=>[...i,{type:"ai",text:"I didn't catch that. Try speaking again or use the suggestion buttons!"}])}catch{}r(!1)}},1e4)}catch{l(a=>[...a,{type:"ai",text:"Voice input not available right now ðŸ˜” But I can still help! Try clicking the suggestion buttons below or typing your question."}]),r(!1)}},R=async()=>{try{const{SpeechRecognition:s}=await g(async()=>{const{SpeechRecognition:a}=await import("./chunk-1765887266801-index.js");return{SpeechRecognition:a}},__vite__mapDeps([0,1,2]));await s.stop(),await s.removeAllListeners()}catch{}r(!1)},y=async s=>{try{const{TextToSpeech:a}=await g(async()=>{const{TextToSpeech:i}=await import("./entry-1765887266798-index.js").then(t=>t.D);return{TextToSpeech:i}},__vite__mapDeps([1,2]));x(!0),await a.speak({text:s,lang:"en-US",rate:1,pitch:1,volume:1,category:"ambient"}),x(!1)}catch{x(!1)}},v=async(s,a=!1)=>{const i=localStorage.getItem("helio_dev_mode")==="true";if(!i){const t=window.subscriptionService?.checkLimit("aiMessages");if(t&&!t.allowed){l(n=>[...n,{type:"user",text:s},{type:"ai",text:`ðŸ”’ You've reached your daily limit of ${t.limit} AI messages.

Upgrade for more:
ðŸ’ª Essential Â£4.99/mo - 30 messages/day
â­ Premium Â£14.99/mo - 50 messages/day
ðŸ‘‘ Ultimate Â£29.99/mo - UNLIMITED messages`}]);return}}l(t=>[...t,{type:"user",text:s}]),f(!0);try{const t=(await g(async()=>{const{default:p}=await import("./entry-1765887266798-index.js").then(h=>h.K);return{default:p}},__vite__mapDeps([1,2]))).default,n=JSON.parse(localStorage.getItem("wellnessai_user")||"{}"),o=await t.chat(s,{allergens:n.profile?.allergens||[],dietaryPreferences:n.profile?.dietaryPreferences||[],healthGoals:n.profile?.healthGoals||[]});if(l(p=>[...p,{type:"ai",text:o}]),!i&&window.subscriptionService){window.subscriptionService.incrementUsage("aiMessages");const p=window.subscriptionService.checkLimit("aiMessages")}a||await y(o)}catch{l(n=>[...n,{type:"ai",text:"There was an error. Please check your internet connection and try again."}]),await y("There was an error. Please check your internet connection and try again.")}f(!1)},S=s=>{w(!1),v(s,!1)},T=s=>{s.preventDefault(),m.trim()&&(w(!0),v(m,!0),j(""))};return e.jsx("div",{className:"ai-assistant-modal-overlay",onClick:b,children:e.jsxs("div",{className:"ai-assistant-modal-content",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"ai-assistant-modal-close",onClick:b,children:"Ã—"}),e.jsxs("div",{className:"ai-assistant-header",children:[e.jsx("h2",{children:"ðŸ’¬ AI Voice Coach"}),e.jsx("p",{children:"Just talk to me like a friend"}),(()=>{if(localStorage.getItem("helio_dev_mode")==="true")return null;const a=window.subscriptionService?.checkLimit("aiMessages");return a&&!window.subscriptionService?.hasAccess("aiVoiceCoach")?e.jsx("div",{className:"ai-assistant-limit-badge",style:{background:a.remaining<=1?"rgba(255, 68, 68, 0.2)":"rgba(139, 95, 232, 0.2)",color:a.remaining<=1?"#FF4444":"#C084FC",border:`2px solid ${a.remaining<=1?"#FF4444":"rgba(139, 95, 232, 0.4)"}`},children:a.remaining>0?e.jsxs(e.Fragment,{children:["ðŸ’¬ ",a.remaining,"/",a.limit," messages left today"]}):e.jsx(e.Fragment,{children:"ðŸ”’ Daily limit reached - Upgrade for unlimited!"})}):null})()]}),e.jsxs("div",{className:"ai-assistant-messages",children:[I.map((s,a)=>e.jsxs("div",{className:`ai-assistant-message ${s.type}`,onClick:()=>s.type==="ai"&&y(s.text),title:s.type==="ai"?"Click to hear again":"",children:[e.jsx("span",{className:"message-icon",children:s.type==="ai"?"âœ¨":"ðŸ‘¤"}),e.jsx("p",{children:s.text})]},a)),d&&e.jsxs("div",{className:"ai-assistant-message ai loading-message",children:[e.jsx("span",{className:"message-icon",children:"âœ¨"}),e.jsxs("p",{children:[e.jsxs("span",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),"Thinking..."]})]})]}),e.jsx("button",{className:`ai-assistant-voice-button ${c?"listening":""}`,onClick:c?R:N,disabled:d,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"pulse-ring"}),e.jsx("span",{className:"voice-icon",children:"ðŸŽ™ï¸"}),e.jsx("p",{children:"I'm listening..."})]}):d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"voice-icon",children:"â³"}),e.jsx("p",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"voice-icon",children:"ðŸŽ¤"}),e.jsx("p",{children:"Tap to talk"})]})}),e.jsxs("form",{className:"ai-assistant-text-input",onSubmit:T,children:[e.jsx("input",{type:"text",value:m,onChange:s=>j(s.target.value),placeholder:"Or type your message...",disabled:d||c,className:"text-input-field"}),e.jsx("button",{type:"submit",className:"text-send-btn",disabled:!m.trim()||d||c,children:"Send ðŸ“¤"})]}),e.jsxs("div",{className:"ai-assistant-suggestions",children:[e.jsx("p",{className:"suggestions-label",children:"Or try these quick questions:"}),e.jsx("button",{className:"suggestion-chip",onClick:()=>S("What should I eat for lunch?"),disabled:c||d,children:'"What should I eat for lunch?"'}),e.jsx("button",{className:"suggestion-chip",onClick:()=>S("How am I doing today?"),disabled:c||d,children:'"How am I doing today?"'}),e.jsx("button",{className:"suggestion-chip",onClick:()=>S("Show me my progress"),disabled:c||d,children:'"Show me my progress"'})]}),k&&e.jsxs("div",{className:"speaking-indicator",children:[e.jsx("span",{className:"speaker-icon",children:"ðŸ”Š"}),e.jsx("p",{children:"AI is speaking..."})]})]})})}export{C as default};
