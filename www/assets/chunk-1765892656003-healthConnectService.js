import{k as o}from"./entry-1765892656001-index.js";const i=o("HealthConnect"),c={0:"SDK_AVAILABLE",1:"SDK_UNAVAILABLE",2:"SDK_UNAVAILABLE_PROVIDER_UPDATE_REQUIRED",3:"SDK_UNAVAILABLE_PROVIDER_INSTALLATION_REQUIRED",4:"SDK_UNAVAILABLE_PROVIDER_UPDATING",5:"SDK_UNAVAILABLE_DEVICE_NOT_SUPPORTED"};class h{constructor(){this.isInitialized=!1,this.isAvailable=!1,this.hasPermissions=!1,this.sdkStatus=null}async initialize(){if(this.isInitialized)return!0;try{const t=await this.checkAvailability();if(this.isAvailable=t.available,this.sdkStatus=t.sdkStatus,this.isAvailable){const e=await i.hasPermissions();this.hasPermissions=e.hasAllPermissions}return this.isInitialized=!0,console.log("✅ Health Connect initialized:",{available:this.isAvailable,hasPermissions:this.hasPermissions}),this.isAvailable}catch(t){return console.error("❌ Health Connect initialization failed:",t),this.isAvailable=!1,this.isInitialized=!0,!1}}async checkAvailability(){try{const t=await i.isAvailable();return{available:!!t?.available,sdkStatus:typeof t?.sdkStatus=="number"?t.sdkStatus:null,statusLabel:typeof t?.sdkStatus=="number"?c[t.sdkStatus]||"SDK_STATUS_UNKNOWN":null,error:null,raw:t??null}}catch(t){return console.error("❌ Failed to check Health Connect availability:",t),{available:!1,sdkStatus:null,statusLabel:"SDK_STATUS_ERROR",error:t?.message||String(t),raw:null}}}async requestPermissions(){try{return await i.openHealthConnectSettings(),setTimeout(async()=>{const t=await i.hasPermissions();this.hasPermissions=t.hasAllPermissions,console.log("✅ Permissions updated:",t)},1e3),!0}catch(t){return console.error("❌ Failed to request permissions:",t),!1}}async getSteps(t=null,e=null){if(!this.isAvailable)throw new Error("Health Connect not available");if(!this.hasPermissions)throw new Error("Health Connect permissions not granted");try{const s={};return t&&(s.startTime=t),e&&(s.endTime=e),(await i.getSteps(s)).steps||0}catch(s){throw console.error("❌ Failed to read steps from Health Connect:",s),s}}async getTodaySteps(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);return await this.getSteps(e.getTime(),t.getTime())}async getWeeklySteps(){const t=new Date,e=[];for(let s=6;s>=0;s--){const a=new Date(t);a.setDate(a.getDate()-s);const r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),l=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59);try{const n=await this.getSteps(r.getTime(),l.getTime());e.push({date:r.toISOString().split("T")[0],steps:n})}catch(n){console.error(`❌ Failed to get steps for ${r}:`,n),e.push({date:r.toISOString().split("T")[0],steps:0})}}return e}async checkPermissions(){try{const t=await i.hasPermissions();return this.hasPermissions=t.hasAllPermissions,t}catch(t){return console.error("❌ Failed to check permissions:",t),{hasAllPermissions:!1}}}}const S=new h;export{S as default};
