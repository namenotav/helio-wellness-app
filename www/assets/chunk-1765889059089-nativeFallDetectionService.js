import{C as r}from"./entry-1765889059086-index.js";class l{constructor(){this.isRunning=!1,this.listeners=[],this.pollInterval=null}async start(){try{if(console.log("ðŸš€ Starting native fall detection service..."),!r.isNativePlatform()||r.getPlatform()!=="android")throw new Error("Fall detection only works on Android");if(!window.AndroidFallDetection)throw console.error("âŒ AndroidFallDetection WebView bridge not found"),new Error("AndroidFallDetection bridge not available. App may need restart.");console.log("âœ… AndroidFallDetection bridge found, starting service...");const e=window.AndroidFallDetection.startService(),t=JSON.parse(e);if(console.log("ðŸ“± startService result:",t),t&&t.started)return this.isRunning=!0,console.log("âœ… NATIVE FALL DETECTION SERVICE STARTED!"),console.log("   â†’ Persistent notification will appear"),console.log("   â†’ Monitors falls even when app is CLOSED"),console.log("   â†’ Service runs 24/7"),this.startPolling(),!0;throw console.warn("âš ï¸ Service start failed:",t.error||"Unknown error"),new Error(t.error||"Failed to start service")}catch(e){throw console.error("âŒ Failed to start native fall detection service:",e),e}}async stop(){try{if(window.AndroidFallDetection){const e=window.AndroidFallDetection.stopService(),t=JSON.parse(e);return this.isRunning=!1,this.stopPolling(),console.log("Fall detection service stopped"),t.stopped}return!1}catch(e){return console.error("Error stopping fall detection service:",e),!1}}async getFallStatus(){try{if(window.AndroidFallDetection){const e=window.AndroidFallDetection.getFallStatus();return JSON.parse(e)}return{fallDetected:!1}}catch(e){return console.error("Error getting fall status:",e),{fallDetected:!1}}}async resetFallFlag(){try{if(window.AndroidFallDetection){const e=window.AndroidFallDetection.resetFallFlag();return JSON.parse(e).reset}return!1}catch(e){return console.error("Error resetting fall flag:",e),!1}}startPolling(){this.pollInterval||(this.pollInterval=setInterval(async()=>{const e=await this.getFallStatus();e.fallDetected&&(console.warn("âš ï¸ FALL DETECTED by native service!",e),this.notifyListeners(e),await this.resetFallFlag())},1e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}addListener(e){this.listeners.push(e)}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(o){console.error("Error in fall listener:",o)}})}isActive(){return this.isRunning}}const i=new l;export{i as default,i as nativeFallDetectionService};
