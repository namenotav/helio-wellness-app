const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-1765759384482-smartFoodSearch.js","assets/chunk-1765759384710-usdaService.js","assets/chunk-1765759384710-restaurantService.js","assets/chunk-1765759384500-barcodeScannerService.js","assets/entry-1765759384261-index.js","assets/asset-1765759384970-index.css","assets/chunk-1765759384482-index.js"])))=>i.map(i=>d[i]);
import{r,j as e,_ as w,a as R,b as m}from"./entry-1765759384261-index.js";import{barcodeScannerService as u}from"./chunk-1765759384500-barcodeScannerService.js";import"./chunk-1765759384482-index.js";const C=({onClose:v,onFoodScanned:h})=>{const[n,g]=r.useState(!1),[s,x]=r.useState(null),[b,l]=r.useState(!1),[f,c]=r.useState(null),[p,o]=r.useState(30),j=async()=>{try{c(null),g(!0),l(!1),o(30);const a=setInterval(()=>{o(d=>d<=1?(clearInterval(a),0):d-1)},1e3),t=await u.startScan(3e4);if(clearInterval(a),t.success){l(!0);const i=await(await w(async()=>{const{default:S}=await import("./chunk-1765759384482-smartFoodSearch.js");return{default:S}},__vite__mapDeps([0,1,2,3,4,5,6]))).default.searchByBarcode(t.barcode);i&&i.length>0?x({...i[0],allMatches:i,totalResults:i.length}):c("Product not found in any database (USDA, Restaurants, OpenFoodFacts)")}else c(t.message||"Failed to scan barcode")}catch(a){c(a.message||"Failed to scan barcode. Try holding camera steady and ensuring good lighting.")}finally{g(!1),l(!1),o(30)}},N=()=>{n&&u.stopScan(),document.body.classList.remove("barcode-scanning-active"),document.querySelector("html")?.classList.remove("barcode-scanning-active"),document.body.offsetHeight,v()};r.useEffect(()=>()=>{n&&u.stopScan(),document.body.classList.remove("barcode-scanning-active"),document.querySelector("html")?.classList.remove("barcode-scanning-active"),document.body.offsetHeight},[n]);const y=async()=>{if(s)try{(await R.logFood({name:s.name,brand:s.brand,barcode:s.barcode,calories:s.calories,protein:s.protein,carbs:s.carbs,fat:s.fat,fiber:s.fiber,sugar:s.sugar,sodium:s.sodium,servingSize:s.servingSize,image:s.image,ingredients:s.ingredients,source:s.source})).success!==!1?(m(`âœ… ${s.name} logged! +${s.calories} cal`,"success"),h&&h(s)):m("Failed to log meal. Please try again.","error")}catch{m("Error logging meal. Please try again.","error")}};return e.jsx("div",{className:`barcode-scanner-modal ${n?"scanning-active":""}`,children:e.jsxs("div",{className:`scanner-content ${n?"scanning-active":""}`,children:[e.jsxs("div",{className:"scanner-header",children:[e.jsx("h2",{children:"ðŸ“· Scan Barcode"}),e.jsx("button",{className:"close-btn",onClick:N,children:"âœ•"})]}),!n&&!s&&e.jsxs("div",{className:"scanner-instructions",children:[e.jsx("div",{className:"barcode-icon",children:"ðŸ“¦"}),e.jsx("h3",{children:"Scan Food Barcode"}),e.jsx("p",{children:"Point your camera at the barcode"}),e.jsx("p",{className:"hint",children:"ðŸ“¸ Live scanning - auto-detects when found!"}),e.jsx("button",{className:"scan-btn",onClick:j,children:"ðŸ“¸ Start Scanning"}),f&&e.jsxs("div",{className:"error-message",children:["âš ï¸ ",f]})]}),(n||b)&&e.jsxs("div",{className:"scanning-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:n?"ðŸ“¸ Point camera at barcode...":"ðŸ” Looking up product..."}),n&&p>0&&e.jsxs("p",{className:"countdown",children:["â±ï¸ ",p,"s remaining"]})]}),s&&e.jsxs("div",{className:"scan-result",children:[s.image&&e.jsx("img",{src:s.image,alt:s.name,className:"food-image"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:s.sourceBadge}),e.jsx("h3",{style:{margin:0},children:s.name})]}),s.brand&&e.jsx("p",{className:"brand",children:s.brand}),s.totalResults>1&&e.jsxs("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:["ðŸ” Found ",s.totalResults," matches across databases (showing best match)"]}),e.jsxs("div",{className:"nutrition-info",children:[e.jsxs("h4",{children:["Nutrition (per ",s.servingSize,")"]}),e.jsxs("div",{className:"nutrition-grid",children:[e.jsxs("div",{className:"nutrition-item",children:[e.jsx("span",{className:"label",children:"Calories"}),e.jsx("span",{className:"value",children:s.calories})]}),e.jsxs("div",{className:"nutrition-item",children:[e.jsx("span",{className:"label",children:"Protein"}),e.jsxs("span",{className:"value",children:[s.protein,"g"]})]}),e.jsxs("div",{className:"nutrition-item",children:[e.jsx("span",{className:"label",children:"Carbs"}),e.jsxs("span",{className:"value",children:[s.carbs||s.carbohydrates,"g"]})]}),e.jsxs("div",{className:"nutrition-item",children:[e.jsx("span",{className:"label",children:"Fat"}),e.jsxs("span",{className:"value",children:[s.fat||s.fats,"g"]})]})]})]}),s.allMatches&&s.allMatches.length>1&&e.jsxs("details",{style:{marginTop:"15px",padding:"10px",background:"#f5f5f5",borderRadius:"8px"},children:[e.jsxs("summary",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"10px"},children:["ðŸ“Š View all ",s.allMatches.length," matches"]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:s.allMatches.slice(1).map((a,t)=>e.jsxs("div",{style:{padding:"8px",marginBottom:"8px",background:"white",borderRadius:"6px",cursor:"pointer"},onClick:()=>x({...a,allMatches:s.allMatches,totalResults:s.totalResults}),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:a.sourceBadge}),e.jsx("strong",{children:a.name})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:[a.calories," cal | P: ",a.protein,"g | C: ",a.carbs||a.carbohydrates,"g | F: ",a.fat||a.fats,"g"]})]},t))})]}),s.ingredients&&e.jsxs("div",{className:"ingredients",children:[e.jsx("h4",{children:"Ingredients"}),e.jsx("p",{children:s.ingredients})]}),e.jsxs("div",{className:"result-actions",children:[e.jsx("button",{className:"add-btn",onClick:y,children:"âœ… Add to Meal"}),e.jsx("button",{className:"rescan-btn",onClick:j,children:"ðŸ”„ Scan Another"})]}),e.jsxs("p",{className:"source",children:["Source: ",s.source]})]}),e.jsxs("div",{className:"scanner-ui",children:[e.jsx("div",{className:"scanner-overlay"}),e.jsx("div",{className:"scanner-frame"}),e.jsx("div",{className:"scanner-instructions",children:"Position barcode within frame"})]})]})})};export{C as default};
