import{a as g,r as h,j as e}from"./entry-1765759384261-index.js";import{healthAvatarService as v}from"./chunk-1765759384264-healthAvatarService.js";class S{constructor(){this.partnersDB=[{id:"bupa",name:"Bupa Health Insurance",maxDiscount:40,currency:"Â£",basePremium:150,requirements:{minHealthScore:70,minMonthlySteps:2e5,minWorkouts:12,regularCheckIns:!0}},{id:"vitality",name:"Vitality Health",maxDiscount:35,currency:"Â£",basePremium:180,requirements:{minHealthScore:65,minMonthlySteps:15e4,minWorkouts:10,foodLogging:!0}},{id:"axa",name:"AXA Health",maxDiscount:30,currency:"Â£",basePremium:140,requirements:{minHealthScore:60,minMonthlySteps:12e4,minWorkouts:8}},{id:"aviva",name:"Aviva Health",maxDiscount:25,currency:"Â£",basePremium:130,requirements:{minHealthScore:55,minMonthlySteps:1e5,minWorkouts:6}}]}async calculateDiscount(s){const a=g.getCurrentUser();if(!a)return{eligible:!1};const t=this.partnersDB.find(x=>x.id===s);if(!t)return{eligible:!1};const i=(await v.getAvatarState()).current.score,c=this.calculateMonthlySteps(a.stats),l=i>=t.requirements.minHealthScore,m=c>=t.requirements.minMonthlySteps,u=t.requirements.regularCheckIns?this.hasRegularCheckIns(a):!0,n=t.requirements.foodLogging?this.hasFoodLogging(a):!0,o=l&&m&&u&&n;let d=0;return o&&(d=this.calculateDiscountPercent(i,c,t)),{eligible:o,discountPercent:d,partner:t.name,monthlySavings:this.estimateSavings(d),yearlySavings:this.estimateSavings(d)*12,requirements:{healthScore:{current:i,required:t.requirements.minHealthScore,met:l},monthlySteps:{current:c,required:t.requirements.minMonthlySteps,met:m},checkIns:u,foodLogging:n}}}calculateMonthlySteps(s){const a=JSON.parse(localStorage.getItem("stepHistory")||"{}"),t=Object.keys(a),r=Date.now()-720*60*60*1e3;return t.filter(l=>new Date(l).getTime()>=r).reduce((l,m)=>l+(a[m]||0),0)}hasRegularCheckIns(s){return new Date(s.profile?.lastActive||Date.now()),JSON.parse(localStorage.getItem("loginHistory")||"[]").filter(r=>{const i=new Date(r);return Date.now()-i.getTime()<=720*60*60*1e3}).length>=20}hasFoodLogging(s){const a=JSON.parse(localStorage.getItem("foodLog")||"[]"),t=Date.now()-720*60*60*1e3;return a.filter(i=>new Date(i.timestamp||i.date).getTime()>=t).length>=60}calculateDiscountPercent(s,a,t){const{maxDiscount:r,requirements:i}=t;let c=r*.5;const l=Math.min((s-i.minHealthScore)/100*r*.3,r*.3),m=Math.min((a-i.minMonthlySteps)/i.minMonthlySteps*r*.2,r*.2);return c=Math.min(c+l+m,r),Math.round(c)}estimateSavings(s){return Math.round(500*s/100)}getAvailablePartners(){return this.partnersDB}async generateVerificationReport(){const s=g.getCurrentUser();if(!s)return null;const a=await v.getAvatarState();return{userId:s.id,userName:s.name,reportDate:new Date().toISOString(),healthMetrics:{currentHealthScore:a.current.score,totalDays:s.stats.totalDays,totalSteps:s.stats.totalSteps,avgDailySteps:s.stats.totalDays>0?Math.round(s.stats.totalSteps/s.stats.totalDays):0},activityLog:{last30DaysSteps:this.calculateMonthlySteps(s.stats),foodLogsCount:(s.profile.foodLog||[]).length,meditationSessions:s.stats.totalSessions||0,lastActive:s.profile.lastActive},verified:!0,signature:this.generateVerificationSignature(s)}}generateVerificationSignature(s){const a=`${s.id}-${Date.now()}`;return btoa(a)}async applyForDiscount(s){const a=await this.calculateDiscount(s);if(!a.eligible)return{success:!1,message:"Not eligible yet. Keep improving your health!",requirements:a.requirements};const t=await this.generateVerificationReport();return{success:!0,applicationId:"APP-"+Date.now(),discountPercent:a.discountPercent,monthlySavings:a.monthlySavings,yearlySavings:a.yearlySavings,report:t,message:`Application submitted! Estimated savings: $${a.monthlySavings}/month`}}}const y=new S;function D({onClose:p}){const[s,a]=h.useState(null),[t,r]=h.useState(null),[i,c]=h.useState(!1),l=[{id:"bupa",name:"Bupa Health Insurance",maxDiscount:40,color:"#44FF44",logo:"ğŸ¥"},{id:"vitality",name:"Vitality Health",maxDiscount:35,color:"#00FFFF",logo:"ğŸ’š"},{id:"axa",name:"AXA Health",maxDiscount:30,color:"#FF00FF",logo:"ğŸ›¡ï¸"},{id:"aviva",name:"Aviva Health",maxDiscount:25,color:"#FFD700",logo:"â­"}];h.useEffect(()=>{s&&m(s)},[s]);const m=async n=>{const o=await y.calculateDiscount(n);r(o)},u=async()=>{if(s){c(!0);try{const n=await y.applyForDiscount(s);alert(`âœ… Application Submitted!

Application ID: ${n.applicationId}

Estimated Savings:
$${n.estimatedSavings.monthly}/month
$${n.estimatedSavings.yearly}/year

You'll receive an email with next steps within 2-3 business days.`)}catch(n){alert("Failed to apply: "+n.message)}c(!1)}};return e.jsx("div",{className:"insurance-overlay",children:e.jsxs("div",{className:"insurance-modal",children:[e.jsx("button",{className:"insurance-close",onClick:p,children:"âœ•"}),e.jsx("h2",{className:"insurance-title",children:"ğŸ’° Insurance Rewards"}),e.jsx("p",{className:"insurance-subtitle",children:"Get up to 40% off your health insurance premiums"}),e.jsx("div",{className:"partner-grid",children:l.map(n=>e.jsxs("div",{className:`partner-card ${s===n.id?"selected":""}`,onClick:()=>a(n.id),style:{borderColor:s===n.id?n.color:"transparent"},children:[e.jsx("div",{className:"partner-name",children:n.name}),e.jsxs("div",{className:"partner-discount",children:["Up to ",n.maxDiscount,"% OFF"]})]},n.id))}),t&&e.jsxs("div",{className:"discount-results",children:[e.jsxs("div",{className:`eligibility-status ${t.eligible?"eligible":"not-eligible"}`,children:[e.jsx("span",{className:"status-icon",children:t.eligible?"âœ“":"âœ—"}),e.jsx("span",{className:"status-text",children:t.eligible?"You Qualify!":"Not Eligible Yet"})]}),t.eligible?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"savings-display",children:[e.jsxs("div",{className:"savings-main",children:[e.jsxs("span",{className:"savings-percent",children:[t.discountPercent,"%"]}),e.jsx("span",{className:"savings-label",children:"Discount"})]}),e.jsxs("div",{className:"savings-breakdown",children:[e.jsxs("div",{className:"savings-item",children:[e.jsxs("span",{className:"savings-amount",children:["$",t.monthlySavings]}),e.jsx("span",{className:"savings-period",children:"per month"})]}),e.jsxs("div",{className:"savings-item",children:[e.jsxs("span",{className:"savings-amount",children:["$",t.yearlySavings]}),e.jsx("span",{className:"savings-period",children:"per year"})]})]})]}),e.jsx("button",{className:"apply-button",onClick:u,disabled:i,children:i?"â³ Applying...":"âœ“ Apply for Discount"})]}):e.jsxs("div",{className:"requirements-list",children:[e.jsx("h3",{children:"Requirements to Qualify:"}),Object.entries(t.requirements).map(([n,o])=>e.jsxs("div",{className:`requirement-item ${o.met?"met":"not-met"}`,children:[e.jsx("span",{className:"req-icon",children:o.met?"âœ“":"âœ—"}),e.jsxs("div",{className:"req-info",children:[e.jsx("div",{className:"req-name",children:n.replace(/([A-Z])/g," $1").trim()}),e.jsxs("div",{className:"req-progress",children:[o.current," / ",o.required," ",n.includes("Score")?"points":"steps"]})]})]},n))]})]}),e.jsxs("div",{className:"how-it-works",children:[e.jsx("h3",{children:"ğŸ’¡ How It Works"}),e.jsxs("div",{className:"steps-grid",children:[e.jsxs("div",{className:"step-item",children:[e.jsx("span",{className:"step-number",children:"1"}),e.jsx("p",{children:"We track your health metrics securely"})]}),e.jsxs("div",{className:"step-item",children:[e.jsx("span",{className:"step-number",children:"2"}),e.jsx("p",{children:"Insurance partners verify your data"})]}),e.jsxs("div",{className:"step-item",children:[e.jsx("span",{className:"step-number",children:"3"}),e.jsx("p",{children:"Get instant premium discounts"})]}),e.jsxs("div",{className:"step-item",children:[e.jsx("span",{className:"step-number",children:"4"}),e.jsx("p",{children:"Save $2,400-$4,800 per year"})]})]})]}),e.jsxs("div",{className:"trust-section",children:[e.jsxs("div",{className:"trust-badge",children:[e.jsx("span",{className:"trust-icon",children:"ğŸ”’"}),e.jsx("span",{className:"trust-text",children:"HIPAA Compliant"})]}),e.jsxs("div",{className:"trust-badge",children:[e.jsx("span",{className:"trust-icon",children:"âœ“"}),e.jsx("span",{className:"trust-text",children:"Verified Partners"})]}),e.jsxs("div",{className:"trust-badge",children:[e.jsx("span",{className:"trust-icon",children:"ğŸ›¡ï¸"}),e.jsx("span",{className:"trust-text",children:"Data Encrypted"})]})]})]})})}export{D as default};
