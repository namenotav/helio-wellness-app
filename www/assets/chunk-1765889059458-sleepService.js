import{h as n,f as o,a as l}from"./entry-1765889059086-index.js";class g{constructor(){this.sleepLog=[]}async initialize(){await this.loadSleepLog()}async logSleep(e){try{this.sleepLog.length===0&&await this.loadSleepLog();const t={...e,id:"sleep_"+Date.now(),timestamp:Date.now(),date:e.date||new Date().toISOString().split("T")[0]};this.sleepLog.push(t),await this.saveSleepLog();const s=e.bedtime?parseInt(e.bedtime.split(":")[0]):22,i=e.wakeTime?parseInt(e.wakeTime.split(":")[0]):6;return await n.trackSleep({bedtime:s,wakeTime:i,duration:e.duration||e.hours||8,quality:e.quality||7,energyNextDay:7,mood:"rested",dreams:e.dreams||!1,interruptions:e.interruptions||0}),{success:!0,sleep:t}}catch(t){return{success:!1,error:t.message}}}getSleepLog(e=30){const t=Date.now()-e*24*60*60*1e3;return this.sleepLog.filter(s=>s.timestamp>t)}getLastNightSleep(){const e=new Date().toISOString().split("T")[0],t=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0];return this.sleepLog.find(s=>s.date===e||s.date===t)}async deleteSleep(e){try{return this.sleepLog=this.sleepLog.filter(t=>t.id!==e),await this.saveSleepLog(),{success:!0}}catch(t){return{success:!1,error:t.message}}}async saveSleepLog(){try{const e=Date.now()-7776e6,t=this.sleepLog.filter(s=>s.timestamp>e);this.sleepLog=t,localStorage.setItem("sleepLog",JSON.stringify(t)),await o.save("sleepLog",t,l.getCurrentUser()?.uid)}catch{}}async loadSleepLog(){try{const e=await o.get("sleepLog",l.getCurrentUser()?.uid);if(e&&Array.isArray(e))this.sleepLog=e;else{const t=localStorage.getItem("sleepLog");t?this.sleepLog=JSON.parse(t):this.sleepLog=[]}}catch{this.sleepLog=[]}}getSleepStats(){const e=this.getSleepLog(30),t=this.getSleepLog(7),s=e.length>0?e.reduce((a,r)=>a+(r.duration||r.hours||0),0)/e.length:0,i=t.length>0?t.reduce((a,r)=>a+(r.duration||r.hours||0),0)/t.length:0;return{total:this.sleepLog.length,last30Days:e.length,last7Days:t.length,averageDuration30Days:s.toFixed(1),averageDuration7Days:i.toFixed(1),lastNight:this.getLastNightSleep()}}}const h=new g;export{h as default};
