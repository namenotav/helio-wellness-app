const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/entry-1765759384261-index.js","assets/asset-1765759384970-index.css"])))=>i.map(i=>d[i]);
import{_ as A,f,a as p}from"./entry-1765759384261-index.js";class B{constructor(){this.avatarState=null,this.cachedState=null,this.cacheTimestamp=0,this.cacheValidDuration=0}async calculateHealthScore(a,i={}){const{age:l,weight:g,height:u,goalSteps:D}=a||{},{totalSteps:N=0,totalDays:C=0}=i;let r=100;const n=[];if(u&&g){const e=u/100,s=g/(e*e);s<18.5?(r-=15,n.push("‚ö†Ô∏è BMI too low")):s>25&&s<30?(r-=10,n.push("‚ö†Ô∏è Overweight BMI")):s>=30?(r-=25,n.push("üö® Obese BMI")):n.push("‚úÖ Healthy BMI")}(await A(async()=>{const{default:e}=await import("./entry-1765759384261-index.js").then(s=>s.w);return{default:e}},__vite__mapDeps([0,1]))).default;let c=0;try{const{Preferences:e}=await A(async()=>{const{Preferences:h}=await import("./entry-1765759384261-index.js").then(y=>y.v);return{Preferences:h}},__vite__mapDeps([0,1])),{value:s}=await e.get({key:"wellnessai_stepHistory"});if(s){const h=JSON.parse(s),y=new Date().toISOString().split("T")[0];c=h.find(b=>b.date===y)?.steps||0,console.log("üß¨ Health Avatar: Today steps from Android storage:",c)}}catch(e){console.warn("‚ö†Ô∏è Could not read today steps from Android storage:",e)}let v=await f.get("stepHistory",p.getCurrentUser()?.uid);if(!v||typeof v=="string")try{v=JSON.parse(localStorage.getItem("stepHistory")||"[]")}catch(e){console.warn("‚ö†Ô∏è Could not parse stepHistory from localStorage:",e),v=[]}const S=[...Array.isArray(v)?v:[]];if(c>0){const e=new Date().toISOString().split("T")[0],s=S.findIndex(h=>h.date===e);s>=0?S[s]={date:e,steps:c}:S.push({date:e,steps:c})}const _=S.slice(-30),H=_.reduce((e,s)=>e+(s?.steps||s||0),0),k=_.length>0?H/_.length:0,I=D||1e4;k<I*.5?(r-=20,n.push("üö® Very low activity")):k<I*.8?(r-=10,n.push("‚ö†Ô∏è Below step goal")):k>=I&&(r+=5,n.push("‚úÖ Meeting step goal"));let m=[];try{let e=await f.get("foodLog",p.getCurrentUser()?.uid);if(!e||typeof e=="string"){const s=localStorage.getItem("foodLog");e=s?JSON.parse(s):[]}m=Array.isArray(e)?e:[]}catch{m=[]}const L=720*60*60*1e3,E=m.filter(e=>{try{return new Date(e.timestamp||e.date).getTime()>=Date.now()-L}catch{return!1}}),M=E.filter(e=>e&&e.safety==="danger").length,J=E.filter(e=>e&&e.safety==="warning").length,R=E.filter(e=>e&&e.safety==="safe").length;r-=M*5,r-=J*2,R>30&&(r+=5,n.push("‚úÖ Good diet choices")),M>5&&n.push("üö® Too many allergen exposures");let t=[];try{let e=await f.get("workoutHistory",p.getCurrentUser()?.uid);if(!e||typeof e=="string"){const s=localStorage.getItem("workoutHistory");e=s?JSON.parse(s):[]}t=Array.isArray(e)?e:[]}catch{t=[]}const o=t.filter(e=>new Date(e.timestamp||e.date).getTime()>=Date.now()-L);o.length>=12?(r+=10,n.push("‚úÖ Excellent workout routine")):o.length>=8?(r+=5,n.push("‚úÖ Good workout consistency")):o.length<4&&(r-=10,n.push("‚ö†Ô∏è Low workout frequency"));let d=[];try{let e=await f.get("loginHistory",p.getCurrentUser()?.uid);if(!e||typeof e=="string"){const s=localStorage.getItem("loginHistory");e=s?JSON.parse(s):[]}d=Array.isArray(e)?e:[]}catch{d=[]}const w=d.filter(e=>new Date(e.timestamp||e.date).getTime()>=Date.now()-L),F=new Set(w.map(e=>new Date(e.timestamp||e.date).toDateString())).size;F>=20?(r+=5,n.push("‚úÖ Very engaged with health tracking")):F<10&&(r-=5,n.push("‚ö†Ô∏è Low engagement"));let T=null;try{let e=await f.get("dnaAnalysis",p.getCurrentUser()?.uid);if(!e||typeof e=="string"||!e.traits){try{const{value:s}=await(await A(async()=>{const{Preferences:h}=await import("./entry-1765759384261-index.js").then(y=>y.v);return{Preferences:h}},__vite__mapDeps([0,1]))).Preferences.get({key:"dna_genetic_data"});s&&(e=JSON.parse(s))}catch{}if(!e||typeof e=="string"){const s=localStorage.getItem("dnaAnalysis");if(s)try{e=JSON.parse(s)}catch{try{const{default:y}=await A(async()=>{const{default:b}=await import("./chunk-1765759384263-encryptionService.js");return{default:b}},[]),x=await y.decrypt(s);e=JSON.parse(x)}catch{e=null}}}}T=e}catch{T=null}if(T){const e=T.traits||[];if(e.length>0){const s=e.filter(y=>y.risk==="high").length,h=e.filter(y=>y.risk==="medium").length;r-=s*3,r-=h*1,s>0&&n.push(`üß¨ ${s} high genetic risks`)}}let V=[];try{let e=await f.get("sleepLog",p.getCurrentUser()?.uid);if(!e||typeof e=="string"){const s=localStorage.getItem("sleepLog");e=s?JSON.parse(s):[]}V=Array.isArray(e)?e:[]}catch{V=[]}const U=V.filter(e=>new Date(e.date).getTime()>=Date.now()-L);let O=a.sleepHours||7;if(U.length>0&&(O=U.reduce((e,s)=>e+s.hours,0)/U.length),O<6?(r-=15,n.push("üö® Severe sleep deprivation")):O<7?(r-=8,n.push("‚ö†Ô∏è Insufficient sleep")):O>=7&&O<=9&&(r+=5,n.push("‚úÖ Good sleep duration")),a.medicalConditions&&a.medicalConditions.length>0){const e=["diabetes","heart-disease","hypertension"];a.medicalConditions.some(h=>e.includes(h))?(r-=15,n.push("üö® Severe medical condition")):(r-=a.medicalConditions.length*3,n.push(`‚ö†Ô∏è ${a.medicalConditions.length} medical conditions`))}return a.smoker&&(r-=20,n.push("üö® Smoker")),(a.alcoholFrequency==="daily"||a.alcoholFrequency==="regular")&&(r-=10,n.push("‚ö†Ô∏è Regular alcohol consumption")),a.stressLevel==="very-high"?(r-=12,n.push("üö® Very high stress")):a.stressLevel==="high"&&(r-=6,n.push("‚ö†Ô∏è High stress")),a.waterIntake==="low"?(r-=5,n.push("‚ö†Ô∏è Low water intake")):a.waterIntake==="excellent"&&(r+=3,n.push("‚úÖ Excellent hydration")),a.familyHistory&&a.familyHistory.length>0&&(r-=a.familyHistory.length*2,n.push(`üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ${a.familyHistory.length} family history risks`)),a.fitnessLevel==="athlete"||a.fitnessLevel==="very-active"?(r+=10,n.push("‚úÖ Excellent fitness level")):a.fitnessLevel==="sedentary"&&(r-=8,n.push("‚ö†Ô∏è Sedentary lifestyle")),Math.max(0,Math.min(100,r))}projectFutureHealth(a,i){let l=0;a>=80?l=2:a>=60?l=5:l=10;const g=Math.max(0,a-l*i);return{score:g,ageAppearance:this.calculateAgeAppearance(g,i),warnings:this.generateWarnings(g),improvements:this.generateImprovements(a,g)}}calculateAgeAppearance(a,i){const g=(p.getCurrentUser()?.profile?.age||30)+i;let u=0;return a<40?u=15:a<60?u=8:a>85&&(u=-5),g+u}generateWarnings(a){const i=[];return a<30?(i.push("üö® Critical: High risk of chronic disease"),i.push("‚ö†Ô∏è Energy levels will be severely impacted"),i.push("üíî Heart health at serious risk")):a<50?(i.push("‚ö†Ô∏è Moderate health decline expected"),i.push("üòì Energy and mood will decrease"),i.push("üìâ Fitness levels declining")):a<70&&(i.push("‚ö° Room for improvement"),i.push("üéØ Could optimize health further")),i}generateImprovements(a,i){const l=[];return i<a&&(l.push("üí™ Increase daily activity by 3000 steps"),l.push("ü•ó Add 2 more servings of vegetables daily"),l.push("üí§ Get 30 minutes more sleep each night"),l.push("üßò Practice 10 minutes of meditation")),l}getAvatarVisuals(a){return{skinTone:a>70?"#FFD4A3":a>50?"#E8C4A0":"#D4B898",energyLevel:a>70?"high":a>50?"medium":"low",muscleTone:a>75?"toned":a>50?"average":"low",posture:a>70?"upright":a>50?"slight-slouch":"slouched",eyeBrightness:a>75?"bright":a>50?"average":"dull",hairQuality:a>70?"shiny":a>50?"average":"dull",glowEffect:a>80?"strong":a>60?"subtle":"none",overallMood:a>75?"üòä":a>50?"üòê":"üòî"}}async getAvatarState(a=!1){const i=Date.now();if(!a&&this.cachedState&&i-this.cacheTimestamp<this.cacheValidDuration)return this.cachedState;const l=p.getCurrentUser();if(!l)return null;const g=new Date,u=g.getMonth(),D=g.getFullYear(),N=g.toLocaleString("en-US",{month:"long"}),C=await this.calculateHealthScore(l.profile,l.stats);(await A(async()=>{const{default:t}=await import("./entry-1765759384261-index.js").then(o=>o.w);return{default:t}},__vite__mapDeps([0,1]))).default;let r=0;const n=new Date().toISOString().split("T")[0];let c=null;try{const{Preferences:t}=await A(async()=>{const{Preferences:d}=await import("./entry-1765759384261-index.js").then(w=>w.v);return{Preferences:d}},__vite__mapDeps([0,1])),{value:o}=await t.get({key:"wellnessai_stepHistory"});o&&(c=JSON.parse(o),console.log("üß¨ Health Avatar loaded from Android CapacitorStorage:",c?.length,"entries"))}catch(t){console.warn("‚ö†Ô∏è Could not read from Android CapacitorStorage:",t)}if(c||(c=await f.get("stepHistory",p.getCurrentUser()?.uid),c&&console.log("üß¨ Fallback to Firestore stepHistory:",c?.length,"entries")),!c||typeof c=="string")try{c=JSON.parse(localStorage.getItem("stepHistory")||"[]"),console.log("üß¨ Fallback to localStorage stepHistory:",c?.length,"entries")}catch(t){console.warn("‚ö†Ô∏è Could not parse stepHistory from localStorage:",t),c=[]}const v=Array.isArray(c)?c:[];r=v.find(t=>t.date===n)?.steps||0,console.log("üß¨ Health Avatar: Today steps from history:",r);let S=[];try{let t=l.profile?.foodLog||await f.get("foodLog",p.getCurrentUser()?.uid);if(!t||typeof t=="string"){const o=localStorage.getItem("foodLog");t=o?JSON.parse(o):[]}S=Array.isArray(t)?t:[]}catch(t){console.warn("‚ö†Ô∏è Could not load foodLog:",t),S=[]}let _=[];try{let t=await f.get("workoutHistory",p.getCurrentUser()?.uid);if(!t||typeof t=="string"){const o=localStorage.getItem("workoutHistory");t=o?JSON.parse(o):[]}_=Array.isArray(t)?t:[]}catch(t){console.warn("‚ö†Ô∏è Could not load workoutHistory:",t),_=[]}let H=null;try{let t=await f.get("dnaAnalysis",p.getCurrentUser()?.uid);if(!t||typeof t=="string"||!t.traits){try{const{value:o}=await(await A(async()=>{const{Preferences:d}=await import("./entry-1765759384261-index.js").then(w=>w.v);return{Preferences:d}},__vite__mapDeps([0,1]))).Preferences.get({key:"dna_genetic_data"});o&&(t=JSON.parse(o))}catch{}if(!t||typeof t=="string"){const o=localStorage.getItem("dnaAnalysis");if(o)try{t=JSON.parse(o)}catch{try{const{default:w}=await A(async()=>{const{default:T}=await import("./chunk-1765759384263-encryptionService.js");return{default:T}},[]),F=await w.decrypt(o);t=JSON.parse(F)}catch{t=null}}}}H=t}catch(t){console.warn("‚ö†Ô∏è Could not load dnaAnalysis:",t),H=null}let k=[];try{let t=await f.get("sleepLog",p.getCurrentUser()?.uid);if(!t||typeof t=="string"){const o=localStorage.getItem("sleepLog");t=o?JSON.parse(o):[]}k=Array.isArray(t)?t:[]}catch(t){console.warn("‚ö†Ô∏è Could not load sleepLog:",t),k=[]}const I=k.filter(t=>{const o=new Date(t.timestamp||t.date);return o.getMonth()===u&&o.getFullYear()===D}),m=v.filter(t=>{const o=new Date(t.date);return o.getMonth()===u&&o.getFullYear()===D});console.log("üß¨ Current month steps ("+N+"):",m);const L=m.reduce((t,o)=>{const d=typeof o=="object"?o?.steps:o,w=typeof d=="number"&&!isNaN(d)?d:0;return t+w},0),E=m.length>0?L/m.length:0,M=S.filter(t=>{const o=new Date(t.timestamp||t.date);return o.getMonth()===u&&o.getFullYear()===D}),J=_.filter(t=>{const o=new Date(t.timestamp||t.date);return o.getMonth()===u&&o.getFullYear()===D}),R={current:{score:C,visuals:this.getAvatarVisuals(C),age:l.profile.age||30,dataBreakdown:{monthName:N,currentYear:D,stepsDays:m.length,todaySteps:r,avgDailySteps:Math.round(E),totalMonthlySteps:Math.round(L),stepHistory:m,foodLogsCount:M.length,workoutsCount:J.length,hasDNAAnalysis:!!(H&&(H.traits||H.analysis)),sleepLogsCount:I.length}},future1Year:this.projectFutureHealth(C,1),future5Years:this.projectFutureHealth(C,5),future10Years:this.projectFutureHealth(C,10)};return this.cachedState=R,this.cacheTimestamp=g,R}getCachedState(){const a=Date.now();return this.cachedState&&a-this.cacheTimestamp<this.cacheValidDuration?this.cachedState:null}clearCache(){this.cachedState=null,this.cacheTimestamp=0}simulateChoice(a,i){return{"fast-food":{score:-5,message:"Avatar looks tired, skin duller"},"healthy-meal":{score:3,message:"Avatar glows, more energetic"},exercise:{score:5,message:"Avatar becomes more toned"},"skipped-workout":{score:-3,message:"Avatar loses muscle tone"},"good-sleep":{score:4,message:"Avatar looks refreshed"},"poor-sleep":{score:-4,message:"Avatar has dark circles"}}[a]||{score:0,message:"No change"}}}const q=new B;export{q as default,q as healthAvatarService};
